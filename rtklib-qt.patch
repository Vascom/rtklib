diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/aboutdlg.cpp RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/aboutdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/aboutdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/aboutdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -5,7 +5,7 @@
 #include "rtklib.h"
 
 //---------------------------------------------------------------------------
-AboutDialog::AboutDialog(QWidget *parent)
+AboutDialog::AboutDialog(QWidget* parent)
     : QDialog(parent)
 {
     setupUi(this);
@@ -15,18 +15,18 @@
 {
     if (event->spontaneous()) return;
 
-    QPixmap icon[] = { QPixmap(":/icons/rtk1.bmp"),
-                       QPixmap(":/icons/rtk2.bmp"),
-                       QPixmap(":/icons/rtk3.bmp"),
-                       QPixmap(":/icons/rtk4.bmp"),
-                       QPixmap(":/icons/rtk5.bmp"),
-                       QPixmap(":/icons/rtk6.bmp"),
-                       QPixmap(":/icons/rtk7.bmp") };
+    QPixmap icon[]={QPixmap(":/icons/rtk1.bmp"),
+                    QPixmap(":/icons/rtk2.bmp"),
+                    QPixmap(":/icons/rtk3.bmp"),
+                    QPixmap(":/icons/rtk4.bmp"),
+                    QPixmap(":/icons/rtk5.bmp"),
+                    QPixmap(":/icons/rtk6.bmp"),
+                    QPixmap(":/icons/rtk7.bmp")};
 
-    if ((IconIndex > 0) && (IconIndex < 7)) wgIcon->setPixmap(icon[IconIndex - 1]);
+    if ((IconIndex>0)&&(IconIndex<7)) wgIcon->setPixmap(icon[IconIndex-1]);
     lbAbout->setText(About);
     lbVersion->setText(QString(tr("with RTKLIB ver.%1 %2")).arg(VER_RTKLIB).arg(PATCH_LEVEL));
     lbCopyright->setText(COPYRIGHT_RTKLIB);
 
-    connect(pbOkay, SIGNAL(clicked(bool)), this, SLOT(accept()));
+    connect(pbOkay,SIGNAL(clicked(bool)),this,SLOT(accept()));
 }
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/aboutdlg.h RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/aboutdlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/aboutdlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/aboutdlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -20,7 +20,6 @@
 public:
 	int IconIndex;
     QString About;
-
     explicit AboutDialog(QWidget*);
 };
 #endif
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/aboutdlg.ui RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/aboutdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/aboutdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/aboutdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -53,6 +53,9 @@
      <property name="text">
       <string/>
      </property>
+     <property name="scaledContents">
+      <bool>true</bool>
+     </property>
     </widget>
    </item>
   </layout>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/cmdoptdlg.cpp RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/cmdoptdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/cmdoptdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/cmdoptdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -9,20 +9,19 @@
 #include "cmdoptdlg.h"
 
 //---------------------------------------------------------------------------
-CmdOptDialog::CmdOptDialog(QWidget *parent)
+ CmdOptDialog::CmdOptDialog(QWidget* parent)
     : QDialog(parent)
 {
     setupUi(this);
 
-    CmdEna[0] = CmdEna[1] = 1;
+	CmdEna[0]=CmdEna[1]=1;
 
-    connect(BtnOk, SIGNAL(clicked()), this, SLOT(BtnOkClick()));
-    connect(BtnCancel, SIGNAL(clicked()), this, SLOT(reject()));
-    connect(BtnLoad, SIGNAL(clicked()), this, SLOT(BtnLoadClick()));
-    connect(BtnSave, SIGNAL(clicked()), this, SLOT(BtnSaveClick()));
-    connect(ChkCloseCmd, SIGNAL(clicked(bool)), this, SLOT(ChkCloseCmdClick()));
-    connect(ChkOpenCmd, SIGNAL(clicked(bool)), this, SLOT(ChkOpenCmdClick()));
-    connect(ChkPeriodicCmd, SIGNAL(clicked(bool)), this, SLOT(ChkPeriodicCmdClick()));
+    connect(BtnOk,SIGNAL(clicked()),this,SLOT(BtnOkClick()));
+    connect(BtnCancel,SIGNAL(clicked()),this,SLOT(reject()));
+    connect(BtnLoad,SIGNAL(clicked()),this,SLOT(BtnLoadClick()));
+    connect(BtnSave,SIGNAL(clicked()),this,SLOT(BtnSaveClick()));
+    connect(ChkCloseCmd,SIGNAL(clicked(bool)),this,SLOT(ChkCloseCmdClick()));
+    connect(ChkOpenCmd,SIGNAL(clicked(bool)),this,SLOT(ChkOpenCmdClick()));
 }
 
 //---------------------------------------------------------------------------
@@ -35,58 +34,54 @@
 
     OpenCmd->appendPlainText(Cmds[0]);
     CloseCmd->appendPlainText(Cmds[1]);
-    PeriodicCmd->appendPlainText(Cmds[2]);
     ChkOpenCmd->setChecked(CmdEna[0]);
     ChkCloseCmd->setChecked(CmdEna[1]);
-    ChkPeriodicCmd->setChecked(CmdEna[2]);
 
 	UpdateEnable();
 }
+
 //---------------------------------------------------------------------------
-void CmdOptDialog::BtnOkClick()
+void  CmdOptDialog::BtnOkClick()
 {
-    Cmds[0] = OpenCmd->toPlainText();
-    Cmds[1] = CloseCmd->toPlainText();
-    Cmds[2] = PeriodicCmd->toPlainText();
-    CmdEna[0] = ChkOpenCmd->isChecked();
-    CmdEna[1] = ChkCloseCmd->isChecked();
-    CmdEna[2] = ChkPeriodicCmd->isChecked();
+    Cmds[0]=OpenCmd->toPlainText();
+    Cmds[1]=CloseCmd->toPlainText();
+    CmdEna[0]=ChkOpenCmd->isChecked();
+    CmdEna[1]=ChkCloseCmd->isChecked();
 
     accept();
 }
+
 //---------------------------------------------------------------------------
-void CmdOptDialog::BtnLoadClick()
+void  CmdOptDialog::BtnLoadClick()
 {
     QString OpenDialog_FileName;
-    QPlainTextEdit *cmd[] = { OpenCmd, CloseCmd , PeriodicCmd };
+    QPlainTextEdit *cmd[]={OpenCmd,CloseCmd};
     QByteArray buff;
-    int n = 0;
+	int n=0;
 
-    OpenDialog_FileName = QDir::toNativeSeparators(QFileDialog::getOpenFileName(this));
+    OpenDialog_FileName=QDir::toNativeSeparators(QFileDialog::getOpenFileName(this));
     QFile f(OpenDialog_FileName);
 
     f.open(QIODevice::ReadOnly);
 
     cmd[0]->clear();
     cmd[1]->clear();
-    cmd[2]->clear();
 
-    while (!f.atEnd() && n < 3) {
-        buff = f.readLine(0);
-        if (buff.at(0) == '@') {
-            n ++; continue;
-        }
-        if (buff[buff.length() - 1] == '\n') buff[buff.length() - 1] = '\0';
+    while (!f.atEnd()) {
+        buff=f.readLine(0);
+        if (buff[0]=='@') {n=1; continue;}
+        if (buff[buff.length()-1]=='\n') buff[buff.length()-1]='\0';
         cmd[n]->appendPlainText(buff);
     }
 }
+
 //---------------------------------------------------------------------------
-void CmdOptDialog::BtnSaveClick()
+void  CmdOptDialog::BtnSaveClick()
 {
     QString SaveDialog_FileName;
-    QByteArray OpenCmd_Text = OpenCmd->toPlainText().toLatin1(), CloseCmd_Text = CloseCmd->toPlainText().toLatin1(), PeriodicCmd_Text = PeriodicCmd->toPlainText().toLatin1();
+    QByteArray OpenCmd_Text=OpenCmd->toPlainText().toLatin1(),CloseCmd_Text=CloseCmd->toPlainText().toLatin1();
 
-    SaveDialog_FileName = QDir::toNativeSeparators(QFileDialog::getSaveFileName(this));
+    SaveDialog_FileName=QDir::toNativeSeparators(QFileDialog::getSaveFileName(this));
     QFile fp(SaveDialog_FileName);
 
     if (!fp.open(QIODevice::WriteOnly)) return;
@@ -94,30 +89,23 @@
     fp.write(OpenCmd_Text);
     fp.write("\n@\n");
     fp.write(CloseCmd_Text);
-    fp.write("\n@\n");
-    fp.write(PeriodicCmd_Text);
 }
 
 //---------------------------------------------------------------------------
-void CmdOptDialog::ChkCloseCmdClick()
+void  CmdOptDialog::ChkCloseCmdClick()
 {
 	UpdateEnable();
 }
 
 //---------------------------------------------------------------------------
-void CmdOptDialog::ChkOpenCmdClick()
+void  CmdOptDialog::ChkOpenCmdClick()
 {
 	UpdateEnable();
 }
+
 //---------------------------------------------------------------------------
-void CmdOptDialog::ChkPeriodicCmdClick()
-{
-    UpdateEnable();
-}
-//---------------------------------------------------------------------------
-void CmdOptDialog::UpdateEnable()
+void  CmdOptDialog::UpdateEnable()
 {
     OpenCmd->setEnabled(ChkOpenCmd->isChecked());
     CloseCmd->setEnabled(ChkCloseCmd->isChecked());
-    PeriodicCmd->setEnabled(ChkPeriodicCmd->isChecked());
 }
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/cmdoptdlg.h RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/cmdoptdlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/cmdoptdlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/cmdoptdlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -19,13 +19,12 @@
     void BtnOkClick();
     void ChkCloseCmdClick();
     void ChkOpenCmdClick();
-    void ChkPeriodicCmdClick();
     void BtnLoadClick();
     void BtnSaveClick();
 
 public:
-    QString Cmds[3];
-    bool CmdEna[3];
+    QString Cmds[2];
+    bool CmdEna[2];
     explicit CmdOptDialog(QWidget* parent);
 };
 #endif
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/cmdoptdlg.ui RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/cmdoptdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/cmdoptdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/cmdoptdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>385</width>
-    <height>361</height>
+    <width>376</width>
+    <height>264</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -67,16 +67,6 @@
     </widget>
    </item>
    <item>
-    <widget class="QCheckBox" name="ChkPeriodicCmd">
-     <property name="text">
-      <string>Periodic Commands : &lt;command&gt; # cycle (ms)</string>
-     </property>
-    </widget>
-   </item>
-   <item>
-    <widget class="QPlainTextEdit" name="PeriodicCmd"/>
-   </item>
-   <item>
     <widget class="QWidget" name="widget" native="true">
      <layout class="QHBoxLayout" name="horizontalLayout">
       <property name="leftMargin">
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/fileoptdlg.cpp RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/fileoptdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/fileoptdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/fileoptdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -13,89 +13,88 @@
 #include <QCompleter>
 
 //---------------------------------------------------------------------------
-FileOptDialog::FileOptDialog(QWidget *parent)
+FileOptDialog::FileOptDialog(QWidget* parent)
     : QDialog(parent)
 {
     setupUi(this);
-    Opt = 0;
+	Opt=0;
 
-    keyDialog = new KeyDialog(this);
+    keyDialog=new KeyDialog(this);
 
-    QCompleter *fileCompleter = new QCompleter(this);
-    QFileSystemModel *fileModel = new QFileSystemModel(fileCompleter);
+    QCompleter *fileCompleter=new QCompleter(this);
+    QFileSystemModel *fileModel=new QFileSystemModel(fileCompleter);
     fileModel->setRootPath("");
     fileCompleter->setModel(fileModel);
     FilePath->setCompleter(fileCompleter);
 
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnKey, SIGNAL(clicked(bool)), this, SLOT(BtnKeyClick()));
-    connect(BtnFilePath, SIGNAL(clicked(bool)), this, SLOT(BtnFilePathClick()));
-    connect(ChkTimeTag, SIGNAL(clicked(bool)), this, SLOT(ChkTimeTagClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnKey,SIGNAL(clicked(bool)),this,SLOT(BtnKeyClick()));
+    connect(BtnFilePath,SIGNAL(clicked(bool)),this,SLOT(BtnFilePathClick()));
+    connect(ChkTimeTag,SIGNAL(clicked(bool)),this,SLOT(ChkTimeTagClick()));
 
     SwapIntv->setValidator(new QIntValidator());
 }
 //---------------------------------------------------------------------------
 void FileOptDialog::showEvent(QShowEvent *event)
 {
-    int size_fpos=4;
-
     if (event->spontaneous()) return;
 
-    ChkTimeTag->setText(Opt ? tr("TimeTag") : tr("Time"));
+    ChkTimeTag->setText(Opt?tr("TimeTag"):tr("Time"));
     TimeSpeed->setVisible(!Opt);
     TimeStart->setVisible(!Opt);
-    Chk64Bit->setVisible(!Opt);
-    Label1->setText(Opt ? tr("Output File Path") : tr("Input File Path"));
-    Label2->setVisible(!Opt);
-    Label4->setVisible(Opt);
-    Label5->setVisible(Opt);
-    SwapIntv->setVisible(Opt);
-    BtnKey->setVisible(Opt);
+    Label1   ->setText(Opt?tr("Output File Path"):tr("Input File Path"));
+    Label2   ->setVisible(!Opt);
+    Label3   ->setVisible(!Opt);
+    Label4   ->setVisible(Opt);
+    Label5   ->setVisible(Opt);
+    SwapIntv ->setVisible(Opt);
+    BtnKey   ->setVisible(Opt);
     ChkTimeTag->setChecked(false);
 
-    if (!Opt) { // input
-        double speed = 1.0, start = 0.0;
+    if (!Opt) {
+        double speed=1.0,start=0.0;
 
-        QStringList tokens = Path.split("::");
+        QStringList tokens=Path.split("::");
 
         QString token;
-        foreach(token, tokens){
-            if (token == "T") ChkTimeTag->setChecked(true);
-            if (token.contains("+")) start = token.toDouble();
-            if (token.contains("x")) speed = token.mid(1).toDouble();
-            if (token.contains('P')) size_fpos=token.mid(2).toInt();
+        foreach (token, tokens)
+        {
+            if (token=="T") ChkTimeTag->setChecked(true);
+            if (token.contains("+")) start=token.toDouble();
+            if (token.contains("x")) speed=token.mid(1).toDouble();
         }
 
-        if (start <= 0.0) start = 0.0;
-        if (speed <= 0.0) speed = 1.0;
+		if (start<=0.0) start=0.0;
+		if (speed<=0.0) speed=1.0;
 
-        int index = TimeSpeed->findText(QString("x%1").arg(speed));
-        if (index != -1) {
+        int index=TimeSpeed->findText(QString("x%1").arg(speed));
+        if (index!=-1)
             TimeSpeed->setCurrentIndex(index);
-        } else {
-            TimeSpeed->addItem(QString("x%1").arg(speed), speed);
+        else {
+            TimeSpeed->addItem(QString("x%1").arg(speed),speed);
             TimeSpeed->setCurrentIndex(TimeSpeed->count());
         }
-        TimeStart->setValue(start);
-        Chk64Bit->setChecked(size_fpos==8);
+        TimeStart->setText(QString::number(start));
 
         FilePath->setText(tokens.at(0));
-    } else { // output
-        double intv = 0.0;
+	}
+	else {
+        double intv=0.0;
 
-        QStringList tokens = Path.split("::");
+        QStringList tokens=Path.split("::");
 
         QString token;
-        foreach(token, tokens){
-            if (token == "T") ChkTimeTag->setChecked(true);
-            if (token.contains("S=")) intv = token.mid(2).toDouble();
+        foreach (token, tokens)
+        {
+            if (token=="T") ChkTimeTag->setChecked(true);
+            if (token.contains("S=")) intv=token.mid(2).toDouble();
         };
-        int index = SwapIntv->findText(QString::number(intv, 'g', 3));
-        if (index != -1) {
+        int index=SwapIntv->findText(QString::number(intv,'g',3));
+        if (index!=-1)
             SwapIntv->setCurrentIndex(index);
-        } else {
-            SwapIntv->addItem(QString::number(intv, 'g', 3), intv);
+        else {
+            SwapIntv->addItem(QString::number(intv,'g',3),intv);
             SwapIntv->setCurrentIndex(TimeSpeed->count());
         }
 
@@ -108,31 +107,33 @@
 {
     QString str;
     bool okay;
-
-    if (!Opt) {  // input
-        Path = FilePath->text();
-        if (ChkTimeTag->isChecked())
-            Path = Path + "::T" + "::" + TimeSpeed->currentText() + "::+" + TimeStart->text();
-        if (Chk64Bit->isChecked()) {
-            Path=Path+"::P=8";
-        }
-    } else { // output
-        Path = FilePath->text();
-        if (ChkTimeTag->isChecked()) Path += "::T";
-        str = SwapIntv->currentText();
+	
+	if (!Opt) {
+        Path=FilePath->text();
+        if (ChkTimeTag->isChecked()) {
+            Path=Path+"::T"+"::"+TimeSpeed->currentText()+"::+"+TimeStart->text();
+		}
+	}
+	else {
+        Path=FilePath->text();
+        if (ChkTimeTag->isChecked()) Path+="::T";
+        str=SwapIntv->currentText();
         str.toDouble(&okay);
-        if (okay)
-            Path += "::S=" + str;
+        if (okay) {
+			Path+="::S="+str;
+		}
 	}
     accept();
 }
 //---------------------------------------------------------------------------
 void FileOptDialog::BtnFilePathClick()
 {
-    if (!Opt)
-        FilePath->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, QString(), FilePath->text())));
-    else
-        FilePath->setText(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, QString(), FilePath->text())));
+	if (!Opt) {
+        FilePath->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,QString(),FilePath->text())));
+	}
+	else {
+        FilePath->setText(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this,QString(),FilePath->text())));
+    }
 }
 //---------------------------------------------------------------------------
 void FileOptDialog::ChkTimeTagClick()
@@ -149,6 +150,6 @@
 {
     TimeSpeed->setEnabled(ChkTimeTag->isChecked());
     TimeStart->setEnabled(ChkTimeTag->isChecked());
-    Chk64Bit ->setEnabled(ChkTimeTag->isChecked());
-    Label2->setEnabled(ChkTimeTag->isChecked());
+    Label2   ->setEnabled(ChkTimeTag->isChecked());
+    Label3   ->setEnabled(ChkTimeTag->isChecked());
 }
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/fileoptdlg.ui RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/fileoptdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/fileoptdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/fileoptdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -2,14 +2,6 @@
 <ui version="4.0">
  <class>FileOptDialog</class>
  <widget class="QWidget" name="FileOptDialog">
-  <property name="geometry">
-   <rect>
-    <x>0</x>
-    <y>0</y>
-    <width>527</width>
-    <height>158</height>
-   </rect>
-  </property>
   <property name="windowTitle">
    <string>File Options</string>
   </property>
@@ -17,6 +9,64 @@
    <string/>
   </property>
   <layout class="QGridLayout" name="gridLayout">
+   <item row="1" column="2">
+    <widget class="QLineEdit" name="TimeStart">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>0</string>
+     </property>
+    </widget>
+   </item>
+   <item row="1" column="0">
+    <widget class="QComboBox" name="TimeSpeed">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <item>
+      <property name="text">
+       <string>x0.1</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>x0.2</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>x0.5</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>x1</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>x2</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>x5</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>x10</string>
+      </property>
+     </item>
+    </widget>
+   </item>
    <item row="2" column="0">
     <widget class="QLabel" name="Label1">
      <property name="enabled">
@@ -30,6 +80,19 @@
      </property>
     </widget>
    </item>
+   <item row="1" column="5">
+    <widget class="QLabel" name="Label3">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>s</string>
+     </property>
+    </widget>
+   </item>
    <item row="2" column="5">
     <widget class="QPushButton" name="BtnFilePath">
      <property name="enabled">
@@ -56,6 +119,13 @@
      </property>
     </widget>
    </item>
+   <item row="1" column="1">
+    <widget class="QLabel" name="Label2">
+     <property name="text">
+      <string>+</string>
+     </property>
+    </widget>
+   </item>
    <item row="3" column="0" colspan="8">
     <widget class="QWidget" name="widget" native="true">
      <property name="sizePolicy">
@@ -65,6 +135,9 @@
       </sizepolicy>
      </property>
      <layout class="QHBoxLayout" name="horizontalLayout">
+      <property name="spacing">
+       <number>0</number>
+      </property>
       <property name="leftMargin">
        <number>0</number>
       </property>
@@ -172,13 +245,6 @@
        </widget>
       </item>
       <item>
-       <widget class="QCheckBox" name="Chk64Bit">
-        <property name="text">
-         <string>64bit</string>
-        </property>
-       </widget>
-      </item>
-      <item>
        <widget class="QPushButton" name="BtnKey">
         <property name="enabled">
          <bool>true</bool>
@@ -229,81 +295,8 @@
      </layout>
     </widget>
    </item>
-   <item row="1" column="2">
-    <widget class="QDoubleSpinBox" name="TimeStart">
-     <property name="suffix">
-      <string> s</string>
-     </property>
-     <property name="maximum">
-      <double>10000.000000000000000</double>
-     </property>
-    </widget>
-   </item>
-   <item row="1" column="0">
-    <widget class="QComboBox" name="TimeSpeed">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <item>
-      <property name="text">
-       <string>x0.1</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>x0.2</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>x0.5</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>x1</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>x2</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>x5</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>x10</string>
-      </property>
-     </item>
-    </widget>
-   </item>
-   <item row="1" column="1">
-    <widget class="QLabel" name="Label2">
-     <property name="text">
-      <string>+</string>
-     </property>
-    </widget>
-   </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>TimeSpeed</tabstop>
-  <tabstop>TimeStart</tabstop>
-  <tabstop>FilePath</tabstop>
-  <tabstop>BtnFilePath</tabstop>
-  <tabstop>ChkTimeTag</tabstop>
-  <tabstop>SwapIntv</tabstop>
-  <tabstop>BtnKey</tabstop>
-  <tabstop>BtnOk</tabstop>
-  <tabstop>BtnCancel</tabstop>
- </tabstops>
  <resources/>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/ftpoptdlg.cpp RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/ftpoptdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/ftpoptdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/ftpoptdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -12,106 +12,111 @@
 #include "keydlg.h"
 
 //---------------------------------------------------------------------------
-FtpOptDialog::FtpOptDialog(QWidget *parent)
+ FtpOptDialog::FtpOptDialog(QWidget* parent)
     : QDialog(parent)
 {
-    setupUi(this);
+     setupUi(this);
 
-    keyDlg = new KeyDialog(this);
+     keyDlg=new KeyDialog(this);
 
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnKey, SIGNAL(clicked(bool)), this, SLOT(BtnKeyClick()));
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
+     connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+     connect(BtnKey,SIGNAL(clicked(bool)),this,SLOT(BtnKeyClick()));
+     connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
 
-    PathOffset->setValidator(new QIntValidator(this));
-    Interval->setValidator(new QIntValidator(this));
-    Offset->setValidator(new QIntValidator(this));
+     PathOffset->setValidator(new QIntValidator(this));
+     Interval->setValidator(new QIntValidator(this));
+     Offset->setValidator(new QIntValidator(this));
+     RetryInterval->setValidator(new QIntValidator(this));
 }
 //---------------------------------------------------------------------------
-void FtpOptDialog::showEvent(QShowEvent *event)
+void  FtpOptDialog::showEvent(QShowEvent *event)
 {
-    QString cap[] = { tr("FTP Option"), tr("HTTP Option") };
-    int topts[4] = { 0, 3600, 0, 0 };
-
+    QString cap[]={tr("FTP Option"),tr("HTTP Option")};
+	int topts[4]={0,3600,0,0};
+	
     if (event->spontaneous()) return;
 
     setWindowTitle(cap[Opt]);
-
-    QStringList tokens = Path.split("::");
-    if (tokens.size() > 1) {
-        QString t = tokens.at(1);
-        if (t.contains("T=")) {
-            QStringList values = t.mid(2).split(",");
-            for (int i = 0; (i < 4) || (i < values.size()); i++)
-                topts[i] = values.at(i).toInt();
+	
+    QStringList tokens=Path.split("::");
+    if (tokens.size()>1)
+    {
+        QString t=tokens.at(1);
+        if (t.contains("T="))
+        {
+            QStringList values=t.mid(2).split(",");
+            for (int i=0;(i<4)||(i<values.size());i++)
+                topts[i]=values.at(i).toInt();
         }
     }
-    QUrl url(QString("ftp://") + Path);
-
+    QUrl url(QString("ftp://")+Path);
+	
     Addr->clear();
-    Addr->addItem(url.host() + url.path());
-    for (int i = 0; i < MAXHIST; i++)
-        if (History[i] != "") Addr->addItem(History[i]);
-    ;
+    Addr->addItem(url.host()+url.path());
+    for (int i=0;i<MAXHIST;i++) {
+        if (History[i]!="") Addr->addItem(History[i]);
+    };
 
     Addr->setCurrentIndex(0);
     User->setText(url.userName());
     Passwd->setText(url.password());
-    PathOffset->insertItem(0, QString::number(topts[0] / 3600.0, 'g', 2)); PathOffset->setCurrentIndex(0);
-    Interval->insertItem(0, QString::number(topts[1] / 3600.0, 'g', 2)); Interval->setCurrentIndex(0);
-    Offset->insertItem(0, QString::number(topts[2] / 3600.0, 'g', 2)); Offset->setCurrentIndex(0);
-    RetryInterval->setValue(topts[3]);
+    PathOffset   ->insertItem(0,QString::number(topts[0]/3600.0,'g',2));PathOffset->setCurrentIndex(0);
+    Interval     ->insertItem(0,QString::number(topts[1]/3600.0,'g',2));Interval->setCurrentIndex(0);
+    Offset       ->insertItem(0,QString::number(topts[2]/3600.0,'g',2));Offset->setCurrentIndex(0);
+    RetryInterval->setText(QString::number(topts[3]));
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void FtpOptDialog::BtnOkClick()
+void  FtpOptDialog::BtnOkClick()
 {
-    QString PathOffset_Text = PathOffset->currentText();
-    QString Interval_Text = Interval->currentText();
-    QString Offset_Text = Offset->currentText();
-    QString User_Text = User->text(), Passwd_Text = Passwd->text();
-    QString Addr_Text = Addr->currentText(), s;
+    QString PathOffset_Text=PathOffset->currentText();
+    QString Interval_Text=Interval->currentText();
+    QString Offset_Text=Offset->currentText();
+    QString RetryInterval_Text=RetryInterval->text();
+    QString User_Text=User->text(),Passwd_Text=Passwd->text();
+    QString Addr_Text=Addr->currentText(),s;
 	int topts[4];
     bool ok;
-
-    topts[0] = PathOffset_Text.toInt(&ok) * 3600.0;
-    topts[1] = Interval_Text.toInt(&ok) * 3600.0;
-    topts[2] = Offset_Text.toInt(&ok) * 3600.0;
-    topts[3] = RetryInterval->value();
-
-    Path = QString("%1:%2@%3::T=%4,%5,%6,%7").arg(User_Text)
-           .arg(Passwd_Text).arg(Addr_Text)
-           .arg(topts[0]).arg(topts[1]).arg(topts[2]).arg(topts[3]);
-
-    AddHist(Addr, History);
+	
+    topts[0]=PathOffset_Text.toInt(&ok)*3600.0;
+    topts[1]=Interval_Text.toInt(&ok)*3600.0;
+    topts[2]=Offset_Text.toInt(&ok)*3600.0;
+    topts[3]=RetryInterval_Text.toInt(&ok);
+	
+    Path=QString("%1:%2@%3::T=%4,%5,%6,%7").arg(User_Text)
+                   .arg(Passwd_Text).arg(Addr_Text)
+                   .arg(topts[0]).arg(topts[1]).arg(topts[2]).arg(topts[3]);
+	
+	AddHist(Addr,History);
 
     accept();
 }
 //---------------------------------------------------------------------------
-void FtpOptDialog::BtnKeyClick()
+void  FtpOptDialog::BtnKeyClick()
 {
     keyDlg->exec();
 }
 //---------------------------------------------------------------------------
-void FtpOptDialog::AddHist(QComboBox *list, QString *hist)
+void  FtpOptDialog::AddHist(QComboBox *list, QString *hist)
 {
-    for (int i = 0; i < MAXHIST; i++) {
-        if (list->currentText() != hist[i]) continue;
-        for (int j = i + 1; j < MAXHIST; j++) hist[j - 1] = hist[j];
-        hist[MAXHIST - 1] = "";
+	for (int i=0;i<MAXHIST;i++) {
+        if (list->currentText()!=hist[i]) continue;
+		for (int j=i+1;j<MAXHIST;j++) hist[j-1]=hist[j];
+		hist[MAXHIST-1]="";
 	}
-    for (int i = MAXHIST - 1; i > 0; i--) hist[i] = hist[i - 1];
-    hist[0] = list->currentText();
-
+	for (int i=MAXHIST-1;i>0;i--) hist[i]=hist[i-1];
+    hist[0]=list->currentText();
+	
     list->clear();
-    for (int i = 0; i < MAXHIST; i++)
-        if (hist[i] != "") list->addItem(hist[i]);
+	for (int i=0;i<MAXHIST;i++) {
+        if (hist[i]!="") list->addItem(hist[i]);
+	}
 }
 //---------------------------------------------------------------------------
-void FtpOptDialog::UpdateEnable(void)
+void  FtpOptDialog::UpdateEnable(void)
 {
-    User->setEnabled(Opt == 0);
-    Passwd->setEnabled(Opt == 0);
-    LabelUser->setEnabled(Opt == 0);
-    LabelPasswd->setEnabled(Opt == 0);
+    User       ->setEnabled(Opt==0);
+    Passwd     ->setEnabled(Opt==0);
+    LabelUser  ->setEnabled(Opt==0);
+    LabelPasswd->setEnabled(Opt==0);
 }
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/ftpoptdlg.h RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/ftpoptdlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/ftpoptdlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/ftpoptdlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -16,20 +16,17 @@
     Q_OBJECT
 protected:
     void  showEvent(QShowEvent *);
-
 public slots:
     void  BtnOkClick();
     void  BtnKeyClick();
-
 private:
     void  AddHist(QComboBox *list, QString *hist);
     void  UpdateEnable(void);
 
     KeyDialog *keyDlg;
-
 public:
 	int Opt;
-    QString Path, History[MAXHIST], MntpHist[MAXHIST];
+    QString Path,History[MAXHIST],MntpHist[MAXHIST];
     explicit FtpOptDialog(QWidget *parent);
 };
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/ftpoptdlg.ui RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/ftpoptdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/ftpoptdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/ftpoptdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>484</width>
-    <height>245</height>
+    <width>451</width>
+    <height>202</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -17,8 +17,8 @@
    <string/>
   </property>
   <layout class="QGridLayout" name="gridLayout">
-   <item row="6" column="5">
-    <widget class="QPushButton" name="BtnCancel">
+   <item row="0" column="0" colspan="3">
+    <widget class="QLabel" name="Label2">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -26,7 +26,123 @@
       <string/>
      </property>
      <property name="text">
-      <string>&amp;Cancel</string>
+      <string>Download Address (address/file-path)</string>
+     </property>
+    </widget>
+   </item>
+   <item row="0" column="3">
+    <widget class="QPushButton" name="BtnKey">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>?</string>
+     </property>
+     <property name="flat">
+      <bool>true</bool>
+     </property>
+    </widget>
+   </item>
+   <item row="1" column="0" colspan="6">
+    <widget class="QComboBox" name="Addr">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="editable">
+      <bool>true</bool>
+     </property>
+    </widget>
+   </item>
+   <item row="2" column="0">
+    <widget class="QLabel" name="Label1">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>Download Interval</string>
+     </property>
+    </widget>
+   </item>
+   <item row="2" column="1">
+    <widget class="QComboBox" name="Interval">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="editable">
+      <bool>true</bool>
+     </property>
+     <item>
+      <property name="text">
+       <string>0</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>1</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>2</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>3</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>6</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>12</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>24</string>
+      </property>
+     </item>
+    </widget>
+   </item>
+   <item row="2" column="2">
+    <widget class="QLabel" name="Label6">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>H</string>
+     </property>
+    </widget>
+   </item>
+   <item row="2" column="3">
+    <widget class="QLabel" name="LabelUser">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>User</string>
      </property>
     </widget>
    </item>
@@ -262,7 +378,7 @@
      </property>
     </widget>
    </item>
-   <item row="6" column="0">
+   <item row="5" column="0">
     <widget class="QLabel" name="Label4">
      <property name="enabled">
       <bool>true</bool>
@@ -275,59 +391,21 @@
      </property>
     </widget>
    </item>
-   <item row="6" column="3" colspan="2">
-    <widget class="QPushButton" name="BtnOk">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="text">
-      <string>&amp;OK</string>
-     </property>
-     <property name="autoDefault">
-      <bool>true</bool>
-     </property>
-     <property name="default">
-      <bool>true</bool>
-     </property>
-    </widget>
-   </item>
-   <item row="2" column="3">
-    <widget class="QLabel" name="LabelUser">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="text">
-      <string>User</string>
-     </property>
-    </widget>
-   </item>
-   <item row="0" column="0" colspan="3">
-    <widget class="QLabel" name="Label2">
+   <item row="5" column="1">
+    <widget class="QLineEdit" name="RetryInterval">
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
      <property name="text">
-      <string>Download Address (address/file-path)</string>
+      <string>300</string>
      </property>
     </widget>
    </item>
-   <item row="0" column="3">
-    <widget class="QPushButton" name="BtnKey">
+   <item row="5" column="2">
+    <widget class="QLabel" name="Label5">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -335,28 +413,12 @@
       <string/>
      </property>
      <property name="text">
-      <string>?</string>
-     </property>
-     <property name="flat">
-      <bool>true</bool>
-     </property>
-    </widget>
-   </item>
-   <item row="1" column="0" colspan="6">
-    <widget class="QComboBox" name="Addr">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="editable">
-      <bool>true</bool>
+      <string>s</string>
      </property>
     </widget>
    </item>
-   <item row="2" column="0">
-    <widget class="QLabel" name="Label1">
+   <item row="5" column="3" colspan="2">
+    <widget class="QPushButton" name="BtnOk">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -364,60 +426,18 @@
       <string/>
      </property>
      <property name="text">
-      <string>Download Interval</string>
+      <string>&amp;OK</string>
      </property>
-    </widget>
-   </item>
-   <item row="2" column="1">
-    <widget class="QComboBox" name="Interval">
-     <property name="enabled">
+     <property name="autoDefault">
       <bool>true</bool>
      </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="editable">
+     <property name="default">
       <bool>true</bool>
      </property>
-     <item>
-      <property name="text">
-       <string>0</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>1</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>2</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>3</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>6</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>12</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>24</string>
-      </property>
-     </item>
     </widget>
    </item>
-   <item row="2" column="2">
-    <widget class="QLabel" name="Label6">
+   <item row="5" column="5">
+    <widget class="QPushButton" name="BtnCancel">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -425,37 +445,12 @@
       <string/>
      </property>
      <property name="text">
-      <string>H</string>
-     </property>
-    </widget>
-   </item>
-   <item row="6" column="1">
-    <widget class="QSpinBox" name="RetryInterval">
-     <property name="suffix">
-      <string> s</string>
-     </property>
-     <property name="maximum">
-      <number>10000</number>
-     </property>
-     <property name="value">
-      <number>300</number>
+      <string>&amp;Cancel</string>
      </property>
     </widget>
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>BtnKey</tabstop>
-  <tabstop>Addr</tabstop>
-  <tabstop>Interval</tabstop>
-  <tabstop>User</tabstop>
-  <tabstop>Offset</tabstop>
-  <tabstop>Passwd</tabstop>
-  <tabstop>PathOffset</tabstop>
-  <tabstop>RetryInterval</tabstop>
-  <tabstop>BtnOk</tabstop>
-  <tabstop>BtnCancel</tabstop>
- </tabstops>
  <resources/>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/gm_template.h RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/gm_template.h
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/gm_template.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/gm_template.h	1970-01-01 03:00:00.000000000 +0300
@@ -1,127 +0,0 @@
-#ifndef gm_templateH
-#define gm_templateH
-
-#include <QString>
-
-static QString htmlPage =  R"~~~(
-
-<!------------------------------------------------------------------------------
-* rtkplot_gm.htm: rtkplot google map view
-*
-* history: 2013/01/20 1.0  new
-*------------------------------------------------------------------------------>
-<html>
-<head>
-<title>RTKLIB_GM</title>
-
-<script src="http://maps.google.com/maps/api/js?key=_APIKEY_&v=3"
-    type="text/javascript" charset="UTF-8"></script>
-<script type="text/javascript">
-
-var map = null;
-var marks = [];
-var markh = null;
-var markz = 0;
-var info = null;
-var icon0="http://maps.google.co.jp/mapfiles/ms/icons/red-dot.png";
-var icon1="http://maps.google.co.jp/mapfiles/ms/icons/yellow-dot.png";
-
-function init() {
-    var opt = {
-        center: new google.maps.LatLng(0,0),
-        zoom: 2, minZoom: 2,
-        streetViewControl: false,
-        mapTypeId: google.maps.MapTypeId.ROADMAP
-    };
-    map = new google.maps.Map(document.getElementById("map"),opt);
-    document.getElementById('state').value='1';
-}
-
-function SetView(lat,lon,zoom) {
-    if (map == null) return;
-    map.setCenter(new google.maps.LatLng(lat,lon));
-    map.setZoom(zoom);
-}
-
-function SetCent(lat,lon) {
-    if (map == null) return;
-    map.setCenter(new google.maps.LatLng(lat,lon));
-}
-
-function SetZoom(zoom) {
-    if (map == null) return;
-    map.setZoom(zoom);
-}
-
-function ClearMark(lat,lon,title) {
-    for (var i in marks) {
-        marks[i].setMap(null);
-    }
-    marks.length = 0;
-    markh = null;
-}
-
-function AddMark(lat,lon,title,msg) {
-    var pos = new google.maps.LatLng(lat,lon);
-    var opt = {map: map, position: pos, title: title, icon: icon1};
-    var mark = new google.maps.Marker(opt);
-    google.maps.event.addListener(mark,'click',function(event) {
-        if (info) {info.close();}
-        info = new google.maps.InfoWindow({content: msg});
-        info.open(mark.getMap(),mark);
-    });
-    marks.push(mark);
-}
-
-function HighlightMark(title) {
-    if (markh) {
-        markh.setIcon(icon1);
-        markh.setZIndex(markz);
-    }
-    for (var i in marks) {
-        if (marks[i].getTitle()==title) {
-            markz = marks[i].getZIndex();
-            marks[i].setIcon(icon0);
-            marks[i].setZIndex(google.maps.Marker.MAX_ZINDEX+1);
-            markh=marks[i];
-        }
-    }
-}
-
-function PosMark(lat,lon,title) {
-    for (var i in marks) {
-        if (marks[i].title==title) {
-            marks[i].setPosition(new google.maps.LatLng(lat,lon));
-            break;
-        }
-    }
-}
-
-function ShowMark(title) {
-    for (var i in marks) {
-        if (marks[i].title==title) {
-            marks[i].setVisible(true);
-            break;
-        }
-    }
-}
-
-function HideMark(title) {
-    for (var i in marks) {
-        if (marks[i].title==title) {
-            marks[i].setVisible(false);
-            break;
-        }
-    }
-}
-
-</script>
-</head>
-
-<body style="margin: 0;"; scroll="no"; onload="init()">
-    <div id="map" style="height: 100%; width: 100%;"> </div>
-    <input id="state" type="hidden" value="0">
-</body>
-</html>
-)~~~";
-#endif
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/gmview.cpp RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/gmview.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/gmview.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/gmview.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -17,68 +17,70 @@
 #include "gmview.h"
 #include "rtklib.h"
 
-#include "gm_template.h"
+#define RTKLIB_GM_FILE "rtklib_gm.htm"
 
 //---------------------------------------------------------------------------
 GoogleMapView::GoogleMapView(QWidget *parent)
     : QDialog(parent)
 {
-    loaded = false;
+    loaded=false;
     setupUi(this);
 
-    connect(BtnClose, SIGNAL(clicked(bool)), this, SLOT(BtnCloseClick()));
-    connect(BtnShrink, SIGNAL(clicked(bool)), this, SLOT(BtnShrinkClick()));
-    connect(BtnExpand, SIGNAL(clicked(bool)), this, SLOT(BtnExpandClick()));
-    connect(BtnFixCent, SIGNAL(clicked(bool)), this, SLOT(BtnFixCentClick()));
-    connect(&Timer1, SIGNAL(timeout()), this, SLOT(Timer1Timer()));
+    connect(BtnClose,SIGNAL(clicked(bool)),this,SLOT(BtnCloseClick()));
+    connect(BtnShrink,SIGNAL(clicked(bool)),this,SLOT(BtnShrinkClick()));
+    connect(BtnExpand,SIGNAL(clicked(bool)),this,SLOT(BtnExpandClick()));
+    connect(BtnFixCent,SIGNAL(clicked(bool)),this,SLOT(BtnFixCentClick()));
+    connect(&Timer1,SIGNAL(timeout()),this,SLOT(Timer1Timer()));
 
 #ifdef QWEBKIT
     WebBrowser = new QWebView(Panel2);
-    QHBoxLayout *layout = new QHBoxLayout();
+    QHBoxLayout *layout=new QHBoxLayout();
     layout->addWidget(WebBrowser);
     Panel2->setLayout(layout);
 #endif
 #ifdef QWEBENGINE
     WebBrowser = new QWebEngineView(Panel2);
-    QHBoxLayout *layout = new QHBoxLayout();
+    QHBoxLayout *layout=new QHBoxLayout();
     layout->addWidget(WebBrowser);
     Panel2->setLayout(layout);
-    pageState = new GMPageState(this);
+    pageState=new GMPageState(this);
 
-    connect(WebBrowser, SIGNAL(loadFinished(bool)), this, SLOT(PageLoaded(bool)));
+    connect(WebBrowser,SIGNAL(loadFinished(bool)),this,SLOT(PageLoaded(bool)));
 #endif
-    State = 0;
-    Lat = Lon = 0.0;
-    Zoom = 2;
-    FixCent = 1;
-}
+	State=0;
+	Lat=Lon=0.0;
+	Zoom=2;
+    FixCent=1;
 
+    QTimer::singleShot(0,this,SLOT(FormCreate()));
+}
 //---------------------------------------------------------------------------
-int GoogleMapView::setApiKey(QString ApiKey)
+void GoogleMapView::FormCreate()
 {
-    htmlPage.replace("_APIKEY_", ApiKey);
+    QString dir;
+
+    dir=qApp->applicationDirPath(); // exe directory
+    dir=dir+"/"+RTKLIB_GM_FILE;
+
 #ifdef QWEBKIT
     WebBrowser->load(QUrl::fromLocalFile(dir));
     WebBrowser->show();
-    loaded = true;
+    loaded=true;
 #endif
 #ifdef QWEBENGINE
-    WebBrowser->setHtml(htmlPage);
-    QWebChannel *channel = new QWebChannel(this);
-    channel->registerObject(QStringLiteral("state"), pageState);
+    WebBrowser->load(QUrl::fromLocalFile(dir));
+    QWebChannel *channel=new QWebChannel(this);
+    channel->registerObject(QStringLiteral("state"),pageState);
 
     WebBrowser->page()->setWebChannel(channel);
 
     WebBrowser->show();
 #endif
     Timer1.start(300);
-
-    return 0;
 }
 //---------------------------------------------------------------------------
 void GoogleMapView::BtnCloseClick()
 {
-    trace(2,"gmview close\n");
     close();
 }
 //---------------------------------------------------------------------------
@@ -92,65 +94,65 @@
     WebBrowser->page()->runJavaScript(webchannel.readAll());
     WebBrowser->page()->runJavaScript("new QWebChannel(qt.webChannelTransport,function(channel) {channel.objects.state.text=document.getElementById('state').value;});");
 #endif
-    loaded = true;
+    loaded=true;
 }
 //---------------------------------------------------------------------------
 void GoogleMapView::Timer1Timer()
 {
 	if (!GetState()) return;
+	
+    State=1;
 
-    State = 1;
-
-    SetView(Lat, Lon, Zoom);
-
-    AddMark(0.0, 0.0, "SOL1", tr("SOLUTION 1"));
-    AddMark(0.0, 0.0, "SOL2", tr("SOLUTION 2"));
+	SetView(Lat,Lon,Zoom);
+	
+	AddMark(0.0,0.0,"SOL1","SOLUTION 1");
+	AddMark(0.0,0.0,"SOL2","SOLUTION 2");
 
 	HideMark(1);
 	HideMark(2);
 
-    for (int i = 0; i < 2; i++) MarkPos[i][0] = MarkPos[i][1] = 0.0;
+	for (int i=0;i<2;i++) MarkPos[i][0]=MarkPos[i][1]=0.0;
 
     Timer1.stop();
 }
 //---------------------------------------------------------------------------
 void GoogleMapView::BtnShrinkClick()
 {
-    SetZoom(Zoom - 1);
+    SetZoom(Zoom-1);
 }
 //---------------------------------------------------------------------------
 void GoogleMapView::BtnExpandClick()
 {
-    SetZoom(Zoom + 1);
+    SetZoom(Zoom+1);
 }
 //---------------------------------------------------------------------------
 void GoogleMapView::BtnFixCentClick()
 {
-    FixCent = BtnFixCent->isChecked();
-    if (FixCent) SetCent(Lat, Lon);
+    FixCent=BtnFixCent->isChecked();
+    if (FixCent) SetCent(Lat,Lon);
 }
 //---------------------------------------------------------------------------
 void GoogleMapView::resizeEvent(QResizeEvent *)
 {
-    if (FixCent) SetCent(Lat, Lon);
+    if (FixCent) SetCent(Lat,Lon);
 }
 //---------------------------------------------------------------------------
 void GoogleMapView::SetView(double lat, double lon, int zoom)
 {
-    Lat = lat; Lon = lon; Zoom = zoom;
-    ExecFunc(QString("SetView(%1,%2,%3)").arg(lat, 0, 'f', 9).arg(lon, 0, 'f', 9).arg(zoom));
+	Lat=lat; Lon=lon; Zoom=zoom;
+    ExecFunc(QString("SetView(%1,%2,%3)").arg(lat,0,'f',9).arg(lon,0,'f',9).arg(zoom));
 }
 //---------------------------------------------------------------------------
 void GoogleMapView::SetCent(double lat, double lon)
 {
-    Lat = lat; Lon = lon;
-    if (FixCent) ExecFunc(QString("SetCent(%1,%2)").arg(lat, 0, 'f', 9).arg(lon, 0, 'f', 9));
+	Lat=lat; Lon=lon;
+    if (FixCent) ExecFunc(QString("SetCent(%1,%2)").arg(lat,0,'f',9).arg(lon,0,'f',9));
 }
 //---------------------------------------------------------------------------
 void GoogleMapView::SetZoom(int zoom)
 {
-    if (zoom < 2 || zoom > 21) return;
-    Zoom = zoom;
+    if (zoom<2||zoom>21) return;
+	Zoom=zoom;
     ExecFunc(QString("SetZoom(%1)").arg(zoom));
 }
 //---------------------------------------------------------------------------
@@ -160,35 +162,32 @@
 }
 //---------------------------------------------------------------------------
 void GoogleMapView::AddMark(double lat, double lon,
-                const QString &title, const QString &msg)
+    const QString &title, const QString &msg)
 {
-    ExecFunc(QString("AddMark(%1,%2,\"%3\",\"%4\")").arg(lat, 0, 'f', 9).arg(lon, 0, 'f', 9).arg(title).arg(msg));
+    ExecFunc(QString("AddMark(%1,%2,\"%3\",\"%4\")").arg(lat,0,'f',9).arg(lon,0,'f',9).arg(title).arg(msg));
 }
 //---------------------------------------------------------------------------
 void GoogleMapView::SetMark(int index, const double *pos)
 {
     QString title;
-
-    title = QString("SOL%1").arg(index);
-    ExecFunc(QString("PosMark(%1,%2,\"%3\")").arg(pos[0] * R2D, 0, 'f', 9).arg(pos[1] * R2D, 0, 'f', 9).arg(title));
-
-    MarkPos[index - 1][0] = pos[0] * R2D;
-    MarkPos[index - 1][1] = pos[1] * R2D;
+    title=QString("SOL%1").arg(index);
+    ExecFunc(QString("PosMark(%1,%2,\"%3\")").arg(pos[0]*R2D,0,'f',9).arg(pos[1]*R2D,0,'f',9).arg(title));
+	
+	MarkPos[index-1][0]=pos[0]*R2D;
+	MarkPos[index-1][1]=pos[1]*R2D;
 }
 //---------------------------------------------------------------------------
 void GoogleMapView::ShowMark(int index)
 {
     QString title;
-
-    title = QString("SOL%1").arg(index);
+    title=QString("SOL%1").arg(index);
     ExecFunc(QString("ShowMark(\"%1\")").arg(title));
 }
 //---------------------------------------------------------------------------
 void GoogleMapView::HideMark(int index)
 {
     QString title;
-
-    title = QString("SOL%1").arg(index);
+    title=QString("SOL%1").arg(index);
     ExecFunc(QString("HideMark(\"%1\")").arg(title));
 }
 //---------------------------------------------------------------------------
@@ -196,28 +195,28 @@
 {
 #ifdef QWEBKIT
     QWebElement ele;
-    int state = 0;
+    int state=0;
 
     if (!WebBrowser->page()) return 0;
     if (!WebBrowser->page()->mainFrame()) return 0;
 
-    QWebFrame *frame = WebBrowser->page()->mainFrame();
+    QWebFrame *frame=WebBrowser->page()->mainFrame();
 
-    ele = frame->findFirstElement("#state");
+    ele=frame->findFirstElement("#state");
 
     if (ele.isNull()) return 0;
     if (!ele.hasAttribute("value")) return 0;
 
-    state = ele.attribute("value").toInt();
+    state=ele.attribute("value").toInt();
 
 	return state;
 #else
-#ifdef QWEBENGINE
+ #ifdef QWEBENGINE
     if (!loaded) return 0;
     return pageState->getText().toInt();
-#else
+ #else
     return 0;
-#endif
+ #endif
 #endif
 }
 //---------------------------------------------------------------------------
@@ -227,20 +226,20 @@
     if (!WebBrowser->page()) return;
     if (!WebBrowser->page()->mainFrame()) return;
 
-    QWebFrame *frame = WebBrowser->page()->mainFrame();
+    QWebFrame *frame=WebBrowser->page()->mainFrame();
 
     frame->evaluateJavaScript(func);
 #else
-#ifdef QWEBENGINE
+ #ifdef QWEBENGINE
     if (!loaded) return;
 
-    QWebEnginePage *page = WebBrowser->page();
-    if (page == NULL) return;
+    QWebEnginePage *page=WebBrowser->page();
+    if (page==NULL) return;
 
     page->runJavaScript(func);
-#else
+ #else
     Q_UNUSED(func)
-#endif
+ #endif
 #endif
 }
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/gmview.h RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/gmview.h
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/gmview.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/gmview.h	2019-08-19 02:04:50.000000000 +0300
@@ -17,7 +17,7 @@
     Q_OBJECT
     Q_PROPERTY(QString text MEMBER text NOTIFY textChanged)
 public:
-    explicit GMPageState(QObject *parent = NULL): QObject(parent){}
+    explicit GMPageState(QObject *parent=NULL): QObject(parent){}
     QString getText() {return text;}
 signals:
     void textChanged(const QString &text);
@@ -25,7 +25,6 @@
     QString text;
 };
 #endif
-
 class QResizeEvent;
 class QShowEvent;
 //---------------------------------------------------------------------------
@@ -34,6 +33,7 @@
     Q_OBJECT
 
 public slots:
+    void FormCreate();
     void Timer1Timer();
     void BtnShrinkClick();
     void BtnExpandClick();
@@ -46,8 +46,7 @@
 
 private:
 	int State;
-    double Lat,Lon;
-    int Zoom;
+	double Lat,Lon,Zoom;
 	double MarkPos[2][2];
     QTimer Timer1;
     bool loaded;
@@ -63,9 +62,7 @@
 public:
     int FixCent;
 
-    explicit GoogleMapView(QWidget *parent = NULL);
-
-    int setApiKey(QString key);
+    explicit GoogleMapView(QWidget *parent=NULL);
     int  GetState(void);
     void SetView(double lat, double lon, int zoom);
     void SetCent(double lat, double lon);
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/gmview.ui RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/gmview.ui
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/gmview.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/gmview.ui	2019-08-19 02:04:50.000000000 +0300
@@ -53,6 +53,9 @@
       <string/>
      </property>
      <layout class="QHBoxLayout" name="horizontalLayout">
+      <property name="spacing">
+       <number>0</number>
+      </property>
       <property name="leftMargin">
        <number>0</number>
       </property>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/graph.cpp RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/graph.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/graph.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/graph.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -23,237 +23,228 @@
 Graph::Graph(QPaintDevice *parent)
 {
     QPoint point;
+    Parent=parent;
+    X=Y=0;
+    SetSize(parent->width(),parent->height());
 
-    Parent = parent;
-    X = Y = 0;
-    SetSize(parent->width(), parent->height());
-
-    XCent = YCent = 0.0;            // center coordinate (unit)
-    XScale = YScale = 0.02;         // scale factor (unit/pixel)
-    Box = 1;                        // show box (0:off,1:on)
-    Fit = 1;                        // fit scale on resize (0:off,1:on):
-    XGrid = YGrid = 1;              // show grid (0:off,1:on)
-    XTick = YTick = 0.0;            // grid interval (unit) (0:auto)
-    XLPos = YLPos = 1;              // grid label pos (0:off,1:outer,2:inner,
-                                    // 3:outer-rot,4:inner-rot,5/6:time,7:axis)
-    Week = 0;                       // gpsweek no. for time label
-    Title = XLabel = YLabel = "";   // lable string ("":no label)
-    Color[0] = Qt::black;           // background color
-    Color[1] = Qt::gray;            // grid color
-    Color[2] = Qt::black;           // title/label color
-
-    p_ = point; mark_ = 0; color_ = Qt::black; size_ = 0; rot_ = 0;
+	XCent =YCent =0.0;			// center coordinate (unit)
+	XScale=YScale=0.02; 		// scale factor (unit/pixel)
+	Box=1;						// show box (0:off,1:on)
+	Fit=1;						// fit scale on resize (0:off,1:on):
+	XGrid=YGrid=1;				// show grid (0:off,1:on)
+	XTick=YTick=0.0;			// grid interval (unit) (0:auto)
+	XLPos=YLPos=1;				// grid label pos (0:off,1:outer,2:inner,
+								// 3:outer-rot,4:inner-rot,5/6:time,7:axis)
+	Week=0;						// gpsweek no. for time label
+	Title=XLabel=YLabel="";		// lable string ("":no label)
+    Color[0]=Qt::black;         // background color
+    Color[1]=Qt::gray;			// grid color
+    Color[2]=Qt::black;			// title/label color
+	
+    p_=point; mark_=0; color_=Qt::black; size_=0; rot_=0;
 }
 // --------------------------------------------------------------------------
 void Graph::SetSize(int width, int height)
 {
-    Width = width;
-    Height = height;
+    Width =width;
+    Height=height;
 }
 // --------------------------------------------------------------------------
 int Graph::IsInArea(QPoint &p)
 {
-    return X <= p.x() && p.x() < X + Width && Y <= p.y() && p.y() < Y + Height;
+    return X<=p.x()&&p.x()<X+Width&&Y<=p.y()&&p.y()<Y+Height;
 }
 //---------------------------------------------------------------------------
-int Graph::ToPoint(const double &x, const double &y, QPoint &p)
+int Graph::ToPoint(double x, double y, QPoint &p)
 {
-    const double xt = 0.1;
-
-    p.setX(int((X + (Width - 1) / 2.0 + (x - XCent) / XScale) + 0.5));
-    p.setY(int((Y + (Height - 1) / 2.0 - (y - YCent) / YScale) + 0.5));
-    return (X - xt < x) && (x < X + Width - 1 + xt) && (Y - xt < y) && (y < Y + Height - 1 + xt);
+	const double xt=0.1;
+	x=X+(Width-1)/2.0+(x-XCent)/XScale;
+	y=Y+(Height-1)/2.0-(y-YCent)/YScale;
+    p.setX((int)floor(x+0.5)); p.setY((int)floor(y+0.5));
+    return (X-xt<x)&&(x<X+Width-1+xt)&&(Y-xt<y)&&(y<Y+Height-1+xt);
 }
 //---------------------------------------------------------------------------
 void Graph::resize()
 {
-    Width = Parent->width(); Height = Parent->height();
+    Width=Parent->width(); Height=Parent->height();
 }
 //---------------------------------------------------------------------------
 void Graph::ToPos(const QPoint &p, double &x, double &y)
 {
-    x = XCent + (p.x() - X - (Width - 1) / 2.0) * XScale;
-    y = YCent - (p.y() - Y - (Height - 1) / 2.0) * YScale;
+    x=XCent+(p.x()-X-(Width-1)/2.0)*XScale;
+    y=YCent-(p.y()-Y-(Height-1)/2.0)*YScale;
 }
 //---------------------------------------------------------------------------
 void Graph::SetPos(const QPoint &p1, const QPoint &p2)
 {
-    int w = p2.x() - p1.x() + 1, h = p2.y() - p1.y() + 1;
-
-    if (w < MINSIZE) w = MINSIZE;
-    if (h < MINSIZE) h = MINSIZE;
+    int w=p2.x()-p1.x()+1,h=p2.y()-p1.y()+1;
+    if (w<MINSIZE) w=MINSIZE;
+    if (h<MINSIZE) h=MINSIZE;
 	if (Fit) {
-        XScale *= (double)(Width - 1) / (w - 1);
-        YScale *= (double)(Height - 1) / (h - 1);
+		XScale*=(double)(Width-1)/(w-1);
+		YScale*=(double)(Height-1)/(h-1);
 	}
-    X = p1.x(); Y = p1.y(); Width = w; Height = h;
+    X=p1.x(); Y=p1.y(); Width=w; Height=h;
 }
 //---------------------------------------------------------------------------
 void Graph::GetPos(QPoint &p1, QPoint &p2)
 {
     p1.setX(X);
     p1.setY(Y);
-    p2.setX(X + Width - 1);
-    p2.setY(Y + Height - 1);
+    p2.setX(X+Width-1);
+    p2.setY(Y+Height-1);
 }
 //---------------------------------------------------------------------------
 void Graph::SetCent(double x, double y)
 {
-    XCent = x; YCent = y;
+	XCent=x; YCent=y;
 }
 //---------------------------------------------------------------------------
 void Graph::GetCent(double &x, double &y)
 {
-    x = XCent; y = YCent;
+	x=XCent; y=YCent;
 }
 //---------------------------------------------------------------------------
 void Graph::SetRight(double x, double y)
 {
 //	XCent=x-(double)(Width-1)*XScale*0.5; YCent=y;
-    XCent = x - (double)(Width - 13) * XScale * 0.5; YCent = y;
+	XCent=x-(double)(Width-13)*XScale*0.5; YCent=y;
 }
 //---------------------------------------------------------------------------
 void Graph::GetRight(double &x, double &y)
 {
 //	x=XCent+(double)(Width-1)*XScale*0.5; y=YCent;
-    x = XCent + (double)(Width - 13) * XScale * 0.5; y = YCent;
+	x=XCent+(double)(Width-13)*XScale*0.5; y=YCent;
 }
 //---------------------------------------------------------------------------
 void Graph::SetScale(double xs, double ys)
 {
-    if (xs < MINSCALE) xs = MINSCALE; else if (MAXSCALE < xs) xs = MAXSCALE;
-    if (ys < MINSCALE) ys = MINSCALE; else if (MAXSCALE < ys) ys = MAXSCALE;
-    XScale = xs; YScale = ys;
+	if (xs<MINSCALE) xs=MINSCALE; else if (MAXSCALE<xs) xs=MAXSCALE;
+	if (ys<MINSCALE) ys=MINSCALE; else if (MAXSCALE<ys) ys=MAXSCALE;
+	XScale=xs; YScale=ys;
 }
 //---------------------------------------------------------------------------
 void Graph::GetScale(double &xs, double &ys)
 {
-    xs = XScale; ys = YScale;
+	xs=XScale; ys=YScale;
 }
 //---------------------------------------------------------------------------
 void Graph::SetLim(const double *xl, const double *yl)
 {
-    if (xl[0] < xl[1]) {
-        XCent = (xl[0] + xl[1]) / 2.0; XScale = (xl[1] - xl[0]) / (Width - 1);
-    }
-    if (yl[0] < yl[1]) {
-        YCent = (yl[0] + yl[1]) / 2.0; YScale = (yl[1] - yl[0]) / (Height - 1);
-    }
+	if (xl[0]<xl[1]) {XCent=(xl[0]+xl[1])/2.0; XScale=(xl[1]-xl[0])/(Width-1);}
+	if (yl[0]<yl[1]) {YCent=(yl[0]+yl[1])/2.0; YScale=(yl[1]-yl[0])/(Height-1);}
 }
 //---------------------------------------------------------------------------
 void Graph::GetLim(double *xl, double *yl)
 {
-    QPoint p0(X, Y), p1(X + Width - 1, Y + Height - 1);
-
-    ToPos(p0, xl[0], yl[1]); ToPos(p1, xl[1], yl[0]);
+    QPoint p0(X,Y),p1(X+Width-1,Y+Height-1);
+	ToPos(p0,xl[0],yl[1]); ToPos(p1,xl[1],yl[0]);
 }
 //---------------------------------------------------------------------------
 void Graph::SetTick(double xt, double yt)
 {
-    XTick = xt; YTick = yt;
+	XTick=xt; YTick=yt;
 }
 //---------------------------------------------------------------------------
 void Graph::GetTick(double &xt, double &yt)
 {
-    xt = XTick > 0.0 ? XTick : (XLPos == 5 || XLPos == 6 ? AutoTickTime(XScale) : AutoTick(XScale));
-    yt = YTick > 0.0 ? YTick : AutoTick(YScale);
+	xt=XTick>0.0?XTick:(XLPos==5||XLPos==6?AutoTickTime(XScale):AutoTick(XScale));
+	yt=YTick>0.0?YTick:AutoTick(YScale);
 }
 //---------------------------------------------------------------------------
 double Graph::AutoTick(double scale)
 {
-    double t[] = { 1.0, 2.0, 5.0, 10.0 }, tick = 30.0 * scale;
-    double order = pow(10.0, floor(log10(tick)));
-
-    for (int i = 0; i < 4; i++) if (tick <= t[i] * order) return t[i] * order;
+	double t[]={1.0,2.0,5.0,10.0},tick=30.0*scale;
+	double order=pow(10.0,floor(log10(tick)));
+	for (int i=0;i<4;i++) if (tick<=t[i]*order) return t[i]*order;
 	return 10.0;
 }
 //---------------------------------------------------------------------------
 double Graph::AutoTickTime(double scale)
 {
-    const double t[] = { 0.1,	     0.2,     0.5,     1.0,	3.0,	 6.0,	      12.0,	   30.0,	 60.0, 300.0, 900.0, 1800.0, 3600.0,
-                         7200.0,	     10800.0, 21600.0, 43200.0, 86400.0, 86400.0 * 2, 86400.0 * 7, 86400.0 * 14,
-                         86400.0 * 35, 86400.0 * 70 };
-    double tick = 60.0 * scale;
-
-    for (int i = 0; i < (int)(sizeof(t) / sizeof(*t)); i++) if (tick <= t[i]) return t[i];
-    return 86400.0 * 140;
+	double t[]={0.1,0.2,0.5,1.0,3.0,6.0,12.0,30.0,60.0,300.0,900.0,1800.0,3600.0,
+		7200.0,10800.0,21600.0,43200.0,86400.0,86400.0*2,86400.0*7,86400.0*14,
+		86400.0*35,86400.0*70};
+	double tick=60.0*scale;
+	for (int i=0;i<(int)(sizeof(t)/sizeof(*t));i++) if (tick<=t[i]) return t[i];
+	return 86400.0*140;
 }
 //---------------------------------------------------------------------------
 QString Graph::NumText(double x, double dx)
 {
-    int n = (int)(0.9 - log10(dx));
-
-    return QString("%1").arg(x, n < 0 ? 0 : n);
+	int n=(int)(0.9-log10(dx));
+    return QString("%1").arg(x,n<0?0:n);
 }
 //---------------------------------------------------------------------------
 QString Graph::TimeText(double x, double dx)
 {
     char str[64];
-
-    time2str(gpst2time(Week, x), str, 1);
-    int b = dx < 86400.0 ? 11 : (dx < 86400.0 * 30 ? 5 : 2), w = dx < 60.0 ? (dx < 1.0 ? 10 : 8) : 5;
-    return QString("%1").arg(str + b, w);
+    time2str(gpst2time(Week,x),str,1);
+    int b=dx<86400.0?11:(dx<86400.0*30?5:2),w=dx<60.0?(dx<1.0?10:8):5;
+    return QString("%1").arg(str+b,w);
 }
 //---------------------------------------------------------------------------
-void Graph::DrawGrid(QPainter &c, double xt, double yt)
+void Graph::DrawGrid(QPainter &c,double xt, double yt)
 {
-    double xl[2], yl[2];
+	double xl[2],yl[2];
     QPoint p;
-    QPen pen = c.pen();
+    QPen pen=c.pen();
 
-    GetLim(xl, yl);
+	GetLim(xl,yl);
     pen.setColor(Color[1]);
     c.setPen(pen);
     c.setBrush(Qt::NoBrush);
 	if (XGrid) {
-        for (int i = (int)ceil(xl[0] / xt); i * xt <= xl[1]; i++) {
-            ToPoint(i * xt, 0.0, p);
-            pen.setStyle(i != 0 ? Qt::DotLine : Qt::SolidLine); c.setPen(pen);
-            c.drawLine(p.x(), Y, p.x(), Y + Height - 1);
+		for (int i=(int)ceil(xl[0]/xt);i*xt<=xl[1];i++) {
+			ToPoint(i*xt,0.0,p);
+            pen.setStyle(i!=0?Qt::DotLine:Qt::SolidLine);c.setPen(pen);
+            c.drawLine(p.x(),Y,p.x(),Y+Height-1);
 		}
 	}
 	if (YGrid) {
-        for (int i = (int)ceil(yl[0] / yt); i * yt <= yl[1]; i++) {
-            ToPoint(0.0, i * yt, p);
-            pen.setStyle(i != 0 ? Qt::DotLine : Qt::SolidLine); c.setPen(pen);
-            c.drawLine(X, p.y(), X + Width - 1, p.y());
+		for (int i=(int)ceil(yl[0]/yt);i*yt<=yl[1];i++) {
+			ToPoint(0.0,i*yt,p);
+            pen.setStyle(i!=0?Qt::DotLine:Qt::SolidLine);c.setPen(pen);
+            c.drawLine(X,p.y(),X+Width-1,p.y());
 		}
 	}
-    DrawMark(c, 0.0, 0.0, 0, Color[1], SIZEORIGIN, 0);
+    DrawMark(c,0.0,0.0,0,Color[1],SIZEORIGIN,0);
 }
 //---------------------------------------------------------------------------
 void Graph::DrawGridLabel(QPainter &c, double xt, double yt)
 {
-    double xl[2], yl[2];
+	double xl[2],yl[2];
     QPoint p;
-
-    GetLim(xl, yl);
+	GetLim(xl,yl);
 	if (XLPos) {
-        for (int i = (int)ceil(xl[0] / xt); i * xt <= xl[1]; i++) {
-            if (XLPos <= 4) {
-                ToPoint(i * xt, yl[0], p); if (XLPos == 1) p.setY(p.y() - 1);
-                int ha = XLPos <= 2 ? 0 : (XLPos == 3 ? 2 : 1), va = XLPos >= 3 ? 0 : (XLPos == 1 ? 2 : 1);
-                DrawText(c, p, NumText(i * xt, xt), Color[2], ha, va, XLPos >= 3 ? 90 : 0);
-            } else if (XLPos == 6) {
-                ToPoint(i * xt, yl[0], p);
-                DrawText(c, p, TimeText(i * xt, xt), Color[2], 0, 2, 0);
-            } else if (XLPos == 7) {
-                if (i == 0) continue;
-                ToPoint(i * xt, 0.0, p);
-                DrawText(c, p, NumText(i * xt, xt), Color[2], 0, 2, 0);
+		for (int i=(int)ceil(xl[0]/xt);i*xt<=xl[1];i++) {
+			if (XLPos<=4) {
+                ToPoint(i*xt,yl[0],p); if (XLPos==1) p.setY(p.y()-1);
+				int ha=XLPos<=2?0:(XLPos==3?2:1),va=XLPos>=3?0:(XLPos==1?2:1);
+                DrawText(c,p,NumText(i*xt,xt),Color[2],ha,va,XLPos>=3?90:0);
+			}
+			else if (XLPos==6) {
+				ToPoint(i*xt,yl[0],p);
+                DrawText(c,p,TimeText(i*xt,xt),Color[2],0,2,0);
+			}
+			else if (XLPos==7) {
+				if (i==0) continue;
+				ToPoint(i*xt,0.0,p);
+                DrawText(c, p,NumText(i*xt,xt),Color[2],0,2,0);
 			}
 		}
 	}
 	if (YLPos) {
-        for (int i = (int)ceil(yl[0] / yt); i * yt <= yl[1]; i++) {
-            if (YLPos <= 4) {
-                ToPoint(xl[0], i * yt, p);
-                int ha = YLPos >= 3 ? 0 : (YLPos == 1 ? 2 : 1), va = YLPos <= 2 ? 0 : (YLPos == 3 ? 1 : 2);
-                DrawText(c, p, NumText(i * yt, yt), Color[2], ha, va, YLPos >= 3 ? 90 : 0);
-            } else if (YLPos == 7) {
-                if (i == 0) continue;
-                ToPoint(0.0, i * yt, p); p.setX(p.x() + 2);
-                DrawText(c, p, NumText(i * yt, yt), Color[2], 1, 0, 0);
+		for (int i=(int)ceil(yl[0]/yt);i*yt<=yl[1];i++) {
+			if (YLPos<=4) {
+				ToPoint(xl[0],i*yt,p);
+				int ha=YLPos>=3?0:(YLPos==1?2:1),va=YLPos<=2?0:(YLPos==3?1:2);
+                DrawText(c, p,NumText(i*yt,yt),Color[2],ha,va,YLPos>=3?90:0);
+			}
+			else if (YLPos==7) {
+				if (i==0) continue;
+                ToPoint(0.0,i*yt,p); p.setX(p.x()+2);
+                DrawText(c, p,NumText(i*yt,yt),Color[2],1,0,0);
 			}
 		}
 	}
@@ -262,48 +253,47 @@
 void Graph::DrawBox(QPainter &c)
 {
 	if (Box) {
-        QPen pen = c.pen();
+        QPen pen=c.pen();
         pen.setColor(Color[1]);
         pen.setStyle(Qt::SolidLine);
         c.setPen(pen);
         c.setBrush(Qt::NoBrush);
 
-        c.drawRect(X, Y, Width - 1, Height - 1);
+        c.drawRect(X,Y,Width-1,Height-1);
 	}
 }
 //---------------------------------------------------------------------------
 void Graph::DrawLabel(QPainter &c)
 {
-    if (XLabel != "") {
-        QPoint p(X + Width / 2, Y + Height + ((XLPos % 2) ? 10 : 2));
-        DrawText(c, p, XLabel, Color[2], 0, 2, 0);
+	if (XLabel!="") {
+        QPoint p(X+Width/2,Y+Height+((XLPos%2)?10:2));
+        DrawText(c,p,XLabel,Color[2],0,2,0);
 	}
-    if (YLabel != "") {
-        QPoint p(X - ((YLPos % 2) ? 20 : 2), Y + Height / 2);
-        DrawText(c, p, YLabel, Color[2], 0, 1, 90);
+	if (YLabel!="") {
+        QPoint p(X-((YLPos%2)?20:2),Y+Height/2);
+        DrawText(c,p,YLabel,Color[2],0,1,90);
 	}
-    if (Title != "") {
-        QPoint p(X + Width / 2, Y - 1);
-        DrawText(c, p, Title, Color[2], 0, 1, 0);
+	if (Title!="") {
+        QPoint p(X+Width/2,Y-1);
+        DrawText(c,p,Title,Color[2],0,1,0);
 	}
 }
 //---------------------------------------------------------------------------
-void Graph::DrawAxis(QPainter &c, int label, int glabel)
+void Graph::DrawAxis(QPainter &c,int label, int glabel)
 {
-    double xt, yt;
-
-    GetTick(xt, yt);
-    QPen pen = c.pen();
+	double xt,yt;
+	GetTick(xt,yt);
+    QPen pen=c.pen();
 
     pen.setColor(Color[0]);
     c.setPen(pen);
     c.setBrush(Color[0]);
 
-    DrawGrid(c, xt, yt);
+    DrawGrid(c, xt,yt);
 
-    if (xt / XScale < 50.0 && XLPos <= 2) xt *= XLPos == 5 ? 4.0 : 2.0;
-    if (yt / YScale < 50.0 && YLPos >= 3) yt *= 2.0;
-    if (glabel) DrawGridLabel(c, xt, yt);
+	if (xt/XScale<50.0&&XLPos<=2) xt*=XLPos==5?4.0:2.0;
+	if (yt/YScale<50.0&&YLPos>=3) yt*=2.0;
+    if (glabel) DrawGridLabel(c, xt,yt);
 
     DrawBox(c);
 
@@ -312,291 +302,285 @@
 //---------------------------------------------------------------------------
 void Graph::RotPoint(QPoint *ps, int n, const QPoint &pc, int rot, QPoint *pr)
 {
-    for (int i = 0; i < n; i++) {
-        pr[i].setX(pc.x() + (int)floor(ps[i].x() * cos(rot * D2R) - ps[i].y() * sin(rot * D2R) + 0.5));
-        pr[i].setY(pc.y() - (int)floor(ps[i].x() * sin(rot * D2R) + ps[i].y() * cos(rot * D2R) + 0.5));
+	for (int i=0;i<n;i++) {
+        pr[i].setX(pc.x()+(int)floor(ps[i].x()*cos(rot*D2R)-ps[i].y()*sin(rot*D2R)+0.5));
+        pr[i].setY(pc.y()-(int)floor(ps[i].x()*sin(rot*D2R)+ps[i].y()*cos(rot*D2R)+0.5));
 	}
 }
 //---------------------------------------------------------------------------
-void Graph::DrawMark(QPainter &c, const QPoint &p, int mark, const QColor &color, int size, int rot)
+void Graph::DrawMark(QPainter &c,const QPoint &p, int mark, const QColor &color, int size, int rot)
 {
 	// mark = mark ( 0: dot  (.), 1: circle (o),  2: rect  (#), 3: cross (x)
 	//               4: line (-), 5: plus   (+), 10: arrow (->),
 	//              11: hscale,  12: vscale,     13: compass)
 	// rot  = rotation angle (deg)
-
+	
 	// if the same mark already drawn, skip it
-#if 0
-    if (p == p_ && mark == mark_ && color == color_ && size == size_ &&
-        rot == rot_)
+    if (p==p_&&mark==mark_&&color==color_&&size==size_&&
+		rot==rot_) {
 		return;
-    p_ = p; mark_ = mark; color_ = color; size_ = size; rot_ = rot;
-#endif
-
-    if (size < 1) size = 1;
-    int n, s = size / 2;
-    int x1 = p.x() - s, w1 = size + 1, y1 = p.y() - s, h1 = size + 1;
-    int xs1[] = { -7, 0, -7, 0 }, ys1[] = { 2, 0, -2, 0 };
-    int xs2[] = { -1, -1, -1, 1, 1, 1 }, ys2[] = { -1, 1, 0, 0, -1, 1 };
-    int xs3[] = { 3, -4, 0, 0, 0, -8, 8 }, ys3[] = { 0, 5, 20, -20, -10, -10, -10 };
-    int xs4[] = { 0, 0, 0, 1, -1}, ys4[] = { 1, -1, 0, 0, 0};
-    QPoint ps[32], pr[32], pd(0, size / 2 + 12), pt;
+	}
+	p_=p; mark_=mark; color_=color; size_=size; rot_=rot;
+	
+	if (size<1) size=1;
+	int n,s=size/2;
+    int x1=p.x()-s,w1=size+1,y1=p.y()-s,h1=size+1;
+	int xs1[]={-7,0,-7,0},ys1[]={2,0,-2,0};
+	int xs2[]={-1,-1,-1,1,1,1},ys2[]={-1,1,0,0,-1,1};
+	int xs3[]={3,-4,0,0,0,-8,8},ys3[]={0,5,20,-20,-10,-10,-10};
+    QPoint ps[32],pr[32],pd(0,size/2+12),pt;
 
-    QPen pen = c.pen();
+    QPen pen=c.pen();
     pen.setColor(color);
     c.setPen(pen);
     QBrush brush(color);
 
 	switch (mark) {
-    case 0:         // dot
-        brush.setStyle(Qt::SolidPattern);
-        c.setBrush(brush);
+		case 0: // dot
+            brush.setStyle(Qt::SolidPattern);
+            c.setBrush(brush);
 
-        c.drawEllipse(x1, y1, w1, h1);
-        return;
-    case 1:         // circle
-        brush.setStyle(Qt::NoBrush);
-        c.setBrush(brush);
+            c.drawEllipse(x1,y1,w1,h1);
+			return;
+		case 1: // circle
+            brush.setStyle(Qt::NoBrush);
+            c.setBrush(brush);
 
-        c.drawEllipse(x1, y1, w1, h1);
-        return;
-    case 2:         // rectangle
-        brush.setStyle(Qt::NoBrush);
-        c.setBrush(brush);
+            c.drawEllipse(x1,y1,w1,h1);
+			return;
+		case 2: // rectangle
+            brush.setStyle(Qt::NoBrush);
+            c.setBrush(brush);
 
-        c.drawRect(x1, y1, w1, h1);
-        return;
-    case 3:         // cross
-        brush.setStyle(Qt::NoBrush);
-        c.setBrush(brush);
+            c.drawRect(x1,y1,w1,h1);
+			return;
+		case 3: // cross
+            brush.setStyle(Qt::NoBrush);
+            c.setBrush(brush);
 
-        c.drawLine(x1, y1, x1 + w1, y1 + h1);
-        c.drawLine(x1, y1 + h1, x1 + w1, y1);
-        return;
-    case 4:         // line
-        n = 2;
-        ps[0].setX(ps[0].x() - size / 2); ps[0].setY(0); ps[1].setX(size / 2); ps[1].setY(0);
-        break;
-    case 5:         // plus
-#if 0
-        brush.setStyle(Qt::NoBrush);
-        c.setBrush(brush);
+            c.drawLine(x1,y1,x1+w1,y1+h1);
+            c.drawLine(x1,y1+h1,x1+w1,y1);
+			return;
+		case 4: // line
+			n=2;
+            ps[0].setX(ps[0].x()-size/2); ps[0].setY(0); ps[1].setX(size/2); ps[1].setY(0);
+			break;
+		case 5: // plus
+            brush.setStyle(Qt::NoBrush);
+            c.setBrush(brush);
 
-        c.drawLine(x1, p.y(), x1 + w1, p.y());
-        c.drawLine(p.x(), y1 + h1, p.x(), y1);
-        return;
-#else
-        n=5;
-        for (int i=0;i<n;i++) {
-            ps[i].setX(xs4[i] * s); ps[i].setY(ys4[i] * s);
-        }
-        break;
-#endif
-    case 10:         // arrow
-        n = 6;
-        ps[0].setX(ps[0].x() - size / 2); ps[0].setY(0); ps[1].setX(size / 2); ps[1].setY(0);
-        for (int i = 2; i < n; i++) {
-            ps[i].setX(size / 2 + xs1[i - 2]); ps[i].setY(ys1[i - 2]);
-        }
-        break;
-    case 11:        // hscale
-    case 12:        // vscale
-        n = 6;
-        for (int i = 0; i < n; i++) {
-            int x = xs2[i] * size / 2, y = ys2[i] * 5;
-            ps[i].setX(mark == 11 ? x : y); ps[i].setY(mark == 11 ? y : x);
-        }
-        break;
-    case 13:         // compass
-        n = 7;
-        for (int i = 0; i < n; i++) {
-            ps[i].setX(xs3[i] * size / 40); ps[i].setY(ys3[i] * size / 40);
-        }
-        RotPoint(&pd, 1, p, rot, &pt);
-        DrawText(c, pt, "N", color, 0, 0, rot);
-        break;
-    default:
-        return;
+            c.drawLine(x1,p.y(),x1+w1,p.y());
+            c.drawLine(p.x(),y1+h1,p.x(),y1);
+			return;
+		case 10: // arrow
+			n=6;
+            ps[0].setX(ps[0].x()-size/2); ps[0].setY(0); ps[1].setX(size/2); ps[1].setY(0);
+			for (int i=2;i<n;i++) {
+                ps[i].setX(size/2+xs1[i-2]); ps[i].setY(ys1[i-2]);
+			}
+			break;
+		case 11: // hscale
+		case 12: // vscale
+			n=6;
+			for (int i=0;i<n;i++) {
+				int x=xs2[i]*size/2,y=ys2[i]*5;
+                ps[i].setX(mark==11?x:y); ps[i].setY(mark==11?y:x);
+			}
+			break;
+		case 13: // compass
+			n=7;
+			for (int i=0;i<n;i++) {
+                ps[i].setX(xs3[i]*size/40); ps[i].setY(ys3[i]*size/40);
+			}
+            RotPoint(&pd,1,p,rot,&pt);
+            DrawText(c, pt,"N",color,0,0,rot);
+			break;
+		default:
+			return;
 	}
     brush.setStyle(Qt::NoBrush);
     c.setBrush(brush);
 
-    RotPoint(ps, n, p, rot, pr);
+    RotPoint(ps,n,p,rot,pr);
 
-    DrawPoly(c, pr, n, color, 0);
+    DrawPoly(c,pr,n,color,0);
 }
 //---------------------------------------------------------------------------
-void Graph::DrawMark(QPainter &c, double x, double y, int mark, const QColor &color, int size, int rot)
+void Graph::DrawMark(QPainter &c,double x, double y, int mark, const QColor &color, int size,int rot)
 {
     QPoint p;
-
-    if (ToPoint(x, y, p)) DrawMark(c, p, mark, color, size, rot);
+    if (ToPoint(x,y,p)) DrawMark(c, p,mark,color,size,rot);
 }
 //---------------------------------------------------------------------------
-void Graph::DrawMark(QPainter &c, const QPoint &p, int mark, const QColor &color, const QColor &bgcolor, int size, int rot)
+void Graph::DrawMark(QPainter &c,const QPoint &p, int mark, const QColor &color, const QColor &bgcolor, int size, int rot)
 {
     QPoint p1;
 
-    p1 = p; p1.setX(p1.x() - 1); DrawMark(c, p1, mark, bgcolor, size, rot); // draw with hemming
-    p1 = p; p1.setX(p1.x() + 1); DrawMark(c, p1, mark, bgcolor, size, rot);
-    p1 = p; p1.setY(p1.y() - 1); DrawMark(c, p1, mark, bgcolor, size, rot);
-    p1 = p; p1.setY(p1.y() + 1); DrawMark(c, p1, mark, bgcolor, size, rot);
+    p1=p; p1.setX(p1.x()-1); DrawMark(c,p1,mark,bgcolor,size,rot); // draw with hemming
+    p1=p; p1.setX(p1.x()+1); DrawMark(c,p1,mark,bgcolor,size,rot);
+    p1=p; p1.setY(p1.y()-1); DrawMark(c,p1,mark,bgcolor,size,rot);
+    p1=p; p1.setY(p1.y()+1); DrawMark(c,p1,mark,bgcolor,size,rot);
 
-    DrawMark(c, p, mark, color, size, rot);
+    DrawMark(c,p,mark,color,size,rot);
 }
 //---------------------------------------------------------------------------
-void Graph::DrawMark(QPainter &c, double x, double y, int mark, const QColor &color, const QColor &bgcolor, int size, int rot)
+void Graph::DrawMark(QPainter &c,double x, double y, int mark, const QColor &color, const QColor &bgcolor, int size, int rot)
 {
     QPoint p;
-
-    if (ToPoint(x, y, p)) DrawMark(c, p, mark, color, bgcolor, size, rot);
+    if (ToPoint(x,y,p)) DrawMark(c,p,mark,color,bgcolor,size,rot);
 }
 //---------------------------------------------------------------------------
-void Graph::DrawMarks(QPainter &c, const double *x, const double *y, const QVector<QColor> &colors,
-              int n, int mark, int size, int rot)
+void Graph::DrawMarks(QPainter &c,const double *x, const double *y, const QVector<QColor> &colors,
+					   int n, int mark, int size, int rot)
 {
-    QPoint p, pp;
-
-    for (int i = 0; i < n; i++) {
-        if (!ToPoint(x[i], y[i], p) || (pp == p)) continue;
-        DrawMark(c, p, mark, colors.at(i), size, rot);
-        pp = p;
+    QPoint p,pp;
+	for (int i=0;i<n;i++) {
+        if (!ToPoint(x[i],y[i],p)||(pp==p)) continue;
+        DrawMark(c,p,mark,colors.at(i),size,rot);
+		pp=p;
 	}
 }
 //---------------------------------------------------------------------------
-void Graph::DrawText(QPainter &c, const QPoint &p, const QString &str, const QColor &color, int ha, int va,
-             int rot)
+void Graph::DrawText(QPainter &c,const QPoint &p, const QString &str, const QColor &color, int ha, int va,
+	int rot)
 {
 	// str = UTF-8 string
 	// ha  = horizontal alignment (0: center, 1: left,   2: right)
 	// va  = vertical alignment   (0: center, 1: bottom, 2: top  )
 	// rot = rotation angle (deg)
-    int flags = 0;
 
-    switch (ha) {
-        case 0: flags |= Qt::AlignHCenter; break;
-        case 1: flags |= Qt::AlignLeft; break;
-        case 2: flags |= Qt::AlignRight; break;
+	
+    int flags=0;
+    switch (ha)
+    {
+        case 0: flags|=Qt::AlignHCenter;break;
+        case 1: flags|=Qt::AlignLeft;break;
+        case 2: flags|=Qt::AlignRight;break;
     }
-    switch (va) {
-        case 0: flags |= Qt::AlignVCenter; break;
-        case 1: flags |= Qt::AlignBottom; break;
-        case 2: flags |= Qt::AlignTop; break;
+    switch (va)
+    {
+        case 0: flags|=Qt::AlignVCenter;break;
+        case 1: flags|=Qt::AlignBottom;break;
+        case 2: flags|=Qt::AlignTop;break;
     }
 
-    QRectF off = c.boundingRect(QRectF(), flags, str);
+    QRectF off=c.boundingRect(QRectF(),flags,str);
 
-    QPen pen = c.pen();
+    QPen pen=c.pen();
     c.setBrush(Qt::NoBrush);
     pen.setColor(color);
     c.setPen(pen);
 
     c.translate(p);
     c.rotate(-rot);
-    c.drawText(off, str);
+    c.drawText(off,str);
     c.rotate(rot);
     c.translate(-p);
 }
 //---------------------------------------------------------------------------
-void Graph::DrawText(QPainter &c, double x, double y, const QString &str, const QColor &color,
-             int ha, int va, int rot)
+void Graph::DrawText(QPainter &c,double x, double y, const QString &str, const QColor &color,
+	int ha, int va, int rot)
 {
     QPoint p;
 
-    ToPoint(x, y, p);
-    DrawText(c, p, str, color, ha, va, rot);
+	ToPoint(x,y,p);
+    DrawText(c,p,str,color,ha,va,rot);
 }
 //---------------------------------------------------------------------------
-void Graph::DrawText(QPainter &c, const QPoint &p, const QString &str, const QColor &color, const QColor &bgcolor,
-             int ha, int va, int rot)
+void Graph::DrawText(QPainter &c,const QPoint &p, const QString &str, const QColor &color, const QColor &bgcolor,
+	int ha, int va, int rot)
 {
     QPoint p1;
 
-    p1 = p; p1.setX(p1.x() - 1); DrawText(c, p1, str, bgcolor, ha, va, rot); // draw with hemming
-    p1 = p; p1.setX(p1.x() + 1); DrawText(c, p1, str, bgcolor, ha, va, rot);
-    p1 = p; p1.setY(p1.y() - 1); DrawText(c, p1, str, bgcolor, ha, va, rot);
-    p1 = p; p1.setY(p1.y() + 1); DrawText(c, p1, str, bgcolor, ha, va, rot);
+    p1=p; p1.setX(p1.x()-1); DrawText(c,p1,str,bgcolor,ha,va,rot); // draw with hemming
+    p1=p; p1.setX(p1.x()+1); DrawText(c,p1,str,bgcolor,ha,va,rot);
+    p1=p; p1.setY(p1.y()-1); DrawText(c,p1,str,bgcolor,ha,va,rot);
+    p1=p; p1.setY(p1.y()+1); DrawText(c,p1,str,bgcolor,ha,va,rot);
 
-    DrawText(c, p, str, color, ha, va, rot);
+    DrawText(c,p,str,color,ha,va,rot);
 }
 //---------------------------------------------------------------------------
-void Graph::DrawText(QPainter &c, double x, double y, const QString &str, const QColor &color,
-             const QColor &bgcolor, int ha, int va, int rot)
+void Graph::DrawText(QPainter &c,double x, double y, const QString &str, const QColor &color,
+    const QColor &bgcolor, int ha, int va, int rot)
 {
     QPoint p;
 
-    ToPoint(x, y, p);
-    DrawText(c, p, str, color, bgcolor, ha, va, rot);
+	ToPoint(x,y,p);
+    DrawText(c,p,str,color,bgcolor,ha,va,rot);
 }
 //---------------------------------------------------------------------------
-void Graph::DrawCircle(QPainter &c, const QPoint &p, const QColor &color, int rx, int ry, int style)
+void Graph::DrawCircle(QPainter &c,const QPoint &p, const QColor &color, int rx, int ry, int style)
 {
-    Qt::PenStyle ps[] = { Qt::SolidLine, Qt::DotLine, Qt::DashLine, Qt::DashDotLine, Qt::DashDotDotLine };
-    int x = p.x() - rx, w = 2 * rx, y = p.y() - ry, h = 2 * ry;
-    QPen pen = c.pen();
+    Qt::PenStyle ps[]={Qt::SolidLine,Qt::DotLine,Qt::DashLine,Qt::DashDotLine,Qt::DashDotDotLine};
+    int x=p.x()-rx,w=2*rx,y=p.y()-ry,h=2*ry;
+    QPen pen=c.pen();
     pen.setColor(color);
     pen.setStyle(ps[style]);
     c.setPen(pen);
     c.setBrush(Qt::NoBrush);
 
-    c.drawEllipse(x, y, w, h);
+    c.drawEllipse(x,y,w,h);
 }
 //---------------------------------------------------------------------------
-void Graph::DrawCircle(QPainter &c, double x, double y, const QColor &color, double rx,
-               double ry, int style)
+void Graph::DrawCircle(QPainter &c,double x, double y, const QColor &color, double rx,
+	double ry, int style)
 {
     QPoint p;
 
-    ToPoint(x, y, p);
-    DrawCircle(c, p, color, (int)(rx / XScale + 0.5), (int)(ry / YScale + 0.5), style);
+	ToPoint(x,y,p);
+    DrawCircle(c,p,color,(int)(rx/XScale+0.5),(int)(ry/YScale+0.5),style);
 }
 //---------------------------------------------------------------------------
-void Graph::DrawCircles(QPainter &c, int label)
+void Graph::DrawCircles(QPainter &c,int label)
 {
     QPoint p;
-    double xl[2], yl[2], xt, yt, r[4], rmin = 1E99, rmax = 0.0;
-    int imin, imax;
+    double xl[2],yl[2],xt,yt,r[4],rmin=1E99,rmax=0.0;
+    int imin,imax;
 
-    GetLim(xl, yl);
-    GetTick(xt, yt);
+	GetLim(xl,yl);
+	GetTick(xt,yt);
 
-    r[0] = sqrt(SQR(xl[0]) + SQR(yl[0]));
-    r[1] = sqrt(SQR(xl[0]) + SQR(yl[1]));
-    r[2] = sqrt(SQR(xl[1]) + SQR(yl[0]));
-    r[3] = sqrt(SQR(xl[1]) + SQR(yl[1]));
-    for (int i = 0; i < 4; i++) {
-        if (r[i] < rmin) rmin = r[i];
-        if (r[i] > rmax) rmax = r[i];
+    r[0]=sqrt(SQR(xl[0])+SQR(yl[0]));
+    r[1]=sqrt(SQR(xl[0])+SQR(yl[1]));
+    r[2]=sqrt(SQR(xl[1])+SQR(yl[0]));
+    r[3]=sqrt(SQR(xl[1])+SQR(yl[1]));
+    for (int i=0;i<4;i++) {
+        if (r[i]<rmin) rmin=r[i];
+        if (r[i]>rmax) rmax=r[i];
     }
-    if (xl[0] <= 0.0 && xl[1] >= 0.0 && yl[0] <= 0.0 && yl[1] >= 0.0) {
-        imin = 0;
-        imax = (int)ceil(rmax / xt);
-    } else if (xl[0] <= 0.0 && xl[1] >= 0.0) {
-        imin = (int)floor((yl[1] < 0.0 ? -yl[1] : yl[0]) / xt);
-        imax = (int)ceil(rmax / xt);
-    } else if (yl[0] <= 0.0 && yl[1] >= 0.0) {
-        imin = (int)floor((xl[1] < 0.0 ? -xl[1] : xl[0]) / xt);
-        imax = (int)ceil(rmax / xt);
-    } else {
-        imin = (int)floor(rmin / xt);
-        imax = (int)ceil(rmax / xt);
+    if (xl[0]<=0.0&&xl[1]>=0.0&&yl[0]<=0.0&&yl[1]>=0.0) {
+        imin=0;
+        imax=(int)ceil(rmax/xt);
+    }
+    else if (xl[0]<=0.0&&xl[1]>=0.0) {
+        imin=(int)floor((yl[1]<0.0?-yl[1]:yl[0])/xt);
+        imax=(int)ceil(rmax/xt);
+    }
+    else if (yl[0]<=0.0&&yl[1]>=0.0) {
+        imin=(int)floor((xl[1]<0.0?-xl[1]:xl[0])/xt);
+        imax=(int)ceil(rmax/xt);
+    }
+    else {
+        imin=(int)floor(rmin/xt);
+        imax=(int)ceil(rmax/xt);
+    }
+    for (int i=imin;i<=imax;i++) {
+        DrawCircle(c,0.0,0.0,Color[1],i*xt,i*xt,1);
 	}
-    for (int i = imin; i <= imax; i++)
-        DrawCircle(c, 0.0, 0.0, Color[1], i * xt, i * xt, 1);
-    ToPoint(0.0, 0.0, p);
+	ToPoint(0.0,0.0,p);
 
-    QPen pen = c.pen();
+    QPen pen=c.pen();
     pen.setStyle(Qt::SolidLine);
     c.setPen(pen);
 
-    c.drawLine(p.x(), Y, p.x(), Y + Height - 1);
-    c.drawLine(X, p.y(), X + Width - 1, p.y());
+    c.drawLine(p.x(),Y,p.x(),Y+Height-1);
+    c.drawLine(X,p.y(),X+Width-1,p.y());
 
-    DrawMark(c, 0.0, 0.0, 0, Color[1], SIZEORIGIN, 0);
+    DrawMark(c,0.0,0.0,0,Color[1],SIZEORIGIN,0);
 
-    if (xt / XScale < 50.0) xt *= 2.0;
-    if (yt / YScale < 50.0) yt *= 2.0;
-    if (label) DrawGridLabel(c, xt, yt);
+	if (xt/XScale<50.0) xt*=2.0;
+	if (yt/YScale<50.0) yt*=2.0;
+    if (label) DrawGridLabel(c,xt,yt);
 
     DrawBox(c);
 }
@@ -606,221 +590,206 @@
 	// area code :  5  4  6
 	//              1  0  2
 	//              9  8 10
-    int xmin = X, xmax = X + Width - 1, ymin = Y, ymax = Y + Height - 1;
-
-    return (p.x() < xmin ? 1 : (p.x() <= xmax ? 0 : 2)) + (p.y() < ymin ? 4 : (p.y() <= ymax ? 0 : 8));
+	int xmin=X,xmax=X+Width-1,ymin=Y,ymax=Y+Height-1;
+    return (p.x()<xmin?1:(p.x()<=xmax?0:2))+(p.y()<ymin?4:(p.y()<=ymax?0:8));
 }
 //---------------------------------------------------------------------------
 int Graph::ClipPoint(QPoint *p0, int area, QPoint *p1)
 {
-    int x, y, xmin = X, xmax = X + Width - 1, ymin = Y, ymax = Y + Height - 1;
-
-    if ((p1->x() - p0->x()) == 0) return 0;
-    if ((p1->y() - p0->y()) == 0) return 0;
-    if (area & 1) { // left
-        if (p0->x()==p1->x()) return 0;
-        y = p0->y() + (p1->y() - p0->y()) * (xmin - p0->x()) / (p1->x() - p0->x());
-        if (ymin <= y && y <= ymax) {
-            p0->setX(xmin); p0->setY(y); return 1;
-        }
+	int x,y,xmin=X,xmax=X+Width-1,ymin=Y,ymax=Y+Height-1;
+    if ((p1->x()-p0->x())==0) return 0;
+    if ((p1->y()-p0->y())==0) return 0;
+    if (area&1) { // left
+        y=p0->y()+(p1->y()-p0->y())*(xmin-p0->x())/(p1->x()-p0->x());
+        if (ymin<=y&&y<=ymax) {p0->setX(xmin); p0->setY(y); return 1;}
 	}
-    if (area & 2) { // right
-        if (p0->x()==p1->x()) return 0;
-        y = p0->y() + (p1->y() - p0->y()) * (xmax - p0->x()) / (p1->x() - p0->x());
-        if (ymin <= y && y <= ymax) {
-            p0->setX(xmax); p0->setY(y); return 1;
-        }
+	if (area&2) { // right
+        y=p0->y()+(p1->y()-p0->y())*(xmax-p0->x())/(p1->x()-p0->x());
+        if (ymin<=y&&y<=ymax) {p0->setX(xmax); p0->setY(y); return 1;}
 	}
-    if (area & 4) { // upper
-        if (p0->y()==p1->y()) return 0;
-        x = p0->x() + (p1->x() - p0->x()) * (ymin - p0->y()) / (p1->y() - p0->y());
-        if (xmin <= x && x <= xmax) {
-            p0->setX(x); p0->setY(ymin); return 1;
-        }
+	if (area&4) { // upper
+        x=p0->x()+(p1->x()-p0->x())*(ymin-p0->y())/(p1->y()-p0->y());
+        if (xmin<=x&&x<=xmax) {p0->setX(x); p0->setY(ymin); return 1;}
 	}
-    if (area & 8) { // lower
-        if (p0->y()==p1->y()) return 0;
-        x = p0->x() + (p1->x() - p0->x()) * (ymax - p0->y()) / (p1->y() - p0->y());
-        if (xmin <= x && x <= xmax) {
-            p0->setX(x); p0->setY(ymax); return 1;
-        }
+	if (area&8) { // lower
+        x=p0->x()+(p1->x()-p0->x())*(ymax-p0->y())/(p1->y()-p0->y());
+        if (xmin<=x&&x<=xmax) {p0->setX(x); p0->setY(ymax); return 1;}
 	}
 	return 0;
 }
 //---------------------------------------------------------------------------
-void Graph::DrawPolyline(QPainter &c, QPoint *p, int n)
+void Graph::DrawPolyline(QPainter &c,QPoint *p, int n)
 {
 #if 1
-    c.drawPolyline(p, n);
+    c.drawPolyline(p,n);
 #else
     // avoid overflow of points
-    for (int i = 0; i < n - 1; i += 30000, p += 30000)
-        c.drawPolyline(p, n - i > 30000 ? 30000 : n - i);
-
+    for (int i=0;i<n-1;i+=30000,p+=30000) {
+        c.drawPolyline(p,n-i>30000?30000:n-i);
+	}
 #endif
 }
 //---------------------------------------------------------------------------
-void Graph::DrawPoly(QPainter &c, QPoint *p, int n, const QColor &color, int style)
+void Graph::DrawPoly(QPainter &c,QPoint *p, int n, const QColor &color, int style)
 {
-    Qt::PenStyle ps[] = { Qt::SolidLine, Qt::DotLine, Qt::DashLine, Qt::DashDotLine, Qt::DashDotDotLine };
-    QPen pen = c.pen();
+    Qt::PenStyle ps[]={Qt::SolidLine,Qt::DotLine,Qt::DashLine,Qt::DashDotLine,Qt::DashDotDotLine};
+    QPen pen=c.pen();
     pen.setColor(color);
     pen.setStyle(ps[style]);
     c.setPen(pen);
     c.setBrush(Qt::NoBrush);
 
-    int i, j, area0 = 11, area1;
-    for (i = j = 0; j < n; j++, area0 = area1) {
-        if ((area1 = OnAxis(p[j])) == area0) continue;
-        if (!area1) i = j; else if (!area0) DrawPolyline(c, p + i, j - i);
-        if (j <= 0 || (area0 & area1)) continue;
+	int i,j,area0=11,area1;
+	for (i=j=0;j<n;j++,area0=area1) {
+		if ((area1=OnAxis(p[j]))==area0) continue;
+        if (!area1) i=j; else if (!area0) DrawPolyline(c,p+i,j-i);
+		if (j<=0||(area0&area1)) continue;
 
-        QPoint pc[2] = { p[j - 1], p[j] };
-        if (area0 && !ClipPoint(pc, area0, p + j)) continue;
-        if (area1 && !ClipPoint(pc + 1, area1, p + j - 1)) continue;
+        QPoint pc[2]={p[j-1],p[j]};
+		if (area0&&!ClipPoint(pc,  area0,p+j  )) continue;
+		if (area1&&!ClipPoint(pc+1,area1,p+j-1)) continue;
 
-        DrawPolyline(c, pc, 2);
+        DrawPolyline(c, pc,2);
 	}
-    if (!area0) DrawPolyline(c, p + i, j - i);
+    if (!area0) DrawPolyline(c, p+i,j-i);
 }
 //---------------------------------------------------------------------------
-void Graph::DrawPoly(QPainter &c, double *x, double *y, int n, const QColor &color, int style)
+void Graph::DrawPoly(QPainter &c,double *x, double *y, int n, const QColor &color, int style)
 {
-    QPoint *p = new QPoint[n];
-    int m = 0;
+    QPoint *p=new QPoint[n];    
+	int m=0;
 
-    for (int i = 0; i < n; i++) {
-        ToPoint(x[i], y[i], p[m]);
-        if (m == 0 || p[m - 1] != p[m]) m++;
+	for (int i=0;i<n;i++) {
+		ToPoint(x[i],y[i],p[m]);
+        if (m==0||p[m-1]!=p[m]) m++;
 	}
 
-    DrawPoly(c, p, m, color, style);
+    DrawPoly(c,p,m,color,style);
 
 	delete [] p;
 }
 //---------------------------------------------------------------------------
-void Graph::DrawPatch(QPainter &c, QPoint *p, int n, const QColor &color1, const QColor &color2,
-              int style)
+void Graph::DrawPatch(QPainter &c,QPoint *p, int n, const QColor &color1, const QColor &color2,
+	int style)
 {
-    Qt::PenStyle ps[] = { Qt::SolidLine, Qt::DotLine, Qt::DashLine, Qt::DashDotLine, Qt::DashDotDotLine };
-    int xmin = 1000000, xmax = 0, ymin = 1000000, ymax = 0;
+    Qt::PenStyle ps[]={Qt::SolidLine,Qt::DotLine,Qt::DashLine,Qt::DashDotLine,Qt::DashDotDotLine};
+    int xmin=1000000,xmax=0,ymin=1000000,ymax=0;
 
-    if (n > 30000) return; // # of points overflow
+    if (n>30000) return; // # of points overflow
 
-    for (int i = 0; i < n - 1; i++) {
-        if (p[i].x() < xmin) xmin = p[i].x();
-        if (p[i].x() > xmax) xmax = p[i].x();
-        if (p[i].y() < ymin) ymin = p[i].y();
-        if (p[i].y() > ymax) ymax = p[i].y();
+    for (int i=0;i<n-1;i++) {
+        if (p[i].x()<xmin) xmin=p[i].x();
+        if (p[i].x()>xmax) xmax=p[i].x();
+        if (p[i].y()<ymin) ymin=p[i].y();
+        if (p[i].y()>ymax) ymax=p[i].y();
     }
-    if (xmax < X || xmin > X + Width - 1 || ymax < Y || ymin > Y + Height - 1)
+    if (xmax<X||xmin>X+Width-1||ymax<Y||ymin>Y+Height-1) {
         return;
+    }
 
-    QPen pen = c.pen();
+    QPen pen=c.pen();
     pen.setColor(color1);
     pen.setStyle(ps[style]);
     c.setPen(pen);
     c.setBrush(color2);
 
-    c.drawPolygon(p, n - 1);
+    c.drawPolygon(p,n-1);
 }
 //---------------------------------------------------------------------------
-void Graph::DrawPatch(QPainter &c, double *x, double *y, int n, const QColor &color1,
-              const QColor &color2, int style)
+void Graph::DrawPatch(QPainter &c,double *x, double *y, int n, const QColor &color1,
+    const QColor &color2, int style)
 {
-    QPoint *p = new QPoint[n];
+    QPoint *p=new QPoint[n];
 
-    for (int i = 0; i < n; i++)
-        ToPoint(x[i], y[i], p[i]);
+	for (int i=0;i<n;i++) {
+		ToPoint(x[i],y[i],p[i]);
+	}
 
-    DrawPatch(c, p, n, color1, color2, style);
+    DrawPatch(c,p,n,color1,color2,style);
 
 	delete [] p;
 }
 //---------------------------------------------------------------------------
-void Graph::DrawSkyPlot(QPainter &c, const QPoint &p, const QColor &color1, const QColor &color2, int size)
+void Graph::DrawSkyPlot(QPainter &c,const QPoint &p, const QColor &color1, const QColor &color2, int size)
 {
-    QPen pen = c.pen();
-
+    QPen pen=c.pen();
     pen.setColor(color1);
     c.setPen(pen);
     c.setBrush(Qt::NoBrush);
-    QString s, dir[] = { "N", "E", "S", "W" };
+    QString s,dir[]={"N","E","S","W"};
     QPoint ps;
-    int r = size / 2;
-    for (int el = 0; el < 90; el += 15) {
-        int ys = r - r * el / 90;
-        pen.setStyle(el == 0 ? Qt::SolidLine : Qt::DotLine);
+	int r=size/2;
+	for (int el=0;el<90;el+=15) {
+		int ys=r-r*el/90;
+        pen.setStyle(el==0?Qt::SolidLine:Qt::DotLine);
         c.setPen(pen);
-        c.drawEllipse(p.x() - ys, p.y() - ys, 2 * ys, 2 * ys);
-        if (el <= 0) continue;
-        ps.setX(p.x()); ps.setY(p.y() - ys);
-        DrawText(c, ps, QString::number(el), color2, 1, 0, 0);
+        c.drawEllipse(p.x()-ys,p.y()-ys,2*ys,2*ys);
+		if (el<=0) continue;
+        ps.setX(p.x()); ps.setY(p.y()-ys);
+        DrawText(c,ps,QString::number(el),color2,1,0,0);
 	}
-    pen.setStyle(Qt::DotLine); pen.setColor(color2); c.setPen(pen);
-    for (int az = 0, i = 0; az < 360; az += 30) {
-        ps.setX((int)(r * sin(az * D2R) + 0.5));
-        ps.setY((int)(-r * cos(az * D2R) + 0.5));
-        c.drawLine(p.x(), p.y(), ps.x(), ps.y());
-        ps.setX(ps.x() + 3 * sin(az * D2R));
-        ps.setY(ps.y() + -3 * cos(az * D2R));
-        s = QString::number(az); if (!(az % 90)) s = dir[i++];
-        DrawText(c, ps, s, color2, 0, 1, -az);
+    pen.setStyle(Qt::DotLine);pen.setColor(color2); c.setPen(pen);
+	for (int az=0,i=0;az<360;az+=30) {
+        ps.setX((int)( r*sin(az*D2R)+0.5));
+        ps.setY((int)(-r*cos(az*D2R)+0.5));
+        c.drawLine(p.x(),p.y(),ps.x(),ps.y());
+        ps.setX(ps.x()+ 3*sin(az*D2R));
+        ps.setY(ps.y()+-3*cos(az*D2R));
+        s=QString::number(az); if (!(az%90)) s=dir[i++];
+        DrawText(c,ps,s,color2,0,1,-az);
 	}
 }
 //---------------------------------------------------------------------------
-void Graph::DrawSkyPlot(QPainter &c, double x, double y, const QColor &color1, const QColor &color2,
-            double size)
+void Graph::DrawSkyPlot(QPainter &c,double x, double y, const QColor &color1, const QColor &color2,
+	double size)
 {
     QPoint p;
 
-    ToPoint(x, y, p);
+	ToPoint(x,y,p);
 
-    DrawSkyPlot(c, p, color1, color2, size / XScale);
+    DrawSkyPlot(c,p,color1,color2,size/XScale);
 }
 //---------------------------------------------------------------------------
-void Graph::DrawSkyPlot(QPainter &c, const QPoint &p, const QColor &color1, const QColor &color2,
-            const QColor &bgcolor, int size)
+void Graph::DrawSkyPlot(QPainter &c,const QPoint &p, const QColor &color1, const QColor &color2,
+    const QColor &bgcolor, int size)
 {
-    QPen pen = c.pen();
-
+    QPen pen=c.pen();
     pen.setColor(color1);
     c.setPen(pen);
     c.setBrush(Qt::NoBrush);
 
-    QString s, dir[] = { "N", "E", "S", "W" };
+    QString s,dir[]={"N","E","S","W"};
     QPoint ps;
-    int r = size / 2;
-
-    for (int el = 0; el < 90; el += 15) {
-        int ys = r - r * el / 90;
-        pen.setStyle(el == 0 ? Qt::SolidLine : Qt::DotLine);
-        c.drawEllipse(p.x() - ys, p.y() - ys, 2 * ys, 2 * ys);
-        if (el <= 0) continue;
+    int r=size/2;
+	
+	for (int el=0;el<90;el+=15) {
+		int ys=r-r*el/90;
+        pen.setStyle(el==0?Qt::SolidLine:Qt::DotLine);
+        c.drawEllipse(p.x()-ys,p.y()-ys,2*ys,2*ys);
+		if (el<=0) continue;
 
         ps.setX(p.x());
-        ps.setY(p.y() - ys);
+        ps.setY(p.y()-ys);
 
-        DrawText(c, ps, QString::number(el), color2, bgcolor, 1, 0, 0);
+        DrawText(c,ps,QString::number(el),color2,bgcolor,1,0,0);
 	}
-    pen.setStyle(Qt::DotLine); pen.setColor(color2); c.setPen(pen);
-    for (int az = 0, i = 0; az < 360; az += 30) {
-        ps.setX((int)(p.x() + r * sin(az * D2R) + 0.5));
-        ps.setY((int)(p.y() - r * cos(az * D2R) + 0.5));
-        c.drawLine(p.x(), p.y(), ps.x(), ps.y());
-        ps.setX(ps.x() + 3 * sin(az * D2R));
-        ps.setY(ps.y() + -3 * cos(az * D2R));
-        s = QString::number(az); if (!(az % 90)) s = dir[i++];
-        DrawText(c, ps, s, color2, bgcolor, 0, 1, -az);
+    pen.setStyle(Qt::DotLine);pen.setColor(color2);c.setPen(pen);
+	for (int az=0,i=0;az<360;az+=30) {
+        ps.setX((int)(p.x()+r*sin(az*D2R)+0.5));
+        ps.setY((int)(p.y()-r*cos(az*D2R)+0.5));
+        c.drawLine(p.x(),p.y(),ps.x(),ps.y());
+        ps.setX(ps.x()+ 3*sin(az*D2R));
+        ps.setY(ps.y()+-3*cos(az*D2R));
+        s=QString::number(az); if (!(az%90)) s=dir[i++];
+        DrawText(c,ps,s,color2,bgcolor,0,1,-az);
 	}
 }
 //---------------------------------------------------------------------------
-void Graph::DrawSkyPlot(QPainter &c, double x, double y, const QColor &color1, const QColor &color2,
-            const QColor &bgcolor, double size)
+void Graph::DrawSkyPlot(QPainter &c,double x, double y, const QColor &color1, const QColor &color2,
+    const QColor &bgcolor, double size)
 {
     QPoint p;
-
-    ToPoint(x, y, p);
-    DrawSkyPlot(c, p, color1, color2, bgcolor, size / XScale);
+	ToPoint(x,y,p);
+    DrawSkyPlot(c,p,color1,color2,bgcolor,size/XScale);
 }
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/graph.h RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/graph.h
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/graph.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/graph.h	2019-08-19 02:04:50.000000000 +0300
@@ -23,15 +23,15 @@
         QPoint p_;
         QColor color_;
         QPaintDevice *Parent;
-        int mark_, size_, rot_;
-        int X, Y, Width, Height;
-        double XCent, YCent, XScale, YScale, XTick, YTick;
+        int mark_,size_,rot_;
+        int X,Y,Width,Height;
+        double XCent,YCent,XScale,YScale,XTick,YTick;
 
 public:
         explicit Graph(QPaintDevice *parent);
 
         int IsInArea(QPoint &p);
-        int ToPoint(const double &x, const double &y, QPoint &p);
+        int ToPoint(double x, double y, QPoint &p);
         int OnAxis(const QPoint &p);
         QString NumText(double x, double dx);
         QString TimeText(double x, double dx);
@@ -74,8 +74,8 @@
         void DrawSkyPlot(QPainter &c,const QPoint &p, const QColor &color1, const QColor &color2, const QColor &bgcolor, int size);
         void DrawSkyPlot(QPainter &c,double x, double y, const QColor &color1, const QColor &color2, const QColor &bgcolor,double size);
 
-        int Box, Fit, XGrid, YGrid, XLPos, YLPos, Week;
-        QString Title, XLabel, YLabel;
+        int Box,Fit,XGrid,YGrid,XLPos,YLPos,Week;
+        QString Title,XLabel,YLabel;
         QColor Color[3];
 };
 #endif
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/keydlg.cpp RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/keydlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/keydlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/keydlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -7,41 +7,41 @@
 #include "keydlg.h"
 
 //---------------------------------------------------------------------------
-KeyDialog::KeyDialog(QWidget *parent)
+KeyDialog::KeyDialog(QWidget* parent)
     : QDialog(parent)
 {
     setupUi(this);
 
-    Flag = 0;
+    Flag=0;
 
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this, SLOT(BtnOkClick()));
 }
 //---------------------------------------------------------------------------
-void KeyDialog::showEvent(QShowEvent *event)
+void  KeyDialog::showEvent(QShowEvent *event)
 {
     if (event->spontaneous()) return;
 
-    Label10->setVisible(Flag != 3);
-    Label21->setVisible(Flag != 3);
-    Label23->setVisible(Flag != 3);
-    Label24->setVisible(Flag != 3);
-    Label25->setVisible(Flag != 3);
-    Label26->setVisible(Flag != 3);
-    Label27->setVisible(Flag != 3);
-    Label28->setVisible(Flag != 3);
-    Label29->setVisible(Flag >= 1);
-    Label30->setVisible(Flag >= 1);
-    Label31->setVisible(Flag == 2);
-    Label32->setVisible(Flag == 2);
-    Label33->setVisible(Flag == 3);
-    Label34->setVisible(Flag == 3);
-    Label35->setVisible(Flag == 3);
-    Label36->setVisible(Flag == 3);
-    Label37->setVisible(Flag == 3);
-    Label38->setVisible(Flag == 3);
+    Label10->setVisible(Flag!=3);
+    Label21->setVisible(Flag!=3);
+    Label23->setVisible(Flag!=3);
+    Label24->setVisible(Flag!=3);
+    Label25->setVisible(Flag!=3);
+    Label26->setVisible(Flag!=3);
+    Label27->setVisible(Flag!=3);
+    Label28->setVisible(Flag!=3);
+    Label29->setVisible(Flag>=1);
+    Label30->setVisible(Flag>=1);
+    Label31->setVisible(Flag==2);
+    Label32->setVisible(Flag==2);
+    Label33->setVisible(Flag==3);
+    Label34->setVisible(Flag==3);
+    Label35->setVisible(Flag==3);
+    Label36->setVisible(Flag==3);
+    Label37->setVisible(Flag==3);
+    Label38->setVisible(Flag==3);
 }
 //---------------------------------------------------------------------------
-void KeyDialog::BtnOkClick()
+void  KeyDialog::BtnOkClick()
 {
     close();
 }
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/keydlg.h RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/keydlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/keydlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/keydlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -20,7 +20,6 @@
 
 public:
 	int Flag;
-
     explicit KeyDialog(QWidget* parent);
 };
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/maskoptdlg.cpp RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/maskoptdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/maskoptdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/maskoptdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -2,79 +2,82 @@
 // ported to Qt by Jens Reimann
 
 #include <QShowEvent>
+#include <QDoubleValidator>
 
 #include "maskoptdlg.h"
 //---------------------------------------------------------------------------
-MaskOptDialog::MaskOptDialog(QWidget *parent)
+MaskOptDialog::MaskOptDialog(QWidget* parent)
     : QDialog(parent)
 {
     setupUi(this);
 
-    Mask.ena[0] = 0;
-    Mask.ena[1] = 0;
-    for (int i = 0; i < 3; i++) for (int j = 0; j < 9; j++)
-            Mask.mask[i][j] = 0.0;
+	Mask.ena[0]=0;
+	Mask.ena[1]=0;
+	for (int i=0;i<3;i++) for (int j=0;j<9;j++) {
+		Mask.mask[i][j]=0.0;
+	}
 
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(MaskEna1, SIGNAL(clicked(bool)), this, SLOT(MaskEnaClick()));
-    connect(MaskEna2, SIGNAL(clicked(bool)), this, SLOT(MaskEnaClick()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(MaskEna1,SIGNAL(clicked(bool)),this,SLOT(MaskEnaClick()));
+    connect(MaskEna2,SIGNAL(clicked(bool)),this,SLOT(MaskEnaClick()));
 }
 //---------------------------------------------------------------------------
-void MaskOptDialog::showEvent(QShowEvent *event)
+void  MaskOptDialog::showEvent(QShowEvent *event)
 {
     if (event->spontaneous()) return;
 
-    QDoubleSpinBox *mask[][9] = {
-        { Mask_1_1, Mask_1_2, Mask_1_3, Mask_1_4, Mask_1_5, Mask_1_6, Mask_1_7, Mask_1_8, Mask_1_9 },
-        { Mask_2_1, Mask_2_2, Mask_2_3, Mask_2_4, Mask_2_5, Mask_2_6, Mask_2_7, Mask_2_8, Mask_2_9 },
-        { Mask_3_1, Mask_3_2, Mask_3_3, Mask_3_4, Mask_3_5, Mask_3_6, Mask_3_7, Mask_3_8, Mask_3_9 }
-    };
+    QLineEdit *mask[][9]={
+		{Mask_1_1,Mask_1_2,Mask_1_3,Mask_1_4,Mask_1_5,Mask_1_6,Mask_1_7,Mask_1_8,Mask_1_9},
+		{Mask_2_1,Mask_2_2,Mask_2_3,Mask_2_4,Mask_2_5,Mask_2_6,Mask_2_7,Mask_2_8,Mask_2_9},
+		{Mask_3_1,Mask_3_2,Mask_3_3,Mask_3_4,Mask_3_5,Mask_3_6,Mask_3_7,Mask_3_8,Mask_3_9}
+	};    
 
     MaskEna1->setChecked(Mask.ena[0]);
     MaskEna2->setChecked(Mask.ena[1]);
 
-    for (int i = 0; i < 3; i++) {
-        for (int j = 0; j < 9; j++) {
-            mask[i][j]->setValue(Mask.mask[i][j]);
+    for (int i=0;i<3;i++)
+    {
+        for (int j=0;j<9;j++) {
+            mask[i][j]->setValidator(new QDoubleValidator(-90,90,1));
+            mask[i][j]->setText(QString::number(Mask.mask[i][j]));
         }
 	}
 
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void MaskOptDialog::BtnOkClick()
+void  MaskOptDialog::BtnOkClick()
 {
-    QDoubleSpinBox *mask[][9] = {
-        { Mask_1_1, Mask_1_2, Mask_1_3, Mask_1_4, Mask_1_5, Mask_1_6, Mask_1_7, Mask_1_8, Mask_1_9 },
-        { Mask_2_1, Mask_2_2, Mask_2_3, Mask_2_4, Mask_2_5, Mask_2_6, Mask_2_7, Mask_2_8, Mask_2_9 },
-        { Mask_3_1, Mask_3_2, Mask_3_3, Mask_3_4, Mask_3_5, Mask_3_6, Mask_3_7, Mask_3_8, Mask_3_9 }
+    QLineEdit *mask[][9]={
+		{Mask_1_1,Mask_1_2,Mask_1_3,Mask_1_4,Mask_1_5,Mask_1_6,Mask_1_7,Mask_1_8,Mask_1_9},
+		{Mask_2_1,Mask_2_2,Mask_2_3,Mask_2_4,Mask_2_5,Mask_2_6,Mask_2_7,Mask_2_8,Mask_2_9},
+		{Mask_3_1,Mask_3_2,Mask_3_3,Mask_3_4,Mask_3_5,Mask_3_6,Mask_3_7,Mask_3_8,Mask_3_9}
 	};
-
-    Mask.ena[0] = MaskEna1->isChecked();
-    Mask.ena[1] = MaskEna2->isChecked();
-    for (int i = 0; i < 3; i++) for (int j = 0; j < 9; j++)
-            Mask.mask[i][j] = mask[i][j]->value();
-
+    Mask.ena[0]=MaskEna1->isChecked();
+    Mask.ena[1]=MaskEna2->isChecked();
+	for (int i=0;i<3;i++) for (int j=0;j<9;j++) {
+        Mask.mask[i][j]=mask[i][j]->text().toDouble();
+	}
 
     accept();
 }
 //---------------------------------------------------------------------------
-void MaskOptDialog::MaskEnaClick()
+void  MaskOptDialog::MaskEnaClick()
 {
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void MaskOptDialog::UpdateEnable(void)
+void  MaskOptDialog::UpdateEnable(void)
 {
-    QDoubleSpinBox *mask[][9] = {
-        { Mask_1_1, Mask_1_2, Mask_1_3, Mask_1_4, Mask_1_5, Mask_1_6, Mask_1_7, Mask_1_8, Mask_1_9 },
-        { Mask_2_1, Mask_2_2, Mask_2_3, Mask_2_4, Mask_2_5, Mask_2_6, Mask_2_7, Mask_2_8, Mask_2_9 },
-        { Mask_3_1, Mask_3_2, Mask_3_3, Mask_3_4, Mask_3_5, Mask_3_6, Mask_3_7, Mask_3_8, Mask_3_9 }
+    QLineEdit *mask[][9]={
+		{Mask_1_1,Mask_1_2,Mask_1_3,Mask_1_4,Mask_1_5,Mask_1_6,Mask_1_7,Mask_1_8,Mask_1_9},
+		{Mask_2_1,Mask_2_2,Mask_2_3,Mask_2_4,Mask_2_5,Mask_2_6,Mask_2_7,Mask_2_8,Mask_2_9},
+		{Mask_3_1,Mask_3_2,Mask_3_3,Mask_3_4,Mask_3_5,Mask_3_6,Mask_3_7,Mask_3_8,Mask_3_9}
 	};
-
-    for (int i = 0; i < 3; i++) for (int j = 0; j < 9; j++)
-            mask[i][j]->setEnabled(MaskEna1->isChecked() || MaskEna2->isChecked());
-
+	for (int i=0;i<3;i++) for (int j=0;j<9;j++) {
+        mask[i][j]->setEnabled(MaskEna1->isChecked()||MaskEna2->isChecked());
+	}
 }
 //---------------------------------------------------------------------------
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/maskoptdlg.ui RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/maskoptdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/maskoptdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/maskoptdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -2,14 +2,6 @@
 <ui version="4.0">
  <class>MaskOptDialog</class>
  <widget class="QWidget" name="MaskOptDialog">
-  <property name="geometry">
-   <rect>
-    <x>0</x>
-    <y>0</y>
-    <width>1017</width>
-    <height>242</height>
-   </rect>
-  </property>
   <property name="windowTitle">
    <string>SNR Mask</string>
   </property>
@@ -22,12 +14,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -41,12 +27,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -60,12 +40,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -75,18 +49,15 @@
     </widget>
    </item>
    <item row="4" column="4">
-    <widget class="QDoubleSpinBox" name="Mask_2_4">
+    <widget class="QLineEdit" name="Mask_2_4">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
@@ -95,12 +66,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -110,34 +75,28 @@
     </widget>
    </item>
    <item row="4" column="2">
-    <widget class="QDoubleSpinBox" name="Mask_2_2">
+    <widget class="QLineEdit" name="Mask_2_2">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="4" column="3">
-    <widget class="QDoubleSpinBox" name="Mask_2_3">
+    <widget class="QLineEdit" name="Mask_2_3">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
@@ -146,12 +105,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -165,12 +118,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -212,114 +159,93 @@
     </widget>
    </item>
    <item row="4" column="5">
-    <widget class="QDoubleSpinBox" name="Mask_2_5">
+    <widget class="QLineEdit" name="Mask_2_5">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="4" column="7">
-    <widget class="QDoubleSpinBox" name="Mask_2_7">
+    <widget class="QLineEdit" name="Mask_2_7">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="4" column="6">
-    <widget class="QDoubleSpinBox" name="Mask_2_6">
+    <widget class="QLineEdit" name="Mask_2_6">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="5" column="1">
-    <widget class="QDoubleSpinBox" name="Mask_3_1">
+    <widget class="QLineEdit" name="Mask_3_1">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="5" column="6">
-    <widget class="QDoubleSpinBox" name="Mask_3_6">
+    <widget class="QLineEdit" name="Mask_3_6">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="5" column="5">
-    <widget class="QDoubleSpinBox" name="Mask_3_5">
+    <widget class="QLineEdit" name="Mask_3_5">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="5" column="3">
-    <widget class="QDoubleSpinBox" name="Mask_3_3">
+    <widget class="QLineEdit" name="Mask_3_3">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
@@ -328,12 +254,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -343,18 +263,15 @@
     </widget>
    </item>
    <item row="3" column="9">
-    <widget class="QDoubleSpinBox" name="Mask_1_9">
+    <widget class="QLineEdit" name="Mask_1_9">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
@@ -363,12 +280,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -378,162 +289,132 @@
     </widget>
    </item>
    <item row="3" column="3">
-    <widget class="QDoubleSpinBox" name="Mask_1_3">
+    <widget class="QLineEdit" name="Mask_1_3">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="3" column="1">
-    <widget class="QDoubleSpinBox" name="Mask_1_1">
+    <widget class="QLineEdit" name="Mask_1_1">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="3" column="8">
-    <widget class="QDoubleSpinBox" name="Mask_1_8">
+    <widget class="QLineEdit" name="Mask_1_8">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="3" column="7">
-    <widget class="QDoubleSpinBox" name="Mask_1_7">
+    <widget class="QLineEdit" name="Mask_1_7">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="3" column="5">
-    <widget class="QDoubleSpinBox" name="Mask_1_5">
+    <widget class="QLineEdit" name="Mask_1_5">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="4" column="9">
-    <widget class="QDoubleSpinBox" name="Mask_2_9">
+    <widget class="QLineEdit" name="Mask_2_9">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="4" column="8">
-    <widget class="QDoubleSpinBox" name="Mask_2_8">
+    <widget class="QLineEdit" name="Mask_2_8">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="5" column="2">
-    <widget class="QDoubleSpinBox" name="Mask_3_2">
+    <widget class="QLineEdit" name="Mask_3_2">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="5" column="4">
-    <widget class="QDoubleSpinBox" name="Mask_3_4">
+    <widget class="QLineEdit" name="Mask_3_4">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="3" column="2">
-    <widget class="QDoubleSpinBox" name="Mask_1_2">
+    <widget class="QLineEdit" name="Mask_1_2">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
@@ -542,12 +423,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -557,34 +432,28 @@
     </widget>
    </item>
    <item row="3" column="6">
-    <widget class="QDoubleSpinBox" name="Mask_1_6">
+    <widget class="QLineEdit" name="Mask_1_6">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="3" column="4">
-    <widget class="QDoubleSpinBox" name="Mask_1_4">
+    <widget class="QLineEdit" name="Mask_1_4">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
@@ -593,12 +462,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -612,12 +475,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -631,12 +488,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -646,77 +497,59 @@
     </widget>
    </item>
    <item row="4" column="1">
-    <widget class="QDoubleSpinBox" name="Mask_2_1">
+    <widget class="QLineEdit" name="Mask_2_1">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="5" column="8">
-    <widget class="QDoubleSpinBox" name="Mask_3_8">
+    <widget class="QLineEdit" name="Mask_3_8">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="5" column="9">
-    <widget class="QDoubleSpinBox" name="Mask_3_9">
+    <widget class="QLineEdit" name="Mask_3_9">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="5" column="7">
-    <widget class="QDoubleSpinBox" name="Mask_3_7">
+    <widget class="QLineEdit" name="Mask_3_7">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text" stdset="0">
-      <string>0,00</string>
-     </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
     </widget>
    </item>
    <item row="0" column="0" colspan="10">
     <widget class="QWidget" name="widget" native="true">
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <layout class="QHBoxLayout" name="horizontalLayout">
       <property name="leftMargin">
        <number>0</number>
@@ -787,39 +620,6 @@
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>MaskEna1</tabstop>
-  <tabstop>MaskEna2</tabstop>
-  <tabstop>Mask_1_1</tabstop>
-  <tabstop>Mask_1_2</tabstop>
-  <tabstop>Mask_1_3</tabstop>
-  <tabstop>Mask_1_4</tabstop>
-  <tabstop>Mask_1_5</tabstop>
-  <tabstop>Mask_1_6</tabstop>
-  <tabstop>Mask_1_7</tabstop>
-  <tabstop>Mask_1_8</tabstop>
-  <tabstop>Mask_1_9</tabstop>
-  <tabstop>Mask_2_1</tabstop>
-  <tabstop>Mask_2_2</tabstop>
-  <tabstop>Mask_2_3</tabstop>
-  <tabstop>Mask_2_4</tabstop>
-  <tabstop>Mask_2_5</tabstop>
-  <tabstop>Mask_2_6</tabstop>
-  <tabstop>Mask_2_7</tabstop>
-  <tabstop>Mask_2_8</tabstop>
-  <tabstop>Mask_2_9</tabstop>
-  <tabstop>Mask_3_1</tabstop>
-  <tabstop>Mask_3_2</tabstop>
-  <tabstop>Mask_3_3</tabstop>
-  <tabstop>Mask_3_4</tabstop>
-  <tabstop>Mask_3_5</tabstop>
-  <tabstop>Mask_3_6</tabstop>
-  <tabstop>Mask_3_7</tabstop>
-  <tabstop>Mask_3_8</tabstop>
-  <tabstop>Mask_3_9</tabstop>
-  <tabstop>BtnOk</tabstop>
-  <tabstop>BtnCancel</tabstop>
- </tabstops>
  <resources/>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/refdlg.cpp RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/refdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/refdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/refdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -14,39 +14,40 @@
 static const QChar degreeChar(0260);           // character code of degree (UTF-8)
 
 //---------------------------------------------------------------------------
-RefDialog::RefDialog(QWidget *parent)
+RefDialog::RefDialog(QWidget* parent)
     : QDialog(parent)
 {
     setupUi(this);
 
-    Pos[0] = Pos[1] = Pos[2] = RovPos[0] = RovPos[1] = RovPos[2] = 0.0;
+    Pos[0]=Pos[1]=Pos[2]=RovPos[0]=RovPos[1]=RovPos[2]=0.0;
 
-    connect(StaList, SIGNAL(cellDoubleClicked(int,int)), this, SLOT(StaListDblClick(int,int)));
-    connect(BtnOK, SIGNAL(clicked(bool)), this, SLOT(BtnOKClick()));
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(BtnFind, SIGNAL(clicked(bool)), this, SLOT(BtnFindClick()));
-    connect(BtnLoad, SIGNAL(clicked(bool)), this, SLOT(BtnLoadClick()));
-    connect(FindStr, SIGNAL(returnPressed()), this, SLOT(FindList()));
+    connect(StaList,SIGNAL(cellDoubleClicked(int,int)),this,SLOT(StaListDblClick(int,int)));
+    connect(BtnOK,SIGNAL(clicked(bool)),this,SLOT(BtnOKClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(BtnFind,SIGNAL(clicked(bool)),this,SLOT(BtnFindClick()));
+    connect(BtnLoad,SIGNAL(clicked(bool)),this,SLOT(BtnLoadClick()));
+    connect(FindStr,SIGNAL(returnPressed()),this,SLOT(FindList()));
 }
 //---------------------------------------------------------------------------
-void RefDialog::showEvent(QShowEvent *event)
+void  RefDialog::showEvent(QShowEvent* event)
 {
-    int width[] = { 30, 80, 90, 65, 40, 70, 55 };
+    int width[]={30,80,90,65,40,70,55};
 
     if (event->spontaneous()) return;
 
     QStringList columns;
-    columns << tr("No") << tr("Latitude(%1)").arg(degreeChar) << tr("Longitude(%1)").arg(degreeChar) << tr("Height(m)") << tr("Id") << tr("Name") << tr("Dist(km)");
+    columns<<tr("No")<<tr("Latitude(%1)").arg(degreeChar)<<tr("Longitude(%1)").arg(degreeChar)<<tr("Height(m)")<<tr("Id")<<tr("Name")<<tr("Dist(km)");
     StaList->setColumnCount(columns.size());
     StaList->setRowCount(2);
 
-    for (int i = 0; i < columns.size(); i++)
-        for (int j = 0; j < 2; j++)
-            StaList->setItem(i, j, new QTableWidgetItem(""));
+    for (int i=0;i<columns.size();i++)
+        for (int j=0;j<2;j++)
+            StaList->setItem(i,j,new QTableWidgetItem(""));
 
-    FontScale = 2 * physicalDpiX();
-    for (int i = 0; i < columns.size(); i++)
-        StaList->setColumnWidth(i, width[i] * FontScale / 96);
+    FontScale=2*physicalDpiX();    
+    for (int i=0;i<columns.size();i++) {
+        StaList->setColumnWidth(i,width[i]*FontScale/96);
+    }
 
     StaList->setHorizontalHeaderLabels(columns);
 
@@ -55,55 +56,54 @@
     StaList->sortItems(6);
 }
 //---------------------------------------------------------------------------
-void RefDialog::StaListDblClick(int, int row)
+void RefDialog::StaListDblClick(int , int row)
 {
-    Pos[0] = StaList->item(row, 1)->text().toDouble();
-    Pos[1] = StaList->item(row, 2)->text().toDouble();
-    Pos[2] = StaList->item(row, 3)->text().toDouble();
+    Pos[0]=StaList->item(row,1)->text().toDouble();
+    Pos[1]=StaList->item(row,2)->text().toDouble();
+    Pos[2]=StaList->item(row,3)->text().toDouble();
 
     accept();
 }
 //---------------------------------------------------------------------------
-void RefDialog::BtnOKClick()
+void  RefDialog::BtnOKClick()
 {
-    int row = StaList->currentRow();
-
-    Pos[0] = StaList->item(row, 1)->text().toDouble();
-    Pos[1] = StaList->item(row, 2)->text().toDouble();
-    Pos[2] = StaList->item(row, 3)->text().toDouble();
+    int row=StaList->currentRow();
+    Pos[0]=StaList->item(row,1)->text().toDouble();
+    Pos[1]=StaList->item(row,2)->text().toDouble();
+    Pos[2]=StaList->item(row,3)->text().toDouble();
 
     accept();
 }
 //---------------------------------------------------------------------------
-void RefDialog::BtnLoadClick()
+void  RefDialog::BtnLoadClick()
 {
-    StaPosFile = QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Load Station List..."), StaPosFile, tr("Position File (*.pos *.snx);;All (*.*)")));
+    StaPosFile=QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Load Station List..."),StaPosFile,tr("Position File (*.pos *.snx);;All (*.*)")));
 
 	LoadList();
 }
 //---------------------------------------------------------------------------
-void RefDialog::BtnFindClick()
+void  RefDialog::BtnFindClick()
 {
 	FindList();
 }
 //---------------------------------------------------------------------------
-void RefDialog::FindList(void)
+void  RefDialog::FindList(void)
 {
-    QString str = FindStr->text();
-
-    QList<QTableWidgetItem *> f = StaList->findItems(str, Qt::MatchContains);
+    QString str=FindStr->text();
+	
+    QList<QTableWidgetItem*> f= StaList->findItems(str,Qt::MatchContains);
 
     if (f.empty()) return;
 
     StaList->setCurrentItem(f.first());
 }
 //---------------------------------------------------------------------------
-void RefDialog::LoadList(void)
+void  RefDialog::LoadList(void)
 {
     QByteArray buff;
 
     double pos[3];
-    int n = 0;
+    int n=0;
 
     StaList->setRowCount(0);
 
@@ -111,133 +111,132 @@
     QFile fp(StaPosFile);
     if (!fp.open(QIODevice::ReadOnly)) return;
 
-    buff = fp.readAll();
-    if (buff.contains("%=SNX")) {
+    buff=fp.readAll();
+    if (buff.contains("%=SNX")){
 		LoadSinex();
 		return;
 	}
 
     fp.seek(0);
     while (!fp.atEnd()) {
-        buff = fp.readLine();
-        buff = buff.mid(0, buff.indexOf('%')); /* remove comments */
+        buff=fp.readLine();
+        buff=buff.mid(0,buff.indexOf('%')); /* remove comments */
 
-        QList<QByteArray> tokens = buff.simplified().split(' ');
+        QList<QByteArray> tokens=buff.simplified().split(' ');
 
-        if (tokens.size() != 5) continue;
+        if (tokens.size()!=5) continue;
 
         StaList->setRowCount(++n);
 
-        for (int i = 0; i < 3; i++)
-            pos[i] = tokens.at(i).toDouble();
+        for (int i=0;i<3;i++)
+            pos[i]=tokens.at(i).toDouble();
 
-        AddRef(n, pos, tokens.at(3), tokens.at(4));
+        AddRef(n,pos,tokens.at(3),tokens.at(4));
 	}
-    if (n == 0) StaList->setRowCount(0);
-
+	if (n==0) {
+        StaList->setRowCount(0);
+    }
 	UpdateDist();
     setWindowTitle(StaPosFile);
 }
 //---------------------------------------------------------------------------
-void RefDialog::LoadSinex(void)
+void  RefDialog::LoadSinex(void)
 {
-    int n = 0, sol = 0;
-    double rr[3], pos[3];
+    int n=0,sol=0;
+    double rr[3],pos[3];
     bool okay;
     QFile file(StaPosFile);
     QByteArray buff, code;
-
     if (!file.open(QIODevice::ReadOnly)) return;
 
     while (!file.atEnd()) {
-        buff = file.readLine();
+        buff=file.readLine();
 
-        if (buff.contains("+SOLUTION/ESTIMATE")) sol = 1;
-        if (buff.contains("-SOLUTION/ESTIMATE")) sol = 0;
+        if (buff.contains("+SOLUTION/ESTIMATE")) sol=1;
+        if (buff.contains("-SOLUTION/ESTIMATE")) sol=0;
 
-        if (!sol || buff.size() < 68) continue;
+        if (!sol||buff.size()<68) continue;
 
-        if (buff.mid(7, 4) == "STAX") {
-            rr[0] = buff.mid(47, 21).toDouble(&okay);
+        if (buff.mid(7,4)=="STAX") {
+            rr[0]=buff.mid(47,21).toDouble(&okay);
             if (!okay) continue;
-            code = buff.mid(14, 4);
+            code=buff.mid(14,4);
         }
-        if (buff.mid(7, 4) == "STAY") {
-            rr[1] = buff.mid(47, 21).toDouble(&okay);
+        if (buff.mid(7,4)=="STAY") {
+            rr[1]=buff.mid(47,21).toDouble(&okay);
             if (!okay) continue;
-            if (buff.mid(14, 4) != code) continue;
+            if (buff.mid(14,4)!=code) continue;
         }
-        if (buff.mid(7, 4) == "STAZ") {
-            rr[2] = buff.mid(47, 21).toDouble(&okay);
+        if (buff.mid(7,4)=="STAZ") {
+            rr[2]=buff.mid(47,21).toDouble(&okay);
             if (!okay) continue;
-            if (buff.mid(14, 4) != code) continue;
-            ecef2pos(rr, pos);
-            pos[0] *= R2D;
-            pos[1] *= R2D;
+            if (buff.mid(14,4)!=code) continue;
+            ecef2pos(rr,pos);
+            pos[0]*=R2D;
+            pos[1]*=R2D;
             StaList->setRowCount(++n);
-            AddRef(n, pos, code, "");
+            AddRef(n,pos,code,"");
         }
-    }
-    ;
-    if (n == 0)
+    };
+	if (n==0) {
         StaList->setRowCount(0);
+    }
 
     UpdateDist();
     setWindowTitle(StaPosFile);
 }
 //---------------------------------------------------------------------------
-void RefDialog::AddRef(int n, double *pos, const QString code,
-               const QString name)
+void  RefDialog::AddRef(int n, double *pos, const QString code,
+                                   const QString name)
 {
-    int row = StaList->rowCount();
-
-    for (int i = 0; i < 7; i++)
-        StaList->setItem(row - 1, i, new QTableWidgetItem());
+    int row=StaList->rowCount();
+    for (int i=0;i<7;i++)
+        StaList->setItem(row-1,i, new QTableWidgetItem());
 
-    StaList->setItem(row - 1, 0, new QTableWidgetItem(QString::number(n)));
-    StaList->setItem(row - 1, 1, new QTableWidgetItem(QString::number(pos[0], 'f', 9)));
-    StaList->setItem(row - 1, 2, new QTableWidgetItem(QString::number(pos[1], 'f', 9)));
-    StaList->setItem(row - 1, 3, new QTableWidgetItem(QString::number(pos[2], 'f', 4)));
-    StaList->setItem(row - 1, 4, new QTableWidgetItem(code));
-    StaList->setItem(row - 1, 5, new QTableWidgetItem(name));
-    StaList->setItem(row - 1, 6, new QTableWidgetItem(""));
+    StaList->setItem(row-1, 0, new QTableWidgetItem(QString::number(n)));
+    StaList->setItem(row-1, 1, new QTableWidgetItem(QString::number(pos[0],'f',9)));
+    StaList->setItem(row-1, 2, new QTableWidgetItem(QString::number(pos[1],'f',9)));
+    StaList->setItem(row-1, 3, new QTableWidgetItem(QString::number(pos[2],'f',4)));
+    StaList->setItem(row-1, 4, new QTableWidgetItem(code));
+    StaList->setItem(row-1, 5, new QTableWidgetItem(name));
+    StaList->setItem(row-1, 6, new QTableWidgetItem(""));
 }
 //---------------------------------------------------------------------------
-int RefDialog::InputRef(void)
+int  RefDialog::InputRef(void)
 {
     bool ok;
 
-    QList<QTableWidgetItem *> sel = StaList->selectedItems();
-    int row = StaList->row(sel.first());
-    Pos[0] = StaList->item(row, 1)->text().toDouble(&ok);
-    Pos[1] = StaList->item(row, 2)->text().toDouble(&ok);
-    Pos[2] = StaList->item(row, 3)->text().toDouble(&ok);
-    StaId = StaList->item(row, 4)->text();
-    StaName = StaList->item(row, 5)->text();
+    QList<QTableWidgetItem*> sel=StaList->selectedItems();
+    int row=StaList->row(sel.first());
+    Pos[0]=StaList->item(row, 1)->text().toDouble(&ok);
+    Pos[1]=StaList->item(row, 2)->text().toDouble(&ok);
+    Pos[2]=StaList->item(row, 3)->text().toDouble(&ok);
+    StaId  =StaList->item(row, 4)->text();
+    StaName=StaList->item(row, 5)->text();
 	return 1;
 }
 //---------------------------------------------------------------------------
-void RefDialog::UpdateDist(void)
+void  RefDialog::UpdateDist(void)
 {
-    double pos[3], ru[3], rr[3];
+	double pos[3],ru[3],rr[3];
     bool ok;
 
-    for (int i = 0; i < 3; i++) pos[i] = RovPos[i];
+	for (int i=0;i<3;i++) pos[i]=RovPos[i];
 
-    if (norm(pos, 3) <= 0.0) return;
+	if (norm(pos,3)<=0.0) return;
 
-    pos[0] *= D2R; pos[1] *= D2R; pos2ecef(pos, ru);
+	pos[0]*=D2R; pos[1]*=D2R; pos2ecef(pos,ru);
 
-    for (int i = 1; i < StaList->rowCount(); i++) {
-        if (StaList->item(i, 1)->text() == "") continue;
+    for (int i=1;i<StaList->rowCount();i++) {
+        if (StaList->item(i,1)->text()=="") continue;
 
-        pos[0] = StaList->item(i, 1)->text().toDouble(&ok) * D2R;
-        pos[1] = StaList->item(i, 2)->text().toDouble(&ok) * D2R;
-        pos[2] = StaList->item(i, 3)->text().toDouble(&ok);
-        pos2ecef(pos, rr);
-        for (int j = 0; j < 3; j++) rr[j] -= ru[j];
+        pos[0]=StaList->item(i,1)->text().toDouble(&ok)*D2R;
+        pos[1]=StaList->item(i,2)->text().toDouble(&ok)*D2R;
+        pos[2]=StaList->item(i,3)->text().toDouble(&ok);
+		pos2ecef(pos,rr);
+		for (int j=0;j<3;j++) rr[j]-=ru[j];
 
-        StaList->setItem(i, 6, new QTableWidgetItem(QString::number(norm(rr, 3) / 1E3, 'f', 1)));
+        StaList->setItem(i,6, new QTableWidgetItem(QString::number(norm(rr,3)/1E3,'f',1)));
 	}
 }
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/serioptdlg.cpp RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/serioptdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/serioptdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/serioptdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -9,119 +9,99 @@
 #include <QShowEvent>
 #include <QWidget>
 #include <QComboBox>
+#ifdef QEXTSERIALPORT
+#include <QtExtSerialPort/qextserialenumerator.h>
+#else
 #include <QSerialPortInfo>
+#endif
 
 //---------------------------------------------------------------------------
-SerialOptDialog::SerialOptDialog(QWidget *parent)
+ SerialOptDialog::SerialOptDialog(QWidget* parent)
     : QDialog(parent)
 {
     setupUi(this);
-    Opt = 0;
-
-    cmdOptDialog = new CmdOptDialog(this);
+	Opt=0;
 
-    connect(BtnCmd, SIGNAL(clicked()), this, SLOT(BtnCmdClick()));
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(OutTcpPort, SIGNAL(clicked(bool)), this, SLOT(OutTcpPortClick()));
+    cmdOptDialog=new CmdOptDialog(this);
 
-    UpdateEnable();
+    connect(BtnCmd,SIGNAL(clicked()),this,SLOT(BtnCmdClick()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
 }
 //---------------------------------------------------------------------------
-void SerialOptDialog::showEvent(QShowEvent *event)
+void  SerialOptDialog::showEvent(QShowEvent *event)
 {
     if (event->spontaneous()) return;
-
+	
 	UpdatePortList();
 
-    QStringList tokens = Path.split(':');
+    QStringList tokens=Path.split(':');
 
     Port->setCurrentIndex(Port->findText(tokens.first()));
 
-    if (tokens.size() < 2) return;
+    if (tokens.size()<2) return;
     BitRate->setCurrentIndex(BitRate->findText(tokens.at(1)));
 
-    if (tokens.size() < 3) return;
-    ByteSize->setCurrentIndex(tokens.at(2) == "7" ? 0 : 1);
-
-    if (tokens.size() < 4) return;
-    Parity->setCurrentIndex(tokens.at(3) == "n" ? 0 : tokens.at(3) == "e" ? 1 : 2);
+    if (tokens.size()<3) return;
+    ByteSize->setCurrentIndex(tokens.at(2)=="7"?0:1);
 
-    if (tokens.size() < 5) return;
-    StopBits->setCurrentIndex(tokens.at(4) == "1" ? 0 : 1);
+    if (tokens.size()<4) return;
+    Parity->setCurrentIndex(tokens.at(3)=="n"?0:tokens.at(3)=="e"?1:2);
 
-    if (tokens.size() < 6) return;
-    FlowCtr->setCurrentIndex(tokens.at(5).contains("off") ? 0 : tokens.at(5).contains("rts") ? 1 : 2);
+    if (tokens.size()<5) return;
+    StopBits->setCurrentIndex(tokens.at(4)=="1"?0:1);
 
-    QStringList tokens2 = tokens.at(5).split('#');
-    bool okay;
+    if (tokens.size()<6) return;
+    FlowCtr->setCurrentIndex(tokens.at(5)=="off"?0:tokens.at(5)=="rts"?1:2);
 
     BtnCmd->setVisible(Opt);
-
-    if (tokens2.size() == 2) {
-        int port = tokens2.at(1).toInt(&okay);
-        if (okay) {
-            OutTcpPort->setChecked(true);
-            TcpPort->setValue(port);
-        }
-        UpdateEnable();
-
-        return;
-    }
-    ;
-
-    OutTcpPort->setChecked(false);
-    TcpPort->setValue(-1);
-
-    UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void SerialOptDialog::BtnCmdClick()
+void  SerialOptDialog::BtnCmdClick()
 {
-    for (int i = 0; i < 2; i++) {
-        cmdOptDialog->Cmds[i] = Cmds[i];
-        cmdOptDialog->CmdEna[i] = CmdEna[i];
+	for (int i=0;i<2;i++) {
+        cmdOptDialog->Cmds[i]=Cmds[i];
+        cmdOptDialog->CmdEna[i]=CmdEna[i];
 	}
 
     cmdOptDialog->exec();
-    if (cmdOptDialog->result() != QDialog::Accepted) return;
+    if (cmdOptDialog->result()!=QDialog::Accepted) return;
 
-    for (int i = 0; i < 2; i++) {
-        Cmds[i] = cmdOptDialog->Cmds[i];
-        CmdEna[i] = cmdOptDialog->CmdEna[i];
+    for (int i=0;i<2;i++) {
+        Cmds[i]=cmdOptDialog->Cmds[i];
+        CmdEna[i]=cmdOptDialog->CmdEna[i];
 	}
 }
 //---------------------------------------------------------------------------
-void SerialOptDialog::BtnOkClick()
+void  SerialOptDialog::BtnOkClick()
 {
-    const char *parity[] = { "n", "e", "o" }, *fctr[] = { "off", "rts", "xon" };
-    QString Port_Text = Port->currentText(), BitRate_Text = BitRate->currentText();
-
-    Path = QString("%1:%2:%3:%4:%5:%6").arg(Port_Text).arg(BitRate_Text)
-           .arg(ByteSize->currentIndex() ? 8 : 7).arg(parity[Parity->currentIndex()])
-           .arg(StopBits->currentIndex() ? 2 : 1).arg(fctr[FlowCtr->currentIndex()]);
+    char const *parity[]={"n","e","o"},*fctr[]={"off","rts","xon"};
+    QString Port_Text=Port->currentText(),BitRate_Text=BitRate->currentText();
 
-    if (OutTcpPort->isChecked())
-        Path += QString("#%1").arg(TcpPort->value());
+    Path=QString("%1:%2:%3:%4:%5:%6").arg(Port_Text).arg(BitRate_Text)
+            .arg(ByteSize->currentIndex()?8:7).arg(parity[Parity->currentIndex()])
+            .arg(StopBits->currentIndex()?2:1).arg(fctr[FlowCtr->currentIndex()]);
 
     accept();
 }
 //---------------------------------------------------------------------------
-void SerialOptDialog::UpdatePortList(void)
+void  SerialOptDialog::UpdatePortList(void)
 {
     Port->clear();
-    QList<QSerialPortInfo> ports = QSerialPortInfo::availablePorts();
+#ifdef QEXTSERIALPORT
+    QList<QextPortInfo>  ports=QextSerialEnumerator::getPorts();
 
-    for (int i = 0; i < ports.size(); i++)
+    for (int i=0;i<ports.size();i++)
+    {
+        Port->addItem(ports.at(i).portName);
+    }
+#else
+    QList<QSerialPortInfo>  ports=QSerialPortInfo::availablePorts();
+
+    for (int i=0;i<ports.size();i++)
+    {
         Port->addItem(ports.at(i).portName());
+    }
+#endif
 }
 //---------------------------------------------------------------------------
-void SerialOptDialog::UpdateEnable(void)
-{
-    TcpPort->setEnabled(OutTcpPort->isChecked());
-}
-//---------------------------------------------------------------------------
-void SerialOptDialog::OutTcpPortClick()
-{
-    UpdateEnable();
-}
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/serioptdlg.h RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/serioptdlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/serioptdlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/serioptdlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -18,16 +18,14 @@
     CmdOptDialog *cmdOptDialog;
 
     void  UpdatePortList(void);
-    void UpdateEnable();
 
 public slots:
     void  BtnOkClick();
     void  BtnCmdClick();
-    void  OutTcpPortClick();
 
 public:
-    QString Path, Cmds[2];
-    int Opt, CmdEna[2];
+    QString Path,Cmds[2];
+	int Opt,CmdEna[2];
 
     explicit SerialOptDialog(QWidget*);
 };
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/serioptdlg.ui RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/serioptdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/serioptdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/serioptdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>339</width>
-    <height>169</height>
+    <width>540</width>
+    <height>156</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -265,7 +265,7 @@
      </item>
     </widget>
    </item>
-   <item row="8" column="0" colspan="4">
+   <item row="7" column="0" colspan="4">
     <widget class="QWidget" name="widget" native="true">
      <layout class="QHBoxLayout" name="horizontalLayout">
       <property name="leftMargin">
@@ -328,31 +328,8 @@
      </layout>
     </widget>
    </item>
-   <item row="7" column="3">
-    <widget class="QSpinBox" name="TcpPort"/>
-   </item>
-   <item row="7" column="0" colspan="3">
-    <widget class="QCheckBox" name="OutTcpPort">
-     <property name="text">
-      <string>Output Received Stream to  TCP Port :</string>
-     </property>
-    </widget>
-   </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>Port</tabstop>
-  <tabstop>Parity</tabstop>
-  <tabstop>BitRate</tabstop>
-  <tabstop>StopBits</tabstop>
-  <tabstop>ByteSize</tabstop>
-  <tabstop>FlowCtr</tabstop>
-  <tabstop>OutTcpPort</tabstop>
-  <tabstop>TcpPort</tabstop>
-  <tabstop>BtnCmd</tabstop>
-  <tabstop>BtnOk</tabstop>
-  <tabstop>BtnCancel</tabstop>
- </tabstops>
  <resources/>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/tcpoptdlg.cpp RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/tcpoptdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/tcpoptdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/tcpoptdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -13,122 +13,113 @@
 
 //---------------------------------------------------------------------------
 
-#define NTRIP_TIMEOUT   10000                           // response timeout (ms)
-#define NTRIP_CYCLE             50                      // processing cycle (ms)
-#define MAXSRCTBL               512000                  // max source table size (bytes)
-#define ENDSRCTBL               "ENDSOURCETABLE"        // end marker of table
-#define MAXLINE                 1024                    // max line size (byte)
+#define NTRIP_TIMEOUT	10000				// response timeout (ms)
+#define NTRIP_CYCLE		50					// processing cycle (ms)
+#define MAXSRCTBL		512000				// max source table size (bytes)
+#define ENDSRCTBL		"ENDSOURCETABLE"	// end marker of table
+#define MAXLINE			1024				// max line size (byte)
 
 //---------------------------------------------------------------------------
-TcpOptDialog::TcpOptDialog(QWidget *parent)
+ TcpOptDialog::TcpOptDialog(QWidget* parent)
     : QDialog(parent)
 {
-    setupUi(this);
+     setupUi(this);
 
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnNtrip, SIGNAL(clicked(bool)), this, SLOT(BtnNtripClick()));
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
+     connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+     connect(BtnNtrip,SIGNAL(clicked(bool)),this,SLOT(BtnNtripClick()));
+     connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+
+     Port->setValidator(new QIntValidator(this));
 }
 //---------------------------------------------------------------------------
-void TcpOptDialog::showEvent(QShowEvent *event)
+void  TcpOptDialog::showEvent(QShowEvent* event)
 {
-    QString ti[] = { tr("TCP Server Options "),  tr("TCP Client Options"),
-             tr("NTRIP Server Options"), tr("NTRIP Client Options"),
-                "NTRIP Caster Client Options",
-                "NTRIP Caster Server Options", "UDP Server Options",
-                "UDP Client Options"};
+    QString ti[]={tr("TCP Server Options "),tr("TCP Client Options"),
+                      tr("NTRIP Server Options"),tr("NTRIP Client Options")};
 
     if (event->spontaneous()) return;
 
-    Addr->clear();
-    MntPnt->clear();
-
-    for (int i = 0; i < MAXHIST; i++)
-        if (History[i] != "") Addr->addItem(History[i]);
-    for (int i = 0; i < MAXHIST; i++)
-        if (MntpHist[i] != "") MntPnt->addItem(MntpHist[i]);
-
-    int index = Path.lastIndexOf("@");
-
-    QStringList tokens= Path.mid(0,index).split(':'); // separate user and password
-    if (tokens.size() == 2)
-    {
-        User->setText(tokens.at(0));
-        Passwd->setText(tokens.at(1));
-    } else if (tokens.size() == 1)
-        User->setText(tokens.at(0));
-
-    QString url_str = Path.mid(index); // use the rest
-
-    index = url_str.lastIndexOf(":"); // separate "str"
-    Str->setText(url_str.mid(index + 1));
+    int index=Path.lastIndexOf(":");
+    QString Str_Text=Path.mid(index);
 
-    QUrl url(QString("ftp://") + url_str.mid(0,index));
+    QUrl url("ftp://"+Path.mid(0,index));
 
-    Addr->insertItem(0, url.host()); Addr->setCurrentText(url.host());
-    Port->setValue(url.port());
-    MntPnt->insertItem(0, url.path().mid(1)); MntPnt->setCurrentText(url.path().mid(1));
+    Addr->insertItem(0,url.host());Addr->setCurrentIndex(0);
+    Port->setText(QString::number(url.port()));
+    MntPnt->insertItem(0,url.path());MntPnt->setCurrentIndex(0);
+    User->setText(url.userName());
+    Passwd->setText(url.password());
+    Str->setText(Str_Text);
 
-    Addr->setEnabled((Opt >= 1 && Opt <= 3) || Opt == 7);
-    MntPnt->setEnabled(Opt >= 2 && Opt <= 4);
-    User->setEnabled(Opt >= 3 && Opt <= 4);
-    Passwd->setEnabled(Opt >= 2 && Opt <= 5);
-    Str->setEnabled(Opt == 2);
-    LabelAddr->setText(Opt >= 2 && Opt <= 5 ? tr("NTRIP Caster Host") : tr("Server Address"));
-    LabelAddr->setEnabled((Opt >= 1 && Opt <= 3) || Opt == 7);
-    LabelMntPnt->setEnabled(Opt >= 2 && Opt <= 4);
-    LabelUser->setEnabled(Opt >= 3 && Opt <= 4);
-    LabelPasswd->setEnabled(Opt >= 2 && Opt <= 5);
-    LabelStr->setEnabled(Opt == 2);
+    Addr->setEnabled(Opt>=1);
+    MntPnt->setEnabled(Opt>=2);
+    User->setEnabled(Opt==3);
+    Passwd->setEnabled(Opt>=2);
+    Str->setEnabled(Opt==2);
+    LabelAddr->setText(Opt>=2?tr("NTRIP Caster Host"):tr("TCP Server Address"));
+    LabelAddr->setEnabled(Opt>=1);
+    LabelMntPnt->setEnabled(Opt>=2);
+    LabelUser->setEnabled(Opt==3);
+    LabelPasswd->setEnabled(Opt>=2);
+    LabelStr->setEnabled(Opt==2);
 
     setWindowTitle(ti[Opt]);
 
-    BtnNtrip->setVisible(Opt == 2 || Opt == 3);
+    Addr->clear();
+    MntPnt->clear();
+	
+	for (int i=0;i<MAXHIST;i++) {
+        if (History[i]!="") Addr->addItem(History[i]);
+	}
+	for (int i=0;i<MAXHIST;i++) {
+        if (MntpHist[i]!="") MntPnt->addItem(MntpHist[i]);
+	}
+    BtnNtrip->setVisible(Opt>=2);
 }
 //---------------------------------------------------------------------------
-void TcpOptDialog::BtnOkClick()
+void  TcpOptDialog::BtnOkClick()
 {
-    QString User_Text = User->text(), Passwd_Text = Passwd->text();
-    QString Addr_Text = Addr->currentText(), Port_Text = Port->text();
-    QString MntPnt_Text = MntPnt->currentText(), Str_Text = Str->text();
-
-    Path = QString("%1:%2@%3:%4/%5:%6").arg(User_Text).arg(Passwd_Text)
-           .arg(Addr_Text).arg(Port_Text).arg(MntPnt_Text)
-           .arg(Str_Text);
+    QString User_Text=User->text(),Passwd_Text=Passwd->text();
+    QString Addr_Text=Addr->currentText(),Port_Text=Port->text();
+    QString MntPnt_Text=MntPnt->currentText(),Str_Text=Str->text();
+	
+    Path=QString("%1:%2@%3:%4/%5:%6").arg(User_Text).arg(Passwd_Text)
+            .arg(Addr_Text).arg(Port_Text).arg(MntPnt_Text)
+            .arg(Str_Text);
 
-    AddHist(Addr, History);
-    AddHist(MntPnt, MntpHist);
+	AddHist(Addr,History);
+	AddHist(MntPnt,MntpHist);
 
     accept();
 }
 //---------------------------------------------------------------------------
-void TcpOptDialog::AddHist(QComboBox *list, QString *hist)
+void  TcpOptDialog::AddHist(QComboBox *list, QString *hist)
 {
-    for (int i = 0; i < MAXHIST; i++) {
-        if (list->currentText() != hist[i]) continue;
-        for (int j = i + 1; j < MAXHIST; j++) hist[j - 1] = hist[j];
-        hist[MAXHIST - 1] = "";
+	for (int i=0;i<MAXHIST;i++) {
+        if (list->currentText()!=hist[i]) continue;
+		for (int j=i+1;j<MAXHIST;j++) hist[j-1]=hist[j];
+		hist[MAXHIST-1]="";
 	}
-    for (int i = MAXHIST - 1; i > 0; i--) hist[i] = hist[i - 1];
-    hist[0] = list->currentText();
-
+	for (int i=MAXHIST-1;i>0;i--) hist[i]=hist[i-1];
+    hist[0]=list->currentText();
+	
     list->clear();
-    for (int i = 0; i < MAXHIST; i++)
-        if (hist[i] != "") list->addItem(hist[i]);
+	for (int i=0;i<MAXHIST;i++) {
+        if (hist[i]!="") list->addItem(hist[i]);
+	}
 }
 //---------------------------------------------------------------------------
-void TcpOptDialog::BtnNtripClick()
+void  TcpOptDialog::BtnNtripClick()
 {
-    QString Addr_Text = Addr->currentText();
-    QString Port_Text = Port->text();
+    QString Addr_Text=Addr->currentText();
+    QString Port_Text=Port->text();
 
-    ExecCmd("srctblbrows_qt " + Addr_Text + ":" + Port_Text, 1);
+    ExecCmd("srctblbrows "+Addr_Text+":"+Port_Text,1);
 }
 //---------------------------------------------------------------------------
-int TcpOptDialog::ExecCmd(QString cmd, int show)
+int  TcpOptDialog::ExecCmd(QString cmd, int show)
 {
     QProcess prog;
-
     Q_UNUSED(show);
 
     prog.start(cmd); /* FIXME: show option not yet supported */
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/tcpoptdlg.h RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/tcpoptdlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/tcpoptdlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/tcpoptdlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -25,7 +25,7 @@
 
 public:
 	int Opt;
-    QString Path,History[MAXHIST], MntpHist[MAXHIST];
+    QString Path,History[MAXHIST],MntpHist[MAXHIST];
 
     explicit TcpOptDialog(QWidget* parent);
 };
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/tcpoptdlg.ui RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/tcpoptdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/tcpoptdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/tcpoptdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>518</width>
-    <height>330</height>
+    <width>438</width>
+    <height>210</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -48,12 +48,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -106,12 +100,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -122,12 +110,6 @@
    </item>
    <item row="8" column="1" colspan="4">
     <widget class="QWidget" name="widget" native="true">
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <layout class="QHBoxLayout" name="horizontalLayout">
       <property name="leftMargin">
        <number>0</number>
@@ -194,12 +176,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -213,12 +189,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -227,6 +197,19 @@
      </property>
     </widget>
    </item>
+   <item row="2" column="4">
+    <widget class="QLineEdit" name="Port">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string/>
+     </property>
+    </widget>
+   </item>
    <item row="5" column="4">
     <widget class="QLineEdit" name="Passwd">
      <property name="enabled">
@@ -256,26 +239,8 @@
      </property>
     </widget>
    </item>
-   <item row="2" column="4">
-    <widget class="QSpinBox" name="Port">
-     <property name="maximum">
-      <number>65535</number>
-     </property>
-    </widget>
-   </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>Addr</tabstop>
-  <tabstop>Port</tabstop>
-  <tabstop>MntPnt</tabstop>
-  <tabstop>User</tabstop>
-  <tabstop>Passwd</tabstop>
-  <tabstop>Str</tabstop>
-  <tabstop>BtnNtrip</tabstop>
-  <tabstop>BtnOk</tabstop>
-  <tabstop>BtnCancel</tabstop>
- </tabstops>
  <resources/>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/timedlg.cpp RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/timedlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/timedlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/timedlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -9,7 +9,7 @@
 {
     setupUi(this);
 
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(close()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(close()));
 }
 //---------------------------------------------------------------------------
 void TimeDialog::showEvent(QShowEvent *event)
@@ -17,26 +17,23 @@
     if (event->spontaneous()) return;
 
 	gtime_t utc;
-    double tow, doy;
+	double tow,doy;
 	int week;
     QString msg;
-    char s1[64], s2[64];
-
-    utc = gpst2utc(Time);
-    time2str(Time, s1, 0);
-    time2str(utc, s2, 0);
-    tow = time2gpst(Time, &week);
-    doy = time2doy(Time);
-
-    msg += QString(tr("%1 GPST\n")).arg(s1);
-    msg += QString(tr("%1 UTC\n\n")).arg(s2);
-    msg += QString(tr("GPS Week: %1\n")).arg(week);
-    msg += QString(tr("GPS Time: %1 s\n")).arg(tow, 0, 'f', 0);
-    msg += QString(tr("Day of Year: %1\n")).arg((int)floor(doy), 3);
-    msg += QString(tr("Day of Week: %1\n")).arg((int)floor(tow / 86400.0));
-    msg += QString(tr("Time of Day: %1 s\n")).arg(fmod(tow, 86400.0), 0, 'f', 0);
-    msg += QString(tr("Leap Seconds: %1 s\n")).arg(timediff(Time, utc), 0, 'f', 0);
-
+    char s1[64],s2[64];
+	utc=gpst2utc(Time);
+	time2str(Time,s1,0);
+	time2str(utc,s2,0);
+	tow=time2gpst(Time,&week);
+	doy=time2doy(Time);
+    msg+=QString(tr("%1 GPST\n")).arg(s1);
+    msg+=QString(tr("%1 UTC\n\n")).arg(s2);
+    msg+=QString(tr("GPS Week: %1\n")).arg(week);
+    msg+=QString(tr("GPS Time: %1 s\n")).arg(tow,0,'f',0);
+    msg+=QString(tr("Day of Year: %1\n")).arg((int)floor(doy),3);
+    msg+=QString(tr("Day of Week: %1\n")).arg((int)floor(tow/86400.0));
+    msg+=QString(tr("Time of Day: %1 s\n")).arg(fmod(tow,86400.0),0,'f',0);
+    msg+=QString(tr("Leap Seconds: %1 s\n")).arg(timediff(Time,utc),0,'f',0);
     Message->setText(msg);
 }
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/tspandlg.cpp RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/tspandlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/tspandlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/tspandlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -7,38 +7,38 @@
 #include "plotmain.h"
 #include "tspandlg.h"
 //---------------------------------------------------------------------------
-SpanDialog::SpanDialog(QWidget *parent)
+SpanDialog::SpanDialog(QWidget* parent)
     : QDialog(parent)
 {
     setupUi(this);
 
-    for (int i = 0; i < 3; i++) {
-        TimeEna[i] = true;
-        TimeVal[i] = true;
+	for (int i=0;i<3;i++) {
+		TimeEna[i]=true;
+		TimeVal[i]=true;
 	}
 
-    connect(TimeEndF, SIGNAL(clicked(bool)), this, SLOT(TimeEndFClick()));
-    connect(TimeIntF, SIGNAL(clicked(bool)), this, SLOT(TimeIntFClick()));
-    connect(TimeStartF, SIGNAL(clicked(bool)), this, SLOT(TimeStartFClick()));
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
+    connect(TimeEndF,SIGNAL(clicked(bool)),this,SLOT(TimeEndFClick()));
+    connect(TimeIntF,SIGNAL(clicked(bool)),this,SLOT(TimeIntFClick()));
+    connect(TimeStartF,SIGNAL(clicked(bool)),this,SLOT(TimeStartFClick()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
 }
 //---------------------------------------------------------------------------
-void SpanDialog::showEvent(QShowEvent *event)
+void SpanDialog::showEvent(QShowEvent* event)
 {
     if (event->spontaneous()) return;
 
     TimeStartF->setChecked(TimeEna[0]);
-    TimeEndF->setChecked(TimeEna[1]);
-    TimeIntF->setChecked(TimeEna[2]);
+    TimeEndF  ->setChecked(TimeEna[1]);
+    TimeIntF  ->setChecked(TimeEna[2]);
 
-    QDateTime start = QDateTime::fromTime_t(TimeStart.time); start = start.addMSecs(TimeStart.sec * 1000);
-    QDateTime end = QDateTime::fromTime_t(TimeEnd.time); start = start.addMSecs(TimeEnd.sec * 1000);
+    QDateTime start=QDateTime::fromTime_t(TimeStart.time); start=start.addSecs(TimeStart.sec);
+    QDateTime end=QDateTime::fromTime_t(TimeEnd.time); start=start.addSecs(TimeEnd.sec);
 
-    dateTime1->setTime(start.time());
-    dateTime1->setDate(start.date());
-    dateTime2->setTime(end.time());
-    dateTime2->setDate(end.date());
+    TimeY1->setTime(start.time());
+    TimeH1->setDate(start.date());
+    TimeY2->setTime(end.time());
+    TimeH2->setDate(end.date());
 
     EditTimeInt->setCurrentText(QString::number(TimeInt));
 
@@ -47,16 +47,17 @@
 //---------------------------------------------------------------------------
 void SpanDialog::BtnOkClick()
 {
-    TimeEna[0] = TimeStartF->isChecked();
-    TimeEna[1] = TimeEndF->isChecked();
-    TimeEna[2] = TimeIntF->isChecked();
+	
+    TimeEna[0]=TimeStartF->isChecked();
+    TimeEna[1]=TimeEndF  ->isChecked();
+    TimeEna[2]=TimeIntF  ->isChecked();
 
-    QDateTime start(dateTime1->dateTime());
-    QDateTime end(dateTime2->dateTime());
+    QDateTime start(TimeY1->date(),TimeH1->time());
+    QDateTime end(TimeY2->date(),TimeH2->time());
 
-    TimeStart.time = start.toTime_t(); TimeStart.sec = start.time().msec() / 1000;
-    TimeEnd.time = end.toTime_t(); TimeEnd.sec = end.time().msec() / 1000;
-    TimeInt = EditTimeInt->currentText().toDouble();
+    TimeStart.time=start.toTime_t();TimeStart.sec=start.time().msec()/1000;
+    TimeEnd.time=end.toTime_t();TimeEnd.sec=end.time().msec()/1000;
+    TimeInt=EditTimeInt->currentText().toDouble();
 
     accept();
 }
@@ -78,11 +79,14 @@
 //---------------------------------------------------------------------------
 void SpanDialog::UpdateEnable(void)
 {
-    dateTime1->setEnabled(TimeStartF->isChecked() && TimeVal[0]);
-    dateTime2->setEnabled(TimeEndF->isChecked() && TimeVal[1]);
-    EditTimeInt->setEnabled(TimeIntF->isChecked() && TimeVal[2]);
-    TimeStartF->setEnabled(TimeVal[0] == 1);
-    TimeEndF->setEnabled(TimeVal[1] == 1);
-    TimeIntF->setEnabled(TimeVal[2] == 1);
+    TimeY1  ->setEnabled   (TimeStartF->isChecked()&&TimeVal[0]);
+    TimeH1  ->setEnabled   (TimeStartF->isChecked()&&TimeVal[0]);
+    TimeY2  ->setEnabled   (TimeEndF  ->isChecked()&&TimeVal[1]);
+    TimeH2  ->setEnabled   (TimeEndF  ->isChecked()&&TimeVal[1]);
+    EditTimeInt->setEnabled(TimeIntF  ->isChecked()&&TimeVal[2]);
+    TimeStartF->setEnabled (TimeVal[0]==1);
+    TimeEndF  ->setEnabled (TimeVal[1]==1);
+    TimeIntF  ->setEnabled (TimeVal[2]==1);
 }
 //---------------------------------------------------------------------------
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/tspandlg.h RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/tspandlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/tspandlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/tspandlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -28,8 +28,8 @@
     void UpdateEnable(void);
 
 public:
-    int TimeEna[3], TimeVal[3];
-    gtime_t TimeStart, TimeEnd;
+	int TimeEna[3],TimeVal[3];
+	gtime_t TimeStart,TimeEnd;
 	double TimeInt;
 
     explicit SpanDialog(QWidget* parent);
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/tspandlg.ui RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/tspandlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/tspandlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/tspandlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>405</width>
-    <height>154</height>
+    <width>423</width>
+    <height>156</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -45,7 +45,20 @@
      </property>
     </widget>
    </item>
-   <item row="2" column="0">
+   <item row="0" column="1">
+    <widget class="QDateEdit" name="TimeY1">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="displayFormat">
+      <string>dd.MM.yyyy</string>
+     </property>
+    </widget>
+   </item>
+   <item row="1" column="0">
     <widget class="QCheckBox" name="TimeEndF">
      <property name="toolTip">
       <string/>
@@ -58,7 +71,20 @@
      </property>
     </widget>
    </item>
-   <item row="3" column="0">
+   <item row="1" column="1">
+    <widget class="QDateEdit" name="TimeY2">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="displayFormat">
+      <string>dd.MM.yyyy</string>
+     </property>
+    </widget>
+   </item>
+   <item row="2" column="0">
     <widget class="QCheckBox" name="TimeIntF">
      <property name="toolTip">
       <string/>
@@ -71,7 +97,7 @@
      </property>
     </widget>
    </item>
-   <item row="4" column="1">
+   <item row="3" column="1">
     <widget class="QPushButton" name="BtnOk">
      <property name="enabled">
       <bool>true</bool>
@@ -90,7 +116,7 @@
      </property>
     </widget>
    </item>
-   <item row="3" column="1">
+   <item row="2" column="1">
     <widget class="QComboBox" name="EditTimeInt">
      <property name="enabled">
       <bool>true</bool>
@@ -175,36 +201,36 @@
      </item>
     </widget>
    </item>
-   <item row="4" column="2">
-    <widget class="QPushButton" name="BtnCancel">
+   <item row="1" column="2">
+    <widget class="QTimeEdit" name="TimeH2">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text">
-      <string>&amp;Cancel</string>
-     </property>
     </widget>
    </item>
-   <item row="0" column="1" colspan="2">
-    <widget class="QDateTimeEdit" name="dateTime1">
-     <property name="calendarPopup">
+   <item row="0" column="2">
+    <widget class="QTimeEdit" name="TimeH1">
+     <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="timeSpec">
-      <enum>Qt::LocalTime</enum>
+     <property name="toolTip">
+      <string/>
      </property>
     </widget>
    </item>
-   <item row="2" column="1" colspan="2">
-    <widget class="QDateTimeEdit" name="dateTime2">
-     <property name="calendarPopup">
+   <item row="3" column="2">
+    <widget class="QPushButton" name="BtnCancel">
+     <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="timeSpec">
-      <enum>Qt::LocalTime</enum>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>&amp;Cancel</string>
      </property>
     </widget>
    </item>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/viewer.cpp RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/viewer.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/viewer.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/viewer.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -11,37 +11,38 @@
 #include "viewer.h"
 #include "vieweropt.h"
 
-QColor TextViewer::Color1 = Qt::black, TextViewer::Color2 = Qt::black;
+QColor TextViewer::Color1=Qt::black,TextViewer::Color2=Qt::black;
 QFont TextViewer::FontD;
 
 //---------------------------------------------------------------------------
-TextViewer::TextViewer(QWidget *parent)
+TextViewer::TextViewer(QWidget* parent)
     : QDialog(parent)
 {
     setupUi(this);
 
-    Option = 1;
+	Option=1;
 
-    viewerOptDialog = new ViewerOptDialog(this);
+    viewerOptDialog=new ViewerOptDialog(this);
 
-    connect(BtnClose, SIGNAL(clicked(bool)), this, SLOT(BtnCloseClick()));
-    connect(BtnFind, SIGNAL(clicked(bool)), this, SLOT(BtnFindClick()));
-    connect(BtnOpt, SIGNAL(clicked(bool)), this, SLOT(BtnOptClick()));
-    connect(BtnRead, SIGNAL(clicked(bool)), this, SLOT(BtnReadClick()));
-    connect(BtnReload, SIGNAL(clicked(bool)), this, SLOT(BtnReloadClick()));
-    connect(FindStr, SIGNAL(editingFinished()), this, SLOT(BtnFindClick()));
+    connect(BtnClose,SIGNAL(clicked(bool)),this,SLOT(BtnCloseClick()));
+    connect(BtnFind,SIGNAL(clicked(bool)),this,SLOT(BtnFindClick()));
+    connect(BtnOpt,SIGNAL(clicked(bool)),this,SLOT(BtnOptClick()));
+    connect(BtnRead,SIGNAL(clicked(bool)),this,SLOT(BtnReadClick()));
+    connect(BtnReload,SIGNAL(clicked(bool)),this,SLOT(BtnReloadClick()));
+    connect(FindStr,SIGNAL(editingFinished()),this,SLOT(BtnFindClick()));
 }
 //---------------------------------------------------------------------------
 void TextViewer::showEvent(QShowEvent *event)
 {
     if (event->spontaneous()) return;
 
-    if (Option == 0) {
+	if (Option==0) {
         BtnReload->setVisible(false);
-        BtnRead->setVisible(false);
-    } else if (Option == 2) {
+        BtnRead  ->setVisible(false);
+	}
+	else if (Option==2) {
         BtnReload->setVisible(false);
-        BtnRead->setText(tr("Save..."));
+        BtnRead  ->setText(tr("Save..."));
 	}
 
 	UpdateText();
@@ -54,27 +55,29 @@
 //---------------------------------------------------------------------------
 void TextViewer::BtnReadClick()
 {
-    if (BtnRead->text() == tr("Save..."))
-        Save(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, QString(), File)));
-    else
-        Read(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, QString(), File)));
+    if (BtnRead->text()==tr("Save...")) {
+        Save(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this,QString(),File)));
+	}
+	else {
+        Read(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,QString(),File)));
+	}
 }
 //---------------------------------------------------------------------------
 void TextViewer::BtnOptClick()
 {
-    viewerOptDialog->Font = FontD;
-    viewerOptDialog->Color1 = Color1;
-    viewerOptDialog->Color2 = Color2;
+    viewerOptDialog->Font=FontD;
+    viewerOptDialog->Color1=Color1;
+    viewerOptDialog->Color2=Color2;
 
-    viewerOptDialog->move(this->size().width() / 2 - viewerOptDialog->size().width() / 2,
-                  this->size().height() / 2 - viewerOptDialog->size().height() / 2);
+    viewerOptDialog->move(this->size().width()/2-viewerOptDialog->size().width()/2,
+        this->size().height()/2-viewerOptDialog->size().height()/2);
     viewerOptDialog->exec();
 
-    if (viewerOptDialog->result() != QDialog::Accepted) return;
+    if (viewerOptDialog->result()!=QDialog::Accepted) return;
 
-    FontD = viewerOptDialog->Font;
-    Color1 = viewerOptDialog->Color1;
-    Color2 = viewerOptDialog->Color2;
+    FontD=viewerOptDialog->Font;
+    Color1=viewerOptDialog->Color1;
+    Color2=viewerOptDialog->Color2;
 
 	UpdateText();
 }
@@ -91,20 +94,19 @@
 //---------------------------------------------------------------------------
 bool TextViewer::Read(const QString &path)
 {
-    char file[256], *p[] = { file };
-
-    if (expath(qPrintable(path), p, 1) < 1) return false;
+    char file[256],*p[]={file};
+    if (expath(qPrintable(path),p,1)<1) return false;
 
     QFile f(file);
 
     if (!f.open(QIODevice::ReadOnly)) return false;
     Text->setPlainText("");
 
-    TextStr = f.readAll();
+    TextStr=f.readAll();
     Text->appendPlainText(TextStr);
 
     setWindowTitle(file);
-    File = file;
+	File=file;
 
     return true;
 }
@@ -116,7 +118,7 @@
     if (!f.open(QIODevice::WriteOnly)) return false;
 
     f.write(Text->toPlainText().toLocal8Bit());
-    File = file;
+	File=file;
 
     return true;
 }
@@ -126,9 +128,10 @@
     QPalette pal;
 
     Text->setFont(FontD);
-    pal = Text->palette();
-    pal.setColor(QPalette::Text, Color1);
-    pal.setColor(QPalette::Base, Color2);
+    pal=Text->palette();
+    pal.setColor(QPalette::Text,Color1);
+    pal.setColor(QPalette::Base,Color2); //check this
     Text->setPalette(pal);
 }
 //---------------------------------------------------------------------------
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/viewer.h RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/viewer.h
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/viewer.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/viewer.h	2019-08-19 02:04:50.000000000 +0300
@@ -18,7 +18,6 @@
     void showEvent(QShowEvent*);
 
     ViewerOptDialog *viewerOptDialog;
-
 public slots:
     void BtnCloseClick();
     void BtnReadClick();
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/vieweropt.cpp RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/vieweropt.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/vieweropt.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/vieweropt.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -10,23 +10,21 @@
 
 #include "viewer.h"
 #include "vieweropt.h"
-
 //---------------------------------------------------------------------------
-QString ViewerOptDialog::color2String(const QColor &c)
-{
+QString ViewerOptDialog::color2String(const QColor &c){
     return QString("rgb(%1,%2,%3)").arg(c.red()).arg(c.green()).arg(c.blue());
 }
 //---------------------------------------------------------------------------
-ViewerOptDialog::ViewerOptDialog(QWidget *parent)
+ViewerOptDialog::ViewerOptDialog(QWidget* parent)
     : QDialog(parent)
 {
     setupUi(this);
 
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnFont, SIGNAL(clicked(bool)), this, SLOT(BtnFontClick()));
-    connect(BtnColor1, SIGNAL(clicked(bool)), this, SLOT(BtnColor1Click()));
-    connect(BtnColor2, SIGNAL(clicked(bool)), this, SLOT(BtnColor2Click()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnFont,SIGNAL(clicked(bool)),this,SLOT(BtnFontClick()));
+    connect(BtnColor1,SIGNAL(clicked(bool)),this,SLOT(BtnColor1Click()));
+    connect(BtnColor2,SIGNAL(clicked(bool)),this,SLOT(BtnColor2Click()));
 }
 //---------------------------------------------------------------------------
 void ViewerOptDialog::showEvent(QShowEvent *event)
@@ -34,7 +32,7 @@
     if (event->spontaneous()) return;
 
     FontLabel->setFont(Font);
-    FontLabel->setText(Font.family() + QString::number(Font.pointSize()) + " px");
+    FontLabel->setText(Font.family()+QString::number(Font.pointSize())+" px");
 
     lbColor1->setStyleSheet(QString("background-color: %1").arg(color2String(Color1)));
     lbColor2->setStyleSheet(QString("background-color: %1").arg(color2String(Color2)));
@@ -49,9 +47,9 @@
 {
     QColorDialog d;
 
-    d.setCurrentColor(Color1);
+    d.setCurrentColor(Color1);    
     d.exec();
-    Color1 = d.selectedColor();
+    Color1=d.selectedColor();
 
     lbColor1->setStyleSheet(QString("background-color: %1").arg(color2String(Color1)));
 }
@@ -62,7 +60,7 @@
 
     d.setCurrentColor(Color2);
     d.exec();
-    Color2 = d.selectedColor();
+    Color2=d.selectedColor();
 
     lbColor2->setStyleSheet(QString("background-color: %1").arg(color2String(Color2)));
 }
@@ -70,13 +68,12 @@
 void ViewerOptDialog::BtnFontClick()
 {
     QFontDialog d;
-
     d.setCurrentFont(Font);
     d.exec();
 
-    Font = d.selectedFont();
+    Font=d.selectedFont();
 
     FontLabel->setFont(Font);
-    FontLabel->setText(Font.family() + QString::number(Font.pointSize()) + "pt");
+    FontLabel->setText(Font.family()+QString::number(Font.pointSize())+ "pt");
 }
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/viewer.ui RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/viewer.ui
--- RTKLIB-rtklib_2.4.3_orig/app/appcmn_qt/viewer.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/appcmn_qt/viewer.ui	2019-08-19 02:04:50.000000000 +0300
@@ -72,7 +72,7 @@
          <string/>
         </property>
         <property name="text">
-         <string>&amp;Find</string>
+         <string>Find</string>
         </property>
        </widget>
       </item>
@@ -107,7 +107,7 @@
          <string/>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="../srctblbrows_qt/srctblbrows_qt.qrc">
           <normaloff>:/buttons/reload.bmp</normaloff>:/buttons/reload.bmp</iconset>
         </property>
         <property name="flat">
@@ -169,7 +169,7 @@
   </layout>
  </widget>
  <resources>
-  <include location="../rtkconv_qt/rtkconv_qt.qrc"/>
+  <include location="../srctblbrows_qt/srctblbrows_qt.qrc"/>
  </resources>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/app.pri RTKLIB-rtklib_2.4.3_new/app/app.pri
--- RTKLIB-rtklib_2.4.3_orig/app/app.pri	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/app.pri	1970-01-01 03:00:00.000000000 +0300
@@ -1,21 +0,0 @@
-include(../RTKLib.pri)
-
-# save root directory
-ROOT_DIRECTORY = $${PWD}/../
-OUTPUT_DIRECTORY = $${OUT_PWD}
-
-LIBS += -L$${ROOT_DIRECTORY}/lib/ -lRTKLib
-
-IERS_MODEL {
-    LIBS += -liers -lgfortran
-}
-
-win* {
-    LIBS += -lws2_32 -lwinmm
-}
-
-QMAKE_RPATHDIR *= $${ROOT_DIRECTORY}/lib
-
-PRE_TARGETDEPS = $${ROOT_DIRECTORY}/src/rtklib.h
-
-CONFIG += c++11
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/app.pro RTKLIB-rtklib_2.4.3_new/app/app.pro
--- RTKLIB-rtklib_2.4.3_orig/app/app.pro	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/app.pro	2019-08-19 02:04:50.000000000 +0300
@@ -7,6 +7,4 @@
          rtklaunch_qt \
          srctblbrows_qt \
          strsvr_qt \
-         rtkconv_qt \
-         rtkvideo_qt \
-         rtkvplayer_qt
+         rtkconv_qt
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/convbin/convbin.c RTKLIB-rtklib_2.4.3_new/app/convbin/convbin.c
--- RTKLIB-rtklib_2.4.3_orig/app/convbin/convbin.c	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/convbin/convbin.c	2019-08-19 02:04:50.000000000 +0300
@@ -178,7 +178,7 @@
     exit(0);
 }
 /* show message --------------------------------------------------------------*/
-extern int showmsg(const char *format, ...)
+extern int showmsg(char *format, ...)
 {
     va_list arg;
     va_start(arg,format); vfprintf(stderr,format,arg); va_end(arg);
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/.gitignore RTKLIB-rtklib_2.4.3_new/app/.gitignore
--- RTKLIB-rtklib_2.4.3_orig/app/.gitignore	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/.gitignore	1970-01-01 03:00:00.000000000 +0300
@@ -1 +0,0 @@
-*.trace
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/makefile RTKLIB-rtklib_2.4.3_new/app/makefile
--- RTKLIB-rtklib_2.4.3_orig/app/makefile	1970-01-01 03:00:00.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/makefile	2019-08-19 02:04:50.000000000 +0300
@@ -0,0 +1,18 @@
+#
+# make all cui applications by gcc
+#
+
+BINDIR = /usr/local/bin
+DIRS   = pos2kml str2str rnx2rtkp convbin rtkrcv
+
+all:
+	@for i in $(DIRS); do make -C $$i/gcc; done
+
+install:
+	@echo installing...
+	@for i in $(DIRS); do cp $$i/gcc/$$i $(BINDIR); done
+
+clean:
+	@echo cleaning up...
+	@for i in $(DIRS); do make -C $$i/gcc clean; done
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rnx2rtkp/rnx2rtkp.c RTKLIB-rtklib_2.4.3_new/app/rnx2rtkp/rnx2rtkp.c
--- RTKLIB-rtklib_2.4.3_orig/app/rnx2rtkp/rnx2rtkp.c	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rnx2rtkp/rnx2rtkp.c	2019-08-19 02:04:50.000000000 +0300
@@ -73,7 +73,7 @@
 " -x level  debug trace level (0:off) [0]"
 };
 /* show message --------------------------------------------------------------*/
-extern int showmsg(const char *format, ...)
+extern int showmsg(char *format, ...)
 {
     va_list arg;
     va_start(arg,format); vfprintf(stderr,format,arg); va_end(arg);
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkconv/convmain.cpp RTKLIB-rtklib_2.4.3_new/app/rtkconv/convmain.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkconv/convmain.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkconv/convmain.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -44,7 +44,7 @@
 
 // show message in message area ---------------------------------------------
 extern "C" {
-extern int showmsg(const char *format,...)
+extern int showmsg(char *format,...)
 {
 	static int i=0;
 	va_list arg;
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/codeopt.cpp RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/codeopt.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/codeopt.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/codeopt.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -11,203 +11,201 @@
 {
     setupUi(this);
 
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnSetAll, SIGNAL(clicked(bool)), this, SLOT(BtnSetAllClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnSetAll,SIGNAL(clicked(bool)),this,SLOT(BtnSetAllClick()));
 }
 //---------------------------------------------------------------------------
-void CodeOptDialog::showEvent(QShowEvent *event)
+void CodeOptDialog::showEvent(QShowEvent* event)
 {
     if (event->spontaneous()) return;
 
-    char mask[7][64] = { "" };
-
-    for (int i = 0; i < 7; i++) strcpy(mask[i], qPrintable(convOptDialog->CodeMask[i]));
-
-    G01->setChecked(mask[0][0] == '1');
-    G02->setChecked(mask[0][1] == '1');
-    G03->setChecked(mask[0][2] == '1');
-    G04->setChecked(mask[0][3] == '1');
-    G05->setChecked(mask[0][4] == '1');
-    G06->setChecked(mask[0][5] == '1');
-    G07->setChecked(mask[0][6] == '1');
-    G08->setChecked(mask[0][7] == '1');
-    G14->setChecked(mask[0][13] == '1');
-    G15->setChecked(mask[0][14] == '1');
-    G16->setChecked(mask[0][15] == '1');
-    G17->setChecked(mask[0][16] == '1');
-    G18->setChecked(mask[0][17] == '1');
-    G19->setChecked(mask[0][18] == '1');
-    G20->setChecked(mask[0][19] == '1');
-    G21->setChecked(mask[0][20] == '1');
-    G22->setChecked(mask[0][21] == '1');
-    G23->setChecked(mask[0][22] == '1');
-    G24->setChecked(mask[0][23] == '1');
-    G25->setChecked(mask[0][24] == '1');
-    G26->setChecked(mask[0][25] == '1');
-    R01->setChecked(mask[1][0] == '1');
-    R02->setChecked(mask[1][1] == '1');
-    R14->setChecked(mask[1][13] == '1');
-    R19->setChecked(mask[1][18] == '1');
-    R44->setChecked(mask[1][43] == '1');
-    R45->setChecked(mask[1][44] == '1');
-    R46->setChecked(mask[1][45] == '1');
-    E01->setChecked(mask[2][0] == '1');
-    E10->setChecked(mask[2][9] == '1');
-    E11->setChecked(mask[2][10] == '1');
-    E12->setChecked(mask[2][11] == '1');
-    E13->setChecked(mask[2][12] == '1');
-    E24->setChecked(mask[2][23] == '1');
-    E25->setChecked(mask[2][24] == '1');
-    E26->setChecked(mask[2][25] == '1');
-    E27->setChecked(mask[2][26] == '1');
-    E28->setChecked(mask[2][27] == '1');
-    E29->setChecked(mask[2][28] == '1');
-    E30->setChecked(mask[2][29] == '1');
-    E31->setChecked(mask[2][30] == '1');
-    E32->setChecked(mask[2][31] == '1');
-    E33->setChecked(mask[2][32] == '1');
-    E34->setChecked(mask[2][33] == '1');
-    E37->setChecked(mask[2][36] == '1');
-    E38->setChecked(mask[2][37] == '1');
-    E39->setChecked(mask[2][38] == '1');
-    J01->setChecked(mask[3][0] == '1');
-    J07->setChecked(mask[3][6] == '1');
-    J08->setChecked(mask[3][7] == '1');
-    J13->setChecked(mask[3][12] == '1');
-    J12->setChecked(mask[3][11] == '1');
-    J16->setChecked(mask[3][15] == '1');
-    J17->setChecked(mask[3][16] == '1');
-    J18->setChecked(mask[3][17] == '1');
-    J24->setChecked(mask[3][23] == '1');
-    J25->setChecked(mask[3][24] == '1');
-    J26->setChecked(mask[3][25] == '1');
-    J35->setChecked(mask[3][34] == '1');
-    J36->setChecked(mask[3][35] == '1');
-    J33->setChecked(mask[3][32] == '1');
-    C47->setChecked(mask[5][46] == '1');
-    C48->setChecked(mask[5][47] == '1');
-    C12->setChecked(mask[5][11] == '1');
-    C27->setChecked(mask[5][26] == '1');
-    C28->setChecked(mask[5][27] == '1');
-    C29->setChecked(mask[5][28] == '1');
-    C42->setChecked(mask[5][41] == '1');
-    C43->setChecked(mask[5][42] == '1');
-    C33->setChecked(mask[5][32] == '1');
-    I49->setChecked(mask[6][48] == '1');
-    I50->setChecked(mask[6][49] == '1');
-    I51->setChecked(mask[6][50] == '1');
-    I26->setChecked(mask[6][25] == '1');
-    I52->setChecked(mask[6][51] == '1');
-    I53->setChecked(mask[6][52] == '1');
-    I54->setChecked(mask[6][53] == '1');
-    I55->setChecked(mask[6][54] == '1');
-    S01->setChecked(mask[4][0] == '1');
-    S24->setChecked(mask[4][23] == '1');
-    S25->setChecked(mask[4][24] == '1');
-    S26->setChecked(mask[4][25] == '1');
-
+    char mask[7][64]={""};
+	
+    for (int i=0;i<7;i++) strcpy(mask[i],qPrintable(convOptDialog->CodeMask[i]));
+    G01->setChecked(mask[0][ 0]=='1');
+    G02->setChecked(mask[0][ 1]=='1');
+    G03->setChecked(mask[0][ 2]=='1');
+    G04->setChecked(mask[0][ 3]=='1');
+    G05->setChecked(mask[0][ 4]=='1');
+    G06->setChecked(mask[0][ 5]=='1');
+    G07->setChecked(mask[0][ 6]=='1');
+    G08->setChecked(mask[0][ 7]=='1');
+    G14->setChecked(mask[0][13]=='1');
+    G15->setChecked(mask[0][14]=='1');
+    G16->setChecked(mask[0][15]=='1');
+    G17->setChecked(mask[0][16]=='1');
+    G18->setChecked(mask[0][17]=='1');
+    G19->setChecked(mask[0][18]=='1');
+    G20->setChecked(mask[0][19]=='1');
+    G21->setChecked(mask[0][20]=='1');
+    G22->setChecked(mask[0][21]=='1');
+    G23->setChecked(mask[0][22]=='1');
+    G24->setChecked(mask[0][23]=='1');
+    G25->setChecked(mask[0][24]=='1');
+    G26->setChecked(mask[0][25]=='1');
+    R01->setChecked(mask[1][ 0]=='1');
+    R02->setChecked(mask[1][ 1]=='1');
+    R14->setChecked(mask[1][13]=='1');
+    R19->setChecked(mask[1][18]=='1');
+    R44->setChecked(mask[1][43]=='1');
+    R45->setChecked(mask[1][44]=='1');
+    R46->setChecked(mask[1][45]=='1');
+    E01->setChecked(mask[2][ 0]=='1');
+    E10->setChecked(mask[2][ 9]=='1');
+    E11->setChecked(mask[2][10]=='1');
+    E12->setChecked(mask[2][11]=='1');
+    E13->setChecked(mask[2][12]=='1');
+    E24->setChecked(mask[2][23]=='1');
+    E25->setChecked(mask[2][24]=='1');
+    E26->setChecked(mask[2][25]=='1');
+    E27->setChecked(mask[2][26]=='1');
+    E28->setChecked(mask[2][27]=='1');
+    E29->setChecked(mask[2][28]=='1');
+    E30->setChecked(mask[2][29]=='1');
+    E31->setChecked(mask[2][30]=='1');
+    E32->setChecked(mask[2][31]=='1');
+    E33->setChecked(mask[2][32]=='1');
+    E34->setChecked(mask[2][33]=='1');
+    E37->setChecked(mask[2][36]=='1');
+    E38->setChecked(mask[2][37]=='1');
+    E39->setChecked(mask[2][38]=='1');
+    J01->setChecked(mask[3][ 0]=='1');
+    J07->setChecked(mask[3][ 6]=='1');
+    J08->setChecked(mask[3][ 7]=='1');
+    J13->setChecked(mask[3][12]=='1');
+    J12->setChecked(mask[3][11]=='1');
+    J16->setChecked(mask[3][15]=='1');
+    J17->setChecked(mask[3][16]=='1');
+    J18->setChecked(mask[3][17]=='1');
+    J24->setChecked(mask[3][23]=='1');
+    J25->setChecked(mask[3][24]=='1');
+    J26->setChecked(mask[3][25]=='1');
+    J35->setChecked(mask[3][34]=='1');
+    J36->setChecked(mask[3][35]=='1');
+    J33->setChecked(mask[3][32]=='1');
+    C47->setChecked(mask[5][46]=='1');
+    C48->setChecked(mask[5][47]=='1');
+    C12->setChecked(mask[5][11]=='1');
+    C27->setChecked(mask[5][26]=='1');
+    C28->setChecked(mask[5][27]=='1');
+    C29->setChecked(mask[5][28]=='1');
+    C42->setChecked(mask[5][41]=='1');
+    C43->setChecked(mask[5][42]=='1');
+    C33->setChecked(mask[5][32]=='1');
+    I49->setChecked(mask[6][48]=='1');
+    I50->setChecked(mask[6][49]=='1');
+    I51->setChecked(mask[6][50]=='1');
+    I26->setChecked(mask[6][25]=='1');
+    I52->setChecked(mask[6][51]=='1');
+    I53->setChecked(mask[6][52]=='1');
+    I54->setChecked(mask[6][53]=='1');
+    I55->setChecked(mask[6][54]=='1');
+    S01->setChecked(mask[4][ 0]=='1');
+    S24->setChecked(mask[4][23]=='1');
+    S25->setChecked(mask[4][24]=='1');
+    S26->setChecked(mask[4][25]=='1');
+	
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
 void CodeOptDialog::BtnOkClick()
 {
-    char mask[7][64] = { "" };
-
-    for (int i = 0; i < 7; i++)
-        for (int j = 0; j < MAXCODE; j++) mask[i][j] = '0';
-
-    if (G01->isChecked()) mask[0][0] = '1';
-    if (G02->isChecked()) mask[0][1] = '1';
-    if (G03->isChecked()) mask[0][2] = '1';
-    if (G04->isChecked()) mask[0][3] = '1';
-    if (G05->isChecked()) mask[0][4] = '1';
-    if (G06->isChecked()) mask[0][5] = '1';
-    if (G07->isChecked()) mask[0][6] = '1';
-    if (G08->isChecked()) mask[0][7] = '1';
-    if (G14->isChecked()) mask[0][13] = '1';
-    if (G15->isChecked()) mask[0][14] = '1';
-    if (G16->isChecked()) mask[0][15] = '1';
-    if (G17->isChecked()) mask[0][16] = '1';
-    if (G18->isChecked()) mask[0][17] = '1';
-    if (G19->isChecked()) mask[0][18] = '1';
-    if (G20->isChecked()) mask[0][19] = '1';
-    if (G21->isChecked()) mask[0][20] = '1';
-    if (G22->isChecked()) mask[0][21] = '1';
-    if (G23->isChecked()) mask[0][22] = '1';
-    if (G24->isChecked()) mask[0][23] = '1';
-    if (G25->isChecked()) mask[0][24] = '1';
-    if (G26->isChecked()) mask[0][25] = '1';
-    if (R01->isChecked()) mask[1][0] = '1';
-    if (R02->isChecked()) mask[1][1] = '1';
-    if (R14->isChecked()) mask[1][13] = '1';
-    if (R19->isChecked()) mask[1][18] = '1';
-    if (R44->isChecked()) mask[1][43] = '1';
-    if (R45->isChecked()) mask[1][44] = '1';
-    if (R46->isChecked()) mask[1][45] = '1';
-    if (E01->isChecked()) mask[2][0] = '1';
-    if (E10->isChecked()) mask[2][9] = '1';
-    if (E11->isChecked()) mask[2][10] = '1';
-    if (E12->isChecked()) mask[2][11] = '1';
-    if (E13->isChecked()) mask[2][12] = '1';
-    if (E24->isChecked()) mask[2][23] = '1';
-    if (E25->isChecked()) mask[2][24] = '1';
-    if (E26->isChecked()) mask[2][25] = '1';
-    if (E27->isChecked()) mask[2][26] = '1';
-    if (E28->isChecked()) mask[2][27] = '1';
-    if (E29->isChecked()) mask[2][28] = '1';
-    if (E30->isChecked()) mask[2][29] = '1';
-    if (E31->isChecked()) mask[2][30] = '1';
-    if (E32->isChecked()) mask[2][31] = '1';
-    if (E33->isChecked()) mask[2][32] = '1';
-    if (E34->isChecked()) mask[2][33] = '1';
-    if (E37->isChecked()) mask[2][36] = '1';
-    if (E38->isChecked()) mask[2][37] = '1';
-    if (E39->isChecked()) mask[2][38] = '1';
-    if (J01->isChecked()) mask[3][0] = '1';
-    if (J07->isChecked()) mask[3][6] = '1';
-    if (J08->isChecked()) mask[3][7] = '1';
-    if (J13->isChecked()) mask[3][12] = '1';
-    if (J12->isChecked()) mask[3][11] = '1';
-    if (J16->isChecked()) mask[3][15] = '1';
-    if (J17->isChecked()) mask[3][16] = '1';
-    if (J18->isChecked()) mask[3][17] = '1';
-    if (J24->isChecked()) mask[3][23] = '1';
-    if (J25->isChecked()) mask[3][24] = '1';
-    if (J26->isChecked()) mask[3][25] = '1';
-    if (J35->isChecked()) mask[3][34] = '1';
-    if (J36->isChecked()) mask[3][35] = '1';
-    if (J33->isChecked()) mask[3][32] = '1';
-    if (C47->isChecked()) mask[5][46] = '1';
-    if (C48->isChecked()) mask[5][47] = '1';
-    if (C12->isChecked()) mask[5][11] = '1';
-    if (C27->isChecked()) mask[5][26] = '1';
-    if (C28->isChecked()) mask[5][27] = '1';
-    if (C29->isChecked()) mask[5][28] = '1';
-    if (C42->isChecked()) mask[5][41] = '1';
-    if (C43->isChecked()) mask[5][42] = '1';
-    if (C33->isChecked()) mask[5][32] = '1';
-    if (I49->isChecked()) mask[3][48] = '1';
-    if (I50->isChecked()) mask[3][49] = '1';
-    if (I51->isChecked()) mask[3][50] = '1';
-    if (I26->isChecked()) mask[3][25] = '1';
-    if (I52->isChecked()) mask[3][51] = '1';
-    if (I53->isChecked()) mask[3][52] = '1';
-    if (I54->isChecked()) mask[3][53] = '1';
-    if (I55->isChecked()) mask[3][54] = '1';
-    if (S01->isChecked()) mask[4][0] = '1';
-    if (S24->isChecked()) mask[4][23] = '1';
-    if (S25->isChecked()) mask[4][24] = '1';
-    if (S26->isChecked()) mask[4][25] = '1';
+    char mask[7][64]={""};
+	
+    for (int i=0;i<7;i++)
+        for (int j=0;j<MAXCODE;j++) mask[i][j]='0';
+    if (G01->isChecked()) mask[0][ 0]='1';
+    if (G02->isChecked()) mask[0][ 1]='1';
+    if (G03->isChecked()) mask[0][ 2]='1';
+    if (G04->isChecked()) mask[0][ 3]='1';
+    if (G05->isChecked()) mask[0][ 4]='1';
+    if (G06->isChecked()) mask[0][ 5]='1';
+    if (G07->isChecked()) mask[0][ 6]='1';
+    if (G08->isChecked()) mask[0][ 7]='1';
+    if (G14->isChecked()) mask[0][13]='1';
+    if (G15->isChecked()) mask[0][14]='1';
+    if (G16->isChecked()) mask[0][15]='1';
+    if (G17->isChecked()) mask[0][16]='1';
+    if (G18->isChecked()) mask[0][17]='1';
+    if (G19->isChecked()) mask[0][18]='1';
+    if (G20->isChecked()) mask[0][19]='1';
+    if (G21->isChecked()) mask[0][20]='1';
+    if (G22->isChecked()) mask[0][21]='1';
+    if (G23->isChecked()) mask[0][22]='1';
+    if (G24->isChecked()) mask[0][23]='1';
+    if (G25->isChecked()) mask[0][24]='1';
+    if (G26->isChecked()) mask[0][25]='1';
+    if (R01->isChecked()) mask[1][ 0]='1';
+    if (R02->isChecked()) mask[1][ 1]='1';
+    if (R14->isChecked()) mask[1][13]='1';
+    if (R19->isChecked()) mask[1][18]='1';
+    if (R44->isChecked()) mask[1][43]='1';
+    if (R45->isChecked()) mask[1][44]='1';
+    if (R46->isChecked()) mask[1][45]='1';
+    if (E01->isChecked()) mask[2][ 0]='1';
+    if (E10->isChecked()) mask[2][ 9]='1';
+    if (E11->isChecked()) mask[2][10]='1';
+    if (E12->isChecked()) mask[2][11]='1';
+    if (E13->isChecked()) mask[2][12]='1';
+    if (E24->isChecked()) mask[2][23]='1';
+    if (E25->isChecked()) mask[2][24]='1';
+    if (E26->isChecked()) mask[2][25]='1';
+    if (E27->isChecked()) mask[2][26]='1';
+    if (E28->isChecked()) mask[2][27]='1';
+    if (E29->isChecked()) mask[2][28]='1';
+    if (E30->isChecked()) mask[2][29]='1';
+    if (E31->isChecked()) mask[2][30]='1';
+    if (E32->isChecked()) mask[2][31]='1';
+    if (E33->isChecked()) mask[2][32]='1';
+    if (E34->isChecked()) mask[2][33]='1';
+    if (E37->isChecked()) mask[2][36]='1';
+    if (E38->isChecked()) mask[2][37]='1';
+    if (E39->isChecked()) mask[2][38]='1';
+    if (J01->isChecked()) mask[3][ 0]='1';
+    if (J07->isChecked()) mask[3][ 6]='1';
+    if (J08->isChecked()) mask[3][ 7]='1';
+    if (J13->isChecked()) mask[3][12]='1';
+    if (J12->isChecked()) mask[3][11]='1';
+    if (J16->isChecked()) mask[3][15]='1';
+    if (J17->isChecked()) mask[3][16]='1';
+    if (J18->isChecked()) mask[3][17]='1';
+    if (J24->isChecked()) mask[3][23]='1';
+    if (J25->isChecked()) mask[3][24]='1';
+    if (J26->isChecked()) mask[3][25]='1';
+    if (J35->isChecked()) mask[3][34]='1';
+    if (J36->isChecked()) mask[3][35]='1';
+    if (J33->isChecked()) mask[3][32]='1';
+    if (C47->isChecked()) mask[5][46]='1';
+    if (C48->isChecked()) mask[5][47]='1';
+    if (C12->isChecked()) mask[5][11]='1';
+    if (C27->isChecked()) mask[5][26]='1';
+    if (C28->isChecked()) mask[5][27]='1';
+    if (C29->isChecked()) mask[5][28]='1';
+    if (C42->isChecked()) mask[5][41]='1';
+    if (C43->isChecked()) mask[5][42]='1';
+    if (C33->isChecked()) mask[5][32]='1';
+    if (I49->isChecked()) mask[3][48]='1';
+    if (I50->isChecked()) mask[3][49]='1';
+    if (I51->isChecked()) mask[3][50]='1';
+    if (I26->isChecked()) mask[3][25]='1';
+    if (I52->isChecked()) mask[3][51]='1';
+    if (I53->isChecked()) mask[3][52]='1';
+    if (I54->isChecked()) mask[3][53]='1';
+    if (I55->isChecked()) mask[3][54]='1';
+    if (S01->isChecked()) mask[4][ 0]='1';
+    if (S24->isChecked()) mask[4][23]='1';
+    if (S25->isChecked()) mask[4][24]='1';
+    if (S26->isChecked()) mask[4][25]='1';
 
-    for (int i = 0; i < 7; i++) convOptDialog->CodeMask[i] = mask[i];
+    for (int i=0;i<6;i++) convOptDialog->CodeMask[i]=mask[i];
 
     accept();
 }
 //---------------------------------------------------------------------------
 void CodeOptDialog::BtnSetAllClick()
 {
-    bool set = (BtnSetAll->text() == tr("&Set All"));
+    bool set=BtnSetAll->text()==tr("&Set All");
 
     G01->setChecked(set);
     G02->setChecked(set);
@@ -291,93 +289,93 @@
     S24->setChecked(set);
     S25->setChecked(set);
     S26->setChecked(set);
-
-    BtnSetAll->setText(BtnSetAll->text() == tr("&Set All") ? tr("Un&set All") : tr("&Set All"));
+    BtnSetAll->setText(BtnSetAll->text()==tr("&Set All")?tr("Un&set All"):tr("&Set All"));
 }
 //---------------------------------------------------------------------------
 void CodeOptDialog::UpdateEnable(void)
 {
-    G01->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L1));
-    G02->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L1));
-    G03->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L1));
-    G04->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L1));
-    G05->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L1));
-    G06->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L1));
-    G07->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L1));
-    G08->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L1));
-    G14->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L2));
-    G15->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L2));
-    G16->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L2));
-    G17->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L2));
-    G18->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L2));
-    G19->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L2));
-    G20->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L2));
-    G21->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L2));
-    G22->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L2));
-    G23->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L2));
-    G24->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L5));
-    G25->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L5));
-    G26->setEnabled((NavSys & SYS_GPS) && (FreqType & FREQTYPE_L5));
-    R01->setEnabled((NavSys & SYS_GLO) && (FreqType & FREQTYPE_L1));
-    R02->setEnabled((NavSys & SYS_GLO) && (FreqType & FREQTYPE_L1));
-    R14->setEnabled((NavSys & SYS_GLO) && (FreqType & FREQTYPE_L2));
-    R19->setEnabled((NavSys & SYS_GLO) && (FreqType & FREQTYPE_L2));
-    R44->setEnabled((NavSys & SYS_GLO) && (FreqType & FREQTYPE_L5));
-    R45->setEnabled((NavSys & SYS_GLO) && (FreqType & FREQTYPE_L5));
-    R46->setEnabled((NavSys & SYS_GLO) && (FreqType & FREQTYPE_L5));
-    E01->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L1));
-    E10->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L1));
-    E11->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L1));
-    E12->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L1));
-    E13->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L1));
-    E24->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L5));
-    E25->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L5));
-    E26->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L5));
-    E27->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L7));
-    E28->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L7));
-    E29->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L7));
-    E30->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L6));
-    E31->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L6));
-    E32->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L6));
-    E33->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L6));
-    E34->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L6));
-    E37->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L8));
-    E38->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L8));
-    E39->setEnabled((NavSys & SYS_GAL) && (FreqType & FREQTYPE_L8));
-    J01->setEnabled((NavSys & SYS_QZS) && (FreqType & FREQTYPE_L1));
-    J07->setEnabled((NavSys & SYS_QZS) && (FreqType & FREQTYPE_L1));
-    J08->setEnabled((NavSys & SYS_QZS) && (FreqType & FREQTYPE_L1));
-    J13->setEnabled((NavSys & SYS_QZS) && (FreqType & FREQTYPE_L1));
-    J12->setEnabled((NavSys & SYS_QZS) && (FreqType & FREQTYPE_L1));
-    J16->setEnabled((NavSys & SYS_QZS) && (FreqType & FREQTYPE_L2));
-    J17->setEnabled((NavSys & SYS_QZS) && (FreqType & FREQTYPE_L2));
-    J18->setEnabled((NavSys & SYS_QZS) && (FreqType & FREQTYPE_L2));
-    J24->setEnabled((NavSys & SYS_QZS) && (FreqType & FREQTYPE_L5));
-    J25->setEnabled((NavSys & SYS_QZS) && (FreqType & FREQTYPE_L5));
-    J26->setEnabled((NavSys & SYS_QZS) && (FreqType & FREQTYPE_L5));
-    J35->setEnabled((NavSys & SYS_QZS) && (FreqType & FREQTYPE_L6));
-    J36->setEnabled((NavSys & SYS_QZS) && (FreqType & FREQTYPE_L6));
-    J33->setEnabled((NavSys & SYS_QZS) && (FreqType & FREQTYPE_L6));
-    C47->setEnabled((NavSys & SYS_CMP) && (FreqType & FREQTYPE_L2));
-    C48->setEnabled((NavSys & SYS_CMP) && (FreqType & FREQTYPE_L2));
-    C12->setEnabled((NavSys & SYS_CMP) && (FreqType & FREQTYPE_L2));
-    C27->setEnabled((NavSys & SYS_CMP) && (FreqType & FREQTYPE_L7));
-    C28->setEnabled((NavSys & SYS_CMP) && (FreqType & FREQTYPE_L7));
-    C29->setEnabled((NavSys & SYS_CMP) && (FreqType & FREQTYPE_L7));
-    C42->setEnabled((NavSys & SYS_CMP) && (FreqType & FREQTYPE_L6));
-    C43->setEnabled((NavSys & SYS_CMP) && (FreqType & FREQTYPE_L6));
-    C33->setEnabled((NavSys & SYS_CMP) && (FreqType & FREQTYPE_L6));
-    I49->setEnabled((NavSys & SYS_IRN) && (FreqType & FREQTYPE_L5));
-    I50->setEnabled((NavSys & SYS_IRN) && (FreqType & FREQTYPE_L5));
-    I26->setEnabled((NavSys & SYS_IRN) && (FreqType & FREQTYPE_L5));
-    I51->setEnabled((NavSys & SYS_IRN) && (FreqType & FREQTYPE_L5));
-    I52->setEnabled((NavSys & SYS_IRN) && (FreqType & FREQTYPE_L9));
-    I53->setEnabled((NavSys & SYS_IRN) && (FreqType & FREQTYPE_L9));
-    I54->setEnabled((NavSys & SYS_IRN) && (FreqType & FREQTYPE_L9));
-    I55->setEnabled((NavSys & SYS_IRN) && (FreqType & FREQTYPE_L9));
-    S01->setEnabled((NavSys & SYS_SBS) && (FreqType & FREQTYPE_L1));
-    S24->setEnabled((NavSys & SYS_SBS) && (FreqType & FREQTYPE_L5));
-    S25->setEnabled((NavSys & SYS_SBS) && (FreqType & FREQTYPE_L5));
-    S26->setEnabled((NavSys & SYS_SBS) && (FreqType & FREQTYPE_L5));
+    G01->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L1));
+    G02->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L1));
+    G03->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L1));
+    G04->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L1));
+    G05->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L1));
+    G06->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L1));
+    G07->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L1));
+    G08->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L1));
+    G14->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L2));
+    G15->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L2));
+    G16->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L2));
+    G17->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L2));
+    G18->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L2));
+    G19->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L2));
+    G20->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L2));
+    G21->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L2));
+    G22->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L2));
+    G23->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L2));
+    G24->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L5));
+    G25->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L5));
+    G26->setEnabled((NavSys&SYS_GPS)&&(FreqType&FREQTYPE_L5));
+    R01->setEnabled((NavSys&SYS_GLO)&&(FreqType&FREQTYPE_L1));
+    R02->setEnabled((NavSys&SYS_GLO)&&(FreqType&FREQTYPE_L1));
+    R14->setEnabled((NavSys&SYS_GLO)&&(FreqType&FREQTYPE_L2));
+    R19->setEnabled((NavSys&SYS_GLO)&&(FreqType&FREQTYPE_L2));
+    R44->setEnabled((NavSys&SYS_GLO)&&(FreqType&FREQTYPE_L5));
+    R45->setEnabled((NavSys&SYS_GLO)&&(FreqType&FREQTYPE_L5));
+    R46->setEnabled((NavSys&SYS_GLO)&&(FreqType&FREQTYPE_L5));
+    E01->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L1));
+    E10->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L1));
+    E11->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L1));
+    E12->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L1));
+    E13->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L1));
+    E24->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L5));
+    E25->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L5));
+    E26->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L5));
+    E27->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L7));
+    E28->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L7));
+    E29->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L7));
+    E30->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L6));
+    E31->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L6));
+    E32->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L6));
+    E33->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L6));
+    E34->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L6));
+    E37->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L8));
+    E38->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L8));
+    E39->setEnabled((NavSys&SYS_GAL)&&(FreqType&FREQTYPE_L8));
+    J01->setEnabled((NavSys&SYS_QZS)&&(FreqType&FREQTYPE_L1));
+    J07->setEnabled((NavSys&SYS_QZS)&&(FreqType&FREQTYPE_L1));
+    J08->setEnabled((NavSys&SYS_QZS)&&(FreqType&FREQTYPE_L1));
+    J13->setEnabled((NavSys&SYS_QZS)&&(FreqType&FREQTYPE_L1));
+    J12->setEnabled((NavSys&SYS_QZS)&&(FreqType&FREQTYPE_L1));
+    J16->setEnabled((NavSys&SYS_QZS)&&(FreqType&FREQTYPE_L2));
+    J17->setEnabled((NavSys&SYS_QZS)&&(FreqType&FREQTYPE_L2));
+    J18->setEnabled((NavSys&SYS_QZS)&&(FreqType&FREQTYPE_L2));
+    J24->setEnabled((NavSys&SYS_QZS)&&(FreqType&FREQTYPE_L5));
+    J25->setEnabled((NavSys&SYS_QZS)&&(FreqType&FREQTYPE_L5));
+    J26->setEnabled((NavSys&SYS_QZS)&&(FreqType&FREQTYPE_L5));
+    J35->setEnabled((NavSys&SYS_QZS)&&(FreqType&FREQTYPE_L6));
+    J36->setEnabled((NavSys&SYS_QZS)&&(FreqType&FREQTYPE_L6));
+    J33->setEnabled((NavSys&SYS_QZS)&&(FreqType&FREQTYPE_L6));
+    C47->setEnabled((NavSys&SYS_CMP)&&(FreqType&FREQTYPE_L2));
+    C48->setEnabled((NavSys&SYS_CMP)&&(FreqType&FREQTYPE_L2));
+    C12->setEnabled((NavSys&SYS_CMP)&&(FreqType&FREQTYPE_L2));
+    C27->setEnabled((NavSys&SYS_CMP)&&(FreqType&FREQTYPE_L7));
+    C28->setEnabled((NavSys&SYS_CMP)&&(FreqType&FREQTYPE_L7));
+    C29->setEnabled((NavSys&SYS_CMP)&&(FreqType&FREQTYPE_L7));
+    C42->setEnabled((NavSys&SYS_CMP)&&(FreqType&FREQTYPE_L6));
+    C43->setEnabled((NavSys&SYS_CMP)&&(FreqType&FREQTYPE_L6));
+    C33->setEnabled((NavSys&SYS_CMP)&&(FreqType&FREQTYPE_L6));
+    I49->setEnabled((NavSys&SYS_CMP)&&(FreqType&FREQTYPE_L5));
+    I50->setEnabled((NavSys&SYS_CMP)&&(FreqType&FREQTYPE_L5));
+    I26->setEnabled((NavSys&SYS_CMP)&&(FreqType&FREQTYPE_L5));
+    I51->setEnabled((NavSys&SYS_CMP)&&(FreqType&FREQTYPE_L5));
+    I52->setEnabled((NavSys&SYS_CMP)&&(FreqType&FREQTYPE_L9));
+    I53->setEnabled((NavSys&SYS_CMP)&&(FreqType&FREQTYPE_L9));
+    I54->setEnabled((NavSys&SYS_CMP)&&(FreqType&FREQTYPE_L9));
+    I55->setEnabled((NavSys&SYS_CMP)&&(FreqType&FREQTYPE_L9));
+    S01->setEnabled((NavSys&SYS_SBS)&&(FreqType&FREQTYPE_L1));
+    S24->setEnabled((NavSys&SYS_SBS)&&(FreqType&FREQTYPE_L5));
+    S25->setEnabled((NavSys&SYS_SBS)&&(FreqType&FREQTYPE_L5));
+    S26->setEnabled((NavSys&SYS_SBS)&&(FreqType&FREQTYPE_L5));
 }
 //---------------------------------------------------------------------------
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/codeopt.h RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/codeopt.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/codeopt.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/codeopt.h	2019-08-19 02:04:50.000000000 +0300
@@ -8,7 +8,6 @@
 
 class QShowEvent;
 class ConvOptDialog;
-
 //---------------------------------------------------------------------------
 class CodeOptDialog : public QDialog, private Ui::CodeOptDialog
 {
@@ -16,15 +15,12 @@
 public slots:
     void BtnOkClick();
     void BtnSetAllClick();
-
 protected:
     void showEvent(QShowEvent*);
-
 private:
     void UpdateEnable(void);
 
     ConvOptDialog* convOptDialog;
-
 public:
 	int NavSys,FreqType;
     CodeOptDialog(QWidget *parent, ConvOptDialog *);
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/convmain.cpp RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/convmain.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/convmain.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/convmain.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -14,8 +14,6 @@
 //           2010/07/18  1.1 rtklib 2.4.0
 //           2011/06/10  1.2 rtklib 2.4.1
 //---------------------------------------------------------------------------
-#include <clocale>
-
 #include <QShowEvent>
 #include <QTimer>
 #include <QCommandLineParser>
@@ -45,66 +43,66 @@
 
 MainWindow *mainWindow;
 
-#define PRGNAME     "RTKCONV-QT"        // program name
-#define MAXHIST     20                  // max number of histories
-#define TSTARTMARGIN 60.0               // time margin for file name replacement
-#define TRACEFILE   "rtkconv_qt.trace"     // trace file
+#define PRGNAME     "RTKCONV-QT"  // program name
+#define MAXHIST     20         // max number of histories
+#define TSTARTMARGIN 60.0      // time margin for file name replacement
+#define TRACEFILE   "rtkconv.trace" // trace file
 
-static int abortf = 0;
+static int abortf=0;
 
 // show message in message area ---------------------------------------------
 extern "C" {
-extern int showmsg(const char *format, ...)
+extern int showmsg(char *format,...)
 {
     va_list arg;
     char buff[1024];
-
-    va_start(arg, format); vsprintf(buff, format, arg); va_end(arg);
-    QMetaObject::invokeMethod(mainWindow->Message, "setText", Qt::QueuedConnection, Q_ARG(QString, QString(buff)));
+    va_start(arg,format); vsprintf(buff,format,arg); va_end(arg);
+    QMetaObject::invokeMethod(mainWindow->Message,"setText",Qt::QueuedConnection,Q_ARG(QString,QString(buff)));
     return abortf;
 }
-extern void settime(gtime_t) {}
-extern void settspan(gtime_t, gtime_t) {}
 }
 
+
+
 // constructor --------------------------------------------------------------
 MainWindow::MainWindow(QWidget *parent)
     : QMainWindow(parent)
 {
     setupUi(this);
-    mainWindow = this;
+    mainWindow=this;
 
     TimeInt->setValidator(new QDoubleValidator());
     TimeUnit->setValidator(new QDoubleValidator());
 
-    gtime_t time0 = { 0, 0 };
+    gtime_t time0={0,0};
     int i;
 
-    setlocale(LC_NUMERIC, "C");
+    setlocale(LC_NUMERIC,"C");
     setWindowIcon(QIcon(":/icons/rtkconv_Icon.ico"));
     setAcceptDrops(true);
 
-    QString file = QApplication::applicationFilePath();
+    QString file=QApplication::applicationFilePath();
     QFileInfo fi(file);
-    IniFile = fi.absolutePath() + "/" + fi.baseName() + ".ini";
+    IniFile=fi.absolutePath()+"/"+fi.baseName()+".ini";
 
     convOptDialog = new ConvOptDialog(this);
     timeDialog = new TimeDialog(this);
     keyDialog = new KeyDialog(this);
     aboutDialog = new AboutDialog(this);
     startDialog = new StartDialog(this);
-    viewer = new TextViewer(this);
+    viewer=new TextViewer(this);
 
     Format->clear();
     Format->addItem(tr("Auto"));
-    for (i = 0; i <= MAXRCVFMT; i++)
+    for (i=0;i<=MAXRCVFMT;i++) {
         Format->addItem(formatstrs[i]);
+    }
     Format->addItem(formatstrs[STRFMT_RINEX]);
+    RnxTime=time0;
+    EventEna=0;
 
-    RnxTime = time0;
-
-    QCompleter *fileCompleter = new QCompleter(this);
-    QFileSystemModel *fileModel = new QFileSystemModel(fileCompleter);
+    QCompleter *fileCompleter=new QCompleter(this);
+    QFileSystemModel *fileModel=new QFileSystemModel(fileCompleter);
     fileModel->setRootPath("");
     fileCompleter->setModel(fileModel);
     OutFile1->setCompleter(fileCompleter);
@@ -114,69 +112,66 @@
     OutFile5->setCompleter(fileCompleter);
     OutFile6->setCompleter(fileCompleter);
     OutFile7->setCompleter(fileCompleter);
-    OutFile8->setCompleter(fileCompleter);
-    OutFile9->setCompleter(fileCompleter);
     InFile->setCompleter(fileCompleter);
 
-    QCompleter *dirCompleter = new QCompleter(this);
-    QFileSystemModel *dirModel = new QFileSystemModel(dirCompleter);
+    QCompleter *dirCompleter=new QCompleter(this);
+    QFileSystemModel *dirModel=new QFileSystemModel(dirCompleter);
     dirModel->setRootPath("");
-    dirModel->setFilter(QDir::AllDirs | QDir::Drives | QDir::NoDotAndDotDot);
+    dirModel->setFilter(QDir::AllDirs|QDir::Drives|QDir::NoDotAndDotDot);
     dirCompleter->setModel(dirModel);
     OutDir->setCompleter(dirCompleter);
 
     BtnAbort->setVisible(false);
 
-    connect(BtnPlot, SIGNAL(clicked(bool)), this, SLOT(BtnPlotClick()));
-    connect(BtnConvert, SIGNAL(clicked(bool)), this, SLOT(BtnConvertClick()));
-    connect(BtnOptions, SIGNAL(clicked(bool)), this, SLOT(BtnOptionsClick()));
-    connect(BtnExit, SIGNAL(clicked(bool)), this, SLOT(BtnExitClick()));
-    connect(BtnAbout, SIGNAL(clicked(bool)), this, SLOT(BtnAboutClick()));
-    connect(BtnTime1, SIGNAL(clicked(bool)), this, SLOT(BtnTime1Click()));
-    connect(BtnTime2, SIGNAL(clicked(bool)), this, SLOT(BtnTime2Click()));
-    connect(BtnInFile, SIGNAL(clicked(bool)), this, SLOT(BtnInFileClick()));
-    connect(BtnInFileView, SIGNAL(clicked(bool)), this, SLOT(BtnInFileViewClick()));
-    connect(BtnOutFile1, SIGNAL(clicked(bool)), this, SLOT(BtnOutFile1Click()));
-    connect(BtnOutFile2, SIGNAL(clicked(bool)), this, SLOT(BtnOutFile2Click()));
-    connect(BtnOutFile3, SIGNAL(clicked(bool)), this, SLOT(BtnOutFile3Click()));
-    connect(BtnOutFile4, SIGNAL(clicked(bool)), this, SLOT(BtnOutFile4Click()));
-    connect(BtnOutFile5, SIGNAL(clicked(bool)), this, SLOT(BtnOutFile5Click()));
-    connect(BtnOutFile6, SIGNAL(clicked(bool)), this, SLOT(BtnOutFile6Click()));
-    connect(BtnOutFile7, SIGNAL(clicked(bool)), this, SLOT(BtnOutFile7Click()));
-    connect(BtnOutFile8, SIGNAL(clicked(bool)), this, SLOT(BtnOutFile8Click()));
-    connect(BtnOutFile9, SIGNAL(clicked(bool)), this, SLOT(BtnOutFile9Click()));
-    connect(BtnOutFileView1, SIGNAL(clicked(bool)), this, SLOT(BtnOutFileView1Click()));
-    connect(BtnOutFileView2, SIGNAL(clicked(bool)), this, SLOT(BtnOutFileView2Click()));
-    connect(BtnOutFileView3, SIGNAL(clicked(bool)), this, SLOT(BtnOutFileView3Click()));
-    connect(BtnOutFileView4, SIGNAL(clicked(bool)), this, SLOT(BtnOutFileView4Click()));
-    connect(BtnOutFileView5, SIGNAL(clicked(bool)), this, SLOT(BtnOutFileView5Click()));
-    connect(BtnOutFileView6, SIGNAL(clicked(bool)), this, SLOT(BtnOutFileView6Click()));
-    connect(BtnOutFileView7, SIGNAL(clicked(bool)), this, SLOT(BtnOutFileView7Click()));
-    connect(BtnOutFileView8, SIGNAL(clicked(bool)), this, SLOT(BtnOutFileView8Click()));
-    connect(BtnOutFileView9, SIGNAL(clicked(bool)), this, SLOT(BtnOutFileView9Click()));
-    connect(BtnAbort, SIGNAL(clicked(bool)), this, SLOT(BtnAbortClick()));
-    connect(TimeStartF, SIGNAL(clicked(bool)), this, SLOT(TimeStartFClick()));
-    connect(TimeEndF, SIGNAL(clicked(bool)), this, SLOT(TimeEndFClick()));
-    connect(TimeIntF, SIGNAL(clicked(bool)), this, SLOT(TimeIntFClick()));
-    connect(TimeUnitF, SIGNAL(clicked(bool)), this, SLOT(UpdateEnable()));
-    connect(OutDirEna, SIGNAL(clicked(bool)), this, SLOT(OutDirEnaClick()));
-    connect(InFile, SIGNAL(currentIndexChanged(int)), this, SLOT(InFileChange()));
-    connect(InFile, SIGNAL(editTextChanged(QString)), this, SLOT(InFileChange()));
-    connect(Format, SIGNAL(currentIndexChanged(int)), this, SLOT(FormatChange()));
-    connect(OutDir, SIGNAL(editingFinished()), this, SLOT(OutDirChange()));
-    connect(BtnOutDir, SIGNAL(clicked(bool)), this, SLOT(BtnOutDirClick()));
-    connect(BtnKey, SIGNAL(clicked(bool)), this, SLOT(BtnKeyClick()));
-    connect(BtnPost, SIGNAL(clicked(bool)), this, SLOT(BtnPostClick()));
-    connect(OutFileEna1, SIGNAL(clicked(bool)), this, SLOT(UpdateEnable()));
-    connect(OutFileEna2, SIGNAL(clicked(bool)), this, SLOT(UpdateEnable()));
-    connect(OutFileEna3, SIGNAL(clicked(bool)), this, SLOT(UpdateEnable()));
-    connect(OutFileEna4, SIGNAL(clicked(bool)), this, SLOT(UpdateEnable()));
-    connect(OutFileEna5, SIGNAL(clicked(bool)), this, SLOT(UpdateEnable()));
-    connect(OutFileEna6, SIGNAL(clicked(bool)), this, SLOT(UpdateEnable()));
-    connect(OutFileEna7, SIGNAL(clicked(bool)), this, SLOT(UpdateEnable()));
-    connect(OutFileEna8, SIGNAL(clicked(bool)), this, SLOT(UpdateEnable()));
-    connect(OutFileEna9, SIGNAL(clicked(bool)), this, SLOT(UpdateEnable()));
+    connect(BtnPlot,SIGNAL(clicked(bool)),this,SLOT(BtnPlotClick()));
+    connect(BtnConvert,SIGNAL(clicked(bool)),this,SLOT(BtnConvertClick()));
+    connect(BtnOptions,SIGNAL(clicked(bool)),this,SLOT(BtnOptionsClick()));
+    connect(BtnExit,SIGNAL(clicked(bool)),this,SLOT(BtnExitClick()));
+    connect(BtnAbout,SIGNAL(clicked(bool)),this,SLOT(BtnAboutClick()));
+    connect(BtnTime1,SIGNAL(clicked(bool)),this,SLOT(BtnTime1Click()));
+    connect(BtnTime2,SIGNAL(clicked(bool)),this,SLOT(BtnTime2Click()));
+    connect(BtnInFile,SIGNAL(clicked(bool)),this,SLOT(BtnInFileClick()));
+    connect(BtnOutFile1,SIGNAL(clicked(bool)),this,SLOT(BtnOutFile1Click()));
+    connect(BtnOutFile2,SIGNAL(clicked(bool)),this,SLOT(BtnOutFile2Click()));
+    connect(BtnOutFile3,SIGNAL(clicked(bool)),this,SLOT(BtnOutFile3Click()));
+    connect(BtnOutFile4,SIGNAL(clicked(bool)),this,SLOT(BtnOutFile4Click()));
+    connect(BtnOutFile5,SIGNAL(clicked(bool)),this,SLOT(BtnOutFile5Click()));
+    connect(BtnOutFile6,SIGNAL(clicked(bool)),this,SLOT(BtnOutFile6Click()));
+    connect(BtnOutFile7,SIGNAL(clicked(bool)),this,SLOT(BtnOutFile7Click()));
+    connect(BtnOutFileView1,SIGNAL(clicked(bool)),this,SLOT(BtnOutFileView1Click()));
+    connect(BtnOutFileView2,SIGNAL(clicked(bool)),this,SLOT(BtnOutFileView2Click()));
+    connect(BtnOutFileView3,SIGNAL(clicked(bool)),this,SLOT(BtnOutFileView3Click()));
+    connect(BtnOutFileView4,SIGNAL(clicked(bool)),this,SLOT(BtnOutFileView4Click()));
+    connect(BtnOutFileView5,SIGNAL(clicked(bool)),this,SLOT(BtnOutFileView5Click()));
+    connect(BtnOutFileView6,SIGNAL(clicked(bool)),this,SLOT(BtnOutFileView6Click()));
+    connect(BtnOutFileView7,SIGNAL(clicked(bool)),this,SLOT(BtnOutFileView7Click()));
+    connect(BtnAbort,SIGNAL(clicked(bool)),this,SLOT(BtnAbortClick()));
+    connect(TimeStartF,SIGNAL(clicked(bool)),this,SLOT(TimeStartFClick()));
+    connect(TimeEndF,SIGNAL(clicked(bool)),this,SLOT(TimeEndFClick()));
+    connect(TimeIntF,SIGNAL(clicked(bool)),this,SLOT(TimeIntFClick()));
+    connect(TimeUnitF,SIGNAL(clicked(bool)),this,SLOT(UpdateEnable()));
+    connect(OutDirEna,SIGNAL(clicked(bool)),this,SLOT(OutDirEnaClick()));
+    connect(InFile,SIGNAL(currentIndexChanged(int)),this,SLOT(InFileChange()));
+    connect(InFile,SIGNAL(editTextChanged(QString)),this,SLOT(InFileChange()));
+    connect(Format,SIGNAL(currentIndexChanged(int)),this,SLOT(FormatChange()));
+    connect(OutDir,SIGNAL(editingFinished()),this,SLOT(OutDirChange()));
+    connect(BtnOutDir,SIGNAL(clicked(bool)),this,SLOT(BtnOutDirClick()));
+    connect(BtnKey,SIGNAL(clicked(bool)),this,SLOT(BtnKeyClick()));
+    connect(BtnPost,SIGNAL(clicked(bool)),this,SLOT(BtnPostClick()));
+    connect(BtnInFileView,SIGNAL(clicked(bool)),this,SLOT(BtnInFileViewClick()));
+    connect(OutFileEna1,SIGNAL(clicked(bool)),this,SLOT(UpdateEnable()));
+    connect(OutFileEna2,SIGNAL(clicked(bool)),this,SLOT(UpdateEnable()));
+    connect(OutFileEna3,SIGNAL(clicked(bool)),this,SLOT(UpdateEnable()));
+    connect(OutFileEna4,SIGNAL(clicked(bool)),this,SLOT(UpdateEnable()));
+    connect(OutFileEna5,SIGNAL(clicked(bool)),this,SLOT(UpdateEnable()));
+    connect(OutFileEna6,SIGNAL(clicked(bool)),this,SLOT(UpdateEnable()));
+    connect(OutFileEna7,SIGNAL(clicked(bool)),this,SLOT(UpdateEnable()));
 
+    QTimer::singleShot(100,this,SLOT(FormCreate()));
+}
+// callback on form create --------------------------------------------------
+void MainWindow::FormCreate()
+{
     setWindowTitle(QString(tr("%1 ver.%2 %3")).arg(PRGNAME).arg(VER_RTKLIB).arg(PATCH_LEVEL));
 }
 // callback on form show ----------------------------------------------------
@@ -190,102 +185,99 @@
     parser.addVersionOption();
 
     QCommandLineOption iniFileOption(QStringList() << "i",
-                     QCoreApplication::translate("main", "ini file to use"),
-                     QCoreApplication::translate("main", "ini file"));
+            QCoreApplication::translate("main", "ini file to use"),
+            QCoreApplication::translate("main", "ini file"));
     parser.addOption(iniFileOption);
 
     QCommandLineOption titleOption(QStringList() << "t",
-                       QCoreApplication::translate("main", "window title"),
-                       QCoreApplication::translate("main", "title"));
+            QCoreApplication::translate("main", "window title"),
+            QCoreApplication::translate("main", "title"));
     parser.addOption(titleOption);
 
     parser.process(*QApplication::instance());
 
     if (parser.isSet(iniFileOption))
-        IniFile = parser.value(iniFileOption);
 
+        IniFile=parser.value(iniFileOption);
     LoadOpt();
 
     if (parser.isSet(titleOption))
         setWindowTitle(parser.value(titleOption));
+
+    EventEna=1;
 }
 // callback on form close ---------------------------------------------------
-void MainWindow::closeEvent(QCloseEvent *)
+void MainWindow::closeEvent(QCloseEvent*)
 {
     SaveOpt();
 }
 // set output file paths ----------------------------------------------------
 void MainWindow::SetOutFiles(const QString &infile)
 {
-    QLineEdit *edit[] = {
-        OutFile1, OutFile2, OutFile3, OutFile4, OutFile5, OutFile6, OutFile7, OutFile8, OutFile9
+    QLineEdit *edit[]={
+        OutFile1,OutFile2,OutFile3,OutFile4,OutFile5,OutFile6,OutFile7
     };
-    QString Format_Text = Format->currentText();
-    QString OutDir_Text = OutDir->text();
-    QString ofile[10];
-    int i, lex = Format_Text.contains(tr("LEX"));
-
+    QString Format_Text=Format->currentText();
+    QString OutDir_Text=OutDir->text();
+    QString ofile[8];
+    int i,lex=Format_Text.contains("LEX");
+    
+    if (!EventEna) return;
+    
     if (OutDirEna->isChecked()) {
         QFileInfo info(infile);
 
-        ofile[0] = OutDir_Text + "/" + info.fileName();
-    } else {
-        ofile[0] = infile;
+        ofile[0]=OutDir_Text+"/"+info.fileName();
     }
-    ofile[0].replace('*', '0');
-    ofile[0].replace('?', '0');
+    else {
+        ofile[0]=infile;
+    }
+    ofile[0].replace('*','0');
+    ofile[0].replace('?','0');
 
     if (!RnxFile) {
         QFileInfo info(ofile[0]);
-        ofile[0] = info.absolutePath() + "/" + info.baseName();
-        ofile[1] = ofile[0] + ".obs";
-        ofile[2] = ofile[0] + ".nav";
-        ofile[3] = ofile[0] + ".gnav";
-        ofile[4] = ofile[0] + ".hnav";
-        ofile[5] = ofile[0] + ".qnav";
-        ofile[6] = ofile[0] + ".lnav";
-        ofile[7] = ofile[0] + ".cnav";
-        ofile[8] = ofile[0] + ".inav";
-        ofile[9] = ofile[0] + (lex ? ".lex" : ".sbs");
-    } else {
+        ofile[0]=info.absolutePath()+"/"+info.baseName();
+        ofile[1]=ofile[0]+".obs";
+        ofile[2]=ofile[0]+".nav";
+        ofile[3]=ofile[0]+".gnav";
+        ofile[4]=ofile[0]+".hnav";
+        ofile[5]=ofile[0]+".qnav";
+        ofile[6]=ofile[0]+".lnav";
+        ofile[7]=ofile[0]+(lex?".lex":".sbs");
+    }
+    else {
         QFileInfo info(ofile[0]);
-        ofile[0] = info.filePath() + "/";
-        ofile[1] += ofile[0] + QString("%%r%%n0.%%yO");
-        if (RnxVer >= 3 && NavSys && (NavSys != SYS_GPS)) /* ver.3 and mixed system */
-            ofile[2] += ofile[0] + "%%r%%n0.%%yP";
-        else
-            ofile[2] += ofile[0] + "%%r%%n0.%%yN";
-        ofile[3] += ofile[0] + "%%r%%n0.%%yG";
-        ofile[4] += ofile[0] + "%%r%%n0.%%yH";
-        ofile[5] += ofile[0] + "%%r%%n0.%%yQ";
-        ofile[6] += ofile[0] + "%%r%%n0.%%yL";
-        ofile[7] += ofile[0] + "%%r%%n0.%%yC";
-        ofile[8] += ofile[0] + "%%r%%n0.%%yI";
-        ofile[9] += ofile[0] + (lex ? "%%r%%n0_%%y.lex" : "%%r%%n0_%%y.sbs");
+        ofile[0]=info.filePath()+"/";
+        ofile[1]+=ofile[0]+QString("%%r%%n0.%%yO");
+        if (RnxVer>=3&&NavSys&&(NavSys!=SYS_GPS)) { /* ver.3 and mixed system */
+            ofile[2]+=ofile[0]+"%%r%%n0.%%yP";
+        }
+        else {
+            ofile[2]+=ofile[0]+"%%r%%n0.%%yN";
+        }
+        ofile[3]+=ofile[0]+"%%r%%n0.%%yG";
+        ofile[4]+=ofile[0]+"%%r%%n0.%%yH";
+        ofile[5]+=ofile[0]+"%%r%%n0.%%yQ";
+        ofile[6]+=ofile[0]+"%%r%%n0.%%yL";
+        ofile[7]+=ofile[0]+(lex?"%%r%%n0_%%y.lex":"%%r%%n0_%%y.sbs");
     }
-    for (i = 0; i < 9; i++) {
-        if (ofile[i + 1] == infile) ofile[i + 1] += "_";
-        ofile[i + 1] = QDir::toNativeSeparators(ofile[i + 1]);
-        edit[i]->setText(ofile[i + 1]);
+    for (i=0;i<7;i++) {
+        if (ofile[i+1]==infile) ofile[i+1]+="_";
+        edit[i]->setText(ofile[i+1]);
     }
 }
 // callback on file drag and drop -------------------------------------------
-void MainWindow::dragEnterEvent(QDragEnterEvent *event)
+void  MainWindow::dragEnterEvent(QDragEnterEvent *event)
 {
-    trace(3, "dragEnterEvent\n");
-
     if (event->mimeData()->hasFormat("text/uri-list"))
         event->acceptProposedAction();
 }
-
-// callback on file drag and drop -------------------------------------------
-void MainWindow::dropEvent(QDropEvent *event)
+void  MainWindow::dropEvent(QDropEvent *event)
 {
-    trace(3, "dropEvent\n");
-
     if (!event->mimeData()->hasFormat("text/uri-list")) return;
 
-    QString file = QDir::toNativeSeparators(QUrl(event->mimeData()->text()).toLocalFile());
+    QString file=QUrl(event->mimeData()->text()).toLocalFile();
 
     InFile->setCurrentText(file);
     SetOutFiles(InFile->currentText());
@@ -293,27 +285,23 @@
 // add history --------------------------------------------------------------
 void MainWindow::AddHist(QComboBox *combo)
 {
-    QString hist = combo->currentText();
-
-    if (hist == "") return;
-
-    int i = combo->currentIndex();
-    if (i >= 0) combo->removeItem(i);
-
-    combo->insertItem(0, hist);
-    for (int i = combo->count() - 1; i >= MAXHIST; i--) combo->removeItem(i);
-
+    QString hist=combo->currentText();
+    if (hist=="") return;
+    int i=combo->currentIndex();
+    if (i>=0) combo->removeItem(i);
+    combo->insertItem(0,hist);
+    for (int i=combo->count()-1;i>=MAXHIST;i--) combo->removeItem(i);
     combo->setCurrentIndex(0);
 }
 // read history -------------------------------------------------------------
-void MainWindow::ReadList(QComboBox *combo, QSettings *ini, const QString &key)
+void MainWindow::ReadList(QComboBox* combo, QSettings *ini, const QString &key)
 {
     QString item;
     int i;
 
-    for (i = 0; i < 100; i++) {
-        item = ini->value(QString("%1_%2").arg(key).arg(i, 3), "").toString();
-        if (item != "") combo->addItem(item); else break;
+    for (i=0;i<100;i++) {
+        item=ini->value(QString("%1_%2").arg(key).arg(i,3),"").toString();
+        if (item!="") combo->addItem(item); else break;
     }
 }
 // write history ------------------------------------------------------------
@@ -321,72 +309,75 @@
 {
     int i;
 
-    for (i = 0; i < combo->count(); i++)
-        ini->setValue(QString("%1_%2").arg(key).arg(i, 3), combo->itemText(i));
+    for (i=0;i<combo->count();i++) {
+        ini->setValue(QString("%1_%2").arg(key).arg(i,3),combo->itemText(i));
+    }
 }
 // callback on button-plot --------------------------------------------------
 void MainWindow::BtnPlotClick()
 {
-    QString file1 = OutFile1->text();
-    QString file2 = OutFile2->text();
-    QString file3 = OutFile3->text();
-    QString file4 = OutFile4->text();
-    QString file5 = OutFile5->text();
-    QString file6 = OutFile6->text();
-    QString file7 = OutFile7->text();
-    QString file8 = OutFile8->text();
-    QString file[] = { file1, file2, file3, file4, file5, file6, file7, file8};
-    QString cmd1 = "rtkplot_qt", cmd2 = "..\\..\\..\\bin\\rtkplot_qt", cmd3 = "..\\rtkplot_qt\\rtkplot_qt", opts = " -r";
-    QCheckBox *cb[] = {
-        OutFileEna1, OutFileEna2, OutFileEna3, OutFileEna4, OutFileEna5, OutFileEna6, OutFileEna7, OutFileEna8
+    QString file1=OutFile1->text();
+    QString file2=OutFile2->text();
+    QString file3=OutFile3->text();
+    QString file4=OutFile4->text();
+    QString file5=OutFile5->text();
+    QString file6=OutFile6->text();
+    QString file[]={file1,file2,file3,file4,file5,file6};
+    QString cmd1="rtkplot_Qt",cmd2="..\\..\\..\\bin\\rtkplot_qt",opts=" -r";
+    QCheckBox *cb[]={
+        OutFileEna1,OutFileEna2,OutFileEna3,OutFileEna4,OutFileEna5,OutFileEna6
     };
-    int i, ena[8];
-
-    for (i = 0; i < 8; i++) ena[i] = cb[i]->isEnabled() && cb[i]->isChecked();
-
-    for (i = 0; i < 8; i++)
-        if (ena[i]) opts = opts + " \"" + RepPath(file[i]) + "\"";
-    if (opts == " -r") return;
-
-    if (!ExecCmd(cmd1 + opts) && !ExecCmd(cmd2 + opts) && !ExecCmd(cmd3 + opts))
-        Message->setText(tr("error : rtkplot_qt execution"));
+    int i,ena[6];
+    
+    for (i=0;i<6;i++) ena[i]=cb[i]->isEnabled()&&cb[i]->isChecked();
+    
+    for (i=0;i<6;i++) {
+        if (ena[i]) opts=opts+" \""+RepPath(file[i])+"\"";
+    }
+    if (opts==" -r") return;
+    
+    if (!ExecCmd(cmd1+opts)&&!ExecCmd(cmd2+opts)) {
+        Message->setText(tr("error : rtkplot execution"));
+    }
 }
 // callback on button-post-proc ---------------------------------------------
 void MainWindow::BtnPostClick()
 {
-    QString cmd1 = CmdPostExe, cmd2 = QString("..\\..\\..\\bin\\") + CmdPostExe, cmd3 = QString("..\\rtkpost_qt\\") + CmdPostExe, opts = " ";
-
+    QString path2="..\\..\\..\\bin\\";
+    QString cmd1=CmdPostExe,cmd2=path2+CmdPostExe,opts=" ";
+    
     if (!OutFileEna1->isChecked()) return;
-
-    opts = opts + " -r \"" + OutFile1->text() + "\"";
-    opts = opts + " -n \"\" -n \"\"";
-
-    if (OutFileEna7->isChecked())
-        opts = opts + " -n \"" + OutFile7->text() + "\"";
-
-    if (TimeStartF->isChecked()) opts = opts + " -ts " + dateTime1->dateTime().toString("yyyy/MM/dd hh:mm:ss");
-    if (TimeEndF->isChecked()) opts = opts + " -te " + dateTime2->dateTime().toString("yyyy/MM/dd hh:mm:ss");
-    if (TimeIntF->isChecked()) opts = opts + " -ti " + TimeInt->currentText();
-    if (TimeUnitF->isChecked()) opts = opts + " -tu " + TimeUnit->text();
-
-    if (!ExecCmd(cmd1 + opts) && !ExecCmd(cmd2 + opts) && !ExecCmd(cmd3 + opts))
-        Message->setText(tr("error : rtkpost_qt execution"));
+    
+    opts=opts+" -r \""+OutFile1->text()+"\"";
+    opts=opts+" -n \"\" -n \"\"";
+    
+    if (OutFileEna7->isChecked()) {
+        opts=opts+" -n \""+OutFile7->text()+"\"";
+    }
+    if (TimeStartF->isChecked()) opts=opts+" -ts "+TimeY1->text()+" "+TimeH1->text();
+    if (TimeEndF  ->isChecked()) opts=opts+" -te "+TimeY2->text()+" "+TimeH2->text();
+    if (TimeIntF  ->isChecked()) opts=opts+" -ti "+TimeInt->currentText();
+    if (TimeUnitF ->isChecked()) opts=opts+" -tu "+TimeUnit->text();
+    
+    if (!ExecCmd(cmd1+opts)&&!ExecCmd(cmd2+opts)) {
+        Message->setText(tr("error : rtkpost execution"));
+    }
 }
 // callback on button-options -----------------------------------------------
 void MainWindow::BtnOptionsClick()
 {
-    int rnxfile = RnxFile;
-
+    int rnxfile=RnxFile;
     convOptDialog->exec();
-    if (convOptDialog->result() != QDialog::Accepted) return;
-    if (RnxFile != rnxfile)
+    if (convOptDialog->result()!=QDialog::Accepted) return;
+    if (RnxFile!=rnxfile) {
         SetOutFiles(InFile->currentText());
+    }
     UpdateEnable();
 }
 //---------------------------------------------------------------------------
 void MainWindow::BtnAbortClick()
 {
-    abortf = 1;
+    abortf=1;
 }
 // callback on button-convert -----------------------------------------------
 void MainWindow::BtnConvertClick()
@@ -401,29 +392,27 @@
 // callbck on button-time-1 -------------------------------------------------
 void MainWindow::BtnTime1Click()
 {
-    gtime_t ts = { 0, 0 }, te = { 0, 0 };
-    double tint = 0.0, tunit = 0.0;
-
-    GetTime(&ts, &te, &tint, &tunit);
-    timeDialog->Time = ts;
+    gtime_t ts={0,0},te={0,0};
+    double tint=0.0,tunit=0.0;
+    GetTime(&ts,&te,&tint,&tunit);
+    timeDialog->Time=ts;
     timeDialog->exec();
 }
 // callbck on button-time-2 -------------------------------------------------
 void MainWindow::BtnTime2Click()
 {
-    gtime_t ts = { 0, 0 }, te = { 0, 0 };
-    double tint = 0.0, tunit = 0.0;
-
-    GetTime(&ts, &te, &tint, &tunit);
-    timeDialog->Time = te;
+    gtime_t ts={0,0},te={0,0};
+    double tint=0.0,tunit=0.0;
+    GetTime(&ts,&te,&tint,&tunit);
+    timeDialog->Time=te;
     timeDialog->exec();
 }
 // callback on button-input-file --------------------------------------------
 void MainWindow::BtnInFileClick()
-{
-    InFile->setCurrentText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Input RTCM, RCV RAW or RINEX OBS File"), QString(),
-                                             tr("All (*.*);;RTCM 2 (*.rtcm2);;RTCM 3 (*.rtcm3);;NovtAtel (*.gps);;ublox (*.ubx);;SuperStart II (*.log);;"
-                                            "Hemisphere (*.bin);;Javad (*.jps);;RINEX OBS (*.obs *.*O);Septentrio (*.sbf)"))));
+{    
+    InFile->setCurrentText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Input RTCM, RCV RAW or RINEX OBS File"),QString(),
+         tr("All (*.*);;RTCM 2 (*.rtcm2);;RTCM 3 (*.rtcm3);;NovtAtel (*.gps);;ublox (*.ubx);;SuperStart II (*.log);;"
+            "Hemisphere (*.bin);;Javad (*.jps);;RINEX OBS (*.obs *.*O);Septentrio (*.sbf)"))));
     SetOutFiles(InFile->currentText());
 }
 // callback on output-directory change --------------------------------------
@@ -434,121 +423,85 @@
 // callback on button-output-directory --------------------------------------
 void MainWindow::BtnOutDirClick()
 {
-    OutDir->setText(QDir::toNativeSeparators(QFileDialog::getExistingDirectory(this, tr("Output Directory"), OutDir->text())));
+    OutDir->setText(QDir::toNativeSeparators(QFileDialog::getExistingDirectory(this,tr("Output Directory"),OutDir->text())));
     SetOutFiles(InFile->currentText());
 }
 // callback on button-keyword -----------------------------------------------
 void MainWindow::BtnKeyClick()
 {
-    keyDialog->Flag = 1;
+    keyDialog->Flag=1;
     keyDialog->show();
 }
 // callback on button-output-file-1 -----------------------------------------
 void MainWindow::BtnOutFile1Click()
 {
-    QString selectedFilter = tr("RINEX OBS (*.obs *.*O)");
-
-    OutFile1->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Output RINEX OBS File"), QString(),
-                                        tr("All (*.*);;RINEX OBS (*.obs *.*O);;RINEX NAV (*.nav *.*N *.*P);;RINEX GNAV (*.gnav *.*G);;RINEX HNAV (*.hnav *.*H);;"
-                                           "RINEX QNAV (*.qnav *.*Q);;RINEX LNAV (*.lnav *.*L);;RINEX CNAV (*.cnav *.*C);;RINEX INAV (*.inav *.*I);;"
-                                           "SBAS Log (*.sbs);;LEX Log (*.lex)"), &selectedFilter)));
+    QString selectedFilter="RINEX OBS (*.obs *.*O";
+    OutFile1->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Output RINEX OBS File"),QString(),
+              tr("All (*.*);;RINEX OBS (*.obs *.*O);;RINEX NAV (*.nav *.*N *.*P);;RINEX GNAV (*.gnav *.*G);;RINEX HNAV (*.hnav *.*H);;"
+                 "RINEX QNAV (*.qnav *.*Q);;RINEX LNAV (*.lnav *.*L);;SBAS Log (*.sbs);;LEX Log (*.lex)"),&selectedFilter)));
 }
 // callback on button-output-file-2 -----------------------------------------
 void MainWindow::BtnOutFile2Click()
 {
-    QString selectedFilter = tr("RINEX NAV (*.nav *.*N *.*P)");
-
-    OutFile2->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Output RINEX NAV File"), QString(),
-                                        tr("All (*.*);;RINEX OBS (*.obs *.*O);;RINEX NAV (*.nav *.*N *.*P);;RINEX GNAV (*.gnav *.*G);;RINEX HNAV (*.hnav *.*H);;"
-                                           "RINEX QNAV (*.qnav *.*Q);;RINEX LNAV (*.lnav *.*L);;RINEX CNAV (*.cnav *.*C);;RINEX INAV (*.inav *.*I);;"
-                                           "SBAS Log (*.sbs);;LEX Log (*.lex)"), &selectedFilter)));
+    QString selectedFilter="RINEX NAV (*.nav *.*N *.*P)";
+    OutFile2->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Output RINEX NAV File"),QString(),
+              tr("All (*.*);;RINEX OBS (*.obs *.*O);;RINEX NAV (*.nav *.*N *.*P);;RINEX GNAV (*.gnav *.*G);;RINEX HNAV (*.hnav *.*H);;"
+                 "RINEX QNAV (*.qnav *.*Q);;RINEX LNAV (*.lnav *.*L);;SBAS Log (*.sbs);;LEX Log (*.lex)"),&selectedFilter)));
 }
 // callback on button-output-file-3 -----------------------------------------
 void MainWindow::BtnOutFile3Click()
 {
-    QString selectedFilter = tr("RINEX GNAV (*.gnav *.*G)");
-
-    OutFile3->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Output RINEX GNAV File"), QString(),
-                                        tr("All (*.*);;RINEX OBS (*.obs *.*O);;RINEX NAV (*.nav *.*N *.*P);;RINEX GNAV (*.gnav *.*G);;RINEX HNAV (*.hnav *.*H);;"
-                                           "RINEX QNAV (*.qnav *.*Q);;RINEX LNAV (*.lnav *.*L);;RINEX CNAV (*.cnav *.*C);;RINEX INAV (*.inav *.*I);;"
-                                           "SBAS Log (*.sbs);;LEX Log (*.lex)"), &selectedFilter)));
+    QString selectedFilter="RINEX GNAV (*.gnav *.*G)";
+    OutFile3->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Output RINEX GNAV File"),QString(),
+              tr("All (*.*);;RINEX OBS (*.obs *.*O);;RINEX NAV (*.nav *.*N *.*P);;RINEX GNAV (*.gnav *.*G);;RINEX HNAV (*.hnav *.*H);;"
+                 "RINEX QNAV (*.qnav *.*Q);;RINEX LNAV (*.lnav *.*L);;SBAS Log (*.sbs);;LEX Log (*.lex)"),&selectedFilter)));
 }
 // callback on button-output-file-4 -----------------------------------------
 void MainWindow::BtnOutFile4Click()
 {
-    QString selectedFilter = tr("RINEX HNAV (*.hnav *.*H)");
-
-    OutFile4->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Output RINEX HNAV File"), QString(),
-                                        tr("All (*.*);;RINEX OBS (*.obs *.*O);;RINEX NAV (*.nav *.*N *.*P);;RINEX GNAV (*.gnav *.*G);;RINEX HNAV (*.hnav *.*H);;"
-                                           "RINEX QNAV (*.qnav *.*Q);;RINEX LNAV (*.lnav *.*L);;RINEX CNAV (*.cnav *.*C);;RINEX INAV (*.inav *.*I);;"
-                                           "SBAS Log (*.sbs);;LEX Log (*.lex)"), &selectedFilter)));
+    QString selectedFilter="RINEX HNAV (*.hnav *.*H)";
+    OutFile4->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Output RINEX HNAV File"),QString(),
+              tr("All (*.*);;RINEX OBS (*.obs *.*O);;RINEX NAV (*.nav *.*N *.*P);;RINEX GNAV (*.gnav *.*G);;RINEX HNAV (*.hnav *.*H);;"
+                 "RINEX QNAV (*.qnav *.*Q);;RINEX LNAV (*.lnav *.*L);;SBAS Log (*.sbs);;LEX Log (*.lex)"),&selectedFilter)));
 }
 // callback on button-output-file-5 -----------------------------------------
 void MainWindow::BtnOutFile5Click()
 {
-    QString selectedFilter = tr("RINEX QNAV (*.qnav *.*Q)");
-
-    OutFile5->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Output RINEX QNAV File"), QString(),
-                                        tr("All (*.*);;RINEX OBS (*.obs *.*O);;RINEX NAV (*.nav *.*N *.*P);;RINEX GNAV (*.gnav *.*G);;RINEX HNAV (*.hnav *.*H);;"
-                                           "RINEX QNAV (*.qnav *.*Q);;RINEX LNAV (*.lnav *.*L);;RINEX CNAV (*.cnav *.*C);;RINEX INAV (*.inav *.*I);;"
-                                           "SBAS Log (*.sbs);;LEX Log (*.lex)"), &selectedFilter)));
+    QString selectedFilter="RINEX QNAV (*.qnav *.*Q)";
+    OutFile5->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Output RINEX QNAV File"),QString(),
+              tr("All (*.*);;RINEX OBS (*.obs *.*O);;RINEX NAV (*.nav *.*N *.*P);;RINEX GNAV (*.gnav *.*G);;RINEX HNAV (*.hnav *.*H);;"
+                 "RINEX QNAV (*.qnav *.*Q);;RINEX LNAV (*.lnav *.*L);;SBAS Log (*.sbs);;LEX Log (*.lex)"),&selectedFilter)));
 }
 // callback on button-output-file-6 -----------------------------------------
 void MainWindow::BtnOutFile6Click()
 {
-    QString selectedFilter = tr("RINEX LNAV (*.lnav *.*L)");
-
-    OutFile6->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Output RINEX LNAV File"), QString(),
-                                        tr("All (*.*);;RINEX OBS (*.obs *.*O);;RINEX NAV (*.nav *.*N *.*P);;RINEX GNAV (*.gnav *.*G);;RINEX HNAV (*.hnav *.*H);;"
-                                           "RINEX QNAV (*.qnav *.*Q);;RINEX LNAV (*.lnav *.*L);;RINEX CNAV (*.cnav *.*C);;RINEX INAV (*.inav *.*I);;"
-                                           "SBAS Log (*.sbs);;LEX Log (*.lex)"), &selectedFilter)));
+    QString selectedFilter="RINEX LNAV (*.lnav *.*L)";
+    OutFile6->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Output RINEX LNAV File"),QString(),
+              tr("All (*.*);;RINEX OBS (*.obs *.*O);;RINEX NAV (*.nav *.*N *.*P);;RINEX GNAV (*.gnav *.*G);;RINEX HNAV (*.hnav *.*H);;"
+                 "RINEX QNAV (*.qnav *.*Q);;RINEX LNAV (*.lnav *.*L);;SBAS Log (*.sbs);;LEX Log (*.lex)"),&selectedFilter)));
 }
 // callback on button-output-file-7 -----------------------------------------
 void MainWindow::BtnOutFile7Click()
 {
-    QString selectedFilter = tr("RINEX CNAV (*.cnav *.*C)");
-
-    OutFile7->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Output SRINEX CNAVFile"), QString(),
-                                        tr("All (*.*);;RINEX OBS (*.obs *.*O);;RINEX NAV (*.nav *.*N *.*P);;RINEX GNAV (*.gnav *.*G);;RINEX HNAV (*.hnav *.*H);;"
-                                           "RINEX QNAV (*.qnav *.*Q);;RINEX LNAV (*.lnav *.*L);;RINEX CNAV (*.cnav *.*C);;RINEX INAV (*.inav *.*I);;"
-                                           "SBAS Log (*.sbs);;LEX Log (*.lex)"), &selectedFilter)));
-}
-// callback on button-output-file-8 -----------------------------------------
-void MainWindow::BtnOutFile8Click()
-{
-    QString selectedFilter = tr("RINEX INAV (*.inav *.*I)");
-
-    OutFile7->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Output SBAS/LEX Log File"), QString(),
-                                        tr("All (*.*);;RINEX OBS (*.obs *.*O);;RINEX NAV (*.nav *.*N *.*P);;RINEX GNAV (*.gnav *.*G);;RINEX HNAV (*.hnav *.*H);;"
-                                           "RINEX QNAV (*.qnav *.*Q);;RINEX LNAV (*.lnav *.*L);;RINEX CNAV (*.cnav *.*C);;RINEX INAV (*.inav *.*I);;"
-                                           "SBAS Log (*.sbs);;LEX Log (*.lex)"), &selectedFilter)));
-}
-// callback on button-output-file-9 -----------------------------------------
-void MainWindow::BtnOutFile9Click()
-{
-    QString selectedFilter = tr("SBAS Log (*.sbs)");
-
-    OutFile7->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Output SBAS/LEX Log File"), QString(),
-                                        tr("All (*.*);;RINEX OBS (*.obs *.*O);;RINEX NAV (*.nav *.*N *.*P);;RINEX GNAV (*.gnav *.*G);;RINEX HNAV (*.hnav *.*H);;"
-                                           "RINEX QNAV (*.qnav *.*Q);;RINEX LNAV (*.lnav *.*L);;RINEX CNAV (*.cnav *.*C);;RINEX INAV (*.inav *.*I);;"
-                                           "SBAS Log (*.sbs);;LEX Log (*.lex)"), &selectedFilter)));
+    QString selectedFilter="SBAS Log (*.sbs)";
+    OutFile7->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Output SBAS/LEX Log File"),QString(),
+              tr("All (*.*);;RINEX OBS (*.obs *.*O);;RINEX NAV (*.nav *.*N *.*P);;RINEX GNAV (*.gnav *.*G);;RINEX HNAV (*.hnav *.*H);;"
+                 "RINEX QNAV (*.qnav *.*Q);;RINEX LNAV (*.lnav *.*L);;SBAS Log (*.sbs);;LEX Log (*.lex)"),&selectedFilter)));
 }
 // callback on button-view-input-file ----------------------------------------
 void MainWindow::BtnInFileViewClick()
 {
-    QString InFile_Text = InFile->currentText();
-    QString ext = QFileInfo(InFile_Text).suffix();
-
-    if (ext.length() < 3) return;
+    QString InFile_Text=InFile->currentText();
+    QString ext=QFileInfo(InFile_Text).suffix();
+    if (ext.length()<4) return;
 
-    if ((ext.toLower() == "obs") || (ext.toLower() == "nav") ||
-        (ext.mid(1).toLower() == "nav") ||
-        (ext.at(2) == 'o') || (ext.at(2) == 'O') || (ext.at(2) == 'n') ||
-        (ext.at(2) == 'N') || (ext.at(2) == 'p') || (ext.at(2) == 'P') ||
-        (ext.at(2) == 'g') || (ext.at(2) == 'G') || (ext.at(2) == 'h') ||
-        (ext.at(2) == 'H') || (ext.at(2) == 'q') || (ext.at(2) == 'Q') ||
-        (ext.at(2) == 'l') || (ext.at(2) == 'L') || (ext.at(2) == 'c') ||
-        (ext.at(2) == 'C')) {
+    if ((ext=="obs" )||(ext=="OBS" )||(ext=="nav")||
+        (ext=="NAV" )||(ext.mid(1)=="nav")||(ext.mid(1)=="NAV" )||
+        (ext.at(2)=='o'  )||(ext.at(2)=='O'  )||(ext.at(2)=='n' )||
+        (ext.at(2)=='N'  )||(ext.at(2)=='p'  )||(ext.at(2)=='P' )||
+        (ext.at(2)=='g'  )||(ext.at(2)=='G'  )||(ext.at(2)=='h' )||
+        (ext.at(2)=='H'  )||(ext.at(2)=='q'  )||(ext.at(2)=='Q' )||
+        (ext.at(2)=='l'  )||(ext.at(2)=='L'  )) {
         viewer->show();
         viewer->Read(RepPath(InFile_Text));
     }
@@ -556,89 +509,64 @@
 // callback on button-view-file-1 -------------------------------------------
 void MainWindow::BtnOutFileView1Click()
 {
-    TextViewer *viewer = new TextViewer(this);
-    QString OutFile1_Text = OutFile1->text();
-
+    TextViewer *viewer=new TextViewer(this);
+    QString OutFile1_Text=OutFile1->text();
     viewer->show();
     viewer->Read(RepPath(OutFile1_Text));
 }
 // callback on button-view-file-2 -------------------------------------------
 void MainWindow::BtnOutFileView2Click()
 {
-    TextViewer *viewer = new TextViewer(this);
-    QString OutFile2_Text = OutFile2->text();
-
+    TextViewer *viewer=new TextViewer(this);
+    QString OutFile2_Text=OutFile2->text();
     viewer->show();
     viewer->Read(RepPath(OutFile2_Text));
 }
 // callback on button-view-file-3 -------------------------------------------
 void MainWindow::BtnOutFileView3Click()
 {
-    TextViewer *viewer = new TextViewer(this);
-    QString OutFile3_Text = OutFile3->text();
-
+    TextViewer *viewer=new TextViewer(this);
+    QString OutFile3_Text=OutFile3->text();
     viewer->show();
     viewer->Read(RepPath(OutFile3_Text));
 }
 // callback on button-view-file-4 -------------------------------------------
 void MainWindow::BtnOutFileView4Click()
 {
-    TextViewer *viewer = new TextViewer(this);
-    QString OutFile4_Text = OutFile4->text();
-
+    TextViewer *viewer=new TextViewer(this);
+    QString OutFile4_Text=OutFile4->text();
     viewer->show();
     viewer->Read(RepPath(OutFile4_Text));
 }
 // callback on button-view-file-5 -------------------------------------------
 void MainWindow::BtnOutFileView5Click()
 {
-    TextViewer *viewer = new TextViewer(this);
-    QString OutFile5_Text = OutFile5->text();
-
+    TextViewer *viewer=new TextViewer(this);
+    QString OutFile5_Text=OutFile5->text();
     viewer->show();
     viewer->Read(RepPath(OutFile5_Text));
 }
 // callback on button-view-file-6 -------------------------------------------
 void MainWindow::BtnOutFileView6Click()
 {
-    TextViewer *viewer = new TextViewer(this);
-    QString OutFile6_Text = OutFile6->text();
-
+    TextViewer *viewer=new TextViewer(this);
+    QString OutFile6_Text=OutFile6->text();
     viewer->show();
     viewer->Read(RepPath(OutFile6_Text));
 }
 // callback on button-view-file-7 -------------------------------------------
 void MainWindow::BtnOutFileView7Click()
 {
-    TextViewer *viewer = new TextViewer(this);
-    QString OutFile7_Text = OutFile7->text();
-
+    TextViewer *viewer=new TextViewer(this);
+    QString OutFile7_Text=OutFile7->text();
     viewer->show();
     viewer->Read(RepPath(OutFile7_Text));
 }
-// callback on button-view-file-8 -------------------------------------------
-void MainWindow::BtnOutFileView8Click()
-{
-    TextViewer *viewer = new TextViewer(this);
-    QString OutFile8_Text = OutFile8->text();
-
-    viewer->show();
-    viewer->Read(RepPath(OutFile8_Text));
-}
-// callback on button-view-file-9 -------------------------------------------
-void MainWindow::BtnOutFileView9Click()
-{
-    TextViewer *viewer = new TextViewer(this);
-    QString OutFile9_Text = OutFile9->text();
-
-    viewer->show();
-    viewer->Read(RepPath(OutFile9_Text));
-}
 // callback on button-about -------------------------------------------------
 void MainWindow::BtnAboutClick()
 {
-    aboutDialog->About = PRGNAME;
-    aboutDialog->IconIndex = 3;
+    aboutDialog->About=PRGNAME;
+    aboutDialog->IconIndex=3;
     aboutDialog->exec();
 }
 // callback on button-time-start --------------------------------------------
@@ -674,88 +602,74 @@
 }
 // get time -----------------------------------------------------------------
 void MainWindow::GetTime(gtime_t *ts, gtime_t *te, double *tint,
-             double *tunit)
+        double *tunit)
 {
     if (TimeStartF->isChecked()) {
-        QDateTime start(dateTime1->dateTime());
-        ts->time = start.toTime_t(); ts->sec = start.time().msec() / 1000;
-    } else {
-        ts->time = 0; ts->sec = 0;
-    }
-
+        QDateTime start(TimeY1->date(),TimeH1->time());
+        ts->time=start.toTime_t();ts->sec=start.time().msec()/1000;
+    } else ts->time=ts->sec=0;
     if (TimeEndF->isChecked()) {
-        QDateTime end(dateTime2->dateTime());
-        te->time = end.toTime_t(); te->sec = end.time().msec() / 1000;
-    } else {
-        te->time = 0; te->sec = 0;
-    }
-
-    if (TimeIntF->isChecked())
-        *tint = TimeInt->currentText().toDouble();
-    else *tint = 0;
-
-    if (TimeUnitF->isChecked())
-        *tunit = TimeUnit->text().toDouble() * 3600;
-    else *tunit = 0;
+        QDateTime end(TimeY2->date(),TimeH2->time());
+        te->time=end.toTime_t();te->sec=end.time().msec()/1000;
+    } else te->time=te->sec=0;
+    if (TimeIntF->isChecked()) {
+        *tint=TimeInt->currentText().toDouble();
+    } else *tint=0;
+    if (TimeUnitF->isChecked()) {
+        *tunit=TimeUnit->text().toDouble()*3600;
+    } else *tunit=0;
 }
 // replace keywords in file path --------------------------------------------
 QString MainWindow::RepPath(const QString &File)
 {
     QString Path;
     char path[1024];
-
-    reppath(qPrintable(File), path, timeadd(RnxTime, TSTARTMARGIN), qPrintable(RnxCode), "");
-    return Path = path;
+    reppath(qPrintable(File),path,timeadd(RnxTime,TSTARTMARGIN),qPrintable(RnxCode),"");
+    return Path=path;
 }
 // execute command ----------------------------------------------------------
 int MainWindow::ExecCmd(const QString &cmd)
 {
-    return QProcess::startDetached(cmd);
+    return QProcess::startDetached(cmd);  /* FIXME: show option not yet supported */
 }
 // undate enable/disable of widgets -----------------------------------------
 void MainWindow::UpdateEnable(void)
 {
-    QString FormatText = Format->currentText();
-    int rnx = FormatText == "RINEX";
-    int sep_nav=RnxVer<3||SepNav;
-
-    dateTime1->setEnabled(TimeStartF->isChecked());
-    BtnTime1->setEnabled(TimeStartF->isChecked());
-    dateTime2->setEnabled(TimeEndF->isChecked());
-    BtnTime2->setEnabled(TimeEndF->isChecked());
-    TimeInt->setEnabled(TimeIntF->isChecked());
-    LabelTimeInt->setEnabled(TimeInt->isEnabled());
-    TimeUnitF->setEnabled(TimeStartF->isChecked() && TimeEndF->isChecked());
-    TimeUnit->setEnabled(TimeStartF->isChecked() && TimeEndF->isChecked() && TimeUnitF->isChecked());
-    LabelTimeUnit->setEnabled(TimeUnit->isEnabled());
-    OutFileEna3->setEnabled(sep_nav && (NavSys & SYS_GLO));
-    OutFileEna4->setEnabled(sep_nav && (NavSys & SYS_SBS));
-    OutFileEna5->setEnabled(sep_nav && (NavSys & SYS_QZS));
-    OutFileEna6->setEnabled(sep_nav && (NavSys & SYS_GAL));
-    OutFileEna7->setEnabled(sep_nav && (NavSys & SYS_CMP));
-    OutFileEna8->setEnabled(sep_nav && (NavSys & SYS_IRN));
-    OutFileEna9->setEnabled(!rnx);
-    OutDir->setEnabled(OutDirEna->isChecked());
-    LabelOutDir->setEnabled(OutDirEna->isChecked());
-    OutFile1->setEnabled(OutFileEna1->isChecked());
-    OutFile2->setEnabled(OutFileEna2->isChecked());
-    OutFile3->setEnabled(OutFileEna3->isChecked() && sep_nav && (NavSys & SYS_GLO));
-    OutFile4->setEnabled(OutFileEna4->isChecked() && sep_nav && (NavSys & SYS_SBS));
-    OutFile5->setEnabled(OutFileEna5->isChecked() && sep_nav && (NavSys & SYS_QZS));
-    OutFile6->setEnabled(OutFileEna6->isChecked() && sep_nav && (NavSys & SYS_GAL));
-    OutFile7->setEnabled(OutFileEna7->isChecked() && sep_nav && (NavSys & SYS_CMP));
-    OutFile8->setEnabled(OutFileEna8->isChecked() && sep_nav && (NavSys & SYS_IRN));
-    OutFile9->setEnabled(OutFileEna9->isChecked() && !rnx);
-    BtnOutDir->setEnabled(OutDirEna->isChecked());
-    BtnOutFile1->setEnabled(OutFile1->isEnabled());
-    BtnOutFile2->setEnabled(OutFile2->isEnabled());
-    BtnOutFile3->setEnabled(OutFile3->isEnabled());
-    BtnOutFile4->setEnabled(OutFile4->isEnabled());
-    BtnOutFile5->setEnabled(OutFile5->isEnabled());
-    BtnOutFile6->setEnabled(OutFile6->isEnabled());
-    BtnOutFile7->setEnabled(OutFile7->isEnabled());
-    BtnOutFile8->setEnabled(OutFile8->isEnabled());
-    BtnOutFile9->setEnabled(OutFile9->isEnabled());
+    QString FormatText=Format->currentText();
+    int rnx=FormatText=="RINEX";
+    TimeY1         ->setEnabled(TimeStartF ->isChecked());
+    TimeH1         ->setEnabled(TimeStartF ->isChecked());
+    BtnTime1       ->setEnabled(TimeStartF ->isChecked());
+    TimeY2         ->setEnabled(TimeEndF   ->isChecked());
+    TimeH2         ->setEnabled(TimeEndF   ->isChecked());
+    BtnTime2       ->setEnabled(TimeEndF   ->isChecked());
+    TimeInt        ->setEnabled(TimeIntF   ->isChecked());
+    LabelTimeInt   ->setEnabled(TimeInt    ->isEnabled());
+    TimeUnitF      ->setEnabled(TimeStartF->isChecked()&&TimeEndF->isChecked());
+    TimeUnit       ->setEnabled(TimeStartF->isChecked()&&TimeEndF->isChecked()&&TimeUnitF->isChecked());
+    LabelTimeUnit  ->setEnabled(TimeUnit  ->isEnabled());
+    OutFileEna3    ->setEnabled(RnxVer<3&&(NavSys&SYS_GLO));
+    OutFileEna4    ->setEnabled(RnxVer<3&&(NavSys&SYS_SBS));
+    OutFileEna5    ->setEnabled(RnxVer<3&&(NavSys&SYS_QZS));
+    OutFileEna6    ->setEnabled(RnxVer<3&&(NavSys&SYS_GAL));
+    OutFileEna7    ->setEnabled(!rnx);
+    OutDir         ->setEnabled(OutDirEna  ->isChecked());
+    LabelOutDir    ->setEnabled(OutDirEna  ->isChecked());
+    OutFile1       ->setEnabled(OutFileEna1->isChecked());
+    OutFile2       ->setEnabled(OutFileEna2->isChecked());
+    OutFile3       ->setEnabled(OutFileEna3->isChecked()&&RnxVer<3&&(NavSys&SYS_GLO));
+    OutFile4       ->setEnabled(OutFileEna4->isChecked()&&RnxVer<3&&(NavSys&SYS_SBS));
+    OutFile5       ->setEnabled(OutFileEna5->isChecked()&&RnxVer<3&&(NavSys&SYS_QZS));
+    OutFile6       ->setEnabled(OutFileEna6->isChecked()&&RnxVer<3&&(NavSys&SYS_GAL));
+    OutFile7       ->setEnabled(OutFileEna7->isChecked()&&!rnx);
+    BtnOutDir      ->setEnabled(OutDirEna  ->isChecked());
+    BtnOutFile1    ->setEnabled(OutFile1->isEnabled());
+    BtnOutFile2    ->setEnabled(OutFile2->isEnabled());
+    BtnOutFile3    ->setEnabled(OutFile3->isEnabled());
+    BtnOutFile4    ->setEnabled(OutFile4->isEnabled());
+    BtnOutFile5    ->setEnabled(OutFile5->isEnabled());
+    BtnOutFile6    ->setEnabled(OutFile6->isEnabled());
+    BtnOutFile7    ->setEnabled(OutFile7->isEnabled());
     BtnOutFileView1->setEnabled(OutFile1->isEnabled());
     BtnOutFileView2->setEnabled(OutFile2->isEnabled());
     BtnOutFileView3->setEnabled(OutFile3->isEnabled());
@@ -763,187 +677,150 @@
     BtnOutFileView5->setEnabled(OutFile5->isEnabled());
     BtnOutFileView6->setEnabled(OutFile6->isEnabled());
     BtnOutFileView7->setEnabled(OutFile7->isEnabled());
-    BtnOutFileView8->setEnabled(OutFile8->isEnabled());
-    BtnOutFileView9->setEnabled(OutFile9->isEnabled());
 }
 // convert file -------------------------------------------------------------
 void MainWindow::ConvertFile(void)
 {
-    QString InFile_Text = InFile->currentText();
-    QString OutFile1_Text = OutFile1->text(), OutFile2_Text = OutFile2->text();
-    QString OutFile3_Text = OutFile3->text(), OutFile4_Text = OutFile4->text();
-    QString OutFile5_Text = OutFile5->text(), OutFile6_Text = OutFile6->text();
-    QString OutFile7_Text = OutFile7->text(), OutFile8_Text = OutFile8->text();
-    QString OutFile9_Text = OutFile9->text();
+    QString InFile_Text=InFile->currentText();
+    QString OutFile1_Text=OutFile1->text(),OutFile2_Text=OutFile2->text();
+    QString OutFile3_Text=OutFile3->text(),OutFile4_Text=OutFile4->text();
+    QString OutFile5_Text=OutFile5->text(),OutFile6_Text=OutFile6->text();
+    QString OutFile7_Text=OutFile7->text();
     int i;
     char *p;
-    double RNXVER[] = { 2.10, 2.11, 2.12, 3.00, 3.01, 3.02, 3.03 };
-
-    conversionThread = new ConversionThread(this);
+    double RNXVER[]={2.10,2.11,2.12,3.00,3.01,3.02,3.03};
+    
+    conversionThread= new ConversionThread(this);
 
     // recognize input file format
-    strcpy(conversionThread->ifile, qPrintable(InFile_Text));
+    strcpy(conversionThread->ifile,qPrintable(InFile_Text));
     QFileInfo fi(InFile_Text);
-    if (Format->currentIndex() == 0) { // auto
-        if (fi.completeSuffix() == "rtcm2") {
-            conversionThread->format = STRFMT_RTCM2;
-        } else if (fi.completeSuffix() == "rtcm3") {
-            conversionThread->format = STRFMT_RTCM3;
-        } else if (fi.completeSuffix() == "gps") {
-            conversionThread->format = STRFMT_OEM4;
-        } else if (fi.completeSuffix() == "ubx") {
-            conversionThread->format = STRFMT_UBX;
-        } else if (fi.completeSuffix() == "log") {
-            conversionThread->format = STRFMT_SS2;
-        } else if (fi.completeSuffix() == "bin") {
-            conversionThread->format = STRFMT_CRES;
-        } else if (fi.completeSuffix() == "jps") {
-            conversionThread->format = STRFMT_JAVAD;
-        } else if (fi.completeSuffix() == "bnx") {
-            conversionThread->format = STRFMT_BINEX;
-        } else if (fi.completeSuffix() == "binex") {
-            conversionThread->format = STRFMT_BINEX;
-        } else if (fi.completeSuffix() == "rt17") {
-            conversionThread->format = STRFMT_RT17;
-        } else if (fi.completeSuffix() == "cmr") {
-            conversionThread->format = STRFMT_CMR;
-        } else if (fi.completeSuffix() == "trs") {
-            conversionThread->format = STRFMT_TERSUS;
-        } else if (fi.completeSuffix().toLower() == "obs") {
-            conversionThread->format = STRFMT_RINEX;
-        } else if (fi.completeSuffix().toLower().contains("nav")) {
-            conversionThread->format = STRFMT_RINEX;
-        } else if (fi.completeSuffix().at(2) == 'o') {
-            conversionThread->format = STRFMT_RINEX;
-        } else if (fi.completeSuffix().at(2) == 'O') {
-            conversionThread->format = STRFMT_RINEX;
-        } else if (fi.completeSuffix().at(2) == 'n') {
-            conversionThread->format = STRFMT_RINEX;
-        } else if (fi.completeSuffix().at(2) == 'N') {
-            conversionThread->format = STRFMT_RINEX;
-        } else if (fi.completeSuffix().at(2) == 'p') {
-            conversionThread->format = STRFMT_RINEX;
-        } else if (fi.completeSuffix().at(2) == 'P') {
-            conversionThread->format = STRFMT_RINEX;
-        } else if (fi.completeSuffix().at(2) == 'g') {
-            conversionThread->format = STRFMT_RINEX;
-        } else if (fi.completeSuffix().at(2) == 'G') {
-            conversionThread->format = STRFMT_RINEX;
-        } else if (fi.completeSuffix().at(2) == 'h') {
-            conversionThread->format = STRFMT_RINEX;
-        } else if (fi.completeSuffix().at(2) == 'H') {
-            conversionThread->format = STRFMT_RINEX;
-        } else if (fi.completeSuffix().at(2) == 'q') {
-            conversionThread->format = STRFMT_RINEX;
-        } else if (fi.completeSuffix().at(2) == 'Q') {
-            conversionThread->format = STRFMT_RINEX;
-        } else if (fi.completeSuffix().at(2) == 'l') {
-            conversionThread->format = STRFMT_RINEX;
-        } else if (fi.completeSuffix().at(2) == 'L') {
-            conversionThread->format = STRFMT_RINEX;
-        } else if (fi.completeSuffix().at(2) == 'c') {
-            conversionThread->format = STRFMT_RINEX;
-        } else if (fi.completeSuffix().at(2) == 'C') {
-            conversionThread->format = STRFMT_RINEX;
-        } else {
+    if (Format->currentIndex()==0) { // auto
+        if      (fi.completeSuffix()=="rtcm2") conversionThread->format=STRFMT_RTCM2;
+        else if (fi.completeSuffix()=="rtcm3") conversionThread->format=STRFMT_RTCM3;
+        else if (fi.completeSuffix()=="gps"  ) conversionThread->format=STRFMT_OEM4;
+        else if (fi.completeSuffix()=="ubx"  ) conversionThread->format=STRFMT_UBX;
+        else if (fi.completeSuffix()=="log"  ) conversionThread->format=STRFMT_SS2;
+        else if (fi.completeSuffix()=="bin"  ) conversionThread->format=STRFMT_CRES;
+        else if (fi.completeSuffix()=="jps"  ) conversionThread->format=STRFMT_JAVAD;
+        else if (fi.completeSuffix()=="bnx"  ) conversionThread->format=STRFMT_BINEX;
+        else if (fi.completeSuffix()=="binex") conversionThread->format=STRFMT_BINEX;
+        else if (fi.completeSuffix()=="rt17" ) conversionThread->format=STRFMT_RT17;
+        else if (fi.completeSuffix()=="cmr"  ) conversionThread->format=STRFMT_CMR;
+        else if (fi.completeSuffix().toLower()=="obs"  ) conversionThread->format=STRFMT_RINEX;
+        else if (fi.completeSuffix().toLower().contains( "nav" )) conversionThread->format=STRFMT_RINEX;
+        else if (fi.completeSuffix().at(2)=='o'   ) conversionThread->format=STRFMT_RINEX;
+        else if (fi.completeSuffix().at(2)=='O'   ) conversionThread->format=STRFMT_RINEX;
+        else if (fi.completeSuffix().at(2)=='n'   ) conversionThread->format=STRFMT_RINEX;
+        else if (fi.completeSuffix().at(2)=='N'   ) conversionThread->format=STRFMT_RINEX;
+        else if (fi.completeSuffix().at(2)=='p'   ) conversionThread->format=STRFMT_RINEX;
+        else if (fi.completeSuffix().at(2)=='P'   ) conversionThread->format=STRFMT_RINEX;
+        else if (fi.completeSuffix().at(2)=='g'   ) conversionThread->format=STRFMT_RINEX;
+        else if (fi.completeSuffix().at(2)=='G'   ) conversionThread->format=STRFMT_RINEX;
+        else if (fi.completeSuffix().at(2)=='h'   ) conversionThread->format=STRFMT_RINEX;
+        else if (fi.completeSuffix().at(2)=='H'   ) conversionThread->format=STRFMT_RINEX;
+        else if (fi.completeSuffix().at(2)=='q'   ) conversionThread->format=STRFMT_RINEX;
+        else if (fi.completeSuffix().at(2)=='Q'   ) conversionThread->format=STRFMT_RINEX;
+        else if (fi.completeSuffix().at(2)=='l'   ) conversionThread->format=STRFMT_RINEX;
+        else if (fi.completeSuffix().at(2)=='L'   ) conversionThread->format=STRFMT_RINEX;
+        else {
             showmsg("file format can not be recognized");
             return;
         }
-    } else {
-        for (i = 0; formatstrs[i]; i++)
-            if (Format->currentText() == formatstrs[i]) break;
-        if (formatstrs[i]) conversionThread->format = i; else return;
     }
-    conversionThread->rnxopt.rnxver = RNXVER[RnxVer];
-
-    if (conversionThread->format == STRFMT_RTCM2 || conversionThread->format == STRFMT_RTCM3 || conversionThread->format == STRFMT_RT17
-        || conversionThread->format == STRFMT_CMR) {
+    else {
+        for (i=0;formatstrs[i];i++) {
+            if (Format->currentText()==formatstrs[i]) break;
+        }
+        if (formatstrs[i]) conversionThread->format=i; else return;
+    }
+    conversionThread->rnxopt.rnxver=RNXVER[RnxVer];
+    
+    if (conversionThread->format==STRFMT_RTCM2||conversionThread->format==STRFMT_RTCM3||conversionThread->format==STRFMT_RT17
+            ||conversionThread->format==STRFMT_CMR) {
+        
         // input start date/time for rtcm 2, rtcm 3, RT17 or CMR
         startDialog->exec();
-        if (startDialog->result() != QDialog::Accepted) return;
-        conversionThread->rnxopt.trtcm = startDialog->Time;
+        if (startDialog->result()!=QDialog::Accepted) return;
+        conversionThread->rnxopt.trtcm=startDialog->Time;
     }
-    if (OutFile1->isEnabled() && OutFileEna1->isChecked()) strcpy(conversionThread->ofile[0], qPrintable(OutFile1_Text));
-    if (OutFile2->isEnabled() && OutFileEna2->isChecked()) strcpy(conversionThread->ofile[1], qPrintable(OutFile2_Text));
-    if (OutFile3->isEnabled() && OutFileEna3->isChecked()) strcpy(conversionThread->ofile[2], qPrintable(OutFile3_Text));
-    if (OutFile4->isEnabled() && OutFileEna4->isChecked()) strcpy(conversionThread->ofile[3], qPrintable(OutFile4_Text));
-    if (OutFile5->isEnabled() && OutFileEna5->isChecked()) strcpy(conversionThread->ofile[4], qPrintable(OutFile5_Text));
-    if (OutFile6->isEnabled() && OutFileEna6->isChecked()) strcpy(conversionThread->ofile[5], qPrintable(OutFile6_Text));
-    if (OutFile7->isEnabled() && OutFileEna7->isChecked()) strcpy(conversionThread->ofile[6], qPrintable(OutFile7_Text));
-    if (OutFile8->isEnabled() && OutFileEna8->isChecked()) strcpy(conversionThread->ofile[7], qPrintable(OutFile8_Text));
-    if (OutFile9->isEnabled() && OutFileEna9->isChecked()) strcpy(conversionThread->ofile[8], qPrintable(OutFile9_Text));
-
+    if (OutFile1->isEnabled()&&OutFileEna1->isChecked()) strcpy(conversionThread->ofile[0],qPrintable(OutFile1_Text));
+    if (OutFile2->isEnabled()&&OutFileEna2->isChecked()) strcpy(conversionThread->ofile[1],qPrintable(OutFile2_Text));
+    if (OutFile3->isEnabled()&&OutFileEna3->isChecked()) strcpy(conversionThread->ofile[2],qPrintable(OutFile3_Text));
+    if (OutFile4->isEnabled()&&OutFileEna4->isChecked()) strcpy(conversionThread->ofile[3],qPrintable(OutFile4_Text));
+    if (OutFile5->isEnabled()&&OutFileEna5->isChecked()) strcpy(conversionThread->ofile[4],qPrintable(OutFile5_Text));
+    if (OutFile6->isEnabled()&&OutFileEna6->isChecked()) strcpy(conversionThread->ofile[5],qPrintable(OutFile6_Text));
+    if (OutFile7->isEnabled()&&OutFileEna7->isChecked()) strcpy(conversionThread->ofile[6],qPrintable(OutFile7_Text));
+    
     // check overwrite output file
-    for (i = 0; i < 9; i++) {
+    for (i=0;i<6;i++) {
         if (!QFile(conversionThread->ofile[i]).exists()) continue;
-        if (QMessageBox::question(this, tr("Overwrite"), QString(tr("%1 exists. Do you want to overwrite?")).arg(conversionThread->ofile[i])) != QMessageBox::Yes) return;
+        if (QMessageBox::question(this,tr("Overwrite"),QString(tr("%1 exists. Do you want to overwrite?")).arg(conversionThread->ofile[i]))!=QMessageBox::Yes) return;
     }
-    GetTime(&conversionThread->rnxopt.ts, &conversionThread->rnxopt.te, &conversionThread->rnxopt.tint, &conversionThread->rnxopt.tunit);
-    strncpy(conversionThread->rnxopt.staid, qPrintable(RnxCode), 31);
-    sprintf(conversionThread->rnxopt.prog, "%s %s %s", PRGNAME, VER_RTKLIB, PATCH_LEVEL);
-    strncpy(conversionThread->rnxopt.runby, qPrintable(RunBy), 31);
-    strncpy(conversionThread->rnxopt.marker, qPrintable(Marker), 63);
-    strncpy(conversionThread->rnxopt.markerno, qPrintable(MarkerNo), 31);
-    strncpy(conversionThread->rnxopt.markertype, qPrintable(MarkerType), 31);
-    for (i = 0; i < 2; i++) strncpy(conversionThread->rnxopt.name[i], qPrintable(Name[i]), 31);
-    for (i = 0; i < 3; i++) strncpy(conversionThread->rnxopt.rec [i], qPrintable(Rec [i]), 31);
-    for (i = 0; i < 3; i++) strncpy(conversionThread->rnxopt.ant [i], qPrintable(Ant [i]), 31);
-    if (AutoPos)
-        for (i = 0; i < 3; i++) conversionThread->rnxopt.apppos[i] = AppPos[i];
-    for (i = 0; i < 3; i++) conversionThread->rnxopt.antdel[i] = AntDel[i];
-    strncpy(conversionThread->rnxopt.rcvopt, qPrintable(RcvOption), 255);
-    conversionThread->rnxopt.navsys = NavSys;
-    conversionThread->rnxopt.obstype = ObsType;
-    conversionThread->rnxopt.freqtype = FreqType;
-    p = conversionThread->rnxopt.comment[0];
-    sprintf(p, "log: %-53.53s", conversionThread->ifile);
-    p = conversionThread->rnxopt.comment[1];
-    p += sprintf(p, "format: %s", formatstrs[conversionThread->format]);
-    if (*conversionThread->rnxopt.rcvopt) sprintf(p, ", option: %s", conversionThread->rnxopt.rcvopt);
-    for (i = 0; i < 2; i++) strncpy(conversionThread->rnxopt.comment[i + 2], qPrintable(Comment[i]), 63);
-    for (i = 0; i < 7; i++) strcpy(conversionThread->rnxopt.mask[i], qPrintable(CodeMask[i]));
-    conversionThread->rnxopt.autopos = AutoPos;
-    conversionThread->rnxopt.scanobs = ScanObs;
-    conversionThread->rnxopt.halfcyc = HalfCyc;
-    conversionThread->rnxopt.outiono = OutIono;
-    conversionThread->rnxopt.outtime = OutTime;
-    conversionThread->rnxopt.outleaps = OutLeaps;
-    conversionThread->rnxopt.sep_nav = SepNav;
-    conversionThread->rnxopt.ttol = TimeTol;
-
-    QStringList exsatsLst = ExSats.split(" ");
-    foreach(const QString &sat, exsatsLst){
+    GetTime(&conversionThread->rnxopt.ts,&conversionThread->rnxopt.te,&conversionThread->rnxopt.tint,&conversionThread->rnxopt.tunit);
+    strncpy(conversionThread->rnxopt.staid,qPrintable(RnxCode),31);
+    sprintf(conversionThread->rnxopt.prog,"%s %s %s",PRGNAME,VER_RTKLIB,PATCH_LEVEL);
+    strncpy(conversionThread->rnxopt.runby,qPrintable(RunBy),31);
+    strncpy(conversionThread->rnxopt.marker,qPrintable(Marker),63);
+    strncpy(conversionThread->rnxopt.markerno,qPrintable(MarkerNo),31);
+    strncpy(conversionThread->rnxopt.markertype,qPrintable(MarkerType),31);
+    for (i=0;i<2;i++) strncpy(conversionThread->rnxopt.name[i],qPrintable(Name[i]),31);
+    for (i=0;i<3;i++) strncpy(conversionThread->rnxopt.rec [i],qPrintable(Rec [i]),31);
+    for (i=0;i<3;i++) strncpy(conversionThread->rnxopt.ant [i],qPrintable(Ant [i]),31);
+    if (AutoPos) {
+        for (i=0;i<3;i++) conversionThread->rnxopt.apppos[i]=AppPos[i];
+    }
+    for (i=0;i<3;i++) conversionThread->rnxopt.antdel[i]=AntDel[i];
+    strncpy(conversionThread->rnxopt.rcvopt,qPrintable(RcvOption),255);
+    conversionThread->rnxopt.navsys=NavSys;
+    conversionThread->rnxopt.obstype=ObsType;
+    conversionThread->rnxopt.freqtype=FreqType;
+    p=conversionThread->rnxopt.comment[0];
+    sprintf(p,"log: %-53.53s",conversionThread->ifile);
+    p=conversionThread->rnxopt.comment[1];
+    p+=sprintf(p,"format: %s",formatstrs[conversionThread->format]);
+    if (*conversionThread->rnxopt.rcvopt) sprintf(p,", option: %s",conversionThread->rnxopt.rcvopt);
+    for (i=0;i<2;i++) strncpy(conversionThread->rnxopt.comment[i+2],qPrintable(Comment[i]),63);
+    for (i=0;i<6;i++) strcpy(conversionThread->rnxopt.mask[i],qPrintable(CodeMask[i]));
+    conversionThread->rnxopt.autopos=AutoPos;
+    conversionThread->rnxopt.scanobs=ScanObs;
+    conversionThread->rnxopt.outiono=OutIono;
+    conversionThread->rnxopt.outtime=OutTime;
+    conversionThread->rnxopt.outleaps=OutLeaps;
+    
+    QStringList exsatsLst=ExSats.split(" ");
+    foreach (const QString & sat,exsatsLst)
+    {
         int satid;
-
-        if (!(satid = satid2no(qPrintable(sat)))) continue;
-        conversionThread->rnxopt.exsats[satid - 1] = 1;
+        if (!(satid=satid2no(qPrintable(sat)))) continue;
+        conversionThread->rnxopt.exsats[satid-1]=1;
     }
 
-    abortf = 0;
-    BtnConvert->setVisible(false);
-    BtnAbort->setVisible(true);
-    Panel1->setEnabled(false);
-    Panel2->setEnabled(false);
-    BtnPlot->setEnabled(false);
-    BtnPost->setEnabled(false);
-    BtnOptions->setEnabled(false);
-    BtnExit->setEnabled(false);
-    Format->setEnabled(false);
-    BtnKey->setEnabled(false);
-    LabelInFile->setEnabled(false);
-    LabelOutDir->setEnabled(false);
+    abortf=0;
+    BtnConvert  ->setVisible(false);
+    BtnAbort    ->setVisible(true);
+    Panel1      ->setEnabled(false);
+    Panel2      ->setEnabled(false);
+    BtnPlot     ->setEnabled(false);
+    BtnPost     ->setEnabled(false);
+    BtnOptions  ->setEnabled(false);
+    BtnExit     ->setEnabled(false);
+    Format      ->setEnabled(false);
+    BtnKey      ->setEnabled(false);
+    LabelInFile ->setEnabled(false);
+    LabelOutDir ->setEnabled(false);
     LabelOutFile->setEnabled(false);
-    LabelFormat->setEnabled(false);
-    Message->setText("");
-
-    if (TraceLevel > 0) {
+    LabelFormat ->setEnabled(false);
+    Message     ->setText("");
+    
+    if (TraceLevel>0) {
         traceopen(TRACEFILE);
         tracelevel(TraceLevel);
     }
     setCursor(Qt::WaitCursor);
 
     // post processing positioning
-    connect(conversionThread, SIGNAL(finished()), this, SLOT(ConversionFinished()));
+    connect(conversionThread,SIGNAL(finished()),this,SLOT(ConversionFinished()));
 
     conversionThread->start();
 }
@@ -952,39 +829,40 @@
 {
     setCursor(Qt::ArrowCursor);
 
-    if (TraceLevel > 0)
+    if (TraceLevel>0) {
         traceclose();
-    BtnConvert->setVisible(true);
-    BtnAbort->setVisible(false);
-    Panel1->setEnabled(true);
-    Panel2->setEnabled(true);
-    BtnPlot->setEnabled(true);
-    BtnPost->setEnabled(true);
-    BtnOptions->setEnabled(true);
-    BtnExit->setEnabled(true);
-    Format->setEnabled(true);
-    BtnKey->setEnabled(true);
-    LabelInFile->setEnabled(true);
-    LabelOutDir->setEnabled(true);
+    }
+    BtnConvert  ->setVisible(true);
+    BtnAbort    ->setVisible(false);
+    Panel1      ->setEnabled(true);
+    Panel2      ->setEnabled(true);
+    BtnPlot     ->setEnabled(true);
+    BtnPost     ->setEnabled(true);
+    BtnOptions  ->setEnabled(true);
+    BtnExit     ->setEnabled(true);
+    Format      ->setEnabled(true);
+    BtnKey      ->setEnabled(true);
+    LabelInFile ->setEnabled(true);
+    LabelOutDir ->setEnabled(true);
     LabelOutFile->setEnabled(true);
-    LabelFormat->setEnabled(true);
-
+    LabelFormat ->setEnabled(true);
+    
 #if 0
     // set time-start/end if time not specified
-    if (!TimeStartF->Checked && rnxopt.tstart.time != 0) {
-        time2str(rnxopt.tstart, tstr, 0);
-        tstr[10] = '\0';
-        TimeY1->Text = tstr;
-        TimeH1->Text = tstr + 11;
+    if (!TimeStartF->Checked&&rnxopt.tstart.time!=0) {
+        time2str(rnxopt.tstart,tstr,0);
+        tstr[10]='\0';
+        TimeY1->Text=tstr;
+        TimeH1->Text=tstr+11;
     }
-    if (!TimeEndF->Checked && rnxopt.tend.time != 0) {
-        time2str(rnxopt.tend, tstr, 0);
-        tstr[10] = '\0';
-        TimeY2->Text = tstr;
-        TimeH2->Text = tstr + 11;
+    if (!TimeEndF->Checked&&rnxopt.tend.time!=0) {
+        time2str(rnxopt.tend,tstr,0);
+        tstr[10]='\0';
+        TimeY2->Text=tstr;
+        TimeH2->Text=tstr+11;
     }
 #endif
-    RnxTime = conversionThread->rnxopt.tstart;
+    RnxTime=conversionThread->rnxopt.tstart;
 
     conversionThread->deleteLater();
 
@@ -993,77 +871,71 @@
 // load options -------------------------------------------------------------
 void MainWindow::LoadOpt(void)
 {
-    QSettings ini(IniFile, QSettings::IniFormat);
-    QString mask = "1111111111111111111111111111111111111111111111111111111";
-
-    RnxVer = ini.value("opt/rnxver", 0).toInt();
-    RnxFile = ini.value("opt/rnxfile", 0).toInt();
-    RnxCode = ini.value("opt/rnxcode", "0000").toString();
-    RunBy = ini.value("opt/runby", "").toString();
-    Marker = ini.value("opt/marker", "").toString();
-    MarkerNo = ini.value("opt/markerno", "").toString();
-    MarkerType = ini.value("opt/markertype", "").toString();
-    Name[0] = ini.value("opt/name0", "").toString();
-    Name[1] = ini.value("opt/name1", "").toString();
-    Rec[0] = ini.value("opt/rec0", "").toString();
-    Rec[1] = ini.value("opt/rec1", "").toString();
-    Rec[2] = ini.value("opt/rec2", "").toString();
-    Ant[0] = ini.value("opt/ant0", "").toString();
-    Ant[1] = ini.value("opt/ant1", "").toString();
-    Ant[2] = ini.value("opt/ant2", "").toString();
-    AppPos[0] = ini.value("opt/apppos0", 0.0).toDouble();
-    AppPos[1] = ini.value("opt/apppos1", 0.0).toDouble();
-    AppPos[2] = ini.value("opt/apppos2", 0.0).toDouble();
-    AntDel[0] = ini.value("opt/antdel0", 0.0).toDouble();
-    AntDel[1] = ini.value("opt/antdel1", 0.0).toDouble();
-    AntDel[2] = ini.value("opt/antdel2", 0.0).toDouble();
-    Comment[0] = ini.value("opt/comment0", "").toString();
-    Comment[1] = ini.value("opt/comment1", "").toString();
-    RcvOption = ini.value("opt/rcvoption", "").toString();
-    NavSys = ini.value("opt/navsys", 0x3).toInt();
-    ObsType = ini.value("opt/obstype", 0xF).toInt();
-    FreqType = ini.value("opt/freqtype", 0x3).toInt();
-    ExSats = ini.value("opt/exsats", "").toString();
-    TraceLevel = ini.value("opt/tracelevel", 0).toInt();
-    RnxTime.time = ini.value("opt/rnxtime", 0).toInt();
-    CodeMask[0] = ini.value("opt/codemask_1", mask).toString();
-    CodeMask[1] = ini.value("opt/codemask_2", mask).toString();
-    CodeMask[2] = ini.value("opt/codemask_3", mask).toString();
-    CodeMask[3] = ini.value("opt/codemask_4", mask).toString();
-    CodeMask[4] = ini.value("opt/codemask_5", mask).toString();
-    CodeMask[5] = ini.value("opt/codemask_6", mask).toString();
-    CodeMask[6] = ini.value("opt/codemask_7", mask).toString();
-    AutoPos = ini.value("opt/autopos", 0).toInt();
-    ScanObs = ini.value("opt/scanobs", 0).toInt();
-    HalfCyc = ini.value("opt/halfcyc", 0).toInt();
-    OutIono = ini.value("opt/outiono", 0).toInt();
-    OutTime = ini.value("opt/outtime", 0).toInt();
-    OutLeaps = ini.value("opt/outleaps", 0).toInt();
-    SepNav = ini.value("opt/sepnav", 0).toInt();
-    TimeTol	= ini.value("opt/timetol", 0.005).toInt();
-
-    TimeStartF->setChecked(ini.value("set/timestartf", 0).toBool());
-    TimeEndF->setChecked(ini.value("set/timeendf", 0).toBool());
-    TimeIntF->setChecked(ini.value("set/timeintf", 0).toBool());
-    dateTime1->setDate(ini.value("set/timey1", "2000/01/01").value<QDate>());
-    dateTime1->setTime(ini.value("set/timeh1", "00:00:00").value<QTime>());
-    dateTime2->setDate(ini.value("set/timey2", "2000/01/01").value<QDate>());
-    dateTime2->setTime(ini.value("set/timeh2", "00:00:00").value<QTime>());
-    TimeInt->setCurrentText(ini.value("set/timeint", "1").toString());
-    TimeUnitF->setChecked(ini.value("set/timeunitf", 0).toBool());
-    TimeUnit->setText(ini.value("set/timeunit", "24").toString());
-    InFile->setCurrentText(ini.value("set/infile", "").toString());
-    OutDir->setText(ini.value("set/outdir", "").toString());
-    OutFile1->setText(ini.value("set/outfile1", "").toString());
-    OutFile2->setText(ini.value("set/outfile2", "").toString());
-    OutFile3->setText(ini.value("set/outfile3", "").toString());
-    OutFile4->setText(ini.value("set/outfile4", "").toString());
-    OutFile5->setText(ini.value("set/outfile5", "").toString());
-    OutFile6->setText(ini.value("set/outfile6", "").toString());
-    OutFile7->setText(ini.value("set/outfile7", "").toString());
-    OutFile8->setText(ini.value("set/outfile8", "").toString());
-    OutFile9->setText(ini.value("set/outfile9", "").toString());
-    OutDirEna->setChecked(ini.value("set/outdirena", false).toBool());
+    QSettings ini(IniFile,QSettings::IniFormat);
+    QString mask="1111111111111111111111111111111111111111111";
+    
+    RnxVer              =ini.value ("opt/rnxver",      0).toInt();
+    RnxFile             =ini.value ("opt/rnxfile",     0).toInt();
+    RnxCode             =ini.value ("opt/rnxcode","0000").toString();
+    RunBy               =ini.value ("opt/runby",      "").toString();
+    Marker              =ini.value ("opt/marker",     "").toString();
+    MarkerNo            =ini.value ("opt/markerno",   "").toString();
+    MarkerType          =ini.value ("opt/markertype", "").toString();
+    Name[0]             =ini.value ("opt/name0",      "").toString();
+    Name[1]             =ini.value ("opt/name1",      "").toString();
+    Rec[0]              =ini.value ("opt/rec0",       "").toString();
+    Rec[1]              =ini.value ("opt/rec1",       "").toString();
+    Rec[2]              =ini.value ("opt/rec2",       "").toString();
+    Ant[0]              =ini.value ("opt/ant0",       "").toString();
+    Ant[1]              =ini.value ("opt/ant1",       "").toString();
+    Ant[2]              =ini.value ("opt/ant2",       "").toString();
+    AppPos[0]           =ini.value ("opt/apppos0",   0.0).toDouble();
+    AppPos[1]           =ini.value ("opt/apppos1",   0.0).toDouble();
+    AppPos[2]           =ini.value ("opt/apppos2",   0.0).toDouble();
+    AntDel[0]           =ini.value ("opt/antdel0",   0.0).toDouble();
+    AntDel[1]           =ini.value ("opt/antdel1",   0.0).toDouble();
+    AntDel[2]           =ini.value ("opt/antdel2",   0.0).toDouble();
+    Comment[0]          =ini.value ("opt/comment0",   "").toString();
+    Comment[1]          =ini.value ("opt/comment1",   "").toString();
+    RcvOption           =ini.value ("opt/rcvoption",  "").toString();
+    NavSys              =ini.value ("opt/navsys",    0x3).toInt();
+    ObsType             =ini.value ("opt/obstype",   0xF).toInt();
+    FreqType            =ini.value ("opt/freqtype",  0x3).toInt();
+    ExSats              =ini.value ("opt/exsats",     "").toString();
+    TraceLevel          =ini.value ("opt/tracelevel",  0).toInt();
+    RnxTime.time        =ini.value ("opt/rnxtime",     0).toInt();
+    CodeMask[0]         =ini.value ("opt/codemask_1",mask).toString();
+    CodeMask[1]         =ini.value ("opt/codemask_2",mask).toString();
+    CodeMask[2]         =ini.value ("opt/codemask_3",mask).toString();
+    CodeMask[3]         =ini.value ("opt/codemask_4",mask).toString();
+    CodeMask[4]         =ini.value ("opt/codemask_5",mask).toString();
+    CodeMask[5]         =ini.value ("opt/codemask_6",mask).toString();
+    AutoPos             =ini.value ("opt/autopos",     0).toInt();
+    ScanObs             =ini.value ("opt/scanobs",     0).toInt();
+    OutIono             =ini.value ("opt/outiono",     0).toInt();
+    OutTime             =ini.value ("opt/outtime",     0).toInt();
+    OutLeaps            =ini.value ("opt/outleaps",    0).toInt();
+    
+    TimeStartF ->setChecked(ini.value("set/timestartf",  0).toBool());
+    TimeEndF   ->setChecked(ini.value("set/timeendf",    0).toBool());
+    TimeIntF   ->setChecked(ini.value("set/timeintf",    0).toBool());
+    TimeY1     ->setDate(ini.value ("set/timey1",     "2000/01/01").value<QDate>());
+    TimeH1     ->setTime(ini.value ("set/timeh1",     "00:00:00"  ).value<QTime>());
+    TimeY2     ->setDate(ini.value ("set/timey2",     "2000/01/01").value<QDate>());
+    TimeH2     ->setTime(ini.value ("set/timeh2",     "00:00:00"  ).value<QTime>());
+    TimeInt    ->setCurrentText(ini.value ("set/timeint",   "1").toString());
+    TimeUnitF  ->setChecked(ini.value("set/timeunitf",   0).toBool());
+    TimeUnit   ->setText(ini.value ("set/timeunit", "24").toString());
+    InFile     ->setCurrentText(ini.value ("set/infile",     "").toString());
+    OutDir     ->setText(ini.value ("set/outdir",     "").toString());
+    OutFile1   ->setText(ini.value ("set/outfile1",   "").toString());
+    OutFile2   ->setText(ini.value ("set/outfile2",   "").toString());
+    OutFile3   ->setText(ini.value ("set/outfile3",   "").toString());
+    OutFile4   ->setText(ini.value ("set/outfile4",   "").toString());
+    OutFile5   ->setText(ini.value ("set/outfile5",   "").toString());
+    OutFile6   ->setText(ini.value ("set/outfile6",   "").toString());
+    OutFile7   ->setText(ini.value ("set/outfile7",   "").toString());
+    OutDirEna  ->setChecked(ini.value("set/outdirena",   false).toBool());
     OutFileEna1->setChecked(ini.value("set/outfileena1", true).toBool());
     OutFileEna2->setChecked(ini.value("set/outfileena2", true).toBool());
     OutFileEna3->setChecked(ini.value("set/outfileena3", true).toBool());
@@ -1071,110 +943,101 @@
     OutFileEna5->setChecked(ini.value("set/outfileena5", true).toBool());
     OutFileEna6->setChecked(ini.value("set/outfileena6", true).toBool());
     OutFileEna7->setChecked(ini.value("set/outfileena7", true).toBool());
-    OutFileEna8->setChecked(ini.value("set/outfileena8", true).toBool());
-    OutFileEna9->setChecked(ini.value("set/outfileena9", true).toBool());
-    Format->setCurrentIndex(ini.value("set/format", 0).toInt());
-
-    ReadList(InFile, &ini, "hist/inputfile");
-
-    TextViewer::Color1 = ini.value("viewer/color1", QColor(Qt::black)).value<QColor>();
-    TextViewer::Color2 = ini.value("viewer/color2", QColor(Qt::white)).value<QColor>();
-    TextViewer::FontD.setFamily(ini.value("viewer/fontname", "Courier New").toString());
-    TextViewer::FontD.setPointSize(ini.value("viewer/fontsize", 9).toInt());
-
-    CmdPostExe = ini.value("set/cmdpostexe", "rtkpost_qt").toString();
+    Format   ->setCurrentIndex(ini.value("set/format",      0).toInt());
+    
+    ReadList(InFile,&ini,"hist/inputfile");
+    
+    TextViewer::Color1=ini.value("viewer/color1",QColor(Qt::black)).value<QColor>();
+    TextViewer::Color2=ini.value("viewer/color2",QColor(Qt::white)).value<QColor>();
+    TextViewer::FontD.setFamily(ini.value ("viewer/fontname","Courier New").toString());
+    TextViewer::FontD.setPointSize(ini.value("viewer/fontsize",9).toInt());
 
+    CmdPostExe         =ini.value  ("set/cmdpostexe","rtkpost_qt").toString();
+    
     UpdateEnable();
 }
 // save options -------------------------------------------------------------
 void MainWindow::SaveOpt(void)
 {
-    QSettings ini(IniFile, QSettings::IniFormat);
-
-    ini.setValue("opt/rnxver", RnxVer);
-    ini.setValue("opt/rnxfile", RnxFile);
-    ini.setValue("opt/rnxcode", RnxCode);
-    ini.setValue("opt/runby", RunBy);
-    ini.setValue("opt/marker", Marker);
-    ini.setValue("opt/markerno", MarkerNo);
-    ini.setValue("opt/markertype", MarkerType);
-    ini.setValue("opt/name0", Name[0]);
-    ini.setValue("opt/name1", Name[1]);
-    ini.setValue("opt/rec0", Rec[0]);
-    ini.setValue("opt/rec1", Rec[1]);
-    ini.setValue("opt/rec2", Rec[2]);
-    ini.setValue("opt/ant0", Ant[0]);
-    ini.setValue("opt/ant1", Ant[1]);
-    ini.setValue("opt/ant2", Ant[2]);
-    ini.setValue("opt/apppos0", AppPos[0]);
-    ini.setValue("opt/apppos1", AppPos[1]);
-    ini.setValue("opt/apppos2", AppPos[2]);
-    ini.setValue("opt/antdel0", AntDel[0]);
-    ini.setValue("opt/antdel1", AntDel[1]);
-    ini.setValue("opt/antdel2", AntDel[2]);
-    ini.setValue("opt/comment0", Comment[0]);
-    ini.setValue("opt/comment1", Comment[1]);
-    ini.setValue("opt/rcvoption", RcvOption);
-    ini.setValue("opt/navsys", NavSys);
-    ini.setValue("opt/obstype", ObsType);
-    ini.setValue("opt/freqtype", FreqType);
-    ini.setValue("opt/exsats", ExSats);
-    ini.setValue("opt/tracelevel", TraceLevel);
-    ini.setValue("opt/rnxtime", (int)(RnxTime.time));
-    ini.setValue("opt/codemask_1", CodeMask[0]);
-    ini.setValue("opt/codemask_2", CodeMask[1]);
-    ini.setValue("opt/codemask_3", CodeMask[2]);
-    ini.setValue("opt/codemask_4", CodeMask[3]);
-    ini.setValue("opt/codemask_5", CodeMask[4]);
-    ini.setValue("opt/codemask_6", CodeMask[5]);
-    ini.setValue("opt/codemask_7", CodeMask[6]);
-    ini.setValue("opt/autopos", AutoPos);
-    ini.setValue("opt/scanobs", ScanObs);
-    ini.setValue("opt/halfcyc", HalfCyc);
-    ini.setValue("opt/outiono", OutIono);
-    ini.setValue("opt/outtime", OutTime);
-    ini.setValue("opt/outleaps", OutLeaps);
-    ini.setValue("opt/sepnav", SepNav);
-    ini.setValue("opt/timetol", TimeTol);
-
-    ini.setValue("set/timestartf", TimeStartF->isChecked());
-    ini.setValue("set/timeendf", TimeEndF->isChecked());
-    ini.setValue("set/timeintf", TimeIntF->isChecked());
-    ini.setValue("set/timey1", dateTime1->date());
-    ini.setValue("set/timeh1", dateTime1->time());
-    ini.setValue("set/timey2", dateTime2->date());
-    ini.setValue("set/timeh2", dateTime2->time());
-    ini.setValue("set/timeint", TimeInt->currentText());
-    ini.setValue("set/timeunitf", TimeUnitF->isChecked());
-    ini.setValue("set/timeunit", TimeUnit->text());
-    ini.setValue("set/infile", InFile->currentText());
-    ini.setValue("set/outdir", OutDir->text());
-    ini.setValue("set/outfile1", OutFile1->text());
-    ini.setValue("set/outfile2", OutFile2->text());
-    ini.setValue("set/outfile3", OutFile3->text());
-    ini.setValue("set/outfile4", OutFile4->text());
-    ini.setValue("set/outfile5", OutFile5->text());
-    ini.setValue("set/outfile6", OutFile6->text());
-    ini.setValue("set/outfile7", OutFile7->text());
-    ini.setValue("set/outfile8", OutFile8->text());
-    ini.setValue("set/outfile9", OutFile9->text());
-    ini.setValue("set/outdirena", OutDirEna->isChecked());
-    ini.setValue("set/outfileena1", OutFileEna1->isChecked());
-    ini.setValue("set/outfileena2", OutFileEna2->isChecked());
-    ini.setValue("set/outfileena3", OutFileEna3->isChecked());
-    ini.setValue("set/outfileena4", OutFileEna4->isChecked());
-    ini.setValue("set/outfileena5", OutFileEna5->isChecked());
-    ini.setValue("set/outfileena6", OutFileEna6->isChecked());
-    ini.setValue("set/outfileena7", OutFileEna7->isChecked());
-    ini.setValue("set/outfileena8", OutFileEna8->isChecked());
-    ini.setValue("set/outfileena9", OutFileEna9->isChecked());
-    ini.setValue("set/format", Format->currentIndex());
-
-    WriteList(&ini, "hist/inputfile", InFile);
+    QSettings ini(IniFile,QSettings::IniFormat);
 
-    ini.setValue("viewer/color1", TextViewer::Color1);
-    ini.setValue("viewer/color2", TextViewer::Color2);
-    ini.setValue("viewer/fontname", TextViewer::FontD.family());
-    ini.setValue("viewer/fontsize", TextViewer::FontD.pointSize());
+    ini.setValue ("opt/rnxver",     RnxVer);
+    ini.setValue ("opt/rnxfile",    RnxFile);
+    ini.setValue ("opt/rnxcode",    RnxCode);
+    ini.setValue ("opt/runby",      RunBy);
+    ini.setValue ("opt/marker",     Marker);
+    ini.setValue ("opt/markerno",   MarkerNo);
+    ini.setValue ("opt/markertype", MarkerType);
+    ini.setValue ("opt/name0",      Name[0]);
+    ini.setValue ("opt/name1",      Name[1]);
+    ini.setValue ("opt/rec0",       Rec[0]);
+    ini.setValue ("opt/rec1",       Rec[1]);
+    ini.setValue ("opt/rec2",       Rec[2]);
+    ini.setValue ("opt/ant0",       Ant[0]);
+    ini.setValue ("opt/ant1",       Ant[1]);
+    ini.setValue ("opt/ant2",       Ant[2]);
+    ini.setValue ("opt/apppos0",    AppPos[0]);
+    ini.setValue ("opt/apppos1",    AppPos[1]);
+    ini.setValue ("opt/apppos2",    AppPos[2]);
+    ini.setValue ("opt/antdel0",    AntDel[0]);
+    ini.setValue ("opt/antdel1",    AntDel[1]);
+    ini.setValue ("opt/antdel2",    AntDel[2]);
+    ini.setValue ("opt/comment0",   Comment[0]);
+    ini.setValue ("opt/comment1",   Comment[1]);
+    ini.setValue ("opt/rcvoption",  RcvOption);
+    ini.setValue ("opt/navsys",     NavSys);
+    ini.setValue ("opt/obstype",    ObsType);
+    ini.setValue ("opt/freqtype",   FreqType);
+    ini.setValue ("opt/exsats",     ExSats);
+    ini.setValue ("opt/tracelevel", TraceLevel);
+    ini.setValue ("opt/rnxtime",(int)RnxTime.time);
+    ini.setValue ("opt/codemask_1", CodeMask[0]);
+    ini.setValue ("opt/codemask_2", CodeMask[1]);
+    ini.setValue ("opt/codemask_3", CodeMask[2]);
+    ini.setValue ("opt/codemask_4", CodeMask[3]);
+    ini.setValue ("opt/codemask_5", CodeMask[4]);
+    ini.setValue ("opt/codemask_6", CodeMask[5]);
+    ini.setValue ("opt/autopos",    AutoPos);
+    ini.setValue ("opt/scanobs",    ScanObs);
+    ini.setValue ("opt/outiono",    OutIono);
+    ini.setValue ("opt/outtime",    OutTime);
+    ini.setValue ("opt/outleaps",   OutLeaps);
+    
+    ini.setValue ("set/timestartf", TimeStartF ->isChecked());
+    ini.setValue ("set/timeendf",   TimeEndF   ->isChecked());
+    ini.setValue ("set/timeintf",   TimeIntF   ->isChecked());
+    ini.setValue ("set/timey1",     TimeY1     ->date());
+    ini.setValue ("set/timeh1",     TimeH1     ->time());
+    ini.setValue ("set/timey2",     TimeY2     ->date());
+    ini.setValue ("set/timeh2",     TimeH2     ->time());
+    ini.setValue ("set/timeint",    TimeInt    ->currentText());
+    ini.setValue("set/timeunitf",  TimeUnitF  ->isChecked());
+    ini.setValue ("set/timeunit",   TimeUnit   ->text());
+    ini.setValue ("set/infile",     InFile     ->currentText());
+    ini.setValue ("set/outdir",     OutDir     ->text());
+    ini.setValue ("set/outfile1",   OutFile1   ->text());
+    ini.setValue ("set/outfile2",   OutFile2   ->text());
+    ini.setValue ("set/outfile3",   OutFile3   ->text());
+    ini.setValue ("set/outfile4",   OutFile4   ->text());
+    ini.setValue ("set/outfile5",   OutFile5   ->text());
+    ini.setValue ("set/outfile6",   OutFile6   ->text());
+    ini.setValue ("set/outfile7",   OutFile7   ->text());
+    ini.setValue("set/outdirena",  OutDirEna  ->isChecked());
+    ini.setValue("set/outfileena1",OutFileEna1->isChecked());
+    ini.setValue("set/outfileena2",OutFileEna2->isChecked());
+    ini.setValue("set/outfileena3",OutFileEna3->isChecked());
+    ini.setValue("set/outfileena4",OutFileEna4->isChecked());
+    ini.setValue("set/outfileena5",OutFileEna5->isChecked());
+    ini.setValue("set/outfileena6",OutFileEna6->isChecked());
+    ini.setValue("set/outfileena7",OutFileEna7->isChecked());
+    ini.setValue("set/format",     Format     ->currentIndex());
+    
+    WriteList(&ini,"hist/inputfile",InFile);
+    
+    ini.setValue("viewer/color1",  TextViewer::Color1  );
+    ini.setValue("viewer/color2",  TextViewer::Color2  );
+    ini.setValue("viewer/fontname",TextViewer::FontD.family());
+    ini.setValue("viewer/fontsize",TextViewer::FontD.pointSize());
 }
 //---------------------------------------------------------------------------
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/convmain.h RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/convmain.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/convmain.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/convmain.h	2019-08-19 02:04:50.000000000 +0300
@@ -20,35 +20,35 @@
 class StartDialog;
 class TextViewer;
 
-// Conversion Thread Class ------------------------------------------------------------------
+//Helper Class ------------------------------------------------------------------
 
 class ConversionThread : public QThread
 {
     Q_OBJECT
 public:
-    char ifile[1024], *ofile[9];
+    char ifile[1024],*ofile[7];
     rnxopt_t rnxopt;
     int format;
 
-    explicit ConversionThread(QObject *parent) : QThread(parent) {
-        for (int i = 0; i < 9; i++)
+    explicit ConversionThread(QObject *parent):QThread(parent){
+        for (int i=0;i<7;i++)
         {
-            ofile[i] = new char[1024];
-            ofile[i][0] = '\0';
+            ofile[i]=new char[1024];
+            ofile[i][0]='\0';
         };
-        memset(&rnxopt, 0, sizeof(rnxopt_t));
-        format = 0;
-        ifile[0] = '\0';
+        memset(&rnxopt,0,sizeof(rnxopt_t));
+        format=0;
+        ifile[0]='\0';
     }
 
     ~ConversionThread() {
-        for (int i = 0; i < 9; i++) delete[] ofile[i];
+        for (int i=0;i<7;i++) delete[] ofile[i];
     }
 
 protected:
     void run() {
         // convert to rinex
-        convrnx(format, &rnxopt, ifile, ofile);
+        convrnx(format,&rnxopt,ifile,ofile);
     }
 };
 
@@ -56,61 +56,58 @@
 class MainWindow : public QMainWindow, public Ui::MainWindow
 {
     Q_OBJECT
-
 protected:
     void showEvent           (QShowEvent*);
     void closeEvent          (QCloseEvent*);
-    void dragEnterEvent      (QDragEnterEvent *);
-    void dropEvent           (QDropEvent *);
-
+    void dragEnterEvent      (QDragEnterEvent *event);
+    void dropEvent           (QDropEvent *event);
 public slots:
-    void BtnPlotClick();
-    void BtnConvertClick();
-    void BtnOptionsClick();
-    void BtnExitClick();
-    void BtnAboutClick();
-    void BtnTime1Click();
-    void BtnTime2Click();
-    void BtnInFileClick();
-    void BtnOutFile1Click();
-    void BtnOutFile2Click();
-    void BtnOutFile3Click();
-    void BtnOutFile4Click();
-    void BtnOutFile5Click();
-    void BtnOutFile6Click();
-    void BtnOutFile7Click();
-    void BtnOutFile8Click();
-    void BtnOutFile9Click();
+    void FormCreate          ();
+
+    void BtnPlotClick        ();
+    void BtnConvertClick     ();
+    void BtnOptionsClick     ();
+    void BtnExitClick        ();
+    void BtnAboutClick       ();
+    void BtnTime1Click       ();
+    void BtnTime2Click       ();
+    void BtnInFileClick      ();
+    void BtnOutFile1Click    ();
+    void BtnOutFile2Click    ();
+    void BtnOutFile3Click    ();
+    void BtnOutFile4Click    ();
     void BtnOutFileView1Click();
     void BtnOutFileView2Click();
     void BtnOutFileView3Click();
     void BtnOutFileView4Click();
-    void BtnOutFileView5Click();
-    void BtnOutFileView6Click();
-    void BtnOutFileView7Click();
-    void BtnOutFileView8Click();
-    void BtnOutFileView9Click();
-    void BtnAbortClick();
+    void BtnAbortClick       ();
 	
-    void TimeStartFClick();
-    void TimeEndFClick();
-    void TimeIntFClick();
-    void OutDirEnaClick();
+    void TimeStartFClick     ();
+    void TimeEndFClick       ();
+    void TimeIntFClick       ();
+    void OutDirEnaClick      ();
 	
     void InFileChange();
+    void BtnOutFileView5Click();
+    void BtnOutFile5Click();
     void FormatChange();
+    void BtnOutFileView6Click();
+    void BtnOutFile6Click();
     void OutDirChange();
     void BtnOutDirClick();
     void BtnKeyClick();
     void BtnPostClick();
+    void BtnOutFile7Click();
+    void BtnOutFileView7Click();
     void BtnInFileViewClick();
     void ConversionFinished();
     void UpdateEnable();
 
 private:
-    QString IniFile, CmdPostExe;
+    QString IniFile,CmdPostExe;
     ConversionThread *conversionThread;
-
+//    void DropFiles(TWMDropFiles msg); // for files drop
+	
     void ReadList(QComboBox* combo, QSettings *ini, const QString &key);
     void WriteList(QSettings *ini, const QString &key, const QComboBox *combo);
     void AddHist(QComboBox *combo);
@@ -132,12 +129,12 @@
     TextViewer *viewer;
 public:
 	gtime_t RnxTime;
-    QString RunBy, Marker, MarkerNo, MarkerType, Name[2], Rec[3], Ant[3];
-    QString RnxCode, Comment[2], RcvOption, ExSats;
-    QString CodeMask[7];
-    double AppPos[3], AntDel[3], TimeTol;
-    int RnxVer, RnxFile, NavSys, ObsType, FreqType, TraceLevel;
-    int AutoPos, ScanObs, HalfCyc, OutIono, OutTime, OutLeaps, SepNav;
+    QString RunBy,Marker,MarkerNo,MarkerType,Name[2],Rec[3],Ant[3];
+    QString RnxCode,Comment[2],RcvOption,ExSats;
+    QString CodeMask[6];
+	double AppPos[3],AntDel[3];
+	int RnxVer,RnxFile,NavSys,ObsType,FreqType,TraceLevel,EventEna;
+	int AutoPos,ScanObs,OutIono,OutTime,OutLeaps;
 	
     explicit MainWindow(QWidget *parent=0);
 };
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/convmain.ui RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/convmain.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/convmain.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/convmain.ui	2019-08-19 02:04:50.000000000 +0300
@@ -105,6 +105,9 @@
          </item>
         </widget>
        </item>
+       <item row="1" column="3">
+        <widget class="QDateEdit" name="TimeY2"/>
+       </item>
        <item row="0" column="2">
         <widget class="QPushButton" name="BtnTime1">
          <property name="sizePolicy">
@@ -121,6 +124,9 @@
          </property>
         </widget>
        </item>
+       <item row="1" column="0">
+        <widget class="QDateEdit" name="TimeY1"/>
+       </item>
        <item row="0" column="6">
         <widget class="QCheckBox" name="TimeIntF">
          <property name="text">
@@ -172,19 +178,11 @@
          </property>
         </widget>
        </item>
-       <item row="1" column="0" colspan="3">
-        <widget class="QDateTimeEdit" name="dateTime1">
-         <property name="calendarPopup">
-          <bool>true</bool>
-         </property>
-        </widget>
+       <item row="1" column="1" colspan="2">
+        <widget class="QTimeEdit" name="TimeH1"/>
        </item>
-       <item row="1" column="3" colspan="3">
-        <widget class="QDateTimeEdit" name="dateTime2">
-         <property name="calendarPopup">
-          <bool>true</bool>
-         </property>
-        </widget>
+       <item row="1" column="4" colspan="2">
+        <widget class="QTimeEdit" name="TimeH2"/>
        </item>
       </layout>
      </widget>
@@ -192,17 +190,31 @@
     <item>
      <widget class="QWidget" name="Panel2" native="true">
       <layout class="QGridLayout" name="gridLayout_2">
-       <item row="1" column="0" colspan="2">
-        <widget class="QLabel" name="LabelInFile">
+       <item row="11" column="0">
+        <widget class="QCheckBox" name="OutFileEna6">
          <property name="text">
-          <string>RTCM, RCV RAW or RINEX OBS</string>
+          <string/>
          </property>
         </widget>
        </item>
-       <item row="2" column="0" colspan="3">
-        <widget class="QComboBox" name="InFile">
-         <property name="editable">
-          <bool>true</bool>
+       <item row="7" column="0">
+        <widget class="QCheckBox" name="OutFileEna2">
+         <property name="text">
+          <string/>
+         </property>
+        </widget>
+       </item>
+       <item row="3" column="0" colspan="2">
+        <widget class="QLabel" name="LabelOutDir">
+         <property name="text">
+          <string>Output Directory:</string>
+         </property>
+        </widget>
+       </item>
+       <item row="9" column="0">
+        <widget class="QCheckBox" name="OutFileEna4">
+         <property name="text">
+          <string/>
          </property>
         </widget>
        </item>
@@ -227,43 +239,60 @@
          </property>
         </widget>
        </item>
-       <item row="10" column="3">
-        <widget class="QPushButton" name="BtnOutFileView5">
+       <item row="4" column="1">
+        <widget class="QLineEdit" name="OutDir"/>
+       </item>
+       <item row="6" column="0">
+        <widget class="QCheckBox" name="OutFileEna1">
          <property name="text">
           <string/>
          </property>
-         <property name="icon">
-          <iconset resource="../rtkvideo_qt/rtkvideo_qt.qrc">
-           <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
+        </widget>
+       </item>
+       <item row="10" column="0">
+        <widget class="QCheckBox" name="OutFileEna5">
+         <property name="text">
+          <string/>
          </property>
-         <property name="flat">
-          <bool>true</bool>
+        </widget>
+       </item>
+       <item row="5" column="0" colspan="2">
+        <widget class="QLabel" name="LabelOutFile">
+         <property name="text">
+          <string>RINEX OBS/NAV/GNAV/HNAV/QNAV/LNAV and SBS</string>
          </property>
         </widget>
        </item>
-       <item row="11" column="3">
-        <widget class="QPushButton" name="BtnOutFileView6">
+       <item row="4" column="0">
+        <widget class="QCheckBox" name="OutDirEna">
          <property name="text">
           <string/>
          </property>
-         <property name="icon">
-          <iconset resource="../rtkvideo_qt/rtkvideo_qt.qrc">
-           <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
-         </property>
-         <property name="flat">
-          <bool>true</bool>
+        </widget>
+       </item>
+       <item row="12" column="0">
+        <widget class="QCheckBox" name="OutFileEna7">
+         <property name="text">
+          <string/>
          </property>
         </widget>
        </item>
-       <item row="7" column="0">
-        <widget class="QCheckBox" name="OutFileEna2">
+       <item row="6" column="3">
+        <widget class="QPushButton" name="BtnOutFileView1">
          <property name="text">
           <string/>
          </property>
+         <property name="icon">
+          <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
+           <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
+         </property>
+         <property name="flat">
+          <bool>true</bool>
+         </property>
         </widget>
        </item>
-       <item row="10" column="4">
-        <widget class="QPushButton" name="BtnOutFile5">
+       <item row="6" column="4">
+        <widget class="QPushButton" name="BtnOutFile1">
          <property name="sizePolicy">
           <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
            <horstretch>0</horstretch>
@@ -275,8 +304,8 @@
          </property>
         </widget>
        </item>
-       <item row="11" column="4">
-        <widget class="QPushButton" name="BtnOutFile6">
+       <item row="7" column="4">
+        <widget class="QPushButton" name="BtnOutFile2">
          <property name="sizePolicy">
           <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
            <horstretch>0</horstretch>
@@ -288,8 +317,8 @@
          </property>
         </widget>
        </item>
-       <item row="6" column="4">
-        <widget class="QPushButton" name="BtnOutFile1">
+       <item row="8" column="4">
+        <widget class="QPushButton" name="BtnOutFile3">
          <property name="sizePolicy">
           <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
            <horstretch>0</horstretch>
@@ -301,41 +330,45 @@
          </property>
         </widget>
        </item>
-       <item row="1" column="2">
-        <widget class="QPushButton" name="BtnKey">
-         <property name="sizePolicy">
-          <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-           <horstretch>0</horstretch>
-           <verstretch>0</verstretch>
-          </sizepolicy>
-         </property>
+       <item row="7" column="3">
+        <widget class="QPushButton" name="BtnOutFileView2">
          <property name="text">
-          <string>?</string>
+          <string/>
+         </property>
+         <property name="icon">
+          <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
+           <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
          </property>
          <property name="flat">
           <bool>true</bool>
          </property>
         </widget>
        </item>
-       <item row="11" column="0">
-        <widget class="QCheckBox" name="OutFileEna6">
+       <item row="8" column="3">
+        <widget class="QPushButton" name="BtnOutFileView3">
          <property name="text">
           <string/>
          </property>
+         <property name="icon">
+          <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
+           <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
+         </property>
+         <property name="flat">
+          <bool>true</bool>
+         </property>
         </widget>
        </item>
-       <item row="4" column="1">
-        <widget class="QLineEdit" name="OutDir"/>
+       <item row="8" column="1" colspan="2">
+        <widget class="QLineEdit" name="OutFile3"/>
        </item>
-       <item row="6" column="0">
-        <widget class="QCheckBox" name="OutFileEna1">
-         <property name="text">
-          <string/>
-         </property>
-        </widget>
+       <item row="7" column="1" colspan="2">
+        <widget class="QLineEdit" name="OutFile2"/>
        </item>
-       <item row="7" column="4">
-        <widget class="QPushButton" name="BtnOutFile2">
+       <item row="6" column="1" colspan="2">
+        <widget class="QLineEdit" name="OutFile1"/>
+       </item>
+       <item row="9" column="4">
+        <widget class="QPushButton" name="BtnOutFile4">
          <property name="sizePolicy">
           <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
            <horstretch>0</horstretch>
@@ -347,8 +380,8 @@
          </property>
         </widget>
        </item>
-       <item row="8" column="4">
-        <widget class="QPushButton" name="BtnOutFile3">
+       <item row="10" column="4">
+        <widget class="QPushButton" name="BtnOutFile5">
          <property name="sizePolicy">
           <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
            <horstretch>0</horstretch>
@@ -360,25 +393,8 @@
          </property>
         </widget>
        </item>
-       <item row="8" column="1" colspan="2">
-        <widget class="QLineEdit" name="OutFile3"/>
-       </item>
-       <item row="7" column="3">
-        <widget class="QPushButton" name="BtnOutFileView2">
-         <property name="text">
-          <string/>
-         </property>
-         <property name="icon">
-          <iconset resource="../rtkvideo_qt/rtkvideo_qt.qrc">
-           <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
-         </property>
-         <property name="flat">
-          <bool>true</bool>
-         </property>
-        </widget>
-       </item>
-       <item row="12" column="4">
-        <widget class="QPushButton" name="BtnOutFile7">
+       <item row="11" column="4">
+        <widget class="QPushButton" name="BtnOutFile6">
          <property name="sizePolicy">
           <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
            <horstretch>0</horstretch>
@@ -390,22 +406,8 @@
          </property>
         </widget>
        </item>
-       <item row="9" column="3">
-        <widget class="QPushButton" name="BtnOutFileView4">
-         <property name="text">
-          <string/>
-         </property>
-         <property name="icon">
-          <iconset resource="../rtkvideo_qt/rtkvideo_qt.qrc">
-           <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
-         </property>
-         <property name="flat">
-          <bool>true</bool>
-         </property>
-        </widget>
-       </item>
-       <item row="9" column="4">
-        <widget class="QPushButton" name="BtnOutFile4">
+       <item row="12" column="4">
+        <widget class="QPushButton" name="BtnOutFile7">
          <property name="sizePolicy">
           <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
            <horstretch>0</horstretch>
@@ -417,13 +419,13 @@
          </property>
         </widget>
        </item>
-       <item row="6" column="3">
-        <widget class="QPushButton" name="BtnOutFileView1">
+       <item row="9" column="3">
+        <widget class="QPushButton" name="BtnOutFileView4">
          <property name="text">
           <string/>
          </property>
          <property name="icon">
-          <iconset resource="../rtkvideo_qt/rtkvideo_qt.qrc">
+          <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
            <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
          </property>
          <property name="flat">
@@ -431,30 +433,13 @@
          </property>
         </widget>
        </item>
-       <item row="4" column="0">
-        <widget class="QCheckBox" name="OutDirEna">
-         <property name="text">
-          <string/>
-         </property>
-        </widget>
-       </item>
-       <item row="12" column="0">
-        <widget class="QCheckBox" name="OutFileEna7">
-         <property name="text">
-          <string/>
-         </property>
-        </widget>
-       </item>
-       <item row="7" column="1" colspan="2">
-        <widget class="QLineEdit" name="OutFile2"/>
-       </item>
-       <item row="8" column="3">
-        <widget class="QPushButton" name="BtnOutFileView3">
+       <item row="10" column="3">
+        <widget class="QPushButton" name="BtnOutFileView5">
          <property name="text">
           <string/>
          </property>
          <property name="icon">
-          <iconset resource="../rtkvideo_qt/rtkvideo_qt.qrc">
+          <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
            <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
          </property>
          <property name="flat">
@@ -462,57 +447,13 @@
          </property>
         </widget>
        </item>
-       <item row="6" column="1" colspan="2">
-        <widget class="QLineEdit" name="OutFile1"/>
-       </item>
-       <item row="10" column="0">
-        <widget class="QCheckBox" name="OutFileEna5">
-         <property name="text">
-          <string/>
-         </property>
-        </widget>
-       </item>
-       <item row="5" column="0" colspan="2">
-        <widget class="QLabel" name="LabelOutFile">
-         <property name="text">
-          <string>RINEX OBS/NAV/GNAV/HNAV/QNAV/LNAV and SBS</string>
-         </property>
-        </widget>
-       </item>
-       <item row="3" column="0" colspan="2">
-        <widget class="QLabel" name="LabelOutDir">
-         <property name="text">
-          <string>Output Directory:</string>
-         </property>
-        </widget>
-       </item>
-       <item row="9" column="0">
-        <widget class="QCheckBox" name="OutFileEna4">
-         <property name="text">
-          <string/>
-         </property>
-        </widget>
-       </item>
-       <item row="2" column="4">
-        <widget class="QPushButton" name="BtnInFile">
-         <property name="sizePolicy">
-          <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-           <horstretch>0</horstretch>
-           <verstretch>0</verstretch>
-          </sizepolicy>
-         </property>
-         <property name="text">
-          <string>...</string>
-         </property>
-        </widget>
-       </item>
-       <item row="2" column="3">
-        <widget class="QPushButton" name="BtnInFileView">
+       <item row="11" column="3">
+        <widget class="QPushButton" name="BtnOutFileView6">
          <property name="text">
           <string/>
          </property>
          <property name="icon">
-          <iconset resource="../rtkvideo_qt/rtkvideo_qt.qrc">
+          <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
            <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
          </property>
          <property name="flat">
@@ -520,22 +461,13 @@
          </property>
         </widget>
        </item>
-       <item row="4" column="3" colspan="2">
-        <widget class="QComboBox" name="Format"/>
-       </item>
-       <item row="10" column="1" colspan="2">
-        <widget class="QLineEdit" name="OutFile5"/>
-       </item>
-       <item row="9" column="1" colspan="2">
-        <widget class="QLineEdit" name="OutFile4"/>
-       </item>
        <item row="12" column="3">
         <widget class="QPushButton" name="BtnOutFileView7">
          <property name="text">
           <string/>
          </property>
          <property name="icon">
-          <iconset resource="../rtkvideo_qt/rtkvideo_qt.qrc">
+          <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
            <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
          </property>
          <property name="flat">
@@ -543,39 +475,41 @@
          </property>
         </widget>
        </item>
+       <item row="9" column="1" colspan="2">
+        <widget class="QLineEdit" name="OutFile4"/>
+       </item>
+       <item row="10" column="1" colspan="2">
+        <widget class="QLineEdit" name="OutFile5"/>
+       </item>
        <item row="11" column="1" colspan="2">
         <widget class="QLineEdit" name="OutFile6"/>
        </item>
        <item row="12" column="1" colspan="2">
         <widget class="QLineEdit" name="OutFile7"/>
        </item>
-       <item row="13" column="1" colspan="2">
-        <widget class="QLineEdit" name="OutFile8"/>
-       </item>
-       <item row="14" column="1" colspan="2">
-        <widget class="QLineEdit" name="OutFile9"/>
+       <item row="4" column="3" colspan="2">
+        <widget class="QComboBox" name="Format"/>
        </item>
-       <item row="13" column="0">
-        <widget class="QCheckBox" name="OutFileEna8">
-         <property name="text">
-          <string/>
+       <item row="2" column="4">
+        <widget class="QPushButton" name="BtnInFile">
+         <property name="sizePolicy">
+          <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
+           <horstretch>0</horstretch>
+           <verstretch>0</verstretch>
+          </sizepolicy>
          </property>
-        </widget>
-       </item>
-       <item row="14" column="0">
-        <widget class="QCheckBox" name="OutFileEna9">
          <property name="text">
-          <string/>
+          <string>...</string>
          </property>
         </widget>
        </item>
-       <item row="13" column="3">
-        <widget class="QPushButton" name="BtnOutFileView8">
+       <item row="2" column="3">
+        <widget class="QPushButton" name="BtnInFileView">
          <property name="text">
           <string/>
          </property>
          <property name="icon">
-          <iconset resource="../rtkvideo_qt/rtkvideo_qt.qrc">
+          <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
            <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
          </property>
          <property name="flat">
@@ -583,22 +517,15 @@
          </property>
         </widget>
        </item>
-       <item row="14" column="3">
-        <widget class="QPushButton" name="BtnOutFileView9">
-         <property name="text">
-          <string/>
-         </property>
-         <property name="icon">
-          <iconset resource="../rtkvideo_qt/rtkvideo_qt.qrc">
-           <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
-         </property>
-         <property name="flat">
+       <item row="2" column="0" colspan="3">
+        <widget class="QComboBox" name="InFile">
+         <property name="editable">
           <bool>true</bool>
          </property>
         </widget>
        </item>
-       <item row="13" column="4">
-        <widget class="QPushButton" name="BtnOutFile8">
+       <item row="1" column="2">
+        <widget class="QPushButton" name="BtnKey">
          <property name="sizePolicy">
           <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
            <horstretch>0</horstretch>
@@ -606,20 +533,17 @@
           </sizepolicy>
          </property>
          <property name="text">
-          <string>...</string>
+          <string>?</string>
+         </property>
+         <property name="flat">
+          <bool>true</bool>
          </property>
         </widget>
        </item>
-       <item row="14" column="4">
-        <widget class="QPushButton" name="BtnOutFile9">
-         <property name="sizePolicy">
-          <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-           <horstretch>0</horstretch>
-           <verstretch>0</verstretch>
-          </sizepolicy>
-         </property>
+       <item row="1" column="0" colspan="2">
+        <widget class="QLabel" name="LabelInFile">
          <property name="text">
-          <string>...</string>
+          <string>RTCM, RCV RAW or RINEX OBS</string>
          </property>
         </widget>
        </item>
@@ -706,7 +630,7 @@
           <string>&amp;Plot...</string>
          </property>
          <property name="icon">
-          <iconset resource="../rtkvideo_qt/rtkvideo_qt.qrc">
+          <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
            <normaloff>:/buttons/chart.bmp</normaloff>:/buttons/chart.bmp</iconset>
          </property>
         </widget>
@@ -724,7 +648,7 @@
           <string>&amp;Options...</string>
          </property>
          <property name="icon">
-          <iconset resource="../rtkvideo_qt/rtkvideo_qt.qrc">
+          <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
            <normaloff>:/buttons/toolbmp</normaloff>:/buttons/toolbmp</iconset>
          </property>
         </widget>
@@ -735,7 +659,7 @@
           <string>&amp;Convert</string>
          </property>
          <property name="icon">
-          <iconset resource="../rtkvideo_qt/rtkvideo_qt.qrc">
+          <iconset resource="../rtknavi_qt/rtknavi_qt.qrc">
            <normaloff>:/buttons/start.bmp</normaloff>:/buttons/start.bmp</iconset>
          </property>
         </widget>
@@ -746,7 +670,7 @@
           <string>Abort</string>
          </property>
          <property name="icon">
-          <iconset resource="../rtkvideo_qt/rtkvideo_qt.qrc">
+          <iconset resource="../rtknavi_qt/rtknavi_qt.qrc">
            <normaloff>:/buttons/stop2.bmp</normaloff>:/buttons/stop2.bmp</iconset>
          </property>
         </widget>
@@ -764,63 +688,9 @@
    </layout>
   </widget>
  </widget>
- <tabstops>
-  <tabstop>BtnConvert</tabstop>
-  <tabstop>BtnAbort</tabstop>
-  <tabstop>BtnExit</tabstop>
-  <tabstop>TimeStartF</tabstop>
-  <tabstop>BtnTime1</tabstop>
-  <tabstop>TimeEndF</tabstop>
-  <tabstop>BtnTime2</tabstop>
-  <tabstop>TimeIntF</tabstop>
-  <tabstop>TimeUnitF</tabstop>
-  <tabstop>dateTime1</tabstop>
-  <tabstop>dateTime2</tabstop>
-  <tabstop>TimeInt</tabstop>
-  <tabstop>TimeUnit</tabstop>
-  <tabstop>InFile</tabstop>
-  <tabstop>BtnKey</tabstop>
-  <tabstop>BtnInFileView</tabstop>
-  <tabstop>BtnInFile</tabstop>
-  <tabstop>OutDirEna</tabstop>
-  <tabstop>OutDir</tabstop>
-  <tabstop>BtnOutDir</tabstop>
-  <tabstop>Format</tabstop>
-  <tabstop>OutFileEna1</tabstop>
-  <tabstop>OutFile1</tabstop>
-  <tabstop>BtnOutFileView1</tabstop>
-  <tabstop>BtnOutFile1</tabstop>
-  <tabstop>OutFileEna2</tabstop>
-  <tabstop>OutFile2</tabstop>
-  <tabstop>BtnOutFileView2</tabstop>
-  <tabstop>BtnOutFile2</tabstop>
-  <tabstop>OutFileEna3</tabstop>
-  <tabstop>OutFile3</tabstop>
-  <tabstop>BtnOutFileView3</tabstop>
-  <tabstop>BtnOutFile3</tabstop>
-  <tabstop>OutFileEna4</tabstop>
-  <tabstop>OutFile4</tabstop>
-  <tabstop>BtnOutFileView4</tabstop>
-  <tabstop>BtnOutFile4</tabstop>
-  <tabstop>OutFileEna5</tabstop>
-  <tabstop>OutFile5</tabstop>
-  <tabstop>BtnOutFileView5</tabstop>
-  <tabstop>BtnOutFile5</tabstop>
-  <tabstop>OutFileEna6</tabstop>
-  <tabstop>OutFile6</tabstop>
-  <tabstop>BtnOutFileView6</tabstop>
-  <tabstop>BtnOutFile6</tabstop>
-  <tabstop>OutFileEna7</tabstop>
-  <tabstop>OutFile7</tabstop>
-  <tabstop>BtnOutFileView7</tabstop>
-  <tabstop>BtnOutFile7</tabstop>
-  <tabstop>BtnAbout</tabstop>
-  <tabstop>BtnPlot</tabstop>
-  <tabstop>BtnPost</tabstop>
-  <tabstop>BtnOptions</tabstop>
- </tabstops>
  <resources>
-  <include location="../rtkvideo_qt/rtkvideo_qt.qrc"/>
+  <include location="../rtkpost_qt/rtkpost_qt.qrc"/>
+  <include location="../rtknavi_qt/rtknavi_qt.qrc"/>
  </resources>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/convopt.cpp RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/convopt.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/convopt.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/convopt.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -12,20 +12,20 @@
 {
     setupUi(this);
 
-    codeOptDialog = new CodeOptDialog(this, this);
+    codeOptDialog = new CodeOptDialog(this,this);
 
-    int glo = MAXPRNGLO, gal = MAXPRNGAL, qzs = MAXPRNQZS, cmp = MAXPRNCMP;
-    if (glo <= 0) Nav2->setEnabled(false);
-    if (gal <= 0) Nav3->setEnabled(false);
-    if (qzs <= 0) Nav4->setEnabled(false);
-    if (cmp <= 0) Nav6->setEnabled(false);
+	int glo=MAXPRNGLO,gal=MAXPRNGAL,qzs=MAXPRNQZS,cmp=MAXPRNCMP;
+    if (glo<=0) Nav2->setEnabled(false);
+    if (gal<=0) Nav3->setEnabled(false);
+    if (qzs<=0) Nav4->setEnabled(false);
+    if (cmp<=0) Nav6->setEnabled(false);
 
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnMask, SIGNAL(clicked(bool)), this, SLOT(BtnMaskClick()));
-    connect(AutoPos, SIGNAL(clicked(bool)), this, SLOT(AutoPosClick()));
-    connect(RnxFile, SIGNAL(clicked(bool)), this, SLOT(RnxFileClick()));
-    connect(RnxVer, SIGNAL(currentIndexChanged(int)), this, SLOT(RnxVerChange()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnMask,SIGNAL(clicked(bool)),this,SLOT(BtnMaskClick()));
+    connect(AutoPos,SIGNAL(clicked(bool)),this,SLOT(AutoPosClick()));
+    connect(RnxFile,SIGNAL(clicked(bool)),this,SLOT(RnxFileClick()));
+    connect(RnxVer,SIGNAL(currentIndexChanged(int)),this,SLOT(RnxVerChange()));
 
 	UpdateEnable();
 }
@@ -49,117 +49,103 @@
     Ant0->setText(mainWindow->Ant[0]);
     Ant1->setText(mainWindow->Ant[1]);
     Ant2->setText(mainWindow->Ant[2]);
-    AppPos0->setValue(mainWindow->AppPos[0]);
-    AppPos1->setValue(mainWindow->AppPos[1]);
-    AppPos2->setValue(mainWindow->AppPos[2]);
-    AntDel0->setValue(mainWindow->AntDel[0]);
-    AntDel1->setValue(mainWindow->AntDel[1]);
-    AntDel2->setValue(mainWindow->AntDel[2]);
+    AppPos0->setText(QString::number(mainWindow->AppPos[0],'f',4));
+    AppPos1->setText(QString::number(mainWindow->AppPos[1],'f',4));
+    AppPos2->setText(QString::number(mainWindow->AppPos[2],'f',4));
+    AntDel0->setText(QString::number(mainWindow->AntDel[0],'f',4));
+    AntDel1->setText(QString::number(mainWindow->AntDel[1],'f',4));
+    AntDel2->setText(QString::number(mainWindow->AntDel[2],'f',4));
     Comment0->setText(mainWindow->Comment[0]);
     Comment1->setText(mainWindow->Comment[1]);
     RcvOption->setText(mainWindow->RcvOption);
-
-    for (int i = 0; i < 7; i++) CodeMask[i] = mainWindow->CodeMask[i];
-
+    for (int i=0;i<6;i++) CodeMask[i]=mainWindow->CodeMask[i];
     AutoPos->setChecked(mainWindow->AutoPos);
     ScanObs->setChecked(mainWindow->ScanObs);
-    HalfCyc->setChecked(mainWindow->HalfCyc);
     OutIono->setChecked(mainWindow->OutIono);
     OutTime->setChecked(mainWindow->OutTime);
     OutLeaps->setChecked(mainWindow->OutLeaps);
 
-    Nav1->setChecked(mainWindow->NavSys & SYS_GPS);
-    Nav2->setChecked(mainWindow->NavSys & SYS_GLO);
-    Nav3->setChecked(mainWindow->NavSys & SYS_GAL);
-    Nav4->setChecked(mainWindow->NavSys & SYS_QZS);
-    Nav5->setChecked(mainWindow->NavSys & SYS_SBS);
-    Nav6->setChecked(mainWindow->NavSys & SYS_CMP);
-    Nav7->setChecked(mainWindow->NavSys & SYS_IRN);
-    Obs1->setChecked(mainWindow->ObsType & OBSTYPE_PR);
-    Obs2->setChecked(mainWindow->ObsType & OBSTYPE_CP);
-    Obs3->setChecked(mainWindow->ObsType & OBSTYPE_DOP);
-    Obs4->setChecked(mainWindow->ObsType & OBSTYPE_SNR);
-    Freq1->setChecked(mainWindow->FreqType & FREQTYPE_L1);
-    Freq2->setChecked(mainWindow->FreqType & FREQTYPE_L2);
-    Freq3->setChecked(mainWindow->FreqType & FREQTYPE_L5);
-    Freq4->setChecked(mainWindow->FreqType & FREQTYPE_L6);
-    Freq5->setChecked(mainWindow->FreqType & FREQTYPE_L7);
-    Freq6->setChecked(mainWindow->FreqType & FREQTYPE_L8);
-    Freq7->setChecked(mainWindow->FreqType & FREQTYPE_L9);
+    Nav1->setChecked(mainWindow->NavSys&SYS_GPS);
+    Nav2->setChecked(mainWindow->NavSys&SYS_GLO);
+    Nav3->setChecked(mainWindow->NavSys&SYS_GAL);
+    Nav4->setChecked(mainWindow->NavSys&SYS_QZS);
+    Nav5->setChecked(mainWindow->NavSys&SYS_SBS);
+    Nav6->setChecked(mainWindow->NavSys&SYS_CMP);
+    Nav7->setChecked(mainWindow->NavSys&SYS_IRN);
+    Obs1->setChecked(mainWindow->ObsType&OBSTYPE_PR);
+    Obs2->setChecked(mainWindow->ObsType&OBSTYPE_CP);
+    Obs3->setChecked(mainWindow->ObsType&OBSTYPE_DOP);
+    Obs4->setChecked(mainWindow->ObsType&OBSTYPE_SNR);
+    Freq1->setChecked(mainWindow->FreqType&FREQTYPE_L1);
+    Freq2->setChecked(mainWindow->FreqType&FREQTYPE_L2);
+    Freq3->setChecked(mainWindow->FreqType&FREQTYPE_L5);
+    Freq4->setChecked(mainWindow->FreqType&FREQTYPE_L6);
+    Freq5->setChecked(mainWindow->FreqType&FREQTYPE_L7);
+    Freq6->setChecked(mainWindow->FreqType&FREQTYPE_L8);
+    Freq7->setChecked(mainWindow->FreqType&FREQTYPE_L9);
     ExSats->setText(mainWindow->ExSats);
     TraceLevel->setCurrentIndex(mainWindow->TraceLevel);
-    ChkSepNav->setChecked(mainWindow->SepNav);
-    TimeTol->setValue(mainWindow->TimeTol);
-
+	
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
 void ConvOptDialog::BtnOkClick()
 {
-    mainWindow->RnxVer = RnxVer->currentIndex();
-    mainWindow->RnxFile = RnxFile->isChecked();
-    mainWindow->RnxCode = RnxCode->text();
-    mainWindow->RunBy = RunBy->text();
-    mainWindow->Marker = Marker->text();
-    mainWindow->MarkerNo = MarkerNo->text();
-    mainWindow->MarkerType = MarkerType->text();
-    mainWindow->Name[0] = Name0->text();
-    mainWindow->Name[1] = Name1->text();
-    mainWindow->Rec[0] = Rec0->text();
-    mainWindow->Rec[1] = Rec1->text();
-    mainWindow->Rec[2] = Rec2->text();
-    mainWindow->Ant[0] = Ant0->text();
-    mainWindow->Ant[1] = Ant1->text();
-    mainWindow->Ant[2] = Ant2->text();
-    mainWindow->AppPos[0] = AppPos0->value();
-    mainWindow->AppPos[1] = AppPos1->value();
-    mainWindow->AppPos[2] = AppPos2->value();
-    mainWindow->AntDel[0] = AntDel0->value();
-    mainWindow->AntDel[1] = AntDel1->value();
-    mainWindow->AntDel[2] = AntDel2->value();
-    mainWindow->Comment[0] = Comment0->text();
-    mainWindow->Comment[1] = Comment1->text();
-    mainWindow->RcvOption = RcvOption->text();
-
-    for (int i = 0; i < 7; i++) mainWindow->CodeMask[i] = CodeMask[i];
-
-    mainWindow->AutoPos = AutoPos->isChecked();
-    mainWindow->ScanObs = ScanObs->isChecked();
-    mainWindow->HalfCyc = HalfCyc->isChecked();
-    mainWindow->OutIono = OutIono->isChecked();
-    mainWindow->OutTime = OutTime->isChecked();
-    mainWindow->OutLeaps = OutLeaps->isChecked();
-
-    int navsys = 0, obstype = 0, freqtype = 0;
-
-    if (Nav1->isChecked()) navsys |= SYS_GPS;
-    if (Nav2->isChecked()) navsys |= SYS_GLO;
-    if (Nav3->isChecked()) navsys |= SYS_GAL;
-    if (Nav4->isChecked()) navsys |= SYS_QZS;
-    if (Nav5->isChecked()) navsys |= SYS_SBS;
-    if (Nav6->isChecked()) navsys |= SYS_CMP;
-    if (Nav7->isChecked()) navsys |= SYS_IRN;
-
-    if (Obs1->isChecked()) obstype |= OBSTYPE_PR;
-    if (Obs2->isChecked()) obstype |= OBSTYPE_CP;
-    if (Obs3->isChecked()) obstype |= OBSTYPE_DOP;
-    if (Obs4->isChecked()) obstype |= OBSTYPE_SNR;
-
-    if (Freq1->isChecked()) freqtype |= FREQTYPE_L1;
-    if (Freq2->isChecked()) freqtype |= FREQTYPE_L2;
-    if (Freq3->isChecked()) freqtype |= FREQTYPE_L5;
-    if (Freq4->isChecked()) freqtype |= FREQTYPE_L6;
-    if (Freq5->isChecked()) freqtype |= FREQTYPE_L7;
-    if (Freq6->isChecked()) freqtype |= FREQTYPE_L8;
-    if (Freq7->isChecked()) freqtype |= FREQTYPE_L9;
-
-    mainWindow->NavSys = navsys;
-    mainWindow->ObsType = obstype;
-    mainWindow->FreqType = freqtype;
-    mainWindow->ExSats = ExSats->text();
-    mainWindow->TraceLevel = TraceLevel->currentIndex();
-    mainWindow->SepNav=ChkSepNav->isChecked();
-    mainWindow->TimeTol=TimeTol->value();
+    mainWindow->RnxVer=RnxVer->currentIndex();
+    mainWindow->RnxFile=RnxFile->isChecked();
+    mainWindow->RnxCode=RnxCode->text();
+    mainWindow->RunBy=RunBy->text();
+    mainWindow->Marker=Marker->text();
+    mainWindow->MarkerNo=MarkerNo->text();
+    mainWindow->MarkerType=MarkerType->text();
+    mainWindow->Name[0]=Name0->text();
+    mainWindow->Name[1]=Name1->text();
+    mainWindow->Rec[0]=Rec0->text();
+    mainWindow->Rec[1]=Rec1->text();
+    mainWindow->Rec[2]=Rec2->text();
+    mainWindow->Ant[0]=Ant0->text();
+    mainWindow->Ant[1]=Ant1->text();
+    mainWindow->Ant[2]=Ant2->text();
+    mainWindow->AppPos[0]=AppPos0->text().toDouble();
+    mainWindow->AppPos[1]=AppPos1->text().toDouble();
+    mainWindow->AppPos[2]=AppPos2->text().toDouble();
+    mainWindow->AntDel[0]=AntDel0->text().toDouble();
+    mainWindow->AntDel[1]=AntDel1->text().toDouble();
+    mainWindow->AntDel[2]=AntDel2->text().toDouble();
+    mainWindow->Comment[0]=Comment0->text();
+    mainWindow->Comment[1]=Comment1->text();
+    mainWindow->RcvOption=RcvOption->text();
+    for (int i=0;i<6;i++) mainWindow->CodeMask[i]=CodeMask[i];
+    mainWindow->AutoPos=AutoPos->isChecked();
+    mainWindow->ScanObs=ScanObs->isChecked();
+    mainWindow->OutIono=OutIono->isChecked();
+    mainWindow->OutTime=OutTime->isChecked();
+    mainWindow->OutLeaps=OutLeaps->isChecked();
+	
+	int navsys=0,obstype=0,freqtype=0;
+    if (Nav1->isChecked()) navsys|=SYS_GPS;
+    if (Nav2->isChecked()) navsys|=SYS_GLO;
+    if (Nav3->isChecked()) navsys|=SYS_GAL;
+    if (Nav4->isChecked()) navsys|=SYS_QZS;
+    if (Nav5->isChecked()) navsys|=SYS_SBS;
+    if (Nav6->isChecked()) navsys|=SYS_CMP;
+    if (Nav7->isChecked()) navsys|=SYS_IRN;
+    if (Obs1->isChecked()) obstype|=OBSTYPE_PR;
+    if (Obs2->isChecked()) obstype|=OBSTYPE_CP;
+    if (Obs3->isChecked()) obstype|=OBSTYPE_DOP;
+    if (Obs4->isChecked()) obstype|=OBSTYPE_SNR;
+    if (Freq1->isChecked()) freqtype|=FREQTYPE_L1;
+    if (Freq2->isChecked()) freqtype|=FREQTYPE_L2;
+    if (Freq3->isChecked()) freqtype|=FREQTYPE_L5;
+    if (Freq4->isChecked()) freqtype|=FREQTYPE_L6;
+    if (Freq5->isChecked()) freqtype|=FREQTYPE_L7;
+    if (Freq6->isChecked()) freqtype|=FREQTYPE_L8;
+    if (Freq7->isChecked()) freqtype|=FREQTYPE_L9;
+    mainWindow->NavSys=navsys;
+    mainWindow->ObsType=obstype;
+    mainWindow->FreqType=freqtype;
+    mainWindow->ExSats=ExSats->text();
+    mainWindow->TraceLevel=TraceLevel->currentIndex();
 
     accept();
 }
@@ -180,25 +166,23 @@
 }
 //---------------------------------------------------------------------------
 void ConvOptDialog::BtnMaskClick()
-{
-    codeOptDialog->NavSys = 0;
-    codeOptDialog->FreqType = 0;
-
-    if (Nav1->isChecked()) codeOptDialog->NavSys |= SYS_GPS;
-    if (Nav2->isChecked()) codeOptDialog->NavSys |= SYS_GLO;
-    if (Nav3->isChecked()) codeOptDialog->NavSys |= SYS_GAL;
-    if (Nav4->isChecked()) codeOptDialog->NavSys |= SYS_QZS;
-    if (Nav5->isChecked()) codeOptDialog->NavSys |= SYS_SBS;
-    if (Nav6->isChecked()) codeOptDialog->NavSys |= SYS_CMP;
-    if (Nav7->isChecked()) codeOptDialog->NavSys |= SYS_IRN;
-
-    if (Freq1->isChecked()) codeOptDialog->FreqType |= FREQTYPE_L1;
-    if (Freq2->isChecked()) codeOptDialog->FreqType |= FREQTYPE_L2;
-    if (Freq3->isChecked()) codeOptDialog->FreqType |= FREQTYPE_L5;
-    if (Freq4->isChecked()) codeOptDialog->FreqType |= FREQTYPE_L6;
-    if (Freq5->isChecked()) codeOptDialog->FreqType |= FREQTYPE_L7;
-    if (Freq6->isChecked()) codeOptDialog->FreqType |= FREQTYPE_L8;
-    if (Freq7->isChecked()) codeOptDialog->FreqType |= FREQTYPE_L9;
+{    
+    codeOptDialog->NavSys=0;
+    codeOptDialog->FreqType=0;
+    if (Nav1->isChecked()) codeOptDialog->NavSys|=SYS_GPS;
+    if (Nav2->isChecked()) codeOptDialog->NavSys|=SYS_GLO;
+    if (Nav3->isChecked()) codeOptDialog->NavSys|=SYS_GAL;
+    if (Nav4->isChecked()) codeOptDialog->NavSys|=SYS_QZS;
+    if (Nav5->isChecked()) codeOptDialog->NavSys|=SYS_SBS;
+    if (Nav6->isChecked()) codeOptDialog->NavSys|=SYS_CMP;
+    if (Nav7->isChecked()) codeOptDialog->NavSys|=SYS_IRN;
+    if (Freq1->isChecked()) codeOptDialog->FreqType|=FREQTYPE_L1;
+    if (Freq2->isChecked()) codeOptDialog->FreqType|=FREQTYPE_L2;
+    if (Freq3->isChecked()) codeOptDialog->FreqType|=FREQTYPE_L5;
+    if (Freq4->isChecked()) codeOptDialog->FreqType|=FREQTYPE_L6;
+    if (Freq5->isChecked()) codeOptDialog->FreqType|=FREQTYPE_L7;
+    if (Freq6->isChecked()) codeOptDialog->FreqType|=FREQTYPE_L8;
+    if (Freq7->isChecked()) codeOptDialog->FreqType|=FREQTYPE_L9;
 
     codeOptDialog->show();
 }
@@ -211,6 +195,6 @@
     AppPos0->setEnabled(AutoPos->isChecked());
     AppPos1->setEnabled(AutoPos->isChecked());
     AppPos2->setEnabled(AutoPos->isChecked());
-    ChkSepNav->setEnabled(RnxVer->currentIndex()>=3);
 }
 //---------------------------------------------------------------------------
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/convopt.h RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/convopt.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/convopt.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/convopt.h	2019-08-19 02:04:50.000000000 +0300
@@ -8,22 +8,18 @@
 
 class QShowEvent;
 class CodeOptDialog;
-
 //---------------------------------------------------------------------------
 class ConvOptDialog : public QDialog, private Ui::ConvOptDialog
 {
     Q_OBJECT
-
 public slots:
     void BtnOkClick();
     void RnxFileClick();
     void BtnMaskClick();
     void RnxVerChange();
     void AutoPosClick();
-
 protected:
     void showEvent(QShowEvent*);
-
 private:
     void UpdateEnable(void);
 
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/convopt.ui RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/convopt.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/convopt.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/convopt.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>833</width>
-    <height>547</height>
+    <width>636</width>
+    <height>559</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -20,6 +20,9 @@
    <item>
     <widget class="QWidget" name="widget_2" native="true">
      <layout class="QHBoxLayout" name="horizontalLayout_5">
+      <property name="spacing">
+       <number>0</number>
+      </property>
       <property name="leftMargin">
        <number>0</number>
       </property>
@@ -88,13 +91,6 @@
        </widget>
       </item>
       <item>
-       <widget class="QCheckBox" name="ChkSepNav">
-        <property name="text">
-         <string>Sep NAV</string>
-        </property>
-       </widget>
-      </item>
-      <item>
        <widget class="QLabel" name="Label12">
         <property name="enabled">
          <bool>true</bool>
@@ -121,32 +117,12 @@
        </widget>
       </item>
       <item>
-       <widget class="QLabel" name="Label13">
-        <property name="text">
-         <string>Time Torelance (s)</string>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QDoubleSpinBox" name="TimeTol">
-        <property name="decimals">
-         <number>4</number>
-        </property>
-        <property name="singleStep">
-         <double>0.001000000000000</double>
-        </property>
-        <property name="value">
-         <double>0.005000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item>
        <widget class="QCheckBox" name="RnxFile">
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string>RINEX2 Name</string>
+         <string>RINEX Name</string>
         </property>
         <property name="checked">
          <bool>false</bool>
@@ -165,88 +141,21 @@
       <string/>
      </property>
      <layout class="QGridLayout" name="gridLayout">
-      <item row="9" column="0" colspan="7">
-       <widget class="QWidget" name="options" native="true">
-        <layout class="QHBoxLayout" name="horizontalLayout_7">
-         <property name="spacing">
-          <number>0</number>
-         </property>
-         <property name="leftMargin">
-          <number>0</number>
-         </property>
-         <property name="topMargin">
-          <number>0</number>
-         </property>
-         <property name="rightMargin">
-          <number>0</number>
-         </property>
-         <property name="bottomMargin">
-          <number>0</number>
-         </property>
-         <item>
-          <widget class="QCheckBox" name="OutTime">
-           <property name="toolTip">
-            <string/>
-           </property>
-           <property name="text">
-            <string>Time Corr</string>
-           </property>
-           <property name="checked">
-            <bool>false</bool>
-           </property>
-          </widget>
-         </item>
-         <item>
-          <widget class="QCheckBox" name="ScanObs">
-           <property name="toolTip">
-            <string/>
-           </property>
-           <property name="text">
-            <string>Scan Obs Types</string>
-           </property>
-           <property name="checked">
-            <bool>false</bool>
-           </property>
-          </widget>
-         </item>
-         <item>
-          <widget class="QCheckBox" name="OutIono">
-           <property name="toolTip">
-            <string/>
-           </property>
-           <property name="text">
-            <string>Iono Corr</string>
-           </property>
-           <property name="checked">
-            <bool>false</bool>
-           </property>
-          </widget>
-         </item>
-         <item>
-          <widget class="QCheckBox" name="OutLeaps">
-           <property name="toolTip">
-            <string/>
-           </property>
-           <property name="text">
-            <string>Leap Sec</string>
-           </property>
-           <property name="checked">
-            <bool>false</bool>
-           </property>
-          </widget>
-         </item>
-         <item>
-          <widget class="QCheckBox" name="HalfCyc">
-           <property name="text">
-            <string>Half Cyc Corr</string>
-           </property>
-          </widget>
-         </item>
-        </layout>
+      <item row="0" column="0">
+       <widget class="QLabel" name="Label2">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>RunBy/Obsv/Agency</string>
+        </property>
        </widget>
       </item>
-      <item row="3" column="5" colspan="2">
-       <widget class="QLineEdit" name="MarkerType">
+      <item row="0" column="2">
+       <widget class="QLineEdit" name="RunBy">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -258,8 +167,8 @@
         </property>
        </widget>
       </item>
-      <item row="0" column="0">
-       <widget class="QLabel" name="Label2">
+      <item row="0" column="3" colspan="2">
+       <widget class="QLineEdit" name="Name0">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -267,25 +176,38 @@
          <string/>
         </property>
         <property name="text">
-         <string>RunBy/Obsv/Agency</string>
+         <string/>
         </property>
        </widget>
       </item>
-      <item row="7" column="1">
-       <widget class="QCheckBox" name="AutoPos">
+      <item row="0" column="5" colspan="2">
+       <widget class="QLineEdit" name="Name1">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
          <string/>
         </property>
-        <property name="checked">
-         <bool>false</bool>
+       </widget>
+      </item>
+      <item row="1" column="0" rowspan="2">
+       <widget class="QLabel" name="Label10">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>Comment</string>
         </property>
        </widget>
       </item>
-      <item row="5" column="5" colspan="2">
-       <widget class="QLineEdit" name="Ant2">
+      <item row="1" column="2" colspan="5">
+       <widget class="QLineEdit" name="Comment0">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -297,8 +219,8 @@
         </property>
        </widget>
       </item>
-      <item row="7" column="0">
-       <widget class="QLabel" name="Label6">
+      <item row="2" column="2" colspan="5">
+       <widget class="QLineEdit" name="Comment1">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -306,7 +228,20 @@
          <string/>
         </property>
         <property name="text">
-         <string>Approx Pos XYZ</string>
+         <string/>
+        </property>
+       </widget>
+      </item>
+      <item row="3" column="0">
+       <widget class="QLabel" name="Label1">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>Maker Name/#/Type</string>
         </property>
        </widget>
       </item>
@@ -323,8 +258,8 @@
         </property>
        </widget>
       </item>
-      <item row="0" column="3" colspan="2">
-       <widget class="QLineEdit" name="Name0">
+      <item row="3" column="3" colspan="2">
+       <widget class="QLineEdit" name="MarkerNo">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -336,8 +271,8 @@
         </property>
        </widget>
       </item>
-      <item row="8" column="0">
-       <widget class="QLabel" name="Label7">
+      <item row="3" column="5" colspan="2">
+       <widget class="QLineEdit" name="MarkerType">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -345,12 +280,12 @@
          <string/>
         </property>
         <property name="text">
-         <string>Ant Delta H/E/N</string>
+         <string/>
         </property>
        </widget>
       </item>
-      <item row="4" column="5" colspan="2">
-       <widget class="QLineEdit" name="Rec2">
+      <item row="4" column="0">
+       <widget class="QLabel" name="Label4">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -358,12 +293,12 @@
          <string/>
         </property>
         <property name="text">
-         <string/>
+         <string>Rec #/Type/Vers</string>
         </property>
        </widget>
       </item>
-      <item row="0" column="5" colspan="2">
-       <widget class="QLineEdit" name="Name1">
+      <item row="4" column="2">
+       <widget class="QLineEdit" name="Rec0">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -375,8 +310,8 @@
         </property>
        </widget>
       </item>
-      <item row="5" column="0">
-       <widget class="QLabel" name="Label5">
+      <item row="4" column="3" colspan="2">
+       <widget class="QLineEdit" name="Rec1">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -384,12 +319,12 @@
          <string/>
         </property>
         <property name="text">
-         <string>Ant #/Type</string>
+         <string/>
         </property>
        </widget>
       </item>
-      <item row="2" column="2" colspan="5">
-       <widget class="QLineEdit" name="Comment1">
+      <item row="4" column="5" colspan="2">
+       <widget class="QLineEdit" name="Rec2">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -414,8 +349,8 @@
         </property>
        </widget>
       </item>
-      <item row="4" column="0">
-       <widget class="QLabel" name="Label4">
+      <item row="5" column="3" colspan="2">
+       <widget class="QLineEdit" name="Ant1">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -423,12 +358,12 @@
          <string/>
         </property>
         <property name="text">
-         <string>Rec #/Type/Vers</string>
+         <string/>
         </property>
        </widget>
       </item>
-      <item row="0" column="2">
-       <widget class="QLineEdit" name="RunBy">
+      <item row="5" column="5" colspan="2">
+       <widget class="QLineEdit" name="Ant2">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -440,8 +375,8 @@
         </property>
        </widget>
       </item>
-      <item row="4" column="3" colspan="2">
-       <widget class="QLineEdit" name="Rec1">
+      <item row="6" column="0">
+       <widget class="QLabel" name="Label6">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -449,12 +384,25 @@
          <string/>
         </property>
         <property name="text">
+         <string>Approx Pos XYZ</string>
+        </property>
+       </widget>
+      </item>
+      <item row="6" column="1">
+       <widget class="QCheckBox" name="AutoPos">
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
          <string/>
         </property>
+        <property name="checked">
+         <bool>false</bool>
+        </property>
        </widget>
       </item>
-      <item row="3" column="0">
-       <widget class="QLabel" name="Label1">
+      <item row="6" column="2">
+       <widget class="QLineEdit" name="AppPos0">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -462,12 +410,12 @@
          <string/>
         </property>
         <property name="text">
-         <string>Maker Name/#/Type</string>
+         <string>0.0000</string>
         </property>
        </widget>
       </item>
-      <item row="5" column="3" colspan="2">
-       <widget class="QLineEdit" name="Ant1">
+      <item row="6" column="3" colspan="2">
+       <widget class="QLineEdit" name="AppPos1">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -475,12 +423,12 @@
          <string/>
         </property>
         <property name="text">
-         <string/>
+         <string>0.0000</string>
         </property>
        </widget>
       </item>
-      <item row="1" column="2" colspan="5">
-       <widget class="QLineEdit" name="Comment0">
+      <item row="6" column="5" colspan="2">
+       <widget class="QLineEdit" name="AppPos2">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -488,12 +436,12 @@
          <string/>
         </property>
         <property name="text">
-         <string/>
+         <string>0.0000</string>
         </property>
        </widget>
       </item>
-      <item row="4" column="2">
-       <widget class="QLineEdit" name="Rec0">
+      <item row="7" column="2">
+       <widget class="QLineEdit" name="AntDel0">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -501,12 +449,12 @@
          <string/>
         </property>
         <property name="text">
-         <string/>
+         <string>0.0000</string>
         </property>
        </widget>
       </item>
-      <item row="1" column="0" rowspan="2">
-       <widget class="QLabel" name="Label10">
+      <item row="7" column="3" colspan="2">
+       <widget class="QLineEdit" name="AntDel1">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -514,12 +462,12 @@
          <string/>
         </property>
         <property name="text">
-         <string>Comment</string>
+         <string>0.0000</string>
         </property>
        </widget>
       </item>
-      <item row="3" column="3" colspan="2">
-       <widget class="QLineEdit" name="MarkerNo">
+      <item row="7" column="5" colspan="2">
+       <widget class="QLineEdit" name="AntDel2">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -527,76 +475,85 @@
          <string/>
         </property>
         <property name="text">
-         <string/>
+         <string>0.0000</string>
         </property>
        </widget>
       </item>
-      <item row="7" column="2">
-       <widget class="QDoubleSpinBox" name="AppPos0">
-        <property name="suffix">
-         <string> m</string>
+      <item row="8" column="0">
+       <widget class="QCheckBox" name="ScanObs">
+        <property name="toolTip">
+         <string/>
         </property>
-        <property name="decimals">
-         <number>4</number>
+        <property name="text">
+         <string>Scan Obs Types</string>
         </property>
-        <property name="maximum">
-         <double>1000000.000000000000000</double>
+        <property name="checked">
+         <bool>false</bool>
         </property>
        </widget>
       </item>
-      <item row="7" column="3" colspan="2">
-       <widget class="QDoubleSpinBox" name="AppPos1">
-        <property name="suffix">
-         <string> m</string>
+      <item row="8" column="2" colspan="2">
+       <widget class="QCheckBox" name="OutIono">
+        <property name="toolTip">
+         <string/>
         </property>
-        <property name="decimals">
-         <number>4</number>
+        <property name="text">
+         <string>Iono Corr</string>
         </property>
-        <property name="maximum">
-         <double>1000000.000000000000000</double>
+        <property name="checked">
+         <bool>false</bool>
         </property>
        </widget>
       </item>
-      <item row="7" column="5" colspan="2">
-       <widget class="QDoubleSpinBox" name="AppPos2">
-        <property name="suffix">
-         <string> m</string>
+      <item row="8" column="4" colspan="2">
+       <widget class="QCheckBox" name="OutTime">
+        <property name="toolTip">
+         <string/>
         </property>
-        <property name="decimals">
-         <number>4</number>
+        <property name="text">
+         <string>Time Corr</string>
         </property>
-        <property name="maximum">
-         <double>1000000.000000000000000</double>
+        <property name="checked">
+         <bool>false</bool>
         </property>
        </widget>
       </item>
-      <item row="8" column="2">
-       <widget class="QDoubleSpinBox" name="AntDel0">
-        <property name="suffix">
-         <string> m</string>
+      <item row="8" column="6">
+       <widget class="QCheckBox" name="OutLeaps">
+        <property name="toolTip">
+         <string/>
         </property>
-        <property name="decimals">
-         <number>4</number>
+        <property name="text">
+         <string>Leap Sec</string>
+        </property>
+        <property name="checked">
+         <bool>false</bool>
         </property>
        </widget>
       </item>
-      <item row="8" column="5" colspan="2">
-       <widget class="QDoubleSpinBox" name="AntDel2">
-        <property name="suffix">
-         <string> m</string>
+      <item row="7" column="0">
+       <widget class="QLabel" name="Label7">
+        <property name="enabled">
+         <bool>true</bool>
         </property>
-        <property name="decimals">
-         <number>4</number>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>Ant Delta H/E/N</string>
         </property>
        </widget>
       </item>
-      <item row="8" column="3" colspan="2">
-       <widget class="QDoubleSpinBox" name="AntDel1">
-        <property name="suffix">
-         <string> m</string>
+      <item row="5" column="0">
+       <widget class="QLabel" name="Label5">
+        <property name="enabled">
+         <bool>true</bool>
         </property>
-        <property name="decimals">
-         <number>4</number>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>Ant #/Type</string>
         </property>
        </widget>
       </item>
@@ -618,6 +575,9 @@
       <property name="bottomMargin">
        <number>0</number>
       </property>
+      <property name="spacing">
+       <number>0</number>
+      </property>
       <item row="2" column="2">
        <widget class="QLineEdit" name="ExSats">
         <property name="enabled">
@@ -747,21 +707,6 @@
    <item>
     <widget class="QWidget" name="widget_4" native="true">
      <layout class="QHBoxLayout" name="horizontalLayout_6">
-      <property name="spacing">
-       <number>0</number>
-      </property>
-      <property name="leftMargin">
-       <number>0</number>
-      </property>
-      <property name="topMargin">
-       <number>0</number>
-      </property>
-      <property name="rightMargin">
-       <number>0</number>
-      </property>
-      <property name="bottomMargin">
-       <number>0</number>
-      </property>
       <item>
        <widget class="QGroupBox" name="GroupBox3">
         <property name="toolTip">
@@ -771,6 +716,21 @@
          <string>Observation Types</string>
         </property>
         <layout class="QHBoxLayout" name="horizontalLayout_2">
+         <property name="spacing">
+          <number>0</number>
+         </property>
+         <property name="leftMargin">
+          <number>0</number>
+         </property>
+         <property name="topMargin">
+          <number>0</number>
+         </property>
+         <property name="rightMargin">
+          <number>0</number>
+         </property>
+         <property name="bottomMargin">
+          <number>0</number>
+         </property>
          <item>
           <widget class="QCheckBox" name="Obs1">
            <property name="toolTip">
@@ -835,6 +795,21 @@
          <string>Frequencies</string>
         </property>
         <layout class="QHBoxLayout" name="horizontalLayout_3">
+         <property name="spacing">
+          <number>0</number>
+         </property>
+         <property name="leftMargin">
+          <number>0</number>
+         </property>
+         <property name="topMargin">
+          <number>0</number>
+         </property>
+         <property name="rightMargin">
+          <number>0</number>
+         </property>
+         <property name="bottomMargin">
+          <number>0</number>
+         </property>
          <item>
           <widget class="QCheckBox" name="Freq1">
            <property name="toolTip">
@@ -942,18 +917,6 @@
    <item>
     <widget class="QWidget" name="widget" native="true">
      <layout class="QHBoxLayout" name="horizontalLayout_4">
-      <property name="leftMargin">
-       <number>0</number>
-      </property>
-      <property name="topMargin">
-       <number>0</number>
-      </property>
-      <property name="rightMargin">
-       <number>0</number>
-      </property>
-      <property name="bottomMargin">
-       <number>0</number>
-      </property>
       <item>
        <widget class="QLabel" name="Label8">
         <property name="enabled">
@@ -963,7 +926,7 @@
          <string/>
         </property>
         <property name="text">
-         <string>Receiver Options</string>
+         <string>Option</string>
         </property>
        </widget>
       </item>
@@ -1075,61 +1038,6 @@
   <zorder>widget_3</zorder>
   <zorder>widget_4</zorder>
  </widget>
- <tabstops>
-  <tabstop>RnxVer</tabstop>
-  <tabstop>RnxCode</tabstop>
-  <tabstop>RnxFile</tabstop>
-  <tabstop>RunBy</tabstop>
-  <tabstop>Name0</tabstop>
-  <tabstop>Name1</tabstop>
-  <tabstop>Comment0</tabstop>
-  <tabstop>Comment1</tabstop>
-  <tabstop>Marker</tabstop>
-  <tabstop>MarkerNo</tabstop>
-  <tabstop>MarkerType</tabstop>
-  <tabstop>Rec0</tabstop>
-  <tabstop>Rec1</tabstop>
-  <tabstop>Rec2</tabstop>
-  <tabstop>Ant0</tabstop>
-  <tabstop>Ant1</tabstop>
-  <tabstop>Ant2</tabstop>
-  <tabstop>AutoPos</tabstop>
-  <tabstop>AppPos0</tabstop>
-  <tabstop>AppPos1</tabstop>
-  <tabstop>AppPos2</tabstop>
-  <tabstop>AntDel0</tabstop>
-  <tabstop>AntDel1</tabstop>
-  <tabstop>AntDel2</tabstop>
-  <tabstop>OutTime</tabstop>
-  <tabstop>ScanObs</tabstop>
-  <tabstop>OutIono</tabstop>
-  <tabstop>OutLeaps</tabstop>
-  <tabstop>HalfCyc</tabstop>
-  <tabstop>Nav1</tabstop>
-  <tabstop>Nav2</tabstop>
-  <tabstop>Nav3</tabstop>
-  <tabstop>Nav4</tabstop>
-  <tabstop>Nav5</tabstop>
-  <tabstop>Nav6</tabstop>
-  <tabstop>Nav7</tabstop>
-  <tabstop>ExSats</tabstop>
-  <tabstop>Obs1</tabstop>
-  <tabstop>Obs2</tabstop>
-  <tabstop>Obs3</tabstop>
-  <tabstop>Obs4</tabstop>
-  <tabstop>Freq1</tabstop>
-  <tabstop>Freq2</tabstop>
-  <tabstop>Freq3</tabstop>
-  <tabstop>Freq4</tabstop>
-  <tabstop>Freq5</tabstop>
-  <tabstop>Freq6</tabstop>
-  <tabstop>Freq7</tabstop>
-  <tabstop>BtnMask</tabstop>
-  <tabstop>RcvOption</tabstop>
-  <tabstop>TraceLevel</tabstop>
-  <tabstop>BtnOk</tabstop>
-  <tabstop>BtnCancel</tabstop>
- </tabstops>
  <resources/>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/rtkconv.cpp RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/rtkconv.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/rtkconv.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/rtkconv.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -5,7 +5,6 @@
 {
     QApplication a(argc, argv);
     MainWindow w(NULL);
-
     w.show();
 
     return a.exec();
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/rtkconv_qt.pro RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/rtkconv_qt.pro
--- RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/rtkconv_qt.pro	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/rtkconv_qt.pro	2019-08-19 02:04:50.000000000 +0300
@@ -6,13 +6,31 @@
 
 QT       += widgets core gui
 
-include(../app.pri)
+greaterThan(QT_MAJOR_VERSION, 4) {
+    QT += widgets 
+}
+
+include(../../RTKLib.pri)
 
 TARGET = rtkconv_qt
 TEMPLATE = app
 
 INCLUDEPATH += ../../src/ ../appcmn_qt 
 
+linux{
+    RTKLIB =../../src/libRTKLib.a
+    LIBS += -lpng $${RTKLIB}
+}
+win32 {
+    CONFIG(debug) {
+        RTKLIB = ../../src/debug/libRTKLib.a
+    } else {
+        RTKLIB =../../src/release/libRTKLib.a
+    }
+
+    LIBS+= $${RTKLIB} -lWs2_32 -lwinmm
+}
+PRE_TARGETDEPS = $${RTKLIB}
 SOURCES += \ 
     codeopt.cpp \
     convmain.cpp \
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/rtkconv_qt.qrc RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/rtkconv_qt.qrc
--- RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/rtkconv_qt.qrc	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/rtkconv_qt.qrc	2019-08-19 02:04:50.000000000 +0300
@@ -89,9 +89,5 @@
         <file alias="wait6.bmp">../icon/wait6.bmp</file>
         <file alias="wait7.bmp">../icon/wait7.bmp</file>
         <file alias="wait8.bmp">../icon/wait8.bmp</file>
-	<file alias="start.bmp">../icon/start.bmp</file>
-        <file alias="up2.bmp">../icon/up2.bmp</file>
-        <file alias="stop2.bmp">../icon/stop2.bmp</file>
-        <file alias="anim1_red.bmp">../icon/anim1_red.bmp</file>
     </qresource>
 </RCC>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/startdlg.cpp RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/startdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/startdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/startdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -11,29 +11,30 @@
 {
     setupUi(this);
 
-    Time.time = 0;
-    Time.sec = 0.0;
+	Time.time=0;
+	Time.sec=0.0;
 
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
 }
 //---------------------------------------------------------------------------
 void StartDialog::showEvent(QShowEvent *event)
 {
     if (event->spontaneous()) return;
 
-    if (Time.time == 0)
-        Time = utc2gpst(timeget());
+	if (Time.time==0) {
+		Time=utc2gpst(timeget());
+	}
 
-    QDateTime date = QDateTime::fromTime_t(Time.time); date = date.addMSecs(Time.sec*1000);
-    Time1->setDateTime(date);
+    QDateTime date=QDateTime::fromTime_t(Time.time); date=date.addSecs(Time.sec);
+    TimeY1->setDate(date.date());
+    TimeH1->setTime(date.time());
 }
 //---------------------------------------------------------------------------
 void StartDialog::BtnOkClick()
 {
-    QDateTime date(Time1->dateTime());
-
-    Time.time = date.toTime_t(); Time.sec = date.time().msec() / 1000;
+    QDateTime date(TimeY1->date(),TimeH1->time());
+    Time.time=date.toTime_t();Time.sec=date.time().msec()/1000;
 
     accept();
 }
@@ -41,8 +42,9 @@
 void StartDialog::BtnFileTimeClick()
 {
     QFileInfo fi(FileName);
-    QDateTime d = fi.created();
+    QDateTime d=fi.created();
 
-    Time1->setDateTime(d);
+    TimeH1->setTime(d.time());
+    TimeY1->setDate(d.date());
 }
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/startdlg.h RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/startdlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/startdlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/startdlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -7,24 +7,19 @@
 
 #include "rtklib.h"
 class QShowEvent;
-
 //---------------------------------------------------------------------------
 class StartDialog : public QDialog, private Ui::StartDialog
 {
     Q_OBJECT
-
 protected:
     void showEvent(QShowEvent*);
-
 public slots:
     void BtnOkClick();
     void BtnFileTimeClick();
-
 public:
 	gtime_t Time;
     QString FileName;
-
-    explicit StartDialog(QWidget *parent=NULL);
+    explicit StartDialog(QWidget *parent=0);
 };
 //---------------------------------------------------------------------------
 #endif
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/startdlg.ui RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/startdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkconv_qt/startdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkconv_qt/startdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -32,10 +32,7 @@
       <string/>
      </property>
      <layout class="QGridLayout" name="gridLayout">
-      <item row="1" column="0">
-       <widget class="QDateTimeEdit" name="Time1"/>
-      </item>
-      <item row="0" column="0" colspan="2">
+      <item row="0" column="0" colspan="3">
        <widget class="QLabel" name="Label1">
         <property name="enabled">
          <bool>true</bool>
@@ -48,7 +45,33 @@
         </property>
        </widget>
       </item>
+      <item row="1" column="0">
+       <widget class="QDateEdit" name="TimeY1">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="displayFormat">
+         <string>dd.MM.yyyy</string>
+        </property>
+       </widget>
+      </item>
       <item row="1" column="1">
+       <widget class="QTimeEdit" name="TimeH1">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="displayFormat">
+         <string>HH:mm:ss</string>
+        </property>
+       </widget>
+      </item>
+      <item row="1" column="2">
        <widget class="QPushButton" name="BtnFileTime">
         <property name="text">
          <string>File Time</string>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/getmain.cpp RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/getmain.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/getmain.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/getmain.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -12,8 +12,6 @@
 // version : $Revision:$ $Date:$
 // history : 2012/12/28  1.0 new
 //---------------------------------------------------------------------------
-#include <clocale>
-
 #include <QShowEvent>
 #include <QDesktopServices>
 #include <QCloseEvent>
@@ -47,152 +45,144 @@
 
 #define URL_FILE    "..\\data\\URL_LIST.txt"
 #define TEST_FILE   "rtkget_test.txt"
-#define TRACE_FILE  "rtkget_qt.trace"
+#define TRACE_FILE  "rtkget.trace"
 
 #define MAX_URL     2048
 #define MAX_URL_SEL 64
 #define MAX_STA     2048
 #define MAX_HIST    16
 
-#define MAX(x, y)    ((x) > (y) ? (x) : (y))
+#define MAX(x,y)    ((x)>(y)?(x):(y))
 
-static int abortf = 0;          // abort flag
+static int abortf=0;          // abort flag
 
 MainForm *mainForm;
 
 // show message in message area ---------------------------------------------
 extern "C" {
-    extern int showmsg(const char *format, ...)
-    {
-        va_list arg;
-        QString str;
-        static QString buff2;
-        char buff[1024], *p;
-
-        va_start(arg, format);
-        vsprintf(buff, format, arg);
-        va_end(arg);
-
-        if ((p = strstr(buff, "STAT="))) {
-            buff2.append(str.right(66));
-            if (buff2.endsWith('_')) buff2.remove(buff2.length() - 1, 1);
-            buff2.append(p + 5);
-            QMetaObject::invokeMethod(mainForm->MsgLabel3, "setText", Qt::QueuedConnection, Q_ARG(QString, QString(buff2)));
-        } else if ((p = strstr(buff, "->"))) {
-            *p = '\0';
-            QMetaObject::invokeMethod(mainForm->MsgLabel1, "setText", Qt::QueuedConnection, Q_ARG(QString, QString(buff)));
-            QMetaObject::invokeMethod(mainForm->MsgLabel2, "setText", Qt::QueuedConnection, Q_ARG(QString, QString(p + 2)));
-        }
-        return abortf;
-    }
-    void settspan(gtime_t, gtime_t)
-    {
+extern int showmsg(char *format,...)
+{
+    va_list arg;
+    QString str;
+    static QString buff2;
+    char buff[1024],*p;
+    
+    va_start(arg,format);
+    vsprintf(buff,format,arg);
+    va_end(arg);
+    
+    if ((p=strstr(buff,"STAT="))) {
+        buff2.append(str.right(66));
+        if (buff2.endsWith('_')) buff2.remove(buff2.length()-1,1);
+        buff2.append(p+5);
+        QMetaObject::invokeMethod(mainForm->MsgLabel3,"setText",Qt::QueuedConnection,Q_ARG(QString,QString(buff2)));
     }
-    void settime(gtime_t)
-    {
+    else if ((p=strstr(buff,"->"))) {
+        *p='\0';
+        QMetaObject::invokeMethod(mainForm->MsgLabel1,"setText",Qt::QueuedConnection,Q_ARG(QString,QString(buff)));
+        QMetaObject::invokeMethod(mainForm->MsgLabel2,"setText",Qt::QueuedConnection,Q_ARG(QString,QString(p+2)));
     }
+    return abortf;
+}
+void settspan(gtime_t, gtime_t) {}
+void settime(gtime_t) {}
 }
 
-class DownloadThread : public QThread
+class DownloadThread:public QThread
 {
-    public:
-        QString usr, pwd, proxy;
-        FILE *fp;
-        url_t urls[MAX_URL_SEL];
-        gtime_t ts, te;
-        double ti;
-        char *stas[MAX_STA], dir[1024], msg[1024], path[1024];
-        int nsta, nurl, seqnos, seqnoe, opts;
-        QString LogFile;
-        bool test, append;
+public:
+    QString usr,pwd,proxy;
+    FILE *fp=NULL;
+    url_t urls[MAX_URL_SEL];
+    gtime_t ts,te;
+    double ti;
+    char *stas[MAX_STA],dir[1024],msg[1024],path[1024];
+    int nsta,nurl,seqnos,seqnoe,opts;
+    QString LogFile;
+    bool test,append;
 
-        explicit DownloadThread(QObject *parent, const QString lf, bool a, bool t) : QThread(parent)
-        {
-            seqnos = 0; seqnoe = 0; opts = 0;
-            ts.time = 0;
-            te.time = 0;
-            fp = NULL;
-            test = t;
-            LogFile = lf;
-            append = a;
+    explicit DownloadThread(QObject *parent, const QString lf, bool a, bool t):QThread(parent){
+        seqnos=0;seqnoe=0;opts=0;
+        ts=te={0,0};
+        test=t;
+        LogFile=lf;
+        append=a;
 
-            for (int i = 0; i < MAX_STA; i++) {
-                stas[i] = new char [16]; stas[i][0] = '\0';
-            }
-            ;
-            for (int i = 0; i < MAX_URL_SEL; i++) memset(&urls[i], 0, sizeof(url_t));
-            dir[0] = msg[0] = path[0] = '\0';
-            nurl = nsta = 0; ti = 0;
-        }
-        ~DownloadThread()
-        {
-            for (int i = 0; i < MAX_STA; i++) delete [] stas[i];
-        }
+        for (int i=0;i<MAX_STA;i++) {stas[i]=new char [16];stas[i][0]='\0';};
+        for (int i=0;i<MAX_URL_SEL;i++) memset(&urls[i],0,sizeof(url_t));
+        dir[0]=msg[0]=path[0]='\0';
+        nurl=nsta=0;ti=0;
 
-    protected:
-        void run()
-        {
-            if (LogFile != "") {
-                reppath(qPrintable(LogFile), path, utc2gpst(timeget()), "", "");
-                fp = fopen(path, append ? "a" : "w");
-            }
-            if (test)
-                dl_test(ts, te, ti, urls, nurl, stas, nsta, dir, 35, 0, fp);
-            else
-                dl_exec(ts, te, ti, seqnos, seqnoe, urls, nurl, stas, nsta, dir, qPrintable(usr),
-                    qPrintable(pwd), qPrintable(proxy), opts, msg, fp);
-            if (fp)
-                fclose(fp);
+    }
+    ~DownloadThread(){
+        for (int i=0;i<MAX_STA;i++) delete [] stas[i];
+    }
+
+protected:
+    void run(){
+        if (LogFile!="") {
+            reppath(qPrintable(LogFile),path,utc2gpst(timeget()),"","");
+            fp=fopen(path,append?"a":"w");
         }
+        if (test)
+            dl_test(ts,te,ti,urls,nurl,stas,nsta,dir,35,0,fp);
+        else
+            dl_exec(ts,te,ti,seqnos,seqnoe,urls,nurl,stas,nsta,dir,qPrintable(usr),
+                qPrintable(pwd),qPrintable(proxy),opts,msg,fp);
+        if (fp)
+            fclose(fp);
+    }
 };
 
+
+
 //---------------------------------------------------------------------------
-MainForm::MainForm(QWidget *parent)
+MainForm::MainForm(QWidget * parent)
     : QWidget(parent)
 {
-    mainForm = this;
+    mainForm=this;
     setupUi(this);
 
-    setlocale(LC_NUMERIC, "C");
+    setlocale(LC_NUMERIC,"C");
 
-    viewer = new TextViewer(this);
+    viewer=new TextViewer(this);
     timeDialog = new TimeDialog(this);
 
-    QCompleter *dirCompleter = new QCompleter(this);
-    QFileSystemModel *dirModel = new QFileSystemModel(dirCompleter);
+    QCompleter *dirCompleter=new QCompleter(this);
+    QFileSystemModel *dirModel=new QFileSystemModel(dirCompleter);
     dirModel->setRootPath("");
-    dirModel->setFilter(QDir::AllDirs | QDir::Drives | QDir::NoDotAndDotDot);
+    dirModel->setFilter(QDir::AllDirs|QDir::Drives|QDir::NoDotAndDotDot);
     dirCompleter->setModel(dirModel);
     Dir->setCompleter(dirCompleter);
 
-    connect(BtnAll, SIGNAL(clicked(bool)), this, SLOT(BtnAllClick()));
-    connect(BtnDir, SIGNAL(clicked(bool)), this, SLOT(BtnDirClick()));
-    connect(BtnDownload, SIGNAL(clicked(bool)), this, SLOT(BtnDownloadClick()));
-    connect(BtnExit, SIGNAL(clicked(bool)), this, SLOT(BtnExitClick()));
-    connect(BtnFile, SIGNAL(clicked(bool)), this, SLOT(BtnFileClick()));
-    connect(BtnHelp, SIGNAL(clicked(bool)), this, SLOT(BtnHelpClick()));
-    connect(BtnKeyword, SIGNAL(clicked(bool)), this, SLOT(BtnKeywordClick()));
-    connect(BtnLog, SIGNAL(clicked(bool)), this, SLOT(BtnLogClick()));
-    connect(BtnOpts, SIGNAL(clicked(bool)), this, SLOT(BtnOptsClick()));
-    connect(BtnStas, SIGNAL(clicked(bool)), this, SLOT(BtnStasClick()));
-    connect(BtnTest, SIGNAL(clicked(bool)), this, SLOT(BtnTestClick()));
-    connect(BtnTray, SIGNAL(clicked(bool)), this, SLOT(BtnTrayClick()));
-    connect(DataType, SIGNAL(currentIndexChanged(int)), this, SLOT(DataTypeChange()));
-    connect(SubType, SIGNAL(currentIndexChanged(int)), this, SLOT(DataTypeChange()));
-    connect(Dir, SIGNAL(currentIndexChanged(int)), this, SLOT(DirChange()));
-    connect(LocalDir, SIGNAL(clicked(bool)), this, SLOT(LocalDirClick()));
-    connect(HidePasswd, SIGNAL(clicked(bool)), this, SLOT(HidePasswdClick()));
-    connect(DataList, SIGNAL(clicked(QModelIndex)), this, SLOT(DataListClick()));
-    connect(StaList, SIGNAL(clicked(QModelIndex)), this, SLOT(StaListClick()));
-    connect(&TrayIcon, SIGNAL(activated(QSystemTrayIcon::ActivationReason)), this, SLOT(TrayIconActivated(QSystemTrayIcon::ActivationReason)));
-    connect(&Timer, SIGNAL(timeout()), this, SLOT(TimerTimer()));
-    connect(BtnTime1, SIGNAL(clicked(bool)), this, SLOT(BtnTime1Click()));
-    connect(BtnTime2, SIGNAL(clicked(bool)), this, SLOT(BtnTime2Click()));
+    connect(BtnAll,SIGNAL(clicked(bool)),this,SLOT(BtnAllClick()));
+    connect(BtnDir,SIGNAL(clicked(bool)),this,SLOT(BtnDirClick()));
+    connect(BtnDownload,SIGNAL(clicked(bool)),this,SLOT(BtnDownloadClick()));
+    connect(BtnExit,SIGNAL(clicked(bool)),this,SLOT(BtnExitClick()));
+    connect(BtnFile,SIGNAL(clicked(bool)),this,SLOT(BtnFileClick()));
+    connect(BtnHelp,SIGNAL(clicked(bool)),this,SLOT(BtnHelpClick()));
+    connect(BtnKeyword,SIGNAL(clicked(bool)),this,SLOT(BtnKeywordClick()));
+    connect(BtnLog,SIGNAL(clicked(bool)),this,SLOT(BtnLogClick()));
+    connect(BtnOpts,SIGNAL(clicked(bool)),this,SLOT(BtnOptsClick()));
+    connect(BtnStas,SIGNAL(clicked(bool)),this,SLOT(BtnStasClick()));
+    connect(BtnTest,SIGNAL(clicked(bool)),this,SLOT(BtnTestClick()));
+    connect(BtnTray,SIGNAL(clicked(bool)),this,SLOT(BtnTrayClick()));
+    connect(DataType,SIGNAL(currentIndexChanged(int)),this,SLOT(DataTypeChange()));
+    connect(SubType,SIGNAL(currentIndexChanged(int)),this,SLOT(DataTypeChange()));
+    connect(Dir,SIGNAL(currentIndexChanged(int)),this,SLOT(DirChange()));
+    connect(LocalDir,SIGNAL(clicked(bool)),this,SLOT(LocalDirClick()));
+    connect(HidePasswd,SIGNAL(clicked(bool)),this,SLOT(HidePasswdClick()));
+    connect(DataList,SIGNAL(clicked(QModelIndex)),this,SLOT(DataListClick()));
+    connect(StaList,SIGNAL(clicked(QModelIndex)),this,SLOT(StaListClick()));
+    connect(&TrayIcon,SIGNAL(activated(QSystemTrayIcon::ActivationReason)),this,SLOT(TrayIconActivated(QSystemTrayIcon::ActivationReason)));
+    connect(&Timer,SIGNAL(timeout()),this,SLOT(TimerTimer()));
+    connect(BtnTime1,SIGNAL(clicked(bool)),this,SLOT(BtnTime1Click()));
+    connect(BtnTime2,SIGNAL(clicked(bool)),this,SLOT(BtnTime2Click()));
 
-    for (int i = 0; i < 8; i++)
-        Images[i].load(QString(":/buttons/wait%1.bmp").arg(i + 1));
+    for (int i=0;i<8;i++)
+        Images[i].load(QString(":/buttons/wait%1.bmp").arg(i+1));
 
-    TimerCnt = 0;
+    TimerCnt=0;
 
     TrayIcon.setIcon(QPixmap(":/icons/rtk8.bmp"));
     setWindowIcon(QIcon(":/icons/rtk8.bmp"));
@@ -203,49 +193,51 @@
 //---------------------------------------------------------------------------
 void MainForm::FormCreate()
 {
-    QString file = QApplication::applicationFilePath();
+    QString file=QApplication::applicationFilePath();
     QFileInfo fi(file);
-
-    IniFile = fi.absolutePath() + "/" + fi.baseName() + ".ini";
-
+    IniFile=fi.absolutePath()+"/"+fi.baseName()+".ini";
+    
     setWindowTitle(QString("%1 v.%2 %3").arg(PRGNAME).arg(VER_RTKLIB).arg(PATCH_LEVEL));
-
+    
     QCommandLineParser parser;
-    parser.setApplicationDescription("RTK Get Qt");
+    parser.setApplicationDescription("RTK Get");
     parser.addHelpOption();
     parser.addVersionOption();
 
     QCommandLineOption iniFileOption(QStringList() << "i" << "ini-file",
-                     QCoreApplication::translate("main", "ini file to use"),
-                     QCoreApplication::translate("main", "ini file"));
+            QCoreApplication::translate("main", "ini file to use"),
+            QCoreApplication::translate("main", "ini file"));
     parser.addOption(iniFileOption);
 
     QCommandLineOption titleOption(QStringList() << "t" << "title",
-                       QCoreApplication::translate("main", "window title"),
-                       QCoreApplication::translate("main", "title"));
+            QCoreApplication::translate("main", "window title"),
+            QCoreApplication::translate("main", "title"));
     parser.addOption(titleOption);
 
     parser.process(*QApplication::instance());
 
     if (parser.isSet(iniFileOption))
-        IniFile = parser.value(iniFileOption);
+        IniFile=parser.value(iniFileOption);
 
     if (parser.isSet(titleOption))
         setWindowTitle(parser.value(titleOption));
 
+
     LoadOpt();
     LoadUrl(UrlFile);
     UpdateType();
     UpdateEnable();
-
-    if (TraceLevel > 0) {
+    
+    if (TraceLevel>0) {
         traceopen(TRACE_FILE);
         tracelevel(TraceLevel);
     }
 }
 //---------------------------------------------------------------------------
-void MainForm::closeEvent(QCloseEvent *)
+void MainForm::closeEvent(QCloseEvent *event)
 {
+    if (event->spontaneous()) return;
+
     traceclose();
     SaveOpt();
 }
@@ -253,20 +245,20 @@
 void MainForm::BtnFileClick()
 {
     QString str;
-    gtime_t ts, te;
+    gtime_t ts,te;
     double ti;
-    char path[1024] = ".";
+    char path[1024]=".";
 
-    str = LocalDir->isChecked() ? Dir->currentText() : MsgLabel2->text();
-    GetTime(&ts, &te, &ti);
-    if (str != "") reppath(qPrintable(str), path, ts, "", "");
+    str=LocalDir->isChecked()?Dir->currentText():MsgLabel2->text();
+    GetTime(&ts,&te,&ti);
+    if (str!="") reppath(qPrintable(str),path,ts,"","");
 
     QDesktopServices::openUrl(QUrl::fromLocalFile(path));
 }
 //---------------------------------------------------------------------------
 void MainForm::BtnLogClick()
 {
-    if (LogFile == "") return;
+    if (LogFile=="") return;
 
     viewer->setWindowTitle(LogFile);
     viewer->Read(LogFile);
@@ -275,50 +267,50 @@
 //---------------------------------------------------------------------------
 void MainForm::BtnTestClick()
 {
-    if (BtnTest->text().remove('&') == tr("Abort")) {
+    if (BtnTest->text().remove('&')==tr("Abort")) {
         BtnTest->setEnabled(false);
-        abortf = 1;
+        abortf=1;
         return;
     }
 
-    thread = new DownloadThread(this, TEST_FILE, false, true);
-    GetTime(&thread->ts, &thread->te, &thread->ti);
-    thread->nurl = SelectUrl(thread->urls);
-    if (timediff(thread->ts, thread->te) > 0.0 || thread->nurl <= 0) {
+    thread=new DownloadThread(this,TEST_FILE,false,true);
+    GetTime(&thread->ts,&thread->te,&thread->ti);
+    thread->nurl=SelectUrl(thread->urls);
+    if (timediff(thread->ts,thread->te)>0.0||thread->nurl<=0) {
         MsgLabel3->setText(tr("no local data"));
         return;
     }
-
-    thread->nsta = SelectSta(thread->stas);
-
-    if (LocalDir->isChecked())
-        strcpy(thread->dir, qPrintable(Dir->currentText()));
-
+        
+    thread->nsta=SelectSta(thread->stas);
+    
+    if (LocalDir->isChecked()) {
+        strcpy(thread->dir,qPrintable(Dir->currentText()));
+    }
     PanelEnable(0);
-
     BtnTest->setEnabled(true);
     BtnTest->setText(tr("Abort"));
     MsgLabel1->setStyleSheet("QLabel { color: gray;}");
     MsgLabel3->setText("");
-    abortf = 0;
+    abortf=0;
 
-    connect(thread, SIGNAL(finished()), this, SLOT(DownloadFinished()));
+    connect(thread,SIGNAL(finished()),this,SLOT(DownloadFinished()));
 
     thread->start();
+    
 }
 //---------------------------------------------------------------------------
 void MainForm::BtnOptsClick()
 {
-    QString urlfile = UrlFile;
-
+    QString urlfile=UrlFile;
+    
     DownOptDialog downOptDialog(this);
 
     downOptDialog.exec();
 
-    if (downOptDialog.result() != QDialog::Accepted) return;
-
-    if (UrlFile == urlfile) return;
-
+    if (downOptDialog.result()!=QDialog::Accepted) return;
+    
+    if (UrlFile==urlfile) return;
+    
     LoadUrl(UrlFile);
     UpdateType();
 }
@@ -328,81 +320,84 @@
     QString str;
     int i;
 
-    if (BtnDownload->text().remove('&') == tr("Abort")) {
+    if (BtnDownload->text().remove('&')==tr("Abort")) {
         BtnDownload->setEnabled(false);
-        abortf = 1;
-        return;
-    }
-
-    thread = new DownloadThread(this, LogFile, LogAppend, false);
-    GetTime(&thread->ts, &thread->te, &thread->ti);
-
-    str = Number->text();
-    QStringList tokens = str.split('-');
-    if (tokens.size() == 2) {
-        thread->seqnos = tokens.at(0).toInt();
-        thread->seqnoe = tokens.at(1).toInt();
-    } else if (tokens.size() == 1) {
-        thread->seqnos = thread->seqnoe = tokens.at(0).toInt();
-    } else {
+        abortf=1;
         return;
     }
 
-    thread->nurl = SelectUrl(thread->urls);
-    if (timediff(thread->ts, thread->te) > 0.0 || thread->nurl <= 0) {
+    thread=new DownloadThread(this, LogFile,LogAppend, false);
+    GetTime(&thread->ts,&thread->te,&thread->ti);
+    
+    str=Number->text();
+    QStringList tokens=str.split('-');
+    if (tokens.size()==2)
+    {
+        thread->seqnos=tokens.at(0).toInt();
+        thread->seqnoe=tokens.at(1).toInt();
+    } else  if (tokens.size()==1)
+    {
+        thread->seqnos=thread->seqnoe=tokens.at(0).toInt();
+    } else return;
+    
+    thread->nurl=SelectUrl(thread->urls);
+    if (timediff(thread->ts,thread->te)>0.0||thread->nurl<=0) {
         MsgLabel3->setText(tr("no download data"));
         return;
     }
-    for (i = 0; i < MAX_STA; i++) thread->stas[i] = new char [16];
-
-    thread->nsta = SelectSta(thread->stas);
-    thread->usr = FtpLogin->text();
-    thread->pwd = FtpPasswd->text();
-    thread->proxy = ProxyAddr;
-
-    if (!SkipExist->isChecked()) thread->opts |= DLOPT_FORCE;
-    if (!UnZip->isChecked()) thread->opts |= DLOPT_KEEPCMP;
-    if (HoldErr) thread->opts |= DLOPT_HOLDERR;
-    if (HoldList) thread->opts |= DLOPT_HOLDLST;
-
-    if (LocalDir->isChecked())
-        strcpy(thread->dir, qPrintable(Dir->currentText()));
-    abortf = 0;
+    for (i=0;i<MAX_STA;i++) thread->stas[i]=new char [16];
+    
+    thread->nsta=SelectSta(thread->stas);
+    thread->usr=FtpLogin->text();
+    thread->pwd=FtpPasswd->text();
+    thread->proxy=ProxyAddr;
+    
+    if (!SkipExist->isChecked()) thread->opts|=DLOPT_FORCE;
+    if (!UnZip    ->isChecked()) thread->opts|=DLOPT_KEEPCMP;
+    if (HoldErr )                thread->opts|=DLOPT_HOLDERR;
+    if (HoldList)                thread->opts|=DLOPT_HOLDLST;
+    
+    if (LocalDir->isChecked()) {
+        strcpy(thread->dir,qPrintable(Dir->currentText()));
+    }
+    abortf=0;
     PanelEnable(0);
     BtnDownload->setEnabled(true);
     BtnDownload->setText(tr("Abort"));
     MsgLabel3->setText("");
 
-    connect(thread, SIGNAL(finished()), this, SLOT(DownloadFinished()));
+    connect(thread,SIGNAL(finished()),this,SLOT(DownloadFinished()));
 
     Timer.start(200);
 
     thread->start();
 }
 //---------------------------------------------------------------------------
-void MainForm::DownloadFinished()
-{
+void MainForm::DownloadFinished(){
+
     PanelEnable(1);
     UpdateEnable();
     Timer.stop();
 
     if (Dir->isEnabled()) AddHist(Dir);
 
-    if (thread->test) {
+    if (thread->test)
+    {
         BtnTest->setText(tr("&Test..."));
         MsgLabel1->setStyleSheet("QLabel { color: bloack;}");
         MsgLabel3->setText("");
 
         TextViewer *viewer;
 
-        viewer = new TextViewer(this);
-        viewer->Option = 2;
+        viewer=new TextViewer(this);
+        viewer->Option=2;
         viewer->Read(TEST_FILE);
         viewer->setWindowTitle(tr("Local File Test"));
         viewer->exec();
 
         remove(TEST_FILE);
-    } else {
+    } else
+    {
         BtnDownload->setText(tr("&Download"));
         MsgLabel3->setText(thread->msg);
     }
@@ -410,8 +405,8 @@
     UpdateMsg();
     UpdateEnable();
 
-    for (int i = 0; i < MAX_STA; i++) delete[] thread->stas[i];
     delete thread;
+
 }
 //---------------------------------------------------------------------------
 void MainForm::BtnExitClick()
@@ -422,20 +417,18 @@
 void MainForm::BtnStasClick()
 {
     StaListDialog staListDialog(this);
-
     staListDialog.exec();
 
-    if (staListDialog.result() != QDialog::Accepted) return;
+    if (staListDialog.result()!=QDialog::Accepted) return;
     UpdateStaList();
     BtnAll->setText("A");
 }
 //---------------------------------------------------------------------------
 void MainForm::BtnDirClick()
 {
-    QString dir = Dir->currentText();
-
-    dir = QDir::toNativeSeparators(QFileDialog::getExistingDirectory(this, tr("Output Directory"), dir));
-    Dir->insertItem(0, dir);
+    QString dir=Dir->currentText();
+    dir=QDir::toNativeSeparators(QFileDialog::getExistingDirectory(this,tr("Output Directory"),dir));
+    Dir->insertItem(0,dir);
     Dir->setCurrentIndex(0);
 }
 //---------------------------------------------------------------------------
@@ -443,55 +436,52 @@
 {
     UpdateMsg();
 }
-//---------------------------------------------------------------------------
 void MainForm::BtnTime1Click()
 {
-    QDateTime time(dateTime1->dateTime());
+    QDateTime time(TimeY1->date(),TimeH1->time());
     gtime_t t1;
-
-    t1.time = static_cast<time_t>(time.toTime_t()); t1.sec = time.time().msec() / 1000;
-    timeDialog->Time = t1;
+    t1.time=static_cast<time_t>(time.toTime_t());t1.sec=time.time().msec()/1000;
+    timeDialog->Time=t1;
     timeDialog->exec();
 }
 //---------------------------------------------------------------------------
 void MainForm::BtnTime2Click()
 {
-    QDateTime time(dateTime2->dateTime());
+    QDateTime time(TimeY2->date(),TimeH2->time());
     gtime_t t2;
-
-    t2.time = static_cast<time_t>(time.toTime_t()); t2.sec = time.time().msec() / 1000;
-    timeDialog->Time = t2;
+    t2.time=static_cast<time_t>(time.toTime_t());t2.sec=time.time().msec()/1000;
+    timeDialog->Time=t2;
     timeDialog->exec();
 }
 //---------------------------------------------------------------------------
 void MainForm::BtnAllClick()
 {
-    int i, n = 0;
-
-    for (i = StaList->count() - 1; i >= 0; i--) {
-        StaList->item(i)->setSelected(BtnAll->text() == "A");
+    int i,n=0;
+    
+    StaList->setVisible(false);
+    for (i=StaList->count()-1;i>=0;i--) {
+        StaList->item(i)->setSelected(BtnAll->text()=="A");
         if (StaList->item(i)->isSelected()) n++;
     }
-
-    BtnAll->setText(BtnAll->text() == "A" ? "C" : "A");
+    StaList->setVisible(true);
+    BtnAll->setText(BtnAll->text()=="A"?"C":"A");
     LabelSta->setText(QString(tr("Stations (%1)")).arg(n));
 }
 //---------------------------------------------------------------------------
 void MainForm::BtnKeywordClick()
 {
     KeyDialog keyDialog(this);
-
-    keyDialog.Flag = 3;
+    keyDialog.Flag=3;
     keyDialog.exec();
 }
 //---------------------------------------------------------------------------
 void MainForm::BtnHelpClick()
 {
     AboutDialog aboutDialog(this);
-    QString prog = PRGNAME;
-
-    aboutDialog.About = prog;
-    aboutDialog.IconIndex = 8;
+    QString prog=PRGNAME;
+    
+    aboutDialog.About=prog;
+    aboutDialog.IconIndex=8;
     aboutDialog.exec();
 }
 //---------------------------------------------------------------------------
@@ -501,10 +491,11 @@
         event->acceptProposedAction();
 }
 //---------------------------------------------------------------------------
-void MainForm::dropEvent(QDropEvent *event)
+void MainForm::dropEvent(QDropEvent * event)
 {
-    if (StaList == childAt(event->pos()))
+    if (StaList==childAt(event->pos())) {
         LoadSta(event->mimeData()->text());
+    }
     event->acceptProposedAction();
 }
 //---------------------------------------------------------------------------
@@ -516,7 +507,7 @@
 //---------------------------------------------------------------------------
 void MainForm::TrayIconActivated(QSystemTrayIcon::ActivationReason reason)
 {
-    if (reason != QSystemTrayIcon::DoubleClick) return;
+    if (reason!=QSystemTrayIcon::DoubleClick) return;
 
     setVisible(true);
     TrayIcon.setVisible(false);
@@ -551,145 +542,144 @@
 //---------------------------------------------------------------------------
 void MainForm::TimerTimer()
 {
-    lbImage->setPixmap(Images[TimerCnt % 8]);
+    lbImage->setPixmap(Images[TimerCnt%8]);
     qApp->processEvents();
     TimerCnt++;
 }
 //---------------------------------------------------------------------------
 void MainForm::LoadOpt(void)
 {
-    QSettings setting(IniFile, QSettings::IniFormat);
+    QSettings setting(IniFile,QSettings::IniFormat);
     QStringList stas;
-
-    dateTime1->setDate(setting.value("opt/startd", "2011/01/01").toDate());
-    dateTime1->setTime(setting.value("opt/starth", "00:00").toTime());
-    dateTime2->setDate(setting.value("opt/endd", "2011/01/01").toDate());
-    dateTime2->setTime(setting.value("opt/endh", "00:00").toTime());
-    TimeInt->insertItem(0, setting.value("opt/timeint", "24 H").toString()); TimeInt->setCurrentIndex(0);
-    Number->setValue(setting.value("opt/number", 0).toInt());
-    UrlFile = setting.value("opt/urlfile", "").toString();
-    LogFile = setting.value("opt/logfile", "").toString();
-    Stations = setting.value("opt/stations", "").toString();
-    ProxyAddr = setting.value("opt/proxyaddr", "").toString();
-    FtpLogin->setText(setting.value("opt/login", "anonymous").toString());
-    FtpPasswd->setText(setting.value("opt/passwd", "user@").toString());
-    UnZip->setChecked(setting.value("opt/unzip", 1).toBool());
-    SkipExist->setChecked(setting.value("opt/skipexist", 1).toBool());
-    HidePasswd->setChecked(setting.value("opt/hidepasswd", 0).toBool());
-    HoldErr = setting.value("opt/holderr", 0).toInt();
-    HoldList = setting.value("opt/holdlist", 0).toInt();
-    NCol = setting.value("opt/ncol", 35).toInt();
-    LogAppend = setting.value("opt/logappend", 0).toInt();
-    DateFormat = setting.value("opt/dateformat", 0).toInt();
-    TraceLevel = setting.value("opt/tracelevel", 0).toInt();
-    LocalDir->setChecked(setting.value("opt/localdirena", 0).toBool());
+    
+    TimeY1->setDate       (setting.value ("opt/startd","2011/01/01").toDate());
+    TimeH1->setTime       (setting.value ("opt/starth",     "00:00").toTime());
+    TimeY2->setDate       (setting.value ("opt/endd",  "2011/01/01").toDate());
+    TimeH2->setTime       (setting.value ("opt/endh",       "00:00").toTime());
+    TimeInt->insertItem (0,setting.value ("opt/timeint",      "24 H").toString());TimeInt->setCurrentIndex(0);
+    Number->setText       (setting.value ("opt/number",         "0").toString());
+    UrlFile               =setting.value ("opt/urlfile",         "").toString();
+    LogFile               =setting.value ("opt/logfile",         "").toString();
+    Stations              =setting.value ("opt/stations",        "").toString();
+    ProxyAddr             =setting.value ("opt/proxyaddr",       "").toString();
+    FtpLogin  ->setText   (setting.value ("opt/login",  "anonymous").toString());
+    FtpPasswd ->setText   (setting.value ("opt/passwd",     "user@").toString());
+    UnZip     ->setChecked(setting.value ("opt/unzip",            1).toBool());
+    SkipExist ->setChecked(setting.value ("opt/skipexist",        1).toBool());
+    HidePasswd->setChecked(setting.value ("opt/hidepasswd",       0).toBool());
+    HoldErr               =setting.value ("opt/holderr",          0).toInt();
+    HoldList              =setting.value ("opt/holdlist",         0).toInt();
+    NCol                  =setting.value ("opt/ncol",            35).toInt();
+    LogAppend             =setting.value ("opt/logappend",        0).toInt();
+    DateFormat            =setting.value ("opt/dateformat",       0).toInt();
+    TraceLevel            =setting.value ("opt/tracelevel",       0).toInt();
+    LocalDir  ->setChecked(setting.value ("opt/localdirena",      0).toBool());
 
     StaList->clear();
 
-    for (int i = 0; i < 10; i++) {
-        stas = setting.value(QString("sta/station%1").arg(i), "").toString().split(",");
-        foreach(const QString &s, stas) {
+    for (int i=0;i<10;i++) {
+        stas=setting.value(QString("sta/station%1").arg(i),"").toString().split(",");
+        foreach (const QString &s,stas) {
             StaList->addItem(s);
         }
     }
-    ReadHist(setting, "dir", Dir);
+    ReadHist(setting,"dir",Dir);
 
-    Dir->insertItem(0, setting.value("opt/localdir", "").toString()); Dir->setCurrentIndex(0);
-    DataType->insertItem(0, setting.value("opt/datatype", "").toString()); DataType->setCurrentIndex(0);
+    Dir       ->insertItem   (0,setting.value ("opt/localdir",        "").toString());Dir->setCurrentIndex(0);
+    DataType  ->insertItem   (0,setting.value ("opt/datatype",        "").toString());DataType->setCurrentIndex(0);
 
-    TextViewer::Color1 = setting.value("viewer/color1", QColor(Qt::black)).value<QColor>();
-    TextViewer::Color2 = setting.value("viewer/color2", QColor(Qt::white)).value<QColor>();
-    TextViewer::FontD.setFamily(setting.value("viewer/fontname", "Courier New").toString());
-    TextViewer::FontD.setPixelSize(setting.value("viewer/fontsize", 9).toInt());
+    TextViewer::Color1=setting.value("viewer/color1",QColor(Qt::black)).value<QColor>();
+    TextViewer::Color2=setting.value("viewer/color2",QColor(Qt::white)).value<QColor>();
+    TextViewer::FontD.setFamily(setting.value ("viewer/fontname","Courier New").toString());
+    TextViewer::FontD.setPixelSize(setting.value("viewer/fontsize",9).toInt());
 }
 //---------------------------------------------------------------------------
 void MainForm::SaveOpt(void)
 {
-    QSettings setting(IniFile, QSettings::IniFormat);
+    QSettings setting(IniFile,QSettings::IniFormat);
     QString sta;
 
-    setting.setValue("opt/startd", dateTime1->date());
-    setting.setValue("opt/starth", dateTime1->time());
-    setting.setValue("opt/endd", dateTime2->date());
-    setting.setValue("opt/endh", dateTime2->time());
-    setting.setValue("opt/timeint", TimeInt->currentText());
-    setting.setValue("opt/number", Number->value());
-    setting.setValue("opt/urlfile", UrlFile);
-    setting.setValue("opt/logfile", LogFile);
-    setting.setValue("opt/stations", Stations);
-    setting.setValue("opt/proxyaddr", ProxyAddr);
-    setting.setValue("opt/login", FtpLogin->text());
-    setting.setValue("opt/passwd", FtpPasswd->text());
-    setting.setValue("opt/unzip", UnZip->isChecked());
-    setting.setValue("opt/skipexist", SkipExist->isChecked());
-    setting.setValue("opt/hidepasswd", HidePasswd->isChecked());
-    setting.setValue("opt/holderr", HoldErr);
-    setting.setValue("opt/holdlist", HoldList);
-    setting.setValue("opt/ncol", NCol);
-    setting.setValue("opt/logappend", LogAppend);
-    setting.setValue("opt/dateformat", DateFormat);
-    setting.setValue("opt/tracelevel", TraceLevel);
-    setting.setValue("opt/localdirena", LocalDir->isChecked());
-    setting.setValue("opt/localdir", Dir->currentText());
-    setting.setValue("opt/datatype", DataType->currentText());
+    setting.setValue ("opt/startd",     TimeY1->date()       );
+    setting.setValue ("opt/starth",     TimeH1->time()       );
+    setting.setValue ("opt/endd",       TimeY2->date()       );
+    setting.setValue ("opt/endh",       TimeH2->time()       );
+    setting.setValue ("opt/timeint",    TimeInt->currentText());
+    setting.setValue ("opt/number",     Number->text()       );
+    setting.setValue ("opt/urlfile",    UrlFile            );
+    setting.setValue ("opt/logfile",    LogFile            );
+    setting.setValue ("opt/stations",   Stations           );
+    setting.setValue ("opt/proxyaddr",  ProxyAddr          );
+    setting.setValue ("opt/login",      FtpLogin  ->text() );
+    setting.setValue ("opt/passwd",     FtpPasswd ->text() );
+    setting.setValue ("opt/unzip",      UnZip     ->isChecked());
+    setting.setValue ("opt/skipexist",  SkipExist ->isChecked());
+    setting.setValue ("opt/hidepasswd", HidePasswd->isChecked());
+    setting.setValue ("opt/holderr",    HoldErr            );
+    setting.setValue ("opt/holdlist",   HoldList           );
+    setting.setValue ("opt/ncol",       NCol               );
+    setting.setValue ("opt/logappend",  LogAppend          );
+    setting.setValue ("opt/dateformat", DateFormat         );
+    setting.setValue ("opt/tracelevel", TraceLevel         );
+    setting.setValue ("opt/localdirena",LocalDir ->isChecked());
+    setting.setValue ("opt/localdir",   Dir       ->currentText());
+    setting.setValue ("opt/datatype",   DataType  ->currentText());
 
-    for (int i = 0, j = 0; i < 10; i++) {
-        for (int k = 0; k < 256 && j < StaList->count(); k++)
-            sta.append(k == 0 ? QString("") : QString(",") + StaList->item(i)->text());
-        setting.setValue(QString("sta/station%1").arg(i), sta);
+    for (int i=0,j=0;i<10;i++) {
+        for (int k=0;k<256&&j<StaList->count();k++) {
+            sta.append(k==0?QString(""):QString(",")+StaList->item(i)->text());
+        }
+        setting.setValue (QString("sta/station%1").arg(i),sta);
     }
-    WriteHist(setting, "dir", Dir);
-    setting.setValue("viewer/color1", TextViewer::Color1);
-    setting.setValue("viewer/color2", TextViewer::Color2);
-    setting.setValue("viewer/fontname", TextViewer::FontD.family());
-    setting.setValue("viewer/fontsize", TextViewer::FontD.pixelSize());
+    WriteHist(setting,"dir",Dir);
+    setting.setValue("viewer/color1",  TextViewer::Color1);
+    setting.setValue("viewer/color2",  TextViewer::Color2);
+    setting.setValue ("viewer/fontname",TextViewer::FontD.family());
+    setting.setValue("viewer/fontsize",TextViewer::FontD.pixelSize());
 }
 //---------------------------------------------------------------------------
 void MainForm::LoadUrl(QString file)
 {
     url_t *urls;
     QString subtype, basetype;
-    const char *sel[1];
-    int i, n;
-
-    sel[0]=(char*)"*";
-
-    urls = new url_t [MAX_URL];
-
+    char *sel[]={"*"};
+    int i,n;
+    
+    urls=new url_t [MAX_URL];
+    
     Types.clear();
     Urls.clear();
     Locals.clear();
     DataType->clear();
-    SubType->clear();
+    SubType ->clear();
     DataList->clear();
     DataType->addItem(tr("ALL"));
-    SubType->addItem("");
-
-    if (file == "") file = URL_FILE; // default url
-
-    n = dl_readurls(qPrintable(file), (char **)sel, 1, urls, MAX_URL);
-
-    for (i = 0; i < n; i++) {
+    SubType ->addItem("");
+    
+    if (file=="") file=URL_FILE; // default url
+    
+    n=dl_readurls(qPrintable(file),sel,1,urls,MAX_URL);
+    
+    for (i=0;i<n;i++) {
         int p;
         Types.append(urls[i].type);
         Urls.append(urls[i].path);
-        Locals.append(urls[i].dir);
+        Locals.append(urls[i].dir );
 
-        p = Types.last().indexOf('_');
-        if (p == -1) continue;
-        basetype = Types.last().mid(0, p);
-        if (DataType->findText(basetype) == -1)
+        p=Types.last().indexOf('_');
+        if (p==-1) continue;
+        basetype=Types.last().mid(0,p);
+        if (DataType->findText(basetype)==-1)
             DataType->addItem(basetype);
 
-        subtype = Types.last().mid(p + 1);
-        if ((p = subtype.indexOf('_')) != -1) subtype = subtype.mid(0, p);
+        subtype=Types.last().mid(p+1);
+        if ((p=subtype.indexOf('_'))!=-1) subtype=subtype.mid(0,p);
 
-        if (SubType->findText(subtype) == -1)
+        if (SubType->findText(subtype)==-1)
             SubType->addItem(subtype);
     }
     DataType->setCurrentIndex(0);
-    SubType->setCurrentIndex(0);
-
+    SubType ->setCurrentIndex(0);
+    
     delete [] urls;
 }
 //---------------------------------------------------------------------------
@@ -699,12 +689,13 @@
     QByteArray buff;
 
     if (!f.open(QIODevice::ReadOnly)) return;
-
+    
     StaList->clear();
-
-    while (!f.atEnd()) {
-        buff = f.readLine();
-        buff = buff.mid(buff.indexOf('#'));
+    
+    while (!f.atEnd())
+    {
+        buff=f.readLine();
+        buff=buff.mid(buff.indexOf('#'));
         StaList->addItem(buff);
     }
 
@@ -715,65 +706,63 @@
 void MainForm::GetTime(gtime_t *ts, gtime_t *te, double *ti)
 {
     QString str;
-    double eps[6] = { 2010, 1, 1 }, epe[6] = { 2010, 1, 1 }, val;
-
-    eps[0] = dateTime1->date().year(); eps[1] = dateTime1->date().month(); eps[2] = dateTime1->date().day();
-    eps[3] = dateTime1->time().hour(); eps[4] = dateTime1->time().minute();
-    epe[0] = dateTime2->date().year(); epe[1] = dateTime2->date().month(); epe[2] = dateTime2->date().day();
-    epe[3] = dateTime2->time().hour(); epe[4] = dateTime2->time().minute();
-
-    *ts = epoch2time(eps);
-    *te = epoch2time(epe);
-    *ti = 86400.0;
-
-    str = TimeInt->currentText();
-    QStringList tokens = str.split(" ");
+    double eps[6]={2010,1,1},epe[6]={2010,1,1},val;
+    
+    eps[0]=TimeY1->date().year();eps[1]=TimeY1->date().month();eps[2]=TimeY1->date().day();
+    eps[3]=TimeH1->time().hour();eps[4]=TimeH1->time().minute();
+    epe[0]=TimeY2->date().year();epe[1]=TimeY2->date().month();epe[2]=TimeY2->date().day();
+    epe[3]=TimeH2->time().hour();epe[4]=TimeH2->time().minute();
 
-    val = tokens.at(0).toDouble();
-    if (tokens.size() != 2) {
-        *ti = val * 3600.0;
-    } else {
-        if (tokens.at(1) == tr("day")) *ti = val * 86400.0;
-        else if (tokens.at(1) == tr("min")) *ti = val * 60.0;
-        else *ti = val * 3600.0;
+    *ts=epoch2time(eps);
+    *te=epoch2time(epe);
+    *ti=86400.0;
+    
+    str=TimeInt->currentText();
+    QStringList tokens=str.split(" ");
+    val=tokens.at(0).toDouble();
+    if (tokens.size()!=2) *ti=val*3600.0;
+    else {
+        if (tokens.at(1)==tr("day")) *ti=val*86400.0;
+        else if (tokens.at(1)==tr("min")) *ti=val*60.0;
+        else *ti=val*3600.0;
     }
 }
 //---------------------------------------------------------------------------
 int MainForm::SelectUrl(url_t *urls)
 {
-    QString str, file = UrlFile;
+    QString str,file=UrlFile;
     char *types[MAX_URL_SEL];
-    int i, nurl = 0;
-
-    for (i = 0; i < MAX_URL_SEL; i++) types[i] = new char [64];
-
-    for (i = 0; i < DataList->count() && nurl < MAX_URL_SEL; i++) {
+    int i,nurl=0;
+    
+    for (i=0;i<MAX_URL_SEL;i++) types[i]=new char [64];
+    
+    for (i=0;i<DataList->count()&&nurl<MAX_URL_SEL;i++) {
         if (!DataList->item(i)->isSelected()) continue;
-        str = DataList->item(i)->text();
-        strcpy(types[nurl++], qPrintable(str));
+        str=DataList->item(i)->text();
+        strcpy(types[nurl++],qPrintable(str));
     }
-    if (UrlFile == "") file = URL_FILE;
-
-    nurl = dl_readurls(qPrintable(file), types, nurl, urls, MAX_URL_SEL);
-
-    for (i = 0; i < MAX_URL_SEL; i++) delete [] types[i];
-
+    if (UrlFile=="") file=URL_FILE;
+    
+    nurl=dl_readurls(qPrintable(file),types,nurl,urls,MAX_URL_SEL);
+    
+    for (i=0;i<MAX_URL_SEL;i++) delete [] types[i];
+    
     return nurl;
 }
 //---------------------------------------------------------------------------
 int MainForm::SelectSta(char **stas)
 {
     QString str;
-    int i, nsta = 0, len;
-
-    for (i = 0; i < StaList->count() && nsta < MAX_STA; i++) {
+    int i,nsta=0,len;
+    
+    for (i=0;i<StaList->count()&&nsta<MAX_STA;i++) {
         if (!StaList->item(i)->isSelected()) continue;
-        str = StaList->item(i)->text();
-        len = str.length();
-        if (str.indexOf(' ') != -1) len = str.indexOf(' ');
-        if (len > 15) len = 15;
-        strncpy(stas[nsta], qPrintable(str), static_cast<unsigned int>(len));
-        stas[nsta++][len] = '\0';
+        str=StaList->item(i)->text();
+        len=str.length();
+        if (str.indexOf(' ')!=-1) len=str.indexOf(' ');
+        if (len>15) len=15;
+        strncpy(stas[nsta],qPrintable(str),static_cast<unsigned int>(len));
+        stas[nsta++][len]='\0';
     }
     return nsta;
 }
@@ -781,25 +770,24 @@
 void MainForm::UpdateType(void)
 {
     QString str;
-    QString type, subtype;
+    QString type,subtype;
     int i;
-
+    
     DataList->clear();
+    
+    for (i=0;i<Types.size();i++) {
+        str=Types.at(i);
+        QStringList tokens=str.split('_');
 
-    for (i = 0; i < Types.size(); i++) {
-        str = Types.at(i);
-        QStringList tokens = str.split('_');
-
-        type = subtype = "";
-        if (tokens.size() > 1) {
-            type = tokens.at(0);
-            subtype = tokens.at(1);
-        } else {
-            type = tokens.at(0);
-        }
+        type=subtype="";
+        if (tokens.size()>1)
+        {
+            type=tokens.at(0);
+            subtype=tokens.at(1);
+        } else type=tokens.at(0);
 
-        if (DataType->currentText() != tr("ALL") && DataType->currentText() != type) continue;
-        if (SubType->currentText() != "" && SubType->currentText() != subtype) continue;
+        if (DataType->currentText()!=tr("ALL")&&DataType->currentText()!=type) continue;
+        if (SubType ->currentText()!=""&&SubType->currentText()!=subtype) continue;
         DataList->addItem(Types.at(i));
     }
     MsgLabel1->setText("");
@@ -808,38 +796,39 @@
 //---------------------------------------------------------------------------
 void MainForm::UpdateMsg(void)
 {
-    int i, j, n = 0;
-
-    for (i = 0; i < DataList->count(); i++) {
+    int i,j,n=0;
+    
+    for (i=0;i<DataList->count();i++) {
         if (!DataList->item(i)->isSelected()) continue;
-        for (j = 0; j < Types.count(); j++) {
-            if (DataList->item(i)->text() != Types.at(j)) continue;
+        for (j=0;j<Types.count();j++) {
+            if (DataList->item(i)->text()!=Types.at(j)) continue;
             MsgLabel1->setText(Urls.at(j));
-            MsgLabel2->setText(LocalDir->isChecked() ? Dir->currentText() : Locals.at(j));
+            MsgLabel2->setText(LocalDir->isChecked()?Dir->currentText():Locals.at(j));
             Msg1->setToolTip(MsgLabel1->text());
             Msg2->setToolTip(MsgLabel2->text());
             n++;
             break;
         }
     }
-    if (n >= 2) {
-        MsgLabel1->setText(MsgLabel1->text() + " ...");
-        MsgLabel2->setText(MsgLabel2->text() + " ...");
+    if (n>=2) {
+        MsgLabel1->setText(MsgLabel1->text()+" ...");
+        MsgLabel2->setText(MsgLabel2->text()+" ...");
     }
 }
 //---------------------------------------------------------------------------
 void MainForm::UpdateStaList(void)
 {
-    int i, n = 0;
-
-    for (i = 0; i < StaList->count(); i++)
+    int i,n=0;
+    
+    for (i=0;i<StaList->count();i++) {
         if (StaList->item(i)->isSelected()) n++;
+    }
     LabelSta->setText(QString(tr("Stations (%1)")).arg(n));
 }
 //---------------------------------------------------------------------------
 void MainForm::UpdateEnable(void)
 {
-    Dir->setEnabled(LocalDir->isChecked());
+    Dir   ->setEnabled(LocalDir->isChecked());
     BtnDir->setEnabled(LocalDir->isChecked());
     if (HidePasswd->isChecked())
         FtpPasswd->setEchoMode(QLineEdit::Password);
@@ -849,63 +838,65 @@
 //---------------------------------------------------------------------------
 void MainForm::PanelEnable(int ena)
 {
-    Panel1->setEnabled(ena);
-    Panel2->setEnabled(ena);
-    BtnFile->setEnabled(ena);
-    BtnLog->setEnabled(ena);
-    BtnOpts->setEnabled(ena);
-    BtnTest->setEnabled(ena);
+    Panel1     ->setEnabled(ena);
+    Panel2     ->setEnabled(ena);
+    BtnFile    ->setEnabled(ena);
+    BtnLog     ->setEnabled(ena);
+    BtnOpts    ->setEnabled(ena);
+    BtnTest    ->setEnabled(ena);
     BtnDownload->setEnabled(ena);
-    BtnExit->setEnabled(ena);
-    BtnAll->setEnabled(ena);
-    BtnStas->setEnabled(ena);
-    DataType->setEnabled(ena);
-    SubType->setEnabled(ena);
-    DataList->setEnabled(ena);
-    dateTime1->setEnabled(ena);
-    dateTime2->setEnabled(ena);
-    TimeInt->setEnabled(ena);
-    Number->setEnabled(ena);
-    StaList->setEnabled(ena);
-    FtpLogin->setEnabled(ena);
-    FtpPasswd->setEnabled(ena);
-    SkipExist->setEnabled(ena);
-    UnZip->setEnabled(ena);
-    LocalDir->setEnabled(ena);
-    Dir->setEnabled(ena);
-    BtnDir->setEnabled(ena);
+    BtnExit    ->setEnabled(ena);
+    BtnAll     ->setEnabled(ena);
+    BtnStas    ->setEnabled(ena);
+    DataType   ->setEnabled(ena);
+    SubType    ->setEnabled(ena);
+    DataList   ->setEnabled(ena);
+    TimeY1     ->setEnabled(ena);
+    TimeH1     ->setEnabled(ena);
+    TimeY2     ->setEnabled(ena);
+    TimeH2     ->setEnabled(ena);
+    TimeInt    ->setEnabled(ena);
+    Number     ->setEnabled(ena);
+    StaList    ->setEnabled(ena);
+    FtpLogin   ->setEnabled(ena);
+    FtpPasswd  ->setEnabled(ena);
+    SkipExist  ->setEnabled(ena);
+    UnZip      ->setEnabled(ena);
+    LocalDir   ->setEnabled(ena);
+    Dir        ->setEnabled(ena);
+    BtnDir     ->setEnabled(ena);
 }
 // --------------------------------------------------------------------------
 void MainForm::ReadHist(QSettings &setting, QString key, QComboBox *combo)
 {
     QString item;
     int i;
-
+    
     combo->clear();
-
-    for (i = 0; i < MAX_HIST; i++) {
-        item = setting.value(QString("history/%1_%2").arg(key).arg(i, 3), "").toString();
-        if (item != "") combo->addItem(item);
+    
+    for (i=0;i<MAX_HIST;i++) {
+        item=setting.value(QString("history/%1_%2").arg(key).arg(i,3),"").toString();
+        if (item!="") combo->addItem(item);
     }
 }
 // --------------------------------------------------------------------------
-void MainForm::WriteHist(QSettings &setting, QString key, QComboBox *combo)
+void MainForm::WriteHist(QSettings &setting, QString key, QComboBox * combo)
 {
     int i;
-
-    for (i = 0; i < combo->count(); i++)
-        setting.setValue(QString("history/%1_%2").arg(key).arg(i), combo->itemText(i));
+    
+    for (i=0;i<combo->count();i++) {
+        setting.setValue(QString("history/%1_%2").arg(key).arg(i),combo->itemText(i));
+    }
 }
 // --------------------------------------------------------------------------
 void MainForm::AddHist(QComboBox *combo)
 {
-    QString hist = combo->currentText();
-
-    if (hist == "") return;
-    int i = combo->currentIndex();
+    QString hist=combo->currentText();
+    if (hist=="") return;
+    int i=combo->currentIndex();
     combo->removeItem(i);
-    combo->insertItem(0, hist);
-    for (int i = combo->count() - 1; i >= MAX_HIST; i--) combo->removeItem(i);
+    combo->insertItem(0,hist);
+    for (int i=combo->count()-1;i>=MAX_HIST;i--) combo->removeItem(i);
     combo->setCurrentIndex(0);
 }
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/getmain.h RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/getmain.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/getmain.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/getmain.h	2019-08-19 02:04:50.000000000 +0300
@@ -14,7 +14,6 @@
 class TextViewer;
 class DownloadThread;
 class TimeDialog;
-
 //---------------------------------------------------------------------------
 class MainForm : public QWidget, public Ui::MainForm
 {
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/getmain.ui RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/getmain.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/getmain.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/getmain.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>755</width>
-    <height>495</height>
+    <width>707</width>
+    <height>390</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -44,6 +44,9 @@
       <property name="bottomMargin">
        <number>0</number>
       </property>
+      <property name="spacing">
+       <number>0</number>
+      </property>
       <item row="3" column="3">
        <widget class="QCheckBox" name="SkipExist">
         <property name="toolTip">
@@ -129,6 +132,37 @@
          <property name="bottomMargin">
           <number>0</number>
          </property>
+         <property name="spacing">
+          <number>0</number>
+         </property>
+         <item row="2" column="6">
+          <widget class="QPushButton" name="BtnTime2">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="sizePolicy">
+            <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
+             <horstretch>0</horstretch>
+             <verstretch>0</verstretch>
+            </sizepolicy>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>?</string>
+           </property>
+           <property name="flat">
+            <bool>true</bool>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="4">
+          <widget class="QTimeEdit" name="TimeH1"/>
+         </item>
+         <item row="2" column="4">
+          <widget class="QTimeEdit" name="TimeH2"/>
+         </item>
          <item row="1" column="0">
           <widget class="QLabel" name="Label1">
            <property name="enabled">
@@ -142,8 +176,15 @@
            </property>
           </widget>
          </item>
-         <item row="2" column="0">
-          <widget class="QLabel" name="Label3">
+         <item row="1" column="1" colspan="2">
+          <widget class="QDateEdit" name="TimeY1">
+           <property name="displayFormat">
+            <string>dd.MM.yyyy</string>
+           </property>
+          </widget>
+         </item>
+         <item row="3" column="0">
+          <widget class="QLabel" name="Label7">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -151,7 +192,7 @@
             <string/>
            </property>
            <property name="text">
-            <string>End</string>
+            <string>Intv</string>
            </property>
           </widget>
          </item>
@@ -205,8 +246,8 @@
            </item>
           </widget>
          </item>
-         <item row="2" column="5">
-          <widget class="QPushButton" name="BtnTime2">
+         <item row="1" column="6">
+          <widget class="QPushButton" name="BtnTime1">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -227,8 +268,8 @@
            </property>
           </widget>
          </item>
-         <item row="3" column="2" colspan="2">
-          <widget class="QLabel" name="Label2">
+         <item row="3" column="4" colspan="2">
+          <widget class="QLineEdit" name="Number">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -236,12 +277,12 @@
             <string/>
            </property>
            <property name="text">
-            <string>No.</string>
+            <string>0</string>
            </property>
           </widget>
          </item>
-         <item row="3" column="0">
-          <widget class="QLabel" name="Label7">
+         <item row="3" column="2" colspan="2">
+          <widget class="QLabel" name="Label2">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -249,55 +290,30 @@
             <string/>
            </property>
            <property name="text">
-            <string>Intv</string>
+            <string>No.</string>
            </property>
           </widget>
          </item>
-         <item row="1" column="5">
-          <widget class="QPushButton" name="BtnTime1">
+         <item row="2" column="0">
+          <widget class="QLabel" name="Label3">
            <property name="enabled">
             <bool>true</bool>
            </property>
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
            <property name="toolTip">
             <string/>
            </property>
            <property name="text">
-            <string>?</string>
-           </property>
-           <property name="flat">
-            <bool>true</bool>
-           </property>
-          </widget>
-         </item>
-         <item row="1" column="1" colspan="4">
-          <widget class="QDateTimeEdit" name="dateTime1">
-           <property name="calendarPopup">
-            <bool>true</bool>
-           </property>
-           <property name="timeSpec">
-            <enum>Qt::UTC</enum>
+            <string>End</string>
            </property>
           </widget>
          </item>
-         <item row="2" column="1" colspan="4">
-          <widget class="QDateTimeEdit" name="dateTime2">
-           <property name="calendarPopup">
-            <bool>true</bool>
-           </property>
-           <property name="timeSpec">
-            <enum>Qt::UTC</enum>
+         <item row="2" column="1" colspan="2">
+          <widget class="QDateEdit" name="TimeY2">
+           <property name="displayFormat">
+            <string>dd.MM.yyyy</string>
            </property>
           </widget>
          </item>
-         <item row="3" column="4" colspan="2">
-          <widget class="QSpinBox" name="Number"/>
-         </item>
         </layout>
        </widget>
       </item>
@@ -451,6 +467,9 @@
          <property name="bottomMargin">
           <number>0</number>
          </property>
+         <property name="spacing">
+          <number>0</number>
+         </property>
          <item row="1" column="1">
           <widget class="QLineEdit" name="FtpPasswd">
            <property name="enabled">
@@ -553,6 +572,9 @@
       <string/>
      </property>
      <layout class="QHBoxLayout" name="horizontalLayout_2">
+      <property name="spacing">
+       <number>0</number>
+      </property>
       <property name="leftMargin">
        <number>0</number>
       </property>
@@ -608,6 +630,9 @@
       <string/>
      </property>
      <layout class="QHBoxLayout" name="horizontalLayout_3">
+      <property name="spacing">
+       <number>0</number>
+      </property>
       <property name="leftMargin">
        <number>0</number>
       </property>
@@ -673,6 +698,9 @@
       <string/>
      </property>
      <layout class="QHBoxLayout" name="horizontalLayout_4">
+      <property name="spacing">
+       <number>0</number>
+      </property>
       <property name="leftMargin">
        <number>0</number>
       </property>
@@ -744,7 +772,7 @@
          <string/>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="rtkget_qt.qrc">
           <normaloff>:/buttons/ttray.bmp</normaloff>:/buttons/ttray.bmp</iconset>
         </property>
         <property name="flat">
@@ -776,6 +804,9 @@
       <string/>
      </property>
      <layout class="QHBoxLayout" name="horizontalLayout">
+      <property name="spacing">
+       <number>0</number>
+      </property>
       <property name="leftMargin">
        <number>0</number>
       </property>
@@ -889,39 +920,8 @@
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>BtnDownload</tabstop>
-  <tabstop>BtnExit</tabstop>
-  <tabstop>DataType</tabstop>
-  <tabstop>SubType</tabstop>
-  <tabstop>DataList</tabstop>
-  <tabstop>BtnAll</tabstop>
-  <tabstop>BtnStas</tabstop>
-  <tabstop>StaList</tabstop>
-  <tabstop>dateTime1</tabstop>
-  <tabstop>BtnTime1</tabstop>
-  <tabstop>dateTime2</tabstop>
-  <tabstop>BtnTime2</tabstop>
-  <tabstop>TimeInt</tabstop>
-  <tabstop>Number</tabstop>
-  <tabstop>FtpLogin</tabstop>
-  <tabstop>HidePasswd</tabstop>
-  <tabstop>FtpPasswd</tabstop>
-  <tabstop>SkipExist</tabstop>
-  <tabstop>UnZip</tabstop>
-  <tabstop>LocalDir</tabstop>
-  <tabstop>BtnKeyword</tabstop>
-  <tabstop>Dir</tabstop>
-  <tabstop>BtnDir</tabstop>
-  <tabstop>BtnHelp</tabstop>
-  <tabstop>BtnFile</tabstop>
-  <tabstop>BtnLog</tabstop>
-  <tabstop>BtnOpts</tabstop>
-  <tabstop>BtnTest</tabstop>
-  <tabstop>BtnTray</tabstop>
- </tabstops>
  <resources>
-  <include location="../rtkconv_qt/rtkconv_qt.qrc"/>
+  <include location="rtkget_qt.qrc"/>
  </resources>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/getoptdlg.cpp RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/getoptdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/getoptdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/getoptdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -12,44 +12,49 @@
 extern MainForm *mainForm;
 
 //---------------------------------------------------------------------------
-DownOptDialog::DownOptDialog(QWidget *parent)
+//---------------------------------------------------------------------------
+DownOptDialog::DownOptDialog(QWidget* parent)
     : QDialog(parent)
 {
     setupUi(this);
 
-    QCompleter *fileCompleter = new QCompleter(this);
-    QFileSystemModel *fileModel = new QFileSystemModel(fileCompleter);
+
+    QCompleter *fileCompleter=new QCompleter(this);
+    QFileSystemModel *fileModel=new QFileSystemModel(fileCompleter);
     fileModel->setRootPath("");
     fileCompleter->setModel(fileModel);
     UrlFile->setCompleter(fileCompleter);
     LogFile->setCompleter(fileCompleter);
 
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(BtnLogFile, SIGNAL(clicked(bool)), this, SLOT(BtnLogFileClick()));
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnUrlFile, SIGNAL(clicked(bool)), this, SLOT(BtnUrlFileClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(BtnLogFile,SIGNAL(clicked(bool)),this,SLOT(BtnLogFileClick()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnUrlFile,SIGNAL(clicked(bool)),this,SLOT(BtnUrlFileClick()));
+
+    NCol->setValidator(new QIntValidator(0,9999));
 }
 //---------------------------------------------------------------------------
 void DownOptDialog::BtnUrlFileClick()
 {
-    UrlFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("GNSS Data URL File"))));
+    UrlFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("GNSS Data URL File"))));
 }
 //---------------------------------------------------------------------------
 void DownOptDialog::BtnLogFileClick()
 {
-    LogFile->setText(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, tr("Download Log File"))));
+    LogFile->setText(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this,tr("Download Log File"))));
 }
 //---------------------------------------------------------------------------
 void DownOptDialog::showEvent(QShowEvent *event)
 {
     if (event->spontaneous()) return;
 
-    HoldErr->setChecked(mainForm->HoldErr);
-    HoldList->setChecked(mainForm->HoldList);
-    NCol->setValue(mainForm->NCol);
-    Proxy->setText(mainForm->ProxyAddr);
-    UrlFile->setText(mainForm->UrlFile);
-    LogFile->setText(mainForm->LogFile);
+
+    HoldErr  ->setChecked(mainForm->HoldErr);
+    HoldList ->setChecked(mainForm->HoldList);
+    NCol     ->setText(QString::number(mainForm->NCol));
+    Proxy    ->setText(mainForm->ProxyAddr);
+    UrlFile  ->setText(mainForm->UrlFile);
+    LogFile  ->setText(mainForm->LogFile);
     LogAppend->setChecked(mainForm->LogAppend);
     DateFormat->setCurrentIndex(mainForm->DateFormat);
     TraceLevel->setCurrentIndex(mainForm->TraceLevel);
@@ -57,15 +62,15 @@
 //---------------------------------------------------------------------------
 void DownOptDialog::BtnOkClick()
 {
-    mainForm->HoldErr = HoldErr->isChecked();
-    mainForm->HoldList = HoldList->isChecked();
-    mainForm->NCol = NCol->value();
-    mainForm->ProxyAddr = Proxy->text();
-    mainForm->UrlFile = UrlFile->text();
-    mainForm->LogFile = LogFile->text();
-    mainForm->LogAppend = LogAppend->isChecked();
-    mainForm->DateFormat = DateFormat->currentIndex();
-    mainForm->TraceLevel = TraceLevel->currentIndex();
+    mainForm->HoldErr  =HoldErr  ->isChecked();
+    mainForm->HoldList =HoldList ->isChecked();
+    mainForm->NCol     =NCol     ->text().toInt();
+    mainForm->ProxyAddr=Proxy    ->text();
+    mainForm->UrlFile  =UrlFile  ->text();
+    mainForm->LogFile  =LogFile  ->text();
+    mainForm->LogAppend=LogAppend->isChecked();
+    mainForm->DateFormat=DateFormat->currentIndex();
+    mainForm->TraceLevel=TraceLevel->currentIndex();
 
     accept();
 }
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/getoptdlg.ui RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/getoptdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/getoptdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/getoptdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -44,21 +44,51 @@
       <property name="bottomMargin">
        <number>0</number>
       </property>
-      <item row="4" column="0">
-       <widget class="QLabel" name="Label5">
+      <property name="spacing">
+       <number>0</number>
+      </property>
+      <item row="4" column="1">
+       <widget class="QComboBox" name="TraceLevel">
         <property name="enabled">
          <bool>true</bool>
         </property>
         <property name="toolTip">
          <string/>
         </property>
-        <property name="text">
-         <string>Date Format for Test</string>
-        </property>
+        <item>
+         <property name="text">
+          <string>OFF</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Level 1</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Level 2</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Level 3</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Level 4</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Level 5</string>
+         </property>
+        </item>
        </widget>
       </item>
-      <item row="9" column="2">
-       <widget class="QPushButton" name="BtnUrlFile">
+      <item row="5" column="0">
+       <widget class="QLabel" name="Label3">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -66,41 +96,25 @@
          <string/>
         </property>
         <property name="text">
-         <string>...</string>
-        </property>
-        <property name="flat">
-         <bool>false</bool>
+         <string>Proxy Address</string>
         </property>
        </widget>
       </item>
-      <item row="0" column="0" colspan="2">
-       <widget class="QCheckBox" name="HoldErr">
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string> Keep Error Info on Download Error (*.err)</string>
-        </property>
-        <property name="checked">
-         <bool>false</bool>
+      <item row="2" column="1">
+       <widget class="QLineEdit" name="NCol">
+        <property name="enabled">
+         <bool>true</bool>
         </property>
-       </widget>
-      </item>
-      <item row="1" column="0" colspan="2">
-       <widget class="QCheckBox" name="HoldList">
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string> Keep Remote Directory Listings (.listing)</string>
-        </property>
-        <property name="checked">
-         <bool>false</bool>
+         <string>35</string>
         </property>
        </widget>
       </item>
-      <item row="7" column="2">
-       <widget class="QPushButton" name="BtnLogFile">
+      <item row="2" column="0">
+       <widget class="QLabel" name="Label6">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -108,15 +122,12 @@
          <string/>
         </property>
         <property name="text">
-         <string>...</string>
-        </property>
-        <property name="flat">
-         <bool>false</bool>
+         <string># Columns for Test</string>
         </property>
        </widget>
       </item>
-      <item row="9" column="0" colspan="2">
-       <widget class="QLabel" name="Label1">
+      <item row="3" column="0">
+       <widget class="QLabel" name="Label5">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -124,25 +135,25 @@
          <string/>
         </property>
         <property name="text">
-         <string>URL List File for GNSS Data</string>
+         <string>Date Format for Test</string>
         </property>
        </widget>
       </item>
-      <item row="5" column="0">
-       <widget class="QLabel" name="Label2">
+      <item row="5" column="1" colspan="2">
+       <widget class="QLineEdit" name="Proxy">
         <property name="enabled">
-         <bool>true</bool>
+         <bool>false</bool>
         </property>
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string>Output Debug Trace</string>
+         <string/>
         </property>
        </widget>
       </item>
-      <item row="3" column="0">
-       <widget class="QLabel" name="Label6">
+      <item row="9" column="0" colspan="3">
+       <widget class="QLineEdit" name="UrlFile">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -150,50 +161,38 @@
          <string/>
         </property>
         <property name="text">
-         <string># Columns for Test</string>
+         <string/>
         </property>
        </widget>
       </item>
-      <item row="4" column="1">
-       <widget class="QComboBox" name="DateFormat">
+      <item row="6" column="0">
+       <widget class="QLabel" name="Label4">
         <property name="enabled">
          <bool>true</bool>
         </property>
         <property name="toolTip">
          <string/>
         </property>
-        <item>
-         <property name="text">
-          <string>YYYY-DOY</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>YYYY/mm/dd</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>Week</string>
-         </property>
-        </item>
+        <property name="text">
+         <string>Download Log File</string>
+        </property>
        </widget>
       </item>
-      <item row="10" column="0" colspan="3">
-       <widget class="QLineEdit" name="UrlFile">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
+      <item row="6" column="1">
+       <widget class="QCheckBox" name="LogAppend">
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string/>
+         <string>Append</string>
+        </property>
+        <property name="checked">
+         <bool>false</bool>
         </property>
        </widget>
       </item>
-      <item row="6" column="0">
-       <widget class="QLabel" name="Label3">
+      <item row="8" column="2">
+       <widget class="QPushButton" name="BtnUrlFile">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -201,37 +200,40 @@
          <string/>
         </property>
         <property name="text">
-         <string>Proxy Address</string>
+         <string>...</string>
+        </property>
+        <property name="flat">
+         <bool>false</bool>
         </property>
        </widget>
       </item>
-      <item row="7" column="0">
-       <widget class="QLabel" name="Label4">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
+      <item row="0" column="0" colspan="2">
+       <widget class="QCheckBox" name="HoldErr">
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string>Download Log File</string>
+         <string> Keep Error Info on Download Error (*.err)</string>
+        </property>
+        <property name="checked">
+         <bool>false</bool>
         </property>
        </widget>
       </item>
-      <item row="7" column="1">
-       <widget class="QCheckBox" name="LogAppend">
+      <item row="1" column="0" colspan="2">
+       <widget class="QCheckBox" name="HoldList">
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string>Append</string>
+         <string> Keep Remote Directory Listings (.listing)</string>
         </property>
         <property name="checked">
          <bool>false</bool>
         </property>
        </widget>
       </item>
-      <item row="8" column="0" colspan="3">
+      <item row="7" column="0" colspan="3">
        <widget class="QLineEdit" name="LogFile">
         <property name="enabled">
          <bool>true</bool>
@@ -244,8 +246,21 @@
         </property>
        </widget>
       </item>
-      <item row="5" column="1">
-       <widget class="QComboBox" name="TraceLevel">
+      <item row="8" column="0" colspan="2">
+       <widget class="QLabel" name="Label1">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>URL List File for GNSS Data</string>
+        </property>
+       </widget>
+      </item>
+      <item row="3" column="1">
+       <widget class="QComboBox" name="DateFormat">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -254,53 +269,47 @@
         </property>
         <item>
          <property name="text">
-          <string>OFF</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>Level 1</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>Level 2</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>Level 3</string>
+          <string>YYYY-DOY</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Level 4</string>
+          <string>YYYY/mm/dd</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Level 5</string>
+          <string>Week</string>
          </property>
         </item>
        </widget>
       </item>
-      <item row="6" column="1" colspan="2">
-       <widget class="QLineEdit" name="Proxy">
+      <item row="4" column="0">
+       <widget class="QLabel" name="Label2">
         <property name="enabled">
-         <bool>false</bool>
+         <bool>true</bool>
         </property>
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string/>
+         <string>Output Debug Trace</string>
         </property>
        </widget>
       </item>
-      <item row="3" column="1">
-       <widget class="QSpinBox" name="NCol">
-        <property name="maximum">
-         <number>9999</number>
+      <item row="6" column="2">
+       <widget class="QPushButton" name="BtnLogFile">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>...</string>
+        </property>
+        <property name="flat">
+         <bool>false</bool>
         </property>
        </widget>
       </item>
@@ -368,21 +377,6 @@
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>HoldErr</tabstop>
-  <tabstop>HoldList</tabstop>
-  <tabstop>NCol</tabstop>
-  <tabstop>DateFormat</tabstop>
-  <tabstop>TraceLevel</tabstop>
-  <tabstop>Proxy</tabstop>
-  <tabstop>LogAppend</tabstop>
-  <tabstop>BtnLogFile</tabstop>
-  <tabstop>LogFile</tabstop>
-  <tabstop>BtnUrlFile</tabstop>
-  <tabstop>UrlFile</tabstop>
-  <tabstop>BtnOk</tabstop>
-  <tabstop>BtnCancel</tabstop>
- </tabstops>
  <resources/>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/.gitignore RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/.gitignore
--- RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/.gitignore	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/.gitignore	2019-08-19 02:04:50.000000000 +0300
@@ -8,6 +8,3 @@
 rtkget_qt
 rtkget_qt.exe
 object_script*
-debug
-release
-*.exe
\ В конце файла нет новой строки
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/main.cpp RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/main.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/main.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/main.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -5,7 +5,6 @@
 {
     QApplication a(argc, argv);
     MainForm w(NULL);
-
     w.show();
 
     return a.exec();
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/rtkget_qt.pro RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/rtkget_qt.pro
--- RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/rtkget_qt.pro	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/rtkget_qt.pro	2019-08-19 02:04:50.000000000 +0300
@@ -4,12 +4,30 @@
 #
 #-------------------------------------------------
 
-QT       += core gui widgets
+QT       += core gui
 
-include(../app.pri)
+greaterThan(QT_MAJOR_VERSION, 4): QT += widgets
+
+include(../../RTKLib.pri)
 
 INCLUDEPATH += ../../src/ ../appcmn_qt
 
+linux{
+    RTKLIB =../../src/libRTKLib.a
+    LIBS += -lpng $${RTKLIB}
+}
+win32 {
+    CONFIG(debug) {
+        RTKLIB = ../../src/debug/libRTKLib.a
+    } else {
+        RTKLIB =../../src/release/libRTKLib.a
+    }
+
+    LIBS+= $${RTKLIB} -lWs2_32 -lwinmm
+}
+
+PRE_TARGETDEPS = $${RTKLIB}
+
 TARGET = rtkget_qt
 TEMPLATE = app
 
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/staoptdlg.cpp RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/staoptdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/staoptdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/staoptdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -6,36 +6,37 @@
 #include <QShowEvent>
 #include <QFileDialog>
 
-extern MainForm *mainForm;
+extern MainForm  *mainForm;
 
 //---------------------------------------------------------------------------
-StaListDialog::StaListDialog(QWidget *parent)
+StaListDialog::StaListDialog(QWidget* parent)
     : QDialog(parent)
 {
     setupUi(this);
 
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(BtnLoad, SIGNAL(clicked(bool)), this, SLOT(BtnLoadClick()));
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnSave, SIGNAL(clicked(bool)), this, SLOT(BtnSaveClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(BtnLoad,SIGNAL(clicked(bool)),this,SLOT(BtnLoadClick()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnSave,SIGNAL(clicked(bool)),this,SLOT(BtnSaveClick()));
 }
 //---------------------------------------------------------------------------
 void StaListDialog::showEvent(QShowEvent *event)
 {
     if (event->spontaneous()) return;
-
     StaList->clear();
-
-    for (int i = 0; i < mainForm->StaList->count(); i++)
+    
+    for (int i=0;i<mainForm->StaList->count();i++) {
         StaList->addItem(mainForm->StaList->item(i)->text());
+    }
 }
 //---------------------------------------------------------------------------
 void StaListDialog::BtnOkClick()
 {
     mainForm->StaList->clear();
-
-    for (int i = 0; i < StaList->count(); i++)
+    
+    for (int i=0;i<StaList->count();i++) {
         mainForm->StaList->addItem(StaList->item(i)->text());
+    }
 }
 //---------------------------------------------------------------------------
 void StaListDialog::BtnLoadClick()
@@ -43,18 +44,20 @@
     QString file;
     QFile fp;
     QByteArray buff;
-
-    file = QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Open...")));
+    
+    
+    file=QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Open...")));
 
     fp.setFileName(file);
     if (!fp.open(QIODevice::ReadOnly)) return;
-
+        
     StaList->clear();
     StaList->setVisible(false);
-
-    while (!fp.atEnd()) {
-        buff = fp.readLine();
-        buff = buff.mid(buff.indexOf('#'));
+    
+    while (!fp.atEnd())
+    {
+        buff=fp.readLine();
+        buff=buff.mid(buff.indexOf('#'));
         StaList->addItem(buff);
     }
 
@@ -63,13 +66,15 @@
 //---------------------------------------------------------------------------
 void StaListDialog::BtnSaveClick()
 {
-    QString file = QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, tr("Save...")));
+    QString file=QDir::toNativeSeparators(QFileDialog::getSaveFileName(this,tr("Save...")));
     QFile fp;
 
     fp.setFileName(file);
     if (!fp.open(QIODevice::WriteOnly)) return;
 
-    for (int i = 0; i < StaList->count(); i++)
-        fp.write((StaList->item(i)->text() + "\n").toLatin1());
+    for (int i=0;i<StaList->count();i++)
+    {
+        fp.write((StaList->item(i)->text()+"\n").toLatin1());
+    }
 }
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/staoptdlg.h RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/staoptdlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/staoptdlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/staoptdlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -11,7 +11,7 @@
     Q_OBJECT
 
 protected:
-    void  showEvent(QShowEvent*);
+    void  showEvent(QShowEvent *);
 
 public slots:
     void  BtnLoadClick();
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/staoptdlg.ui RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/staoptdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkget_qt/staoptdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkget_qt/staoptdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,7 +6,7 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>318</width>
+    <width>214</width>
     <height>300</height>
    </rect>
   </property>
@@ -65,7 +65,7 @@
          <string/>
         </property>
         <property name="text">
-         <string>&amp;Load...</string>
+         <string>Load...</string>
         </property>
        </widget>
       </item>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtklaunch_qt/launchmain.cpp RTKLIB-rtklib_2.4.3_new/app/rtklaunch_qt/launchmain.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtklaunch_qt/launchmain.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtklaunch_qt/launchmain.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -1,7 +1,7 @@
 //---------------------------------------------------------------------------
 // rtklaunch_qt : rtklib app launcher
 //
-//          Copyright (C) 2013-2016 by T.TAKASU, All rights reserved.
+//          Copyright (C) 2013 by T.TAKASU, All rights reserved.
 //          ported to Qt by Jens Reimann
 //
 // options : rtklib launcher [-t title][-tray]
@@ -16,21 +16,18 @@
 #include <QSettings>
 #include <QFileInfo>
 #include <QShowEvent>
+#include <QCloseEvent>
 #include <QCommandLineParser>
 #include <QProcess>
-#include <QMenu>
 
 #include "rtklib.h"
 #include "launchmain.h"
-//#include "launchoptdlg.h"
 
 //---------------------------------------------------------------------------
 
 #define BTN_SIZE        42
-#define BTN_COUNT       8
-#define MAX(x, y)        ((x) > (y) ? (x) : (y))
-
-MainForm *mainForm;
+#define BTN_COUNT       7
+#define MAX(x,y)        ((x)>(y)?(x):(y))
 
 //---------------------------------------------------------------------------
 MainForm::MainForm(QWidget *parent)
@@ -38,47 +35,33 @@
 {
     setupUi(this);
 
-    mainForm = this;
-
-    QString file = QApplication::applicationFilePath();
+    QString file=QApplication::applicationFilePath();
     QFileInfo fi(file);
-    IniFile = fi.absolutePath() + "/" + fi.baseName() + ".ini";
-    Option = 0;
-    Minimize = 0;
+    IniFile=fi.absolutePath()+"/"+fi.baseName()+".ini";
 
     setWindowTitle(tr("RTKLIB v.%1 %2").arg(VER_RTKLIB).arg(PATCH_LEVEL));
     setWindowIcon(QIcon(":/icons/rtk9.bmp"));
-
+    
     QCoreApplication::setApplicationName("rtklaunch_qt");
     QCoreApplication::setApplicationVersion("1.0");
 
-    QSettings settings(IniFile, QSettings::IniFormat);
-    Option =  settings.value("pos/option", 0).toInt();
-    Minimize =  settings.value("pos/minimize", 1).toInt();
-    BtnRtklib->setStatusTip("RTKLIB v." VER_RTKLIB " " PATCH_LEVEL);
-
     QCommandLineParser parser;
-    parser.setApplicationDescription("rtklib application launcher Qt");
+    parser.setApplicationDescription("rtklib application launcher");
     parser.addHelpOption();
     parser.addVersionOption();
 
     QCommandLineOption titleOption("t",
-                       QCoreApplication::translate("main", "Set Window Title"),
-                       QCoreApplication::translate("main", "title"));
+                                   QCoreApplication::translate("main", "Set Window Title"),
+                                   QCoreApplication::translate("main", "title"));
     parser.addOption(titleOption);
 
     QCommandLineOption trayOption(QStringList() << "tray",
-                      QCoreApplication::translate("main", "only show tray icon"));
+            QCoreApplication::translate("main", "only show tray icon"));
     parser.addOption(trayOption);
 
-    QCommandLineOption miniOption(QStringList() << "min",
-                      QCoreApplication::translate("main", "start minimized"));
-    parser.addOption(miniOption);
-
-
     parser.process(*QApplication::instance());
 
-    bool tray = parser.isSet(trayOption);
+    bool tray=parser.isSet(trayOption);
 
     if (parser.isSet(titleOption))
         setWindowTitle(parser.value(titleOption));
@@ -88,152 +71,112 @@
         TrayIcon.setVisible(true);
     }
 
-    if (parser.isSet(miniOption)) Minimize = 1;
-
-    trayMenu = new QMenu(this);
-    trayMenu->addAction(tr("Expand"), this, SLOT(MenuExpandClick()));
+    trayMenu=new QMenu(this);
+    trayMenu->addAction(tr("Expand"),this,SLOT(MenuExpandClick()));
     trayMenu->addSeparator();
-    trayMenu->addAction(tr("RTK&PLOT"), this, SLOT(BtnPlotClick()));
-    trayMenu->addAction(tr("&RTKPOST"), this, SLOT(BtnPostClick()));
-    trayMenu->addAction(tr("RTK&NAVI"), this, SLOT(BtnNaviClick()));
-    trayMenu->addAction(tr("RTK&CONV"), this, SLOT(BtnConvClick()));
-    trayMenu->addAction(tr("RTK&GET"), this, SLOT(BtnGetClick()));
-    trayMenu->addAction(tr("RTK&STR"), this, SLOT(BtnStrClick()));
-    trayMenu->addAction(tr("&NTRIP BROWSER"), this, SLOT(BtnNtripClick()));
+    trayMenu->addAction(tr("RTK&PLOT"),this,SLOT(BtnPlotClick()));
+    trayMenu->addAction(tr("&RTKPOST"),this,SLOT(BtnPostClick()));
+    trayMenu->addAction(tr("RTK&NAVI"),this,SLOT(BtnNaviClick()));
+    trayMenu->addAction(tr("RTK&CONV"),this,SLOT(BtnConvClick()));
+    trayMenu->addAction(tr("RTK&GET"),this,SLOT(BtnGetClick()));
+    trayMenu->addAction(tr("RTK&STR"),this,SLOT(BtnStrClick()));
+    trayMenu->addAction(tr("&NTRIP BROWSER"),this,SLOT(BtnNtripClick()));
     trayMenu->addSeparator();
-    trayMenu->addAction(tr("&Exit"), this, SLOT(close()));
+    trayMenu->addAction(tr("&Exit"),this,SLOT(close()));
 
     TrayIcon.setContextMenu(trayMenu);
     TrayIcon.setIcon(QIcon(":/icons/rtk9.bmp"));
     TrayIcon.setToolTip(windowTitle());
 
-    QMenu *Popup = new QMenu();
-    Popup->addAction(tr("&Expand"), this, SLOT(MenuExpandClick()));
-    Popup->addSeparator();
-    Popup->addAction(actionRtkConv);
-    Popup->addAction(actionRtkGet);
-    Popup->addAction(actionRtkNavi);
-    Popup->addAction(actionRtkNtrip);
-    Popup->addAction(actionRtkPlot);
-    Popup->addAction(actionRtkPost);
-    Popup->addAction(actionRtkStr);
-    Popup->addAction(actionRtkVideo);
-    Popup->addSeparator();
-    Popup->addAction(tr("E&xit"),this,SLOT(accept()));
-    BtnRtklib->setMenu(Popup);
-
-    connect(BtnPlot, SIGNAL(clicked(bool)), this, SLOT(BtnPlotClick()));
-    connect(BtnConv, SIGNAL(clicked(bool)), this, SLOT(BtnConvClick()));
-    connect(BtnStr, SIGNAL(clicked(bool)), this, SLOT(BtnStrClick()));
-    connect(BtnPost, SIGNAL(clicked(bool)), this, SLOT(BtnPostClick()));
-    connect(BtnNtrip, SIGNAL(clicked(bool)), this, SLOT(BtnNtripClick()));
-    connect(BtnNavi, SIGNAL(clicked(bool)), this, SLOT(BtnNaviClick()));
-    connect(BtnTray, SIGNAL(clicked(bool)), this, SLOT(BtnTrayClick()));
-    connect(BtnGet, SIGNAL(clicked(bool)), this, SLOT(BtnGetClick()));
-    connect(BtnVideo, SIGNAL(clicked(bool)), this, SLOT(BtnVideoClick()));
-    connect(BtnOption, SIGNAL(clicked(bool)), this, SLOT(BtnOptionClick()));
-    connect(&TrayIcon, SIGNAL(activated(QSystemTrayIcon::ActivationReason)), this, SLOT(TrayIconActivated(QSystemTrayIcon::ActivationReason)));
-    connect(BtnExit, SIGNAL(clicked(bool)), this, SLOT(accept()));
-
-    connect(actionRtkConv, SIGNAL(triggered(bool)), this, SLOT(BtnConvClick()));
-    connect(actionRtkGet, SIGNAL(triggered(bool)), this, SLOT(BtnGetClick()));
-    connect(actionRtkNavi, SIGNAL(triggered(bool)), this, SLOT(BtnNaviClick()));
-    connect(actionRtkNtrip, SIGNAL(triggered(bool)), this, SLOT(BtnNtripClick()));
-    connect(actionRtkPlot, SIGNAL(triggered(bool)), this, SLOT(BtnPlotClick()));
-    connect(actionRtkPost, SIGNAL(triggered(bool)), this, SLOT(BtnPostClick()));
-    connect(actionRtkStr, SIGNAL(triggered(bool)), this, SLOT(BtnStrClick()));
-    connect(actionRtkVideo, SIGNAL(triggered(bool)), this, SLOT(BtnVideoClick()));
+    connect(BtnPlot,SIGNAL(clicked(bool)),this,SLOT(BtnPlotClick()));
+    connect(BtnConv,SIGNAL(clicked(bool)),this,SLOT(BtnConvClick()));
+    connect(BtnStr,SIGNAL(clicked(bool)),this,SLOT(BtnStrClick()));
+    connect(BtnPost,SIGNAL(clicked(bool)),this,SLOT(BtnPostClick()));
+    connect(BtnNtrip,SIGNAL(clicked(bool)),this,SLOT(BtnNtripClick()));
+    connect(BtnNavi,SIGNAL(clicked(bool)),this,SLOT(BtnNaviClick()));
+    connect(BtnTray,SIGNAL(clicked(bool)),this,SLOT(BtnTrayClick()));
+    connect(BtnGet,SIGNAL(clicked(bool)),this,SLOT(BtnGetClick()));
+    connect(&TrayIcon,SIGNAL(activated(QSystemTrayIcon::ActivationReason)),this,SLOT(TrayIconActivated(QSystemTrayIcon::ActivationReason)));
 
-    UpdatePanel();
 }
 //---------------------------------------------------------------------------
 void MainForm::showEvent(QShowEvent *event)
 {
     if (event->spontaneous()) return;
 
-    QSettings settings(IniFile, QSettings::IniFormat);
+    QSettings settings(IniFile,QSettings::IniFormat);
 
-    move(settings.value("pos/left", 0).toInt(),
-         settings.value("pos/top", 0).toInt());
+    move(settings.value("pos/left",    0).toInt(),
+         settings.value("pos/top",     0).toInt());
 
     resize(settings.value("pos/width", 310).toInt(),
            settings.value("pos/height", 79).toInt());
-
 }
 //---------------------------------------------------------------------------
-void MainForm::closeEvent(QCloseEvent *event)
+void MainForm::closeEvent(QCloseEvent *event )
 {
     if (event->spontaneous()) return;
 
-    QSettings settings(IniFile, QSettings::IniFormat);
-    settings.setValue("pos/left", pos().x());
-    settings.setValue("pos/top", pos().y());
-    settings.setValue("pos/width", width());
-    settings.setValue("pos/height", height());
-    settings.setValue("pos/option", Option);
-    settings.setValue("pos/minimize", Minimize);
+    QSettings settings(IniFile,QSettings::IniFormat);
+    settings.setValue("pos/left",    pos().x());
+    settings.setValue("pos/top",     pos().y());
+    settings.setValue("pos/width",   width());
+    settings.setValue("pos/height",  height());
 }
 //---------------------------------------------------------------------------
 void MainForm::BtnPlotClick()
 {
-    QString cmd1 = "./rtkplot_qt", cmd2 = "../../../bin/rtkplot_qt", opts = "";
-
-    if (!ExecCmd(cmd1 + opts)) ExecCmd(cmd2 + opts);
+    QString cmd1="./rtkplot_qt",cmd2="../../../bin/rtkplot_qt",opts="";
+    
+    if (!ExecCmd(cmd1+opts)) ExecCmd(cmd2+opts);
 }
 //---------------------------------------------------------------------------
 void MainForm::BtnConvClick()
 {
-    QString cmd1 = "./rtkconv_qt", cmd2 = "../../../bin/rtkconv_qt", opts = "";
-
-    if (!ExecCmd(cmd1 + opts)) ExecCmd(cmd2 + opts);
+    QString cmd1="./rtkconv_qt",cmd2="../../../bin/rtkconv_qt",opts="";
+    
+    if (!ExecCmd(cmd1+opts)) ExecCmd(cmd2+opts);
 }
 //---------------------------------------------------------------------------
 void MainForm::BtnStrClick()
 {
-    QString cmd1 = "./strsvr_qt", cmd2 = "../../../bin/strsvr_qt", opts = "";
-
-    if (!ExecCmd(cmd1 + opts)) ExecCmd(cmd2 + opts);
+    QString cmd1="./strsvr_qt",cmd2="../../../bin/strsvr_qt",opts="";
+    
+    if (!ExecCmd(cmd1+opts)) ExecCmd(cmd2+opts);
 }
 //---------------------------------------------------------------------------
 void MainForm::BtnPostClick()
 {
-    QString cmd1 = "./rtkpost_qt", cmd2 = "../../../bin/rtkpost_qt", opts = "";
-
-    if (!ExecCmd(cmd1 + opts)) ExecCmd(cmd2 + opts);
+    QString cmd1="./rtkpost_qt",cmd2="../../../bin/rtkpost_qt",opts="";
+    
+    if (!ExecCmd(cmd1+opts)) ExecCmd(cmd2+opts);
 }
 //---------------------------------------------------------------------------
 void MainForm::BtnNtripClick()
 {
-    QString cmd1 = "./srctblbrows_qt", cmd2 = "../../../bin/srctblbrows_qt", opts = "";
-
-    if (!ExecCmd(cmd1 + opts)) ExecCmd(cmd2 + opts);
+    QString cmd1="./srctblbrows_qt",cmd2="../../../bin/srctblbrows_qt",opts="";
+    
+    if (!ExecCmd(cmd1+opts)) ExecCmd(cmd2+opts);
 }
 //---------------------------------------------------------------------------
 void MainForm::BtnNaviClick()
 {
-    QString cmd1 = "./rtknavi_qt", cmd2 = "../../../bin/rtknavi_qt", opts = "";
-
-    if (!ExecCmd(cmd1 + opts)) ExecCmd(cmd2 + opts);
+    QString cmd1="./rtknavi_qt",cmd2="../../../bin/rtknavi_qt",opts="";
+    
+    if (!ExecCmd(cmd1+opts)) ExecCmd(cmd2+opts);
 }
 //---------------------------------------------------------------------------
 void MainForm::BtnGetClick()
 {
-    QString cmd1 = "./rtkget_qt", cmd2 = "../../../bin/rtkget_qt", opts = "";
-
-    if (!ExecCmd(cmd1 + opts)) ExecCmd(cmd2 + opts);
-}
-//---------------------------------------------------------------------------
-void MainForm::BtnVideoClick()
-{
-    QString cmd1 = "rtkvideo", cmd2 = "..\\..\\..\\bin\\rtkvideo", opts = "";
-
-    if (!ExecCmd(cmd1 + opts)) ExecCmd(cmd2 + opts);
+    QString cmd1="./rtkget_qt",cmd2="../../../bin/rtkget_qt",opts="";
+    
+    if (!ExecCmd(cmd1+opts)) ExecCmd(cmd2+opts);
 }
 //---------------------------------------------------------------------------
 int MainForm::ExecCmd(const QString &cmd)
 {
-    return QProcess::startDetached(cmd);
-}
+     return QProcess::startDetached(cmd); /* FIXME: show option not yet supported */
+ }
 //---------------------------------------------------------------------------
 void MainForm::BtnTrayClick()
 {
@@ -243,7 +186,7 @@
 //---------------------------------------------------------------------------
 void MainForm::TrayIconActivated(QSystemTrayIcon::ActivationReason reason)
 {
-    if (reason != QSystemTrayIcon::DoubleClick) return;
+    if (reason!=QSystemTrayIcon::DoubleClick) return;
 
     setVisible(true);
     TrayIcon.setVisible(false);
@@ -253,25 +196,6 @@
 {
     setVisible(true);
     TrayIcon.setVisible(false);
-    Minimize = 0;
-    UpdatePanel();
 }
 //---------------------------------------------------------------------------
-void MainForm::UpdatePanel(void)
-{
-    if (Minimize) {
-        Panel1->setVisible(false);
-        Panel2->setVisible(true);
-    }
-    else {
-        Panel1->setVisible(true);
-        Panel2->setVisible(false);
-    }
-}
-//---------------------------------------------------------------------------
-void MainForm::BtnOptionClick()
-{
-//    launchOptDialog->exec();
-//    if (launchOptDialog->result()!=QDialog::Accepted) return;
-    UpdatePanel();
-}
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtklaunch_qt/launchmain.h RTKLIB-rtklib_2.4.3_new/app/rtklaunch_qt/launchmain.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtklaunch_qt/launchmain.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtklaunch_qt/launchmain.h	2019-08-19 02:04:50.000000000 +0300
@@ -10,13 +10,11 @@
 
 class QCloseEvent;
 class QCloseEvent;
-class LaunchOptDlg;
 
 //---------------------------------------------------------------------------
 class MainForm : public QDialog, private Ui::MainForm
 {
     Q_OBJECT
-
 protected:
     void showEvent(QShowEvent *);
     void closeEvent(QCloseEvent *);
@@ -29,9 +27,7 @@
     void BtnNtripClick();
     void BtnNaviClick();
     void BtnGetClick();
-    void BtnVideoClick();
     void BtnTrayClick();
-    void BtnOptionClick();
     void TrayIconActivated(QSystemTrayIcon::ActivationReason);
     void MenuExpandClick();
 
@@ -39,15 +35,11 @@
     QString IniFile;
     QSystemTrayIcon TrayIcon;
     QMenu *trayMenu;
-    LaunchOptDlg *launchOptDlg;
     int Tray;
 	
     int ExecCmd(const QString &cmd);
-    void UpdatePanel();
-
 public:
-    int Option, Minimize;
-    explicit MainForm(QWidget *parent = 0);
+    explicit MainForm(QWidget *parent=0);
 };
 //---------------------------------------------------------------------------
 #endif
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtklaunch_qt/launchmain.ui RTKLIB-rtklib_2.4.3_new/app/rtklaunch_qt/launchmain.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtklaunch_qt/launchmain.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtklaunch_qt/launchmain.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>340</width>
-    <height>131</height>
+    <width>196</width>
+    <height>39</height>
    </rect>
   </property>
   <property name="sizePolicy">
@@ -35,172 +35,147 @@
    <property name="bottomMargin">
     <number>0</number>
    </property>
+   <property name="spacing">
+    <number>0</number>
+   </property>
+   <item row="0" column="2">
+    <widget class="QPushButton" name="BtnStr">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string>STRSVR</string>
+     </property>
+     <property name="text">
+      <string/>
+     </property>
+     <property name="icon">
+      <iconset resource="../rtkget_qt/rtkget_qt.qrc">
+       <normaloff>:/icons/rtk6.bmp</normaloff>:/icons/rtk6.bmp</iconset>
+     </property>
+     <property name="flat">
+      <bool>true</bool>
+     </property>
+    </widget>
+   </item>
+   <item row="0" column="5">
+    <widget class="QPushButton" name="BtnNavi">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string>RTKNAVI</string>
+     </property>
+     <property name="text">
+      <string/>
+     </property>
+     <property name="icon">
+      <iconset resource="../rtkget_qt/rtkget_qt.qrc">
+       <normaloff>:/icons/rtk5.bmp</normaloff>:/icons/rtk5.bmp</iconset>
+     </property>
+     <property name="flat">
+      <bool>true</bool>
+     </property>
+    </widget>
+   </item>
+   <item row="0" column="1">
+    <widget class="QPushButton" name="BtnConv">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string>RTKCONV</string>
+     </property>
+     <property name="text">
+      <string/>
+     </property>
+     <property name="icon">
+      <iconset resource="../rtkget_qt/rtkget_qt.qrc">
+       <normaloff>:/icons/rtk3.bmp</normaloff>:/icons/rtk3.bmp</iconset>
+     </property>
+     <property name="flat">
+      <bool>true</bool>
+     </property>
+    </widget>
+   </item>
    <item row="0" column="0">
-    <widget class="QWidget" name="Panel1" native="true">
-     <layout class="QGridLayout" name="gridLayout_2">
-      <property name="leftMargin">
-       <number>0</number>
-      </property>
-      <property name="topMargin">
-       <number>0</number>
-      </property>
-      <property name="rightMargin">
-       <number>0</number>
-      </property>
-      <property name="bottomMargin">
-       <number>0</number>
-      </property>
-      <item row="0" column="1">
-       <widget class="QPushButton" name="BtnConv">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string>RTKCONV</string>
-        </property>
-        <property name="text">
-         <string/>
-        </property>
-        <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-          <normaloff>:/icons/rtk3.bmp</normaloff>:/icons/rtk3.bmp</iconset>
-        </property>
-        <property name="flat">
-         <bool>true</bool>
-        </property>
-       </widget>
-      </item>
-      <item row="0" column="4">
-       <widget class="QPushButton" name="BtnNtrip">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string>NTRIP Browser</string>
-        </property>
-        <property name="text">
-         <string/>
-        </property>
-        <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-          <normaloff>:/icons/rtk7.bmp</normaloff>:/icons/rtk7.bmp</iconset>
-        </property>
-        <property name="flat">
-         <bool>true</bool>
-        </property>
-       </widget>
-      </item>
-      <item row="0" column="6">
-       <widget class="QPushButton" name="BtnGet">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string>RTKGET</string>
-        </property>
-        <property name="text">
-         <string/>
-        </property>
-        <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-          <normaloff>:/icons/rtk8.bmp</normaloff>:/icons/rtk8.bmp</iconset>
-        </property>
-        <property name="flat">
-         <bool>true</bool>
-        </property>
-       </widget>
-      </item>
-      <item row="0" column="3">
-       <widget class="QPushButton" name="BtnPost">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string>RTKPOST</string>
-        </property>
-        <property name="text">
-         <string/>
-        </property>
-        <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-          <normaloff>:/icons/rtk1.bmp</normaloff>:/icons/rtk1.bmp</iconset>
-        </property>
-        <property name="flat">
-         <bool>true</bool>
-        </property>
-       </widget>
-      </item>
-      <item row="0" column="5">
-       <widget class="QPushButton" name="BtnNavi">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string>RTKNAVI</string>
-        </property>
-        <property name="text">
-         <string/>
-        </property>
-        <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-          <normaloff>:/icons/rtk5.bmp</normaloff>:/icons/rtk5.bmp</iconset>
-        </property>
-        <property name="flat">
-         <bool>true</bool>
-        </property>
-       </widget>
-      </item>
-      <item row="0" column="0">
-       <widget class="QPushButton" name="BtnPlot">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string>RTKPLOT</string>
-        </property>
-        <property name="text">
-         <string/>
-        </property>
-        <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-          <normaloff>:/icons/rtk2.bmp</normaloff>:/icons/rtk2.bmp</iconset>
-        </property>
-        <property name="flat">
-         <bool>true</bool>
-        </property>
-       </widget>
-      </item>
-      <item row="0" column="2">
-       <widget class="QPushButton" name="BtnStr">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string>STRSVR</string>
-        </property>
-        <property name="text">
-         <string/>
-        </property>
-        <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-          <normaloff>:/icons/rtk6.bmp</normaloff>:/icons/rtk6.bmp</iconset>
-        </property>
-        <property name="flat">
-         <bool>true</bool>
-        </property>
-       </widget>
-      </item>
-      <item row="0" column="7">
-       <widget class="QPushButton" name="BtnVideo">
-        <property name="text">
-         <string/>
-        </property>
-        <property name="flat">
-         <bool>true</bool>
-        </property>
-       </widget>
-      </item>
-     </layout>
+    <widget class="QPushButton" name="BtnPlot">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string>RTKPLOT</string>
+     </property>
+     <property name="text">
+      <string/>
+     </property>
+     <property name="icon">
+      <iconset resource="../rtkget_qt/rtkget_qt.qrc">
+       <normaloff>:/icons/rtk2.bmp</normaloff>:/icons/rtk2.bmp</iconset>
+     </property>
+     <property name="flat">
+      <bool>true</bool>
+     </property>
+    </widget>
+   </item>
+   <item row="0" column="3">
+    <widget class="QPushButton" name="BtnPost">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string>RTKPOST</string>
+     </property>
+     <property name="text">
+      <string/>
+     </property>
+     <property name="icon">
+      <iconset resource="../rtkget_qt/rtkget_qt.qrc">
+       <normaloff>:/icons/rtk1.bmp</normaloff>:/icons/rtk1.bmp</iconset>
+     </property>
+     <property name="flat">
+      <bool>true</bool>
+     </property>
+    </widget>
+   </item>
+   <item row="0" column="4">
+    <widget class="QPushButton" name="BtnNtrip">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string>NTRIP Browser</string>
+     </property>
+     <property name="text">
+      <string/>
+     </property>
+     <property name="icon">
+      <iconset resource="../rtkget_qt/rtkget_qt.qrc">
+       <normaloff>:/icons/rtk7.bmp</normaloff>:/icons/rtk7.bmp</iconset>
+     </property>
+     <property name="flat">
+      <bool>true</bool>
+     </property>
+    </widget>
+   </item>
+   <item row="0" column="6">
+    <widget class="QPushButton" name="BtnGet">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string>RTKGET</string>
+     </property>
+     <property name="text">
+      <string/>
+     </property>
+     <property name="icon">
+      <iconset resource="../rtkget_qt/rtkget_qt.qrc">
+       <normaloff>:/icons/rtk8.bmp</normaloff>:/icons/rtk8.bmp</iconset>
+     </property>
+     <property name="flat">
+      <bool>true</bool>
+     </property>
     </widget>
    </item>
    <item row="1" column="6">
@@ -227,7 +202,7 @@
       <string/>
      </property>
      <property name="icon">
-      <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+      <iconset resource="../rtkget_qt/rtkget_qt.qrc">
        <normaloff>:/buttons/sqr.bmp</normaloff>:/buttons/sqr.bmp</iconset>
      </property>
      <property name="flat">
@@ -235,168 +210,10 @@
      </property>
     </widget>
    </item>
-   <item row="1" column="0">
-    <widget class="QPushButton" name="BtnOption">
-     <property name="text">
-      <string/>
-     </property>
-    </widget>
-   </item>
-   <item row="2" column="0">
-    <widget class="QWidget" name="Panel2" native="true">
-     <layout class="QHBoxLayout" name="horizontalLayout">
-      <property name="leftMargin">
-       <number>0</number>
-      </property>
-      <property name="topMargin">
-       <number>0</number>
-      </property>
-      <property name="rightMargin">
-       <number>0</number>
-      </property>
-      <property name="bottomMargin">
-       <number>0</number>
-      </property>
-      <item>
-       <widget class="QPushButton" name="BtnRtklib">
-        <property name="toolTip">
-         <string>RTKLIB APs</string>
-        </property>
-        <property name="text">
-         <string/>
-        </property>
-        <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-          <normaloff>:/icons/rtk9.bmp</normaloff>:/icons/rtk9.bmp</iconset>
-        </property>
-        <property name="flat">
-         <bool>true</bool>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QPushButton" name="BtnExit">
-        <property name="text">
-         <string>Exit</string>
-        </property>
-        <property name="default">
-         <bool>true</bool>
-        </property>
-       </widget>
-      </item>
-     </layout>
-    </widget>
-   </item>
   </layout>
-  <action name="actionRtkConv">
-   <property name="icon">
-    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-     <normaloff>:/icons/rtk3.bmp</normaloff>:/icons/rtk3.bmp</iconset>
-   </property>
-   <property name="text">
-    <string>rtkConv</string>
-   </property>
-   <property name="toolTip">
-    <string>RTK Convert</string>
-   </property>
-  </action>
-  <action name="actionRtkGet">
-   <property name="icon">
-    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-     <normaloff>:/icons/rtk8.bmp</normaloff>:/icons/rtk8.bmp</iconset>
-   </property>
-   <property name="text">
-    <string>rtkGet</string>
-   </property>
-   <property name="toolTip">
-    <string>RTK Get</string>
-   </property>
-  </action>
-  <action name="actionRtkNavi">
-   <property name="icon">
-    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-     <normaloff>:/icons/rtk5.bmp</normaloff>:/icons/rtk5.bmp</iconset>
-   </property>
-   <property name="text">
-    <string>rtkNavi</string>
-   </property>
-   <property name="toolTip">
-    <string>RTK Navi</string>
-   </property>
-  </action>
-  <action name="actionRtkNtrip">
-   <property name="icon">
-    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-     <normaloff>:/icons/rtk7.bmp</normaloff>:/icons/rtk7.bmp</iconset>
-   </property>
-   <property name="text">
-    <string>rtkNtrip</string>
-   </property>
-   <property name="toolTip">
-    <string>RTK NTRIP</string>
-   </property>
-  </action>
-  <action name="actionRtkPlot">
-   <property name="icon">
-    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-     <normaloff>:/icons/rtk2.bmp</normaloff>:/icons/rtk2.bmp</iconset>
-   </property>
-   <property name="text">
-    <string>rtkPlot</string>
-   </property>
-   <property name="toolTip">
-    <string>RTK Plot</string>
-   </property>
-  </action>
-  <action name="actionRtkPost">
-   <property name="icon">
-    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-     <normaloff>:/icons/rtk1.bmp</normaloff>:/icons/rtk1.bmp</iconset>
-   </property>
-   <property name="text">
-    <string>rtkPost</string>
-   </property>
-   <property name="toolTip">
-    <string>RTK Post</string>
-   </property>
-  </action>
-  <action name="actionRtkStr">
-   <property name="icon">
-    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-     <normaloff>:/icons/rtk6.bmp</normaloff>:/icons/rtk6.bmp</iconset>
-   </property>
-   <property name="text">
-    <string>rtkStr</string>
-   </property>
-   <property name="toolTip">
-    <string>RTK Stream</string>
-   </property>
-  </action>
-  <action name="actionRtkVideo">
-   <property name="text">
-    <string>rtkVideo</string>
-   </property>
-   <property name="toolTip">
-    <string>RTK Video</string>
-   </property>
-  </action>
  </widget>
- <tabstops>
-  <tabstop>BtnExit</tabstop>
-  <tabstop>BtnPlot</tabstop>
-  <tabstop>BtnConv</tabstop>
-  <tabstop>BtnStr</tabstop>
-  <tabstop>BtnPost</tabstop>
-  <tabstop>BtnNtrip</tabstop>
-  <tabstop>BtnNavi</tabstop>
-  <tabstop>BtnGet</tabstop>
-  <tabstop>BtnVideo</tabstop>
-  <tabstop>BtnOption</tabstop>
-  <tabstop>BtnTray</tabstop>
-  <tabstop>BtnRtklib</tabstop>
- </tabstops>
  <resources>
-  <include location="../rtkconv_qt/rtkconv_qt.qrc"/>
+  <include location="../rtkget_qt/rtkget_qt.qrc"/>
  </resources>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtklaunch_qt/launchoptdlg.cpp RTKLIB-rtklib_2.4.3_new/app/rtklaunch_qt/launchoptdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtklaunch_qt/launchoptdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtklaunch_qt/launchoptdlg.cpp	1970-01-01 03:00:00.000000000 +0300
@@ -1,45 +0,0 @@
-//---------------------------------------------------------------------------
-
-#include "launchmain.h"
-#include "launchoptdlg.h"
-
-#include <QShowEvent>
-
-extern MainForm *mainForm;
-
-//---------------------------------------------------------------------------
-LaunchOptDialog::LaunchOptDialog(QWidget *parent)
-    : QDialog(parent)
-{
-    setupUi(this);
-}
-//---------------------------------------------------------------------------
-void LaunchOptDialog::showEvent(QShowEvent *event)
-{
-    if (event->spontaneous()) return;
-
-    if (mainForm->Option == 1) {
-        OptMkl->setChecked(true);
-	}
-    else if (mainForm->Option == 2) {
-        OptWin64->setChecked(true);
-	}
-	else {
-        OptNormal->setChecked(true);
-	}
-    Minimize->setChecked(mainForm->Minimize);
-}
-//---------------------------------------------------------------------------
-void LaunchOptDialog::BtnOkClick()
-{
-    if (OptMkl->isChecked()) {
-        mainForm->Option = 1;
-	}
-    else if (OptWin64->isChecked()) {
-        mainForm->Option = 2;
-	}
-	else {
-        mainForm->Option = 0;
-	}
-    mainForm->Minimize=Minimize->isChecked();
-}//---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtklaunch_qt/launchoptdlg.h RTKLIB-rtklib_2.4.3_new/app/rtklaunch_qt/launchoptdlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtklaunch_qt/launchoptdlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtklaunch_qt/launchoptdlg.h	1970-01-01 03:00:00.000000000 +0300
@@ -1,23 +0,0 @@
-//---------------------------------------------------------------------------
-
-#ifndef launchoptdlgH
-#define launchoptdlgH
-//---------------------------------------------------------------------------
-#include "ui_launchoptdlg.h"
-#include <QDialog>
-
-class QShowEvent;
-//---------------------------------------------------------------------------
-class LaunchOptDialog : public QDialog, private Ui::LaunchOptDialog
-{
-    Q_OBJECT
-public slots:
-    void BtnOkClick();
-
-protected:
-    void showEvent(QShowEvent *);
-public:
-    LaunchOptDialog(QWidget* parent);
-};
-//---------------------------------------------------------------------------
-#endif
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtklaunch_qt/launchoptdlg.ui RTKLIB-rtklib_2.4.3_new/app/rtklaunch_qt/launchoptdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtklaunch_qt/launchoptdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtklaunch_qt/launchoptdlg.ui	1970-01-01 03:00:00.000000000 +0300
@@ -1,123 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<ui version="4.0">
- <class>LaunchOptDialog</class>
- <widget class="QWidget" name="LaunchOptDialog">
-  <property name="geometry">
-   <rect>
-    <x>0</x>
-    <y>0</y>
-    <width>264</width>
-    <height>147</height>
-   </rect>
-  </property>
-  <property name="windowTitle">
-   <string>Options</string>
-  </property>
-  <property name="toolTip">
-   <string/>
-  </property>
-  <layout class="QGridLayout" name="gridLayout">
-   <item row="0" column="0" colspan="2">
-    <widget class="QRadioButton" name="OptNormal">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="layoutDirection">
-      <enum>Qt::LeftToRight</enum>
-     </property>
-     <property name="text">
-      <string>&amp;Normal APs (32 bit without MKL)</string>
-     </property>
-     <property name="checked">
-      <bool>false</bool>
-     </property>
-    </widget>
-   </item>
-   <item row="1" column="0" colspan="2">
-    <widget class="QRadioButton" name="OptMkl">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="layoutDirection">
-      <enum>Qt::LeftToRight</enum>
-     </property>
-     <property name="text">
-      <string>RTKPOST_&amp;MKL, RTKNAVI_MKL</string>
-     </property>
-     <property name="checked">
-      <bool>false</bool>
-     </property>
-    </widget>
-   </item>
-   <item row="2" column="0" colspan="2">
-    <widget class="QRadioButton" name="OptWin64">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="layoutDirection">
-      <enum>Qt::LeftToRight</enum>
-     </property>
-     <property name="text">
-      <string>RTKPOST_WIN&amp;64, RTKNAVI_WIN64</string>
-     </property>
-     <property name="checked">
-      <bool>false</bool>
-     </property>
-    </widget>
-   </item>
-   <item row="3" column="0">
-    <widget class="QCheckBox" name="Minimize">
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="text">
-      <string>Minimize</string>
-     </property>
-     <property name="checked">
-      <bool>false</bool>
-     </property>
-    </widget>
-   </item>
-   <item row="4" column="0">
-    <widget class="QPushButton" name="BtnOk">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="text">
-      <string>&amp;OK</string>
-     </property>
-     <property name="default">
-      <bool>true</bool>
-     </property>
-    </widget>
-   </item>
-   <item row="4" column="1">
-    <widget class="QPushButton" name="BtnCancel">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="text">
-      <string>&amp;Cancel</string>
-     </property>
-    </widget>
-   </item>
-  </layout>
- </widget>
- <resources/>
- <connections/>
-</ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtklaunch_qt/main.cpp RTKLIB-rtklib_2.4.3_new/app/rtklaunch_qt/main.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtklaunch_qt/main.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtklaunch_qt/main.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -5,7 +5,6 @@
 {
     QApplication a(argc, argv);
     MainForm w;
-
     w.show();
 
     return a.exec();
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtklaunch_qt/rtklaunch_qt.pro RTKLIB-rtklib_2.4.3_new/app/rtklaunch_qt/rtklaunch_qt.pro
--- RTKLIB-rtklib_2.4.3_orig/app/rtklaunch_qt/rtklaunch_qt.pro	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtklaunch_qt/rtklaunch_qt.pro	2019-08-19 02:04:50.000000000 +0300
@@ -4,29 +4,36 @@
 #
 #-------------------------------------------------
 
-QT       += widgets core gui widgets
+QT       += widgets core gui
+
+greaterThan(QT_MAJOR_VERSION, 4) {
+    QT += widgets
+    DEFINES += QT5
+}
+
+
+include(../../RTKLib.pri)
 
 TARGET = rtklaunch_qt
 TEMPLATE = app
 
 INCLUDEPATH += ../../src/  
 
+linux {
+LIBS += -lpng
+}
+
 SOURCES += \ 
     launchmain.cpp \
-    main.cpp \
-    launchoptdlg.cpp
+    main.cpp
 
 HEADERS  += \ 
-    launchmain.h \
-    launchoptdlg.h
+    launchmain.h
 
 FORMS    += \ 
-    launchmain.ui \
-    launchoptdlg.ui
+    launchmain.ui
 
 RESOURCES += \
     rtklaunch_qt.qrc
 
 RC_FILE = rtklaunch_qt.rc
-
-CONFIG += c++11
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi/navimain.cpp RTKLIB-rtklib_2.4.3_new/app/rtknavi/navimain.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi/navimain.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi/navimain.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -82,7 +82,7 @@
 
 // show message in message area ---------------------------------------------
 extern "C" {
-extern int showmsg(const char *format,...) {return 0;}
+extern int showmsg(char *format,...) {return 0;}
 }
 // convert degree to deg-min-sec --------------------------------------------
 static void degtodms(double deg, double *dms)
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/.gitignore RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/.gitignore
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/.gitignore	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/.gitignore	2019-08-19 02:04:50.000000000 +0300
@@ -8,6 +8,3 @@
 rtknavi_qt
 rtknavi_qt.exe
 object_script*
-debug
-release
-*.stat
\ В конце файла нет новой строки
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/instrdlg.cpp RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/instrdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/instrdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/instrdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -20,7 +20,7 @@
 #include "instrdlg.h"
 
 //---------------------------------------------------------------------------
-InputStrDialog::InputStrDialog(QWidget *parent)
+InputStrDialog::InputStrDialog(QWidget* parent)
     : QDialog(parent)
 {
     int i;
@@ -30,15 +30,15 @@
     Format1->clear();
     Format2->clear();
 
-    NRcv = 0;
+	NRcv=0;
 
-    for (i = 0; i <= MAXRCVFMT; i++) {
+	for (i=0;i<=MAXRCVFMT;i++) {
         Format1->addItem(formatstrs[i]);
         Format2->addItem(formatstrs[i]);
         Format3->addItem(formatstrs[i]);
 		NRcv++;
 	}
-    Format3->addItem(tr("SP3"));
+    Format3->addItem("SP3");
 
     cmdOptDialog = new CmdOptDialog(this);
     rcvOptDialog = new RcvOptDialog(this);
@@ -47,93 +47,90 @@
     tcpOptDialog = new TcpOptDialog(this);
     ftpOptDialog = new FtpOptDialog(this);
 
-    QCompleter *fileCompleter = new QCompleter(this);
-    QFileSystemModel *fileModel = new QFileSystemModel(fileCompleter);
+    NmeaPos1->setValidator(new QDoubleValidator(this));
+    NmeaPos2->setValidator(new QDoubleValidator(this));
+
+    QCompleter *fileCompleter=new QCompleter(this);
+    QFileSystemModel *fileModel=new QFileSystemModel(fileCompleter);
     fileModel->setRootPath("");
     fileCompleter->setModel(fileModel);
     FilePath1->setCompleter(fileCompleter);
     FilePath2->setCompleter(fileCompleter);
     FilePath3->setCompleter(fileCompleter);
 
-    connect(Stream1, SIGNAL(currentIndexChanged(int)), this, SLOT(Stream1Change(int)));
-    connect(Stream2, SIGNAL(currentIndexChanged(int)), this, SLOT(Stream2Change(int)));
-    connect(Stream3, SIGNAL(currentIndexChanged(int)), this, SLOT(Stream3Change(int)));
-    connect(NmeaReqL, SIGNAL(currentIndexChanged(int)), this, SLOT(NmeaReqLChange(int)));
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnCmd1, SIGNAL(clicked(bool)), this, SLOT(BtnCmd1Click()));
-    connect(BtnCmd2, SIGNAL(clicked(bool)), this, SLOT(BtnCmd2Click()));
-    connect(BtnCmd3, SIGNAL(clicked(bool)), this, SLOT(BtnCmd3Click()));
-    connect(BtnFile1, SIGNAL(clicked(bool)), this, SLOT(BtnFile1Click()));
-    connect(BtnFile2, SIGNAL(clicked(bool)), this, SLOT(BtnFile2Click()));
-    connect(BtnFile3, SIGNAL(clicked(bool)), this, SLOT(BtnFile3Click()));
-    connect(BtnPos, SIGNAL(clicked(bool)), this, SLOT(BtnPosClick()));
-    connect(BtnRcvOpt1, SIGNAL(clicked(bool)), this, SLOT(BtnRcvOpt1Click()));
-    connect(BtnRcvOpt2, SIGNAL(clicked(bool)), this, SLOT(BtnRcvOpt2Click()));
-    connect(BtnRcvOpt3, SIGNAL(clicked(bool)), this, SLOT(BtnRcvOpt3Click()));
-    connect(BtnStr1, SIGNAL(clicked(bool)), this, SLOT(BtnStr1Click()));
-    connect(BtnStr2, SIGNAL(clicked(bool)), this, SLOT(BtnStr2Click()));
-    connect(BtnStr3, SIGNAL(clicked(bool)), this, SLOT(BtnStr3Click()));
-    connect(StreamC1, SIGNAL(clicked(bool)), this, SLOT(StreamC1Click()));
-    connect(StreamC2, SIGNAL(clicked(bool)), this, SLOT(StreamC2Click()));
-    connect(StreamC3, SIGNAL(clicked(bool)), this, SLOT(StreamC3Click()));
-    connect(TimeTagC, SIGNAL(clicked(bool)), this, SLOT(TimeTagCClick()));
+    connect(Stream1,SIGNAL(currentIndexChanged(int)),this,SLOT(Stream1Change(int)));
+    connect(Stream2,SIGNAL(currentIndexChanged(int)),this,SLOT(Stream2Change(int)));
+    connect(Stream3,SIGNAL(currentIndexChanged(int)),this,SLOT(Stream3Change(int)));
+    connect(NmeaReqL,SIGNAL(currentIndexChanged(int)),this,SLOT(NmeaReqLChange(int)));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnCmd1,SIGNAL(clicked(bool)),this,SLOT(BtnCmd1Click()));
+    connect(BtnCmd2,SIGNAL(clicked(bool)),this,SLOT(BtnCmd2Click()));
+    connect(BtnCmd3,SIGNAL(clicked(bool)),this,SLOT(BtnCmd3Click()));
+    connect(BtnFile1,SIGNAL(clicked(bool)),this,SLOT(BtnFile1Click()));
+    connect(BtnFile2,SIGNAL(clicked(bool)),this,SLOT(BtnFile2Click()));
+    connect(BtnFile3,SIGNAL(clicked(bool)),this,SLOT(BtnFile3Click()));
+    connect(BtnPos,SIGNAL(clicked(bool)),this,SLOT(BtnPosClick()));
+    connect(BtnRcvOpt1,SIGNAL(clicked(bool)),this,SLOT(BtnRcvOpt1Click()));
+    connect(BtnRcvOpt2,SIGNAL(clicked(bool)),this,SLOT(BtnRcvOpt2Click()));
+    connect(BtnRcvOpt3,SIGNAL(clicked(bool)),this,SLOT(BtnRcvOpt3Click()));
+    connect(BtnStr1,SIGNAL(clicked(bool)),this,SLOT(BtnStr1Click()));
+    connect(BtnStr2,SIGNAL(clicked(bool)),this,SLOT(BtnStr2Click()));
+    connect(BtnStr3,SIGNAL(clicked(bool)),this,SLOT(BtnStr3Click()));
+    connect(StreamC1,SIGNAL(clicked(bool)),this,SLOT(StreamC1Click()));
+    connect(StreamC2,SIGNAL(clicked(bool)),this,SLOT(StreamC2Click()));
+    connect(StreamC3,SIGNAL(clicked(bool)),this,SLOT(StreamC3Click()));
+    connect(TimeTagC,SIGNAL(clicked(bool)),this,SLOT(TimeTagCClick()));
 }
 //---------------------------------------------------------------------------
 void InputStrDialog::showEvent(QShowEvent *event)
 {
     if (event->spontaneous()) return;
 
-    StreamC1->setChecked(StreamC[0]);
-    StreamC2->setChecked(StreamC[1]);
-    StreamC3->setChecked(StreamC[2]);
-    Stream1->setCurrentIndex(Stream[0]);
-    Stream2->setCurrentIndex(Stream[1]);
-    Stream3->setCurrentIndex(Stream[2]);
-    Format1->setCurrentIndex(Format[0]);
-    Format2->setCurrentIndex(Format[1] < NRcv ? Format[1] : NRcv + Format[1] - STRFMT_SP3);
-    Format3->setCurrentIndex(Format[2] < NRcv ? Format[2] : NRcv + Format[2] - STRFMT_SP3);
-    FilePath1->setText(GetFilePath(Paths[0][2]));
-    FilePath2->setText(GetFilePath(Paths[1][2]));
-    FilePath3->setText(GetFilePath(Paths[2][2]));
-    NmeaReqL->setCurrentIndex(NmeaReq);
-    TimeTagC->setChecked(TimeTag);
+    StreamC1  ->setChecked(StreamC[0]);
+    StreamC2  ->setChecked(StreamC[1]);
+    StreamC3  ->setChecked(StreamC[2]);
+    Stream1   ->setCurrentIndex(Stream[0]);
+    Stream2   ->setCurrentIndex(Stream[1]);
+    Stream3   ->setCurrentIndex(Stream[2]);
+    Format1   ->setCurrentIndex(Format[0]);
+    Format2   ->setCurrentIndex(Format[1]<NRcv?Format[1]:NRcv+Format[1]-STRFMT_SP3);
+    Format3   ->setCurrentIndex(Format[2]<NRcv?Format[2]:NRcv+Format[2]-STRFMT_SP3);
+    FilePath1 ->setText(GetFilePath(Paths[0][2]));
+    FilePath2 ->setText(GetFilePath(Paths[1][2]));
+    FilePath3 ->setText(GetFilePath(Paths[2][2]));
+    NmeaReqL  ->setCurrentIndex(NmeaReq);
+    TimeTagC  ->setChecked(TimeTag);
     TimeSpeedL->setCurrentIndex(TimeSpeedL->findText(TimeSpeed));
     TimeStartE->setText(TimeStart);
-    Chk64Bit->setChecked(Time64Bit);
-    NmeaPos1->setValue(NmeaPos[0]);
-    NmeaPos2->setValue(NmeaPos[1]);
-    NmeaPos3->setValue(NmeaPos[2]);
-    EditMaxBL->setValue(MaxBL);
-    EditResetCmd->setText(ResetCmd);
+    NmeaPos1  ->setText(QString::number(NmeaPos[0],'f',9));
+    NmeaPos2  ->setText(QString::number(NmeaPos[1],'f',9));
 
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
 void InputStrDialog::BtnOkClick()
 {
-    StreamC[0] = StreamC1->isChecked();
-    StreamC[1] = StreamC2->isChecked();
-    StreamC[2] = StreamC3->isChecked();
-    Stream[0] = Stream1->currentIndex();
-    Stream[1] = Stream2->currentIndex();
-    Stream[2] = Stream3->currentIndex();
-    Format[0] = Format1->currentIndex();
-    Format[1] = Format2->currentIndex() < NRcv ? Format2->currentIndex() : STRFMT_SP3 + Format2->currentIndex() - NRcv;
-    Format[2] = Format3->currentIndex() < NRcv ? Format3->currentIndex() : STRFMT_SP3 + Format3->currentIndex() - NRcv;
-    Paths[0][2] = SetFilePath(FilePath1->text());
-    Paths[1][2] = SetFilePath(FilePath2->text());
-    Paths[2][2] = SetFilePath(FilePath3->text());
-    NmeaReq = NmeaReqL->currentIndex();
-    TimeTag = TimeTagC->isChecked();
-    TimeSpeed = TimeSpeedL->currentText();
-    TimeStart = TimeStartE->text();
-    Time64Bit  = Chk64Bit->isChecked();
-    NmeaPos[0] = NmeaPos1->value();
-    NmeaPos[1] = NmeaPos2->value();
-    NmeaPos[2] = NmeaPos3->value();
-    MaxBL      = EditMaxBL->value();
-    ResetCmd   = EditResetCmd->text();
+    bool ok;
+
+    StreamC[0] =StreamC1  ->isChecked();
+    StreamC[1] =StreamC2  ->isChecked();
+    StreamC[2] =StreamC3  ->isChecked();
+    Stream[0]  =Stream1   ->currentIndex();
+    Stream[1]  =Stream2   ->currentIndex();
+    Stream[2]  =Stream3   ->currentIndex();
+    Format[0]  =Format1   ->currentIndex();
+    Format[1]  =Format2->currentIndex()<NRcv?Format2->currentIndex():STRFMT_SP3+Format2->currentIndex()-NRcv;
+    Format[2]  =Format3->currentIndex()<NRcv?Format3->currentIndex():STRFMT_SP3+Format3->currentIndex()-NRcv;
+    Paths[0][2]=SetFilePath(FilePath1->text());
+    Paths[1][2]=SetFilePath(FilePath2->text());
+    Paths[2][2]=SetFilePath(FilePath3->text());
+    NmeaReq    =NmeaReqL  ->currentIndex();
+    TimeTag    =TimeTagC  ->isChecked();
+    TimeSpeed  =TimeSpeedL->currentText();
+    TimeStart  =TimeStartE->text();
+    NmeaPos[0] =NmeaPos1->text().toDouble(&ok);
+    NmeaPos[1] =NmeaPos2->text().toDouble(&ok);
 
     accept();
 }
@@ -143,322 +140,329 @@
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::StreamC2Click()
+void  InputStrDialog::StreamC2Click()
 {
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::StreamC3Click()
+void  InputStrDialog::StreamC3Click()
 {
     UpdateEnable();
 }//---------------------------------------------------------------------------
-void InputStrDialog::Stream1Change(int)
+void  InputStrDialog::Stream1Change(int)
 {
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::Stream2Change(int)
+void  InputStrDialog::Stream2Change(int)
 {
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::Stream3Change(int)
+void  InputStrDialog::Stream3Change(int)
 {
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::TimeTagCClick()
+void  InputStrDialog::TimeTagCClick()
 {
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::NmeaReqLChange(int)
+void  InputStrDialog::NmeaReqLChange(int)
 {
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-QString InputStrDialog::GetFilePath(const QString &path)
+QString  InputStrDialog::GetFilePath(const QString &path)
 {
     QString file;
-
-    file = path.mid(0, path.indexOf("::"));
+    file=path.mid(0,path.indexOf("::"));
 
     return file;
 }
 //---------------------------------------------------------------------------
-QString InputStrDialog::SetFilePath(const QString &p)
+QString  InputStrDialog::SetFilePath(const QString &p)
 {
-    QString path = p;
-
-    if (TimeTagC->isChecked()) path += "::T";
-    if (TimeStartE->text() != "0") path += "::+" + TimeStartE->text();
-    path += "::" + TimeSpeedL->currentText();
-    if (Chk64Bit->isChecked()) path += "::P=8";
-    return path;
+    QString path=p;
+    if (TimeTagC->isChecked()     ) path+="::T";
+    if (TimeStartE->text()!="0" ) path+="::+"+TimeStartE->text();
+    path+="::"+TimeSpeedL->currentText();
+	return path;
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::BtnStr1Click()
+void  InputStrDialog::BtnStr1Click()
 {
     switch (Stream1->currentIndex()) {
-    case 0: SerialOpt(0, 0); break;
-    case 1: TcpOpt(0, 1); break;
-    case 2: TcpOpt(0, 0); break;
-    case 3: TcpOpt(0, 3); break;
+		case 0: SerialOpt(0,0); break;
+		case 1: TcpOpt(0,1); break;
+		case 2: TcpOpt(0,0); break;
+		case 3: TcpOpt(0,3); break;
 	}
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::BtnStr2Click()
+void  InputStrDialog::BtnStr2Click()
 {
     switch (Stream2->currentIndex()) {
-    case 0: SerialOpt(1, 0); break;
-    case 1: TcpOpt(1, 1); break;
-    case 2: TcpOpt(1, 0); break;
-    case 3: TcpOpt(1, 3); break;
-    case 5: FtpOpt(1, 0); break;
-    case 6: FtpOpt(1, 1); break;
+		case 0: SerialOpt(1,0); break;
+		case 1: TcpOpt(1,1); break;
+		case 2: TcpOpt(1,0); break;
+		case 3: TcpOpt(1,3); break;
+		case 5: FtpOpt(1,0); break;
+		case 6: FtpOpt(1,1); break;
 	}
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::BtnStr3Click()
+void  InputStrDialog::BtnStr3Click()
 {
     switch (Stream3->currentIndex()) {
-    case 0: SerialOpt(2, 0); break;
-    case 1: TcpOpt(2, 1); break;
-    case 2: TcpOpt(2, 0); break;
-    case 3: TcpOpt(2, 3); break;
-    case 5: FtpOpt(2, 0); break;
-    case 6: FtpOpt(2, 1); break;
+		case 0: SerialOpt(2,0); break;
+		case 1: TcpOpt(2,1); break;
+		case 2: TcpOpt(2,0); break;
+		case 3: TcpOpt(2,3); break;
+		case 5: FtpOpt(2,0); break;
+		case 6: FtpOpt(2,1); break;
 	}
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::BtnCmd1Click()
+void  InputStrDialog::BtnCmd1Click()
 {
-    for (int i = 0;i<3;i++) {
-        if (Stream1->currentIndex() == 0) {
-            cmdOptDialog->Cmds  [i] = Cmds  [0][i];
-            cmdOptDialog->CmdEna[i] = CmdEna[0][i];
-        }
-        else {
-            cmdOptDialog->Cmds  [i] = CmdsTcp  [0][i];
-            cmdOptDialog->CmdEna[i] = CmdEnaTcp[0][i];
-        }
-    }
+    if (Stream1->currentIndex()==0) {
+        cmdOptDialog->Cmds  [0]=Cmds  [0][0];
+        cmdOptDialog->Cmds  [1]=Cmds  [0][1];
+        cmdOptDialog->CmdEna[0]=CmdEna[0][0];
+        cmdOptDialog->CmdEna[1]=CmdEna[0][1];
+	}
+	else {
+        cmdOptDialog->Cmds  [0]=CmdsTcp  [0][0];
+        cmdOptDialog->Cmds  [1]=CmdsTcp  [0][1];
+        cmdOptDialog->CmdEna[0]=CmdEnaTcp[0][0];
+        cmdOptDialog->CmdEna[1]=CmdEnaTcp[0][1];
+	}
 
     cmdOptDialog->exec();
-    if (cmdOptDialog->result() != QDialog::Accepted) return;
+    if (cmdOptDialog->result()!=QDialog::Accepted) return;
 
-    for (int i = 0; i < 3; i++) {
-        if (Stream1->currentIndex() == 0) {
-            Cmds  [0][i] = cmdOptDialog->Cmds  [i];
-            CmdEna[0][i] = cmdOptDialog->CmdEna[i];
-        }
-        else {
-            CmdsTcp  [0][i] = cmdOptDialog->Cmds  [i];
-            CmdEnaTcp[0][i] = cmdOptDialog->CmdEna[i];
-        }
-    }
+    if (Stream1->currentIndex()==0) {
+        Cmds  [0][0]=cmdOptDialog->Cmds  [0];
+        Cmds  [0][1]=cmdOptDialog->Cmds  [1];
+        CmdEna[0][0]=cmdOptDialog->CmdEna[0];
+        CmdEna[0][1]=cmdOptDialog->CmdEna[1];
+	}
+	else {
+        CmdsTcp  [0][0]=cmdOptDialog->Cmds  [0];
+        CmdsTcp  [0][1]=cmdOptDialog->Cmds  [1];
+        CmdEnaTcp[0][0]=cmdOptDialog->CmdEna[0];
+        CmdEnaTcp[0][1]=cmdOptDialog->CmdEna[1];
+	}
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::BtnCmd2Click()
+void  InputStrDialog::BtnCmd2Click()
 {
-    for (int i = 0;i<3;i++) {
-        if (Stream2->currentIndex() == 0) {
-            cmdOptDialog->Cmds  [i] = Cmds  [1][i];
-            cmdOptDialog->CmdEna[i] = CmdEna[1][i];
-        }
-        else {
-            cmdOptDialog->Cmds  [i] = CmdsTcp  [1][i];
-            cmdOptDialog->CmdEna[i] = CmdEnaTcp[1][i];
-        }
-    }
+    if (Stream2->currentIndex()==0) {
+        cmdOptDialog->Cmds  [0]=Cmds  [1][0];
+        cmdOptDialog->Cmds  [1]=Cmds  [1][1];
+        cmdOptDialog->CmdEna[0]=CmdEna[1][0];
+        cmdOptDialog->CmdEna[1]=CmdEna[1][1];
+	}
+	else {
+        cmdOptDialog->Cmds  [0]=CmdsTcp  [1][0];
+        cmdOptDialog->Cmds  [1]=CmdsTcp  [1][1];
+        cmdOptDialog->CmdEna[0]=CmdEnaTcp[1][0];
+        cmdOptDialog->CmdEna[1]=CmdEnaTcp[1][1];
+	}
 
     cmdOptDialog->exec();
-    if (cmdOptDialog->result() != QDialog::Accepted) return;
+    if (cmdOptDialog->result()!=QDialog::Accepted) return;
 
-    for (int i = 0; i < 3; i++) {
-        if (Stream2->currentIndex() == 0) {
-            Cmds  [1][i] = cmdOptDialog->Cmds  [i];
-            CmdEna[1][i] = cmdOptDialog->CmdEna[i];
-        }
-        else {
-            CmdsTcp  [1][i] = cmdOptDialog->Cmds  [i];
-            CmdEnaTcp[1][i] = cmdOptDialog->CmdEna[i];
-        }
-    }}
+    if (Stream2->currentIndex()==0) {
+        Cmds  [1][0]=cmdOptDialog->Cmds  [0];
+        Cmds  [1][1]=cmdOptDialog->Cmds  [1];
+        CmdEna[1][0]=cmdOptDialog->CmdEna[0];
+        CmdEna[1][1]=cmdOptDialog->CmdEna[1];
+	}
+	else {
+        CmdsTcp  [1][0]=cmdOptDialog->Cmds  [0];
+        CmdsTcp  [1][1]=cmdOptDialog->Cmds  [1];
+        CmdEnaTcp[1][0]=cmdOptDialog->CmdEna[0];
+        CmdEnaTcp[1][1]=cmdOptDialog->CmdEna[1];
+	}
+}
 //---------------------------------------------------------------------------
-void InputStrDialog::BtnCmd3Click()
+void  InputStrDialog::BtnCmd3Click()
 {
-    for (int i = 0;i<3;i++) {
-        if (Stream3->currentIndex() == 0) {
-            cmdOptDialog->Cmds  [i] = Cmds  [2][i];
-            cmdOptDialog->CmdEna[i] = CmdEna[2][i];
-        }
-        else {
-            cmdOptDialog->Cmds  [i] = CmdsTcp  [2][i];
-            cmdOptDialog->CmdEna[i] = CmdEnaTcp[2][i];
-        }
-    }
+    if (Stream3->currentIndex()==0) {
+        cmdOptDialog->Cmds  [0]=Cmds  [2][0];
+        cmdOptDialog->Cmds  [1]=Cmds  [2][1];
+        cmdOptDialog->CmdEna[0]=CmdEna[2][0];
+        cmdOptDialog->CmdEna[1]=CmdEna[2][1];
+	}
+	else {
+        cmdOptDialog->Cmds  [0]=CmdsTcp  [2][0];
+        cmdOptDialog->Cmds  [1]=CmdsTcp  [2][1];
+        cmdOptDialog->CmdEna[0]=CmdEnaTcp[2][0];
+        cmdOptDialog->CmdEna[1]=CmdEnaTcp[2][1];
+	}
 
     cmdOptDialog->exec();
-    if (cmdOptDialog->result() != QDialog::Accepted) return;
+    if (cmdOptDialog->result()!=QDialog::Accepted) return;
 
-    for (int i = 0; i < 3; i++) {
-        if (Stream3->currentIndex() == 0) {
-            Cmds  [2][i] = cmdOptDialog->Cmds  [i];
-            CmdEna[2][i] = cmdOptDialog->CmdEna[i];
-        }
-        else {
-            CmdsTcp  [2][i] = cmdOptDialog->Cmds  [i];
-            CmdEnaTcp[2][i] = cmdOptDialog->CmdEna[i];
-        }
-    }}
+    if (Stream3->currentIndex()==0) {
+        Cmds  [2][0]=cmdOptDialog->Cmds  [0];
+        Cmds  [2][1]=cmdOptDialog->Cmds  [1];
+        CmdEna[2][0]=cmdOptDialog->CmdEna[0];
+        CmdEna[2][1]=cmdOptDialog->CmdEna[1];
+	}
+	else {
+        CmdsTcp  [2][0]=cmdOptDialog->Cmds  [0];
+        CmdsTcp  [2][1]=cmdOptDialog->Cmds  [1];
+        CmdEnaTcp[2][0]=cmdOptDialog->CmdEna[0];
+        CmdEnaTcp[2][1]=cmdOptDialog->CmdEna[1];
+	}
+}
 //---------------------------------------------------------------------------
-void InputStrDialog::BtnRcvOpt1Click()
+void  InputStrDialog::BtnRcvOpt1Click()
 {
-    rcvOptDialog->Option = RcvOpt[0];
+    rcvOptDialog->Option=RcvOpt[0];
 
     rcvOptDialog->exec();
-    if (rcvOptDialog->result() != QDialog::Accepted) return;
+    if (rcvOptDialog->result()!=QDialog::Accepted) return;
 
-    RcvOpt[0] = rcvOptDialog->Option;
+    RcvOpt[0]=rcvOptDialog->Option;
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::BtnRcvOpt2Click()
+void  InputStrDialog::BtnRcvOpt2Click()
 {
-    rcvOptDialog->Option = RcvOpt[1];
+    rcvOptDialog->Option=RcvOpt[1];
 
     rcvOptDialog->exec();
-    if (rcvOptDialog->result() != QDialog::Accepted) return;
+    if (rcvOptDialog->result()!=QDialog::Accepted) return;
 
-    RcvOpt[1] = rcvOptDialog->Option;
+    RcvOpt[1]=rcvOptDialog->Option;
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::BtnRcvOpt3Click()
+void  InputStrDialog::BtnRcvOpt3Click()
 {
-    rcvOptDialog->Option = RcvOpt[2];
+    rcvOptDialog->Option=RcvOpt[2];
 
     rcvOptDialog->exec();
-    if (rcvOptDialog->result() != QDialog::Accepted) return;
-    RcvOpt[2] = rcvOptDialog->Option;
+    if (rcvOptDialog->result()!=QDialog::Accepted) return;
+    RcvOpt[2]=rcvOptDialog->Option;
+
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::BtnPosClick()
+void  InputStrDialog::BtnPosClick()
 {
-    refDialog->RovPos[0] = NmeaPos1->value();
-    refDialog->RovPos[1] = NmeaPos2->value();
-    refDialog->RovPos[2] = NmeaPos3->value();
-    refDialog->StaPosFile = mainForm->StaPosFileF;
+    bool ok;
+
+    refDialog->RovPos[0]=NmeaPos1->text().toDouble(&ok);
+    refDialog->RovPos[1]=NmeaPos2->text().toDouble(&ok);
+    refDialog->StaPosFile=mainForm->StaPosFileF;
 
     refDialog->exec();
-    if (refDialog->result() != QDialog::Accepted) return;
+    if (refDialog->result()!=QDialog::Accepted) return;
 
-    NmeaPos1->setValue(refDialog->Pos[0]);
-    NmeaPos2->setValue(refDialog->Pos[1]);
-    NmeaPos3->setValue(refDialog->Pos[2]);
+    NmeaPos1->setText(QString::number(refDialog->Pos[0],'f',9));
+    NmeaPos2->setText(QString::number(refDialog->Pos[1],'f',9));
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::SerialOpt(int index, int opt)
+void  InputStrDialog::SerialOpt(int index, int opt)
 {
-    serialOptDialog->Path = Paths[index][0];
-    serialOptDialog->Opt = opt;
+    serialOptDialog->Path=Paths[index][0];
+    serialOptDialog->Opt=opt;
 
     serialOptDialog->exec();
-    if (serialOptDialog->result() != QDialog::Accepted) return;
+    if (serialOptDialog->result()!=QDialog::Accepted) return;
 
-    Paths[index][0] = serialOptDialog->Path;
+    Paths[index][0]=serialOptDialog->Path;
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::BtnFile1Click()
+void  InputStrDialog::BtnFile1Click()
 {
-    FilePath1->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Open..."), FilePath1->text())));
+    FilePath1->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Open..."),FilePath1->text())));
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::BtnFile2Click()
+void  InputStrDialog::BtnFile2Click()
 {
-    FilePath2->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Open..."), FilePath2->text())));
+    FilePath2->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Open..."),FilePath2->text())));
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::BtnFile3Click()
+void  InputStrDialog::BtnFile3Click()
 {
-    FilePath3->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Open..."), FilePath3->text())));
+    FilePath3->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Open..."),FilePath3->text())));
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::TcpOpt(int index, int opt)
+void  InputStrDialog::TcpOpt(int index, int opt)
 {
-    tcpOptDialog->Path = Paths[index][1];
-    tcpOptDialog->Opt = opt;
-    for (int i = 0; i < 10; i++) {
-        tcpOptDialog->History[i] = History[i];
-        tcpOptDialog->MntpHist[i] = MntpHist[i];
+    tcpOptDialog->Path=Paths[index][1];
+    tcpOptDialog->Opt=opt;
+	for (int i=0;i<10;i++) {
+        tcpOptDialog->History[i]=History[i];
+        tcpOptDialog->MntpHist[i]=MntpHist[i];
 	}
 
     tcpOptDialog->exec();
-    if (tcpOptDialog->result() != QDialog::Accepted) return;
+    if (tcpOptDialog->result()!=QDialog::Accepted) return;
 
-    Paths[index][1] = tcpOptDialog->Path;
-    for (int i = 0; i < 10; i++) {
-        History[i] = tcpOptDialog->History[i];
-        MntpHist[i] = tcpOptDialog->MntpHist[i];
+    Paths[index][1]=tcpOptDialog->Path;
+	for (int i=0;i<10;i++) {
+        History[i]=tcpOptDialog->History[i];
+        MntpHist[i]=tcpOptDialog->MntpHist[i];
 	}
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::FtpOpt(int index, int opt)
+void  InputStrDialog::FtpOpt(int index, int opt)
 {
-    ftpOptDialog->Path = Paths[index][3];
-    ftpOptDialog->Opt = opt;
+    ftpOptDialog->Path=Paths[index][3];
+    ftpOptDialog->Opt=opt;
 
     ftpOptDialog->exec();
-    if (ftpOptDialog->result() != QDialog::Accepted) return;
+    if (ftpOptDialog->result()!=QDialog::Accepted) return;
 
-    Paths[index][3] = ftpOptDialog->Path;
+    Paths[index][3]=ftpOptDialog->Path;
 }
 //---------------------------------------------------------------------------
-void InputStrDialog::UpdateEnable(void)
+void  InputStrDialog::UpdateEnable(void)
 {
-    int ena1 = (StreamC1->isChecked() && (Stream1->currentIndex() == 4)) ||
-           (StreamC2->isChecked() && (Stream2->currentIndex() == 4)) ||
-           (StreamC3->isChecked() && (Stream3->currentIndex() == 4));
-    int ena2 = StreamC2->isChecked() && (Stream2->currentIndex() <= 3);
-
-    Stream1->setEnabled(StreamC1->isChecked());
-    Stream2->setEnabled(StreamC2->isChecked());
-    Stream3->setEnabled(StreamC3->isChecked());
-    BtnStr1->setEnabled(StreamC1->isChecked() && Stream1->currentIndex() != 4);
-    BtnStr2->setEnabled(StreamC2->isChecked() && Stream2->currentIndex() != 4);
-    BtnStr3->setEnabled(StreamC3->isChecked() && Stream3->currentIndex() != 4);
-    BtnCmd1->setEnabled(StreamC1->isChecked() && Stream1->currentIndex() != 4);
-    BtnCmd2->setEnabled(StreamC2->isChecked() && Stream2->currentIndex() != 4);
-    BtnCmd3->setEnabled(StreamC3->isChecked() && Stream3->currentIndex() != 4);
-    Format1->setEnabled(StreamC1->isChecked());
-    Format2->setEnabled(StreamC2->isChecked());
-    Format3->setEnabled(StreamC3->isChecked());
+    int ena1=(StreamC1->isChecked()&&(Stream1->currentIndex()==4))||
+             (StreamC2->isChecked()&&(Stream2->currentIndex()==4))||
+             (StreamC3->isChecked()&&(Stream3->currentIndex()==4));
+    int ena2=StreamC2->isChecked()&&(Stream2->currentIndex()<=3);
+	
+    Stream1   ->setEnabled(StreamC1->isChecked());
+    Stream2   ->setEnabled(StreamC2->isChecked());
+    Stream3   ->setEnabled(StreamC3->isChecked());
+    BtnStr1   ->setEnabled(StreamC1->isChecked()&&Stream1->currentIndex()!=4);
+    BtnStr2   ->setEnabled(StreamC2->isChecked()&&Stream2->currentIndex()!=4);
+    BtnStr3   ->setEnabled(StreamC3->isChecked()&&Stream3->currentIndex()!=4);
+    BtnCmd1   ->setEnabled(StreamC1->isChecked()&&Stream1->currentIndex()!=4);
+    BtnCmd2   ->setEnabled(StreamC2->isChecked()&&Stream2->currentIndex()!=4);
+    BtnCmd3   ->setEnabled(StreamC3->isChecked()&&Stream3->currentIndex()!=4);
+    Format1   ->setEnabled(StreamC1->isChecked());
+    Format2   ->setEnabled(StreamC2->isChecked());
+    Format3   ->setEnabled(StreamC3->isChecked());
     BtnRcvOpt1->setEnabled(StreamC1->isChecked());
     BtnRcvOpt2->setEnabled(StreamC2->isChecked());
     BtnRcvOpt3->setEnabled(StreamC3->isChecked());
-
-    LabelNmea->setEnabled(ena2);
-    NmeaReqL->setEnabled(ena2);
-    NmeaPos1->setEnabled(ena2 && NmeaReqL->currentIndex() == 1);
-    NmeaPos2->setEnabled(ena2 && NmeaReqL->currentIndex() == 1);
-    NmeaPos3->setEnabled(ena2 && NmeaReqL->currentIndex() == 1);
-    BtnPos->setEnabled(ena2 && NmeaReqL->currentIndex() == 1);
-    LabelResetCmd->setEnabled(ena2 && NmeaReqL->currentIndex() == 3);
-    EditResetCmd->setEnabled(ena2 && NmeaReqL->currentIndex() == 3);
-    LabelMaxBL->setEnabled(ena2 && NmeaReqL->currentIndex() == 3);
-    EditMaxBL->setEnabled(ena2 && NmeaReqL->currentIndex() == 3);
-
-    LabelF1->setEnabled(ena1);
-    FilePath1->setEnabled(StreamC1->isChecked() && Stream1->currentIndex() == 4);
-    FilePath2->setEnabled(StreamC2->isChecked() && Stream2->currentIndex() == 4);
-    FilePath3->setEnabled(StreamC3->isChecked() && Stream3->currentIndex() == 4);
-    BtnFile1->setEnabled(StreamC1->isChecked() && Stream1->currentIndex() == 4);
-    BtnFile2->setEnabled(StreamC2->isChecked() && Stream2->currentIndex() == 4);
-    BtnFile3->setEnabled(StreamC3->isChecked() && Stream3->currentIndex() == 4);
-    TimeTagC->setEnabled(ena1);
-    TimeStartE->setEnabled(ena1 && TimeTagC->isChecked());
-    TimeSpeedL->setEnabled(ena1 && TimeTagC->isChecked());
-    LabelF2->setEnabled(ena1 && TimeTagC->isChecked());
-    LabelF3->setEnabled(ena1 && TimeTagC->isChecked());
-    Chk64Bit->setEnabled(ena1 && TimeTagC->isChecked());
+	
+    LabelNmea ->setEnabled(ena2);
+    NmeaReqL  ->setEnabled(ena2);
+    NmeaPos1  ->setEnabled(ena2&&NmeaReqL->currentIndex()==1);
+    NmeaPos2  ->setEnabled(ena2&&NmeaReqL->currentIndex()==1);
+    BtnPos    ->setEnabled(ena2&&NmeaReqL->currentIndex()==1);
+	
+    LabelF1   ->setEnabled(ena1);
+    FilePath1 ->setEnabled(StreamC1->isChecked()&&Stream1->currentIndex()==4);
+    FilePath2 ->setEnabled(StreamC2->isChecked()&&Stream2->currentIndex()==4);
+    FilePath3 ->setEnabled(StreamC3->isChecked()&&Stream3->currentIndex()==4);
+    BtnFile1  ->setEnabled(StreamC1->isChecked()&&Stream1->currentIndex()==4);
+    BtnFile2  ->setEnabled(StreamC2->isChecked()&&Stream2->currentIndex()==4);
+    BtnFile3  ->setEnabled(StreamC3->isChecked()&&Stream3->currentIndex()==4);
+    TimeTagC  ->setEnabled(ena1);
+    TimeStartE->setEnabled(ena1&&TimeTagC->isChecked());
+    TimeSpeedL->setEnabled(ena1&&TimeTagC->isChecked());
+    LabelF2   ->setEnabled(ena1&&TimeTagC->isChecked());
+    LabelF3   ->setEnabled(ena1&&TimeTagC->isChecked());
 }
 //---------------------------------------------------------------------------
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/instrdlg.h RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/instrdlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/instrdlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/instrdlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -61,13 +61,13 @@
     TcpOptDialog *tcpOptDialog;
     FtpOptDialog *ftpOptDialog;
 public:
-    bool StreamC[3], TimeTag;
-    int Stream[3], Format[3], CmdEna[3][3], CmdEnaTcp[3][3];
-    int NmeaReq, NRcv, Time64Bit;
-    double NmeaPos[3], MaxBL;
-    QString Paths[3][4], Cmds[3][3], CmdsTcp[3][3], TimeStart, TimeSpeed;
-    QString RcvOpt[3], ResetCmd;
-    QString History[10], MntpHist[10];
+    bool StreamC[3],TimeTag;
+    int Stream[3],Format[3],CmdEna[3][2],CmdEnaTcp[3][2];
+    int NmeaReq,NRcv;
+	double NmeaPos[2];
+    QString Paths[3][4],Cmds[3][2],CmdsTcp[3][2],TimeStart,TimeSpeed;
+    QString RcvOpt[3];
+    QString History[10],MntpHist[10];
 
     explicit InputStrDialog(QWidget* parent);
 };
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/instrdlg.ui RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/instrdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/instrdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/instrdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>820</width>
-    <height>424</height>
+    <width>662</width>
+    <height>339</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -17,40 +17,34 @@
    <string/>
   </property>
   <layout class="QGridLayout" name="gridLayout">
-   <item row="0" column="10">
-    <widget class="QLabel" name="Label7">
+   <item row="0" column="0" colspan="2">
+    <widget class="QLabel" name="Label10">
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
      <property name="text">
-      <string>Format</string>
+      <string>Input Stream</string>
      </property>
     </widget>
    </item>
-   <item row="6" column="4" colspan="4">
-    <widget class="QDoubleSpinBox" name="NmeaPos1">
-     <property name="decimals">
-      <number>9</number>
+   <item row="0" column="5" colspan="2">
+    <widget class="QLabel" name="Label5">
+     <property name="enabled">
+      <bool>true</bool>
      </property>
-     <property name="minimum">
-      <double>-180.000000000000000</double>
+     <property name="toolTip">
+      <string/>
      </property>
-     <property name="maximum">
-      <double>180.000000000000000</double>
+     <property name="text">
+      <string>Type</string>
      </property>
     </widget>
    </item>
-   <item row="11" column="0" colspan="12">
-    <widget class="QLineEdit" name="FilePath3">
+   <item row="0" column="7" colspan="2">
+    <widget class="QLabel" name="Label6">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -58,12 +52,12 @@
       <string/>
      </property>
      <property name="text">
-      <string/>
+      <string>Opt</string>
      </property>
     </widget>
    </item>
-   <item row="9" column="0" colspan="12">
-    <widget class="QLineEdit" name="FilePath1">
+   <item row="0" column="9" colspan="2">
+    <widget class="QLabel" name="Label11">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -71,12 +65,12 @@
       <string/>
      </property>
      <property name="text">
-      <string/>
+      <string>Cmd</string>
      </property>
     </widget>
    </item>
-   <item row="9" column="13">
-    <widget class="QPushButton" name="BtnFile1">
+   <item row="0" column="12">
+    <widget class="QLabel" name="Label7">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -84,12 +78,12 @@
       <string/>
      </property>
      <property name="text">
-      <string>...</string>
+      <string>Format</string>
      </property>
     </widget>
    </item>
-   <item row="3" column="13">
-    <widget class="QPushButton" name="BtnRcvOpt3">
+   <item row="0" column="13">
+    <widget class="QLabel" name="Label1">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -97,12 +91,22 @@
       <string/>
      </property>
      <property name="text">
-      <string>...</string>
+      <string>Opt</string>
      </property>
     </widget>
    </item>
-   <item row="6" column="0" colspan="4">
-    <widget class="QComboBox" name="NmeaReqL">
+   <item row="1" column="0" colspan="4">
+    <widget class="QCheckBox" name="StreamC1">
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>(1) Rover</string>
+     </property>
+    </widget>
+   </item>
+   <item row="1" column="4" colspan="4">
+    <widget class="QComboBox" name="Stream1">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -111,23 +115,33 @@
      </property>
      <item>
       <property name="text">
-       <string>OFF</string>
+       <string>Serial</string>
       </property>
      </item>
      <item>
       <property name="text">
-       <string>Latitude/Longitude</string>
+       <string>TCP Client</string>
       </property>
      </item>
      <item>
       <property name="text">
-       <string>Single Solution</string>
+       <string>TCP Server</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>NTRIP Client</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>File</string>
       </property>
      </item>
     </widget>
    </item>
-   <item row="1" column="13">
-    <widget class="QPushButton" name="BtnRcvOpt1">
+   <item row="1" column="8">
+    <widget class="QPushButton" name="BtnStr1">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -139,31 +153,21 @@
      </property>
     </widget>
    </item>
-   <item row="3" column="10">
-    <widget class="QComboBox" name="Format3">
+   <item row="1" column="9" colspan="2">
+    <widget class="QPushButton" name="BtnCmd1">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-    </widget>
-   </item>
-   <item row="6" column="8" colspan="2">
-    <widget class="QDoubleSpinBox" name="NmeaPos2">
-     <property name="decimals">
-      <number>9</number>
-     </property>
-     <property name="minimum">
-      <double>-180.000000000000000</double>
-     </property>
-     <property name="maximum">
-      <double>180.000000000000000</double>
+     <property name="text">
+      <string>...</string>
      </property>
     </widget>
    </item>
-   <item row="2" column="10">
-    <widget class="QComboBox" name="Format2">
+   <item row="1" column="11" colspan="2">
+    <widget class="QComboBox" name="Format1">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -172,62 +176,30 @@
      </property>
     </widget>
    </item>
-   <item row="6" column="10">
-    <widget class="QDoubleSpinBox" name="NmeaPos3">
-     <property name="decimals">
-      <number>3</number>
-     </property>
-     <property name="maximum">
-      <double>8000.000000000000000</double>
-     </property>
-    </widget>
-   </item>
-   <item row="1" column="10">
-    <widget class="QComboBox" name="Format1">
+   <item row="1" column="13">
+    <widget class="QPushButton" name="BtnRcvOpt1">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
+     <property name="text">
+      <string>...</string>
+     </property>
     </widget>
    </item>
-   <item row="1" column="4" colspan="3">
-    <widget class="QComboBox" name="Stream1">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
+   <item row="2" column="0" colspan="4">
+    <widget class="QCheckBox" name="StreamC2">
      <property name="toolTip">
       <string/>
      </property>
-     <item>
-      <property name="text">
-       <string>Serial</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>TCP Client</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>TCP Server</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>NTRIP Client</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>File</string>
-      </property>
-     </item>
+     <property name="text">
+      <string>(2) Base Station</string>
+     </property>
     </widget>
    </item>
-   <item row="2" column="4" colspan="3">
+   <item row="2" column="4" colspan="4">
     <widget class="QComboBox" name="Stream2">
      <property name="enabled">
       <bool>true</bool>
@@ -262,7 +234,7 @@
      </item>
     </widget>
    </item>
-   <item row="2" column="7">
+   <item row="2" column="8">
     <widget class="QPushButton" name="BtnStr2">
      <property name="enabled">
       <bool>true</bool>
@@ -275,8 +247,8 @@
      </property>
     </widget>
    </item>
-   <item row="6" column="13">
-    <widget class="QPushButton" name="BtnPos">
+   <item row="2" column="9" colspan="2">
+    <widget class="QPushButton" name="BtnCmd2">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -288,34 +260,14 @@
      </property>
     </widget>
    </item>
-   <item row="1" column="0" colspan="4">
-    <widget class="QCheckBox" name="StreamC1">
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="text">
-      <string>(1) Rover</string>
-     </property>
-    </widget>
-   </item>
-   <item row="13" column="11" colspan="3">
-    <widget class="QPushButton" name="BtnCancel">
+   <item row="2" column="11" colspan="2">
+    <widget class="QComboBox" name="Format2">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text">
-      <string>&amp;Cancel</string>
-     </property>
-    </widget>
-   </item>
-   <item row="13" column="4">
-    <widget class="QLabel" name="LabelF2">
-     <property name="text">
-      <string>s</string>
-     </property>
     </widget>
    </item>
    <item row="2" column="13">
@@ -331,21 +283,18 @@
      </property>
     </widget>
    </item>
-   <item row="2" column="8" colspan="2">
-    <widget class="QPushButton" name="BtnCmd2">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
+   <item row="3" column="0" colspan="4">
+    <widget class="QCheckBox" name="StreamC3">
      <property name="toolTip">
       <string/>
      </property>
      <property name="text">
-      <string>...</string>
+      <string>(3) Correction</string>
      </property>
     </widget>
    </item>
-   <item row="13" column="1">
-    <widget class="QComboBox" name="TimeSpeedL">
+   <item row="3" column="4" colspan="4">
+    <widget class="QComboBox" name="Stream3">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -354,48 +303,43 @@
      </property>
      <item>
       <property name="text">
-       <string/>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>x0.1</string>
+       <string>Serial</string>
       </property>
      </item>
      <item>
       <property name="text">
-       <string>x0.2</string>
+       <string>TCP Client</string>
       </property>
      </item>
      <item>
       <property name="text">
-       <string>x0.5</string>
+       <string>TCP Server</string>
       </property>
      </item>
      <item>
       <property name="text">
-       <string>x1</string>
+       <string>NTRIP Client</string>
       </property>
      </item>
      <item>
       <property name="text">
-       <string>x2</string>
+       <string>File</string>
       </property>
      </item>
      <item>
       <property name="text">
-       <string>x5</string>
+       <string>FTP</string>
       </property>
      </item>
      <item>
       <property name="text">
-       <string>x10</string>
+       <string>HTTP</string>
       </property>
      </item>
     </widget>
    </item>
-   <item row="13" column="2">
-    <widget class="QLabel" name="LabelF3">
+   <item row="3" column="8">
+    <widget class="QPushButton" name="BtnStr3">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -403,50 +347,35 @@
       <string/>
      </property>
      <property name="text">
-      <string>+</string>
+      <string>...</string>
      </property>
     </widget>
    </item>
-   <item row="4" column="0" colspan="6">
-    <widget class="QLabel" name="LabelNmea">
+   <item row="3" column="9" colspan="2">
+    <widget class="QPushButton" name="BtnCmd3">
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
      <property name="text">
-      <string>Transmit NMEA GPGGA to Base Station</string>
+      <string>...</string>
      </property>
     </widget>
    </item>
-   <item row="13" column="6" colspan="5">
-    <widget class="QPushButton" name="BtnOk">
+   <item row="3" column="11" colspan="2">
+    <widget class="QComboBox" name="Format3">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text">
-      <string>&amp;OK</string>
-     </property>
-     <property name="autoDefault">
-      <bool>true</bool>
-     </property>
-     <property name="default">
-      <bool>true</bool>
-     </property>
     </widget>
    </item>
-   <item row="10" column="13">
-    <widget class="QPushButton" name="BtnFile2">
+   <item row="3" column="13">
+    <widget class="QPushButton" name="BtnRcvOpt3">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -458,8 +387,8 @@
      </property>
     </widget>
    </item>
-   <item row="10" column="0" colspan="12">
-    <widget class="QLineEdit" name="FilePath2">
+   <item row="4" column="0" colspan="7">
+    <widget class="QLabel" name="LabelNmea">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -467,95 +396,79 @@
       <string/>
      </property>
      <property name="text">
-      <string/>
+      <string>Transmit NMEA GPGGA to Base Station</string>
      </property>
     </widget>
    </item>
-   <item row="0" column="0" colspan="2">
-    <widget class="QLabel" name="Label10">
+   <item row="5" column="0" colspan="4">
+    <widget class="QComboBox" name="NmeaReqL">
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text">
-      <string>Input Stream</string>
-     </property>
+     <item>
+      <property name="text">
+       <string>OFF</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>Latitude/Longitude</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>Single Solution</string>
+      </property>
+     </item>
     </widget>
    </item>
-   <item row="3" column="0" colspan="4">
-    <widget class="QCheckBox" name="StreamC3">
+   <item row="5" column="4" colspan="6">
+    <widget class="QLineEdit" name="NmeaPos1">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
      <property name="toolTip">
       <string/>
      </property>
      <property name="text">
-      <string>(3) Correction</string>
-     </property>
-    </widget>
-   </item>
-   <item row="13" column="3">
-    <widget class="QLineEdit" name="TimeStartE">
-     <property name="text">
-      <string>0</string>
+      <string>0.000000000</string>
      </property>
     </widget>
    </item>
-   <item row="0" column="8" colspan="2">
-    <widget class="QLabel" name="Label11">
+   <item row="5" column="10" colspan="3">
+    <widget class="QLineEdit" name="NmeaPos2">
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
      <property name="text">
-      <string>Cmd</string>
+      <string>0.000000000</string>
      </property>
     </widget>
    </item>
-   <item row="0" column="13">
-    <widget class="QLabel" name="Label1">
+   <item row="5" column="13">
+    <widget class="QPushButton" name="BtnPos">
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
      <property name="text">
-      <string>Opt</string>
+      <string>...</string>
      </property>
     </widget>
    </item>
-   <item row="8" column="0" colspan="2">
+   <item row="6" column="0" colspan="2">
     <widget class="QLabel" name="LabelF1">
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -564,8 +477,8 @@
      </property>
     </widget>
    </item>
-   <item row="11" column="13">
-    <widget class="QPushButton" name="BtnFile3">
+   <item row="7" column="0" colspan="13">
+    <widget class="QLineEdit" name="FilePath1">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -573,73 +486,38 @@
       <string/>
      </property>
      <property name="text">
-      <string>...</string>
-     </property>
-    </widget>
-   </item>
-   <item row="13" column="0">
-    <widget class="QCheckBox" name="TimeTagC">
-     <property name="toolTip">
       <string/>
      </property>
-     <property name="text">
-      <string>Time</string>
-     </property>
     </widget>
    </item>
-   <item row="0" column="4">
-    <widget class="QLabel" name="Label5">
+   <item row="7" column="13">
+    <widget class="QPushButton" name="BtnFile1">
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
      <property name="text">
-      <string>Type</string>
+      <string>...</string>
      </property>
     </widget>
    </item>
-   <item row="0" column="7">
-    <widget class="QLabel" name="Label6">
+   <item row="8" column="0" colspan="13">
+    <widget class="QLineEdit" name="FilePath2">
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
      <property name="text">
-      <string>Opt</string>
-     </property>
-    </widget>
-   </item>
-   <item row="1" column="7">
-    <widget class="QPushButton" name="BtnStr1">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="toolTip">
       <string/>
      </property>
-     <property name="text">
-      <string>...</string>
-     </property>
     </widget>
    </item>
-   <item row="1" column="8" colspan="2">
-    <widget class="QPushButton" name="BtnCmd1">
+   <item row="8" column="13">
+    <widget class="QPushButton" name="BtnFile2">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -651,8 +529,8 @@
      </property>
     </widget>
    </item>
-   <item row="3" column="7">
-    <widget class="QPushButton" name="BtnStr3">
+   <item row="9" column="0" colspan="13">
+    <widget class="QLineEdit" name="FilePath3">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -660,12 +538,12 @@
       <string/>
      </property>
      <property name="text">
-      <string>...</string>
+      <string/>
      </property>
     </widget>
    </item>
-   <item row="3" column="8" colspan="2">
-    <widget class="QPushButton" name="BtnCmd3">
+   <item row="9" column="13">
+    <widget class="QPushButton" name="BtnFile3">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -677,18 +555,18 @@
      </property>
     </widget>
    </item>
-   <item row="2" column="0" colspan="4">
-    <widget class="QCheckBox" name="StreamC2">
+   <item row="10" column="0">
+    <widget class="QCheckBox" name="TimeTagC">
      <property name="toolTip">
       <string/>
      </property>
      <property name="text">
-      <string>(2) Base Station</string>
+      <string>Time</string>
      </property>
     </widget>
    </item>
-   <item row="3" column="4" colspan="3">
-    <widget class="QComboBox" name="Stream3">
+   <item row="10" column="1">
+    <widget class="QComboBox" name="TimeSpeedL">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -697,116 +575,119 @@
      </property>
      <item>
       <property name="text">
-       <string>Serial</string>
+       <string/>
       </property>
      </item>
      <item>
       <property name="text">
-       <string>TCP Client</string>
+       <string>x0.1</string>
       </property>
      </item>
      <item>
       <property name="text">
-       <string>TCP Server</string>
+       <string>x0.2</string>
       </property>
      </item>
      <item>
       <property name="text">
-       <string>NTRIP Client</string>
+       <string>x0.5</string>
       </property>
      </item>
      <item>
       <property name="text">
-       <string>File</string>
+       <string>x1</string>
       </property>
      </item>
      <item>
       <property name="text">
-       <string>FTP</string>
+       <string>x2</string>
       </property>
      </item>
      <item>
       <property name="text">
-       <string>HTTP</string>
+       <string>x5</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>x10</string>
       </property>
      </item>
     </widget>
    </item>
-   <item row="7" column="0">
-    <widget class="QLabel" name="LabelResetCmd">
+   <item row="10" column="2">
+    <widget class="QLabel" name="LabelF3">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
      <property name="text">
-      <string>Reset Cmd</string>
+      <string>+</string>
      </property>
     </widget>
    </item>
-   <item row="7" column="10">
-    <widget class="QLabel" name="LabelMaxBL">
+   <item row="10" column="3" colspan="2">
+    <widget class="QLineEdit" name="TimeStartE">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
      <property name="text">
-      <string>MaxBaseline</string>
+      <string>0</string>
      </property>
     </widget>
    </item>
-   <item row="7" column="1" colspan="9">
-    <widget class="QLineEdit" name="EditResetCmd"/>
+   <item row="10" column="5">
+    <widget class="QLabel" name="LabelF2">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>s</string>
+     </property>
+    </widget>
    </item>
-   <item row="13" column="5">
-    <widget class="QCheckBox" name="Chk64Bit">
+   <item row="10" column="7" colspan="5">
+    <widget class="QPushButton" name="BtnOk">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
      <property name="text">
-      <string>64bit</string>
+      <string>&amp;OK</string>
+     </property>
+     <property name="autoDefault">
+      <bool>true</bool>
+     </property>
+     <property name="default">
+      <bool>true</bool>
      </property>
     </widget>
    </item>
-   <item row="7" column="13">
-    <widget class="QDoubleSpinBox" name="EditMaxBL">
-     <property name="suffix">
-      <string> km</string>
+   <item row="10" column="12" colspan="2">
+    <widget class="QPushButton" name="BtnCancel">
+     <property name="enabled">
+      <bool>true</bool>
      </property>
-     <property name="maximum">
-      <double>99999.990000000005239</double>
+     <property name="toolTip">
+      <string/>
      </property>
-     <property name="value">
-      <double>10.000000000000000</double>
+     <property name="text">
+      <string>&amp;Cancel</string>
      </property>
     </widget>
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>StreamC1</tabstop>
-  <tabstop>Stream1</tabstop>
-  <tabstop>BtnStr1</tabstop>
-  <tabstop>BtnCmd1</tabstop>
-  <tabstop>Format1</tabstop>
-  <tabstop>BtnRcvOpt1</tabstop>
-  <tabstop>StreamC2</tabstop>
-  <tabstop>Stream2</tabstop>
-  <tabstop>BtnStr2</tabstop>
-  <tabstop>BtnCmd2</tabstop>
-  <tabstop>Format2</tabstop>
-  <tabstop>BtnRcvOpt2</tabstop>
-  <tabstop>StreamC3</tabstop>
-  <tabstop>Stream3</tabstop>
-  <tabstop>BtnStr3</tabstop>
-  <tabstop>BtnCmd3</tabstop>
-  <tabstop>Format3</tabstop>
-  <tabstop>BtnRcvOpt3</tabstop>
-  <tabstop>NmeaReqL</tabstop>
-  <tabstop>NmeaPos1</tabstop>
-  <tabstop>NmeaPos2</tabstop>
-  <tabstop>NmeaPos3</tabstop>
-  <tabstop>BtnPos</tabstop>
-  <tabstop>FilePath1</tabstop>
-  <tabstop>BtnFile1</tabstop>
-  <tabstop>FilePath2</tabstop>
-  <tabstop>BtnFile2</tabstop>
-  <tabstop>FilePath3</tabstop>
-  <tabstop>BtnFile3</tabstop>
-  <tabstop>TimeTagC</tabstop>
-  <tabstop>TimeSpeedL</tabstop>
-  <tabstop>TimeStartE</tabstop>
-  <tabstop>BtnOk</tabstop>
-  <tabstop>BtnCancel</tabstop>
- </tabstops>
  <resources/>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/logstrdlg.cpp RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/logstrdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/logstrdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/logstrdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -14,7 +14,7 @@
 #include "keydlg.h"
 
 //---------------------------------------------------------------------------
-LogStrDialog::LogStrDialog(QWidget *parent)
+LogStrDialog::LogStrDialog(QWidget* parent)
     : QDialog(parent)
 {
     setupUi(this);
@@ -23,29 +23,29 @@
     serialOptDialog = new SerialOptDialog(this);
     tcpOptDialog = new TcpOptDialog(this);
 
-    QCompleter *fileCompleter = new QCompleter(this);
-    QFileSystemModel *fileModel = new QFileSystemModel(fileCompleter);
+    QCompleter *fileCompleter=new QCompleter(this);
+    QFileSystemModel *fileModel=new QFileSystemModel(fileCompleter);
     fileModel->setRootPath("");
     fileCompleter->setModel(fileModel);
     FilePath1->setCompleter(fileCompleter);
     FilePath2->setCompleter(fileCompleter);
     FilePath3->setCompleter(fileCompleter);
 
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnFile1, SIGNAL(clicked(bool)), this, SLOT(BtnFile1Click()));
-    connect(BtnFile2, SIGNAL(clicked(bool)), this, SLOT(BtnFile2Click()));
-    connect(BtnFile3, SIGNAL(clicked(bool)), this, SLOT(BtnFile3Click()));
-    connect(BtnKey, SIGNAL(clicked(bool)), this, SLOT(BtnKeyClick()));
-    connect(BtnStr1, SIGNAL(clicked(bool)), this, SLOT(BtnStr1Click()));
-    connect(BtnStr2, SIGNAL(clicked(bool)), this, SLOT(BtnStr2Click()));
-    connect(BtnStr3, SIGNAL(clicked(bool)), this, SLOT(BtnStr3Click()));
-    connect(Stream1, SIGNAL(currentIndexChanged(int)), this, SLOT(Stream1Change(int)));
-    connect(Stream2, SIGNAL(currentIndexChanged(int)), this, SLOT(Stream2Change(int)));
-    connect(Stream3, SIGNAL(currentIndexChanged(int)), this, SLOT(Stream3Change(int)));
-    connect(Stream1C, SIGNAL(clicked(bool)), this, SLOT(Stream1CClick()));
-    connect(Stream2C, SIGNAL(clicked(bool)), this, SLOT(Stream2CClick()));
-    connect(Stream3C, SIGNAL(clicked(bool)), this, SLOT(Stream3CClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnFile1,SIGNAL(clicked(bool)),this,SLOT(BtnFile1Click()));
+    connect(BtnFile2,SIGNAL(clicked(bool)),this,SLOT(BtnFile2Click()));
+    connect(BtnFile3,SIGNAL(clicked(bool)),this,SLOT(BtnFile3Click()));
+    connect(BtnKey,SIGNAL(clicked(bool)),this,SLOT(BtnKeyClick()));
+    connect(BtnStr1,SIGNAL(clicked(bool)),this,SLOT(BtnStr1Click()));
+    connect(BtnStr2,SIGNAL(clicked(bool)),this,SLOT(BtnStr2Click()));
+    connect(BtnStr3,SIGNAL(clicked(bool)),this,SLOT(BtnStr3Click()));
+    connect(Stream1,SIGNAL(currentIndexChanged(int)),this,SLOT(Stream1Change(int)));
+    connect(Stream2,SIGNAL(currentIndexChanged(int)),this,SLOT(Stream2Change(int)));
+    connect(Stream3,SIGNAL(currentIndexChanged(int)),this,SLOT(Stream3Change(int)));
+    connect(Stream1C,SIGNAL(clicked(bool)),this,SLOT(Stream1CClick()));
+    connect(Stream2C,SIGNAL(clicked(bool)),this,SLOT(Stream2CClick()));
+    connect(Stream3C,SIGNAL(clicked(bool)),this,SLOT(Stream3CClick()));
 
     SwapIntv->setValidator(new QDoubleValidator(this));
 }
@@ -54,51 +54,51 @@
 {
     if (event->spontaneous()) return;
 
-    Stream1C->setChecked(StreamC[0]);
-    Stream2C->setChecked(StreamC[1]);
-    Stream3C->setChecked(StreamC[2]);
-    Stream1->setCurrentIndex(Stream[0]);
-    Stream2->setCurrentIndex(Stream[1]);
-    Stream3->setCurrentIndex(Stream[2]);
+    Stream1C ->setChecked(StreamC[0]);
+    Stream2C ->setChecked(StreamC[1]);
+    Stream3C ->setChecked(StreamC[2]);
+    Stream1  ->setCurrentIndex(Stream[0]);
+    Stream2  ->setCurrentIndex(Stream[1]);
+    Stream3  ->setCurrentIndex(Stream[2]);
     FilePath1->setText(GetFilePath(Paths[0][2]));
     FilePath2->setText(GetFilePath(Paths[1][2]));
     FilePath3->setText(GetFilePath(Paths[2][2]));
-    SwapIntv->insertItem(0, SwapInterval); SwapIntv->setCurrentIndex(0);
-    TimeTagC->setChecked(LogTimeTag);
+    SwapIntv ->insertItem(0,SwapInterval);SwapIntv->setCurrentIndex(0);
+    TimeTagC ->setChecked(LogTimeTag);
 
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
 void LogStrDialog::BtnOkClick()
 {
-    StreamC [0] = Stream1C->isChecked();
-    StreamC [1] = Stream2C->isChecked();
-    StreamC [2] = Stream3C->isChecked();
-    Stream  [0] = Stream1->currentIndex();
-    Stream  [1] = Stream2->currentIndex();
-    Stream  [2] = Stream3->currentIndex();
-    Paths[0][2] = SetFilePath(FilePath1->text());
-    Paths[1][2] = SetFilePath(FilePath2->text());
-    Paths[2][2] = SetFilePath(FilePath3->text());
-    SwapInterval = SwapIntv->currentText();
-    LogTimeTag = TimeTagC->isChecked();
+    StreamC [0]=Stream1C->isChecked();
+    StreamC [1]=Stream2C->isChecked();
+    StreamC [2]=Stream3C->isChecked();
+    Stream  [0]=Stream1 ->currentIndex();
+    Stream  [1]=Stream2 ->currentIndex();
+    Stream  [2]=Stream3 ->currentIndex();
+    Paths[0][2]=SetFilePath(FilePath1->text());
+    Paths[1][2]=SetFilePath(FilePath2->text());
+    Paths[2][2]=SetFilePath(FilePath3->text());
+    SwapInterval=SwapIntv->currentText();
+    LogTimeTag =TimeTagC->isChecked();
 
     accept();
 }
 //---------------------------------------------------------------------------
 void LogStrDialog::BtnFile1Click()
 {
-    FilePath1->setText(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, tr("Open..."), FilePath1->text())));
+    FilePath1->setText(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this,tr("Open..."),FilePath1->text())));
 }
 //---------------------------------------------------------------------------
 void LogStrDialog::BtnFile2Click()
 {
-    FilePath2->setText(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, tr("Open..."), FilePath2->text())));
+    FilePath2->setText(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this,tr("Open..."),FilePath2->text())));
 }
 //---------------------------------------------------------------------------
 void LogStrDialog::BtnFile3Click()
 {
-    FilePath3->setText(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, tr("Open..."), FilePath3->text())));
+    FilePath3->setText(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this,tr("Open..."),FilePath3->text())));
 }
 //---------------------------------------------------------------------------
 void LogStrDialog::Stream1Change(int)
@@ -139,111 +139,109 @@
 void LogStrDialog::BtnStr1Click()
 {
     switch (Stream1->currentIndex()) {
-    case 0: SerialOpt(0, 0); break;
-    case 1: TcpOpt(0, 1); break;
-    case 2: TcpOpt(0, 0); break;
-    case 3: TcpOpt(0, 2); break;
-    case 4: TcpOpt(0, 4); break;
-    }
+		case 0: SerialOpt(0,0); break;
+		case 1: TcpOpt(0,1); break;
+		case 2: TcpOpt(0,0); break;
+		case 3: TcpOpt(0,2); break;
+	}
 }
 //---------------------------------------------------------------------------
 void LogStrDialog::BtnStr2Click()
 {
     switch (Stream2->currentIndex()) {
-    case 0: SerialOpt(1, 0); break;
-    case 1: TcpOpt(1, 1); break;
-    case 2: TcpOpt(1, 0); break;
-    case 3: TcpOpt(1, 2); break;
-    case 4: TcpOpt(0, 4); break;
+		case 0: SerialOpt(1,0); break;
+		case 1: TcpOpt(1,1); break;
+		case 2: TcpOpt(1,0); break;
+		case 3: TcpOpt(1,2); break;
 	}
 }
 //---------------------------------------------------------------------------
 void LogStrDialog::BtnStr3Click()
 {
     switch (Stream3->currentIndex()) {
-    case 0: SerialOpt(2, 0); break;
-    case 1: TcpOpt(2, 1); break;
-    case 2: TcpOpt(2, 0); break;
-    case 3: TcpOpt(2, 2); break;
-    case 4: TcpOpt(0, 4); break;
-    }
+		case 0: SerialOpt(2,0); break;
+		case 1: TcpOpt(2,1); break;
+		case 2: TcpOpt(2,0); break;
+		case 3: TcpOpt(2,2); break;
+	}
 }
 //---------------------------------------------------------------------------
 QString LogStrDialog::GetFilePath(const QString &path)
 {
     QString file;
-
-    file = path.mid(0, path.indexOf("::"));
+    file=path.mid(0,path.indexOf("::"));
 
     return file;
 }
 //---------------------------------------------------------------------------
 QString LogStrDialog::SetFilePath(const QString &p)
 {
-    QString path = p;
+    QString path=p;
     QString str;
     bool okay;
 
-    if (TimeTagC->isChecked()) path += "::T";
-    str = SwapIntv->currentText();
+    if (TimeTagC->isChecked()) path+="::T";
+    str=SwapIntv->currentText();
     str.toDouble(&okay);
-    if (okay) path += "::S=" + str;
+    if (okay) {
+		path+="::S="+str;
+	}
 	return path;
 }
 //---------------------------------------------------------------------------
 void LogStrDialog::SerialOpt(int index, int opt)
 {
-    serialOptDialog->Path = Paths[index][0];
-    serialOptDialog->Opt = opt;
+    serialOptDialog->Path=Paths[index][0];
+    serialOptDialog->Opt=opt;
 
     serialOptDialog->exec();
-    if (serialOptDialog->result() != QDialog::Accepted) return;
+    if (serialOptDialog->result()!=QDialog::Accepted) return;
 
-    Paths[index][0] = serialOptDialog->Path;
+    Paths[index][0]=serialOptDialog->Path;
 }
 //---------------------------------------------------------------------------
 void LogStrDialog::TcpOpt(int index, int opt)
 {
-    tcpOptDialog->Path = Paths[index][1];
-    tcpOptDialog->Opt = opt;
-    for (int i = 0; i < 10; i++) {
-        tcpOptDialog->History[i] = History[i];
-        tcpOptDialog->MntpHist[i] = MntpHist[i];
+    tcpOptDialog->Path=Paths[index][1];
+    tcpOptDialog->Opt=opt;
+	for (int i=0;i<10;i++) {
+        tcpOptDialog->History[i]=History[i];
+        tcpOptDialog->MntpHist[i]=MntpHist[i];
 	}
     tcpOptDialog->exec();
-    if (tcpOptDialog->result() != QDialog::Accepted) return;
+    if (tcpOptDialog->result()!=QDialog::Accepted) return;
 
-    Paths[index][1] = tcpOptDialog->Path;
-    for (int i = 0; i < 10; i++) {
-        History[i] = tcpOptDialog->History[i];
-        MntpHist[i] = tcpOptDialog->MntpHist[i];
+    Paths[index][1]=tcpOptDialog->Path;
+	for (int i=0;i<10;i++) {
+        History[i]=tcpOptDialog->History[i];
+        MntpHist[i]=tcpOptDialog->MntpHist[i];
 	}
 }
 //---------------------------------------------------------------------------
 void LogStrDialog::UpdateEnable(void)
 {
-    int ena = (Stream1C->isChecked() && Stream1->currentIndex() == 5) ||
-          (Stream2C->isChecked() && Stream2->currentIndex() == 5) ||
-          (Stream3C->isChecked() && Stream3->currentIndex() == 5);
+    int ena=(Stream1C->isChecked()&&Stream1->currentIndex()==4)||
+            (Stream2C->isChecked()&&Stream2->currentIndex()==4)||
+            (Stream3C->isChecked()&&Stream3->currentIndex()==4);
 
-    Stream1->setEnabled(Stream1C->isChecked());
-    Stream2->setEnabled(Stream2C->isChecked());
-    Stream3->setEnabled(Stream3C->isChecked());
-    BtnStr1->setEnabled(Stream1C->isChecked() && Stream1->currentIndex() <= 4);
-    BtnStr2->setEnabled(Stream2C->isChecked() && Stream2->currentIndex() <= 4);
-    BtnStr3->setEnabled(Stream3C->isChecked() && Stream3->currentIndex() <= 4);
-    FilePath1->setEnabled(Stream1C->isChecked() && Stream1->currentIndex() == 5);
-    FilePath2->setEnabled(Stream2C->isChecked() && Stream2->currentIndex() == 5);
-    FilePath3->setEnabled(Stream3C->isChecked() && Stream3->currentIndex() == 5);
-    BtnFile1->setEnabled(Stream1C->isChecked() && Stream1->currentIndex() == 5);
-    BtnFile2->setEnabled(Stream2C->isChecked() && Stream2->currentIndex() == 5);
-    BtnFile3->setEnabled(Stream3C->isChecked() && Stream3->currentIndex() == 5);
-    Label1->setEnabled(ena);
-    Label2->setEnabled(ena);
-    LabelF1->setEnabled(ena);
-    TimeTagC->setEnabled(ena);
-    SwapIntv->setEnabled(ena);
-    BtnKey->setEnabled(ena);
+    Stream1  ->setEnabled(Stream1C->isChecked());
+    Stream2  ->setEnabled(Stream2C->isChecked());
+    Stream3  ->setEnabled(Stream3C->isChecked());
+    BtnStr1  ->setEnabled(Stream1C->isChecked()&&Stream1->currentIndex()<=3);
+    BtnStr2  ->setEnabled(Stream2C->isChecked()&&Stream2->currentIndex()<=3);
+    BtnStr3  ->setEnabled(Stream3C->isChecked()&&Stream3->currentIndex()<=3);
+    FilePath1->setEnabled(Stream1C->isChecked()&&Stream1->currentIndex()==4);
+    FilePath2->setEnabled(Stream2C->isChecked()&&Stream2->currentIndex()==4);
+    FilePath3->setEnabled(Stream3C->isChecked()&&Stream3->currentIndex()==4);
+    BtnFile1 ->setEnabled(Stream1C->isChecked()&&Stream1->currentIndex()==4);
+    BtnFile2 ->setEnabled(Stream2C->isChecked()&&Stream2->currentIndex()==4);
+    BtnFile3 ->setEnabled(Stream3C->isChecked()&&Stream3->currentIndex()==4);
+    Label1   ->setEnabled(ena);
+    Label2   ->setEnabled(ena);
+    LabelF1  ->setEnabled(ena);
+    TimeTagC ->setEnabled(ena);
+    SwapIntv ->setEnabled(ena);
+    BtnKey   ->setEnabled(ena);
     OutEventC->setEnabled(FilePath1->isEnabled());
 }
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/logstrdlg.h RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/logstrdlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/logstrdlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/logstrdlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -47,9 +47,9 @@
     void UpdateEnable(void);
 
 public:
-    int StreamC[3], Stream[3], LogTimeTag, LogAppend;
-    QString Paths[3][4], SwapInterval;
-    QString History[10], MntpHist[10];
+	int StreamC[3],Stream[3],LogTimeTag,LogAppend;
+    QString Paths[3][4],SwapInterval;
+    QString History[10],MntpHist[10];
 
     explicit LogStrDialog(QWidget* parent);
 };
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/logstrdlg.ui RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/logstrdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/logstrdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/logstrdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,7 +6,7 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>613</width>
+    <width>542</width>
     <height>307</height>
    </rect>
   </property>
@@ -22,12 +22,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -51,17 +45,11 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
      <property name="text">
-      <string>Opt</string>
+      <string>Option</string>
      </property>
     </widget>
    </item>
@@ -95,11 +83,6 @@
      </item>
      <item>
       <property name="text">
-       <string>NTRIP Caster</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
        <string>File</string>
       </property>
      </item>
@@ -135,11 +118,6 @@
      </item>
      <item>
       <property name="text">
-       <string>NTRIP Caster</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
        <string>File</string>
       </property>
      </item>
@@ -311,12 +289,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -330,12 +302,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -374,11 +340,6 @@
      </item>
      <item>
       <property name="text">
-       <string>NTRIP Caster</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
        <string>File</string>
       </property>
      </item>
@@ -503,29 +464,6 @@
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>Stream1C</tabstop>
-  <tabstop>Stream1</tabstop>
-  <tabstop>BtnStr1</tabstop>
-  <tabstop>OutEventC</tabstop>
-  <tabstop>Stream2C</tabstop>
-  <tabstop>Stream2</tabstop>
-  <tabstop>BtnStr2</tabstop>
-  <tabstop>Stream3C</tabstop>
-  <tabstop>Stream3</tabstop>
-  <tabstop>BtnStr3</tabstop>
-  <tabstop>FilePath1</tabstop>
-  <tabstop>BtnFile1</tabstop>
-  <tabstop>FilePath2</tabstop>
-  <tabstop>BtnFile2</tabstop>
-  <tabstop>FilePath3</tabstop>
-  <tabstop>BtnFile3</tabstop>
-  <tabstop>TimeTagC</tabstop>
-  <tabstop>SwapIntv</tabstop>
-  <tabstop>BtnKey</tabstop>
-  <tabstop>BtnOk</tabstop>
-  <tabstop>BtnCancel</tabstop>
- </tabstops>
  <resources/>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/main.cpp RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/main.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/main.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/main.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -5,7 +5,6 @@
 {
     QApplication a(argc, argv);
     MainWindow w;
-
     w.show();
 
     return a.exec();
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/markdlg.cpp RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/markdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/markdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/markdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -5,31 +5,23 @@
 #include "rtklib.h"
 #include "keydlg.h"
 #include "markdlg.h"
-#include "refdlg.h"
-#include "naviopt.h"
-#include "navimain.h"
 
 extern rtksvr_t rtksvr;
 
 //---------------------------------------------------------------------------
-QMarkDialog::QMarkDialog(QWidget *parent)
+QMarkDialog::QMarkDialog(QWidget* parent)
     : QDialog(parent)
 {
     setupUi(this);
-    NMark = 1;
-    FixPos[0]=FixPos[1]=FixPos[2]=0.0;
-    Label1->setText(QString("%%r=%1").arg(NMark, 3, 10, QLatin1Char('0')));
+    NMark=1;
+    Label1->setText(QString("%%r=%1").arg(NMark,3,10,QLatin1Char('0')));
 
-    connect(BtnRepDlg, SIGNAL(clicked(bool)), this, SLOT(BtnRepDlgClick()));
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(BtnCancelClick()));
-    connect(ChkMarkerName, SIGNAL(clicked(bool)), this, SLOT(ChkMarkerNameClick()));
-    connect(RadioGo,SIGNAL(toggled(bool)),this,SLOT(RadioClick()));
-    connect(RadioStop,SIGNAL(toggled(bool)),this,SLOT(RadioClick()));
-    connect(RadioFix,SIGNAL(toggled(bool)),this,SLOT(RadioClick()));
-    connect(BtnPos,SIGNAL(clicked(bool)),this,SLOT(BtnPosClick()));
+    connect(BtnRepDlg,SIGNAL(clicked(bool)),this,SLOT(BtnRepDlgClick()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(BtnCancelClick()));
+    connect(ChkMarkerName,SIGNAL(clicked(bool)),this,SLOT(ChkMarkerNameClick()));
 
-    keyDialog = new KeyDialog(this);
+    keyDialog=new KeyDialog(this);
 }
 //---------------------------------------------------------------------------
 void QMarkDialog::BtnCancelClick()
@@ -39,36 +31,34 @@
 //---------------------------------------------------------------------------
 void QMarkDialog::BtnOkClick()
 {
-    QString marker = MarkerName->currentText();
-    QString comment = MarkerComment->text();
+    QString marker=MarkerName->currentText();
+    QString comment=MarkerComment->text();
     char str2[1024];
-
+	
     if (RadioGo->isChecked()) {
-        if (PosMode == PMODE_STATIC || PosMode == PMODE_FIXED)
-            PosMode = PMODE_KINEMA;
-        else if (PosMode == PMODE_PPP_STATIC || PosMode == PMODE_PPP_FIXED)
-            PosMode = PMODE_PPP_KINEMA;
-    } else if (RadioStop->isChecked()) {
-        if (PosMode == PMODE_KINEMA || PosMode == PMODE_FIXED)
-            PosMode = PMODE_STATIC;
-        else if (PosMode == PMODE_PPP_KINEMA || PosMode == PMODE_PPP_FIXED)
-            PosMode = PMODE_PPP_STATIC;
-    } else if (RadioFix->isChecked()) {
-        if (PosMode == PMODE_KINEMA || PosMode == PMODE_STATIC) {
-            PosMode = PMODE_FIXED;
-        }
-        else if (PosMode == PMODE_PPP_KINEMA || PosMode == PMODE_PPP_STATIC) {
-            PosMode = PMODE_PPP_FIXED;
-        }
-    }
+		if (PosMode==PMODE_STATIC) {
+			PosMode=PMODE_KINEMA;
+		}
+		else if (PosMode==PMODE_PPP_STATIC) {
+			PosMode=PMODE_PPP_KINEMA;
+		}
+	}
+    else if (RadioStop->isChecked()) {
+		if (PosMode==PMODE_KINEMA) {
+			PosMode=PMODE_STATIC;
+		}
+		else if (PosMode==PMODE_PPP_KINEMA) {
+			PosMode=PMODE_PPP_STATIC;
+		}
+	}
     if (ChkMarkerName->isChecked()) {
-        reppath(qPrintable(marker), str2, utc2gpst(timeget()), qPrintable(QString("%1").arg(NMark, 3, 10, QChar('0'))), "");
-        rtksvrmark(&rtksvr, str2, qPrintable(comment));
+        reppath(qPrintable(marker),str2,utc2gpst(timeget()),qPrintable(QString("%1").arg(NMark,3,10,QChar('0'))),"");
+        rtksvrmark(&rtksvr,str2,qPrintable(comment));
         NMark++;
-        Label1->setText(QString("%%r=%1").arg(NMark, 3, 10, QLatin1Char('0')));
-	}
-    Marker = marker;
-    Comment = comment;
+        Label1->setText(QString("%%r=%1").arg(NMark,3,10,QLatin1Char('0')));
+    }
+    Marker=marker;
+    Comment=comment;
 }
 //---------------------------------------------------------------------------
 
@@ -81,32 +71,26 @@
 {
     if (event->spontaneous()) return;
 
-    if (PosMode == PMODE_STATIC || PosMode == PMODE_PPP_STATIC) {
+    if (PosMode==PMODE_STATIC||PosMode==PMODE_PPP_STATIC) {
         RadioStop->setChecked(true);
-    } else if (PosMode == PMODE_KINEMA || PosMode == PMODE_PPP_KINEMA) {
+	}
+	else if (PosMode==PMODE_KINEMA||PosMode==PMODE_PPP_KINEMA) {
         RadioGo->setChecked(true);
-    } else {
+	}
+	else {
         RadioStop->setChecked(false);
-        RadioGo->setChecked(false);
+        RadioGo  ->setChecked(false);
 	}
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
 void QMarkDialog::UpdateEnable(void)
 {
-    bool ena = PosMode == PMODE_STATIC || PosMode == PMODE_PPP_STATIC ||
-           PosMode == PMODE_KINEMA || PosMode == PMODE_PPP_KINEMA ||
-           PosMode == PMODE_FIXED || PosMode == PMODE_PPP_FIXED;
-
+	bool ena=PosMode==PMODE_STATIC||PosMode==PMODE_PPP_STATIC||
+			 PosMode==PMODE_KINEMA||PosMode==PMODE_PPP_KINEMA;
     RadioStop->setEnabled(ena);
-    RadioGo->setEnabled(ena);
-    RadioFix->setEnabled(ena);
+    RadioGo  ->setEnabled(ena);
     LabelPosMode->setEnabled(ena);
-    EditLat->setEnabled(RadioFix->isChecked());
-    EditLon->setEnabled(RadioFix->isChecked());
-    EditHgt->setEnabled(RadioFix->isChecked());
-    BtnPos->setEnabled(RadioFix->isChecked());
-    LabelPos->setEnabled(RadioFix->isChecked());
     MarkerName->setEnabled(ChkMarkerName->isChecked());
 }
 //---------------------------------------------------------------------------
@@ -115,25 +99,3 @@
     keyDialog->setWindowTitle(tr("Key Replacement in Marker Name"));
     keyDialog->show();
 }
-//---------------------------------------------------------------------------
-void QMarkDialog::RadioClick()
-{
-    UpdateEnable();
-}
-//---------------------------------------------------------------------------
-void QMarkDialog::BtnPosClick()
-{
-    RefDialog *refDialog =  new RefDialog(this);
-
-    refDialog->Pos[0]=EditLat->value();
-    refDialog->Pos[1]=EditLon->value();
-    refDialog->Pos[2]=EditHgt->value();
-    refDialog->StaPosFile=mainForm->optDialog->StaPosFileF;
-
-    if (refDialog->result() != QDialog::Accepted) return;
-
-    EditLat->setValue(refDialog->Pos[0]);
-    EditLon->setValue(refDialog->Pos[1]);
-    EditHgt->setValue(refDialog->Pos[2]);
-}
-//---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/markdlg.h RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/markdlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/markdlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/markdlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -17,8 +17,6 @@
     void BtnOkClick();
     void ChkMarkerNameClick();
     void BtnRepDlgClick();
-    void RadioClick();
-    void BtnPosClick();
 
 protected:
     void showEvent(QShowEvent *);
@@ -28,9 +26,8 @@
     KeyDialog *keyDialog;
 
 public:
-    QString Marker, Comment;
-    int PosMode, NMark;
-    double FixPos[3];
+    QString Marker,Comment;
+    int PosMode,NMark;
 	
     explicit QMarkDialog(QWidget *parent);
 	
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/markdlg.ui RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/markdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/markdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/markdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>471</width>
-    <height>276</height>
+    <width>415</width>
+    <height>207</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -17,132 +17,97 @@
    <string/>
   </property>
   <layout class="QGridLayout" name="gridLayout">
-   <item row="0" column="4">
-    <widget class="QLabel" name="Label1">
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
-     <property name="text">
-      <string>%r=001</string>
-     </property>
-    </widget>
-   </item>
-   <item row="5" column="0">
-    <widget class="QRadioButton" name="RadioGo">
+   <item row="1" column="0" colspan="5">
+    <widget class="QComboBox" name="MarkerName">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="layoutDirection">
-      <enum>Qt::LeftToRight</enum>
-     </property>
-     <property name="text">
-      <string>&amp;GO (Kinematic)</string>
-     </property>
-     <property name="checked">
-      <bool>false</bool>
-     </property>
-    </widget>
-   </item>
-   <item row="0" column="3">
-    <widget class="QPushButton" name="BtnRepDlg">
-     <property name="text">
-      <string>?</string>
-     </property>
-     <property name="flat">
+     <property name="editable">
       <bool>true</bool>
      </property>
     </widget>
    </item>
-   <item row="5" column="1">
-    <widget class="QRadioButton" name="RadioStop">
+   <item row="2" column="0">
+    <widget class="QLabel" name="Label2">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="layoutDirection">
-      <enum>Qt::LeftToRight</enum>
-     </property>
      <property name="text">
-      <string>STOP (Stati&amp;c)</string>
-     </property>
-     <property name="checked">
-      <bool>false</bool>
+      <string>Comment</string>
      </property>
     </widget>
    </item>
-   <item row="1" column="0" colspan="5">
-    <widget class="QComboBox" name="MarkerName">
+   <item row="3" column="0" colspan="5">
+    <widget class="QLineEdit" name="MarkerComment">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="editable">
-      <bool>true</bool>
+     <property name="text">
+      <string/>
      </property>
     </widget>
    </item>
-   <item row="2" column="0">
-    <widget class="QLabel" name="Label2">
+   <item row="4" column="0" colspan="2">
+    <widget class="QLabel" name="LabelPosMode">
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
      <property name="text">
-      <string>Comment</string>
+      <string>Switch Positioning Mode</string>
      </property>
     </widget>
    </item>
-   <item row="3" column="0" colspan="5">
-    <widget class="QLineEdit" name="MarkerComment">
+   <item row="4" column="2" colspan="2">
+    <widget class="QRadioButton" name="RadioGo">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
+     <property name="layoutDirection">
+      <enum>Qt::LeftToRight</enum>
+     </property>
      <property name="text">
-      <string/>
+      <string>&amp;GO (Kinematic)</string>
+     </property>
+     <property name="checked">
+      <bool>false</bool>
      </property>
     </widget>
    </item>
-   <item row="4" column="0" colspan="2">
-    <widget class="QLabel" name="LabelPosMode">
+   <item row="4" column="4">
+    <widget class="QRadioButton" name="RadioStop">
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
+     <property name="layoutDirection">
+      <enum>Qt::LeftToRight</enum>
+     </property>
      <property name="text">
-      <string>Switch Positioning Mode</string>
+      <string>STOP (Stati&amp;c)</string>
+     </property>
+     <property name="checked">
+      <bool>false</bool>
      </property>
     </widget>
    </item>
-   <item row="8" column="1" colspan="2">
+   <item row="6" column="1" colspan="2">
     <widget class="QPushButton" name="BtnOk">
      <property name="enabled">
       <bool>true</bool>
@@ -161,7 +126,7 @@
      </property>
     </widget>
    </item>
-   <item row="8" column="3" colspan="2">
+   <item row="6" column="3" colspan="2">
     <widget class="QPushButton" name="BtnCancel">
      <property name="enabled">
       <bool>true</bool>
@@ -187,57 +152,25 @@
      </property>
     </widget>
    </item>
-   <item row="6" column="0" colspan="2">
-    <widget class="QLabel" name="LabelPos">
+   <item row="5" column="0">
+    <widget class="QLabel" name="Label1">
      <property name="text">
-      <string>Lat/Lon/Height (deg/m)</string>
+      <string>%r=001</string>
      </property>
     </widget>
    </item>
-   <item row="5" column="3">
-    <widget class="QRadioButton" name="RadioFix">
+   <item row="6" column="0">
+    <widget class="QPushButton" name="BtnRepDlg">
      <property name="text">
-      <string>FIX (Fixed)</string>
-     </property>
-    </widget>
-   </item>
-   <item row="7" column="1">
-    <widget class="QDoubleSpinBox" name="EditLon">
-     <property name="decimals">
-      <number>8</number>
-     </property>
-    </widget>
-   </item>
-   <item row="7" column="0">
-    <widget class="QDoubleSpinBox" name="EditLat">
-     <property name="decimals">
-      <number>8</number>
-     </property>
-    </widget>
-   </item>
-   <item row="7" column="3">
-    <widget class="QDoubleSpinBox" name="EditHgt">
-     <property name="decimals">
-      <number>4</number>
+      <string>?</string>
      </property>
-    </widget>
-   </item>
-   <item row="7" column="4">
-    <widget class="QPushButton" name="BtnPos">
-     <property name="text">
-      <string>...</string>
+     <property name="flat">
+      <bool>true</bool>
      </property>
     </widget>
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>ChkMarkerName</tabstop>
-  <tabstop>MarkerName</tabstop>
-  <tabstop>MarkerComment</tabstop>
-  <tabstop>BtnOk</tabstop>
-  <tabstop>BtnCancel</tabstop>
- </tabstops>
  <resources/>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/mondlg.cpp RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/mondlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/mondlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/mondlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -9,7 +9,7 @@
 
 //---------------------------------------------------------------------------
 
-#define SQRT(x)     ((x)<0.0||(x)!=(x)?0.0:sqrt(x))
+#define SQRT(x)     ((x)<0.0?sqrt(-(x)):sqrt(x))
 #define TOPMARGIN	2
 #define LEFTMARGIN	3
 #define MAXLINE		128
@@ -30,44 +30,40 @@
 extern stream_t monistr;	// monitor stream
 
 //---------------------------------------------------------------------------
-MonitorDialog::MonitorDialog(QWidget *parent)
+MonitorDialog::MonitorDialog(QWidget* parent)
     : QDialog(parent)
 {
     int i;
-
     setupUi(this);
+	
+    FontScale=physicalDpiX()*2;
 
-    FontScale = physicalDpiX() * 2;
-
-    ObsMode = 0;
-    ConFmt = -1;
-
-    for (i = 0; i <= MAXRCVFMT; i++) SelFmt->addItem(formatstrs[i]);
+    ScrollPos=0;
+	ObsMode=0;
+    ConFmt=-1;
+	
+	for (i=0;i<=MAXRCVFMT;i++) {
+        SelFmt->addItem(formatstrs[i]);
+	}
 
 	init_rtcm(&rtcm);
-    init_raw(&raw, -1);
+    init_raw(&raw,-1);
 
-    connect(BtnClear, SIGNAL(clicked(bool)), this, SLOT(BtnClearClick()));
-    connect(BtnClose, SIGNAL(clicked(bool)), this, SLOT(BtnCloseClick()));
-    connect(BtnDown, SIGNAL(clicked(bool)), this, SLOT(BtnDownClick()));
-    connect(Type, SIGNAL(currentIndexChanged(int)), this, SLOT(TypeChange(int)));
-    connect(SelFmt, SIGNAL(currentIndexChanged(int)), this, SLOT(SelFmtChange(int)));
-    connect(SelObs, SIGNAL(currentIndexChanged(int)), this, SLOT(SelObsChange(int)));
-    connect(&timer1, SIGNAL(timeout()), this, SLOT(Timer1Timer()));
-    connect(&timer2, SIGNAL(timeout()), this, SLOT(Timer2Timer()));
+    connect(BtnClear,SIGNAL(clicked(bool)),this,SLOT(BtnClearClick()));
+    connect(BtnClose,SIGNAL(clicked(bool)),this,SLOT(BtnCloseClick()));
+    connect(BtnDown,SIGNAL(clicked(bool)),this,SLOT(BtnDownClick()));
+    connect(Type,SIGNAL(currentIndexChanged(int)),this,SLOT(TypeChange(int)));
+    connect(SelFmt,SIGNAL(currentIndexChanged(int)),this,SLOT(SelFmtChange(int)));
+    connect(SelObs,SIGNAL(currentIndexChanged(int)),this,SLOT(SelObsChange(int)));
+    connect(&timer1,SIGNAL(timeout()),this,SLOT(Timer1Timer()));
+    connect(&timer2,SIGNAL(timeout()),this,SLOT(Timer2Timer()));
 
-    TypeF = Type->currentIndex();
+    TypeF=Type->currentIndex();
 
     timer1.start(1000);
     timer2.start(1000);
 }
 //---------------------------------------------------------------------------
-MonitorDialog::~MonitorDialog()
-{
-    free_raw(&raw);
-    free_rtcm(&rtcm);
-};
-//---------------------------------------------------------------------------
 void MonitorDialog::showEvent(QShowEvent *event)
 {
     if (event->spontaneous()) return;
@@ -79,8 +75,7 @@
 //---------------------------------------------------------------------------
 void MonitorDialog::closeEvent(QCloseEvent *event)
 {
-    timer1.stop();
-    timer2.stop();
+    if (event->spontaneous()) return;
 
     free_rtcm(&rtcm);
 	free_raw(&raw);
@@ -95,15 +90,15 @@
 void MonitorDialog::TypeChange(int)
 {
 	int index;
-
-    TypeF = Type->currentIndex();
-    index = TypeF - NMONITEM;
-
-    if (0 <= index) {
+	
+    TypeF=Type->currentIndex();
+	index=TypeF-NMONITEM;
+	
+	if (0<=index) {
 		rtksvrlock(&rtksvr);
-        if (index < 2) rtksvr.npb[index] = 0;
-        else if (index < 4) rtksvr.nsb[index - 2] = 0;
-        else rtksvr.rtk.neb = 0;
+		if      (index<2) rtksvr.npb[index  ]=0;
+		else if (index<4) rtksvr.nsb[index-2]=0;
+		else              rtksvr.rtk.neb=0;
 		rtksvrunlock(&rtksvr);
 	}
 	ClearTable();
@@ -114,207 +109,210 @@
 //---------------------------------------------------------------------------
 void MonitorDialog::SelFmtChange(int)
 {
-    char c[2] = "\n";
-
-    AddConsole((unsigned char *)c, 1, 1);
+    char c[2]="\n";
+    AddConsole((unsigned char*)c,1,1);
 
-    if (ConFmt >= 3 && ConFmt < 18)
+    if (ConFmt>=3&&ConFmt<17) {
         free_raw(&raw);
-    ConFmt = SelFmt->currentIndex();
+    }
+    ConFmt=SelFmt->currentIndex();
 
-    if (ConFmt >= 3 && ConFmt < 18)
-        init_raw(&raw, ConFmt - 2);
+    if (ConFmt>=3&&ConFmt<17) {
+        init_raw(&raw,ConFmt-2);
+    }
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::Timer1Timer()
 {
     if (!isVisible()) return;
 	switch (TypeF) {
-        case  0: ShowRtk();        break;
-        case  1: ShowObs();        break;
-        case  2: ShowNav(SYS_GPS); break;
-        case  3: ShowGnav();       break;
-        case  4: ShowNav(SYS_GAL); break;
-        case  5: ShowNav(SYS_QZS); break;
-        case  6: ShowNav(SYS_CMP); break;
-        case  7: ShowSbsNav();     break;
-        case  8: ShowIonUtc();     break;
-        case  9: ShowStr();        break;
-        case 10: ShowSat(SYS_GPS); break;
-        case 11: ShowSat(SYS_GLO); break;
-        case 12: ShowSat(SYS_GAL); break;
-        case 13: ShowSat(SYS_QZS); break;
-        case 14: ShowSat(SYS_CMP); break;
-        case 15: ShowSat(SYS_SBS); break;
-        case 16: ShowEst();        break;
-        case 17: ShowCov();        break;
-        case 18: ShowSbsMsg();     break;
-        case 19: ShowSbsLong();    break;
-        case 20: ShowSbsIono();    break;
-        case 21: ShowSbsFast();    break;
-        case 22: ShowRtcm();       break;
-        case 23: ShowRtcmDgps();   break;
-        case 24: ShowRtcmSsr();    break;
-        case 25: ShowLexMsg();     break;
-        case 26: ShowLexEph();     break;
-        case 27: ShowLexIon();     break;
-        case 28: ShowIonCorr();    break;
+		case  0: ShowRtk();        break;
+		case  1: ShowObs();        break;
+		case  2: ShowNav(SYS_GPS); break;
+		case  3: ShowGnav();       break;
+		case  4: ShowNav(SYS_GAL); break;
+		case  5: ShowNav(SYS_QZS); break;
+		case  6: ShowNav(SYS_CMP); break;
+		case  7: ShowSbsNav();     break;
+		case  8: ShowIonUtc();     break;
+		case  9: ShowStr();        break;
+		case 10: ShowSat(SYS_GPS); break;
+		case 11: ShowSat(SYS_GLO); break;
+		case 12: ShowSat(SYS_GAL); break;
+		case 13: ShowSat(SYS_QZS); break;
+		case 14: ShowSat(SYS_CMP); break;
+		case 15: ShowSat(SYS_SBS); break;
+		case 16: ShowEst();        break;
+		case 17: ShowCov();        break;
+		case 18: ShowSbsMsg();     break;
+		case 19: ShowSbsLong();    break;
+		case 20: ShowSbsIono();    break;
+		case 21: ShowSbsFast();    break;
+		case 22: ShowRtcm();       break;
+		case 23: ShowRtcmDgps();   break;
+		case 24: ShowRtcmSsr();    break;
+		case 25: ShowLexMsg();     break;
+		case 26: ShowLexEph();     break;
+		case 27: ShowLexIon();     break;
+		case 28: ShowIonCorr();    break;
 	}
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::ClearTable(void)
 {
-    int console = 0;
-
+	int console=0;
+	
 	switch (TypeF) {
-        case  0: SetRtk();      break;
-        case  1: SetObs();      break;
-        case  2: SetNav();      break;
-        case  3: SetGnav();     break;
-        case  4: SetNav();      break;
-        case  5: SetNav();      break;
-        case  6: SetNav();      break;
-        case  7: SetSbsNav();   break;
-        case  8: SetIonUtc();   break;
-        case  9: SetStr();      break;
-        case 10: SetSat();      break;
-        case 11: SetSat();      break;
-        case 12: SetSat();      break;
-        case 13: SetSat();      break;
-        case 14: SetSat();      break;
-        case 15: SetSat();      break;
-        case 16: SetEst();      break;
-        case 17: SetCov();      break;
-        case 18: SetSbsMsg();   break;
-        case 19: SetSbsLong();  break;
-        case 20: SetSbsIono();  break;
-        case 21: SetSbsFast();  break;
-        case 22: SetRtcm();     break;
-        case 23: SetRtcmDgps(); break;
-        case 24: SetRtcmSsr();  break;
-        case 25: SetLexMsg();   break;
-        case 26: SetLexEph();   break;
-        case 27: SetLexIon();   break;
-        case 28: SetIonCorr();  break;
-        default: console = 1;
-            Console->setColumnWidth(0, Console->width());
-            break;
+		case  0: SetRtk();      break;
+		case  1: SetObs();      break;
+		case  2: SetNav();      break;
+		case  3: SetGnav();     break;
+		case  4: SetNav();      break;
+		case  5: SetNav();      break;
+		case  6: SetNav();      break;
+		case  7: SetSbsNav();   break;
+		case  8: SetIonUtc();   break;
+		case  9: SetStr();      break;
+		case 10: SetSat();      break;
+		case 11: SetSat();      break;
+		case 12: SetSat();      break;
+		case 13: SetSat();      break;
+		case 14: SetSat();      break;
+		case 15: SetSat();      break;
+		case 16: SetEst();      break;
+		case 17: SetCov();      break;
+		case 18: SetSbsMsg();   break;
+		case 19: SetSbsLong();  break;
+		case 20: SetSbsIono();  break;
+		case 21: SetSbsFast();  break;
+		case 22: SetRtcm();     break;
+		case 23: SetRtcmDgps(); break;
+		case 24: SetRtcmSsr();  break;
+		case 25: SetLexMsg();   break;
+		case 26: SetLexEph();   break;
+		case 27: SetLexIon();   break;
+		case 28: SetIonCorr();  break;
+        default: console=1;
+                 Console->setColumnWidth(0,Console->width());
+                 break;
 	}
-    Console->setVisible(true);
-    BtnPause->setVisible(console != 0);
-    BtnDown->setVisible(console != 0);
-    BtnClear->setVisible(console != 0);
-    SelFmt->setVisible(NMONITEM <= TypeF && TypeF <= NMONITEM + 2);
-    SelObs->setVisible(TypeF == 1);
-    SelSat->setVisible((2 <= TypeF && TypeF <= 7) || (10 <= TypeF && TypeF <= 15));
-    SelStr->setVisible(TypeF == 18 || TypeF == 22 || TypeF == 24);
-    SelEph->setVisible(2 <= TypeF && TypeF <= 7);
-    SelIon->setVisible(TypeF == 28);
+    Console ->setVisible(true);
+    BtnPause->setVisible(console!=0);
+    BtnDown ->setVisible(console!=0);
+    BtnClear->setVisible(console!=0);
+    SelFmt  ->setVisible(NMONITEM<=TypeF&&TypeF<=NMONITEM+2);
+    SelObs  ->setVisible(TypeF==1);
+    SelSat  ->setVisible((2<=TypeF&&TypeF<=7)||(10<=TypeF&&TypeF<=15));
+    SelStr  ->setVisible(TypeF==18||TypeF==22||TypeF==24);
+    SelEph  ->setVisible(2<=TypeF&&TypeF<=7);
+    SelIon  ->setVisible(TypeF==28);
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::Timer2Timer()
 {
-    unsigned char *msg = 0;
-    int i, len, index = TypeF - NMONITEM;
-
-    if (index < 0 || 6 <= index) return;
-
+    unsigned char *msg=0;
+    int i,len,index=TypeF-NMONITEM;
+	
+	if (index<0||6<=index) return;
+	
 	rtksvrlock(&rtksvr);
-
-    if (index < 3) { // input buffer
-        len = rtksvr.npb[index];
-        if (len > 0 && (msg = (unsigned char *)malloc(size_t(len)))) {
-            memcpy(msg, rtksvr.pbuf[index], size_t(len));
-            rtksvr.npb[index] = 0;
+	
+	if (index<3) { // input buffer
+		len=rtksvr.npb[index];
+		if (len>0&&(msg=(unsigned char *)malloc(len))) {
+			memcpy(msg,rtksvr.pbuf[index],len);
+			rtksvr.npb[index]=0;
 		}
-    } else if (index < 5) { // solution buffer
-        len = rtksvr.nsb[index - 3];
-        if (len > 0 && (msg = (unsigned char *)malloc(size_t(len)))) {
-            memcpy(msg, rtksvr.sbuf[index - 3], size_t(len));
-            rtksvr.nsb[index - 3] = 0;
+	}
+	else if (index<5) { // solution buffer
+		len=rtksvr.nsb[index-3];
+		if (len>0&&(msg=(unsigned char *)malloc(len))) {
+			memcpy(msg,rtksvr.sbuf[index-3],len);
+			rtksvr.nsb[index-3]=0;
 		}
-    } else { // error message buffer
-        len = rtksvr.rtk.neb;
-        if (len > 0 && (msg = (unsigned char *)malloc(size_t(len)))) {
-            memcpy(msg, rtksvr.rtk.errbuf, size_t(len));
-            rtksvr.rtk.neb = 0;
+	}
+	else { // error message buffer
+		len=rtksvr.rtk.neb;
+		if (len>0&&(msg=(unsigned char *)malloc(len))) {
+			memcpy(msg,rtksvr.rtk.errbuf,len);
+			rtksvr.rtk.neb=0;
 		}
 	}
 	rtksvrunlock(&rtksvr);
-
-    if (len <= 0 || !msg) return;
-
-    rtcm.outtype = raw.outtype = 1;
-
-    if (ConFmt < 2 || index >= 3) {
-        AddConsole(msg, len, index < 3 ? ConFmt : 1);
-    } else if (ConFmt == 2) {
-        for (i = 0; i < len; i++) {
-            input_rtcm2(&rtcm, msg[i]);
+	
+	if (len<=0||!msg) return;
+	
+	rtcm.outtype=raw.outtype=1;
+	
+	if (ConFmt<2||index>=3) {
+        AddConsole(msg,len,index<3?ConFmt:1);
+	}
+	else if (ConFmt==2) {
+		for (i=0;i<len;i++) {
+			input_rtcm2(&rtcm,msg[i]);
 			if (rtcm.msgtype[0]) {
-                QString buff=QString("%1\n").arg(rtcm.msgtype);
-                AddConsole((unsigned char*)qPrintable(buff), buff.size(), 1);
-                rtcm.msgtype[0] = '\0';
+                AddConsole((unsigned char*)raw.msgtype,strlen(raw.msgtype),1);
+				rtcm.msgtype[0]='\0';
 			}
-        }
-    } else if (ConFmt == 3) {
-        for (i = 0; i < len; i++) {
-            input_rtcm3(&rtcm, msg[i]);
+	    }
+	}
+	else if (ConFmt==3) {
+		for (i=0;i<len;i++) {
+			input_rtcm3(&rtcm,msg[i]);
 			if (rtcm.msgtype[0]) {
-                QString buff=QString("%1\n").arg(rtcm.msgtype);
-                AddConsole((unsigned char*)qPrintable(buff), buff.size(), 1);
-                rtcm.msgtype[0] = '\0';
+                AddConsole((unsigned char*)raw.msgtype,strlen(raw.msgtype),1);
+                rtcm.msgtype[0]='\0';
 			}
-        }
-    } else if (ConFmt < 18) {
-        for (i = 0; i < len; i++) {
-            input_raw(&raw, ConFmt - 2, msg[i]);
+	    }
+	}
+    else if (ConFmt<17) {
+		for (i=0;i<len;i++) {
+			input_raw(&raw,ConFmt-2,msg[i]);
 			if (raw.msgtype[0]) {
-                QString buff=QString("%1\n").arg(raw.msgtype);
-                AddConsole((unsigned char*)qPrintable(buff), buff.size(), 1);
-                raw.msgtype[0] = '\0';
+                AddConsole((unsigned char*)raw.msgtype,strlen(raw.msgtype),1);
+                raw.msgtype[0]='\0';
 			}
-        }
+	    }
 	}
 	free(msg);
 }
 //---------------------------------------------------------------------------
-void MonitorDialog::AddConsole(const unsigned char *msg, int n, int mode)
+void MonitorDialog::AddConsole(unsigned char *msg, int n, int mode)
 {
-    char buff[MAXLEN + 16], *p = buff;
-
+    char buff[MAXLEN+16],*p=buff;
     if (BtnPause->isChecked()) return;
 
-    if (n <= 0) return;
+    if (n<=0) return;
 
-    if (ConBuff.count() == 0) ConBuff.append("");
-    p += sprintf(p, "%s", qPrintable(ConBuff.at(ConBuff.count() - 1)));
+    if (ConBuff.count()==0) ConBuff.append("");
+    p+=sprintf(p,"%s",qPrintable(ConBuff.at(ConBuff.count()-1)));
 
-    for (int i = 0; i < n; i++) {
-        if (mode) {
-            if (msg[i] == '\r') continue;
-            p += sprintf(p, "%c", msg[i] == '\n' || isprint(msg[i]) ? msg[i] : '.');
-        } else {
-            p += sprintf(p, "%s%02X", (p - buff) % 17 == 16 ? " " : "", msg[i]);
-            if (p - buff >= 67) p += sprintf(p, "\n");
-        }
-        if (p - buff >= MAXLEN) p += sprintf(p, "\n");
+    for (int i=0;i<n;i++) {
+            if (mode) {
+                    if (msg[i]=='\r') continue;
+                    p+=sprintf(p,"%c",msg[i]=='\n'||isprint(msg[i])?msg[i]:'.');
+            }
+            else {
+                    p+=sprintf(p,"%s%02X",(p-buff)%17==16?" ":"",msg[i]);
+                    if (p-buff>=67) p+=sprintf(p,"\n");
+            }
+            if (p-buff>=MAXLEN) p+=sprintf(p,"\n");
 
-        if (*(p - 1) == '\n') {
-            ConBuff[ConBuff.count() - 1] = buff;
-            ConBuff.append("");
-            *(p = buff) = 0;
-            if (ConBuff.count() >= MAXLINE) ConBuff.removeFirst();
-        }
+            if (*(p-1)=='\n') {
+                    ConBuff[ConBuff.count()-1]=buff;
+                    ConBuff.append("");
+                    *(p=buff)=0;
+                    if (ConBuff.count()>=MAXLINE) ConBuff.removeFirst();
+            }
     }
-    ConBuff[ConBuff.count() - 1] = buff;
+    ConBuff[ConBuff.count()-1]=buff;
 
     Console->setColumnCount(1);
     Console->setRowCount(ConBuff.size());
-    for (int i = 0; i < ConBuff.size(); i++)
-        Console->setItem(i, 0, new QTableWidgetItem(ConBuff.at(i)));
+    for (int i=0;i<ConBuff.size();i++)
+        Console->setItem(i,0, new QTableWidgetItem(ConBuff.at(i)));
 
-    if (BtnDown->isChecked()) Console->verticalScrollBar()->setValue(Console->verticalScrollBar()->maximum());
+    if (BtnDown->isDown()) ScrollPos=0;
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::BtnClearClick()
@@ -331,367 +329,367 @@
 //---------------------------------------------------------------------------
 void MonitorDialog::SelObsChange(int)
 {
-    ObsMode = SelObs->currentIndex();
+    ObsMode=SelObs->currentIndex();
 	SetObs();
 	ShowObs();
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::SetRtk(void)
 {
-    header << tr("Parameter") << tr("Value");
-    int width[] = { 220, 380 };
-
+    header<<tr("Parameter")<<tr("Value");
+    int width[]={220,380};
+	
     Console->setColumnCount(2);
     Console->setRowCount(56);
     Console->setHorizontalHeaderLabels(header);
 
-    for (int i = 0; i < Console->columnCount(); i++)
-        Console->setColumnWidth(i, width[i] * FontScale / 96);
+    for (int i=0;i<Console->columnCount();i++) {
+        Console->setColumnWidth(i,width[i]*FontScale/96);
+	}
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::ShowRtk(void)
 {
 	rtk_t rtk;
-    QString exsats, navsys = "";
-    const QString svrstate[] = { tr("Stop"), tr("Run") };
-    const QString sol[] = { tr("-"), tr("Fix"), tr("Float"), tr("SBAS"), tr("DGPS"), tr("Single"), tr("PPP"), "" };
-    const QString mode[] = { tr("Single"), tr("DGPS"),	      tr("Kinematic"),	tr("Static"), tr("Moving-Base"),
-               tr("Fixed"),	 tr("PPP-Kinematic"), tr("PPP-Static"), "" };
-    const QString freq[] = { tr("-"), tr("L1"), tr("L1+L2"), tr("L1+L2+L5"), tr("L1+L2+L5+L6"), tr("L1+L2+L5+L6+L7"), tr("L1+L2+L5+L6+L7+L8"), "" };
-    double *del, *off1, *off2, rt[3] = { 0 }, dop[4] = { 0 };
-    double azel[MAXSAT * 2], pos[3], vel[3];
-    int i, j, k, cycle, state, rtkstat, nsat0, nsat1, prcout, nave;
+    QString exsats,navsys="";
+    QString svrstate[]={tr("Stop"),tr("Run")};
+    QString sol[]={tr("-"),tr("Fix"),tr("Float"),tr("SBAS"),tr("DGPS"),tr("Single"),tr("PPP"),""};
+    QString mode[]={tr("Single"),tr("DGPS"),tr("Kinematic"),tr("Static"),tr("Moving-Base"),
+                       tr("Fixed"),tr("PPP-Kinematic"),tr("PPP-Static"),""};
+    QString freq[]={tr("-"),tr("L1"),tr("L1+L2"),tr("L1+L2+L5"),tr("L1+L2+L5+L6"),tr("L1+L2+L5+L6+L7"),tr("L1+L2+L5+L6+L7+L8"),""};
+    double *del,*off1,*off2,rt[3]={0},dop[4]={0};
+	double azel[MAXSAT*2],pos[3],vel[3];
+    int i,j,k,cycle,state,rtkstat,nsat0,nsat1,prcout,nave;
     unsigned long thread;
-    int cputime, nb[3] = { 0 }, ne;
-    unsigned int nmsg[3][10] = { { 0 } };
-    char tstr[64], id[32], s1[64] = "-", s2[64] = "-", s3[64] = "-";
-    char file[1024] = "";
-    const QString ionoopt[] = { tr("OFF"), tr("Broadcast"), tr("SBAS"), tr("Dual-Frequency"), tr("Estimate STEC"), tr("IONEX TEC"), tr("QZSS LEX"), "" };
-    const QString tropopt[] = { tr("OFF"), tr("Saastamoinen"), tr("SBAS"), tr("Estimate ZTD"), tr("Estimate ZTD+Grad"), "" };
-    const QString ephopt [] = { tr("Broadcast"), tr("Precise"), tr("Broadcast+SBAS"), tr("Broadcat+SSR APC"), tr("Broadcast+SSR CoM"), tr("QZSS LEX"), "" };
-
+	int cputime,nb[3]={0},nmsg[3][10]={{0}},ne;
+    char tstr[64],id[32],s1[64]="-",s2[64]="-",s3[64]="-";
+	char file[1024]="";
+    QString ionoopt[]={tr("OFF"),tr("Broadcast"),tr("SBAS"),tr("Dual-Frequency"),tr("Estimate STEC"),tr("IONEX TEC"),tr("QZSS LEX"),""};
+    QString tropopt[]={tr("OFF"),tr("Saastamoinen"),tr("SBAS"),tr("Estimate ZTD"),tr("Estimate ZTD+Grad"),""};
+    QString ephopt []={tr("Broadcast"),tr("Precise"),tr("Broadcast+SBAS"),tr("Broadcat+SSR APC"),tr("Broadcast+SSR CoM"),tr("QZSS LEX"),""};
+	
 	rtksvrlock(&rtksvr); // lock
+	
+	rtk=rtksvr.rtk;
+    thread=(unsigned long)rtksvr.thread;
+	cycle=rtksvr.cycle;
+	state=rtksvr.state;
+	rtkstat=rtksvr.rtk.sol.stat;
+	nsat0=rtksvr.obs[0][0].n;
+	nsat1=rtksvr.obs[1][0].n;
+	cputime=rtksvr.cputime;
+	prcout =rtksvr.prcout;
+    nave=rtksvr.nave;
 
-    rtk = rtksvr.rtk;
-    thread = (unsigned long)rtksvr.thread;
-    cycle = rtksvr.cycle;
-    state = rtksvr.state;
-    rtkstat = rtksvr.rtk.sol.stat;
-    nsat0 = rtksvr.obs[0][0].n;
-    nsat1 = rtksvr.obs[1][0].n;
-    cputime = rtksvr.cputime;
-    prcout = rtksvr.prcout;
-    nave = rtksvr.nave;
-
-    for (i = 0; i < 3; i++) nb[i] = rtksvr.nb[i];
-
-    for (i = 0; i < 3; i++) for (j = 0; j < 10; j++)
-            nmsg[i][j] = rtksvr.nmsg[i][j];
+	for (i=0;i<3;i++) nb[i]=rtksvr.nb[i];
 
+	for (i=0;i<3;i++) for (j=0;j<10;j++) {
+		nmsg[i][j]=rtksvr.nmsg[i][j];
+	}
 	if (rtksvr.state) {
         double runtime;
-        runtime = static_cast<double>(tickget() - rtksvr.tick) / 1000.0;
-        rt[0] = floor(runtime / 3600.0); runtime -= rt[0] * 3600.0;
-        rt[1] = floor(runtime / 60.0); rt[2] = runtime - rt[1] * 60.0;
+        runtime=static_cast<double>(tickget()-rtksvr.tick)/1000.0;
+		rt[0]=floor(runtime/3600.0); runtime-=rt[0]*3600.0;
+		rt[1]=floor(runtime/60.0); rt[2]=runtime-rt[1]*60.0;
 	}
-    if ((ne = rtksvr.nav.ne) > 0) {
-        time2str(rtksvr.nav.peph[0].time, s1, 0);
-        time2str(rtksvr.nav.peph[ne - 1].time, s2, 0);
-        time2str(rtksvr.ftime[2], s3, 0);
+	if ((ne=rtksvr.nav.ne)>0) {
+		time2str(rtksvr.nav.peph[   0].time,s1,0);
+		time2str(rtksvr.nav.peph[ne-1].time,s2,0);
+		time2str(rtksvr.ftime[2],s3,0);
 	}
-    strcpy(file, rtksvr.files[2]);
+	strcpy(file,rtksvr.files[2]);
 
 	rtksvrunlock(&rtksvr); // unlock
-
-    for (j = k = 0; j < MAXSAT; j++) {
-        if (rtk.opt.mode == PMODE_SINGLE && !rtk.ssat[j].vs) continue;
-        if (rtk.opt.mode != PMODE_SINGLE && !rtk.ssat[j].vsat[0]) continue;
-        azel[k * 2] = rtk.ssat[j].azel[0];
-        azel[1 + k * 2] = rtk.ssat[j].azel[1];
+	
+	for (j=k=0;j<MAXSAT;j++) {
+		if (rtk.opt.mode==PMODE_SINGLE&&!rtk.ssat[j].vs) continue;
+		if (rtk.opt.mode!=PMODE_SINGLE&&!rtk.ssat[j].vsat[0]) continue;
+		azel[  k*2]=rtk.ssat[j].azel[0];
+		azel[1+k*2]=rtk.ssat[j].azel[1];
 		k++;
 	}
-    dops(k, azel, 0.0, dop);
-
-    if (rtk.opt.navsys & SYS_GPS) navsys = navsys + tr("GPS ");
-    if (rtk.opt.navsys & SYS_GLO) navsys = navsys + tr("GLONASS ");
-    if (rtk.opt.navsys & SYS_GAL) navsys = navsys + tr("Galileo ");
-    if (rtk.opt.navsys & SYS_QZS) navsys = navsys + tr("QZSS ");
-    if (rtk.opt.navsys & SYS_SBS) navsys = navsys + tr("SBAS ");
-    if (rtk.opt.navsys & SYS_CMP) navsys = navsys + tr("BeiDou ");
-    if (rtk.opt.navsys & SYS_IRN) navsys = navsys + tr("IRNSS ");
+	dops(k,azel,0.0,dop);
+	
+    if (rtk.opt.navsys&SYS_GPS) navsys=navsys+tr("GPS ");
+    if (rtk.opt.navsys&SYS_GLO) navsys=navsys+tr("GLONASS ");
+    if (rtk.opt.navsys&SYS_GAL) navsys=navsys+tr("Galileo ");
+    if (rtk.opt.navsys&SYS_QZS) navsys=navsys+tr("QZSS ");
+    if (rtk.opt.navsys&SYS_SBS) navsys=navsys+tr("SBAS ");
+    if (rtk.opt.navsys&SYS_CMP) navsys=navsys+tr("BeiDou ");
+    if (rtk.opt.navsys&SYS_IRN) navsys=navsys+tr("IRNSS ");
 
     Label->setText("");
-    if (Console->rowCount() < 56) return;
+    if (Console->rowCount()<56) return;
     Console->setHorizontalHeaderLabels(header);
 
-    i = 0;
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("RTKLIB Version")));
-    Console->setItem(i++, 1, new QTableWidgetItem(VER_RTKLIB));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("RTK Server Thread")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(thread)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("RTK Server State")));
-    Console->setItem(i++, 1, new QTableWidgetItem(svrstate[state]));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Processing Cycle (ms)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(cycle)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Positioning Mode")));
-    Console->setItem(i++, 1, new QTableWidgetItem(mode[rtk.opt.mode]));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Frequencies")));
-    Console->setItem(i++, 1, new QTableWidgetItem(freq[rtk.opt.nf]));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Elevation Mask (deg)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(rtk.opt.elmin * R2D, 'f', 0)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("SNR Mask L1 (dBHz)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(!rtk.opt.snrmask.ena[0] ? "" :
-                              QString("%1,%2,%3,%4,%5,%6,%7,%8,%9")
-                              .arg(rtk.opt.snrmask.mask[0][0], 0).arg(rtk.opt.snrmask.mask[0][1], 0).arg(rtk.opt.snrmask.mask[0][2], 0)
-                              .arg(rtk.opt.snrmask.mask[0][3], 0).arg(rtk.opt.snrmask.mask[0][4], 0).arg(rtk.opt.snrmask.mask[0][5], 0)
-                              .arg(rtk.opt.snrmask.mask[0][6], 0).arg(rtk.opt.snrmask.mask[0][7], 0).arg(rtk.opt.snrmask.mask[0][8], 0)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("SNR Mask L2 (dBHz)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(!rtk.opt.snrmask.ena[0] ? "" :
-                              QString("%1,%2,%3,%4,%5,%6,%7,%8,%9")
-                              .arg(rtk.opt.snrmask.mask[1][0], 0).arg(rtk.opt.snrmask.mask[1][1], 0).arg(rtk.opt.snrmask.mask[1][2], 0)
-                              .arg(rtk.opt.snrmask.mask[1][3], 0).arg(rtk.opt.snrmask.mask[1][4], 0).arg(rtk.opt.snrmask.mask[1][5], 0)
-                              .arg(rtk.opt.snrmask.mask[1][6], 0).arg(rtk.opt.snrmask.mask[1][7], 0).arg(rtk.opt.snrmask.mask[1][8], 0)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("SNR Mask L5 (dBHz)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(!rtk.opt.snrmask.ena[0] ? "" :
-                              QString("%1,%2,%3,%4,%5,%6,%7,%8,%9")
-                              .arg(rtk.opt.snrmask.mask[2][0], 0).arg(rtk.opt.snrmask.mask[2][1], 0).arg(rtk.opt.snrmask.mask[2][2], 0)
-                              .arg(rtk.opt.snrmask.mask[2][3], 0).arg(rtk.opt.snrmask.mask[2][4], 0).arg(rtk.opt.snrmask.mask[2][5], 0)
-                              .arg(rtk.opt.snrmask.mask[2][6], 0).arg(rtk.opt.snrmask.mask[2][7], 0).arg(rtk.opt.snrmask.mask[2][8], 0)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Rec Dynamic/Earth Tides Correction")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2").arg(rtk.opt.dynamics ? tr("ON") : tr("OFF")).arg(rtk.opt.tidecorr ? tr("ON") : tr("OFF"))));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Ionosphere/Troposphere Model")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2").arg(ionoopt[rtk.opt.ionoopt]).arg(tropopt[rtk.opt.tropopt])));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Satellite Ephemeris")));
-    Console->setItem(i++, 1, new QTableWidgetItem(ephopt[rtk.opt.sateph]));
+    i=0;
 
-    for (j = 1; j <= MAXSAT; j++) {
-        if (!rtk.opt.exsats[j - 1]) continue;
-        satno2id(j, id);
-        if (rtk.opt.exsats[j - 1] == 2) exsats = exsats + "+";
-        exsats = exsats + id + " ";
+    Console->setItem(i,0, new QTableWidgetItem(tr("RTKLIB Version")));
+    Console->setItem(i++,1, new QTableWidgetItem(VER_RTKLIB));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("RTK Server Thread")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(thread)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("RTK Server State")));
+    Console->setItem(i++,1, new QTableWidgetItem(svrstate[state]));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Processing Cycle (ms)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(cycle)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Positioning Mode")));
+    Console->setItem(i++,1, new QTableWidgetItem(mode[rtk.opt.mode]));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Frequencies")));
+    Console->setItem(i++,1, new QTableWidgetItem(freq[rtk.opt.nf]));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Elevation Mask (deg)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(rtk.opt.elmin*R2D,'f',0)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("SNR Mask L1 (dBHz)")));
+    Console->setItem(i++,1, new QTableWidgetItem(!rtk.opt.snrmask.ena[0]?"":
+        QString("%1,%2,%3,%4,%5,%6,%7,%8,%9")
+                  .arg(rtk.opt.snrmask.mask[0][0],0).arg(rtk.opt.snrmask.mask[0][1],0).arg(rtk.opt.snrmask.mask[0][2],0)
+                  .arg(rtk.opt.snrmask.mask[0][3],0).arg(rtk.opt.snrmask.mask[0][4],0).arg(rtk.opt.snrmask.mask[0][5],0)
+                  .arg(rtk.opt.snrmask.mask[0][6],0).arg(rtk.opt.snrmask.mask[0][7],0).arg(rtk.opt.snrmask.mask[0][8],0)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("SNR Mask L2 (dBHz)")));
+    Console->setItem(i++,1, new QTableWidgetItem(!rtk.opt.snrmask.ena[0]?"":
+        QString("%1,%2,%3,%4,%5,%6,%7,%8,%9")
+                  .arg(rtk.opt.snrmask.mask[1][0],0).arg(rtk.opt.snrmask.mask[1][1],0).arg(rtk.opt.snrmask.mask[1][2],0)
+                  .arg(rtk.opt.snrmask.mask[1][3],0).arg(rtk.opt.snrmask.mask[1][4],0).arg(rtk.opt.snrmask.mask[1][5],0)
+                  .arg(rtk.opt.snrmask.mask[1][6],0).arg(rtk.opt.snrmask.mask[1][7],0).arg(rtk.opt.snrmask.mask[1][8],0)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("SNR Mask L5 (dBHz)")));
+    Console->setItem(i++,1, new QTableWidgetItem(!rtk.opt.snrmask.ena[0]?"":
+        QString("%1,%2,%3,%4,%5,%6,%7,%8,%9")
+                  .arg(rtk.opt.snrmask.mask[2][0],0).arg(rtk.opt.snrmask.mask[2][1],0).arg(rtk.opt.snrmask.mask[2][2],0)
+                  .arg(rtk.opt.snrmask.mask[2][3],0).arg(rtk.opt.snrmask.mask[2][4],0).arg(rtk.opt.snrmask.mask[2][5],0)
+                  .arg(rtk.opt.snrmask.mask[2][6],0).arg(rtk.opt.snrmask.mask[2][7],0).arg(rtk.opt.snrmask.mask[2][8],0)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Rec Dynamic/Earth Tides Correction")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2").arg(rtk.opt.dynamics?tr("ON"):tr("OFF")).arg(rtk.opt.tidecorr?tr("ON"):tr("OFF"))));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Ionosphere/Troposphere Model")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2").arg(ionoopt[rtk.opt.ionoopt]).arg(tropopt[rtk.opt.tropopt])));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Satellite Ephemeris")));
+    Console->setItem(i++,1, new QTableWidgetItem(ephopt[rtk.opt.sateph]));
+	
+	for (j=1;j<=MAXSAT;j++) {
+		if (!rtk.opt.exsats[j-1]) continue;
+		satno2id(j,id);
+		if (rtk.opt.exsats[j-1]==2) exsats=exsats+"+";
+		exsats=exsats+id+" ";
 	}
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Excluded Satellites")));
-    Console->setItem(i++, 1, new QTableWidgetItem(exsats));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Navi Systems")));
-    Console->setItem(i++, 1, new QTableWidgetItem(navsys));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Accumulated Time to Run")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1:%2:%3").arg(rt[0], 2, 'f', 0, '0').arg(rt[1], 2, 'f', 0, '0').arg(rt[2], 4, 'f', 1, '0')));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("CPU Time for a Processing Cycle (ms)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(cputime)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Missing Obs Data Count")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(prcout)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Bytes in Input Buffer")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3").arg(nb[0]).arg(nb[1]).arg(nb[2])));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("# of Input Data Rover")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString(tr("Obs(%1),Nav(%2),Gnav(%3),Ion(%4),Sbs(%5),Pos(%6),Dgps(%7),Ssr(%8),Lex(%9),Err(%10)"))
-                              .arg(nmsg[0][0]).arg(nmsg[0][1]).arg(nmsg[0][6]).arg(nmsg[0][2]).arg(nmsg[0][3])
-                              .arg(nmsg[0][4]).arg(nmsg[0][5]).arg(nmsg[0][7]).arg(nmsg[0][8]).arg(nmsg[0][9])));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("# of Input Data Base/NRTK Station")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString(tr("Obs(%1),Nav(%2),Gnav(%3),Ion(%4),Sbs(%5),Pos(%6),Dgps(%7),Ssr(%8),Lex(%9),Err(%10)"))
-                              .arg(nmsg[1][0]).arg(nmsg[1][1]).arg(nmsg[1][6]).arg(nmsg[1][2]).arg(nmsg[1][3])
-                              .arg(nmsg[1][4]).arg(nmsg[1][5]).arg(nmsg[1][7]).arg(nmsg[1][8]).arg(nmsg[1][9])));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("# of Input Data Ephemeris")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString(tr("Obs(%1),Nav(%2),Gnav(%3),Ion(%4),Sbs(%5),Pos(%6),Dgps(%7),Ssr(%8),Lex(%9),Err(%10)"))
-                              .arg(nmsg[2][0]).arg(nmsg[2][1]).arg(nmsg[2][6]).arg(nmsg[2][2]).arg(nmsg[2][3])
-                              .arg(nmsg[2][4]).arg(nmsg[2][5]).arg(nmsg[2][7]).arg(nmsg[2][8]).arg(nmsg[2][9])));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Solution Status")));
-    Console->setItem(i++, 1, new QTableWidgetItem(sol[rtkstat]));
-
-    time2str(rtk.sol.time, tstr, 9);
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Time of Receiver Clock Rover")));
-    Console->setItem(i++, 1, new QTableWidgetItem(rtk.sol.time.time ? tstr : "-"));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Time System Offset/Receiver Bias (GLO-GPS,GAL-GPS,BDS-GPS,IRN-GPS) (ns)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3,%4").arg(rtk.sol.dtr[1] * 1E9, 0, 'f', 3).arg(rtk.sol.dtr[2] * 1E9, 0, 'f', 3).arg(rtk.sol.dtr[3] * 1E9, 0, 'f', 3)
-                              .arg(rtk.sol.dtr[4] * 1E9, 0, 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Solution Interval (s)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(rtk.tt, 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Age of Differential (s)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(rtk.sol.age, 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Ratio for AR Validation")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(rtk.sol.ratio, 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("# of Satellites Rover")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(nsat0)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("# of Satellites Base/NRTK Station")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(nsat1)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("# of Valid Satellites")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(rtk.sol.ns)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("GDOP/PDOP/HDOP/VDOP")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3,%4").arg(dop[0], 0, 'f', 1).arg(dop[1], 0, 'f', 1).arg(dop[2], 0, 'f', 1).arg(dop[3], 0, 'f', 1)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("# of Real Estimated States")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(rtk.na)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("# of All Estimated States")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(rtk.nx)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Pos X/Y/Z Single (m) Rover")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3").arg(rtk.sol.rr[0], 0, 'f', 3).arg(rtk.sol.rr[1], 0, 'f', 3).arg(rtk.sol.rr[2], 0, 'f', 3)));
-
-    if (norm(rtk.sol.rr, 3) > 0.0) ecef2pos(rtk.sol.rr, pos); else pos[0] = pos[1] = pos[2] = 0.0;
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Lat/Lon/Height Single (deg,m) Rover")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3").arg(pos[0] * R2D, 0, 'f', 8).arg(pos[1] * R2D, 0, 'f', 8).arg(pos[2], 0, 'f', 3)));
-
-    ecef2enu(pos, rtk.sol.rr + 3, vel);
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Vel E/N/U (m/s) Rover")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3").arg(vel[0], 0, 'f', 3).arg(vel[1], 0, 'f', 3).arg(vel[2], 0, 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Pos X/Y/Z Float (m) Rover")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3")
-                              .arg(rtk.x ? rtk.x[0] : 0, 0, 'f', 3).arg(rtk.x ? rtk.x[1] : 0, 0, 'f', 3).arg(rtk.x ? rtk.x[2] : 0, 0, 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Pos X/Y/Z Float Std (m) Rover")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3")
-                              .arg(rtk.P ? SQRT(rtk.P[0]) : 0, 0, 'f', 3).arg(rtk.P ? SQRT(rtk.P[1 + 1 * rtk.nx]) : 0, 0, 'f', 3).arg(rtk.P ? SQRT(rtk.P[2 + 2 * rtk.nx]) : 0, 0, 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Pos X/Y/Z Fixed (m) Rover")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3")
-                              .arg(rtk.xa ? rtk.xa[0] : 0, 0, 'f', 3).arg(rtk.xa ? rtk.xa[1] : 0, 0, 'f', 3).arg(rtk.xa ? rtk.xa[2] : 0, 0, 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Pos X/Y/Z Fixed Std (m) Rover")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3")
-                              .arg(rtk.Pa ? SQRT(rtk.Pa[0]) : 0, 0, 'f', 3).arg(rtk.Pa ? SQRT(rtk.Pa[1 + 1 * rtk.na]) : 0, 0, 'f', 3).arg(rtk.Pa ? SQRT(rtk.Pa[2 + 2 * rtk.na]) : 0, 0, 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Pos X/Y/Z (m) Base/NRTK Station")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3").arg(rtk.rb[0], 0, 'f', 3).arg(rtk.rb[1], 0, 'f', 3).arg(rtk.rb[2], 0, 'f', 3)));
-
-    if (norm(rtk.rb, 3) > 0.0) ecef2pos(rtk.rb, pos); else pos[0] = pos[1] = pos[2] = 0.0;
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Lat/Lon/Height (deg,m) Base/NRTK Station")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3").arg(pos[0] * R2D, 0, 'f', 8).arg(pos[1] * R2D, 0, 'f', 8).arg(pos[2], 0, 'f', 3)));
-
-    ecef2enu(pos, rtk.rb + 3, vel);
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Vel E/N/U (m/s) Base/NRTK Station")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3").arg(vel[0], 0, 'f', 3).arg(vel[1], 0, 'f', 3).arg(vel[2], 0, 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("# of Averaging Single Pos Base/NRTK Station")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1").arg(nave)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Antenna Type Rover")));
-    Console->setItem(i++, 1, new QTableWidgetItem(rtk.opt.pcvr[0].type));
-
-    off1 = rtk.opt.pcvr[0].off[0];
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Ant Phase Center L1 E/N/U (m) Rover")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3").arg(off1[0], 0, 'f', 3).arg(off1[1], 0, 'f', 3).arg(off1[2], 0, 'f', 3)));
-
-    off2 = rtk.opt.pcvr[0].off[1];
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Ant Phase Center L2 E/N/U (m) Rover")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3").arg(off2[0], 0, 'f', 3).arg(off2[1], 0, 'f', 3).arg(off2[2], 0, 'f', 3)));
-
-    del = rtk.opt.antdel[0];
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Ant Delta E/N/U (m) Rover")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3").arg(del[0], 0, 'f', 3).arg(del[1], 0, 'f', 3).arg(del[2], 0, 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Antenna Type Base/NRTK Station")));
-    Console->setItem(i++, 1, new QTableWidgetItem(rtk.opt.pcvr[1].type));
-
-    off1 = rtk.opt.pcvr[1].off[0];
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Ant Phase Center L1 E/N/U (m) Base/NRTK Station")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3").arg(off1[0], 0, 'f', 3).arg(off1[1], 0, 'f', 3).arg(off1[2], 0, 'f', 3)));
-
-    off2 = rtk.opt.pcvr[1].off[1];
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Ant Phase Center L2 E/N/U (m) Base/NRTK Station")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3").arg(off2[0], 0, 'f', 3).arg(off2[1], 0, 'f', 3).arg(off2[2], 0, 'f', 3)));
-
-    del = rtk.opt.antdel[1];
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Ant Delta E/N/U (m) Base/NRTK Station")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3").arg(del[0], 0, 'f', 3).arg(del[1], 0, 'f', 3).arg(del[2], 0, 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Precise Ephemeris Time/# of Epoch")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1-%2 (%3)").arg(s1).arg(s2).arg(ne)));
+    Console->setItem(i,0, new QTableWidgetItem(tr("Excluded Satellites")));
+    Console->setItem(i++,1, new QTableWidgetItem(exsats));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Navi Systems")));
+    Console->setItem(i++,1, new QTableWidgetItem(navsys));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Accumulated Time to Run")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1:%2:%3").arg(rt[0],2,'f',0,'0').arg(rt[1],2,'f',0,'0').arg(rt[2],4,'f',1,'0')));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("CPU Time for a Processing Cycle (ms)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(cputime)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Missing Obs Data Count")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(prcout)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Bytes in Input Buffer")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3").arg(nb[0]).arg(nb[1]).arg(nb[2])));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("# of Input Data Rover")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString(tr("Obs(%1),Nav(%2),Gnav(%3),Ion(%4),Sbs(%5),Pos(%6),Dgps(%7),Ssr(%8),Lex(%9),Err(%10)"))
+                                 .arg(nmsg[0][0]).arg(nmsg[0][1]).arg(nmsg[0][6]).arg(nmsg[0][2]).arg(nmsg[0][3])
+                                 .arg(nmsg[0][4]).arg(nmsg[0][5]).arg(nmsg[0][7]).arg(nmsg[0][8]).arg(nmsg[0][9])));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("# of Input Data Base/NRTK Station")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString(tr("Obs(%1),Nav(%2),Gnav(%3),Ion(%4),Sbs(%5),Pos(%6),Dgps(%7),Ssr(%8),Lex(%9),Err(%10)"))
+                                 .arg(nmsg[1][0]).arg(nmsg[1][1]).arg(nmsg[1][6]).arg(nmsg[1][2]).arg(nmsg[1][3])
+                                 .arg(nmsg[1][4]).arg(nmsg[1][5]).arg(nmsg[1][7]).arg(nmsg[1][8]).arg(nmsg[1][9])));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("# of Input Data Ephemeris")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString(tr("Obs(%1),Nav(%2),Gnav(%3),Ion(%4),Sbs(%5),Pos(%6),Dgps(%7),Ssr(%8),Lex(%9),Err(%10)"))
+                                 .arg(nmsg[2][0]).arg(nmsg[2][1]).arg(nmsg[2][6]).arg(nmsg[2][2]).arg(nmsg[2][3])
+                                 .arg(nmsg[2][4]).arg(nmsg[2][5]).arg(nmsg[2][7]).arg(nmsg[2][8]).arg(nmsg[2][9])));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Solution Status")));
+    Console->setItem(i++,1, new QTableWidgetItem(sol[rtkstat]));
+	
+	time2str(rtk.sol.time,tstr,9);
+    Console->setItem(i,0, new QTableWidgetItem(tr("Time of Receiver Clock Rover")));
+    Console->setItem(i++,1, new QTableWidgetItem(rtk.sol.time.time?tstr:"-"));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Time Sytem Offset/Receiver Bias (GLO-GPS,GAL-GPS,BDS-GPS,IRN-GPS) (ns)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3,%4").arg(rtk.sol.dtr[1]*1E9,0,'f',3).arg(rtk.sol.dtr[2]*1E9,0,'f',3).arg(rtk.sol.dtr[3]*1E9,0,'f',3)
+                                 .arg(rtk.sol.dtr[4]*1E9,0,'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Solution Interval (s)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(rtk.tt,'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Age of Differential (s)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(rtk.sol.age,'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Ratio for AR Validation")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(rtk.sol.ratio,'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("# of Satellites Rover")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(nsat0)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("# of Satellites Base/NRTK Station")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(nsat1)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("# of Valid Satellites")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(rtk.sol.ns)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("GDOP/PDOP/HDOP/VDOP")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3,%4").arg(dop[0],0,'f',1).arg(dop[1],0,'f',1).arg(dop[2],0,'f',1).arg(dop[3],0,'f',1)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("# of Real Estimated States")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(rtk.na)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("# of All Estimated States")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(rtk.nx)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Pos X/Y/Z Single (m) Rover")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3").arg(rtk.sol.rr[0],0,'f',3).arg(rtk.sol.rr[1],0,'f',3).arg(rtk.sol.rr[2],0,'f',3)));
+	
+	if (norm(rtk.sol.rr,3)>0.0) ecef2pos(rtk.sol.rr,pos); else pos[0]=pos[1]=pos[2]=0.0;
+    Console->setItem(i,0, new QTableWidgetItem(tr("Lat/Lon/Height Single (deg,m) Rover")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3").arg(pos[0]*R2D,0,'f',8).arg(pos[1]*R2D,0,'f',8).arg(pos[2],0,'f',3)));
+	
+	ecef2enu(pos,rtk.sol.rr+3,vel);
+    Console->setItem(i,0, new QTableWidgetItem(tr("Vel E/N/U (m/s) Rover")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3").arg(vel[0],0,'f',3).arg(vel[1],0,'f',3).arg(vel[2],0,'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Pos X/Y/Z Float (m) Rover")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3")
+        .arg(rtk.x?rtk.x[0]:0,0,'f',3).arg(rtk.x?rtk.x[1]:0,0,'f',3).arg(rtk.x?rtk.x[2]:0,0,'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Pos X/Y/Z Float Std (m) Rover")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3")
+        .arg(rtk.P?SQRT(rtk.P[0]):0,0,'f',3).arg(rtk.P?SQRT(rtk.P[1+1*rtk.nx]):0,0,'f',3).arg(rtk.P?SQRT(rtk.P[2+2*rtk.nx]):0,0,'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Pos X/Y/Z Fixed (m) Rover")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3")
+        .arg(rtk.xa?rtk.xa[0]:0,0,'f',3).arg(rtk.xa?rtk.xa[1]:0,0,'f',3).arg(rtk.xa?rtk.xa[2]:0,0,'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Pos X/Y/Z Fixed Std (m) Rover")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3")
+        .arg(rtk.Pa?SQRT(rtk.Pa[0]):0,0,'f',3).arg(rtk.Pa?SQRT(rtk.Pa[1+1*rtk.na]):0,0,'f',3).arg(rtk.Pa?SQRT(rtk.Pa[2+2*rtk.na]):0,0,'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Pos X/Y/Z (m) Base/NRTK Station")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3").arg(rtk.rb[0],0,'f',3).arg(rtk.rb[1],0,'f',3).arg(rtk.rb[2],0,'f',3)));
+	
+	if (norm(rtk.rb,3)>0.0) ecef2pos(rtk.rb,pos); else pos[0]=pos[1]=pos[2]=0.0;
+    Console->setItem(i,0, new QTableWidgetItem(tr("Lat/Lon/Height (deg,m) Base/NRTK Station")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3").arg(pos[0]*R2D,0,'f',8).arg(pos[1]*R2D,0,'f',8).arg(pos[2],0,'f',3)));
+	
+	ecef2enu(pos,rtk.rb+3,vel);
+    Console->setItem(i,0, new QTableWidgetItem(tr("Vel E/N/U (m/s) Base/NRTK Station")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3").arg(vel[0],0,'f',3).arg(vel[1],0,'f',3).arg(vel[2],0,'f',3)));
 
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Precise Ephemeris Download Time")));
-    Console->setItem(i++, 1, new QTableWidgetItem(s3));
+    Console->setItem(i,0, new QTableWidgetItem(tr("# of Averaging Single Pos Base/NRTK Station")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1").arg(nave)));
 
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Precise Ephemeris Download File")));
-    Console->setItem(i++, 1, new QTableWidgetItem(file));
+    Console->setItem(i,0, new QTableWidgetItem(tr("Antenna Type Rover")));
+    Console->setItem(i++,1, new QTableWidgetItem(rtk.opt.pcvr[0].type));
+	
+	off1=rtk.opt.pcvr[0].off[0];
+    Console->setItem(i,0, new QTableWidgetItem(tr("Ant Phase Center L1 E/N/U (m) Rover")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3").arg(off1[0],0,'f',3).arg(off1[1],0,'f',3).arg(off1[2],0,'f',3)));
+	
+	off2=rtk.opt.pcvr[0].off[1];
+    Console->setItem(i,0, new QTableWidgetItem(tr("Ant Phase Center L2 E/N/U (m) Rover")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3").arg(off2[0],0,'f',3).arg(off2[1],0,'f',3).arg(off2[2],0,'f',3)));
+	
+	del=rtk.opt.antdel[0];
+    Console->setItem(i,0, new QTableWidgetItem(tr("Ant Delta E/N/U (m) Rover")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3").arg(del[0],0,'f',3).arg(del[1],0,'f',3).arg(del[2],0,'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Antenna Type Base/NRTK Station")));
+    Console->setItem(i++,1, new QTableWidgetItem(rtk.opt.pcvr[1].type));
+	
+	off1=rtk.opt.pcvr[1].off[0];
+    Console->setItem(i,0, new QTableWidgetItem(tr("Ant Phase Center L1 E/N/U (m) Base/NRTK Station")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3").arg(off1[0],0,'f',3).arg(off1[1],0,'f',3).arg(off1[2],0,'f',3)));
+	
+	off2=rtk.opt.pcvr[1].off[1];
+    Console->setItem(i,0, new QTableWidgetItem(tr("Ant Phase Center L2 E/N/U (m) Base/NRTK Station")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3").arg(off2[0],0,'f',3).arg(off2[1],0,'f',3).arg(off2[2],0,'f',3)));
+	
+	del=rtk.opt.antdel[1];
+    Console->setItem(i,0, new QTableWidgetItem(tr("Ant Delta E/N/U (m) Base/NRTK Station")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3").arg(del[0],0,'f',3).arg(del[1],0,'f',3).arg(del[2],0,'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Precise Ephemeris Time/# of Epoch")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1-%2 (%3)").arg(s1).arg(s2).arg(ne)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Precise Ephemeris Download Time")));
+    Console->setItem(i++,1, new QTableWidgetItem(s3));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Precise Ephemeris Download File")));
+    Console->setItem(i++,1, new QTableWidgetItem(file));
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::SetSat(void)
 {
-    int i, j = 0, freq[] = { 1, 2, 5, 6, 7, 8 };
-    const QString label[] = {
-        tr("SAT"),	tr("PRN"),	tr("Status"), tr("Azimuth (deg)"), tr("Elevation (deg)"), tr("LG (m)"), tr("PHW(cyc)"),
-        tr("P1-P2(m)"), tr("P1-C1(m)"), tr("P2-C2(m)")
+	int i,j=0,freq[]={1,2,5,6,7,8};
+    QString label[]={
+        tr("SAT"),tr("PRN"),tr("Status"),tr("Azimuth (deg)"),tr("Elevation (deg)"),tr("LG (m)"),tr("PHW(cyc)"),
+        tr("P1-P2(m)"),tr("P1-C1(m)"),tr("P2-C2(m)")
 	};
-    int width[] = { 25, 25, 30, 45, 45, 60, 60, 40, 40, 40 };
-
-    Console->setColumnCount(10 + NFREQ * 9);
+	int width[]={25,25,30,45,45,60,60,40,40,40};
+	
+    Console->setColumnCount(10+NFREQ*9);
     Console->setRowCount(2);
     header.clear();
 
-    j = 0;
-    for (i = 0; i < 5; i++) {
-        Console->setColumnWidth(j++, width[i] * FontScale / 96);
-        header << label[i];
+    j=0;
+    for (i=0;i<5;i++) {
+        Console->setColumnWidth(j++,width[i]*FontScale/96);
+        header<<label[i];
 	}
-    for (i = 0; i < NFREQ; i++) {
-        Console->setColumnWidth(j++, 30 * FontScale / 96);
-        header << QString(tr("L%1")).arg(freq[i]);
+	for (i=0;i<NFREQ;i++) {
+        Console->setColumnWidth(j++,30*FontScale/96);
+        header<<QString(tr("L%1")).arg(freq[i]);
 	}
-    for (i = 0; i < NFREQ; i++) {
-        Console->setColumnWidth(j++, 40 * FontScale / 96);
-        header << QString(tr("Fix%1")).arg(freq[i]);
+	for (i=0;i<NFREQ;i++) {
+        Console->setColumnWidth(j++,40*FontScale/96);
+        header<<QString(tr("Fix%1")).arg(freq[i]);
 	}
-    for (i = 0; i < NFREQ; i++) {
-        Console->setColumnWidth(j++, 45 * FontScale / 96);
-        header << QString(tr("P%1 Residual(m)")).arg(freq[i]);
+	for (i=0;i<NFREQ;i++) {
+        Console->setColumnWidth(j++,45*FontScale/96);
+        header<<QString(tr("P%1 Residual(m)")).arg(freq[i]);
 	}
-    for (i = 0; i < NFREQ; i++) {
-        Console->setColumnWidth(j++, 45 * FontScale / 96);
-        header << QString(tr("L%1 Residual(m)")).arg(freq[i]);
+	for (i=0;i<NFREQ;i++) {
+        Console->setColumnWidth(j++,45*FontScale/96);
+        header<<QString(tr("L%1 Residual(m)")).arg(freq[i]);
 	}
-    for (i = 0; i < NFREQ; i++) {
-        Console->setColumnWidth(j++, 45 * FontScale / 96);
-        header << QString(tr("Slip%1")).arg(freq[i]);
+	for (i=0;i<NFREQ;i++) {
+        Console->setColumnWidth(j++,45*FontScale/96);
+        header<<QString(tr("Slip%1")).arg(freq[i]);
 	}
-    for (i = 0; i < NFREQ; i++) {
-        Console->setColumnWidth(j++, 45 * FontScale / 96);
-        header << QString(tr("Lock%1")).arg(freq[i]);
+	for (i=0;i<NFREQ;i++) {
+        Console->setColumnWidth(j++,45*FontScale/96);
+        header<<QString(tr("Lock%1")).arg(freq[i]);
 	}
-    for (i = 0; i < NFREQ; i++) {
-        Console->setColumnWidth(j++, 45 * FontScale / 96);
-        header << QString(tr("Outage%1")).arg(freq[i]);
+	for (i=0;i<NFREQ;i++) {
+        Console->setColumnWidth(j++,45*FontScale/96);
+        header<<QString(tr("Outage%1")).arg(freq[i]);
 	}
-    for (i = 0; i < NFREQ; i++) {
-        Console->setColumnWidth(j++, 45 * FontScale / 96);
-        header << QString(tr("Reject%1")).arg(freq[i]);
+	for (i=0;i<NFREQ;i++) {
+        Console->setColumnWidth(j++,45*FontScale/96);
+        header<<QString(tr("Reject%1")).arg(freq[i]);
 	}
-    for (i = 0; i < NFREQ; i++) {
-        Console->setColumnWidth(j++, 50 * FontScale / 96);
-        header << QString(tr("WaveL%1(m)")).arg(freq[i]);
+	for (i=0;i<NFREQ;i++) {
+        Console->setColumnWidth(j++,50*FontScale/96);
+        header<<QString(tr("WaveL%1(m)")).arg(freq[i]);
 	}
-    for (i = 5; i < 10; i++) {
-        Console->setColumnWidth(j++, width[i] * FontScale / 96);
-        header << label[i];
+	for (i=5;i<10;i++) {
+        Console->setColumnWidth(j++,width[i]*FontScale/96);
+        header<<label[i];
 	}
     Console->setHorizontalHeaderLabels(header);
 }
@@ -700,92 +698,100 @@
 {
 	rtk_t rtk;
 	ssat_t *ssat;
-    int i, j, k, n, fix, prn;
+	int i,j,k,n,fix,prn;
 	char id[32];
-    double az, el, lam[MAXSAT][NFREQ], cbias[MAXSAT][3];
-
+	double az,el,lam[MAXSAT][NFREQ],cbias[MAXSAT][3];
+	
 	rtksvrlock(&rtksvr);
-    rtk = rtksvr.rtk;
-    for (i = 0; i < MAXSAT; i++) for (j = 0; j < NFREQ; j++)
-            lam[i][j] = rtksvr.nav.lam[i][j];
-
-    for (i = 0; i < MAXSAT; i++) for (j = 0; j < 3; j++)
-            cbias[i][j] = rtksvr.nav.cbias[i][j];
-
+	rtk=rtksvr.rtk;
+	for (i=0;i<MAXSAT;i++) for (j=0;j<NFREQ;j++) {
+		lam[i][j]=rtksvr.nav.lam[i][j];
+	}
+	for (i=0;i<MAXSAT;i++) for (j=0;j<3;j++) {
+		cbias[i][j]=rtksvr.nav.cbias[i][j];
+	}
 	rtksvrunlock(&rtksvr);
-
+	
     Label->setText("");
-
-    for (i = 0, n = 1; i < MAXSAT; i++) {
-        if (!(satsys(i + 1, NULL) & sys)) continue;
-        ssat = rtk.ssat + i;
-        if (SelSat->currentIndex() == 1 && !ssat->vs) continue;
+	
+	for (i=0,n=1;i<MAXSAT;i++) {
+		if (!(satsys(i+1,NULL)&sys)) continue;
+		ssat=rtk.ssat+i;
+        if (SelSat->currentIndex()==1&&!ssat->vs) continue;
 		n++;
 	}
-    Console->setRowCount(n - 1);
-    if (n < 2) {
+    Console->setRowCount(n-1);
+    if (n<2) {
         Console->setRowCount(0);
 		return;
 	}
     Console->setHorizontalHeaderLabels(header);
 
-    for (i = 0, n = 0; i < MAXSAT; i++) {
-        if (!(satsys(i + 1, NULL) & sys)) continue;
-        j = 0;
-        ssat = rtk.ssat + i;
-        if (SelSat->currentIndex() == 1 && !ssat->vs) continue;
-        satno2id(i + 1, id);
-        satsys(i + 1, &prn);
-        Console->setItem(n, j++, new QTableWidgetItem(id));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(prn)));
-        Console->setItem(n, j++, new QTableWidgetItem(ssat->vs ? tr("OK") : tr("-")));
-        az = ssat->azel[0] * R2D; if (az < 0.0) az += 360.0;
-        el = ssat->azel[1] * R2D;
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(az, 'f', 1)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(el, 'f', 1)));
-        for (k = 0; k < NFREQ; k++)
-            Console->setItem(n, j++, new QTableWidgetItem(ssat->vsat[k] ? tr("OK") : tr("-")));
-        for (k = 0; k < NFREQ; k++) {
-            fix = ssat->fix[k];
-            Console->setItem(n, j++, new QTableWidgetItem(fix == 1 ? tr("FLOAT") : (fix == 2 ? tr("FIX") : (fix == 3 ? tr("HOLD") : tr("-")))));
+    for (i=0,n=0;i<MAXSAT;i++) {
+		if (!(satsys(i+1,NULL)&sys)) continue;
+		j=0;
+		ssat=rtk.ssat+i;
+        if (SelSat->currentIndex()==1&&!ssat->vs) continue;
+		satno2id(i+1,id);
+		satsys(i+1,&prn);
+        Console->setItem(n,j++, new QTableWidgetItem(id));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(prn)));
+        Console->setItem(n,j++, new QTableWidgetItem(ssat->vs?tr("OK"):tr("-")));
+		az=ssat->azel[0]*R2D; if (az<0.0) az+=360.0;
+		el=ssat->azel[1]*R2D;
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(az,'f',1)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(el,'f',1)));
+		for (k=0;k<NFREQ;k++) {
+            Console->setItem(n,j++, new QTableWidgetItem(ssat->vsat[k]?tr("OK"):tr("-")));
 		}
-        for (k = 0; k < NFREQ; k++)
-            Console->setItem(n, j++, new QTableWidgetItem(QString::number(ssat->resp[k], 'f', 2)));
-        for (k = 0; k < NFREQ; k++)
-            Console->setItem(n, j++, new QTableWidgetItem(QString::number(ssat->resc[k], 'f', 4)));
-        for (k = 0; k < NFREQ; k++)
-            Console->setItem(n, j++, new QTableWidgetItem(QString::number(ssat->slipc[k])));
-        for (k = 0; k < NFREQ; k++)
-            Console->setItem(n, j++, new QTableWidgetItem(QString::number(ssat->lock[k])));
-        for (k = 0; k < NFREQ; k++)
-            Console->setItem(n, j++, new QTableWidgetItem(QString::number(ssat->outc[k])));
-        for (k = 0; k < NFREQ; k++)
-            Console->setItem(n, j++, new QTableWidgetItem(QString::number(ssat->rejc[k])));
-        for (k = 0; k < NFREQ; k++)
-            Console->setItem(n, j++, new QTableWidgetItem(QString("%1").arg(lam[i][k], 7, 'f', 5)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(ssat->gf, 'f', 3)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(ssat->phw, 'f', 2)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(cbias[i][0], 'f', 2)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(cbias[i][1], 'f', 2)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(cbias[i][2], 'f', 2)));
+		for (k=0;k<NFREQ;k++) {
+			fix=ssat->fix[k];
+            Console->setItem(n,j++, new QTableWidgetItem(fix==1?tr("FLOAT"):(fix==2?tr("FIX"):(fix==3?tr("HOLD"):tr("-")))));
+		}
+		for (k=0;k<NFREQ;k++) {
+            Console->setItem(n,j++, new QTableWidgetItem(QString::number(ssat->resp[k],'f',2)));
+		}
+		for (k=0;k<NFREQ;k++) {
+            Console->setItem(n,j++, new QTableWidgetItem(QString::number(ssat->resc[k],'f',4)));
+		}
+		for (k=0;k<NFREQ;k++) {
+            Console->setItem(n,j++, new QTableWidgetItem(QString::number(ssat->slipc[k])));
+		}
+		for (k=0;k<NFREQ;k++) {
+            Console->setItem(n,j++, new QTableWidgetItem(QString::number(ssat->lock[k])));
+		}
+		for (k=0;k<NFREQ;k++) {
+            Console->setItem(n,j++, new QTableWidgetItem(QString::number(ssat->outc[k])));
+		}
+		for (k=0;k<NFREQ;k++) {
+            Console->setItem(n,j++, new QTableWidgetItem(QString::number(ssat->rejc[k])));
+		}
+		for (k=0;k<NFREQ;k++) {
+            Console->setItem(n,j++, new QTableWidgetItem(QString("%1").arg(lam[i][k],7,'f',5)));
+		}
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(ssat->gf,'f',3)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(ssat->phw,'f',2)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(cbias[i][0],'f',2)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(cbias[i][1],'f',2)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(cbias[i][2],'f',2)));
 		n++;
 	}
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::SetEst(void)
 {
-    QString label[] = {
-        tr("State"), tr("Estimate Float"), tr("Std Float"), tr("Estimate Fixed"), tr("Std Fixed")
+    QString label[]={
+        tr("State"),tr("Estimate Float"),tr("Std Float"),tr("Estimate Fixed"),tr("Std Fixed")
 	};
-    int i, width[] = { 40, 100, 100, 100, 100 };
-
+	int i,width[]={40,100,100,100,100};
+	
     Console->setColumnCount(5);
     Console->setRowCount(2);
     header.clear();
 
-    for (i = 0; i < Console->columnCount(); i++) {
-        Console->setColumnWidth(i, width[i] * FontScale / 96);
-        header << label[i];
+    for (i=0;i<Console->columnCount();i++) {
+        Console->setColumnWidth(i,width[i]*FontScale/96);
+        header<<label[i];
     }
     Console->setHorizontalHeaderLabels(header);
 }
@@ -793,36 +799,37 @@
 void MonitorDialog::ShowEst(void)
 {
 	gtime_t time;
-    unsigned int i, nx, na, n;
-    double *x, *P = NULL, *xa = NULL, *Pa = NULL;
-    QString s0 = "-";
+	int i,nx,na,n;
+	double *x,*P=NULL,*xa=NULL,*Pa=NULL;
+    QString s0="-";
 	char tstr[64];
 
 	rtksvrlock(&rtksvr);
-
-    time = rtksvr.rtk.sol.time;
-    nx = (unsigned int)rtksvr.rtk.nx;
-    na = (unsigned int)rtksvr.rtk.na;
-    if ((x = (double *)malloc(sizeof(double) * nx)) &&
-        (P = (double *)malloc(sizeof(double) * nx * nx)) &&
-        (xa = (double *)malloc(sizeof(double) * na)) &&
-        (Pa = (double *)malloc(sizeof(double) * na * na))) {
-        memcpy(x, rtksvr.rtk.x, sizeof(double) * nx);
-        memcpy(P, rtksvr.rtk.P, sizeof(double) * nx * nx);
-        memcpy(xa, rtksvr.rtk.xa, sizeof(double) * na);
-        memcpy(Pa, rtksvr.rtk.Pa, sizeof(double) * na * na);
-    } else {
+	
+	time=rtksvr.rtk.sol.time;
+	nx=rtksvr.rtk.nx;
+	na=rtksvr.rtk.na;
+	if ((x =(double *)malloc(sizeof(double)*nx))&&
+	    (P =(double *)malloc(sizeof(double)*nx*nx))&&
+		(xa=(double *)malloc(sizeof(double)*na))&&
+	    (Pa=(double *)malloc(sizeof(double)*na*na))) {
+		memcpy(x ,rtksvr.rtk.x ,sizeof(double)*nx);
+		memcpy(P ,rtksvr.rtk.P ,sizeof(double)*nx*nx);
+		memcpy(xa,rtksvr.rtk.xa,sizeof(double)*na);
+		memcpy(Pa,rtksvr.rtk.Pa,sizeof(double)*na*na);
+    } else
+    {
         rtksvrunlock(&rtksvr);
         free(x); free(P); free(xa); free(Pa);
         return;
     }
 	rtksvrunlock(&rtksvr);
-
-    for (i = 0, n = 0; i < nx; i++) {
-        if (SelSat->currentIndex() == 1 && x[i] == 0.0) continue;
+	
+    for (i=0,n=0;i<nx;i++) {
+        if (SelSat->currentIndex()==1&&x[i]==0.0) continue;
 		n++;
 	}
-    if (n < 2) {
+	if (n<2) {
         Console->setRowCount(0);
         free(x); free(P); free(xa); free(Pa);
 		return;
@@ -830,16 +837,16 @@
     Console->setRowCount(n);
     Console->setHorizontalHeaderLabels(header);
 
-    time2str(time, tstr, 9);
-    Label->setText(time.time ? QString("Time: %1").arg(tstr) : s0);
-    for (i = 0, n = 1; i < nx; i++) {
-        int j = 0;
-        if (SelSat->currentIndex() == 1 && x[i] == 0.0) continue;
-        Console->setItem(i, j++, new QTableWidgetItem(QString(tr("X_%1")).arg(i + 1)));
-        Console->setItem(i, j++, new QTableWidgetItem(x[i] == 0.0 ? s0 : QString::number(x[i], 'f', 3)));
-        Console->setItem(i, j++, new QTableWidgetItem(P[i + i * nx] == 0.0 ? s0 : QString::number(SQRT(P[i + i * nx]), 'f', 3)));
-        Console->setItem(i, j++, new QTableWidgetItem((i >= na || qFuzzyCompare(xa[i], 0)) ? s0 : QString::number(xa[i], 'f', 3)));
-        Console->setItem(i, j++, new QTableWidgetItem((i >= na || Pa[i + i * na] == 0.0) ? s0 : QString::number(SQRT(Pa[i + i * na]), 'f', 3)));
+	time2str(time,tstr,9);
+    Label->setText(time.time?QString("Time: %1").arg(tstr):s0);
+	for (i=0,n=1;i<nx;i++) {
+		int j=0;
+        if (SelSat->currentIndex()==1&&x[i]==0.0) continue;
+        Console->setItem(i,j++, new QTableWidgetItem(QString(tr("X_%1")).arg(i+1)));
+        Console->setItem(i,j++, new QTableWidgetItem(x[i]==0.0?s0:QString::number(x[i],'f',3)));
+        Console->setItem(i,j++, new QTableWidgetItem(P[i+i*nx]==0.0?s0:QString::number(SQRT(P[i+i*nx]),'f',3)));
+        Console->setItem(i,j++, new QTableWidgetItem((i>=na||qFuzzyCompare(xa[i],0))?s0:QString::number(xa[i],'f',3)));
+        Console->setItem(i,j++, new QTableWidgetItem((i>=na||Pa[i+i*na]==0.0)?s0:QString::number(SQRT(Pa[i+i*na]),'f',3)));
 		n++;
 	}
 	free(x); free(P); free(xa); free(Pa);
@@ -848,45 +855,46 @@
 void MonitorDialog::SetCov(void)
 {
 	int i;
-
     header.clear();
-
+	
     Console->setColumnCount(2);
     Console->setRowCount(2);
 
-    for (i = 0; i < 2; i++)
-        Console->setColumnWidth(i, (i == 0 ? 35 : 45) * FontScale / 96);
+	for (i=0;i<2;i++) {
+        Console->setColumnWidth(i,(i==0?35:45)*FontScale/96);
+	}
     Console->setHorizontalHeaderLabels(header);
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::ShowCov(void)
 {
 	gtime_t time;
-    int i, j, nx, n, m;
-    double *x, *P = NULL;
-    QString s0 = "-";
+	int i,j,nx,n,m;
+	double *x,*P=NULL;
+    QString s0="-";
 	char tstr[64];
 
 	rtksvrlock(&rtksvr);
-
-    time = rtksvr.rtk.sol.time;
-    nx = rtksvr.rtk.nx;
-    if ((x = (double *)malloc(sizeof(double) * nx)) &&
-        (P = (double *)malloc(sizeof(double) * nx * nx))) {
-        memcpy(x, rtksvr.rtk.x, sizeof(double) * nx);
-        memcpy(P, rtksvr.rtk.P, sizeof(double) * nx * nx);
-    } else {
+	
+	time=rtksvr.rtk.sol.time;
+	nx=rtksvr.rtk.nx;
+	if ((x =(double *)malloc(sizeof(double)*nx))&&
+	    (P =(double *)malloc(sizeof(double)*nx*nx))) {
+		memcpy(x ,rtksvr.rtk.x ,sizeof(double)*nx);
+		memcpy(P ,rtksvr.rtk.P ,sizeof(double)*nx*nx);
+    } else
+    {
         free(x); free(P);
         rtksvrunlock(&rtksvr);
         return;
     }
 	rtksvrunlock(&rtksvr);
-
-    for (i = 0, n = 0; i < nx; i++) {
-        if (SelSat->currentIndex() == 1 && (x[i] == 0.0 || P[i + i * nx] == 0.0)) continue;
+	
+    for (i=0,n=0;i<nx;i++) {
+        if (SelSat->currentIndex()==1&&(x[i]==0.0||P[i+i*nx]==0.0)) continue;
 		n++;
 	}
-    if (n < 1) {
+    if (n<1) {
         Console->setColumnCount(0);
         Console->setRowCount(0);
         free(x); free(P);
@@ -895,16 +903,16 @@
     Console->setColumnCount(n);
     Console->setRowCount(n);
 
-    time2str(time, tstr, 9);
-    Label->setText(time.time ? QString(tr("Time: %1")).arg(tstr) : s0);
-    for (i = 0, n = 0; i < nx; i++) {
-        if (SelSat->currentIndex() == 1 && (x[i] == 0.0 || P[i + i * nx] == 0.0)) continue;
-        Console->setColumnWidth(n, 45 * FontScale / 96);
-        Console->setHorizontalHeaderItem(n, new QTableWidgetItem(QString(tr("X_%1")).arg(i + 1)));
-        Console->setVerticalHeaderItem(n, new QTableWidgetItem(QString(tr("X_%1")).arg(i + 1)));
-        for (j = 0, m = 0; j < nx; j++) {
-            if (SelSat->currentIndex() == 1 && (x[j] == 0.0 || P[j + j * nx] == 0.0)) continue;
-            Console->setItem(n, m, new QTableWidgetItem(P[i + j * nx] == 0.0 ? s0 : QString::number(SQRT(P[i + j * nx]), 'f', 5)));
+	time2str(time,tstr,9);
+    Label->setText(time.time?QString(tr("Time: %1")).arg(tstr):s0);
+    for (i=0,n=0;i<nx;i++) {
+        if (SelSat->currentIndex()==1&&(x[i]==0.0||P[i+i*nx]==0.0)) continue;
+        Console->setColumnWidth(n,45*FontScale/96);
+        Console->setHorizontalHeaderItem(n, new QTableWidgetItem(QString(tr("X_%1")).arg(i+1)));
+        Console->setVerticalHeaderItem(n, new QTableWidgetItem(QString(tr("X_%1")).arg(i+1)));
+        for (j=0,m=0;j<nx;j++) {
+            if (SelSat->currentIndex()==1&&(x[j]==0.0||P[j+j*nx]==0.0)) continue;
+            Console->setItem(n,m, new QTableWidgetItem(P[i+j*nx]==0.0?s0:QString::number(SQRT(P[i+j*nx]),'f',5)));
 			m++;
 		}
 		n++;
@@ -914,82 +922,91 @@
 //---------------------------------------------------------------------------
 void MonitorDialog::SetObs(void)
 {
-    const QString label[] = { tr("Trcv (GPST)"), tr("SAT"), tr("RCV") };
-    int i, j = 0, width[] = { 135, 25, 25 }, freq[] = { 1, 2, 5, 6, 7, 8 };
-    int nex = ObsMode ? NEXOBS : 0;
-
-    Console->setColumnCount(3 + (NFREQ + nex) * 6);
+    QString label[]={tr("Trcv (GPST)"),tr("SAT"),tr("RCV")};
+	int i,j=0,width[]={135,25,25},freq[]={1,2,5,6,7,8};
+	int nex=ObsMode?NEXOBS:0;
+	
+    Console->setColumnCount(3+(NFREQ+nex)*6);
     Console->setRowCount(0);
     header.clear();
 
-    for (i = 0; i < 3; i++) {
-        Console->setColumnWidth(j++, width[i] * FontScale / 96);
-        header << label[i];
-	}
-    for (i = 0; i < NFREQ + nex; i++) {
-        Console->setColumnWidth(j++, 80 * FontScale / 96);
-        header << (i < NFREQ ? QString(tr("P%1 (m)")).arg(freq[i]) : QString(tr("PX%1 (m)")).arg(i - NFREQ + 1));
+	for (i=0;i<3;i++) {
+        Console->setColumnWidth(j++,width[i]*FontScale/96);
+        header<<label[i];
     }
-    for (i = 0; i < NFREQ + nex; i++) {
-        Console->setColumnWidth(j++, 85 * FontScale / 96);
-        header << (i < NFREQ ? QString(tr("L%1 (cycle)")).arg(freq[i]) : QString(tr("LX%1 (cycle)")).arg(i - NFREQ + 1));
+	for (i=0;i<NFREQ+nex;i++) {
+        Console->setColumnWidth(j++,80*FontScale/96);
+        header<<(i<NFREQ?QString(tr("P%1 (m)")).arg(freq[i]):QString(tr("PX%1 (m)")).arg(i-NFREQ+1));
 	}
-    for (i = 0; i < NFREQ + nex; i++) {
-        Console->setColumnWidth(j++, 60 * FontScale / 96);
-        header << (i < NFREQ ? QString(tr("D%1 (Hz)")).arg(freq[i]) : QString(tr("DX%1 (Hz)")).arg(i - NFREQ + 1));
+	for (i=0;i<NFREQ+nex;i++) {
+        Console->setColumnWidth(j++,85*FontScale/96);
+        header<<(i<NFREQ?QString(tr("L%1 (cycle)")).arg(freq[i]):QString(tr("LX%1 (cycle)")).arg(i-NFREQ+1));
 	}
-    for (i = 0; i < NFREQ + nex; i++) {
-        Console->setColumnWidth(j++, 30 * FontScale / 96);
-        header << (i < NFREQ ? QString(tr("S%1")).arg(freq[i]) : QString(tr("SX%1")).arg(i - NFREQ + 1));
+	for (i=0;i<NFREQ+nex;i++) {
+        Console->setColumnWidth(j++,60*FontScale/96);
+        header<<(i<NFREQ?QString(tr("D%1 (Hz)")).arg(freq[i]):QString(tr("DX%1 (Hz)")).arg(i-NFREQ+1));
 	}
-    for (i = 0; i < NFREQ + nex; i++) {
-        Console->setColumnWidth(j++, 15 * FontScale / 96);
-        header << "I";
+	for (i=0;i<NFREQ+nex;i++) {
+        Console->setColumnWidth(j++,30*FontScale/96);
+        header<<(i<NFREQ?QString(tr("S%1")).arg(freq[i]):QString(tr("SX%1")).arg(i-NFREQ+1));
 	}
-    for (i = 0; i < NFREQ + nex; i++) {
-        Console->setColumnWidth(j++, 30 * FontScale / 96);
-        header << (i < NFREQ ? QString(tr("C%1")).arg(freq[i]) : QString(tr("CX%1")).arg(i - NFREQ + 1));
+	for (i=0;i<NFREQ+nex;i++) {
+        Console->setColumnWidth(j++,15*FontScale/96);
+        header<<"I";
+	}
+	for (i=0;i<NFREQ+nex;i++) {
+        Console->setColumnWidth(j++,30*FontScale/96);
+        header<<(i<NFREQ?QString(tr("C%1")).arg(freq[i]):QString(tr("CX%1")).arg(i-NFREQ+1));
 	}
     Console->setHorizontalHeaderLabels(header);
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::ShowObs(void)
 {
-    obsd_t obs[MAXOBS * 2];
-    char tstr[64], id[32], *code;
-    int i, k, n = 0, nex = ObsMode ? NEXOBS : 0;
-
+	obsd_t obs[MAXOBS*2];
+	char tstr[64],id[32],*code;
+    int i,k,n=0,nex=ObsMode?NEXOBS:0;
+	
 	rtksvrlock(&rtksvr);
-    for (i = 0; i < rtksvr.obs[0][0].n && n < MAXOBS * 2; i++) obs[n++] = rtksvr.obs[0][0].data[i];
-    for (i = 0; i < rtksvr.obs[1][0].n && n < MAXOBS * 2; i++) obs[n++] = rtksvr.obs[1][0].data[i];
+	for (i=0;i<rtksvr.obs[0][0].n&&n<MAXOBS*2;i++) {
+		obs[n++]=rtksvr.obs[0][0].data[i];
+	}
+	for (i=0;i<rtksvr.obs[1][0].n&&n<MAXOBS*2;i++) {
+		obs[n++]=rtksvr.obs[1][0].data[i];
+	}
 	rtksvrunlock(&rtksvr);
 
-    Console->setRowCount(n + 1 < 2 ? 0 : n);
-    Console->setColumnCount(3 + (NFREQ + nex) * 6);
+    Console->setRowCount(n+1<2?0:n);
+    Console->setColumnCount(3+(NFREQ+nex)*6);
     Label->setText("");
     Console->setHorizontalHeaderLabels(header);
 
-    for (i = 0; i < n; i++) {
-        int j = 0;
-        time2str(obs[i].time, tstr, 3);
-        Console->setItem(i, j++, new QTableWidgetItem(tstr));
-        satno2id(obs[i].sat, id);
-        Console->setItem(i, j++, new QTableWidgetItem(id));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(obs[i].rcv)));
-        for (k = 0; k < NFREQ + nex; k++)
-            Console->setItem(i, j++, new QTableWidgetItem(QString::number(obs[i].P[k], 'f', 3)));
-        for (k = 0; k < NFREQ + nex; k++)
-            Console->setItem(i, j++, new QTableWidgetItem(QString::number(obs[i].L[k], 'f', 3)));
-        for (k = 0; k < NFREQ + nex; k++)
-            Console->setItem(i, j++, new QTableWidgetItem(QString::number(obs[i].D[k], 'f', 3)));
-        for (k = 0; k < NFREQ + nex; k++)
-            Console->setItem(i, j++, new QTableWidgetItem(QString::number(obs[i].SNR[k] * 0.25, 'f', 1)));
-        for (k = 0; k < NFREQ + nex; k++)
-            Console->setItem(i, j++, new QTableWidgetItem(QString::number(obs[i].LLI[k])));
-        for (k = 0; k < NFREQ + nex; k++) {
-            code = code2obs(obs[i].code[k], NULL);
-            if (*code) Console->setItem(i, j++, new QTableWidgetItem(QString(tr("L%1")).arg(code)));
-            else Console->setItem(i, j++, new QTableWidgetItem(""));
+	for (i=0;i<n;i++) {
+        int j=0;
+		time2str(obs[i].time,tstr,3);
+        Console->setItem(i,j++, new QTableWidgetItem(tstr));
+		satno2id(obs[i].sat,id);
+        Console->setItem(i,j++, new QTableWidgetItem(id));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(obs[i].rcv)));
+		for (k=0;k<NFREQ+nex;k++) {
+            Console->setItem(i,j++, new QTableWidgetItem(QString::number(obs[i].P[k],'f',3)));
+		}
+		for (k=0;k<NFREQ+nex;k++) {
+            Console->setItem(i,j++, new QTableWidgetItem(QString::number(obs[i].L[k],'f',3)));
+		}
+		for (k=0;k<NFREQ+nex;k++) {
+            Console->setItem(i,j++, new QTableWidgetItem(QString::number(obs[i].D[k],'f',3)));
+		}
+		for (k=0;k<NFREQ+nex;k++) {
+            Console->setItem(i,j++, new QTableWidgetItem(QString::number(obs[i].SNR[k]*0.25,'f',1)));
+		}
+		for (k=0;k<NFREQ+nex;k++) {
+            Console->setItem(i,j++, new QTableWidgetItem(QString::number(obs[i].LLI[k])));
+		}
+		for (k=0;k<NFREQ+nex;k++) {
+			code=code2obs(obs[i].code[k],NULL);
+            if (*code) Console->setItem(i,j++, new QTableWidgetItem(QString(tr("L%1")).arg(code)));
+            else       Console->setItem(i,j++, new QTableWidgetItem(""));
 		}
 	}
 }
@@ -997,20 +1014,21 @@
 void MonitorDialog::SetNav(void)
 {
     header.clear();
-    header	<< tr("SAT") << tr("PRN") << tr("Status") << tr("IODE") << tr("IODC") << tr("Accuracy") << tr("Health") << tr("Toe") << tr("Toc") << tr("Ttrans")
-        << tr("A (m)") << tr("e") << tr("i0 (deg)") << tr("OMEGA0 (deg)") << tr("omega (deg)") << tr("M0 (deg)")
-        << tr("deltan (deg/s)") << tr("OMEGAdot (deg/s)") << tr("IDOT (deg/s)")
-        << tr("af0 (ns)") << tr("af1 (ns/s)") << tr("af2 (ns/s2)") << tr("TGD (ns)") << tr("BGD5a(ns)") << tr("BGD5b(ns)")
-        << tr("Cuc(rad)") << tr("Cus(rad)") << tr("Crc(m)") << tr("Crs(m)") << tr("Cic(rad)") << tr("Cis(rad)") << tr("Code") << tr("Flag");
-    int i, width[] = {
-        25, 25, 30, 30, 30, 25, 25, 115, 115, 115, 80, 70, 60, 60, 60, 60, 70, 70, 70, 60,
-        50, 50, 50, 50, 50, 70, 70, 70,	 70,  70,  70, 30, 30
+    header<<tr("SAT")<<tr("PRN")<<tr("Status")<<tr("IODE")<<tr("IODC")<<tr("Accuracy")<<tr("Health")<<tr("Toe")<<tr("Toc")<<tr("Ttrans")
+        <<tr("A (m)")<<tr("e")<<tr("i0 (deg)")<<tr("OMEGA0 (deg)")<<tr("omega (deg)")<<tr("M0 (deg)")
+        <<tr("deltan (deg/s)")<<tr("OMEGAdot (deg/s)")<<tr("IDOT (deg/s)")
+        <<tr("af0 (ns)")<<tr("af1 (ns/s)")<<tr("af2 (ns/s2)")<<tr("TGD (ns)")<<tr("BGD5a(ns)")<<tr("BGD5b(ns)")
+        <<tr("Cuc(rad)")<<tr("Cus(rad)")<<tr("Crc(m)")<<tr("Crs(m)")<<tr("Cic(rad)")<<tr("Cis(rad)")<<tr("Code")<<tr("Flag");
+	int i,width[]={
+		25,25,30,30,30,25,25,115,115,115, 80,70,60,60,60,60,70,70,70,60,
+		50,50,50,50,50,70,70,70,70,70, 70,30,30
 	};
     Console->setColumnCount(33);
     Console->setRowCount(2);
 
-    for (i = 0; i < Console->columnCount(); i++)
-        Console->setColumnWidth(i, width[i] * FontScale / 96);
+    for (i=0;i<Console->columnCount();i++) {
+        Console->setColumnWidth(i,width[i]*FontScale/96);
+	}
     Console->setHorizontalHeaderLabels(header);
 }
 //---------------------------------------------------------------------------
@@ -1019,75 +1037,75 @@
 	eph_t eph[MAXSAT];
 	gtime_t time;
     QString s;
-    char tstr[64], id[32];
-    int i, k, n, prn, off = SelEph->currentIndex() ? MAXSAT : 0;
+	char tstr[64],id[32];
+    int i,k,n,prn,off=SelEph->currentIndex()?MAXSAT:0;
     bool valid;
-
+	
 	rtksvrlock(&rtksvr);
-    time = rtksvr.rtk.sol.time;
-    for (i = 0; i < MAXSAT; i++) eph[i] = rtksvr.nav.eph[i + off];
+	time=rtksvr.rtk.sol.time;
+	for (i=0;i<MAXSAT;i++) eph[i]=rtksvr.nav.eph[i+off];
 	rtksvrunlock(&rtksvr);
-
+	
     Label->setText("");
-
-    for (k = 0, n = 1; k < MAXSAT; k++) {
-        if (!(satsys(k + 1, &prn) & sys)) continue;
-        valid = eph[k].toe.time != 0 && !eph[k].svh && fabs(timediff(time, eph[k].toe)) <= MAXDTOE;
-        if (SelSat->currentIndex() == 1 && !valid) continue;
+	
+	for (k=0,n=1;k<MAXSAT;k++) {
+		if (!(satsys(k+1,&prn)&sys)) continue;
+		valid=eph[k].toe.time!=0&&!eph[k].svh&&fabs(timediff(time,eph[k].toe))<=MAXDTOE;
+        if (SelSat->currentIndex()==1&&!valid) continue;
 		n++;
 	}
-    if (n < 2) {
+	if (n<2) {
         Console->setRowCount(0);
 		return;
 	}
     Console->setRowCount(MAXSAT);
     Console->setHorizontalHeaderLabels(header);
 
-    for (k = 0, n = 0; k < MAXSAT; k++) {
-        int j = 0;
-        if (!(satsys(k + 1, &prn) & sys)) continue;
-        valid = eph[k].toe.time != 0 && !eph[k].svh && fabs(timediff(time, eph[k].toe)) <= MAXDTOE;
-        if (SelSat->currentIndex() == 1 && !valid) continue;
-        satno2id(k + 1, id);
-        Console->setItem(n, j++, new QTableWidgetItem(id));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(prn)));
-        Console->setItem(n, j++, new QTableWidgetItem(valid ? tr("OK") : tr("-")));
-        if (eph[k].iode < 0) s = "-"; else s = QString::number(eph[k].iode);
-        Console->setItem(n, j++, new QTableWidgetItem(s));
-        if (eph[k].iodc < 0) s = "-"; else s = QString::number(eph[k].iodc);
-        Console->setItem(n, j++, new QTableWidgetItem(s));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].sva)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].svh, 16)));
-        if (eph[k].toe.time != 0) time2str(eph[k].toe, tstr, 0); else strcpy(tstr, "-");
-        Console->setItem(n, j++, new QTableWidgetItem(tstr));
-        if (eph[k].toc.time != 0) time2str(eph[k].toc, tstr, 0); else strcpy(tstr, "-");
-        Console->setItem(n, j++, new QTableWidgetItem(tstr));
-        if (eph[k].ttr.time != 0) time2str(eph[k].ttr, tstr, 0); else strcpy(tstr, "-");
-        Console->setItem(n, j++, new QTableWidgetItem(tstr));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].A, 'f', 3)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].e, 'f', 8)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].i0 * R2D, 'f', 5)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].OMG0 * R2D, 'f', 5)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].omg * R2D, 'f', 5)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].M0 * R2D, 'f', 5)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].deln * R2D, 'E', 4)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].OMGd * R2D, 'E', 4)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].idot * R2D, 'E', 4)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].f0 * 1E9, 'f', 1)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].f1 * 1E9, 'f', 4)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].f2 * 1E9, 'f', 4)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].tgd[0] * 1E9, 'f', 1)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].tgd[1] * 1E9, 'f', 1)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].tgd[2] * 1E9, 'f', 1)));
-
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].cuc, 'E', 4)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].cus, 'E', 4)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].crc, 'E', 4)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].crs, 'E', 4)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].cic, 'E', 4)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].cis, 'E', 4)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].code)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(eph[k].flag)));
+    for (k=0,n=0;k<MAXSAT;k++) {
+        int j=0;
+		if (!(satsys(k+1,&prn)&sys)) continue;
+		valid=eph[k].toe.time!=0&&!eph[k].svh&&fabs(timediff(time,eph[k].toe))<=MAXDTOE;
+        if (SelSat->currentIndex()==1&&!valid) continue;
+		satno2id(k+1,id);
+        Console->setItem(n,j++, new QTableWidgetItem(id));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(prn)));
+        Console->setItem(n,j++, new QTableWidgetItem(valid?tr("OK"):tr("-")));
+        if (eph[k].iode<0) s="-"; else QString::number(eph[k].iode);
+        Console->setItem(n,j++, new QTableWidgetItem(s));
+        if (eph[k].iodc<0) s="-"; else QString::number(eph[k].iodc);
+        Console->setItem(n,j++, new QTableWidgetItem(s));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].sva)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].svh,16)));
+		if (eph[k].toe.time!=0) time2str(eph[k].toe,tstr,0); else strcpy(tstr,"-");
+        Console->setItem(n,j++, new QTableWidgetItem(tstr));
+		if (eph[k].toc.time!=0) time2str(eph[k].toc,tstr,0); else strcpy(tstr,"-");
+        Console->setItem(n,j++, new QTableWidgetItem(tstr));
+		if (eph[k].ttr.time!=0) time2str(eph[k].ttr,tstr,0); else strcpy(tstr,"-");
+        Console->setItem(n,j++, new QTableWidgetItem(tstr));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].A,'f',3)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].e,'f',8)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].i0  *R2D,'f',5)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].OMG0*R2D,'f',5)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].omg *R2D,'f',5)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].M0  *R2D,'f',5)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].deln*R2D,'E',4)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].OMGd*R2D,'E',4)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].idot*R2D,'E',4)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].f0*1E9,'f',1)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].f1*1E9,'f',4)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].f2*1E9,'f',4)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].tgd[0]*1E9,'f',1)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].tgd[1]*1E9,'f',1)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].tgd[2]*1E9,'f',1)));
+		
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].cuc,'E',4)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].cus,'E',4)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].crc,'E',4)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].crs,'E',4)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].cic,'E',4)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].cis,'E',4)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].code)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(eph[k].flag)));
         n++;
 	}
     Console->setRowCount(n);
@@ -1096,17 +1114,18 @@
 void MonitorDialog::SetGnav(void)
 {
     header.clear();
-    header	<< tr("SAT") << tr("PRN") << tr("Status") << tr("IOD") << tr("Freq") << tr("Health") << tr("Age(days)") << tr("Toe") << tr("Tof")
-        << tr("X (m)") << tr("Y (m)") << tr("Z (m)") << tr("VX (m/s)") << tr("VY (m/s)") << tr("VZ (m/s)")
-        << tr("AX (m/s2)") << tr("AY (m/s2)") << tr("AZ (m/s2)") << tr("Tau (ns)") << tr("Gamma (ns/s)");
+    header<<tr("SAT")<<tr("PRN")<<tr("Status")<<tr("IOD")<<tr("Freq")<<tr("Health")<<tr("Age(days)")<<tr("Toe")<<tr("Tof")
+        <<tr("X (m)")<<tr("Y (m)")<<tr("Z (m)")<<tr("VX (m/s)")<<tr("VY (m/s)")<<tr("VZ (m/s)")
+        <<tr("AX (m/s2)")<<tr("AY (m/s2)")<<tr("AZ (m/s2)")<<tr("Tau (ns)")<<tr("Gamma (ns/s)");
 
-    int i, width[] = {
-        25, 25, 30, 30, 30, 25, 25, 115, 115, 75, 75, 75, 70, 70, 70, 65, 65, 65, 60, 60
+	int i,width[]={
+		25,25,30,30,30,25,25,115,115,75,75,75,70,70,70,65,65,65,60,60
 	};
     Console->setColumnCount(20);
     Console->setRowCount(1);
-    for (i = 0; i < Console->columnCount(); i++)
-        Console->setColumnWidth(i, width[i] * FontScale / 96);
+    for (i=0;i<Console->columnCount();i++) {
+        Console->setColumnWidth(i,width[i]*FontScale/96);
+	}
     Console->setHorizontalHeaderLabels(header);
 }
 //---------------------------------------------------------------------------
@@ -1115,59 +1134,59 @@
 	geph_t geph[NSATGLO];
 	gtime_t time;
     QString s;
-    char tstr[64], id[32];
-    int i, n, valid, prn, off = SelEph->currentIndex() ? NSATGLO : 0;
-
+	char tstr[64],id[32];
+    int i,n,valid,prn,off=SelEph->currentIndex()?NSATGLO:0;
+	
 	rtksvrlock(&rtksvr);
-    time = rtksvr.rtk.sol.time;
-    for (i = 0; i < NSATGLO; i++) geph[i] = rtksvr.nav.geph[i + off];
+	time=rtksvr.rtk.sol.time;
+	for (i=0;i<NSATGLO;i++) geph[i]=rtksvr.nav.geph[i+off];
 	rtksvrunlock(&rtksvr);
-
+	
     Label->setText("");
-
-    for (i = 0, n = 0; i < NSATGLO; i++) {
-        valid = geph[i].toe.time != 0 && !geph[i].svh &&
-            fabs(timediff(time, geph[i].toe)) <= MAXDTOE_GLO;
-        if (SelSat->currentIndex() == 1 && !valid) continue;
+	
+    for (i=0,n=0;i<NSATGLO;i++) {
+		valid=geph[i].toe.time!=0&&!geph[i].svh&&
+			  fabs(timediff(time,geph[i].toe))<=MAXDTOE_GLO;
+        if (SelSat->currentIndex()==1&&!valid) continue;
 		n++;
 	}
-    if (n < 2) {
+	if (n<2) {
         Console->setRowCount(1);
 		return;
 	}
     Console->setRowCount(n);
     Console->setHorizontalHeaderLabels(header);
 
-    for (i = 0, n = 0; i < NSATGLO; i++) {
-        int j = 0;
-        valid = geph[i].toe.time != 0 && !geph[i].svh &&
-            fabs(timediff(time, geph[i].toe)) <= MAXDTOE_GLO;
-        if (SelSat->currentIndex() == 1 && !valid) continue;
-        prn = MINPRNGLO + i;
-        satno2id(satno(SYS_GLO, prn), id);
-        Console->setItem(n, j++, new QTableWidgetItem(id));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(prn)));
-        Console->setItem(n, j++, new QTableWidgetItem(valid ? tr("OK") : tr("-")));
-        if (geph[i].iode < 0) s = "-"; else s = QString::number(geph[i].iode);
-        Console->setItem(n, j++, new QTableWidgetItem(s));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(geph[i].frq)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(geph[i].svh)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(geph[i].age)));
-        if (geph[i].toe.time != 0) time2str(geph[i].toe, tstr, 0); else strcpy(tstr, "-");
-        Console->setItem(n, j++, new QTableWidgetItem(tstr));
-        if (geph[i].tof.time != 0) time2str(geph[i].tof, tstr, 0); else strcpy(tstr, "-");
-        Console->setItem(n, j++, new QTableWidgetItem(tstr));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(geph[i].pos[0], 'f', 2)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(geph[i].pos[1], 'f', 2)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(geph[i].pos[2], 'f', 2)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(geph[i].vel[0], 'f', 5)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(geph[i].vel[1], 'f', 5)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(geph[i].vel[2], 'f', 5)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(geph[i].acc[0], 'f', 7)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(geph[i].acc[1], 'f', 7)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(geph[i].acc[2], 'f', 7)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(geph[i].taun * 1E9, 'f', 1)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(geph[i].gamn * 1E9, 'f', 4)));
+	for (i=0,n=1;i<NSATGLO;i++) {
+        int j=0;
+		valid=geph[i].toe.time!=0&&!geph[i].svh&&
+			  fabs(timediff(time,geph[i].toe))<=MAXDTOE_GLO;
+        if (SelSat->currentIndex()==1&&!valid) continue;
+		prn=MINPRNGLO+i;
+		satno2id(satno(SYS_GLO,prn),id);
+        Console->setItem(i,j++, new QTableWidgetItem(id));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(prn)));
+        Console->setItem(i,j++, new QTableWidgetItem(valid?tr("OK"):tr("-")));
+        if (geph[i].iode<0) s="-"; else QString::number(geph[i].iode);
+        Console->setItem(i,j++, new QTableWidgetItem(s));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(geph[i].frq)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(geph[i].svh)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(geph[i].age)));
+		if (geph[i].toe.time!=0) time2str(geph[i].toe,tstr,0); else strcpy(tstr,"-");
+        Console->setItem(i,j++, new QTableWidgetItem(tstr));
+		if (geph[i].tof.time!=0) time2str(geph[i].tof,tstr,0); else strcpy(tstr,"-");
+        Console->setItem(i,j++, new QTableWidgetItem(tstr));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(geph[i].pos[0],'f',2)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(geph[i].pos[1],'f',2)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(geph[i].pos[2],'f',2)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(geph[i].vel[0],'f',5)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(geph[i].vel[1],'f',5)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(geph[i].vel[2],'f',5)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(geph[i].acc[0],'f',7)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(geph[i].acc[1],'f',7)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(geph[i].acc[2],'f',7)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(geph[i].taun*1E9,'f',1)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(geph[i].gamn*1E9,'f',4)));
 		n++;
 	}
 }
@@ -1175,82 +1194,86 @@
 void MonitorDialog::SetSbsNav(void)
 {
     header.clear();
-    header	<< tr("SAT") << tr("PRN") << tr("Status") << tr("T0") << tr("Tof") << tr("Health") << tr("URA") << tr("X (m)") << tr("Y (m)") << tr("Z (m)") << tr("VX (m/s)")
-        << tr("VY (m/s)") << tr("VZ (m/s)") << tr("AX (m/s2)") << tr("AY (m/s2)") << tr("AZ (m/s2)")
-        << tr("af0 (ns)") << tr("af1 (ns/s)");
-
-    int i, width[] = { 25, 25, 30, 115, 115, 30, 30, 75, 75, 75, 70, 70, 70, 65, 65, 65, 60, 60 };
+    header<<tr("SAT")<<tr("PRN")<<tr("Status")<<tr("T0")<<tr("Tof")<<tr("Health")<<tr("URA")<<tr("X (m)")<<tr("Y (m)")<<tr("Z (m)")<<tr("VX (m/s)")
+        <<tr("VY (m/s)")<<tr("VZ (m/s)")<<tr("AX (m/s2)")<<tr("AY (m/s2)")<<tr("AZ (m/s2)")
+        <<tr("af0 (ns)")<<tr("af1 (ns/s)");
 
+    int i,width[]={25,25,30,115,115,30,30,75,75,75,70,70,70,65,65,65,60,60};
+	
     Console->setColumnCount(17);
     Console->setRowCount(1);
-    for (i = 0; i < Console->columnCount(); i++)
-        Console->setColumnWidth(i, width[i] * FontScale / 96);
+    for (i=0;i<Console->columnCount();i++) {
+        Console->setColumnWidth(i,width[i]*FontScale/96);
+	}
     Console->setHorizontalHeaderLabels(header);
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::ShowSbsNav(void)
 {
-    seph_t seph[MAXPRNSBS - MINPRNSBS + 1];
+    seph_t seph[MAXPRNSBS-MINPRNSBS+1];
 	gtime_t time;
-    int i, n, valid, prn, off = SelEph->currentIndex() ? NSATSBS : 0;
-    char tstr[64], id[32];
+    int i,n,valid,prn,off=SelEph->currentIndex()?NSATSBS:0;
+	char tstr[64],id[32];
 
-    for (int i = 0; i < MAXPRNSBS - MINPRNSBS + 1; i++) {
-        seph[i].sat = seph[i].sva = seph[i].svh = 0;
-        seph[i].t0.time = seph[i].tof.time = 0;
-        seph[i].t0.sec = seph[i].tof.sec = 0;
-        seph[i].pos[0] = seph[i].pos[1] = seph[i].pos[2] = seph[i].vel[0] = seph[i].vel[1] = seph[i].vel[2] = seph[i].acc[0] = seph[i].acc[1] = seph[i].acc[2] = seph[i].af0 = seph[i].af1 = 0;
+    for (int i=0;i<MAXPRNSBS-MINPRNSBS+1; i++)
+    {
+        seph[i].sat=seph[i].sva=seph[i].svh=0;
+        seph[i].t0.time=seph[i].tof.time=0;
+        seph[i].t0.sec=seph[i].tof.sec=0;
+        seph[i].pos[0]=seph[i].pos[1]=seph[i].pos[2]=seph[i].vel[0]=seph[i].vel[1]=seph[i].vel[2]=seph[i].acc[0]=seph[i].acc[1]=seph[i].acc[2]=seph[i].af0=seph[i].af1=0;
     };
-
+	
 	rtksvrlock(&rtksvr); // lock
-    time = rtksvr.rtk.sol.time;
-    for (int i = 0; i < NSATSBS; i++) seph[i] = rtksvr.nav.seph[i + off];
+	time=rtksvr.rtk.sol.time;
+	for (int i=0;i<NSATSBS;i++) {
+		seph[i]=rtksvr.nav.seph[i+off];
+	}
 	rtksvrunlock(&rtksvr); // unlock
-
+	
     Label->setText("");
-
-    for (i = 0, n = 0; i < NSATSBS; i++) {
-        valid = fabs(timediff(time, seph[i].t0)) <= MAXDTOE_SBS &&
-            seph[i].t0.time && !seph[i].svh;
-        if (SelSat->currentIndex() == 1 && !valid) continue;
+	
+    for (i=0,n=0;i<NSATSBS;i++) {
+        valid=fabs(timediff(time,seph[i].t0))<=MAXDTOE_SBS&&
+			  seph[i].t0.time&&!seph[i].svh;
+        if (SelSat->currentIndex()==1&&!valid) continue;
 		n++;
 	}
-    if (n < 1) {
+    if (n<1) {
         Console->setRowCount(0);
 		return;
 	}
     Console->setRowCount(n);
     Console->setHorizontalHeaderLabels(header);
 
-    for (i = 0, n = 0; i < NSATSBS; i++) {
-        int j = 0;
-        valid = fabs(timediff(time, seph[i].t0)) <= MAXDTOE_SBS &&
-            seph[i].t0.time && !seph[i].svh;
-        if (SelSat->currentIndex() == 1 && !valid) continue;
-        prn = MINPRNSBS + i;
-        satno2id(satno(SYS_SBS, prn), id);
-        Console->setItem(i, j++, new QTableWidgetItem(id));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(prn)));
-        Console->setItem(i, j++, new QTableWidgetItem(valid ? tr("OK") : tr("-")));
-        if (seph[i].t0.time) time2str(seph[i].t0, tstr, 0);
-        else strcpy(tstr, "-");
-        Console->setItem(i, j++, new QTableWidgetItem(tstr));
-        if (seph[i].tof.time) time2str(seph[i].tof, tstr, 0);
-        else strcpy(tstr, "-");
-        Console->setItem(i, j++, new QTableWidgetItem(tstr));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(seph[i].svh, 16)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(seph[i].sva)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(seph[i].pos[0], 'f', 2)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(seph[i].pos[1], 'f', 2)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(seph[i].pos[2], 'f', 2)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(seph[i].vel[0], 'f', 6)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(seph[i].vel[1], 'f', 6)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(seph[i].vel[2], 'f', 6)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(seph[i].acc[0], 'f', 7)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(seph[i].acc[1], 'f', 7)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(seph[i].acc[2], 'f', 7)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(seph[i].af0 * 1E9, 'f', 1)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(seph[i].af1 * 1E9, 'f', 4)));
+    for (i=0,n=0;i<NSATSBS;i++) {
+        int j=0;
+        valid=fabs(timediff(time,seph[i].t0))<=MAXDTOE_SBS&&
+			  seph[i].t0.time&&!seph[i].svh;
+        if (SelSat->currentIndex()==1&&!valid) continue;
+		prn=MINPRNSBS+i;
+		satno2id(satno(SYS_SBS,prn),id);
+        Console->setItem(i,j++, new QTableWidgetItem(id));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(prn)));
+        Console->setItem(i,j++, new QTableWidgetItem(valid?tr("OK"):tr("-")));
+		if (seph[i].t0.time) time2str(seph[i].t0,tstr,0);
+		else strcpy(tstr,"-");
+        Console->setItem(i,j++, new QTableWidgetItem(tstr));
+		if (seph[i].tof.time) time2str(seph[i].tof,tstr,0);
+		else strcpy(tstr,"-");
+        Console->setItem(i,j++, new QTableWidgetItem(tstr));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(seph[i].svh,16)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(seph[i].sva)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(seph[i].pos[0],'f',2)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(seph[i].pos[1],'f',2)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(seph[i].pos[2],'f',2)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(seph[i].vel[0],'f',6)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(seph[i].vel[1],'f',6)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(seph[i].vel[2],'f',6)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(seph[i].acc[0],'f',7)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(seph[i].acc[1],'f',7)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(seph[i].acc[2],'f',7)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(seph[i].af0*1E9,'f',1)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(seph[i].af1*1E9,'f',4)));
 		n++;
 	}
 }
@@ -1258,248 +1281,251 @@
 void MonitorDialog::SetIonUtc(void)
 {
     header.clear();
-    header << tr("Parameter") << tr("Value");
-    int i, width[] = { 220, 380 };
-
+    header<<tr("Parameter")<<tr("Value");
+	int i,width[]={220,380};
+	
     Console->setColumnCount(2);
     Console->setRowCount(1);
-    for (i = 0; i < Console->columnCount(); i++)
-        Console->setColumnWidth(i, width[i] * FontScale / 96);
+    for (i=0;i<Console->columnCount();i++) {
+        Console->setColumnWidth(i,width[i]*FontScale/96);
+	}
     Console->setHorizontalHeaderLabels(header);
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::ShowIonUtc(void)
 {
-    double utc_gps[4], utc_glo[4], utc_gal[4], utc_qzs[4];
-    double ion_gps[8], ion_gal[4], ion_qzs[8];
+	double utc_gps[4],utc_glo[4],utc_gal[4],utc_qzs[4];
+	double ion_gps[8],ion_gal[4],ion_qzs[8];
 	gtime_t time;
-    double tow = 0.0;
+	double tow=0.0;
 	char tstr[64];
-    int i, leaps, week = 0;
-
+    int i,leaps,week=0;
     Q_UNUSED(utc_glo);
-
+	
 	rtksvrlock(&rtksvr);
-    time = rtksvr.rtk.sol.time;
-    for (i = 0; i < 4; i++) utc_gps[i] = rtksvr.nav.utc_gps[i];
-    for (i = 0; i < 4; i++) utc_glo[i] = rtksvr.nav.utc_glo[i];
-    for (i = 0; i < 4; i++) utc_gal[i] = rtksvr.nav.utc_gal[i];
-    for (i = 0; i < 4; i++) utc_qzs[i] = rtksvr.nav.utc_qzs[i];
-    for (i = 0; i < 8; i++) ion_gps[i] = rtksvr.nav.ion_gps[i];
-    for (i = 0; i < 4; i++) ion_gal[i] = rtksvr.nav.ion_gal[i];
-    for (i = 0; i < 8; i++) ion_qzs[i] = rtksvr.nav.ion_qzs[i];
-    leaps = rtksvr.nav.leaps;
+	time=rtksvr.rtk.sol.time;
+	for (i=0;i<4;i++) utc_gps[i]=rtksvr.nav.utc_gps[i];
+	for (i=0;i<4;i++) utc_glo[i]=rtksvr.nav.utc_glo[i];
+	for (i=0;i<4;i++) utc_gal[i]=rtksvr.nav.utc_gal[i];
+	for (i=0;i<4;i++) utc_qzs[i]=rtksvr.nav.utc_qzs[i];
+	for (i=0;i<8;i++) ion_gps[i]=rtksvr.nav.ion_gps[i];
+	for (i=0;i<4;i++) ion_gal[i]=rtksvr.nav.ion_gal[i];
+	for (i=0;i<8;i++) ion_qzs[i]=rtksvr.nav.ion_qzs[i];
+	leaps=rtksvr.nav.leaps;
 	rtksvrunlock(&rtksvr);
-
+	
     Label->setText("");
-
+	
     Console->setRowCount(16);
     Console->setHorizontalHeaderLabels(header);
-    i = 0;
-
-    time2str(timeget(), tstr, 3);
-    Console->setItem(i, 0, new QTableWidgetItem(tr("CPU Time (UTC)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(tstr));
-
-    if (time.time != 0) time2str(gpst2utc(time), tstr, 3); else strcpy(tstr, "-");
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Receiver Time (UTC)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(tstr));
-
-    if (time.time != 0) time2str(time, tstr, 3); else strcpy(tstr, "-");
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Receiver Time (GPST)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(tstr));
-
-    if (time.time != 0) tow = time2gpst(time, &week);
-    Console->setItem(i, 0, new QTableWidgetItem(tr("GPS Week/Time (s)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2").arg(week).arg(tow, 0, 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Leap Seconds (GPST-UTC) (s)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(leaps)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("GPST-UTC Reference Week/Time (s)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2").arg(utc_gps[3], 0, 'f', 0).arg(utc_gps[2], 0, 'f', 0)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("GPST-UTC A0(ns),A1(ns/s)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2").arg(utc_gps[0] * 1E9, 0, 'f', 3).arg(utc_gps[1] * 1E9, 0, 'f', 6)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("GST-GPS Reference Week/Time (s)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2").arg(utc_gal[3], 0, 'f', 0).arg(utc_gal[2], 0, 'f', 0)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("GST-GPS A0(ns),A1(ns/s)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2").arg(utc_gal[0] * 1E9, 0, 'f', 3).arg(utc_gal[1] * 1E9, 0, 'f', 6)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("QZST-GPS Reference Week/Time (s)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2").arg(utc_qzs[3], 0, 'f', 0).arg(utc_qzs[2], 0, 'f', 0)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("QZST-GPS A0(ns),A1(ns/s)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2").arg(utc_qzs[0] * 1E9, 0, 'f', 3).arg(utc_qzs[1] * 1E9, 0, 'f', 6)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("GPS Iono Parameters Alpha0-Alpha3")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3,%4").arg(ion_gps[0], 0, 'E', 5).arg(ion_gps[1], 0, 'E', 5)
-                              .arg(ion_gps[2], 0, 'E', 5).arg(ion_gps[3], 0, 'E', 5)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("GPS Iono Parameters Beta0-Beta3")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3,%4").arg(ion_gps[4], 0, 'E', 5).arg(ion_gps[5], 0, 'E', 5).arg(ion_gps[6], 0, 'E', 5).arg(ion_gps[7], 0, 'E', 5)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("GALILEO Iono Parameters 0-2")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3").arg(ion_gal[0], 0, 'E', 5).arg(ion_gal[1], 0, 'E', 5).arg(ion_gal[2], 0, 'E', 5)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("QZS Iono Parameters Alpha0-Alpha3")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3,%4").arg(ion_qzs[0], 0, 'E', 5).arg(ion_qzs[1], 0, 'E', 5).arg(ion_qzs[2], 0, 'E', 5).arg(ion_qzs[3], 0, 'E', 5)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("QZS Iono Parameters Beta0-Beta3")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3,%4").arg(ion_qzs[4], 0, 'E', 5).arg(ion_qzs[5], 0, 'E', 5).arg(ion_qzs[6], 0, 'E', 5).arg(ion_qzs[7], 0, 'E', 5)));
+    i=0;
+	
+	time2str(timeget(),tstr,3);
+    Console->setItem(i,0, new QTableWidgetItem(tr("CPU Time (UTC)")));
+    Console->setItem(i++,1, new QTableWidgetItem(tstr));
+	
+    if (time.time!=0) time2str(gpst2utc(time),tstr,3); else strcpy(tstr,"-");
+    Console->setItem(i,0, new QTableWidgetItem(tr("Receiver Time (UTC)")));
+    Console->setItem(i++,1, new QTableWidgetItem(tstr));
+	
+	if (time.time!=0) time2str(time,tstr,3); else strcpy(tstr,"-");
+    Console->setItem(i,0, new QTableWidgetItem(tr("Receiver Time (GPST)")));
+    Console->setItem(i++,1, new QTableWidgetItem(tstr));
+	
+	if (time.time!=0) tow=time2gpst(time,&week);
+    Console->setItem(i,0, new QTableWidgetItem(tr("GPS Week/Time (s)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2").arg(week).arg(tow,0,'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Leap Seconds (GPST-UTC) (s)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(leaps)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("GPST-UTC Reference Week/Time (s)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2").arg(utc_gps[3],0,'f',0).arg(utc_gps[2],0,'f',0)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("GPST-UTC A0(ns),A1(ns/s)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2").arg(utc_gps[0]*1E9,0,'f',3).arg(utc_gps[1]*1E9,0,'f',6)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("GST-GPS Reference Week/Time (s)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2").arg(utc_gal[3],0,'f',0).arg(utc_gal[2],0,'f',0)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("GST-GPS A0(ns),A1(ns/s)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2").arg(utc_gal[0]*1E9,0,'f',3).arg(utc_gal[1]*1E9,0,'f',6)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("QZST-GPS Reference Week/Time (s)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2").arg(utc_qzs[3],0,'f',0).arg(utc_qzs[2],0,'f',0)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("QZST-GPS A0(ns),A1(ns/s)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2").arg(utc_qzs[0]*1E9,0,'f',3).arg(utc_qzs[1]*1E9,0,'f',6)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("GPS Iono Parameters Alpha0-Alpha3")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3,%4").arg(ion_gps[0],0,'E',5).arg(ion_gps[1],0,'E',5)
+            .arg(ion_gps[2],0,'E',5).arg(ion_gps[3],0,'E',5)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("GPS Iono Parameters Beta0-Beta3")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3,%4").arg(ion_gps[4],0,'E',5).arg(ion_gps[5],0,'E',5).arg(ion_gps[6],0,'E',5).arg(ion_gps[7],0,'E',5)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("GALILEO Iono Parameters 0-2")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3").arg(ion_gal[0],0,'E',5).arg(ion_gal[1],0,'E',5).arg(ion_gal[2],0,'E',5)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("QZS Iono Parameters Alpha0-Alpha3")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3,%4").arg(ion_qzs[0],0,'E',5).arg(ion_qzs[1],0,'E',5).arg(ion_qzs[2],0,'E',5).arg(ion_qzs[3],0,'E',5)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("QZS Iono Parameters Beta0-Beta3")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3,%4").arg(ion_qzs[4],0,'E',5).arg(ion_qzs[5],0,'E',5).arg(ion_qzs[6],0,'E',5).arg(ion_qzs[7],0,'E',5)));
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::SetStr(void)
 {
     header.clear();
-    header	<< tr("Stream") << tr("Type") << tr("Format") << tr("Mode") << tr("State") << tr("Input (bytes)") << tr("Input (bps)")
-        << tr("Output (bytes)") << tr("Output (bps)") << tr("Path") << tr("Message");
-
-    int i, width[] = { 95, 70, 80, 35, 35, 70, 70, 70, 70, 220, 220 };
+    header<<tr("Stream")<<tr("Type")<<tr("Format")<<tr("Mode")<<tr("State")<<tr("Input (bytes)")<<tr("Input (bps)")
+        <<tr("Output (bytes)")<<tr("Output (bps)")<<tr("Path")<<tr("Message");
 
+    int i,width[]={95,70,80,35,35,70,70,70,70,220,220};
+	
     Console->setColumnCount(11);
     Console->setRowCount(1);
-    for (i = 0; i < Console->columnCount(); i++)
-        Console->setColumnWidth(i, width[i] * FontScale / 96);
+    for (i=0;i<Console->columnCount();i++) {
+        Console->setColumnWidth(i,width[i]*FontScale/96);
+	}
     Console->setHorizontalHeaderLabels(header);
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::ShowStr(void)
 {
-    const QString ch[] = {
-        tr("Input Rover"),	 tr("Input Base/NRTK"), tr("Input Ephemeris"), tr("Output Solution 1"),
-        tr("Output Solution 2"), tr("Log Rover"),	tr("Log Base/NRTK"),   tr("Log Ephemeris"),
+    QString ch[]={
+        tr("Input Rover"),tr("Input Base/NRTK"),tr("Input Ephemeris"),tr("Output Solution 1"),
+        tr("Output Solution 2"),tr("Log Rover"),tr("Log Base/NRTK"),tr("Log Ephemeris"),
         tr("Monitor Port")
 	};
-    const QString type[] = {
-        tr("-"), tr("Serial"), tr("File"), tr("TCP Server"), tr("TCP Client"), tr("UDP"), tr("NTRIP Server"),
-        tr("NTRIP Client"), tr("FTP"),tr("HTTP"),tr("NTRIP Caster S"),tr("NTRIP Caster C")
+    QString type[]={
+        tr("-"),tr("Serial"),tr("File"),tr("TCP Server"),tr("TCP Client"),tr("UDP"),tr("NTRIP Server"),
+        tr("NTRIP Client")
 	};
-    const QString outformat[] = {
-        tr("Lat/Lon/Height"), tr("X/Y/Z-ECEF"), tr("E/N/U-Baseline"), tr("NMEA-0183")
+    QString outformat[]={
+        tr("Lat/Lon/Height"),tr("X/Y/Z-ECEF"),tr("E/N/U-Baseline"),tr("NMEA-0183")
 	};
-    const QString state[] = { tr("Error"), tr("-"), tr("OK") };
-    QString mode, form;
+    QString state[]={tr("Error"),tr("-"),tr("OK")};
+    QString mode,form;
 	stream_t stream[9];
-    int i, format[9] = { 0 };
-    char path[MAXSTRPATH] = "", *p, *q;
-
+    int i,format[9]={0};
+    char path[MAXSTRPATH]="",*p,*q;
+	
 	rtksvrlock(&rtksvr); // lock
-    for (i = 0; i < 8; i++) stream[i] = rtksvr.stream[i];
-    for (i = 0; i < 3; i++) format[i] = rtksvr.format[i];
-    for (i = 3; i < 5; i++) format[i] = rtksvr.solopt[i - 3].posf;
-    stream[8] = monistr;
-    format[8] = SOLF_LLH;
+	for (i=0;i<8;i++) stream[i]=rtksvr.stream[i];
+	for (i=0;i<3;i++) format[i]=rtksvr.format[i];
+	for (i=3;i<5;i++) format[i]=rtksvr.solopt[i-3].posf;
+	stream[8]=monistr;
+	format[8]=SOLF_LLH;
 	rtksvrunlock(&rtksvr); // unlock
-
+	
     Console->setRowCount(9);
     Label->setText("");
     Console->setHorizontalHeaderLabels(header);
 
-    for (i = 0; i < 9; i++) {
-        int j = 0;
-        Console->setItem(i, j++, new QTableWidgetItem(ch[i]));
-        Console->setItem(i, j++, new QTableWidgetItem(type[stream[i].type]));
-        if (i < 3) form = formatstrs[format[i]];
-        else if (i < 5 || i == 8) form = outformat[format[i]];
-        else form = "-";
-        Console->setItem(i, j++, new QTableWidgetItem(form));
-        if (stream[i].mode & STR_MODE_R) mode = tr("R"); else mode = "";
-        if (stream[i].mode & STR_MODE_W) mode = mode + (mode == "" ? "" : "/") + tr("W");
-        Console->setItem(i, j++, new QTableWidgetItem(mode));
-        Console->setItem(i, j++, new QTableWidgetItem(state[stream[i].state + 1]));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(stream[i].inb)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(stream[i].inr)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(stream[i].outb)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(stream[i].outr)));
-        strcpy(path, stream[i].path);
-        char *pp = path;
-        if ((p = strchr(path, '@'))) {
-            for (q = p - 1; q >= path; q--) if (*q == ':') break;
-            if (q >= path) for (q++; q < p; q++) *q = '*';
+	for (i=0;i<9;i++) {
+        int j=0;
+        Console->setItem(i,j++, new QTableWidgetItem(ch[i]));
+        Console->setItem(i,j++, new QTableWidgetItem(type[stream[i].type]));
+        if (i<3) form=formatstrs[format[i]];
+		else if (i<5||i==8) form=outformat[format[i]];
+		else form="-";
+        Console->setItem(i,j++, new QTableWidgetItem(form));
+        if (stream[i].mode&STR_MODE_R) mode=tr("R"); else mode="";
+        if (stream[i].mode&STR_MODE_W) mode=mode+(mode==""?"":"/")+tr("W");
+        Console->setItem(i,j++, new QTableWidgetItem(mode));
+        Console->setItem(i,j++, new QTableWidgetItem(state[stream[i].state+1]));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(stream[i].inb)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(stream[i].inr)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(stream[i].outb)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(stream[i].outr)));
+		strcpy(path,stream[i].path);
+        char *pp=path;
+		if ((p=strchr(path,'@'))) {
+			for (q=p-1;q>=path;q--) if (*q==':') break;
+			if (q>=path) for (q++;q<p;q++) *q='*';
 		}
-        if (stream[i].type == STR_TCPCLI || stream[i].type == STR_TCPSVR) {
-            if ((p = strchr(path, '/'))) *p = '\0';
-            if ((p = strchr(path, '@'))) pp = p + 1;
-            if (stream[i].type == STR_TCPSVR) {
-                if ((p = strchr(pp, ':'))) pp = p + 1; else *pp = ' ';
+		if (stream[i].type==STR_TCPCLI||stream[i].type==STR_TCPSVR) {
+			if ((p=strchr(path,'/'))) *p='\0';
+			if ((p=strchr(path,'@'))) pp=p+1;
+			if (stream[i].type==STR_TCPSVR) {
+                if ((p=strchr(pp,':'))) pp=p+1; else *pp=' ';
 			}
 		}
-        Console->setItem(i, j++, new QTableWidgetItem(pp));
-        Console->setItem(i, j++, new QTableWidgetItem(stream[i].msg));
+        Console->setItem(i,j++, new QTableWidgetItem(pp));
+        Console->setItem(i,j++, new QTableWidgetItem(stream[i].msg));
 	}
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::SetSbsMsg(void)
 {
     header.clear();
-    header << tr("Trcv") << tr("PRN") << tr("Type") << tr("Message") << tr("Contents");
-    int i, width[] = { 115, 25, 25, 420, 200 };
-
+    header<<tr("Trcv")<<tr("PRN")<<tr("Type")<<tr("Message")<<tr("Contents");
+	int i,width[]={115,25,25,420,200};
+	
     Console->setColumnCount(5);
     Console->setRowCount(1);
-    for (i = 0; i < Console->columnCount(); i++)
-        Console->setColumnWidth(i, width[i] * FontScale / 96);
+    for (i=0;i<Console->columnCount();i++) {
+        Console->setColumnWidth(i,width[i]*FontScale/96);
+	}
     Console->setHorizontalHeaderLabels(header);
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::ShowSbsMsg(void)
 {
 	sbsmsg_t msg[MAXSBSMSG];
-    const QString content[] = {
-        tr("For Testing"),						    tr("PRN Mask"),				     tr("Fast Corrections"),	  tr("Fast Corrections"),
-        tr("Fast Corrections"),						    tr("Fast Corrections"),			     tr("Integrity Information"),
-        tr("Fast Correction Degradation Factor"),			    tr("GEO Navigation Message"),
-        tr("Degradation Parameters"),					    tr("WAAS Network Time/UTC Offset Parameters"),
-        tr("GEO Satellite Almanacs"),					    tr("Ionospheric Grid Point Masks"),
+    QString content[]={
+        tr("For Testing"),tr("PRN Mask"),tr("Fast Corrections"),tr("Fast Corrections"),
+        tr("Fast Corrections"),tr("Fast Corrections"),tr("Integrity Information"),
+        tr("Fast Correction Degradation Factor"),tr("GEO Navigation Message"),
+        tr("Degradation Parameters"),tr("WAAS Network Time/UTC Offset Parameters"),
+        tr("GEO Satellite Almanacs"),tr("Ionospheric Grid Point Masks"),
         tr("Mixed Fast Corrections/Long Term Satellite Error Corrections"),
-        tr("Long Term Satellite Error Corrections",			    "Ionospheric Delay Corrections"),
-        tr("WAAS Service Messages"),					    tr("Clock-Ephemeris Covariance Matrix Message"),
-        tr("Internal Test Message"),					    tr("Null Message"),				     ""
+        tr("Long Term Satellite Error Corrections","Ionospheric Delay Corrections"),
+        tr("WAAS Service Messages"),tr("Clock-Ephemeris Covariance Matrix Message"),
+        tr("Internal Test Message"),tr("Null Message"),""
 	};
-    const int id[] = { 0, 1, 2, 3, 4, 5, 6, 7, 9, 10, 12, 17, 18, 24, 25, 26, 27, 28, 62, 63, -1 };
+	const int id[]={0,1,2,3,4,5,6,7,9,10,12,17,18,24,25,26,27,28,62,63,-1};
     char str[64];
     QString s;
-    int i, k, n;
-
+    int i,k,n;
+	
 	rtksvrlock(&rtksvr); // lock
-    n = rtksvr.nsbs;
-    for (i = 0; i < n; i++) msg[i] = rtksvr.sbsmsg[i];
+	n=rtksvr.nsbs;
+	for (i=0;i<n;i++) msg[i]=rtksvr.sbsmsg[i];
 	rtksvrunlock(&rtksvr); // unlock
+	
 
-
-    Console->setRowCount(n <= 0 ? 0 : n);
+    Console->setRowCount(n<=0?0:n);
     Label->setText("");
     Console->setHorizontalHeaderLabels(header);
 
-    for (i = 0; i < n; i++) {
-        int j = 0;
-        time2str(gpst2time(msg[i].week, msg[i].tow), str, 0);
-        Console->setItem(i, j++, new QTableWidgetItem(str));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(msg[i].prn)));
-        int type = msg[i].msg[1] >> 2;
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(type)));
-        for (k = 0; k < 29; k++) s += QString::number(msg[i].msg[k], 16);
-        Console->setItem(i, j++, new QTableWidgetItem(s));
-        for (k = 0; id[k] >= 0; k++) if (type == id[k]) break;
-        Console->setItem(i, j++, new QTableWidgetItem(id[k] < 0 ? "?" : content[k]));
+    for (i=0;i<n;i++) {
+        int j=0;
+		time2str(gpst2time(msg[i].week,msg[i].tow),str,0);
+        Console->setItem(i,j++, new QTableWidgetItem(str));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(msg[i].prn)));
+        int type=msg[i].msg[1]>>2;
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(type)));
+        for (k=0;k<29;k++) s+=QString::number(msg[i].msg[k],16);
+        Console->setItem(i,j++, new QTableWidgetItem(s));
+		for (k=0;id[k]>=0;k++) if (type==id[k]) break;
+        Console->setItem(i,j++, new QTableWidgetItem(id[k]<0?"?":content[k]));
 	}
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::SetSbsLong(void)
 {
     header.clear();
-    header	<< tr("SAT") << tr("Status") << tr("IODE") << tr("dX (m)") << tr("dY (m)") << tr("dZ (m)") << tr("dVX (m/s)")
-        << tr("dVY (m/s)") << tr("dVZ (m/s)") << tr("daf0 (ns)") << tr("daf1 (ns/s)") << tr("T0");
-
-    int i, width[] = { 25, 30, 30, 55, 55, 55, 55, 55, 55, 55, 55, 115 };
+    header<<tr("SAT")<<tr("Status")<<tr("IODE")<<tr("dX (m)")<<tr("dY (m)")<<tr("dZ (m)")<<tr("dVX (m/s)")
+        <<tr("dVY (m/s)")<<tr("dVZ (m/s)")<<tr("daf0 (ns)")<<tr("daf1 (ns/s)")<<tr("T0");
 
+    int i,width[]={25,30,30,55,55,55,55,55,55,55,55,115};
+	
     Console->setColumnCount(12);
     Console->setRowCount(0);
-    for (i = 0; i < Console->columnCount(); i++)
-        Console->setColumnWidth(i, width[i] * FontScale / 96);
+    for (i=0;i<Console->columnCount();i++) {
+        Console->setColumnWidth(i,width[i]*FontScale/96);
+    }
     Console->setHorizontalHeaderLabels(header);
 }
 //---------------------------------------------------------------------------
@@ -1508,282 +1534,285 @@
 	sbssat_t sbssat;
 	gtime_t time;
     int i;
-    char tstr[64], id[32];
-
+	char tstr[64],id[32];
+	
 	rtksvrlock(&rtksvr); // lock
-    time = rtksvr.rtk.sol.time;
-    sbssat = rtksvr.nav.sbssat;
+	time=rtksvr.rtk.sol.time;
+	sbssat=rtksvr.nav.sbssat;
 	rtksvrunlock(&rtksvr); // unlock
-
-    Console->setRowCount(sbssat.nsat <= 0 ? 2 : sbssat.nsat);
+	
+    Console->setRowCount(sbssat.nsat<=0?2:sbssat.nsat);
     Label->setText(QString(tr("IODP:%1  System Latency:%2 s"))
-               .arg(sbssat.iodp).arg(sbssat.tlat));
+                             .arg(sbssat.iodp).arg(sbssat.tlat));
     Console->setHorizontalHeaderLabels(header);
 
-    for (i = 0; i < Console->rowCount(); i++) {
-        int j = 0;
-        sbssatp_t *satp = sbssat.sat + i;
-        bool valid = timediff(time, satp->lcorr.t0) <= MAXSBSAGEL && satp->lcorr.t0.time;
-        satno2id(satp->sat, id);
-        Console->setItem(i, j++, new QTableWidgetItem(id));
-        Console->setItem(i, j++, new QTableWidgetItem(valid ? tr("OK") : tr("-")));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(satp->lcorr.iode)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(satp->lcorr.dpos[0], 'f', 3)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(satp->lcorr.dpos[1], 'f', 3)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(satp->lcorr.dpos[2], 'f', 3)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(satp->lcorr.dvel[0], 'f', 4)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(satp->lcorr.dvel[1], 'f', 4)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(satp->lcorr.dvel[2], 'f', 4)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(satp->lcorr.daf0 * 1E9, 'f', 4)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(satp->lcorr.daf1 * 1E9, 'f', 4)));
-        if (satp->lcorr.t0.time) time2str(satp->lcorr.t0, tstr, 0);
-        else strcpy(tstr, "-");
-        Console->setItem(i, j++, new QTableWidgetItem(tstr));
+    for (i=0;i<Console->rowCount();i++) {
+        int j=0;
+        sbssatp_t *satp=sbssat.sat+i;
+        bool valid=timediff(time,satp->lcorr.t0)<=MAXSBSAGEL&&satp->lcorr.t0.time;
+		satno2id(satp->sat,id);
+        Console->setItem(i,j++, new QTableWidgetItem(id));
+        Console->setItem(i,j++, new QTableWidgetItem(valid?tr("OK"):tr("-")));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(satp->lcorr.iode)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(satp->lcorr.dpos[0],'f',3)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(satp->lcorr.dpos[1],'f',3)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(satp->lcorr.dpos[2],'f',3)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(satp->lcorr.dvel[0],'f',4)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(satp->lcorr.dvel[1],'f',4)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(satp->lcorr.dvel[2],'f',4)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(satp->lcorr.daf0*1E9,'f',4)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(satp->lcorr.daf1*1E9,'f',4)));
+		if (satp->lcorr.t0.time) time2str(satp->lcorr.t0,tstr,0);
+		else strcpy(tstr,"-");
+        Console->setItem(i,j++, new QTableWidgetItem(tstr));
 	}
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::SetSbsIono(void)
 {
     header.clear();
-    header << tr("IODI") << tr("Lat (deg)") << tr("Lon (deg)") << tr("GIVEI") << tr("Delay (m)") << tr("T0");
-
-    int i, width[] = { 30, 50, 50, 30, 60, 115 };
+    header<<tr("IODI")<<tr("Lat (deg)")<<tr("Lon (deg)")<<tr("GIVEI")<<tr("Delay (m)")<<tr("T0");
 
+    int i,width[]={30,50,50,30,60,115};
+	
     Console->setColumnCount(6);
     Console->setRowCount(2);
-    for (i = 0; i < Console->columnCount(); i++)
-        Console->setColumnWidth(i, width[i] * FontScale / 96);
+    for (i=0;i<Console->columnCount();i++) {
+        Console->setColumnWidth(i,width[i]*FontScale/96);
 
+    }
     Console->setHorizontalHeaderLabels(header);
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::ShowSbsIono(void)
 {
-    QString s0 = "-";
-    sbsion_t sbsion[MAXBAND + 1];
+    QString s0="-";
+    sbsion_t sbsion[MAXBAND+1];
 	char tstr[64];
-    int i, j, k, n = 0;
-
+	int i,j,k,n=0;
+	
 	rtksvrlock(&rtksvr); // lock
-    for (i = 0; i <= MAXBAND; i++) {
-        sbsion[i] = rtksvr.nav.sbsion[i]; n += sbsion[i].nigp;
-    }
-    ;
+    for (i=0;i<=MAXBAND;i++) {sbsion[i]=rtksvr.nav.sbsion[i];n+=sbsion[i].nigp;};
 	rtksvrunlock(&rtksvr); // unlock
-
+	
     Console->setRowCount(n);
     Console->setHorizontalHeaderLabels(header);
 
     Label->setText("");
-    n = 0;
-    for (i = 0; i < MAXBAND; i++) {
-        sbsion_t *ion = sbsion + i;
-        for (j = 0; j < ion->nigp; j++) {
-            k = 0;
-            Console->setItem(n, k++, new QTableWidgetItem(QString::number(ion->iodi)));
-            Console->setItem(n, k++, new QTableWidgetItem(QString::number(ion->igp[j].lat)));
-            Console->setItem(n, k++, new QTableWidgetItem(QString::number(ion->igp[j].lon)));
-            Console->setItem(n, k++, new QTableWidgetItem(ion->igp[j].give ? QString::number(ion->igp[j].give - 1) : s0));
-            Console->setItem(n, k++, new QTableWidgetItem(QString::number(ion->igp[j].delay, 'f', 3)));
-            if (ion->igp[j].t0.time) time2str(ion->igp[j].t0, tstr, 0);
-            else strcpy(tstr, "-");
-            Console->setItem(n, k++, new QTableWidgetItem(tstr));
+    n=0;
+    for (i=0;i<MAXBAND;i++) {
+        sbsion_t *ion=sbsion+i;
+		for (j=0;j<ion->nigp;j++) {
+			k=0;
+            Console->setItem(n,k++, new QTableWidgetItem(QString::number(ion->iodi)));
+            Console->setItem(n,k++, new QTableWidgetItem(QString::number(ion->igp[j].lat)));
+            Console->setItem(n,k++, new QTableWidgetItem(QString::number(ion->igp[j].lon)));
+            Console->setItem(n,k++, new QTableWidgetItem(ion->igp[j].give?QString::number(ion->igp[j].give-1):s0));
+            Console->setItem(n,k++, new QTableWidgetItem(QString::number(ion->igp[j].delay,'f',3)));
+			if (ion->igp[j].t0.time) time2str(ion->igp[j].t0,tstr,0);
+			else strcpy(tstr,"-");
+            Console->setItem(n,k++, new QTableWidgetItem(tstr));
 			n++;
 		}
 	}
-    Console->setRowCount(n <= 0 ? 0 : n + 1);
+    Console->setRowCount(n<=0?0:n+1);
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::SetSbsFast(void)
 {
     header.clear();
-    header << tr("SAT") << tr("Status") << tr("PRC (m)") << tr("RRC (m)") << tr("IODF") << tr("UDREI") << tr("AI") << tr("Tof");
-
-    int i, width[] = { 25, 30, 60, 60, 30, 30, 30, 115 };
+    header<<tr("SAT")<<tr("Status")<<tr("PRC (m)")<<tr("RRC (m)")<<tr("IODF")<<tr("UDREI")<<tr("AI")<<tr("Tof");
 
+	int i,width[]={25,30,60,60,30,30,30,115};
+	
     Console->setColumnCount(8);
     Console->setRowCount(0);
-    for (i = 0; i < Console->columnCount(); i++)
-        Console->setColumnWidth(i, width[i] * FontScale / 96);
+    for (i=0;i<Console->columnCount();i++) {
+        Console->setColumnWidth(i,width[i]*FontScale/96);
 
+    }
     Console->setHorizontalHeaderLabels(header);
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::ShowSbsFast(void)
 {
-    QString s0 = "-";
+    QString s0="-";
 	sbssat_t sbssat;
 	gtime_t time;
     int i;
-    char tstr[64], id[32];
-
+	char tstr[64],id[32];
+	
 	rtksvrlock(&rtksvr); // lock
-    time = rtksvr.rtk.sol.time;
-    sbssat = rtksvr.nav.sbssat;
+	time=rtksvr.rtk.sol.time;
+	sbssat=rtksvr.nav.sbssat;
 	rtksvrunlock(&rtksvr); // unlock
-
+	
     Label->setText("");
-    Console->setRowCount(sbssat.nsat <= 0 ? 2 : sbssat.nsat);
+    Console->setRowCount(sbssat.nsat<=0?2:sbssat.nsat);
     Label->setText(QString(tr("IODP:%1  System Latency:%2 s")).arg(sbssat.iodp).arg(sbssat.tlat));
     Console->setHorizontalHeaderLabels(header);
 
-    for (i = 0; i < Console->rowCount(); i++) {
-        int j = 0;
-        sbssatp_t *satp = sbssat.sat + i;
-        bool valid = fabs(timediff(time, satp->fcorr.t0)) <= MAXSBSAGEF && satp->fcorr.t0.time &&
-                 0 <= satp->fcorr.udre - 1 && satp->fcorr.udre - 1 < 14;
-        satno2id(satp->sat, id);
-        Console->setItem(i, j++, new QTableWidgetItem(id));
-        Console->setItem(i, j++, new QTableWidgetItem(valid ? tr("OK") : tr("-")));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(satp->fcorr.prc, 'f', 3)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(satp->fcorr.rrc, 'f', 4)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(satp->fcorr.iodf)));
-        Console->setItem(i, j++, new QTableWidgetItem(satp->fcorr.udre ? QString::number(satp->fcorr.udre - 1) : s0));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(satp->fcorr.ai)));
-        if (satp->fcorr.t0.time) time2str(satp->fcorr.t0, tstr, 0);
-        else strcpy(tstr, "-");
-        Console->setItem(i, j++, new QTableWidgetItem(tstr));
+    for (i=0;i<Console->rowCount();i++) {
+        int j=0;
+        sbssatp_t *satp=sbssat.sat+i;
+        bool valid=fabs(timediff(time,satp->fcorr.t0))<=MAXSBSAGEF&&satp->fcorr.t0.time&&
+			  0<=satp->fcorr.udre-1&&satp->fcorr.udre-1<14;
+		satno2id(satp->sat,id);
+        Console->setItem(i,j++, new QTableWidgetItem(id));
+        Console->setItem(i,j++, new QTableWidgetItem(valid?tr("OK"):tr("-")));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(satp->fcorr.prc,'f',3)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(satp->fcorr.rrc,'f',4)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(satp->fcorr.iodf)));
+        Console->setItem(i,j++, new QTableWidgetItem(satp->fcorr.udre?QString::number(satp->fcorr.udre-1):s0));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(satp->fcorr.ai)));
+		if (satp->fcorr.t0.time) time2str(satp->fcorr.t0,tstr,0);
+		else strcpy(tstr,"-");
+        Console->setItem(i,j++, new QTableWidgetItem(tstr));
 	}
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::SetRtcm(void)
 {
     header.clear();
-    header << tr("Parameter") << tr("Value");
-    int i, width[] = { 220, 520 };
+    header<<tr("Parameter")<<tr("Value");
+	int i,width[]={220,520};
 
     Console->setColumnCount(2);
     Console->setRowCount(0);
-    for (i = 0; i < Console->columnCount(); i++)
-        Console->setColumnWidth(i, width[i] * FontScale / 96);
+    for (i=0;i<Console->columnCount();i++) {
+        Console->setColumnWidth(i,width[i]*FontScale/96);
+	}
     Console->setHorizontalHeaderLabels(header);
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::ShowRtcm(void)
 {
 	rtcm_t rtcm;
-    double pos[3] = { 0 };
-    int i = 0, j, format;
-    QString mstr1, mstr2;
-    char tstr[64] = "-";
-
-    if (SelStr->currentIndex() > 3) return;
-
+	double pos[3]={0};
+    int i=0,j,format;
+    QString mstr1,mstr2;
+    char tstr[64]="-";
+	
+    if (SelStr->currentIndex()>3) return;
+	
 	rtksvrlock(&rtksvr);
-    format = rtksvr.format[SelStr->currentIndex()];
-    rtcm = rtksvr.rtcm[SelStr->currentIndex()];
+    format=rtksvr.format[SelStr->currentIndex()];
+    rtcm=rtksvr.rtcm[SelStr->currentIndex()];
 	rtksvrunlock(&rtksvr);
-
-    if (rtcm.time.time) time2str(rtcm.time, tstr, 3);
-
-    for (j = 1; j < 100; j++) {
-        if (rtcm.nmsg2[j] == 0) continue;
-        mstr1 += QString("%1%2 (%3)").arg(mstr1.isEmpty() ? "" : ",").arg(j).arg(rtcm.nmsg2[j]);
+	
+	if (rtcm.time.time) time2str(rtcm.time,tstr,3);
+	
+	for (j=1;j<100;j++) {
+		if (rtcm.nmsg2[j]==0) continue;
+        mstr1+=QString("%1%2 (%3)").arg(mstr1.isEmpty()?"":",").arg(j).arg(rtcm.nmsg2[j]);
 	}
-    if (rtcm.nmsg2[0] > 0)
-        mstr1 += QString("%1other (%2)").arg(mstr1.isEmpty() ? "" : ",").arg(rtcm.nmsg2[0]);
-    for (j = 1; j < 300; j++) {
-        if (rtcm.nmsg3[j] == 0) continue;
-        mstr2 += QString("%1%2(%3)").arg(mstr2.isEmpty() ? "" : ",").arg(j + 1000).arg(rtcm.nmsg3[j]);
+	if (rtcm.nmsg2[0]>0) {
+        mstr1+=QString("%1other (%2)").arg(mstr1.isEmpty()?"":",").arg(rtcm.nmsg2[0]);
+	}
+	for (j=1;j<300;j++) {
+		if (rtcm.nmsg3[j]==0) continue;
+        mstr2+=QString("%1%2(%3)").arg(mstr2.isEmpty()?"":",").arg(j+1000).arg(rtcm.nmsg3[j]);
+	}
+	if (rtcm.nmsg3[0]>0) {
+        mstr2+=QString("%1other(%2)").arg(mstr2.isEmpty()?"":",").arg(rtcm.nmsg3[0]);
 	}
-    if (rtcm.nmsg3[0] > 0)
-        mstr2 += QString("%1other(%2)").arg(mstr2.isEmpty() ? "" : ",").arg(rtcm.nmsg3[0]);
     Label->setText("");
-
+	
     Console->setRowCount(26);
     Console->setHorizontalHeaderLabels(header);
 
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Format")));
-    Console->setItem(i++, 1, new QTableWidgetItem(format == STRFMT_RTCM2 ? tr("RTCM2") : tr("RTCM3")));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Message Time")));
-    Console->setItem(i++, 1, new QTableWidgetItem(tstr));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Station ID")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(rtcm.staid)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Station Health")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(rtcm.stah)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Sequence No")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(rtcm.seqno)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Station Pos X/Y/Z (m)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3").arg(rtcm.sta.pos[0], 0, 'f', 3).arg(rtcm.sta.pos[1], 0, 'f', 3).arg(rtcm.sta.pos[2], 0, 'f', 3)));
-
-    if (norm(rtcm.sta.pos, 3) > 0.0) ecef2pos(rtcm.sta.pos, pos);
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Station Lat/Lon/Height (deg,m)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3").arg(pos[0] * R2D, 0, 'f', 8).arg(pos[1] * R2D, 0, 'f', 8).arg(pos[2], 0, 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("ITRF Realization Year")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(rtcm.sta.itrf)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Antenna Delta Type")));
-    Console->setItem(i++, 1, new QTableWidgetItem(rtcm.sta.deltype ? tr("X/Y/Z") : tr("E/N/U")));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Antenna Delta (m)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1,%2,%3").arg(rtcm.sta.del[0], 0, 'f', 3).arg(rtcm.sta.del[1], 0, 'f', 3).arg(rtcm.sta.del[2], 0, 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Antenna Height (m)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(rtcm.sta.hgt, 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Antenna Descriptor")));
-    Console->setItem(i++, 1, new QTableWidgetItem(rtcm.sta.antdes));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Antenna Setup Id")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(rtcm.sta.antsetup)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Antenna Serial No")));
-    Console->setItem(i++, 1, new QTableWidgetItem(rtcm.sta.antsno));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Receiver Type Descriptor")));
-    Console->setItem(i++, 1, new QTableWidgetItem(rtcm.sta.rectype));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Receiver Firmware Version")));
-    Console->setItem(i++, 1, new QTableWidgetItem(rtcm.sta.recver));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Receiver Serial No")));
-    Console->setItem(i++, 1, new QTableWidgetItem(rtcm.sta.recsno));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("RTCM Special Message")));
-    Console->setItem(i++, 1, new QTableWidgetItem(rtcm.msg));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Last Message")));
-    Console->setItem(i++, 1, new QTableWidgetItem(rtcm.msgtype));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("# of RTCM Messages")));
-    Console->setItem(i++, 1, new QTableWidgetItem(format == STRFMT_RTCM2 ? mstr1 : mstr2));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("MSM Signals for GPS")));
-    Console->setItem(i++, 1, new QTableWidgetItem(rtcm.msmtype[0]));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("MSM Signals for GLONASS")));
-    Console->setItem(i++, 1, new QTableWidgetItem(rtcm.msmtype[1]));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("MSM Signals for Galileo")));
-    Console->setItem(i++, 1, new QTableWidgetItem(rtcm.msmtype[2]));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("MSM Signals for QZSS")));
-    Console->setItem(i++, 1, new QTableWidgetItem(rtcm.msmtype[3]));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("MSM Signals for SBAS")));
-    Console->setItem(i++, 1, new QTableWidgetItem(rtcm.msmtype[4]));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("MSM Signals for BeiDou")));
-    Console->setItem(i++, 1, new QTableWidgetItem(rtcm.msmtype[5]));
+    Console->setItem(i,0, new QTableWidgetItem(tr("Format")));
+    Console->setItem(i++,1, new QTableWidgetItem(format==STRFMT_RTCM2?tr("RTCM2"):tr("RTCM3")));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Message Time")));
+    Console->setItem(i++,1, new QTableWidgetItem(tstr));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Station ID")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(rtcm.staid)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Station Health")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(rtcm.stah)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Sequence No")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(rtcm.seqno)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Station Pos X/Y/Z (m)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3").arg(rtcm.sta.pos[0],0,'f',3).arg(rtcm.sta.pos[1],0,'f',3).arg(rtcm.sta.pos[2],0,'f',3)));
+	
+	if (norm(rtcm.sta.pos,3)>0.0) ecef2pos(rtcm.sta.pos,pos);
+    Console->setItem(i,0, new QTableWidgetItem(tr("Station Lat/Lon/Height (deg,m)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3").arg(pos[0]*R2D,0,'f',8).arg(pos[1]*R2D,0,'f',8).arg(pos[2],0,'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("ITRF Realization Year")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(rtcm.sta.itrf)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Antenna Delta Type")));
+    Console->setItem(i++,1, new QTableWidgetItem(rtcm.sta.deltype?tr("X/Y/Z"):tr("E/N/U")));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Antenna Delta (m)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1,%2,%3").arg(rtcm.sta.del[0],0,'f',3).arg(rtcm.sta.del[1],0,'f',3).arg(rtcm.sta.del[2],0,'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Antenna Height (m)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(rtcm.sta.hgt,'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Antenna Descriptor")));
+    Console->setItem(i++,1, new QTableWidgetItem(rtcm.sta.antdes));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Antenna Setup Id")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(rtcm.sta.antsetup)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Antenna Serial No")));
+    Console->setItem(i++,1, new QTableWidgetItem(rtcm.sta.antsno));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Receiver Type Descriptor")));
+    Console->setItem(i++,1, new QTableWidgetItem(rtcm.sta.rectype));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Receiver Firmware Version")));
+    Console->setItem(i++,1, new QTableWidgetItem(rtcm.sta.recver));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Receiver Serial No")));
+    Console->setItem(i++,1, new QTableWidgetItem(rtcm.sta.recsno));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("RTCM Special Message")));
+    Console->setItem(i++,1, new QTableWidgetItem(rtcm.msg));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Last Message")));
+    Console->setItem(i++,1, new QTableWidgetItem(rtcm.msgtype));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("# of RTCM Messages")));
+    Console->setItem(i++,1, new QTableWidgetItem(format==STRFMT_RTCM2?mstr1:mstr2));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("MSM Signals for GPS")));
+    Console->setItem(i++,1, new QTableWidgetItem(rtcm.msmtype[0]));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("MSM Signals for GLONASS")));
+    Console->setItem(i++,1, new QTableWidgetItem(rtcm.msmtype[1]));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("MSM Signals for Galileo")));
+    Console->setItem(i++,1, new QTableWidgetItem(rtcm.msmtype[2]));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("MSM Signals for QZSS")));
+    Console->setItem(i++,1, new QTableWidgetItem(rtcm.msmtype[3]));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("MSM Signals for SBAS")));
+    Console->setItem(i++,1, new QTableWidgetItem(rtcm.msmtype[4]));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("MSM Signals for BeiDou")));
+    Console->setItem(i++,1, new QTableWidgetItem(rtcm.msmtype[5]));
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::SetRtcmDgps(void)
 {
     header.clear();
-    header << tr("SAT") << tr("Status") << tr("PRC (m)") << tr("RRC (m)") << tr("IOD") << tr("UDRE") << tr("T0");
-
-    int i, width[] = { 25, 30, 60, 60, 30, 30, 115 };
+    header<<tr("SAT")<<tr("Status")<<tr("PRC (m)")<<tr("RRC (m)")<<tr("IOD")<<tr("UDRE")<<tr("T0");
 
+    int i,width[]={25,30,60,60,30,30,115};
+	
     Console->setColumnCount(7);
     Console->setRowCount(0);
-    for (i = 0; i < Console->columnCount(); i++)
-        Console->setColumnWidth(i, width[i] * FontScale / 96);
+    for (i=0;i<Console->columnCount();i++) {
+        Console->setColumnWidth(i,width[i]*FontScale/96);
+    }
     Console->setHorizontalHeaderLabels(header);
 }
 //---------------------------------------------------------------------------
@@ -1792,49 +1821,50 @@
 	gtime_t time;
 	dgps_t dgps[MAXSAT];
     int i;
-    char tstr[64], id[32];
-
+	char tstr[64],id[32];
+	
 	rtksvrlock(&rtksvr);
-    time = rtksvr.rtk.sol.time;
-    for (i = 0; i < MAXSAT; i++) dgps[i] = rtksvr.nav.dgps[i];
+	time=rtksvr.rtk.sol.time;
+	for (i=0;i<MAXSAT;i++) dgps[i]=rtksvr.nav.dgps[i];
 	rtksvrunlock(&rtksvr);
-
+	
     Label->setText("");
     Console->setRowCount(MAXSAT);
     Console->setHorizontalHeaderLabels(header);
 
-    for (i = 1; i < Console->rowCount(); i++) {
-        int j = 0;
-        satno2id(i, id);
-        bool valid = dgps[i].t0.time && fabs(timediff(time, dgps[i].t0)) <= 1800.0;
-        Console->setItem(i - 1, j++, new QTableWidgetItem(id));
-        Console->setItem(i - 1, j++, new QTableWidgetItem(valid ? tr("OK") : tr("-")));
-        Console->setItem(i - 1, j++, new QTableWidgetItem(QString::number(dgps[i].prc, 'f', 3)));
-        Console->setItem(i - 1, j++, new QTableWidgetItem(QString::number(dgps[i].rrc, 'f', 4)));
-        Console->setItem(i - 1, j++, new QTableWidgetItem(QString::number(dgps[i].iod)));
-        Console->setItem(i - 1, j++, new QTableWidgetItem(QString::number(dgps[i].udre)));
-        if (dgps[i].t0.time) time2str(dgps[i].t0, tstr, 0); else strcpy(tstr, "-");
-        Console->setItem(i - 1, j++, new QTableWidgetItem(tstr));
+    for (i=1;i<Console->rowCount();i++) {
+        int j=0;
+        satno2id(i,id);
+        bool valid=dgps[i].t0.time&&fabs(timediff(time,dgps[i].t0))<=1800.0;
+        Console->setItem(i-1,j++, new QTableWidgetItem(id));
+        Console->setItem(i-1,j++, new QTableWidgetItem(valid?tr("OK"):tr("-")));
+        Console->setItem(i-1,j++, new QTableWidgetItem(QString::number(dgps[i].prc,'f',3)));
+        Console->setItem(i-1,j++, new QTableWidgetItem(QString::number(dgps[i].rrc,'f',4)));
+        Console->setItem(i-1,j++, new QTableWidgetItem(QString::number(dgps[i].iod)));
+        Console->setItem(i-1,j++, new QTableWidgetItem(QString::number(dgps[i].udre)));
+		if (dgps[i].t0.time) time2str(dgps[i].t0,tstr,0); else strcpy(tstr,"-");
+        Console->setItem(i-1,j++, new QTableWidgetItem(tstr));
 	}
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::SetRtcmSsr(void)
 {
     header.clear();
-    header	<< tr("SAT") << tr("Status") << tr("UDI(s)") << tr("UDHR(s)") << tr("IOD") << tr("URA") << tr("Datum") << tr("T0")
-        << tr("D0-A(m)") << tr("D0-C(m)") << tr("D0-R(m)") << tr("D1-A(mm/s)") << tr("D1-C(mm/s)") << tr("D1-R(mm/s)")
-        << tr("C0(m)") << tr("C1(mm/s)") << tr("C2(mm/s2)") << tr("C-HR(m)");
-    int i, width[] = { 25, 30, 30, 30, 30, 25, 15, 115, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50 };
+    header<<tr("SAT")<<tr("Status")<<tr("UDI(s)")<<tr("UDHR(s)")<<tr("IOD")<<tr("URA")<<tr("Datum")<<tr("T0")
+        <<tr("D0-A(m)")<<tr("D0-C(m)")<<tr("D0-R(m)")<<tr("D1-A(mm/s)")<<tr("D1-C(mm/s)")<<tr("D1-R(mm/s)")
+        <<tr("C0(m)")<<tr("C1(mm/s)")<<tr("C2(mm/s2)")<<tr("C-HR(m)");
+	int i,width[]={25,30,30,30,30,25,15,115,50,50,50,50,50,50,50,50,50,50};
 
-    Console->setColumnCount(18 + MAXCODE);
+    Console->setColumnCount(18+MAXCODE);
     Console->setRowCount(1);
-    for (i = 0; i < 18; i++)
-        Console->setColumnWidth(i, width[i] * FontScale / 96);
-    for (i = 18; i < Console->columnCount(); i++) {
-        char *code = code2obs((unsigned char)(i - 17), NULL);
-        Console->setColumnWidth(i, 40 * FontScale / 96);
-        header << QString(tr("BL%1(m)")).arg(code);
-        Console->setItem(1, i, new QTableWidgetItem(""));
+	for (i=0;i<18;i++) {
+        Console->setColumnWidth(i,width[i]*FontScale/96);
+	}
+    for (i=18;i<Console->columnCount();i++) {
+        char *code=code2obs(i-17,NULL);
+        Console->setColumnWidth(i,40*FontScale/96);
+        header<<QString(tr("BL%1(m)")).arg(code);
+        Console->setItem(1,i, new QTableWidgetItem(""));
 	}
     Console->setHorizontalHeaderLabels(header);
 }
@@ -1843,15 +1873,16 @@
 {
 	gtime_t time;
 	ssr_t ssr[MAXSAT];
-    int i, k;
-    char tstr[64], id[32];
+    int i,k;
+	char tstr[64],id[32];
 
 	rtksvrlock(&rtksvr);
-    time = rtksvr.rtk.sol.time;
-    for (i = 0; i < MAXSAT; i++) {
-        if (SelStr->currentIndex() < 3)
-            ssr[i] = rtksvr.rtcm[SelStr->currentIndex()].ssr[i];
-        else ssr[i] = rtksvr.nav.ssr[i];
+	time=rtksvr.rtk.sol.time;
+	for (i=0;i<MAXSAT;i++) {
+        if (SelStr->currentIndex()<3) {
+            ssr[i]=rtksvr.rtcm[SelStr->currentIndex()].ssr[i];
+		}
+		else ssr[i]=rtksvr.nav.ssr[i];
 	}
 	rtksvrunlock(&rtksvr);
 
@@ -1859,115 +1890,121 @@
     Console->setRowCount(MAXSAT);
     Console->setHorizontalHeaderLabels(header);
 
-    for (i = 0; i < Console->rowCount(); i++) {
-        int j = 0;
-        satno2id(i + 1, id);
-        Console->setItem(i, j++, new QTableWidgetItem(id));
-        bool valid = ssr[i].t0[0].time && fabs(timediff(time, ssr[i].t0[0])) <= 1800.0;
-        Console->setItem(i, j++, new QTableWidgetItem(valid ? tr("OK") : tr("-")));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(ssr[i].udi[0], 'f', 0)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(ssr[i].udi[2], 'f', 0)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(ssr[i].iode)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(ssr[i].ura)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(ssr[i].refd)));
-        if (ssr[i].t0[0].time) time2str(ssr[i].t0[0], tstr, 0); else strcpy(tstr, "-");
-        Console->setItem(i, j++, new QTableWidgetItem(tstr));
-        for (k = 0; k < 3; k++)
-            Console->setItem(i, j++, new QTableWidgetItem(QString::number(ssr[i].deph[k], 'f', 3)));
-        for (k = 0; k < 3; k++)
-            Console->setItem(i, j++, new QTableWidgetItem(QString::number(ssr[i].ddeph[k] * 1E3, 'f', 3)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(ssr[i].dclk[0], 'f', 3)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(ssr[i].dclk[1] * 1E3, 'f', 3)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(ssr[i].dclk[2] * 1E3, 'f', 5)));
-        Console->setItem(i, j++, new QTableWidgetItem(QString::number(ssr[i].hrclk, 'f', 3)));
-        for (k = 1; k < MAXCODE; k++)
-            Console->setItem(i, j++, new QTableWidgetItem(QString::number(ssr[i].cbias[k], 'f', 2)));
+    for (i=0;i<Console->rowCount();i++) {
+        int j=0;
+		satno2id(i+1,id);
+        Console->setItem(i,j++, new QTableWidgetItem(id));
+        bool valid=ssr[i].t0[0].time&&fabs(timediff(time,ssr[i].t0[0]))<=1800.0;
+        Console->setItem(i,j++, new QTableWidgetItem(valid?tr("OK"):tr("-")));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(ssr[i].udi[0],'f',0)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(ssr[i].udi[2],'f',0)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(ssr[i].iode)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(ssr[i].ura)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(ssr[i].refd)));
+		if (ssr[i].t0[0].time) time2str(ssr[i].t0[0],tstr,0); else strcpy(tstr,"-");
+        Console->setItem(i,j++, new QTableWidgetItem(tstr));
+		for (k=0;k<3;k++) {
+            Console->setItem(i,j++, new QTableWidgetItem(QString::number(ssr[i].deph[k],'f',3)));
+		}
+		for (k=0;k<3;k++) {
+            Console->setItem(i,j++, new QTableWidgetItem(QString::number(ssr[i].ddeph[k]*1E3,'f',3)));
+		}
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(ssr[i].dclk[0],'f',3)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(ssr[i].dclk[1]*1E3,'f',3)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(ssr[i].dclk[2]*1E3,'f',5)));
+        Console->setItem(i,j++, new QTableWidgetItem(QString::number(ssr[i].hrclk,'f',3)));
+        for (k=1;k<MAXCODE;k++) {
+            Console->setItem(i,j++, new QTableWidgetItem(QString::number(ssr[i].cbias[k],'f',2)));
+		}
 	}
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::SetLexMsg(void)
 {
     header.clear();
-    header << tr("Parameter") << tr("Value");
-    int i, width[] = { 140, 450 };
-
+    header<<tr("Parameter")<<tr("Value");
+	int i,width[]={140,450};
+	
     Console->setColumnCount(2);
     Console->setRowCount(0);
-    for (i = 0; i < Console->columnCount(); i++)
-        Console->setColumnWidth(i, width[i] * FontScale / 96);
+    for (i=0;i<Console->columnCount();i++) {
+        Console->setColumnWidth(i,width[i]*FontScale/96);
+    }
     Console->setHorizontalHeaderLabels(header);
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::ShowLexMsg(void)
 {
 	raw_t raw;
-    int i = 0, j, k, format;
+    int i=0,j,k,format;
     QString mstr;
-    char tstr[64] = "-";
-
-    if (SelStr->currentIndex() > 3) return;
-
+    char tstr[64]="-";
+	
+    if (SelStr->currentIndex()>3) return;
+	
 	rtksvrlock(&rtksvr);
-    format = rtksvr.format[SelStr->currentIndex()];
-    raw = rtksvr.raw[SelStr->currentIndex()];
+    format=rtksvr.format[SelStr->currentIndex()];
+    raw=rtksvr.raw[SelStr->currentIndex()];
 	rtksvrunlock(&rtksvr);
-
+	
     Label->setText("");
-
-    if (format == STRFMT_LEXR && raw.time.time) time2str(raw.time, tstr, 3);
-
+	
+	if (format==STRFMT_LEXR&&raw.time.time) time2str(raw.time,tstr,3);
+	
     Console->setRowCount(14);
     Console->setHorizontalHeaderLabels(header);
 
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Receiver Time")));
-    Console->setItem(i++, 1, new QTableWidgetItem(tstr));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Signal Tracking Status")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(raw.lexmsg.stat)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Signal Tracking Time (s)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(raw.lexmsg.ttt / 1000.0, 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Signal Level (dBHz)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(raw.lexmsg.snr * 0.25, 'f', 1)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("PRN Number")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(raw.lexmsg.prn)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Message Type")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(raw.lexmsg.type)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Alert Flag")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(raw.lexmsg.alert)));
-
-    for (j = 0; j < 7; j++) {
-        for (k = 0; k < 32 && j * 32 + k < 212; k++)
-            mstr += QString("%1%2").arg(raw.lexmsg.msg[j * 32 + k], 16).arg(k % 4 == 3 ? " " : "");
-        Console->setItem(i, 0, new QTableWidgetItem(QString(tr("Data Part (%1-%2)")).arg(j * 32 * 8)
-                                .arg((j * 32 + k) * 8 - 1 < 1695 ? (j * 32 + k) * 8 - 1 : 1694)));
-        Console->setItem(i++, 1, new QTableWidgetItem(mstr));
+    Console->setItem(i,0, new QTableWidgetItem(tr("Receiver Time")));
+    Console->setItem(i++,1, new QTableWidgetItem(tstr));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Signal Tracking Status")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(raw.lexmsg.stat)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Signal Tracking Time (s)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(raw.lexmsg.ttt/1000.0,'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Signal Level (dBHz)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(raw.lexmsg.snr*0.25,'f',1)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("PRN Number")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(raw.lexmsg.prn)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Message Type")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(raw.lexmsg.type)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Alert Flag")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(raw.lexmsg.alert)));
+	
+	for (j=0;j<7;j++) {
+		for (k=0;k<32&&j*32+k<212;k++) {
+            mstr+=QString("%1%2").arg(raw.lexmsg.msg[j*32+k],16).arg(k%4==3?" ":"");
+		}
+        Console->setItem(i,0, new QTableWidgetItem(QString(tr("Data Part (%1-%2)")).arg(j*32*8)
+                                     .arg((j*32+k)*8-1<1695?(j*32+k)*8-1:1694)));
+        Console->setItem(i++,1, new QTableWidgetItem(mstr));
 	}
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::SetLexEph(void)
 {
     header.clear();
-    header	<< tr("SAT") << tr("Status") << tr("Tof") << tr("Health") << tr("Toe") << tr("URA") << tr("PosX(m)") << tr("PosY(m)") << tr("PosZ(m)")
-        << tr("VelX(m/s)") << tr("VelY(m/s)") << tr("VelZ(m/s)")
-        << tr("AccX(m/s2)") << tr("AccY(m/s2)") << tr("AccZ(m/s2)")
-        << tr("JerkX(m/s3)") << tr("JerkY(m/s3)") << tr("JerkZ(m/s3)")
-        << tr("Af0(ns)") << tr("Af1(ns/s)") << tr("TGD(ns)")
-        << tr("ISCL1C/A(ns)") << tr("ISCL2C(ns)") << tr("ISCL5I(ns)") << tr("ISCL5Q(ns)")
-        << tr("ISCL1CP(ns)") << tr("ISCL1CD(ns)") << tr("ISCLEX(ns)");
-    int i, width[] = {
-        25, 30, 115, 35, 115, 25, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 60, 50, 50, 50,
-        50, 50, 50,  50, 50,  50
+    header<<tr("SAT")<<tr("Status")<<tr("Tof")<<tr("Health")<<tr("Toe")<<tr("URA")<<tr("PosX(m)")<<tr("PosY(m)")<<tr("PosZ(m)")
+        <<tr("VelX(m/s)")<<tr("VelY(m/s)")<<tr("VelZ(m/s)")
+        <<tr("AccX(m/s2)")<<tr("AccY(m/s2)")<<tr("AccZ(m/s2)")
+        <<tr("JerkX(m/s3)")<<tr("JerkY(m/s3)")<<tr("JerkZ(m/s3)")
+        <<tr("Af0(ns)")<<tr("Af1(ns/s)")<<tr("TGD(ns)")
+        <<tr("ISCL1C/A(ns)")<<tr("ISCL2C(ns)")<<tr("ISCL5I(ns)")<<tr("ISCL5Q(ns)")
+        <<tr("ISCL1CP(ns)")<<tr("ISCL1CD(ns)")<<tr("ISCLEX(ns)");
+	int i,width[]={
+		25,30,115,35,115,25,80,80,80,80,80,80,80,80,80,80,80,80,60,50,50,50,
+		50,50,50,50,50,50
 	};
 
     Console->setColumnCount(28);
     Console->setRowCount(0);
-    for (i = 0; i < 28; i++)
-        Console->setColumnWidth(i, width[i] * FontScale / 96);
+	for (i=0;i<28;i++) {
+        Console->setColumnWidth(i,width[i]*FontScale/96);
+	}
     Console->setHorizontalHeaderLabels(header);
 }
 //---------------------------------------------------------------------------
@@ -1975,54 +2012,61 @@
 {
 	gtime_t time;
 	lexeph_t lexeph[MAXSAT];
-    int i, j, k, n, valid;
-    char tstr[64], health[16], id[32], *p;
+    int i,j,k,n,valid;
+    char tstr[64],health[16],id[32],*p;
 
 	rtksvrlock(&rtksvr);
-    time = rtksvr.rtk.sol.time;
-    for (i = 0; i < MAXSAT; i++) lexeph[i] = rtksvr.nav.lexeph[i];
+	time=rtksvr.rtk.sol.time;
+	for (i=0;i<MAXSAT;i++) lexeph[i]=rtksvr.nav.lexeph[i];
 	rtksvrunlock(&rtksvr);
-
+	
     Label->setText("");
     Console->setRowCount(MAXSAT);
     Console->setHorizontalHeaderLabels(header);
 
-    for (i = 0, n = 0; i < MAXSAT; i++) {
-        int sys = satsys(i + 1, NULL);
-        if (sys != SYS_GPS && sys != SYS_QZS) continue;
-        j = 0;
-        satno2id(i + 1, id);
-        Console->setItem(n, j++, new QTableWidgetItem(id));
-        valid = lexeph[i].toe.time && fabs(timediff(time, lexeph[i].toe)) <= 360.0;
-        Console->setItem(n, j++, new QTableWidgetItem(valid ? tr("OK") : tr("-")));
-
-        if (lexeph[i].tof.time == 0) sprintf(tstr, "-");
-        else time2str(lexeph[i].tof, tstr, 0);
-        Console->setItem(n, j++, new QTableWidgetItem(tstr));
-
-        for (k = 0, p = health; k < 5; k++)
-            p += sprintf(p, "%d", (lexeph[i].health >> (4 - k)) & 1);
-        Console->setItem(n, j++, new QTableWidgetItem(health));
-
-        if (lexeph[i].toe.time == 0) sprintf(tstr, "-");
-        else time2str(lexeph[i].toe, tstr, 0);
-        Console->setItem(n, j++, new QTableWidgetItem(tstr));
-
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(lexeph[i].ura)));
-
-        for (k = 0; k < 3; k++)
-            Console->setItem(n, j++, new QTableWidgetItem(QString::number(lexeph[i].pos[k], 'f', 3)));
-        for (k = 0; k < 3; k++)
-            Console->setItem(n, j++, new QTableWidgetItem(QString::number(lexeph[i].vel[k], 'f', 6)));
-        for (k = 0; k < 3; k++)
-            Console->setItem(n, j++, new QTableWidgetItem(QString::number(lexeph[i].acc[k], 'E', 6)));
-        for (k = 0; k < 3; k++)
-            Console->setItem(n, j++, new QTableWidgetItem(QString::number(lexeph[i].jerk[k], 'E', 6)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(lexeph[i].af0 * 1E9, 'f', 1)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(lexeph[i].af1 * 1E9, 'f', 4)));
-        Console->setItem(n, j++, new QTableWidgetItem(QString::number(lexeph[i].tgd * 1E9, 'f', 1)));
-        for (k = 0; k < 7; k++)
-            Console->setItem(n, j++, new QTableWidgetItem(QString::number(lexeph[i].isc[k] * 1E9, 'f', 1)));
+    for (i=0,n=0;i<MAXSAT;i++) {
+		
+        int sys=satsys(i+1,NULL);
+		if (sys!=SYS_GPS&&sys!=SYS_QZS) continue;
+		j=0;
+		satno2id(i+1,id);
+        Console->setItem(n,j++, new QTableWidgetItem(id));
+		valid=lexeph[i].toe.time&&fabs(timediff(time,lexeph[i].toe))<=360.0;
+        Console->setItem(n,j++, new QTableWidgetItem(valid?tr("OK"):tr("-")));
+		
+		if (lexeph[i].tof.time==0) sprintf(tstr,"-");
+		else time2str(lexeph[i].tof,tstr,0);
+        Console->setItem(n,j++, new QTableWidgetItem(tstr));
+		
+		for (k=0,p=health;k<5;k++) {
+			p+=sprintf(p,"%d",(lexeph[i].health>>(4-k))&1);
+		}
+        Console->setItem(n,j++, new QTableWidgetItem(health));
+		
+		if (lexeph[i].toe.time==0) sprintf(tstr,"-");
+		else time2str(lexeph[i].toe,tstr,0);
+        Console->setItem(n,j++, new QTableWidgetItem(tstr));
+		
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(lexeph[i].ura)));
+		
+		for (k=0;k<3;k++) {
+            Console->setItem(n,j++, new QTableWidgetItem(QString::number(lexeph[i].pos[k],'f',3)));
+		}
+		for (k=0;k<3;k++) {
+            Console->setItem(n,j++, new QTableWidgetItem(QString::number(lexeph[i].vel[k],'f',6)));
+		}
+		for (k=0;k<3;k++) {
+            Console->setItem(n,j++, new QTableWidgetItem(QString::number(lexeph[i].acc[k],'E',6)));
+		}
+		for (k=0;k<3;k++) {
+            Console->setItem(n,j++, new QTableWidgetItem(QString::number(lexeph[i].jerk[k],'E',6)));
+		}
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(lexeph[i].af0*1E9,'f',1)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(lexeph[i].af1*1E9,'f',4)));
+        Console->setItem(n,j++, new QTableWidgetItem(QString::number(lexeph[i].tgd*1E9,'f',1)));
+		for (k=0;k<7;k++) {
+            Console->setItem(n,j++, new QTableWidgetItem(QString::number(lexeph[i].isc[k]*1E9,'f',1)));
+		}
 		n++;
 	}
     Console->setRowCount(n);
@@ -2031,115 +2075,120 @@
 void MonitorDialog::SetLexIon(void)
 {
     header.clear();
-    header << tr("Parameter") << tr("Value");
-    int i, width[] = { 220, 380 };
-
+    header<<tr("Parameter")<<tr("Value");
+	int i,width[]={220,380};
+	
     Console->setColumnCount(2);
     Console->setRowCount(0);
-    for (i = 0; i < Console->columnCount(); i++)
-        Console->setColumnWidth(i, width[i] * FontScale / 96);
+    for (i=0;i<Console->columnCount();i++) {
+        Console->setColumnWidth(i,width[i]*FontScale/96);
+	}
     Console->setHorizontalHeaderLabels(header);
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::ShowLexIon(void)
 {
 	lexion_t lexion;
-    int i = 0;
-    char tstr[64] = "-";
-
+    int i=0;
+	char tstr[64]="-";
+	
 	rtksvrlock(&rtksvr);
-    lexion = rtksvr.nav.lexion;
+	lexion=rtksvr.nav.lexion;
 	rtksvrunlock(&rtksvr);
-
+	
     Label->setText("");
-
-    if (lexion.t0.time) time2str(lexion.t0, tstr, 3);
-
+	
+	if (lexion.t0.time) time2str(lexion.t0,tstr,3);
+	
     Console->setRowCount(9);
     Console->setHorizontalHeaderLabels(header);
 
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Reference Time (GPST)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(tstr));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Valid Time Tspan (s)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(lexion.tspan, 'f', 1)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("Origin of Approx Function Lat/Lon (deg)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString("%1 %2").arg(lexion.pos0[0] * R2D, 0, 'f', 4).arg(lexion.pos0[1] * R2D, 0, 'f', 4)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("0-0 Degree Coefficient E00 (m)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(lexion.coef[0][0], 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("1-1 Degree Coefficient E10 (m/rad)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(lexion.coef[1][0], 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("2-0 Degree Coefficient E20 (m/rad^2)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(lexion.coef[2][0], 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("0-1 Degree Coefficient E01 (m/rad)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(lexion.coef[0][1], 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("1-1 Degree Coefficient E11 (m/rad^2)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(lexion.coef[1][1], 'f', 3)));
-
-    Console->setItem(i, 0, new QTableWidgetItem(tr("2-1 Degree Coefficient E21 (m/rad^3)")));
-    Console->setItem(i++, 1, new QTableWidgetItem(QString::number(lexion.coef[2][1], 'f', 3)));
+    Console->setItem(i,0, new QTableWidgetItem(tr("Reference Time (GPST)")));
+    Console->setItem(i++,1, new QTableWidgetItem(tstr));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Valid Time Tspan (s)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(lexion.tspan,'f',1)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("Origin of Approx Function Lat/Lon (deg)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString("%1 %2").arg(lexion.pos0[0]*R2D,0,'f',4).arg(lexion.pos0[1]*R2D,0,'f',4)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("0-0 Degree Coefficient E00 (m)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(lexion.coef[0][0],'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("1-1 Degree Coefficient E10 (m/rad)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(lexion.coef[1][0],'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("2-0 Degree Coefficient E20 (m/rad^2)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(lexion.coef[2][0],'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("0-1 Degree Coefficient E01 (m/rad)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(lexion.coef[0][1],'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("1-1 Degree Coefficient E11 (m/rad^2)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(lexion.coef[1][1],'f',3)));
+	
+    Console->setItem(i,0, new QTableWidgetItem(tr("2-1 Degree Coefficient E21 (m/rad^3)")));
+    Console->setItem(i++,1, new QTableWidgetItem(QString::number(lexion.coef[2][1],'f',3)));
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::SetIonCorr(void)
 {
-    int i, j;
+	int i,j;
 
     header.clear();
 
-    Console->setColumnCount((IONLON2 - IONLON1) / DIONLON + 2);
-    Console->setRowCount((IONLAT1 - IONLAT2) / DIONLAT + 2);
-
-    Console->setColumnWidth(0, 40 * FontScale / 96);
-    Console->setItem(0, 0, new QTableWidgetItem(""));
+    Console->setColumnCount((IONLON2-IONLON1)/DIONLON+2);
+    Console->setRowCount((IONLAT1-IONLAT2)/DIONLAT+2);
 
-    for (i = 0; i < Console->columnCount(); i++) {
-        Console->setColumnWidth(i, 40 * FontScale / 96);
-        Console->setItem(0, i, new QTableWidgetItem(QString("%1E").arg(IONLON1 + (i - 1) * DIONLON, 0, 'f', 0)));
+    Console->setColumnWidth(0,40*FontScale/96);
+    Console->setItem(0,0, new QTableWidgetItem(""));
+	
+    for (i=0;i<Console->columnCount();i++) {
+        Console->setColumnWidth(i,40*FontScale/96);
+        Console->setItem(0,i, new QTableWidgetItem(QString("%1E").arg(IONLON1+(i-1)*DIONLON,0,'f',0)));
 	}
-    for (j = 0; j < Console->rowCount(); j++)
-        Console->setItem(j, 0, new QTableWidgetItem(QString("%1N").arg(IONLAT1 - (j - 1) * DIONLAT, 0, 'f', 0)));
-    for (i = 0; i < Console->columnCount(); i++)
-        for (j = 0; j < Console->rowCount(); j++) Console->setItem(j, i, new QTableWidgetItem("-"));
+    for (j=0;j<Console->rowCount();j++) {
+        Console->setItem(j,0, new QTableWidgetItem(QString("%1N").arg(IONLAT1-(j-1)*DIONLAT,0,'f',0)));
+	}
+    for (i=0;i<Console->columnCount();i++)
+    for (j=0;j<Console->rowCount();j++) Console->setItem(j,i, new QTableWidgetItem("-"));
 }
 //---------------------------------------------------------------------------
 void MonitorDialog::ShowIonCorr(void)
 {
 	gtime_t time;
     nav_t nav;
-    double pos[3] = { 0, 0, 0 }, ion, var, azel[] = { 0.0, PI / 2.0 };
-    int i, j, ionoopt;
-
-    memset(&nav, 0, sizeof(nav_t));
+    double pos[3]={0,0,0},ion,var,azel[]={0.0,PI/2.0};
+	int i,j,ionoopt;
+	
+    memset(&nav,0,sizeof(nav_t));
 
 	rtksvrlock(&rtksvr);
-    time = rtksvr.rtk.sol.time;
-    for (i = 0; i < 8; i++) nav.ion_gps[i] = rtksvr.nav.ion_gps[i];
-    for (i = 0; i < 4; i++) nav.ion_gal[i] = rtksvr.nav.ion_gal[i];
-    for (i = 0; i < 8; i++) nav.ion_qzs[i] = rtksvr.nav.ion_qzs[i];
-    for (i = 0; i < MAXBAND + 1; i++) nav.sbsion[i] = rtksvr.nav.sbsion[i];
-    nav.lexion = rtksvr.nav.lexion;
+	time=rtksvr.rtk.sol.time;
+	for (i=0;i<8;i++) nav.ion_gps[i]=rtksvr.nav.ion_gps[i];
+	for (i=0;i<4;i++) nav.ion_gal[i]=rtksvr.nav.ion_gal[i];
+	for (i=0;i<8;i++) nav.ion_qzs[i]=rtksvr.nav.ion_qzs[i];
+	for (i=0;i<MAXBAND+1;i++) nav.sbsion[i]=rtksvr.nav.sbsion[i];
+	nav.lexion=rtksvr.nav.lexion;
 	rtksvrunlock(&rtksvr);
-
+	
     Label->setText(tr("Vertical L1 Ionospheric Delay (m)"));
-
+	
     Console->setHorizontalHeaderLabels(header);
-    ionoopt = SelIon->currentIndex();
-
-    for (i = 0; i < Console->columnCount(); i++)
-        for (j = 0; j < Console->rowCount(); j++) {
-            pos[0] = (IONLAT1 - (j - 1) * DIONLAT) * D2R;
-            pos[1] = (IONLON1 + (i - 1) * DIONLON) * D2R;
+    ionoopt=SelIon->currentIndex();
+	
+    for (i=0;i<Console->columnCount();i++)
+    for (j=0;j<Console->rowCount();j++) {
+		pos[0]=(IONLAT1-(j-1)*DIONLAT)*D2R;
+		pos[1]=(IONLON1+(i-1)*DIONLON)*D2R;
 
-            if (!ionocorr(time, &nav, 0, pos, azel, ionoopt, &ion, &var) || ion == 0.0)
-                Console->setItem(j, i, new QTableWidgetItem("-"));
-            else
-                Console->setItem(j, i, new QTableWidgetItem(QString::number(ion, 'f', 2)));
+		if (!ionocorr(time,&nav,0,pos,azel,ionoopt,&ion,&var)||ion==0.0) {
+            Console->setItem(j,i, new QTableWidgetItem("-"));
 		}
+		else {
+            Console->setItem(j,i, new QTableWidgetItem(QString::number(ion,'f',2)));
+		}
+	}
 }
 //---------------------------------------------------------------------------
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/mondlg.h RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/mondlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/mondlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/mondlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -29,7 +29,7 @@
     void SelFmtChange(int);
 
 private:
-    int TypeF, ConFmt, FontScale, ObsMode;
+	int TypeF,ConFmt,ScrollPos,FontScale,ObsMode;
     QStringList ConBuff;
     QStringList header;
 	rtcm_t rtcm;
@@ -80,12 +80,11 @@
     void ShowLexIon(void);
     void ShowIonCorr(void);
 
-    void AddConsole(const unsigned char *msg, int n, int mode);
+    void AddConsole(unsigned char *msg, int n, int mode);
     void ViewConsole(void);
 
 public:
     explicit MonitorDialog(QWidget* parent);
-    ~MonitorDialog();
 };
 //---------------------------------------------------------------------------
 #endif
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/mondlg.ui RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/mondlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/mondlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/mondlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,7 +6,7 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>1035</width>
+    <width>950</width>
     <height>502</height>
    </rect>
   </property>
@@ -35,6 +35,9 @@
       <string/>
      </property>
      <layout class="QHBoxLayout" name="horizontalLayout">
+      <property name="spacing">
+       <number>0</number>
+      </property>
       <property name="leftMargin">
        <number>0</number>
       </property>
@@ -55,9 +58,6 @@
         <property name="toolTip">
          <string/>
         </property>
-        <property name="maxVisibleItems">
-         <number>35</number>
-        </property>
         <item>
          <property name="text">
           <string>RTK</string>
@@ -399,7 +399,7 @@
          <string/>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="../rtkget_qt/rtkget_qt.qrc">
           <normaloff>:/buttons/del.bmp</normaloff>:/buttons/del.bmp</iconset>
         </property>
         <property name="flat">
@@ -419,7 +419,7 @@
          <string/>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="../rtkget_qt/rtkget_qt.qrc">
           <normaloff>:/buttons/pause.bmp</normaloff>:/buttons/pause.bmp</iconset>
         </property>
         <property name="checkable">
@@ -442,15 +442,9 @@
          <string/>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="../rtkget_qt/rtkget_qt.qrc">
           <normaloff>:/buttons/fitd.bmp</normaloff>:/buttons/fitd.bmp</iconset>
         </property>
-        <property name="checkable">
-         <bool>true</bool>
-        </property>
-        <property name="checked">
-         <bool>true</bool>
-        </property>
         <property name="flat">
          <bool>true</bool>
         </property>
@@ -518,7 +512,7 @@
   </layout>
  </widget>
  <resources>
-  <include location="../rtkconv_qt/rtkconv_qt.qrc"/>
+  <include location="../rtkget_qt/rtkget_qt.qrc"/>
  </resources>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/navimain.cpp RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/navimain.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/navimain.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/navimain.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -1,15 +1,13 @@
 //---------------------------------------------------------------------------
 // rtknavi : real-time positioning ap
 //
-//          Copyright (C) 2007-2016 by T.TAKASU, All rights reserved.
+//          Copyright (C) 2007-2014 by T.TAKASU, All rights reserved.
 //          ported to Qt by Jens Reimann
 //
-// options : rtknavi [-t title][-i file][-auto][-tray]
+// options : rtknavi [-t title][-i file]
 //
 //           -t title   window title
 //           -i file    ini file path
-//           -auto      auto start
-//           -tray      start as task tray icon
 //
 // version : $Revision:$ $Date:$
 // history : 2008/07/14  1.0 new
@@ -20,11 +18,9 @@
 //           2012/04/03  1.5 rtklib 2.4.2
 //           2014/09/06  1.6 rtklib 2.4.3
 //           2016/01/31  2.0 ported to Qt
-//           2017/09/01  1.7 add option -auto and -tray
 //---------------------------------------------------------------------------
 #include <stdio.h>
 #include <math.h>
-#include <clocale>
 
 #include <QMessageBox>
 #include <QMainWindow>
@@ -40,7 +36,10 @@
 #include <QCloseEvent>
 #include <QPainter>
 #include <QDebug>
+
+#ifdef QT5
 #include <QCommandLineParser>
+#endif
 
 #include "rtklib.h"
 #include "instrdlg.h"
@@ -63,6 +62,7 @@
 #define PRGNAME     "RTKNAVI-QT"           // program name
 #define TRACEFILE   "rtknavi_%Y%m%d%h%M.trace" // debug trace file
 #define STATFILE    "rtknavi_%Y%m%d%h%M.stat"  // solution status file
+const QChar degreeChar(0260);           // character code of degree (UTF-8)
 #define SATSIZE     20                  // satellite circle size in skyplot
 #define MINSNR      10                  // minimum snr
 #define MAXSNR      60                  // maximum snr
@@ -75,42 +75,33 @@
 #define DEFAULTPORT 52001               // default monitor port number
 #define MAXPORTOFF  9                   // max port number offset
 #define MAXTRKSCALE 23                  // track scale
-#define MAXPANELMODE 7                  // max panel mode
 
-#define SQRT(x)     ((x)<0.0||(x)!=(x)?0.0:sqrt(x))
+#define SQRT(x)     ((x)<0.0?0.0:sqrt(x))
 #define MIN(x,y)    ((x)<(y)?(x):(y))
 
-const QChar degreeChar(0260);           // character code of degree (UTF-8)
-
 //---------------------------------------------------------------------------
 
 rtksvr_t rtksvr;                        // rtk server struct
 stream_t monistr;                       // monitor stream
 
 // show message in message area ---------------------------------------------
+#if 0
 extern "C" {
-    extern int showmsg(const char *, ...)
-    {
-        return 0;
-    }
-extern void settime(gtime_t) {}
-extern void settspan(gtime_t, gtime_t) {}
+extern int showmsg(char *format,...) {return 0;}
 }
+#endif
 // convert degree to deg-min-sec --------------------------------------------
 static void degtodms(double deg, double *dms)
 {
-    double sgn = 1.0;
-
-    if (deg < 0.0) {
-        deg = -deg; sgn = -1.0;
-    }
-    dms[0] = floor(deg);
-    dms[1] = floor((deg - dms[0]) * 60.0);
-    dms[2] = (deg - dms[0] - dms[1] / 60.0) * 3600;
-    dms[0] *= sgn;
+    double sgn=1.0;
+    if (deg<0.0) {deg=-deg; sgn=-1.0;}
+    dms[0]=floor(deg);
+    dms[1]=floor((deg-dms[0])*60.0);
+    dms[2]=(deg-dms[0]-dms[1]/60.0)*3600;
+    dms[0]*=sgn;
 }
 // execute command ----------------------------------------------------------
-int MainWindow::ExecCmd(const QString &cmd, int show)
+int  MainWindow::ExecCmd(const QString &cmd, int show)
 {
     Q_UNUSED(show);
 
@@ -120,61 +111,65 @@
 MainWindow::MainWindow(QWidget *parent)
     : QDialog(parent)
 {
-    mainForm = this;
+    mainForm=this;
     setupUi(this);
 
-    setlocale(LC_NUMERIC, "C");
+    setlocale(LC_NUMERIC,"C");
 
-    SvrCycle = SvrBuffSize = 0;
-    SolBuffSize = 1000;
+    SvrCycle=SvrBuffSize=0;
+    SolBuffSize=1000;
 
-    for (int i = 0; i < MAXSTRRTK; i++) {
-        StreamC[i] = Stream[i] = Format[i] = 0;
+    for (int i=0;i<MAXSTRRTK;i++) {
+        StreamC[i]=Stream[i]=Format[i]=0;
+    }
+    for (int i=0;i<3;i++) {
+        CmdEna[i][0]=CmdEna[i][1]=0;
     }
-    for (int i = 0; i < 3; i++)
-        CmdEna[i][0] = CmdEna[i][1] = CmdEna[i][2] = 0;
-
-    TimeSys = SolType = 0;
-    for (int i = 0; i < 4; i++) { PlotType[i] = FreqType[i] = BLMode[i] = TrkType[i] = 0; TrkScale[i] = 5;};
-    PSol = PSolS = PSolE = Nsat[0] = Nsat[1] = 0;
-    NMapPnt = 0;
-    OpenPort = 0;
-    Time = NULL;
-    SolStat = Nvsat = NULL;
-    SolCurrentStat = 0;
-    SolRov = SolRef = Qr = VelRov = Age = Ratio = NULL;
 
-    for (int i = 0; i < 2; i++) for (int j = 0; j < MAXSAT; j++) {
-            Sat[i][j] = Vsat[i][j] = 0;
-            Az[i][j] = El[i][j] = 0.0;
-            for (int k = 0; k < NFREQ; k++) Snr[i][j][k] = 0;
-        }
-    PrcOpt = prcopt_default;
-    SolOpt = solopt_default;
+    TimeSys=SolType=PlotType1=PlotType2=FreqType1=FreqType2=0;
+    TrkType1=TrkType2=0;
+    TrkScale1=TrkScale2=5;
+    BLMode1=BLMode2=0;
+    PSol=PSolS=PSolE=Nsat[0]=Nsat[1]=0;
+    NMapPnt=0;
+    OpenPort=0;
+    Time=NULL;
+    SolStat=Nvsat=NULL;
+    SolCurrentStat=0;
+    SolRov=SolRef=Qr=VelRov=Age=Ratio=NULL;
 
+    for (int i=0;i<2;i++) for (int j=0;j<MAXSAT;j++) {
+        Sat[i][j]=Vsat[i][j]=0;
+        Az[i][j]=El[i][j]=0.0;
+        for (int k=0;k<NFREQ;k++) Snr[i][j][k]=0;
+    }
+    PrcOpt=prcopt_default;
+    SolOpt=solopt_default;
+    
     rtksvrinit(&rtksvr);
     strinit(&monistr);
-
+    
     setWindowTitle(QString(tr("%1 ver. %2")).arg(PRGNAME).arg(VER_RTKLIB));
     setWindowIcon(QIcon(":/icons/rtknavi_Icon.ico"));
 
-    TLEData.n = TLEData.nmax = 0;
-    TLEData.data = NULL;
-
-    PanelStack = PanelMode = 0;
+    TLEData.n=TLEData.nmax=0;
+    TLEData.data=NULL;
+    
+    PanelStack=PanelMode=0;
 
-    for (int i = 0; i < 3; i++)
-        TrkOri[i] = 0.0;
-    optDialog = new OptDialog(this);
-    inputStrDialog = new InputStrDialog(this);
-    outputStrDialog = new OutputStrDialog(this);
+    for (int i=0;i<3;i++) {
+        TrkOri[i]=0.0;
+    }
+    optDialog=new OptDialog(this);
+    inputStrDialog= new InputStrDialog(this);
+    outputStrDialog=new OutputStrDialog(this);
     logStrDialog = new LogStrDialog(this);
-    monitor = new MonitorDialog(this);
-    systemTray = new QSystemTrayIcon(this);
+    monitor=new MonitorDialog(this);
+    systemTray= new QSystemTrayIcon(this);
 
     SetTrayIcon(1);
 
-    trayMenu = new QMenu(this);
+    trayMenu=new QMenu(this);
 }
 
 MainWindow::~MainWindow()
@@ -182,129 +177,96 @@
     delete [] Time;   delete [] SolStat; delete [] Nvsat;  delete [] SolRov;
     delete [] SolRef; delete [] Qr;      delete [] VelRov; delete [] Age;
     delete [] Ratio;
-
-    rtksvrfree(&rtksvr);
 }
 
 // callback on form create --------------------------------------------------
-void MainWindow::showEvent(QShowEvent *event)
+void  MainWindow::showEvent(QShowEvent *event)
 {
-    int autorun=0, tasktray=0;
     if (event->spontaneous()) return;
 
-    trace(3, "FormCreate\n");
+    trace(3,"FormCreate\n");
 
     UpdatePlot();
 
-    trayMenu->addAction(tr("Main Window..."), this, SLOT(MenuExpandClick()));
-    trayMenu->addAction(tr("Monitor..."), this, SLOT(MenuMonitorClick()));
-    trayMenu->addAction(tr("Plot..."), this, SLOT(MenuPlotClick()));
+    trayMenu->addAction(tr("Main Window..."),this,SLOT(MenuExpandClick()));
+    trayMenu->addAction(tr("Monitor..."),this,SLOT(MenuMonitorClick()));
+    trayMenu->addAction(tr("Plot..."),this,SLOT(MenuPlotClick()));
     trayMenu->addSeparator();
-    MenuStartAction = trayMenu->addAction(tr("Start"), this, SLOT(MenuStartClick()));
-    MenuStopAction = trayMenu->addAction(tr("Stop"), this, SLOT(MenuStopClick()));
+    MenuStartAction=trayMenu->addAction(tr("Start"),this,SLOT(MenuStartClick()));
+    MenuStopAction=trayMenu->addAction(tr("Stop"),this,SLOT(MenuStopClick()));
     trayMenu->addSeparator();
-    MenuExitAction = trayMenu->addAction(tr("Exit"), this, SLOT(MenuExitClick()));
+    MenuExitAction=trayMenu->addAction(tr("Exit"),this,SLOT(MenuExitClick()));
 
     systemTray->setContextMenu(trayMenu);
 
-    BtnStop->setVisible(false);
-
-    connect(systemTray, SIGNAL(activated(QSystemTrayIcon::ActivationReason)), this, SLOT(TrayIconClick(QSystemTrayIcon::ActivationReason)));
-
-    connect(BtnExit, SIGNAL(clicked()), this, SLOT(BtnExitClick()));
-    connect(BtnStart, SIGNAL(clicked()), this, SLOT(BtnStartClick()));
-    connect(BtnStop, SIGNAL(clicked()), this, SLOT(BtnStopClick()));
-    connect(BtnAbout, SIGNAL(clicked(bool)), this, SLOT(BtnAboutClick()));
-    connect(BtnFreqType1, SIGNAL(clicked(bool)), this, SLOT(BtnFreqType1Click()));
-    connect(BtnFreqType2, SIGNAL(clicked(bool)), this, SLOT(BtnFreqType2Click()));
-    connect(BtnFreqType3, SIGNAL(clicked(bool)), this, SLOT(BtnFreqType3Click()));
-    connect(BtnFreqType4, SIGNAL(clicked(bool)), this, SLOT(BtnFreqType4Click()));
-    connect(BtnExpand1, SIGNAL(clicked(bool)), this, SLOT(BtnExpand1Click()));
-    connect(BtnShrink1, SIGNAL(clicked(bool)), this, SLOT(BtnShrink1Click()));
-    connect(BtnExpand2, SIGNAL(clicked(bool)), this, SLOT(BtnExpand2Click()));
-    connect(BtnShrink2, SIGNAL(clicked(bool)), this, SLOT(BtnShrink2Click()));
-    connect(BtnExpand3, SIGNAL(clicked(bool)), this, SLOT(BtnExpand3Click()));
-    connect(BtnShrink3, SIGNAL(clicked(bool)), this, SLOT(BtnShrink3Click()));
-    connect(BtnExpand4, SIGNAL(clicked(bool)), this, SLOT(BtnExpand4Click()));
-    connect(BtnShrink4, SIGNAL(clicked(bool)), this, SLOT(BtnShrink4Click()));
-    connect(BtnInputStr, SIGNAL(clicked(bool)), this, SLOT(BtnInputStrClick()));
-    connect(BtnLogStr, SIGNAL(clicked(bool)), this, SLOT(BtnLogStrClick()));
-    connect(BtnMonitor, SIGNAL(clicked(bool)), this, SLOT(BtnMonitorClick()));
-    connect(BtnOpt, SIGNAL(clicked(bool)), this, SLOT(BtnOptClick()));
-    connect(BtnOutputStr, SIGNAL(clicked(bool)), this, SLOT(BtnOutputStrClick()));
-    connect(BtnPanel, SIGNAL(clicked(bool)), this, SLOT(BtnPanelClick()));
-    connect(BtnPlot, SIGNAL(clicked(bool)), this, SLOT(BtnPlotClick()));
-    connect(BtnPlotType1, SIGNAL(clicked(bool)), this, SLOT(BtnPlotType1Click()));
-    connect(BtnPlotType2, SIGNAL(clicked(bool)), this, SLOT(BtnPlotType2Click()));
-    connect(BtnPlotType3, SIGNAL(clicked(bool)), this, SLOT(BtnPlotType3Click()));
-    connect(BtnPlotType4, SIGNAL(clicked(bool)), this, SLOT(BtnPlotType4Click()));
-    connect(BtnSave, SIGNAL(clicked(bool)), this, SLOT(BtnSaveClick()));
-    connect(BtnSolType, SIGNAL(clicked(bool)), this, SLOT(BtnSolTypeClick()));
-    connect(BtnSolType2, SIGNAL(clicked(bool)), this, SLOT(BtnSolTypeClick()));
-    connect(BtnTaskTray, SIGNAL(clicked(bool)), this, SLOT(BtnTaskTrayClick()));
-    connect(BtnTimeSys, SIGNAL(clicked(bool)), this, SLOT(BtnTimeSysClick()));
-    connect(BtnMark, SIGNAL(clicked(bool)), this, SLOT(BtnMarkClick()));
-    connect(ScbSol, SIGNAL(valueChanged(int)), this, SLOT(ScbSolChange()));
-    connect(&Timer, SIGNAL(timeout()), this, SLOT(TimerTimer()));
+    connect(systemTray,SIGNAL(activated(QSystemTrayIcon::ActivationReason)),this,SLOT(TrayIconClick(QSystemTrayIcon::ActivationReason)));
+    
+    connect(BtnExit,SIGNAL(clicked()),this,SLOT(BtnExitClick()));
+    connect(BtnStart,SIGNAL(clicked()),this,SLOT(BtnStartClick()));
+    connect(BtnStop,SIGNAL(clicked()),this,SLOT(BtnStopClick()));
+    connect(BtnPlot,SIGNAL(clicked()),this,SLOT(BtnPlotClick()));
+    connect(BtnAbout,SIGNAL(clicked(bool)),this,SLOT(BtnAboutClick()));
+    connect(BtnFreqType1,SIGNAL(clicked(bool)),this,SLOT(BtnFreqType1Click()));
+    connect(BtnFreqType2,SIGNAL(clicked(bool)),this,SLOT(BtnFreqType2Click()));
+    connect(BtnExpand,SIGNAL(clicked(bool)),this,SLOT(BtnExpand1Click()));
+    connect(BtnShrink,SIGNAL(clicked(bool)),this,SLOT(BtnShrink1Click()));
+    connect(BtnInputStr,SIGNAL(clicked(bool)),this,SLOT(BtnInputStrClick()));
+    connect(BtnLogStr,SIGNAL(clicked(bool)),this,SLOT(BtnLogStrClick()));
+    connect(BtnMonitor,SIGNAL(clicked(bool)),this,SLOT(BtnMonitorClick()));
+    connect(BtnOpt,SIGNAL(clicked(bool)),this,SLOT(BtnOptClick()));
+    connect(BtnOutputStr,SIGNAL(clicked(bool)),this,SLOT(BtnOutputStrClick()));
+    connect(BtnPanel,SIGNAL(clicked(bool)),this,SLOT(BtnPanelClick()));
+    connect(BtnPlot,SIGNAL(clicked(bool)),this,SLOT(BtnPlotClick()));
+    connect(BtnPlotType1,SIGNAL(clicked(bool)),this,SLOT(BtnPlotType1Click()));
+    connect(BtnPlotType2,SIGNAL(clicked(bool)),this,SLOT(BtnPlotType2Click()));
+    connect(BtnSave,SIGNAL(clicked(bool)),this,SLOT(BtnSaveClick()));
+    connect(BtnSolType,SIGNAL(clicked(bool)),this,SLOT(BtnSolTypeClick()));
+    connect(BtnSolType2,SIGNAL(clicked(bool)),this,SLOT(BtnSolTypeClick()));
+    connect(BtnTaskTray,SIGNAL(clicked(bool)),this,SLOT(BtnTaskTrayClick()));
+    connect(BtnTimeSys,SIGNAL(clicked(bool)),this,SLOT(BtnTimeSysClick()));
+    connect(BtnMark,SIGNAL(clicked(bool)),this,SLOT(BtnMarkClick()));
+    connect(ScbSol,SIGNAL(valueChanged(int)),this,SLOT(ScbSolChange()));
+    connect(&Timer,SIGNAL(timeout()),this,SLOT(TimerTimer()));
 
     Timer.setInterval(100);
     Timer.setSingleShot(false);
     Timer.start();
 
-#if 1
-    QString file = QApplication::applicationFilePath();
+    QString file=QApplication::applicationFilePath();
     QFileInfo fi(file);
-    IniFile = fi.absolutePath() + "/" + fi.baseName() + ".ini";
-#else // use unix config path
-    QSettings tempSettings(QSettings::IniFormat, QSettings::UserScope, "rtknavi-qt", "rtklib");
-    IniFile = tempSettings.fileName();
-#endif
+    IniFile=fi.absolutePath()+"/"+fi.baseName()+".ini";
+    
     InitSolBuff();
     strinitcom();
 
+#ifdef QT5
     QCommandLineParser parser;
-    parser.setApplicationDescription("RTK Navi Qt");
+    parser.setApplicationDescription("RTK Navi");
     parser.addHelpOption();
     parser.addVersionOption();
 
     QCommandLineOption iniFileOption(QStringList() << "i" << "ini-file",
-                     QCoreApplication::translate("main", "ini file to use"),
-                     QCoreApplication::translate("main", "ini file"));
+            QCoreApplication::translate("main", "ini file to use"),
+            QCoreApplication::translate("main", "ini file"));
     parser.addOption(iniFileOption);
 
-    QCommandLineOption trayOption(QStringList() << "tray",
-                      QCoreApplication::translate("main", "start as task tray icon."));
-    parser.addOption(trayOption);
-
-    QCommandLineOption autoOption(QStringList() << "auto",
-                      QCoreApplication::translate("main", "auto start."));
-    parser.addOption(autoOption);
-
     parser.process(*QApplication::instance());
 
     if (parser.isSet(iniFileOption))
-        IniFile = parser.value(iniFileOption);
-
-    if (parser.isSet(autoOption)) autorun = 1;
-    if (parser.isSet(trayOption)) tasktray = 1;
-
+        IniFile=parser.value(iniFileOption);
+#endif /*TODO: alternative for QT4 */
     LoadOpt();
-
+    
     LoadNav(&rtksvr.nav);
-
+    
     OpenMoniPort(MoniPort);
 
-    if (TLEFileF != "")
-        tle_read(qPrintable(TLEFileF), &TLEData);
-    if (TLESatFileF != "")
-        tle_name_read(qPrintable(TLESatFileF), &TLEData);
-
-    if (tasktray) {
-        setVisible(false);
-        systemTray->setVisible(true);
+    if (TLEFileF!="") {
+        tle_read(qPrintable(TLEFileF),&TLEData);
+    }
+    if (TLESatFileF!="") {
+        tle_name_read(qPrintable(TLESatFileF),&TLEData);
     }
-    if (autorun)
-        SvrStart();
 
     UpdatePanel();
     UpdateTimeSys();
@@ -314,1126 +276,1018 @@
     UpdateEnable();
 }
 // callback on form close ---------------------------------------------------
-void MainWindow::closeEvent(QCloseEvent *)
+void  MainWindow::closeEvent(QCloseEvent *event )
 {
-    trace(3, "FormClose\n");
+    trace(3,"FormClose\n");
 
-    if (OpenPort > 0) {
-        // send disconnect message
-        strwrite(&monistr, (unsigned char *)MSG_DISCONN, strlen(MSG_DISCONN));
+    if (event->spontaneous()) return;
 
+    if (OpenPort>0) {
+        // send disconnect message
+        strwrite(&monistr,(unsigned char *)MSG_DISCONN,strlen(MSG_DISCONN));
+        
         strclose(&monistr);
     }
     SaveOpt();
     SaveNav(&rtksvr.nav);
+
+    QWidget::closeEvent(event);
 }
 // update panel -------------------------------------------------------------
-void MainWindow::UpdatePanel(void)
+void  MainWindow::UpdatePanel(void)
 {
-    if (PanelMode<=3) {
-        Panel21->setVisible(true);
-        Panel5 ->setVisible(false);
-    }
-    else {
-        Panel21->setVisible(false);
-        Panel5 ->setVisible(true);
-    }
-    if (PanelMode==0||PanelMode==4) {
-        Panel22->setVisible(true);
-        Panel23->setVisible(false);
-        Panel24->setVisible(false);
-        Panel25->setVisible(false);
+    if (PanelMode==0) {
+        Panel21 ->setVisible(true);
+        Panel5  ->setVisible(false);
+        Panel221->setVisible(false);
     }
-    else if (PanelMode==1||PanelMode==5) {
-        Panel22->setVisible(true);
-        Panel23->setVisible(true);
-        Panel24->setVisible(false);
-        Panel25->setVisible(false);
+    else if (PanelMode==1) {
+        Panel21 ->setVisible(true);
+        Panel5  ->setVisible(false);
+        Panel221->setVisible(true);
     }
-    else if (PanelMode==2||PanelMode==6) {
-        Panel22->setVisible(true);
-        Panel23->setVisible(true);
-        Panel24->setVisible(true);
-        Panel25->setVisible(false);
+    else if (PanelMode==2) {
+        Panel21 ->setVisible(false);
+        Panel5  ->setVisible(true);
+        Panel221->setVisible(true);
     }
     else {
-        Panel22->setVisible(true);
-        Panel23->setVisible(true);
-        Panel24->setVisible(true);
-        Panel25->setVisible(true);
-    }
-    if (PanelStack==0) { // horizontal
-        splitter->setOrientation(Qt::Horizontal);
-    }
-    else { // vertical
-        splitter->setOrientation(Qt::Vertical);
+        Panel21 ->setVisible(false);
+        Panel5  ->setVisible(true);
+        Panel221->setVisible(false);
     }
 }
 // update enabled -----------------------------------------------------------
 void MainWindow::UpdateEnable(void)
 {
-    BtnExpand1->setVisible(PlotType[0] == 6);
-    BtnShrink1->setVisible(PlotType[0] == 6);
-    BtnExpand2->setVisible(PlotType[1] == 6);
-    BtnShrink2->setVisible(PlotType[1] == 6);
-    BtnExpand3->setVisible(PlotType[2] == 6);
-    BtnShrink3->setVisible(PlotType[2] == 6);
-    BtnExpand4->setVisible(PlotType[3] == 6);
-    BtnShrink4->setVisible(PlotType[3] == 6);
+    BtnExpand->setVisible(PlotType2==6);
+    BtnShrink->setVisible(PlotType2==6);
 }
 // callback on button-exit --------------------------------------------------
-void MainWindow::BtnExitClick()
+void  MainWindow::BtnExitClick()
 {
-    trace(3, "BtnExitClick\n");
-
+    trace(3,"BtnExitClick\n");
+    
     close();
 }
 // callback on button-start -------------------------------------------------
-void MainWindow::BtnStartClick()
+void  MainWindow::BtnStartClick()
 {
-    trace(3, "BtnStartClick\n");
-
+    trace(3,"BtnStartClick\n");
+    
     SvrStart();
 }
 // callback on button-stop --------------------------------------------------
-void MainWindow::BtnStopClick()
+void  MainWindow::BtnStopClick()
 {
-    trace(3, "BtnStopClick\n");
-
+    trace(3,"BtnStopClick\n");
+    
     SvrStop();
 }
 // callback on button-plot --------------------------------------------------
-void MainWindow::BtnPlotClick()
+void  MainWindow::BtnPlotClick()
 {
-    QString cmd1 = "rtkplot_qt", cmd2 = "..\\..\\..\\bin\\rtkplot_qt", cmd3 = "..\\rtkplot_qt\\rtkplot_qt", opts;
-
-    trace(3, "BtnPlotClick\n");
-
-    if (OpenPort <= 0) {
-        QMessageBox::critical(this, tr("Error"), tr("monitor port not open"));
+    QString cmd;
+    
+    trace(3,"BtnPlotClick\n");
+    
+    if (OpenPort<=0) {
+        QMessageBox::critical(this,tr("Error"),tr("monitor port not open"));
         return;
     }
-
-    opts = QString(" -p tcpcli://localhost:%1 -t \"%2 %3\"").arg(OpenPort)
-          .arg(windowTitle()).arg(": RTKPLOT QT");
-    if (!ExecCmd(cmd1 + opts, 1) && !ExecCmd(cmd2 + opts, 1) && !ExecCmd(cmd3 + opts, 1))
-        QMessageBox::critical(this, tr("Error"), tr("error: rtkplot execution"));
+    cmd=QString("rtkplot_qt -p tcpcli://localhost:%1 -t \"%2 %3\"").arg(OpenPort)
+                .arg(windowTitle()).arg(": RTKPLOT");
+    if (!ExecCmd(cmd,1)) {
+        QMessageBox::critical(this,tr("Error"),tr("error: rtkplot execution"));
+    }
 }
 // callback on button-options -----------------------------------------------
-void MainWindow::BtnOptClick()
+void  MainWindow::BtnOptClick()
 {
-    int i, chgmoni = 0;
-
-    trace(3, "BtnOptClick\n");
-
-    optDialog->PrcOpt = PrcOpt;
-    optDialog->SolOpt = SolOpt;
-    optDialog->DebugStatusF = DebugStatusF;
-    optDialog->DebugTraceF = DebugTraceF;
-    optDialog->BaselineC = BaselineC;
-    optDialog->Baseline[0] = Baseline[0];
-    optDialog->Baseline[1] = Baseline[1];
-
-    optDialog->RovPosTypeF = RovPosTypeF;
-    optDialog->RefPosTypeF = RefPosTypeF;
-    optDialog->RovAntPcvF = RovAntPcvF;
-    optDialog->RefAntPcvF = RefAntPcvF;
-    optDialog->RovAntF = RovAntF;
-    optDialog->RefAntF = RefAntF;
-
-    optDialog->SatPcvFileF = SatPcvFileF;
-    optDialog->AntPcvFileF = AntPcvFileF;
-    optDialog->StaPosFileF = StaPosFileF;
-    optDialog->GeoidDataFileF = GeoidDataFileF;
-    optDialog->DCBFileF = DCBFileF;
-    optDialog->EOPFileF = EOPFileF;
-    optDialog->TLEFileF = TLEFileF;
-    optDialog->TLESatFileF = TLESatFileF;
-    optDialog->LocalDirectory = LocalDirectory;
-
-    optDialog->SvrCycle = SvrCycle;
-    optDialog->TimeoutTime = TimeoutTime;
-    optDialog->ReconTime = ReconTime;
-    optDialog->NmeaCycle = NmeaCycle;
-    optDialog->FileSwapMargin = FileSwapMargin;
-    optDialog->SvrBuffSize = SvrBuffSize;
-    optDialog->SolBuffSize = SolBuffSize;
-    optDialog->SavedSol = SavedSol;
-    optDialog->NavSelect = NavSelect;
-    optDialog->DgpsCorr = DgpsCorr;
-    optDialog->SbasCorr = SbasCorr;
-    optDialog->ExSats = ExSats;
-    optDialog->ProxyAddr = ProxyAddr;
-    optDialog->MoniPort = MoniPort;
-    optDialog->PanelStack = PanelStack;
-    PosFont = optDialog->PosFont;
+    int i,chgmoni=0;
+    
+    trace(3,"BtnOptClick\n");
+    
+    optDialog->PrcOpt     =PrcOpt;
+    optDialog->SolOpt     =SolOpt;
+    optDialog->DebugStatusF=DebugStatusF;
+    optDialog->DebugTraceF=DebugTraceF;
+    optDialog->BaselineC  =BaselineC;
+    optDialog->Baseline[0]=Baseline[0];
+    optDialog->Baseline[1]=Baseline[1];
+    
+    optDialog->RovPosTypeF=RovPosTypeF;
+    optDialog->RefPosTypeF=RefPosTypeF;
+    optDialog->RovAntPcvF =RovAntPcvF;
+    optDialog->RefAntPcvF =RefAntPcvF;
+    optDialog->RovAntF    =RovAntF;
+    optDialog->RefAntF    =RefAntF;
+    
+    optDialog->SatPcvFileF=SatPcvFileF;
+    optDialog->AntPcvFileF=AntPcvFileF;
+    optDialog->StaPosFileF=StaPosFileF;
+    optDialog->GeoidDataFileF=GeoidDataFileF;
+    optDialog->DCBFileF   =DCBFileF;
+    optDialog->EOPFileF   =EOPFileF;
+    optDialog->TLEFileF   =TLEFileF;
+    optDialog->TLESatFileF=TLESatFileF;
+    optDialog->LocalDirectory=LocalDirectory;
+    
+    optDialog->SvrCycle   =SvrCycle;
+    optDialog->TimeoutTime=TimeoutTime;
+    optDialog->ReconTime  =ReconTime;
+    optDialog->NmeaCycle  =NmeaCycle;
+    optDialog->FileSwapMargin=FileSwapMargin;
+    optDialog->SvrBuffSize=SvrBuffSize;
+    optDialog->SolBuffSize=SolBuffSize;
+    optDialog->SavedSol   =SavedSol;
+    optDialog->NavSelect  =NavSelect;
+    optDialog->DgpsCorr   =DgpsCorr;
+    optDialog->SbasCorr   =SbasCorr;
+    optDialog->ExSats     =ExSats;
+    optDialog->ProxyAddr  =ProxyAddr;
+    optDialog->MoniPort   =MoniPort;
+    optDialog->PanelStack =PanelStack;
+    PosFont=optDialog->PosFont;
     UpdateFont();
     UpdatePanel();
 
-    for (i = 0; i < 3; i++) {
-        optDialog->RovAntDel[i] = RovAntDel[i];
-        optDialog->RefAntDel[i] = RefAntDel[i];
-        optDialog->RovPos   [i] = RovPos   [i];
-        optDialog->RefPos   [i] = RefPos   [i];
+    for (i=0;i<3;i++) {
+        optDialog->RovAntDel[i]=RovAntDel[i];
+        optDialog->RefAntDel[i]=RefAntDel[i];
+        optDialog->RovPos   [i]=RovPos   [i];
+        optDialog->RefPos   [i]=RefPos   [i];
     }
     optDialog->exec();
 
-    if (optDialog->result() != QDialog::Accepted) return;
-
-    PrcOpt = optDialog->PrcOpt;
-    SolOpt = optDialog->SolOpt;
-    DebugStatusF = optDialog->DebugStatusF;
-    DebugTraceF = optDialog->DebugTraceF;
-    BaselineC = optDialog->BaselineC;
-    Baseline[0] = optDialog->Baseline[0];
-    Baseline[1] = optDialog->Baseline[1];
-
-    RovPosTypeF = optDialog->RovPosTypeF;
-    RefPosTypeF = optDialog->RefPosTypeF;
-    RovAntPcvF = optDialog->RovAntPcvF;
-    RefAntPcvF = optDialog->RefAntPcvF;
-    RovAntF = optDialog->RovAntF;
-    RefAntF = optDialog->RefAntF;
-
-    SatPcvFileF = optDialog->SatPcvFileF;
-    AntPcvFileF = optDialog->AntPcvFileF;
-    StaPosFileF = optDialog->StaPosFileF;
-    GeoidDataFileF = optDialog->GeoidDataFileF;
-    DCBFileF = optDialog->DCBFileF;
-    EOPFileF = optDialog->EOPFileF;
-    TLEFileF = optDialog->TLEFileF;
-    TLESatFileF = optDialog->TLESatFileF;
-    LocalDirectory = optDialog->LocalDirectory;
-
-    SvrCycle = optDialog->SvrCycle;
-    TimeoutTime = optDialog->TimeoutTime;
-    ReconTime = optDialog->ReconTime;
-    NmeaCycle = optDialog->NmeaCycle;
-    FileSwapMargin = optDialog->FileSwapMargin;
-    SvrBuffSize = optDialog->SvrBuffSize;
-    SavedSol = optDialog->SavedSol;
-    NavSelect = optDialog->NavSelect;
-    DgpsCorr = optDialog->DgpsCorr;
-    SbasCorr = optDialog->SbasCorr;
-    ExSats = optDialog->ExSats;
-    ProxyAddr = optDialog->ProxyAddr;
-    if (MoniPort != optDialog->MoniPort) chgmoni = 1;
-    MoniPort = optDialog->MoniPort;
-    PanelStack = optDialog->PanelStack;
+    if (optDialog->result()!=QDialog::Accepted) return;
+    
+    PrcOpt     =optDialog->PrcOpt;
+    SolOpt     =optDialog->SolOpt;
+    DebugStatusF=optDialog->DebugStatusF;
+    DebugTraceF=optDialog->DebugTraceF;
+    BaselineC  =optDialog->BaselineC;
+    Baseline[0]=optDialog->Baseline[0];
+    Baseline[1]=optDialog->Baseline[1];
+    
+    RovPosTypeF=optDialog->RovPosTypeF;
+    RefPosTypeF=optDialog->RefPosTypeF;
+    RovAntPcvF =optDialog->RovAntPcvF;
+    RefAntPcvF =optDialog->RefAntPcvF;
+    RovAntF    =optDialog->RovAntF;
+    RefAntF    =optDialog->RefAntF;
+    
+    SatPcvFileF=optDialog->SatPcvFileF;
+    AntPcvFileF=optDialog->AntPcvFileF;
+    StaPosFileF=optDialog->StaPosFileF;
+    GeoidDataFileF=optDialog->GeoidDataFileF;
+    DCBFileF   =optDialog->DCBFileF;
+    EOPFileF   =optDialog->EOPFileF;
+    TLEFileF   =optDialog->TLEFileF;
+    TLESatFileF=optDialog->TLESatFileF;
+    LocalDirectory=optDialog->LocalDirectory;
 
-    if (SolBuffSize != optDialog->SolBuffSize) {
-        SolBuffSize = optDialog->SolBuffSize;
+    SvrCycle   =optDialog->SvrCycle;
+    TimeoutTime=optDialog->TimeoutTime;
+    ReconTime  =optDialog->ReconTime;
+    NmeaCycle  =optDialog->NmeaCycle;
+    FileSwapMargin=optDialog->FileSwapMargin;
+    SvrBuffSize=optDialog->SvrBuffSize;
+    SavedSol   =optDialog->SavedSol;
+    NavSelect  =optDialog->NavSelect;
+    DgpsCorr   =optDialog->DgpsCorr;
+    SbasCorr   =optDialog->SbasCorr;
+    ExSats     =optDialog->ExSats;
+    ProxyAddr  =optDialog->ProxyAddr;
+    if (MoniPort!=optDialog->MoniPort) chgmoni=1;
+    MoniPort   =optDialog->MoniPort;
+    PanelStack =optDialog->PanelStack;
+    
+    if (SolBuffSize!=optDialog->SolBuffSize) {
+        SolBuffSize=optDialog->SolBuffSize;
         InitSolBuff();
         UpdateTime();
         UpdatePos();
         UpdatePlot();
     }
-    for (i = 0; i < 3; i++) {
-        RovAntDel[i] = optDialog->RovAntDel[i];
-        RefAntDel[i] = optDialog->RefAntDel[i];
-        RovPos   [i] = optDialog->RovPos   [i];
-        RefPos   [i] = optDialog->RefPos   [i];
+    for (i=0;i<3;i++) {
+        RovAntDel[i]=optDialog->RovAntDel[i];
+        RefAntDel[i]=optDialog->RefAntDel[i];
+        RovPos   [i]=optDialog->RovPos   [i];
+        RefPos   [i]=optDialog->RefPos   [i];
     }
-    PosFont = optDialog->PosFont;
-
+    PosFont=optDialog->PosFont;
+    
     UpdateFont();
     UpdatePanel();
-
+    
     if (!chgmoni) return;
-
+    
     // send disconnect message
-    if (OpenPort > 0) {
-        strwrite(&monistr, (unsigned char *)MSG_DISCONN, strlen(MSG_DISCONN));
-
+    if (OpenPort>0) {
+        strwrite(&monistr,(unsigned char *)MSG_DISCONN,strlen(MSG_DISCONN));
+        
         strclose(&monistr);
     }
     // reopen monitor stream
     OpenMoniPort(MoniPort);
 }
 // callback on button-input-streams -----------------------------------------
-void MainWindow::BtnInputStrClick()
+void  MainWindow::BtnInputStrClick()
 {
-    int i, j;
-
-    trace(3, "BtnInputStrClick\n");
-
-    for (i = 0; i < 3; i++) {
-        inputStrDialog->StreamC[i] = StreamC[i];
-        inputStrDialog->Stream [i] = Stream [i];
-        inputStrDialog->Format [i] = Format [i];
-        inputStrDialog->RcvOpt [i] = RcvOpt [i];
+    int i,j;
+    
+    trace(3,"BtnInputStrClick\n");
 
+    for (i=0;i<3;i++) {
+        inputStrDialog->StreamC[i]=StreamC[i];
+        inputStrDialog->Stream [i]=Stream [i];
+        inputStrDialog->Format [i]=Format [i];
+        inputStrDialog->RcvOpt [i]=RcvOpt [i];
+        
         /* Paths[0]:serial,[1]:tcp,[2]:file,[3]:ftp */
-        for (j = 0; j < 4; j++) inputStrDialog->Paths[i][j] = Paths[i][j];
+        for (j=0;j<4;j++) inputStrDialog->Paths[i][j]=Paths[i][j];
     }
-    for (i = 0; i < 3; i++) for (j = 0; j < 3; j++) {
-            inputStrDialog->CmdEna   [i][j] = CmdEna   [i][j];
-            inputStrDialog->Cmds     [i][j] = Cmds     [i][j];
-            inputStrDialog->CmdEnaTcp[i][j] = CmdEnaTcp[i][j];
-            inputStrDialog->CmdsTcp  [i][j] = CmdsTcp  [i][j];
-        }
-    for (i = 0; i < 10; i++) {
-        inputStrDialog->History [i] = History [i];
-        inputStrDialog->MntpHist[i] = MntpHist[i];
+    for (i=0;i<3;i++) for (j=0;j<2;j++) {
+        inputStrDialog->CmdEna   [i][j]=CmdEna   [i][j];
+        inputStrDialog->Cmds     [i][j]=Cmds     [i][j];
+        inputStrDialog->CmdEnaTcp[i][j]=CmdEnaTcp[i][j];
+        inputStrDialog->CmdsTcp  [i][j]=CmdsTcp  [i][j];
     }
-    inputStrDialog->NmeaReq = NmeaReq;
-    inputStrDialog->TimeTag = InTimeTag;
-    inputStrDialog->TimeSpeed = InTimeSpeed;
-    inputStrDialog->TimeStart = InTimeStart;
-    inputStrDialog->Time64Bit = InTime64Bit;
-    inputStrDialog->NmeaPos[0] = NmeaPos[0];
-    inputStrDialog->NmeaPos[1] = NmeaPos[1];
-    inputStrDialog->NmeaPos[2] = NmeaPos[2];
-    inputStrDialog->ResetCmd = ResetCmd;
-    inputStrDialog->MaxBL = MaxBL;
-
+    for (i=0;i<10;i++) {
+        inputStrDialog->History [i]=History [i];
+        inputStrDialog->MntpHist[i]=MntpHist[i];
+    }
+    inputStrDialog->NmeaReq   =NmeaReq;
+    inputStrDialog->TimeTag   =InTimeTag;
+    inputStrDialog->TimeSpeed =InTimeSpeed;
+    inputStrDialog->TimeStart =InTimeStart;
+    inputStrDialog->NmeaPos[0]=NmeaPos[0];
+    inputStrDialog->NmeaPos[1]=NmeaPos[1];
+    
     inputStrDialog->exec();
 
-    if (inputStrDialog->result() != QDialog::Accepted) return;
-
-    for (i = 0; i < 3; i++) {
-        StreamC[i] = inputStrDialog->StreamC[i];
-        Stream [i] = inputStrDialog->Stream[i];
-        Format [i] = inputStrDialog->Format[i];
-        RcvOpt [i] = inputStrDialog->RcvOpt[i];
-        for (j = 0; j < 4; j++) Paths[i][j] = inputStrDialog->Paths[i][j];
+    if (inputStrDialog->result()!=QDialog::Accepted) return;
+    
+    for (i=0;i<3;i++) {
+        StreamC[i]=inputStrDialog->StreamC[i];
+        Stream [i]=inputStrDialog->Stream[i];
+        Format [i]=inputStrDialog->Format[i];
+        RcvOpt [i]=inputStrDialog->RcvOpt[i];
+        for (j=0;j<4;j++) Paths[i][j]=inputStrDialog->Paths[i][j];
     }
-    for (i = 0; i < 3; i++) for (j = 0; j < 3; j++) {
-            CmdEna   [i][j] = inputStrDialog->CmdEna   [i][j];
-            Cmds     [i][j] = inputStrDialog->Cmds     [i][j];
-            CmdEnaTcp[i][j] = inputStrDialog->CmdEnaTcp[i][j];
-            CmdsTcp  [i][j] = inputStrDialog->CmdsTcp  [i][j];
-        }
-    for (i = 0; i < 10; i++) {
-        History [i] = inputStrDialog->History [i];
-        MntpHist[i] = inputStrDialog->MntpHist[i];
+    for (i=0;i<3;i++) for (j=0;j<2;j++) {
+        CmdEna   [i][j]=inputStrDialog->CmdEna   [i][j];
+        Cmds     [i][j]=inputStrDialog->Cmds     [i][j];
+        CmdEnaTcp[i][j]=inputStrDialog->CmdEnaTcp[i][j];
+        CmdsTcp  [i][j]=inputStrDialog->CmdsTcp  [i][j];
     }
-    NmeaReq = inputStrDialog->NmeaReq;
-    InTimeTag = inputStrDialog->TimeTag;
-    InTimeSpeed = inputStrDialog->TimeSpeed;
-    InTimeStart = inputStrDialog->TimeStart;
-    InTime64Bit = inputStrDialog->Time64Bit;
-    NmeaPos[0] = inputStrDialog->NmeaPos[0];
-    NmeaPos[1] = inputStrDialog->NmeaPos[1];
-    NmeaPos[2] = inputStrDialog->NmeaPos[2];
-    ResetCmd = inputStrDialog->ResetCmd;
-    MaxBL = inputStrDialog->MaxBL;
+    for (i=0;i<10;i++) {
+        History [i]=inputStrDialog->History [i];
+        MntpHist[i]=inputStrDialog->MntpHist[i];
+    }
+    NmeaReq=inputStrDialog->NmeaReq;
+    InTimeTag  =inputStrDialog->TimeTag;
+    InTimeSpeed=inputStrDialog->TimeSpeed;
+    InTimeStart=inputStrDialog->TimeStart;
+    NmeaPos[0] =inputStrDialog->NmeaPos[0];
+    NmeaPos[1] =inputStrDialog->NmeaPos[1];
 }
 // confirm overwrite --------------------------------------------------------
-int MainWindow::ConfOverwrite(const QString &path)
+int  MainWindow::ConfOverwrite(const QString &path)
 {
-    int itype[] = { STR_SERIAL, STR_TCPCLI, STR_TCPSVR, STR_NTRIPCLI, STR_FILE, STR_FTP, STR_HTTP };
+    int itype[]={STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPCLI,STR_FILE,STR_FTP,STR_HTTP};
     int i;
     QString buff1, buff2;
-
-    trace(3, "ConfOverwrite\n");
-
-    buff1 = path.mid(path.indexOf("::"));
-
+    
+    trace(3,"ConfOverwrite\n");
+    
+    buff1=path.mid(path.indexOf("::"));
+        
     if (!QFile::exists(buff1)) return 1; // file not exists
-
+    
     // check overwrite input files
-    for (i = 0; i < 3; i++) {
-        if (!StreamC[i] || itype[Stream[i]] != STR_FILE) continue;
-
-        buff2 = Paths[i][2];
-        buff2 = buff2.mid(buff2.indexOf("::"));
-
-        if (buff1 == buff2) {
+    for (i=0;i<3;i++) {
+        if (!StreamC[i]||itype[Stream[i]]!=STR_FILE) continue;
+        
+        buff2=Paths[i][2];
+        buff2=buff2.mid(buff2.indexOf("::"));
+        
+        if (buff1==buff2) {
             Message->setText(QString(tr("invalid output %1")).arg(buff1));
             return 0;
         }
     }
 
-    return QMessageBox::question(this, tr("File exists"), buff1) == QMessageBox::Yes;
+    return QMessageBox::question(this,tr("File exists"),buff1)==QMessageBox::Yes;
 }
 // callback on button-output-streams ----------------------------------------
-void MainWindow::BtnOutputStrClick()
+void  MainWindow::BtnOutputStrClick()
 {
-    int otype[] = { STR_SERIAL, STR_TCPCLI, STR_TCPSVR, STR_NTRIPSVR, STR_NTRIPC_C, STR_FILE };
-    int i, j, str, update[2] = { 0 };
+    int otype[]={STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPSVR,STR_FILE};
+    int i,j,str,update[2]={0};
     char path[1024];
-
-    trace(3, "BtnOutputStrClick\n");
-
-    for (i = 3; i < 5; i++) {
-        outputStrDialog->StreamC[i - 3] = StreamC[i];
-        outputStrDialog->Stream [i - 3] = Stream[i];
-        outputStrDialog->Format [i - 3] = Format[i];
-        for (j = 0; j < 4; j++) outputStrDialog->Paths[i - 3][j] = Paths[i][j];
+    
+    trace(3,"BtnOutputStrClick\n");
+    
+    for (i=3;i<5;i++) {
+        outputStrDialog->StreamC[i-3]=StreamC[i];
+        outputStrDialog->Stream [i-3]=Stream[i];
+        outputStrDialog->Format [i-3]=Format[i];
+        for (j=0;j<4;j++) outputStrDialog->Paths[i-3][j]=Paths[i][j];
     }
-    for (i = 0; i < 10; i++) {
-        outputStrDialog->History [i] = History [i];
-        outputStrDialog->MntpHist[i] = MntpHist[i];
+    for (i=0;i<10;i++) {
+        outputStrDialog->History [i]=History [i];
+        outputStrDialog->MntpHist[i]=MntpHist[i];
     }
-    outputStrDialog->OutTimeTag = OutTimeTag;
-    outputStrDialog->OutAppend = OutAppend;
-    outputStrDialog->SwapInterval = OutSwapInterval;
+    outputStrDialog->OutTimeTag=OutTimeTag;
+    outputStrDialog->OutAppend =OutAppend;
+    outputStrDialog->SwapInterval=OutSwapInterval;
     outputStrDialog->exec();
 
-    if (outputStrDialog->result() != QDialog::Accepted) return;
-
-    for (i = 3; i < 5; i++) {
-        if (StreamC[i] != outputStrDialog->StreamC[i - 3] ||
-            Stream [i] != outputStrDialog->Stream[i - 3] ||
-            Format [i] != outputStrDialog->Format[i - 3] ||
-            Paths[i][0] != outputStrDialog->Paths[i - 3][0] ||
-            Paths[i][1] != outputStrDialog->Paths[i - 3][1] ||
-            Paths[i][2] != outputStrDialog->Paths[i - 3][2] ||
-            Paths[i][3] != outputStrDialog->Paths[i - 3][3]) update[i - 3] = 1;
-        StreamC[i] = outputStrDialog->StreamC[i - 3];
-        Stream [i] = outputStrDialog->Stream[i - 3];
-        Format [i] = outputStrDialog->Format[i - 3];
-        for (j = 0; j < 4; j++) Paths[i][j] = outputStrDialog->Paths[i - 3][j];
+    if (outputStrDialog->result()!=QDialog::Accepted) return;
+    
+    for (i=3;i<5;i++) {
+        if (StreamC[i]!=outputStrDialog->StreamC[i-3]||
+            Stream [i]!=outputStrDialog->Stream[i-3]||
+            Format [i]!=outputStrDialog->Format[i-3]||
+            Paths[i][0]!=outputStrDialog->Paths[i-3][0]||
+            Paths[i][1]!=outputStrDialog->Paths[i-3][1]||
+            Paths[i][2]!=outputStrDialog->Paths[i-3][2]||
+            Paths[i][3]!=outputStrDialog->Paths[i-3][3]) update[i-3]=1;
+        StreamC[i]=outputStrDialog->StreamC[i-3];
+        Stream [i]=outputStrDialog->Stream[i-3];
+        Format [i]=outputStrDialog->Format[i-3];
+        for (j=0;j<4;j++) Paths[i][j]=outputStrDialog->Paths[i-3][j];
     }
-    for (i = 0; i < 10; i++) {
-        History [i] = outputStrDialog->History [i];
-        MntpHist[i] = outputStrDialog->MntpHist[i];
+    for (i=0;i<10;i++) {
+        History [i]=outputStrDialog->History [i];
+        MntpHist[i]=outputStrDialog->MntpHist[i];
     }
-    OutTimeTag = outputStrDialog->OutTimeTag;
-    OutAppend = outputStrDialog->OutAppend;
-    OutSwapInterval = outputStrDialog->SwapInterval;
-
+    OutTimeTag=outputStrDialog->OutTimeTag;
+    OutAppend =outputStrDialog->OutAppend;
+    OutSwapInterval=outputStrDialog->SwapInterval;
+    
     if (BtnStart->isEnabled()) return;
-
-    for (i = 3; i < 5; i++) {
-        if (!update[i - 3]) continue;
-
-        rtksvrclosestr(&rtksvr, i);
-
+    
+    for (i=3;i<5;i++) {
+        if (!update[i-3]) continue;
+        
+        rtksvrclosestr(&rtksvr,i);
+        
         if (!StreamC[i]) continue;
-
-        str = otype[Stream[i]];
-        if (str == STR_SERIAL) strncpy(path, qPrintable(Paths[i][0]), 1024);
-        else if (str == STR_FILE) strncpy(path, qPrintable(Paths[i][2]), 1024);
-        else if (str == STR_FTP || str == STR_HTTP) strncpy(path, qPrintable(Paths[i][3]), 1024);
-        else strncpy(path, qPrintable(Paths[i][1]), 1024);
-        if (str == STR_FILE && !ConfOverwrite(path)) {
-            StreamC[i] = 0;
+        
+        str=otype[Stream[i]];
+        if      (str==STR_SERIAL)             strncpy(path,qPrintable(Paths[i][0]),1024);
+        else if (str==STR_FILE  )             strncpy(path,qPrintable(Paths[i][2]),1024);
+        else if (str==STR_FTP||str==STR_HTTP) strncpy(path,qPrintable(Paths[i][3]),1024);
+        else                                  strncpy(path,qPrintable(Paths[i][1]),1024);
+        if (str==STR_FILE&&!ConfOverwrite(path)) {
+            StreamC[i]=0;
             continue;
         }
-        SolOpt.posf = Format[i];
-        rtksvropenstr(&rtksvr, i, str, path, &SolOpt);
+        SolOpt.posf=Format[i];
+        rtksvropenstr(&rtksvr,i,str,path,&SolOpt);
     }
 }
 // callback on button-log-streams -------------------------------------------
-void MainWindow::BtnLogStrClick()
+void  MainWindow::BtnLogStrClick()
 {
-    int otype[] = { STR_SERIAL, STR_TCPCLI, STR_TCPSVR, STR_NTRIPSVR, STR_NTRIPC_C, STR_FILE };
-    int i, j, str, update[3] = { 0 };
+    int otype[]={STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPSVR,STR_FILE};
+    int i,j,str,update[3]={0};
     char path[1024];
-
-    trace(3, "BtnLogStrClick\n");
-
-    for (i = 5; i < 8; i++) {
-        logStrDialog->StreamC[i - 5] = StreamC[i];
-        logStrDialog->Stream [i - 5] = Stream [i];
-        for (j = 0; j < 4; j++) logStrDialog->Paths[i - 5][j] = Paths[i][j];
+    
+    trace(3,"BtnLogStrClick\n");
+    
+    for (i=5;i<8;i++) {
+        logStrDialog->StreamC[i-5]=StreamC[i];
+        logStrDialog->Stream [i-5]=Stream [i];
+        for (j=0;j<4;j++) logStrDialog->Paths[i-5][j]=Paths[i][j];
     }
-    for (i = 0; i < 10; i++) {
-        logStrDialog->History [i] = History [i];
-        logStrDialog->MntpHist[i] = MntpHist[i];
+    for (i=0;i<10;i++) {
+        logStrDialog->History [i]=History [i];
+        logStrDialog->MntpHist[i]=MntpHist[i];
     }
-    logStrDialog->LogTimeTag = LogTimeTag;
-    logStrDialog->LogAppend = LogAppend;
-    logStrDialog->SwapInterval = LogSwapInterval;
-
+    logStrDialog->LogTimeTag=LogTimeTag;
+    logStrDialog->LogAppend =LogAppend;
+    logStrDialog->SwapInterval=LogSwapInterval;
+    
     logStrDialog->exec();
 
-    if (logStrDialog->result() != QDialog::Accepted) return;
-
-    for (i = 5; i < 8; i++) {
-        if (StreamC[i] != outputStrDialog->StreamC[(i - 5) % 2] ||
-            Stream [i] != outputStrDialog->Stream[(i - 5) % 2] ||
-            Paths[i][0] != outputStrDialog->Paths[(i - 3) % 2][0] ||
-            Paths[i][1] != outputStrDialog->Paths[(i - 3) % 2][1] ||
-            Paths[i][2] != outputStrDialog->Paths[(i - 3) % 2][2] ||
-            Paths[i][3] != outputStrDialog->Paths[(i - 3) % 2][3]) update[i - 5] = 1;
-
-        StreamC[i] = logStrDialog->StreamC[i - 5];
-        Stream [i] = logStrDialog->Stream [i - 5];
-
-        for (j = 0; j < 4; j++) Paths[i][j] = logStrDialog->Paths[i - 5][j];
+    if (logStrDialog->result()!=QDialog::Accepted) return;
+    
+    for (i=5;i<8;i++) {
+        if (StreamC[i]!=outputStrDialog->StreamC[(i-5)%2]||
+            Stream [i]!=outputStrDialog->Stream[(i-5)%2]||
+            Paths[i][0]!=outputStrDialog->Paths[(i-3)%2][0]||
+            Paths[i][1]!=outputStrDialog->Paths[(i-3)%2][1]||
+            Paths[i][2]!=outputStrDialog->Paths[(i-3)%2][2]||
+            Paths[i][3]!=outputStrDialog->Paths[(i-3)%2][3]) update[i-5]=1;
+        StreamC[i]=logStrDialog->StreamC[i-5];
+        Stream [i]=logStrDialog->Stream [i-5];
+        for (j=0;j<4;j++) Paths[i][j]=logStrDialog->Paths[i-5][j];
     }
-    for (i = 0; i < 10; i++) {
-        History [i] = logStrDialog->History [i];
-        MntpHist[i] = logStrDialog->MntpHist[i];
+    for (i=0;i<10;i++) {
+        History [i]=logStrDialog->History [i];
+        MntpHist[i]=logStrDialog->MntpHist[i];
     }
-
-    LogTimeTag = logStrDialog->LogTimeTag;
-    LogAppend = logStrDialog->LogAppend;
-    LogSwapInterval = logStrDialog->SwapInterval;
-
+    LogTimeTag=logStrDialog->LogTimeTag;
+    LogAppend =logStrDialog->LogAppend;
+    LogSwapInterval=logStrDialog->SwapInterval;
+    
     if (BtnStart->isEnabled()) return;
-
-    for (i = 5; i < 8; i++) {
-        if (!update[i - 5]) continue;
-
-        rtksvrclosestr(&rtksvr, i);
-
+    
+    for (i=5;i<8;i++) {
+        if (!update[i-5]) continue;
+        
+        rtksvrclosestr(&rtksvr,i);
+        
         if (!StreamC[i]) continue;
-
-        str = otype[Stream[i]];
-        if (str == STR_SERIAL) strncpy(path, qPrintable(Paths[i][0]), 1024);
-        else if (str == STR_FILE) strncpy(path, qPrintable(Paths[i][2]), 1024);
-        else if (str == STR_FTP || str == STR_HTTP) strncpy(path, qPrintable(Paths[i][3]), 1024);
-        else strncpy(path, qPrintable(Paths[i][1]), 1024);
-        if (str == STR_FILE && !ConfOverwrite(path)) {
-            StreamC[i] = 0;
+        
+        str=otype[Stream[i]];
+        if      (str==STR_SERIAL)             strncpy(path,qPrintable(Paths[i][0]),1024);
+        else if (str==STR_FILE  )             strncpy(path,qPrintable(Paths[i][2]),1024);
+        else if (str==STR_FTP||str==STR_HTTP) strncpy(path,qPrintable(Paths[i][3]),1024);
+        else                                  strncpy(path,qPrintable(Paths[i][1]),1024);
+        if (str==STR_FILE&&!ConfOverwrite(path)) {
+            StreamC[i]=0;
             continue;
         }
-        rtksvropenstr(&rtksvr, i, str, path, &SolOpt);
+        rtksvropenstr(&rtksvr,i,str,path,&SolOpt);
     }
 }
 // callback on button-solution-show -----------------------------------------
-void MainWindow::BtnPanelClick()
+void  MainWindow::BtnPanelClick()
 {
-    trace(3, "BtnPanelClick\n");
-
-    if (++PanelMode > MAXPANELMODE) PanelMode = 0;
+    trace(3,"BtnPanelClick\n");
+    
+    if (++PanelMode>3) PanelMode=0;
     UpdatePanel();
 }
 // callback on button-plot-type-1 -------------------------------------------
-void MainWindow::BtnTimeSysClick()
+void  MainWindow::BtnTimeSysClick()
 {
-    trace(3, "BtnTimeSysClick\n");
-
-    if (++TimeSys > 3) TimeSys = 0;
+    trace(3,"BtnTimeSysClick\n");
+    
+    if (++TimeSys>3) TimeSys=0;
     UpdateTimeSys();
 }
 // callback on button-solution-type -----------------------------------------
-void MainWindow::BtnSolTypeClick()
+void  MainWindow::BtnSolTypeClick()
 {
-    trace(3, "BtnSolTypeClick\n");
-
-    if (++SolType > 4) SolType = 0;
+    trace(3,"BtnSolTypeClick\n");
+    
+    if (++SolType>4) SolType=0;
     UpdateSolType();
 }
 // callback on button-plottype-1 --------------------------------------------
-void MainWindow::BtnPlotType1Click()
+void  MainWindow::BtnPlotType1Click()
 {
-    trace(3, "BtnPlotType1Click\n");
-
-    if (++PlotType[0] > 6) PlotType[0] = 0;
+    trace(3,"BtnPlotType1Click\n");
+    
+    if (++PlotType1>6) PlotType1=0;
     UpdatePlot();
     UpdatePos();
     UpdateEnable();
 }
 // callback on button-plottype-2 --------------------------------------------
-void MainWindow::BtnPlotType2Click()
-{
-    trace(3, "BtnPlotType2Click\n");
-
-    if (++PlotType[1] > 6) PlotType[1] = 0;
-
-    UpdatePlot();
-    UpdatePos();
-    UpdateEnable();
-}
-//---------------------------------------------------------------------------
-void MainWindow::BtnPlotType3Click()
+void  MainWindow::BtnPlotType2Click()
 {
-    trace(3,"BtnPlotType3Click\n");
+    trace(3,"BtnPlotType2Click\n");
+    
+    if (++PlotType2>6) PlotType2=0;
 
-    if (++PlotType[2] > 6) PlotType[2] = 0;
     UpdatePlot();
     UpdatePos();
     UpdateEnable();
 }
-//---------------------------------------------------------------------------
-void MainWindow::BtnPlotType4Click()
+// callback on button frequency-type-1 --------------------------------------
+void  MainWindow::BtnFreqType1Click()
 {
-    trace(3,"BtnPlotType4Click\n");
-
-    if (++PlotType[3] > 6) PlotType[3] = 0;
-    UpdatePlot();
-    UpdatePos();
-    UpdateEnable();
-}
-//---------------------------------------------------------------------------
-void MainWindow::BtnFreqTypeChange(int i)
-    {
-    if (PlotType[i] == 6) {
-        if (++TrkType[i] > 1) TrkType[i] = 0;
+    trace(3,"BtnFreqType1Click\n");
+    
+    if (PlotType1==6) {
+        if (++TrkType1>1) TrkType1=0;
         UpdatePlot();
-    } else if (PlotType[i] == 5) {
-        if (++BLMode[i] > 1) BLMode[i] = 0;
+    }
+    else if (PlotType2==5) {
+        if (++BLMode1>1) BLMode1=0;
         UpdatePlot();
-    } else {
-        if (++FreqType[i] > NFREQ + 1) FreqType[i] = 0;
+    }
+    else {
+        if (++FreqType1>NFREQ+1) FreqType1=0;
         UpdateSolType();
     }
 }
-// callback on button frequency-type-1 --------------------------------------
-void MainWindow::BtnFreqType1Click()
-{
-    trace(3, "BtnFreqType1Click\n");
-
-    BtnFreqTypeChange(0);
-}
 // callback on button frequency-type-2 --------------------------------------
-void MainWindow::BtnFreqType2Click()
-{
-    trace(3, "BtnFreqType2Click\n");
-
-    BtnFreqTypeChange(1);
-}
-//---------------------------------------------------------------------------
-void MainWindow::BtnFreqType3Click()
-{
-    trace(3,"BtnFreqType3Click\n");
-
-    BtnFreqTypeChange(2);
-}
-//---------------------------------------------------------------------------
-void MainWindow::BtnFreqType4Click()
+void  MainWindow::BtnFreqType2Click()
 {
-    trace(3,"BtnFreqType4Click\n");
-
-    BtnFreqTypeChange(3);
+    trace(3,"BtnFreqType2Click\n");
+    
+    if (PlotType2==6) {
+        if (++TrkType2>1) TrkType2=0;
+        UpdatePlot();
+    }
+    else if (PlotType1==5) {
+        if (++BLMode2>1) BLMode2=0;
+        UpdatePlot();
+    }
+    else {
+        if (++FreqType2>NFREQ+1) FreqType2=0;
+        UpdateSolType();
+    }
 }
 // callback on button expand-1 ----------------------------------------------
 void MainWindow::BtnExpand1Click()
 {
-    if (TrkScale[0] <= 0) return;
-    TrkScale[0]--;
+    if (TrkScale2<=0) return;
+    TrkScale2--;
     UpdatePlot();
 }
 // callback on button shrink-1 ----------------------------------------------
 void MainWindow::BtnShrink1Click()
 {
-    if (TrkScale[0] >= MAXTRKSCALE) return;
-    TrkScale[0]++;
+    if (TrkScale2>=MAXTRKSCALE) return;
+    TrkScale2++;
     UpdatePlot();
 }
 // callback on button expand-2 ----------------------------------------------
 void MainWindow::BtnExpand2Click()
 {
-    if (TrkScale[1] <= 0) return;
-    TrkScale[1]--;
+    if (TrkScale2<=0) return;
+    TrkScale2--;
     UpdatePlot();
 }
 // callback on button shrink-2 ----------------------------------------------
 void MainWindow::BtnShrink2Click()
 {
-    if (TrkScale[1] >= MAXTRKSCALE) return;
-    TrkScale[1]++;
-    UpdatePlot();
-}
-// callback on button expand-3 ----------------------------------------------
-void MainWindow::BtnExpand3Click()
-{
-    if (TrkScale[2] <= 0) return;
-    TrkScale[2]--;
-    UpdatePlot();
-}
-// callback on button shrink-3 ----------------------------------------------
-void MainWindow::BtnShrink3Click()
-{
-    if (TrkScale[2] >= MAXTRKSCALE) return;
-    TrkScale[2]++;
-    UpdatePlot();
-}
-// callback on button expand-4 ----------------------------------------------
-void MainWindow::BtnExpand4Click()
-{
-    if (TrkScale[3] <= 0) return;
-    TrkScale[3]--;
-    UpdatePlot();
-}
-// callback on button shrink-4 ----------------------------------------------
-void MainWindow::BtnShrink4Click()
-{
-    if (TrkScale[3] >= MAXTRKSCALE) return;
-    TrkScale[3]++;
+    if (TrkScale2>=MAXTRKSCALE) return;
+    TrkScale2++;
     UpdatePlot();
 }
 // callback on button-rtk-monitor -------------------------------------------
-void MainWindow::BtnMonitorClick()
+void  MainWindow::BtnMonitorClick()
 {
-    trace(3, "BtnMonitorClick\n");
-
-    monitor->setWindowTitle(windowTitle() + ": RTK Monitor");
+    
+    trace(3,"BtnMonitorClick\n");
+    
+    monitor->setWindowTitle(windowTitle()+": RTK Monitor");
     monitor->show();
 }
 // callback on scroll-solution change ---------------------------------------
-void MainWindow::ScbSolChange()
+void  MainWindow::ScbSolChange()
 {
-    trace(3, "ScbSolChange\n");
-
-    PSol = PSolS + ScbSol->value();
-    if (PSol >= SolBuffSize) PSol -= SolBuffSize;
+    trace(3,"ScbSolChange\n");
+    
+    PSol=PSolS+ScbSol->value();
+    if (PSol>=SolBuffSize) PSol-=SolBuffSize;
 
     UpdateTime();
     UpdatePos();
     UpdatePlot();
 }
 // callback on button-save --------------------------------------------------
-void MainWindow::BtnSaveClick()
+void  MainWindow::BtnSaveClick()
 {
-    trace(3, "BtnSaveClick\n");
-
+    trace(3,"BtnSaveClick\n");
+    
     SaveLog();
 }
 // callback on button-about -------------------------------------------------
-void MainWindow::BtnAboutClick()
+void  MainWindow::BtnAboutClick()
 {
-    QString prog = PRGNAME;
-
-    trace(3, "BtnAboutClick\n");
+    QString prog=PRGNAME;
+    
+    trace(3,"BtnAboutClick\n");
 
-    aboutDialog = new AboutDialog(this);
-    aboutDialog->About = prog;
-    aboutDialog->IconIndex = 5;
+    aboutDialog=new AboutDialog(this);
+    aboutDialog->About=prog;
+    aboutDialog->IconIndex=5;
     aboutDialog->exec();
 
     delete aboutDialog;
 }
 // callback on button-tasktray ----------------------------------------------
-void MainWindow::BtnTaskTrayClick()
+void  MainWindow::BtnTaskTrayClick()
 {
-    trace(3, "BtnTaskTrayClick\n");
-
+    trace(3,"BtnTaskTrayClick\n");
+    
     setVisible(false);
     systemTray->setToolTip(windowTitle());
     systemTray->setVisible(true);
 }
 // callback on button-tasktray ----------------------------------------------
-void MainWindow::TrayIconClick(QSystemTrayIcon::ActivationReason reason)
+void  MainWindow::TrayIconClick(QSystemTrayIcon::ActivationReason reason)
 {
-    trace(3, "TaskIconDblClick\n");
-    if (reason != QSystemTrayIcon::DoubleClick) return;
+    trace(3,"TaskIconDblClick\n");
+    if (reason!=QSystemTrayIcon::DoubleClick) return;
 
     setVisible(true);
     systemTray->setVisible(false);
 }
 // callback on menu-expand --------------------------------------------------
-void MainWindow::MenuExpandClick()
+void  MainWindow::MenuExpandClick()
 {
-    trace(3, "MenuExpandClick\n");
-
+    trace(3,"MenuExpandClick\n");
+    
     setVisible(true);
     systemTray->setVisible(false);
 }
 // callback on menu-start ---------------------------------------------------
-void MainWindow::MenuStartClick()
+void  MainWindow::MenuStartClick()
 {
-    trace(3, "MenuStartClick\n");
-
+    trace(3,"MenuStartClick\n");
+    
     BtnStartClick();
 }
 // callback on menu-stop ----------------------------------------------------
-void MainWindow::MenuStopClick()
+void  MainWindow::MenuStopClick()
 {
-    trace(3, "MenuStopClick\n");
-
+    trace(3,"MenuStopClick\n");
+    
     BtnStopClick();
 }
 // callback on menu-monitor -------------------------------------------------
-void MainWindow::MenuMonitorClick()
+void  MainWindow::MenuMonitorClick()
 {
-    trace(3, "MenuMonitorClick\n");
-
+    trace(3,"MenuMonitorClick\n");
+    
     BtnMonitorClick();
 }
 // callback on menu-plot ----------------------------------------------------
-void MainWindow::MenuPlotClick()
+void  MainWindow::MenuPlotClick()
 {
-    trace(3, "MenuPlotClick\n");
-
+    trace(3,"MenuPlotClick\n");
+    
     BtnPlotClick();
 }
 // callback on menu-exit ----------------------------------------------------
-void MainWindow::MenuExitClick()
+void  MainWindow::MenuExitClick()
 {
-    trace(3, "MenuExitClick\n");
-
+    trace(3,"MenuExitClick\n");
+    
     BtnExitClick();
 }
 // start rtk server ---------------------------------------------------------
-void MainWindow::SvrStart(void)
+void  MainWindow::SvrStart(void)
 {
     solopt_t solopt[2];
-    double pos[3], nmeapos[3];
-    int itype[]={
-        STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPCLI,STR_FILE,STR_FTP,STR_HTTP
-    };
-    int otype[]={
-        STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPSVR,STR_NTRIPC_C,STR_FILE
-    };
-    int i, strs[MAXSTRRTK] = { 0 }, sat, ex, stropt[8] = { 0 };
-    char *paths[8], *cmds[3] = { 0 }, *cmds_periodic[3] = { 0 }, *rcvopts[3] = { 0 };
-    char buff[1024], *p, errmsg[20148];
-    gtime_t time = timeget();
-    pcvs_t pcvr, pcvs;
+    double pos[3],nmeapos[3];
+    int itype[]={STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPCLI,STR_FILE,STR_FTP,STR_HTTP};
+    int otype[]={STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPSVR,STR_FILE};
+    int i,strs[MAXSTRRTK]={0},sat,ex,stropt[8]={0};
+    char *paths[8],*cmds[3]={0},*rcvopts[3]={0};
+    char buff[1024],*p;
+    gtime_t time=timeget();
+    pcvs_t pcvr,pcvs;
     pcv_t *pcv;
-
-    trace(3, "SvrStart\n");
-
-    memset(&pcvr, 0, sizeof(pcvs_t));
-    memset(&pcvs, 0, sizeof(pcvs_t));
+    
+    trace(3,"SvrStart\n");
+    
+    memset(&pcvr,0,sizeof(pcvs_t));
+    memset(&pcvs,0,sizeof(pcvs_t));
 
     Message->setText("");
-
-    if (RovPosTypeF <= 2) { // LLH,XYZ
-        PrcOpt.rovpos = POSOPT_POS;
-        PrcOpt.ru[0] = RovPos[0];
-        PrcOpt.ru[1] = RovPos[1];
-        PrcOpt.ru[2] = RovPos[2];
-    } else { // RTCM position
-        PrcOpt.rovpos = POSOPT_RTCM;
-        for (i = 0; i < 3; i++) PrcOpt.ru[i] = 0.0;
+    
+    if (RovPosTypeF<=2) { // LLH,XYZ
+        PrcOpt.rovpos=0;
+        PrcOpt.ru[0]=RovPos[0];
+        PrcOpt.ru[1]=RovPos[1];
+        PrcOpt.ru[2]=RovPos[2];
     }
-    if (RefPosTypeF <= 2) { // LLH,XYZ
-        PrcOpt.refpos = POSOPT_POS;
-        PrcOpt.rb[0] = RefPos[0];
-        PrcOpt.rb[1] = RefPos[1];
-        PrcOpt.rb[2] = RefPos[2];
-    } else if (RefPosTypeF == 3) { // RTCM position
-        PrcOpt.refpos = POSOPT_RTCM;
-        for (i=0;i<3;i++) PrcOpt.rb[i] = 0.0;
-    } else if (RefPosTypeF == 4) { // raw position
-        PrcOpt.refpos = POSOPT_RAW;
-        for (i = 0; i < 3; i++) PrcOpt.rb[i] = 0.0;
-    } else { // average of single position
-        PrcOpt.refpos = POSOPT_SINGLE;
-        for (i = 0; i < 3; i++) PrcOpt.rb[i] = 0.0;
+    else { // RTCM position
+        PrcOpt.rovpos=4;
+        for (i=0;i<3;i++) PrcOpt.ru[i]=0.0;
+    }
+    if (RefPosTypeF<=2) { // LLH,XYZ
+        PrcOpt.refpos=0;
+        PrcOpt.rb[0]=RefPos[0];
+        PrcOpt.rb[1]=RefPos[1];
+        PrcOpt.rb[2]=RefPos[2];
+    }
+    else if (RefPosTypeF==3) { // RTCM position
+        PrcOpt.refpos=4;
+        for (i=0;i<3;i++) PrcOpt.rb[i]=0.0;
+    }else { // average of single position
+        PrcOpt.refpos=1;
+        for (i=0;i<3;i++) PrcOpt.rb[i]=0.0;
     }
 
-    for (i = 0; i < MAXSAT; i++)
-        PrcOpt.exsats[i] = 0;
-    if (ExSats != "") { // excluded satellites
-        strcpy(buff, qPrintable(ExSats));
-        for (p = strtok(buff, " "); p; p = strtok(NULL, " ")) {
-            if (*p == '+') {
-                ex = 2; p++;
-            } else {
-                ex = 1;
-            }
-            if (!(sat = satid2no(p))) continue;
-            PrcOpt.exsats[sat - 1] = (unsigned char)ex;
+    for (i=0;i<MAXSAT;i++) {
+        PrcOpt.exsats[i]=0;
+    }
+    if (ExSats!="") { // excluded satellites
+        strcpy(buff,qPrintable(ExSats));
+        for (p=strtok(buff," ");p;p=strtok(NULL," ")) {
+            if (*p=='+') {ex=2; p++;} else ex=1;
+            if (!(sat=satid2no(p))) continue;
+            PrcOpt.exsats[sat-1]=ex;
         }
     }
-    if ((RovAntPcvF || RefAntPcvF) && !readpcv(qPrintable(AntPcvFileF), &pcvr)) {
+    if ((RovAntPcvF||RefAntPcvF)&&!readpcv(qPrintable(AntPcvFileF),&pcvr)) {
         Message->setText(QString(tr("rcv ant file read error %1")).arg(AntPcvFileF));
         return;
     }
     if (RovAntPcvF) {
-        if ((pcv = searchpcv(0, qPrintable(RovAntF), time, &pcvr)))
-            PrcOpt.pcvr[0] = *pcv;
-        else
+        if ((pcv=searchpcv(0,qPrintable(RovAntF),time,&pcvr))) {
+            PrcOpt.pcvr[0]=*pcv;
+        }
+        else {
             Message->setText(QString(tr("no antenna pcv %1")).arg(qPrintable(RovAntF)));
-        for (i = 0; i < 3; i++) PrcOpt.antdel[0][i] = RovAntDel[i];
+        }
+        for (i=0;i<3;i++) PrcOpt.antdel[0][i]=RovAntDel[i];
     }
     if (RefAntPcvF) {
-        if ((pcv = searchpcv(0, qPrintable(RefAntF), time, &pcvr)))
-            PrcOpt.pcvr[1] = *pcv;
-        else
+        if ((pcv=searchpcv(0,qPrintable(RefAntF),time,&pcvr))) {
+            PrcOpt.pcvr[1]=*pcv;
+        }
+        else {
             Message->setText(QString(tr("no antenna pcv %1")).arg(qPrintable(RefAntF)));
-        for (i = 0; i < 3; i++) PrcOpt.antdel[1][i] = RefAntDel[i];
+        }
+        for (i=0;i<3;i++) PrcOpt.antdel[1][i]=RefAntDel[i];
     }
-    if (RovAntPcvF || RefAntPcvF)
+    if (RovAntPcvF||RefAntPcvF) {
         free(pcvr.pcv);
-    if (PrcOpt.sateph == EPHOPT_PREC || PrcOpt.sateph == EPHOPT_SSRCOM) {
-        if (!readpcv(qPrintable(SatPcvFileF), &pcvs)) {
+    }
+    if (PrcOpt.sateph==EPHOPT_PREC||PrcOpt.sateph==EPHOPT_SSRCOM) {
+        if (!readpcv(qPrintable(SatPcvFileF),&pcvs)) {
             Message->setText(QString(tr("sat ant file read error %1")).arg(SatPcvFileF));
             return;
         }
-        for (i = 0; i < MAXSAT; i++) {
-            if (!(pcv = searchpcv(i + 1, "", time, &pcvs))) continue;
-            rtksvr.nav.pcvs[i] = *pcv;
+        for (i=0;i<MAXSAT;i++) {
+            if (!(pcv=searchpcv(i+1,"",time,&pcvs))) continue;
+            rtksvr.nav.pcvs[i]=*pcv;
         }
         free(pcvs.pcv);
     }
     if (BaselineC) {
-        PrcOpt.baseline[0] = Baseline[0];
-        PrcOpt.baseline[1] = Baseline[1];
-    } else {
-        PrcOpt.baseline[0] = 0.0;
-        PrcOpt.baseline[1] = 0.0;
+        PrcOpt.baseline[0]=Baseline[0];
+        PrcOpt.baseline[1]=Baseline[1];
     }
-    for (i = 0; i < 3; i++) strs[i] = StreamC[i] ? itype[Stream[i]] : STR_NONE;
-    for (i = 3; i < 5; i++) strs[i] = StreamC[i] ? otype[Stream[i]] : STR_NONE;
-    for (i = 5; i < 8; i++) strs[i] = StreamC[i] ? otype[Stream[i]] : STR_NONE;
-
-    for (i = 0; i < 8; i++) {
-        paths[i] = new char[1024];
-        paths[i][0] = '\0';
-        if (strs[i] == STR_NONE) strcpy(paths[i], "");
-        else if (strs[i] == STR_SERIAL) strcpy(paths[i], qPrintable(Paths[i][0]));
-        else if (strs[i] == STR_FILE) strcpy(paths[i], qPrintable(Paths[i][2]));
-        else if (strs[i] == STR_FTP || strs[i] == STR_HTTP) strcpy(paths[i], qPrintable(Paths[i][3]));
-        else strcpy(paths[i], qPrintable(Paths[i][1]));
+    else {
+        PrcOpt.baseline[0]=0.0;
+        PrcOpt.baseline[1]=0.0;
     }
-
-    for (i = 0; i < 3; i++) {
-        rcvopts[i] = new char[1024];
-        cmds[i] = cmds_periodic[i] = NULL;
-
-        if (strs[i] == STR_SERIAL) {
-            cmds[i] = new char[1024];
-            cmds_periodic[i] = new char[1024];
-            if (CmdEna[i][0]) strcpy(cmds[i], qPrintable(Cmds[i][0]));
-            if (CmdEna[i][2]) strcpy(cmds_periodic[i], qPrintable(Cmds[i][2]));
-        } else if (strs[i] == STR_TCPCLI || strs[i] == STR_TCPSVR ||
-               strs[i] == STR_NTRIPCLI) {
-            cmds[i] = new char[1024];
-            cmds_periodic[i] = new char[1024];
-            if (CmdEnaTcp[i][0]) strcpy(cmds[i], qPrintable(CmdsTcp[i][0]));
-            if (CmdEna[i][2]) strcpy(cmds_periodic[i], qPrintable(CmdsTcp[i][2]));
-        };
-        strcpy(rcvopts[i], qPrintable(RcvOpt[i]));
+    for (i=0;i<3;i++) strs[i]=StreamC[i]?itype[Stream[i]]:STR_NONE;
+    for (i=3;i<5;i++) strs[i]=StreamC[i]?otype[Stream[i]]:STR_NONE;
+    for (i=5;i<8;i++) strs[i]=StreamC[i]?otype[Stream[i]]:STR_NONE;
+    for (i=0;i<8;i++) {
+        paths[i]= new char[1024];
+        paths[i][0]='\0';
+        if      (strs[i]==STR_NONE  ) strcpy(paths[i],"");
+        else if (strs[i]==STR_SERIAL) strcpy(paths[i],qPrintable(Paths[i][0]));
+        else if (strs[i]==STR_FILE  ) strcpy(paths[i],qPrintable(Paths[i][2]));
+        else if (strs[i]==STR_FTP||strs[i]==STR_HTTP) strcpy(paths[i],qPrintable(Paths[i][3]));
+        else strcpy(paths[i],qPrintable(Paths[i][1]));
     }
-    NmeaCycle = NmeaCycle < 1000 ? 1000 : NmeaCycle;
-    pos[0] = NmeaPos[0] * D2R;
-    pos[1] = NmeaPos[1] * D2R;
-    pos[2] = NmeaPos[2];
-    pos2ecef(pos, nmeapos);
-
+    for (i=0;i<3;i++) {
+        cmds[i]=new char[1024];
+        rcvopts[i]=new char[1024];
+        cmds[i][0]=rcvopts[i][0]='\0';
+        if (strs[i]==STR_SERIAL) {
+            if (CmdEna[i][0]) strcpy(cmds[i],qPrintable(Cmds[i][0]));
+        }
+        else if (strs[i]==STR_TCPCLI||strs[i]==STR_TCPSVR||
+                 strs[i]==STR_NTRIPCLI) {
+            if (CmdEnaTcp[i][0]) strcpy(cmds[i],qPrintable(CmdsTcp[i][0]));
+        }
+        strcpy(rcvopts[i],qPrintable(RcvOpt[i]));
+    }
+    NmeaCycle=NmeaCycle<1000?1000:NmeaCycle;
+    pos[0]=NmeaPos[0]*D2R;
+    pos[1]=NmeaPos[1]*D2R;
+    pos[2]=0.0;
+    pos2ecef(pos,nmeapos);
+    
     strsetdir(qPrintable(LocalDirectory));
     strsetproxy(qPrintable(ProxyAddr));
-
-    for (i = 3; i < 8; i++)
-        if (strs[i] == STR_FILE && !ConfOverwrite(paths[i])) return;
-
-    if (DebugTraceF > 0) {
+    
+    for (i=3;i<8;i++) {
+        if (strs[i]==STR_FILE&&!ConfOverwrite(paths[i])) return;
+    }
+    if (DebugTraceF>0) {
         traceopen(TRACEFILE);
         tracelevel(DebugTraceF);
     }
-
-    if (DebugStatusF > 0)
-        rtkopenstat(STATFILE, DebugStatusF);
-    if (SolOpt.geoid > 0 && GeoidDataFileF != "")
-        opengeoid(SolOpt.geoid, qPrintable(GeoidDataFileF));
-    if (DCBFileF != "")
-        readdcb(qPrintable(DCBFileF), &rtksvr.nav, NULL);
-    for (i = 0; i < 2; i++) {
-        solopt[i] = SolOpt;
-        solopt[i].posf = Format[i + 3];
+    if (DebugStatusF>0) {
+        rtkopenstat(STATFILE,DebugStatusF);
     }
-    stropt[0] = TimeoutTime;
-    stropt[1] = ReconTime;
-    stropt[2] = 1000;
-    stropt[3] = SvrBuffSize;
-    stropt[4] = FileSwapMargin;
+    if (SolOpt.geoid>0&&GeoidDataFileF!="") {
+        opengeoid(SolOpt.geoid,qPrintable(GeoidDataFileF));
+    }
+    if (DCBFileF!="") {
+        readdcb(qPrintable(DCBFileF),&rtksvr.nav,NULL);
+    }
+    for (i=0;i<2;i++) {
+        solopt[i]=SolOpt;
+        solopt[i].posf=Format[i+3];
+    }
+    stropt[0]=TimeoutTime;
+    stropt[1]=ReconTime;
+    stropt[2]=1000;
+    stropt[3]=SvrBuffSize;
+    stropt[4]=FileSwapMargin;
     strsetopt(stropt);
-    strcpy(rtksvr.cmd_reset, qPrintable(ResetCmd));
-    rtksvr.bl_reset = MaxBL;
-
+    
     // start rtk server
-    if (!rtksvrstart(&rtksvr, SvrCycle, SvrBuffSize, strs, paths, Format, NavSelect,
-                     cmds,cmds_periodic,rcvopts,NmeaCycle,NmeaReq,nmeapos,
-                     &PrcOpt,solopt,&monistr,errmsg)) {
-
-        trace(2,"rtksvrstart error %s\n",errmsg);
+    if (!rtksvrstart(&rtksvr,SvrCycle,SvrBuffSize,strs,paths,Format,NavSelect,
+                     cmds,rcvopts,NmeaCycle,NmeaReq,nmeapos,&PrcOpt,solopt,
+                     &monistr)) {
         traceclose();
-        for (i = 0; i < 8; i++) delete[] paths[i];
-        for (i = 0; i < 3; i++) delete[] rcvopts[i];
-        for (i = 0; i < 3; i++) if (cmds[i]) delete[] cmds[i];
-        for (i = 0; i < 3; i++) if (cmds_periodic[i]) delete[] cmds_periodic[i];
+        for (i=0;i<8;i++) delete[] paths[i];
+        for (i=0;i<3;i++) delete[] rcvopts[i];
+        for (i=0;i<3;i++) delete[] cmds[i];
         return;
     }
-
-    for (i = 0; i < 8; i++) delete[] paths[i];
-    for (i = 0; i < 3; i++) delete[] rcvopts[i];
-    for (i = 0; i < 3; i++) if (cmds[i]) delete[] cmds[i];
-    for (i = 0; i < 3; i++) if (cmds_periodic[i]) delete[] cmds_periodic[i];
-
-    PSol = PSolS = PSolE = 0;
-    SolStat[0] = Nvsat[0] = 0;
-
-    for (i = 0; i < 3; i++) SolRov[i] = SolRef[i] = VelRov[i] = 0.0;
-    for (i = 0; i < 9; i++) Qr[i] = 0.0;
-
-    Age[0] = Ratio[0] = 0.0;
-    Nsat[0] = Nsat[1] = 0;
-
+    for (i=0;i<8;i++) delete[] paths[i];
+    for (i=0;i<3;i++) delete[] rcvopts[i];
+    for (i=0;i<3;i++) delete[] cmds[i];
+    PSol=PSolS=PSolE=0;
+    SolStat[0]=Nvsat[0]=0;
+    for (i=0;i<3;i++) SolRov[i]=SolRef[i]=VelRov[i]=0.0;
+    for (i=0;i<9;i++) Qr[i]=0.0;
+    Age[0]=Ratio[0]=0.0;
+    Nsat[0]=Nsat[1]=0;
     UpdatePos();
     UpdatePlot();
-
-    BtnStart->setVisible(false);
-    BtnOpt->setEnabled(false);
-    BtnExit->setEnabled(false);
-    BtnInputStr->setEnabled(false);
-    MenuStartAction->setEnabled(false);
-    MenuExitAction->setEnabled(false);
-    ScbSol->setEnabled(false);
-    BtnStop->setVisible(true);
-    MenuStopAction->setEnabled(true);
+    BtnStart   ->setVisible(false);
+    BtnOpt      ->setEnabled(false);
+    BtnExit     ->setEnabled(false);
+    BtnInputStr ->setEnabled(false);
+    MenuStartAction   ->setEnabled(false);
+    MenuExitAction    ->setEnabled(false);
+    ScbSol      ->setEnabled(false);
+    BtnStop     ->setVisible(true);
+    MenuStopAction    ->setEnabled(true);
     Svr->setStyleSheet("QLabel {background-color: rgb(255,128,0);}");
-
     SetTrayIcon(0);
 }
 // strop rtk server ---------------------------------------------------------
-void MainWindow::SvrStop(void)
+void  MainWindow::SvrStop(void)
 {
-    char *cmds[3] = { 0 };
-    int i, n, m, str;
-
-    trace(3, "SvrStop\n");
-
-    for (i = 0; i < 3; i++) {
-        cmds[i] = NULL;
-        str = rtksvr.stream[i].type;
-
-        if (str == STR_SERIAL) {
-            cmds[i] = new char[1024];
-            if (CmdEna[i][1]) strcpy(cmds[i], qPrintable(Cmds[i][1]));
-        } else if (str == STR_TCPCLI || str == STR_TCPSVR || str == STR_NTRIPCLI) {
-            cmds[i] = new char[1024];
-            if (CmdEnaTcp[i][1]) strcpy(cmds[i], qPrintable(CmdsTcp[i][1]));
+    char *cmds[3]={0};
+    int i,n,m,str;
+    
+    trace(3,"SvrStop\n");
+    
+    for (i=0;i<3;i++) {
+        cmds[i]=new char[1024];
+        cmds[i][0]='\0';
+        str=rtksvr.stream[i].type;
+        
+        if (str==STR_SERIAL) {
+            if (CmdEna[i][1]) strcpy(cmds[i],qPrintable(Cmds[i][1]));
+        }
+        else if (str==STR_TCPCLI||str==STR_TCPSVR||str==STR_NTRIPCLI) {
+            if (CmdEnaTcp[i][1]) strcpy(cmds[i],qPrintable(CmdsTcp[i][1]));
         }
     }
-    rtksvrstop(&rtksvr, cmds);
-
-    for (i = 0; i < 3; i++) delete[] cmds[i];
-
-    BtnStart->setVisible(true);
-    BtnOpt->setEnabled(true);
-    BtnExit->setEnabled(true);
-    BtnInputStr->setEnabled(true);
-    MenuStartAction->setEnabled(true);
-    MenuExitAction->setEnabled(true);
-    ScbSol->setEnabled(true);
-    BtnStop->setVisible(false);
-    MenuStopAction->setEnabled(false);
+    rtksvrstop(&rtksvr,cmds);
+    for (i=0;i<3;i++) delete[] cmds[i];
+    
+    BtnStart    ->setVisible(true);
+    BtnOpt      ->setEnabled(true);
+    BtnExit     ->setEnabled(true);
+    BtnInputStr ->setEnabled(true);
+    MenuStartAction   ->setEnabled(true);
+    MenuExitAction    ->setEnabled(true);
+    ScbSol      ->setEnabled(true);
+    BtnStop     ->setVisible(false);
+    MenuStopAction    ->setEnabled(false);
     Svr->setStyleSheet("QLabel {background-color: gray;}");
-
     SetTrayIcon(1);
-
+    
     LabelTime->setStyleSheet("QLabel {color: gray;}");
     IndSol->setStyleSheet("QLabel {color: white; background-color: white;}");
-
-    n = PSolE - PSolS; if (n < 0) n += SolBuffSize;
-    m = PSol - PSolS;  if (m < 0) m += SolBuffSize;
-    if (n > 0) {
-        ScbSol->setMaximum(n - 1); ScbSol->setValue(m);
+    n=PSolE-PSolS; if (n<0) n+=SolBuffSize;
+    m=PSol-PSolS;  if (m<0) m+=SolBuffSize;
+    if (n>0) {
+        ScbSol->setMaximum(n-1); ScbSol->setValue(m);
     }
     Message->setText("");
-
-    if (DebugTraceF > 0) traceclose();
-    if (DebugStatusF > 0) rtkclosestat();
-    if (SolOpt.geoid > 0 && GeoidDataFileF != "") closegeoid();
+    
+    if (DebugTraceF>0) traceclose();
+    if (DebugStatusF>0) rtkclosestat();
+    if (SolOpt.geoid>0&&GeoidDataFileF!="") closegeoid();
 }
 // callback on interval timer -----------------------------------------------
-void MainWindow::TimerTimer()
+void  MainWindow::TimerTimer()
 {
-    static int n = 0, inactive = 0;
+    static int n=0,inactive=0;
     sol_t *sol;
-    int i, update = 0;
-
-    trace(4, "TimerTimer\n");
-
+    int i,update=0;
+    
+    trace(4,"TimerTimer\n");
+    
     rtksvrlock(&rtksvr);
-
-    for (i = 0; i < rtksvr.nsol; i++) {
-        sol = rtksvr.solbuf + i;
-        UpdateLog(sol->stat, sol->time, sol->rr, sol->qr, rtksvr.rtk.rb, sol->ns,
-              sol->age, sol->ratio);
-        update = 1;
+    
+    for (i=0;i<rtksvr.nsol;i++) {
+        sol=rtksvr.solbuf+i;
+        UpdateLog(sol->stat,sol->time,sol->rr,sol->qr,rtksvr.rtk.rb,sol->ns,
+                  sol->age,sol->ratio);
+        update=1;
     }
-    rtksvr.nsol = 0;
-    SolCurrentStat = rtksvr.state ? rtksvr.rtk.sol.stat : 0;
-
+    rtksvr.nsol=0;
+    SolCurrentStat=rtksvr.state?rtksvr.rtk.sol.stat:0;
+    
     rtksvrunlock(&rtksvr);
-
+    
     if (update) {
         UpdateTime();
         UpdatePos();
-        inactive = 0;
-    } else {
-        if (++inactive * Timer.interval() > TIMEOUT) SolCurrentStat = 0;
+        inactive=0;
+    }
+    else {
+        if (++inactive*Timer.interval()>TIMEOUT) SolCurrentStat=0;
     }
-
     if (SolCurrentStat) {
         Svr->setStyleSheet("QLabel {background-color: rgb(0,255,0);}");
         LabelTime->setStyleSheet("QLabel { color: black;}");
-    } else {
+    }
+    else {
         IndSol->setStyleSheet("QLabel {color: white; background-color: white;}");
         Solution->setStyleSheet("QLabel {color: gray;}");
-        Svr->setStyleSheet(rtksvr.state ? "QLabel {background-color: green; }" : "QLabel {background-color: gray; }");
+        Svr->setStyleSheet(rtksvr.state?"QLabel {background-color: green; }":"QLabel {background-color: gray; }");
     }
-
-    if (!(++n % 5)) UpdatePlot();
+    if (!(++n%5)) UpdatePlot();
 
     UpdateStr();
-
+    
     // keep alive for monitor port
-    if (!(++n % (KACYCLE / Timer.interval())) && OpenPort) {
+    if (!(++n%(KACYCLE/Timer.interval()))&&OpenPort) {
         unsigned char buf[1];
-        buf[0] = '\r';
-        strwrite(&monistr, buf, 1);
+        buf[0]='\r';
+        strwrite(&monistr,buf,1);
     }
 }
 // change plot type ---------------------------------------------------------
-void MainWindow::ChangePlot(void)
+void  MainWindow::ChangePlot(void)
 {
 }
 // update time-system -------------------------------------------------------
-void MainWindow::UpdateTimeSys(void)
+void  MainWindow::UpdateTimeSys(void)
 {
-    QString label[] = { tr("GPST"), tr("UTC"), tr("LT"), tr("GPST") };
-
-    trace(3, "UpdateTimeSys\n");
-
+    QString label[]={tr("GPST"),tr("UTC"),tr("LT"),tr("GPST")};
+    
+    trace(3,"UpdateTimeSys\n");
+    
     BtnTimeSys->setText(label[TimeSys]);
     UpdateTime();
 }
 // update solution type -----------------------------------------------------
-void MainWindow::UpdateSolType(void)
+void  MainWindow::UpdateSolType(void)
 {
-    QString label[] = {
-        tr("Lat/Lon/Height"),		 tr("Lat/Lon/Height"), tr("X/Y/Z-ECEF"), tr("E/N/U-Baseline"),
-        tr("Pitch/Yaw/Length-Baseline"), ""
+    QString label[]={
+        tr("Lat/Lon/Height"),tr("Lat/Lon/Height"),tr("X/Y/Z-ECEF"),tr("E/N/U-Baseline"),
+        tr("Pitch/Yaw/Length-Baseline"),""
     };
-
-    trace(3, "UpdateSolType\n");
-
+    trace(3,"UpdateSolType\n");
+    
     Plabel0->setText(label[SolType]);
 
     UpdatePos();
 }
 // update log ---------------------------------------------------------------
-void MainWindow::UpdateLog(int stat, gtime_t time, double *rr,
-               float *qr, double *rb, int ns, double age, double ratio)
+void  MainWindow::UpdateLog(int stat, gtime_t time, double *rr,
+    float *qr, double *rb, int ns, double age, double ratio)
 {
     int i;
-
+    
     if (!stat) return;
-
-    trace(4, "UpdateLog\n");
-
-    SolStat[PSolE] = stat; Time[PSolE] = time; Nvsat[PSolE] = ns; Age[PSolE] = age;
-    Ratio[PSolE] = ratio;
-    for (i = 0; i < 3; i++) {
-        SolRov[i + PSolE * 3] = rr[i];
-        SolRef[i + PSolE * 3] = rb[i];
-        VelRov[i + PSolE * 3] = rr[i + 3];
+    
+    trace(4,"UpdateLog\n");
+    
+    SolStat[PSolE]=stat; Time[PSolE]=time; Nvsat[PSolE]=ns; Age[PSolE]=age;
+    Ratio[PSolE]=ratio;
+    for (i=0;i<3;i++) {
+        SolRov[i+PSolE*3]=rr[i];
+        SolRef[i+PSolE*3]=rb[i];
+        VelRov[i+PSolE*3]=rr[i+3];
     }
-    Qr[PSolE * 9] = qr[0];
-    Qr[4 + PSolE * 9] = qr[1];
-    Qr[8 + PSolE * 9] = qr[2];
-    Qr[1 + PSolE * 9] = Qr[3 + PSolE * 9] = qr[3];
-    Qr[5 + PSolE * 9] = Qr[7 + PSolE * 9] = qr[4];
-    Qr[2 + PSolE * 9] = Qr[6 + PSolE * 9] = qr[5];
-
-    PSol = PSolE;
-    if (++PSolE >= SolBuffSize) PSolE = 0;
-    if (PSolE == PSolS && ++PSolS >= SolBuffSize) PSolS = 0;
+    Qr[  PSolE*9]=qr[0];
+    Qr[4+PSolE*9]=qr[1];
+    Qr[8+PSolE*9]=qr[2];
+    Qr[1+PSolE*9]=Qr[3+PSolE*9]=qr[3];
+    Qr[5+PSolE*9]=Qr[7+PSolE*9]=qr[4];
+    Qr[2+PSolE*9]=Qr[6+PSolE*9]=qr[5];
+    
+    PSol=PSolE;
+    if (++PSolE>=SolBuffSize) PSolE=0;
+    if (PSolE==PSolS&&++PSolS>=SolBuffSize) PSolS=0;
 }
 // update font --------------------------------------------------------------
-void MainWindow::UpdateFont(void)
+void  MainWindow::UpdateFont(void)
 {
-    QLabel *label[] = {
-        PlabelA, Plabel1, Plabel2, Plabel3, Pos1, Pos2, Pos3, Solution, LabelStd, LabelNSat
+    QLabel *label[]={
+        PlabelA,Plabel1,Plabel2,Plabel3,Pos1,Pos2,Pos3,Solution,LabelStd,LabelNSat
     };
-    QString color = label[7]->styleSheet();
+    QString color=label[7]->styleSheet();
     int i;
-
-    trace(4, "UpdateFont\n");
-
-    for (i = 0; i < 10; i++) label[i]->setFont(PosFont);
-    QFont tmp = PosFont;
+    
+    trace(4,"UpdateFont\n");
+    
+    for (i=0;i<10;i++) label[i]->setFont(PosFont);
+    QFont tmp=PosFont;
     tmp.setPointSize(9);
     label[0]->setFont(tmp); label[7]->setStyleSheet(color);
     tmp.setPointSize(8);
@@ -1441,143 +1295,151 @@
     label[9]->setFont(tmp); label[9]->setStyleSheet("QLabel {color: gray;}");
 }
 // update time --------------------------------------------------------------
-void MainWindow::UpdateTime(void)
+void  MainWindow::UpdateTime(void)
 {
-    gtime_t time = Time[PSol];
+    gtime_t time=Time[PSol];
     struct tm *t;
     double tow;
     int week;
     char tstr[64];
     QString str;
-
-    trace(4, "UpdateTime\n");
-
-    if (TimeSys == 0) {
-        time2str(time, tstr, 1);
-    } else if (TimeSys == 1) {
-        time2str(gpst2utc(time), tstr, 1);
-    } else if (TimeSys == 2) {
-        time = gpst2utc(time);
-        if (!(t = localtime(&time.time))) str = "2000/01/01 00:00:00.0";
-        else str = QString("%1/%2/%3 %4:%5:%6.%7").arg(t->tm_year + 1900, 4, 10, QChar('0'))
-               .arg(t->tm_mon + 1, 2, 10, QChar('0')).arg(t->tm_mday, 2, 10, QChar('0')).arg(t->tm_hour, 2, 10, QChar('0')).arg(t->tm_min, 2, 10, QChar('0'))
-               .arg(t->tm_sec, 2, 10, QChar('0')).arg(static_cast<int>(time.sec * 10));
-    } else if (TimeSys == 3) {
-        tow = time2gpst(time, &week);
-        str = QString("week %1 %2 s").arg(week, 4, 10, QChar('0')).arg(tow, 8, 'f', 1);
+    
+    trace(4,"UpdateTime\n");
+    
+    if      (TimeSys==0) time2str(time,tstr,1);
+    else if (TimeSys==1) time2str(gpst2utc(time),tstr,1);
+    else if (TimeSys==2) {
+        time=gpst2utc(time);
+        if (!(t=localtime(&time.time))) str="2000/01/01 00:00:00.0";
+        else str=QString("%1/%2/%3 %4:%5:%6.%7").arg(t->tm_year+1900,4,10,QChar('0'))
+                     .arg(t->tm_mon+1,2,10,QChar('0')).arg(t->tm_mday,2,10,QChar('0')).arg(t->tm_hour,2,10,QChar('0')).arg(t->tm_min,2,10,QChar('0'))
+                     .arg(t->tm_sec,2,10,QChar('0')).arg(static_cast<int>(time.sec*10));
+    }
+    else if (TimeSys==3) {
+        tow=time2gpst(time,&week);
+        str=QString("week %1 %2 s").arg(week,4,10,QChar('0')).arg(tow,8,'f',1);
     }
     LabelTime->setText(str);
 }
 // update solution display --------------------------------------------------
-void MainWindow::UpdatePos(void)
+void  MainWindow::UpdatePos(void)
 {
-    QLabel *label[] = { Plabel1, Plabel2, Plabel3, Pos1, Pos2, Pos3, LabelStd, LabelNSat };
-    QString sol[] = { tr("----"), tr("FIX"), tr("FLOAT"), tr("SBAS"), tr("DGPS"), tr("SINGLE"), tr("PPP") };
-    QString s[9], ext = "";
-    QString color[] = { "silver", "green", "rgb(0,170,255)", "rgb(255,0,255)", "blue", "red", "rgb(128,0,128)" };
-    double *rr = SolRov + PSol * 3, *rb = SolRef + PSol * 3, *qr = Qr + PSol * 9, pos[3] = { 0 }, Qe[9] = { 0 };
-    double dms1[3] = { 0 }, dms2[3] = { 0 }, bl[3] = { 0 }, enu[3] = { 0 }, pitch = 0.0, yaw = 0.0, len;
-    int i, stat = SolStat[PSol];
-
-    trace(4, "UpdatePos\n");
+    QLabel *label[]={Plabel1,Plabel2,Plabel3,Pos1,Pos2,Pos3,LabelStd,LabelNSat};
+    QString sol[]={tr("----"),tr("FIX"),tr("FLOAT"),tr("SBAS"),tr("DGPS"),tr("SINGLE"),tr("PPP")};
+    QString s[9],ext="";
+    QString color[]={"silver","green","rgb(0,170,255)","rgb(255,0,255)","blue","red","rgb(128,0,128)"};
+    double *rr=SolRov+PSol*3,*rb=SolRef+PSol*3,*qr=Qr+PSol*9,pos[3]={0},Qe[9]={0};
+    double dms1[3]={0},dms2[3]={0},bl[3]={0},enu[3]={0},pitch=0.0,yaw=0.0,len;
+    int i,stat=SolStat[PSol];
+    
+    trace(4,"UpdatePos\n");
 
-    if (rtksvr.rtk.opt.mode == PMODE_STATIC || rtksvr.rtk.opt.mode == PMODE_PPP_STATIC)
-        ext = " (S)";
-    else if (rtksvr.rtk.opt.mode == PMODE_FIXED || rtksvr.rtk.opt.mode == PMODE_PPP_FIXED)
-        ext = " (F)";
-    PlabelA->setText(tr("Solution %1:").arg(ext));
+    if (rtksvr.rtk.opt.mode==PMODE_STATIC||rtksvr.rtk.opt.mode==PMODE_PPP_STATIC) {
+        ext=" (S)";
+    }
+    else if (rtksvr.rtk.opt.mode==PMODE_FIXED||rtksvr.rtk.opt.mode==PMODE_PPP_FIXED) {
+        ext=" (F)";
+    }
+    PlabelA->setText("Solution"+ext+":");
 
     Solution->setText(sol[stat]);
-    Solution->setStyleSheet(QString("QLabel {color: %1;}").arg(rtksvr.state ? color[stat] : "gray"));
-    IndSol->setStyleSheet(QString("QLabel {color: %1; background-color: %1}").arg(rtksvr.state && stat ? color[stat] : "white"));
-    if (norm(rr, 3) > 0.0 && norm(rb, 3) > 0.0)
-        for (i = 0; i < 3; i++) bl[i] = rr[i] - rb[i];
-    len = norm(bl, 3);
-    if (SolType == 0) {
-        if (norm(rr, 3) > 0.0) {
-            ecef2pos(rr, pos); covenu(pos, qr, Qe);
-            degtodms(pos[0] * R2D, dms1);
-            degtodms(pos[1] * R2D, dms2);
-            if (SolOpt.height == 1) pos[2] -= geoidh(pos); /* geodetic */
+    Solution->setStyleSheet(QString("QLabel {color: %1;}").arg(rtksvr.state?color[stat]:"gray"));
+    IndSol->setStyleSheet(QString("QLabel {color: %1; background-color: %1}").arg(rtksvr.state&&stat?color[stat]:"white"));
+    if (norm(rr,3)>0.0&&norm(rb,3)>0.0) {
+        for (i=0;i<3;i++) bl[i]=rr[i]-rb[i];
+    }
+    len=norm(bl,3);
+    if (SolType==0) {
+        if (norm(rr,3)>0.0) {
+            ecef2pos(rr,pos); covenu(pos,qr,Qe);
+            degtodms(pos[0]*R2D,dms1);
+            degtodms(pos[1]*R2D,dms2);
+            if (SolOpt.height==1) pos[2]-=geoidh(pos); /* geodetic */
         }
-        s[0] = pos[0] < 0 ? tr("S:") : tr("N:"); s[1] = pos[1] < 0 ? tr("W:") : tr("E:");
-        s[2] = SolOpt.height == 1 ? "H:" : "He:";
-        s[3] = QString("%1%2 %3' %4\"").arg(fabs(dms1[0]), 0, 'f', 0).arg(degreeChar).arg(dms1[1], 2, 'f', 0, '0').arg(dms1[2], 7, 'f', 4, '0');
-        s[4] = QString("%1%2 %3' %4\"").arg(fabs(dms2[0]), 0, 'f', 0).arg(degreeChar).arg(dms2[1], 2, 'f', 0, '0').arg(dms2[2], 7, 'f', 4, '0');
-        s[5] = QString("%1 m").arg(pos[2], 0, 'f', 3);
-        s[6] = QString(tr("N:%1 E:%2 U:%3 m")).arg(SQRT(Qe[4]), 6, 'f', 3).arg(SQRT(Qe[0]), 6, 'f', 3).arg(SQRT(Qe[8]), 6, 'f', 3);
-    } else if (SolType == 1) {
-        if (norm(rr, 3) > 0.0) {
-            ecef2pos(rr, pos); covenu(pos, qr, Qe);
-            if (SolOpt.height == 1) pos[2] -= geoidh(pos); /* geodetic */
+        s[0]=pos[0]<0?tr("S:"):tr("N:"); s[1]=pos[1]<0?tr("W:"):tr("E:");
+        s[2]=SolOpt.height==1?"H:":"He:";
+        s[3]=QString("%1%2 %3' %4\"").arg(fabs(dms1[0]),0,'f',0).arg(degreeChar).arg(dms1[1],2,'f',0,'0').arg(dms1[2],7,'f',4,'0');
+        s[4]=QString("%1%2 %3' %4\"").arg(fabs(dms2[0]),0,'f',0).arg(degreeChar).arg(dms2[1],2,'f',0,'0').arg(dms2[2],7,'f',4,'0');
+        s[5]=QString("%1 m").arg(pos[2],0,'f',3);
+        s[6]=QString(tr("N:%1 E:%2 U:%3 m")).arg(SQRT(Qe[4]),6,'f',3).arg(SQRT(Qe[0]),6,'f',3).arg(SQRT(Qe[8]),6,'f',3);
+    }
+    else if (SolType==1) {
+        if (norm(rr,3)>0.0) {
+            ecef2pos(rr,pos); covenu(pos,qr,Qe);
+            if (SolOpt.height==1) pos[2]-=geoidh(pos); /* geodetic */
         }
-        s[0] = pos[0] < 0 ? "S:" : "N:"; s[1] = pos[1] < 0 ? "W:" : "E:";
-        s[2] = SolOpt.height == 1 ? "H:" : "He:";
-        s[3] = QString("%1 %2").arg(fabs(pos[0]) * R2D, 0, 'f', 8).arg(degreeChar);
-        s[4] = QString("%1 %2").arg(fabs(pos[1]) * R2D, 0, 'f', 8).arg(degreeChar);
-        s[5] = QString("%1").arg(pos[2], 0, 'f', 3);
-        s[6] = QString(tr("N:%1 E:%2 U:%3 m")).arg(SQRT(Qe[4]), 6, 'f', 3).arg(SQRT(Qe[0]), 6, 'f', 3).arg(SQRT(Qe[8]), 6, 'f', 3);
-    } else if (SolType == 2) {
-        s[0] = "X:"; s[1] = "Y:"; s[2] = "Z:";
-        s[3] = QString("%1 m").arg(rr[0], 0, 'f', 3);
-        s[4] = QString("%1 m").arg(rr[1], 0, 'f', 3);
-        s[5] = QString("%1 m").arg(rr[2], 0, 'f', 3);
-        s[6] = QString("X:%1 Y:%2 Z:%3 m").arg(SQRT(qr[0]), 6, 'f', 3).arg(SQRT(qr[4]), 6, 'f', 3).arg(SQRT(qr[8]), 6, 'f', 3);
-    } else if (SolType == 3) {
-        if (len > 0.0) {
-            ecef2pos(rb, pos); ecef2enu(pos, bl, enu); covenu(pos, qr, Qe);
+        s[0]=pos[0]<0?"S:":"N:"; s[1]=pos[1]<0?"W:":"E:";
+        s[2]=SolOpt.height==1?"H:":"He:";
+        s[3]=QString("%1 %2").arg(fabs(pos[0])*R2D,0,'f',8).arg(degreeChar);
+        s[4]=QString("%1 %2").arg(fabs(pos[1])*R2D,0,'f',8).arg(degreeChar);
+        s[5]=QString("%1").arg(pos[2],0,'f',3);
+        s[6]=QString(tr("N:%1 E:%2 U:%3 m")).arg(SQRT(Qe[4]),6,'f',3).arg(SQRT(Qe[0]),6,'f',3).arg(SQRT(Qe[8]),6,'f',3);
+    }
+    else if (SolType==2) {
+        s[0]="X:"; s[1]="Y:"; s[2]="Z:";
+        s[3]=QString("%1 m").arg(rr[0],0,'f',3);
+        s[4]=QString("%1 m").arg(rr[1],0,'f',3);
+        s[5]=QString("%1 m").arg(rr[2],0,'f',3);
+        s[6]=QString("X:%1 Y:%2 Z:%3 m").arg(SQRT(qr[0]),6,'f',3).arg(SQRT(qr[4]),6,'f',3).arg(SQRT(qr[8]),6,'f',3);
+    }
+    else if (SolType==3) {
+        if (len>0.0) {
+            ecef2pos(rb,pos); ecef2enu(pos,bl,enu); covenu(pos,qr,Qe);
         }
-        s[0] = "E:"; s[1] = "N:"; s[2] = "U:";
-        s[3] = QString("%1 m").arg(enu[0], 0, 'f', 3);
-        s[4] = QString("%1 m").arg(enu[1], 0, 'f', 3);
-        s[5] = QString("%1 m").arg(enu[2], 0, 'f', 3);
-        s[6] = QString(tr("N:%1 E:%2 U:%3 m")).arg(SQRT(Qe[4]), 6, 'f', 3).arg(SQRT(Qe[0]), 6, 'f', 3).arg(SQRT(Qe[8]), 6, 'f', 3);
-    } else {
-        if (len > 0.0) {
-            ecef2pos(rb, pos); ecef2enu(pos, bl, enu); covenu(pos, qr, Qe);
-            pitch = asin(enu[2] / len);
-            yaw = atan2(enu[0], enu[1]); if (yaw < 0.0) yaw += 2.0 * PI;
+        s[0]="E:"; s[1]="N:"; s[2]="U:";
+        s[3]=QString("%1 m").arg(enu[0],0,'f',3);
+        s[4]=QString("%1 m").arg(enu[1],0,'f',3);
+        s[5]=QString("%1 m").arg(enu[2],0,'f',3);
+        s[6]=QString(tr("N:%1 E:%2 U:%3 m")).arg(SQRT(Qe[4]),6,'f',3).arg(SQRT(Qe[0]),6,'f',3).arg(SQRT(Qe[8]),6,'f',3);
+    }
+    else {
+        if (len>0.0) {
+            ecef2pos(rb,pos); ecef2enu(pos,bl,enu); covenu(pos,qr,Qe);
+            pitch=asin(enu[2]/len);
+            yaw=atan2(enu[0],enu[1]); if (yaw<0.0) yaw+=2.0*PI;
         }
-        s[0] = "P:"; s[1] = "Y:"; s[2] = "L:";
-        s[3] = QString("%1 %2").arg(pitch * R2D, 0, 'f', 3).arg(degreeChar);
-        s[4] = QString("%1 %2").arg(yaw * R2D, 0, 'f', 3).arg(degreeChar);
-        s[5] = QString("%1 m").arg(len, 0, 'f', 3);
-        s[6] = QString(tr("N:%1 E:%2 U:%3 m")).arg(SQRT(Qe[4]), 6, 'f', 3).arg(SQRT(Qe[0]), 6, 'f', 3).arg(SQRT(Qe[8]), 6, 'f', 3);
+        s[0]="P:"; s[1]="Y:"; s[2]="L:";
+        s[3]=QString("%1 %2").arg(pitch*R2D,0,'f',3).arg(degreeChar);
+        s[4]=QString("%1 %2").arg(yaw*R2D,0,'f',3).arg(degreeChar);
+        s[5]=QString("%1 m").arg(len,0,'f',3);
+        s[6]=QString(tr("N:%1 E:%2 U:%3 m")).arg(SQRT(Qe[4]),6,'f',3).arg(SQRT(Qe[0]),6,'f',3).arg(SQRT(Qe[8]),6,'f',3);
     }
-    s[7] = QString(tr("Age:%1 s Ratio:%2 #Sat:%3")).arg(Age[PSol], 4, 'f', 1).arg(Ratio[PSol], 4, 'f', 1).arg(Nvsat[PSol], 2);
-    if (Ratio[PSol] > 0.0) s[8] = QString(" R:%1").arg(Ratio[PSol], 4, 'f', 1);
+    s[7]=QString(tr("Age:%1 s Ratio:%2 # Sat:%3")).arg(Age[PSol],4,'f',1).arg(Ratio[PSol],4,'f',1).arg(Nvsat[PSol],2);
+    if (Ratio[PSol]>0.0) s[8]=QString(" R:%1").arg(Ratio[PSol],4,'f',1);
 
-    for (i = 0; i < 8; i++) label[i]->setText(s[i]);
-    for (i = 3; i < 6; i++)
-        label[i]->setStyleSheet(QString("QLabel {color: %1;}").arg(PrcOpt.mode == PMODE_MOVEB && SolType <= 2 ? "grey" : "black"));
+    for (i=0;i<8;i++) label[i]->setText(s[i]);
+    for (i=3;i<6;i++) {
+        label[i]->setStyleSheet(QString("QLabel {color: %1;}").arg(PrcOpt.mode==PMODE_MOVEB&&SolType<=2?"grey":"black"));
+    }
     IndQ->setStyleSheet(IndSol->styleSheet());
     SolS->setText(Solution->text());
     SolS->setStyleSheet(Solution->styleSheet());
-    SolQ->setText(ext + " " + label[0]->text() + " " + label[3]->text() + " " +
-              label[1]->text() + " " + label[4]->text() + " " +
-              label[2]->text() + " " + label[5]->text() + s[8]);
+    SolQ->setText(ext+" "+label[0]->text()+" "+label[3]->text()+" "+
+                  label[1]->text()+" "+label[4]->text()+" "+
+                  label[2]->text()+" "+label[5]->text()+s[8]);
 }
 // update stream status indicators ------------------------------------------
-void MainWindow::UpdateStr(void)
+void  MainWindow::UpdateStr(void)
 {
-    QString color[] = { "red", "gray", "orange", "rgb(0,128,0)", "rgb(0,255,0)" };
-    QLabel *ind[MAXSTRRTK] = { Str1, Str2, Str3, Str4, Str5, Str6, Str7, Str8 };
-    int i, sstat[MAXSTRRTK] = { 0 };
-    char msg[MAXSTRMSG] = "";
-
-    trace(4, "UpdateStr\n");
-
-    rtksvrsstat(&rtksvr, sstat, msg);
-    for (i = 0; i < MAXSTRRTK; i++) {
-        ind[i]->setStyleSheet(QString("QLabel {background-color: %1}").arg(color[sstat[i] + 1]));
-        if (sstat[i])
+    QString color[]={"red","gray","orange","rgb(0,128,0)","rgb(0,255,0)"};
+    QLabel *ind[MAXSTRRTK]={Str1,Str2,Str3,Str4,Str5,Str6,Str7,Str8};
+    int i,sstat[MAXSTRRTK]={0};
+    char msg[MAXSTRMSG]="";
+    
+    trace(4,"UpdateStr\n");
+    
+    rtksvrsstat(&rtksvr,sstat,msg);
+    for (i=0;i<MAXSTRRTK;i++) {
+        ind[i]->setStyleSheet(QString("QLabel {background-color: %1}").arg(color[sstat[i]+1]));
+        if (sstat[i]) {
             Message->setText(msg);
+        }
     }
 }
 // draw solution plot -------------------------------------------------------
-void MainWindow::DrawPlot(QLabel *plot, int no)
+void  MainWindow::DrawPlot(QLabel *plot, int type, int freq)
 {
-    QString s1, s2;
+    QString s1,s2;
     gtime_t time;
 
     if (!plot) return;
@@ -1588,1215 +1450,1179 @@
 
     buffer.fill(Qt::red);
 
-    QPainter *c = new QPainter(&buffer);
+    QPainter *c= new QPainter(&buffer);
     QFont font;
     font.setPixelSize(8);
     c->setFont(font);
 
-    QString fstr[] = { "", "L1 ", "L2 ", "L5 ", "L6 ", "L7 ", "L8 ", "", "", "", "" };
-    int w = buffer.size().width() - 2, h = buffer.height() - 2;
-    int i, j, x, sat[2][MAXSAT], ns[2], snr[2][MAXSAT][NFREQ], vsat[2][MAXSAT];
-    int *snr0[MAXSAT], *snr1[MAXSAT];
+    QString fstr[]={"","L1 ","L2 ","L5 ","L6 ","L7 ","L8 ","","","",""};
+    int w=buffer.size().width()-2,h=buffer.height()-2;
+    int i,j,x,sat[2][MAXSAT],ns[2],snr[2][MAXSAT][NFREQ],vsat[2][MAXSAT];
+    int *snr0[MAXSAT],*snr1[MAXSAT];
     char name[16];
-    double az[2][MAXSAT], el[2][MAXSAT], rr[3], rs[6], e[3], pos[3], azel[2];
-
-    trace(4, "DrawPlot\n");
-
-    fstr[NFREQ + 1] = "SYS ";
-
-    for (i = 0; i < MAXSAT; i++) {
-        snr0[i] = snr[0][i];
-        snr1[i] = snr[1][i];
+    double az[2][MAXSAT],el[2][MAXSAT],rr[3],rs[6],e[3],pos[3],azel[2];
+    
+    trace(4,"DrawPlot\n");
+    
+    fstr[NFREQ+1]="SYS ";
+    
+    for (i=0;i<MAXSAT;i++) {
+        snr0[i]=snr[0][i];
+        snr1[i]=snr[1][i];
     }
-    ns[0] = rtksvrostat(&rtksvr, 0, &time, sat[0], az[0], el[0], snr0, vsat[0]);
-    ns[1] = rtksvrostat(&rtksvr, 1, &time, sat[1], az[1], el[1], snr1, vsat[1]);
-
+    ns[0]=rtksvrostat(&rtksvr,0,&time,sat[0],az[0],el[0],snr0,vsat[0]);
+    ns[1]=rtksvrostat(&rtksvr,1,&time,sat[1],az[1],el[1],snr1,vsat[1]);
+    
     rtksvrlock(&rtksvr);
-    matcpy(rr, rtksvr.rtk.sol.rr, 3, 1);
-    ecef2pos(rr, pos);
+    matcpy(rr,rtksvr.rtk.sol.rr,3,1);
+    ecef2pos(rr,pos);
     rtksvrunlock(&rtksvr);
-
-    for (i = 0; i < 2; i++) {
-        for (j = 0; j < ns[i]; j++) {
-            if (az[i][j] != 0.0 || el[i][j] != 0.0) continue;
-            satno2id(sat[i][j], name);
-            if (!tle_pos(time, name, "", "", &TLEData, NULL, rs)) continue;
-            if (geodist(rs, rr, e) > 0.0) {
-                satazel(pos, e, azel);
-                az[i][j] = azel[0];
-                el[i][j] = azel[1];
+    
+    for (i=0;i<2;i++) {
+        for (j=0;j<ns[i];j++) {
+            if (az[i][j]!=0.0||el[i][j]!=0.0) continue;
+            satno2id(sat[i][j],name);
+            if (!tle_pos(time,name,"","",&TLEData,NULL,rs)) continue;
+            if (geodist(rs,rr,e)>0.0) {
+                satazel(pos,e,azel);
+                az[i][j]=azel[0];
+                el[i][j]=azel[1];
             }
         }
-        if (ns[i] > 0) {
-            Nsat[i] = ns[i];
-            for (int j = 0; j < ns[i]; j++) {
-                Sat [i][j] = sat [i][j];
-                Az  [i][j] = az  [i][j];
-                El  [i][j] = el  [i][j];
-                for (int k = 0; k < NFREQ; k++)
-                    Snr[i][j][k] = snr[i][j][k];
-                Vsat[i][j] = vsat[i][j];
+        if (ns[i]>0) {
+            Nsat[i]=ns[i];
+            for (int j=0;j<ns[i];j++) {
+                Sat [i][j]=sat [i][j];
+                Az  [i][j]=az  [i][j];
+                El  [i][j]=el  [i][j];
+                for (int k=0;k<NFREQ;k++) {
+                    Snr[i][j][k]=snr[i][j][k];
+                }
+                Vsat[i][j]=vsat[i][j];
             }
-        } else {
-            for (j = 0; j < Nsat[i]; j++) {
-                Vsat[i][j] = 0;
-                for (int k = 0; k < NFREQ; k++)
-                    Snr[i][j][k] = 0;
+        }
+        else {
+            for (j=0;j<Nsat[i];j++) {
+                Vsat[i][j]=0;
+                for (int k=0;k<NFREQ;k++) {
+                    Snr[i][j][k]=0;
+                }
             }
         }
     }
     c->setBrush(Qt::white);
-    c->fillRect(buffer.rect(), QBrush(Qt::white));
-    x = 4;
-    if (PlotType[no] == 0) {                // snr plot rover+base
-        if (w <= 3 * h) {       // vertical
-            DrawSnr(c, w, (h - 12) / 2, 0, 15, 0, FreqType[no]);
-            DrawSnr(c, w, (h - 12) / 2, 0, 14 + (h - 12) / 2, 1, FreqType[no]);
-            s1 = QString(tr("Rover:Base %1SNR (dBHz)")).arg(fstr[FreqType[no]]);
-            DrawText(c, x, 1, s1, Qt::gray, 0);
-        } else { // horizontal
-            DrawSnr(c, w / 2, h - 15, 0, 15, 0, FreqType[no]);
-            DrawSnr(c, w / 2, h - 15, w / 2, 15, 1, FreqType[no]);
-            s1 = QString(tr("Rover %1 SNR (dBHz)")).arg(fstr[FreqType[no]]);
-            s2 = QString(tr("Base %1 SNR (dBHz)")).arg(fstr[FreqType[no]]);
-            DrawText(c, x, 1, s1, Qt::gray, 0);
-            DrawText(c, w / 2 + x, 1, s2, Qt::gray, 0);
+    c->fillRect(buffer.rect(),QBrush(Qt::white));
+    x=4;
+    if (type==0) { // snr plot rover+base
+         if (w<=3*h) { // vertical
+             DrawSnr(c,w,(h-12)/2,0,15,0,freq);
+             DrawSnr(c,w,(h-12)/2,0,14+(h-12)/2,1,freq);
+             s1=QString("Rover:Base %1SNR (dBHz)").arg(fstr[freq]);
+             DrawText(c,x,1,s1,Qt::gray,0);
+         }
+         else { // horizontal
+             DrawSnr(c,w/2,h-15,0  ,15,0,freq);
+             DrawSnr(c,w/2,h-15,w/2,15,1,freq);
+             s1=QString("Rover %1 SNR (dBHz)").arg(fstr[freq]);
+             s2=QString("Base %1 SNR (dBHz)").arg(fstr[freq]);
+             DrawText(c,x,1,s1,Qt::gray,0);
+             DrawText(c,w/2+x,1,s2,Qt::gray,0);
         }
-    } else if (PlotType[no] == 1) { // snr plot rover
-        DrawSnr(c, w, h - 15, 0, 15, 0, FreqType[no]);
-        s1 = QString(tr("Rover %1 SNR (dBHz)")).arg(fstr[FreqType[no]]);
-        DrawText(c, x, 1, s1, Qt::gray, 0);
-    } else if (PlotType[no] == 2) { // skyplot rover
-        DrawSat(c, w, h, 0, 0, 0, FreqType[no]);
-        s1 = QString(tr("Rover %1")).arg(fstr[FreqType[no]]);
-        DrawText(c, x, 1, s1, Qt::gray, 0);
-    } else if (PlotType[no] == 3) { // skyplot+snr plot rover
-        s1 = QString(tr("Rover %1")).arg(fstr[FreqType[no]]);
-        s2 = QString(tr("SNR (dBHz)"));
-        if (w >= h * 2) { // horizontal
-            DrawSat(c, h, h, 0, 0, 0, FreqType[no]);
-            DrawSnr(c, w - h, h - 15, h, 15, 0, FreqType[no]);
-            DrawText(c, x, 1, s1, Qt::gray, 0);
-            DrawText(c, x + h, 1, s2, Qt::gray, 0);
-        } else { // vertical
-            DrawSat(c, w, h / 2, 0, 0, 0, FreqType[no]);
-            DrawSnr(c, w, (h - 12) / 2, 0, 14 + (h - 12) / 2, 0, FreqType[no]);
-            DrawText(c, x, 1, s1, Qt::gray, 0);
+    }
+    else if (type==1) { // snr plot rover
+        DrawSnr(c,w,h-15,0,15,0,freq);
+        s1=QString(tr("Rover %1 SNR (dBHz)")).arg(fstr[freq]);
+        DrawText(c,x,1,s1,Qt::gray,0);
+    }
+    else if (type==2) { // skyplot rover
+        DrawSat(c,w,h,0,0,0,freq);
+        s1=QString("Rover %1").arg(fstr[!freq?1:freq]);
+        DrawText(c,x,1,s1,Qt::gray,0);
+    }
+    else if (type==3) { // skyplot+snr plot rover
+        s1=QString("Rover %1").arg(fstr[!freq?1:freq]);
+        s2=QString("SNR (dBHz)");
+        if (w>=h*2) { // horizontal
+            DrawSat(c,h,h,0,0,0,freq);
+            DrawSnr(c,w-h,h-15,h,15,0,freq);
+            DrawText(c,x,1,s1,Qt::gray,0);
+            DrawText(c,x+h,1,s2,Qt::gray,0);
         }
-    } else if (PlotType[no] == 4) { // skyplot rover+base
-        s1 = QString(tr("Rover %1")).arg(fstr[FreqType[no]]);
-        s2 = QString(tr("Base %1")).arg(fstr[FreqType[no]]);
-        if (w >= h) { // horizontal
-            DrawSat(c, w / 2, h, 0, 0, 0, FreqType[no]);
-            DrawSat(c, w / 2, h, w / 2, 0, 1, FreqType[no]);
-            DrawText(c, x, 1, s1, Qt::gray, 0);
-            DrawText(c, x + w / 2, 1, s2, Qt::gray, 0);
-        } else { // vertical
-            DrawSat(c, w, h / 2, 0, 0, 0, FreqType[no]);
-            DrawSat(c, w, h / 2, 0, h / 2, 1, FreqType[no]);
-            DrawText(c, x, 1, s1, Qt::gray, 0);
-            DrawText(c, x, h / 2 + 1, s2, Qt::gray, 0);
+        else { // vertical
+            DrawSat(c,w,h/2,0,0,0,freq);
+            DrawSnr(c,w,(h-12)/2,0,14+(h-12)/2,0,freq);
+            DrawText(c,x,1,s1,Qt::gray,0);
         }
-    } else if (PlotType[no] == 5) { // baseline plot
-        DrawBL(c, no, w, h);
-        DrawText(c, x, 1, tr("Baseline"), Qt::gray, 0);
-    } else if (PlotType[no] == 6) { // track plot
-        DrawTrk(c, no, buffer);
-        DrawText(c, x, 3, tr("Gnd Trk"), Qt::gray, 0);
+    }
+    else if (type==4) { // skyplot rover+base
+        s1=QString("Rover %1").arg(fstr[!freq?1:freq]);
+        s2=QString("Base %1").arg(fstr[!freq?1:freq]);
+        if (w>=h) { // horizontal
+            DrawSat(c,w/2,h,0  ,0,0,freq);
+            DrawSat(c,w/2,h,w/2,0,1,freq);
+            DrawText(c,x,1,s1,Qt::gray,0);
+            DrawText(c,x+w/2,1,s2,Qt::gray,0);
+        }
+        else { // vertical
+            DrawSat(c,w,h/2,0,0  ,0,freq);
+            DrawSat(c,w,h/2,0,h/2,1,freq);
+            DrawText(c,x,1,s1,Qt::gray,0);
+            DrawText(c,x,h/2+1,s2,Qt::gray,0);
+        }
+    }
+    else if (type==5) { // baseline plot
+        DrawBL(c,plot,w,h);
+        DrawText(c,x,1,"Baseline",Qt::gray,0);
+    } else if (type==6) { // track plot
+        DrawTrk(c,plot,buffer);
+        DrawText(c,x,3,"Gnd Trk",Qt::gray,0);
     }
     plot->setPixmap(buffer);
     delete c;
 }
 // update solution plot ------------------------------------------------------
-void MainWindow::UpdatePlot(void)
+void  MainWindow::UpdatePlot(void)
 {
-    DrawPlot(Disp1, 0);
-    DrawPlot(Disp2, 1);
-
-    if (Panel22->isVisible()) {
-        DrawPlot(Disp1,0);
-    }
-    if (Panel23->isVisible()) {
-        DrawPlot(Disp2,1);
-    }
-    if (Panel24->isVisible()) {
-        DrawPlot(Disp3,2);
-    }
-    if (Panel25->isVisible()) {
-        DrawPlot(Disp4,3);
-    }
+    DrawPlot(Disp1,PlotType1,FreqType1);
+    DrawPlot(Disp2,PlotType2,FreqType2);
 }
 // snr color ----------------------------------------------------------------
-QColor MainWindow::SnrColor(int snr)
+QColor  MainWindow::SnrColor(int snr)
 {
-    QColor color[] = { Qt::green, QColor(255, 128, 0, 255), QColor(0, 255, 128, 255), Qt::blue, Qt::red, Qt::gray };
-    unsigned int r1, g1, b1;
-    QColor c1, c2;
+    QColor color[]={Qt::green,QColor(255,128,0,255),QColor(0,255,128,255),Qt::blue,Qt::red,Qt::gray};
+    unsigned int r1,g1,b1;
+    QColor c1,c2;
     double a;
     int i;
-
-    if (snr < 25) return color[5];
-    if (snr < 27) return color[4];
-    if (snr > 47) return color[0];
-    a = (snr - 27.5) / 5.0;
-    i = static_cast<int>(a);
-    a -= i;
-    c1 = color[3 - i];
-    c2 = color[4 - i];
-    r1 = static_cast<unsigned int>(a * c1.red() + (1.0 - a) * c2.red()) & 0xFF;
-    g1 = static_cast<unsigned int>(a * c1.green() + (1.0 - a) * c2.green()) & 0xFF;
-    b1 = static_cast<unsigned int>(a * c1.blue() + (1.0 - a) * c2.blue()) & 0xFF;
-
-    return QColor(r1, g1, b1);
+    
+    if (snr<25) return color[5];
+    if (snr<27) return color[4];
+    if (snr>47) return color[0];
+    a=(snr-27.5)/5.0;
+    i=static_cast<int>(a);
+    a-=i;
+    c1=color[3-i];
+    c2=color[4-i];
+    r1=static_cast<unsigned int>(a*c1.red()  +(1.0-a)*c2.red())&0xFF;
+    g1=static_cast<unsigned int>(a*c1.green()+(1.0-a)*c2.green())&0xFF;
+    b1=static_cast<unsigned int>(a*c1.blue() +(1.0-a)*c2.blue())&0xFF;
+    
+    return QColor(r1,g1,b1);
 }
 // draw snr plot ------------------------------------------------------------
-void MainWindow::DrawSnr(QPainter *c, int w, int h, int x0, int y0,
-             int index, int freq)
+void  MainWindow::DrawSnr(QPainter *c, int w, int h, int x0, int y0,
+	int index, int freq)
 {
-    static const QColor color[] = {
-        QColor(0,   128, 0), QColor(0, 128, 128), QColor(0xA0, 0,   0xA0),
-        QColor(128, 0,	 0), QColor(0, 0,   128), QColor(128,  128, 128)
+    static const QColor color[]={
+        QColor(0,128,0),QColor(0,128,128),QColor(0xA0,0,0xA0),
+        QColor(128,0,0),QColor(0,0,128),QColor(128,128,128)
     };
-    static const QColor color_sys[] = {
-        Qt::green, QColor(0, 0xAA, 0xFF), QColor(255, 0, 255), Qt::blue, Qt::red, Qt::gray
+    static const QColor color_sys[]={
+        Qt::green,QColor(0,0xAA,0xFF),QColor(255,0,255),Qt::blue,Qt::red,Qt::gray
     };
     QString s;
-    int i, j, k, l, n, x1, y1, y2, y3, hh = h - 15, ww, www, snr[NFREQ + 1], mask[6] = { 0 };
-    char id[16], sys[] = "GREJCS", *q;
-
-    trace(4, "DrawSnr: w=%d h=%d x0=%d y0=%d index=%d freq=%d\n", w, h, x0, y0, index, freq);
-    for (snr[0] = MINSNR + 10; snr[0] < MAXSNR; snr[0] += 10) {
-        y1 = y0 + hh - (snr[0] - MINSNR) * hh / (MAXSNR - MINSNR);
-        c->setPen(QColor(0x0c, 0x0c, 0x0c));
-        c->drawLine(x0 + 3, y1, x0 + w - 13, y1);
-        DrawText(c, x0 + w - 9, y1, QString::number(snr[0]), Qt::gray, 1);
+    int i,j,k,l,n,x1,y1,y2,y3,hh=h-15,ww,www,snr[NFREQ+1],mask[6]={0};
+    char id[16],sys[]="GREJCS",*q;
+    
+    trace(4,"DrawSnr: w=%d h=%d x0=%d y0=%d index=%d freq=%d\n",w,h,x0,y0,index,freq);
+    for (snr[0]=MINSNR+10;snr[0]<MAXSNR;snr[0]+=10) {
+        y1=y0+hh-(snr[0]-MINSNR)*hh/(MAXSNR-MINSNR);
+        c->setPen(QColor(0x0c,0x0c,0x0c));
+        c->drawLine(x0+3,y1,x0+w-13,y1);
+        DrawText(c,x0+w-9,y1,QString::number(snr[0]),Qt::gray,1);
     }
 
-    y1 = y0 + hh;
-    QRect b(x0 + 1, y0, x0 + w - 2, y1);
+    y1=y0+hh;
+    QRect b(x0+1,y0,x0+w-2,y1);
     c->setBrush(Qt::NoBrush);
     c->setPen(Qt::gray);
 
     c->drawRect(b);
-
-    for (i = 0; i < Nsat[index] && i < MAXSAT; i++) {
-        ww = (w - 16) / Nsat[index];
-        www = ww - 2 < 8 ? ww - 2 : 8;
-        x1 = x0 + i * (w - 16) / Nsat[index] + ww / 2;
-        satno2id(Sat[index][i], id);
-        l = (q = strchr(sys, id[0])) ? (int)(q - sys) : 5;
-
-        for (j = snr[0] = 0; j < NFREQ; j++) {
-            snr[j + 1] = Snr[index][i][j];
-            if ((freq && freq == j + 1) || ((!freq || freq > NFREQ) && snr[j + 1] > snr[0]))
-                snr[0] = snr[j + 1];
+    
+    for (i=0;i<Nsat[index]&&i<MAXSAT;i++) {
+        
+        ww=(w-16)/Nsat[index];
+        www=ww-2<8?ww-2:8;
+        x1=x0+i*(w-16)/Nsat[index]+ww/2;
+        satno2id(Sat[index][i],id);
+        l=(q=strchr(sys,id[0]))?(int)(q-sys):5;
+        
+        for (j=snr[0]=0;j<NFREQ;j++) {
+            snr[j+1]=Snr[index][i][j];
+            if ((freq&&freq==j+1)||((!freq||freq>NFREQ)&&snr[j+1]>snr[0])) {
+                snr[0]=snr[j+1];
+            }
         }
-        for (j = 0; j < NFREQ + 2; j++) {
-            k = j < NFREQ + 1 ? j : 0;
-            y3 = j < NFREQ + 1 ? 0 : 2;
-            y2 = y1 - y3;
-            if (snr[k] > 0) y2 -= (snr[k] - MINSNR) * hh / (MAXSNR - MINSNR) - y3;
-            y2 = y2 < 2 ? 2 : (y1 < y2 ? y1 : y2);
-
-            QRect r1(x1, y1, www, y2 - y1);
-            if (j == 0) {
-                c->setBrush(QBrush(freq < NFREQ + 1 ? SnrColor(snr[k]) : color_sys[l], Qt::SolidPattern));
-                if (!Vsat[index][i]) c->setBrush(QBrush(QColor(0x0c, 0x0c, 0x0c), Qt::SolidPattern));
+        for (j=0;j<NFREQ+2;j++) {
+            k=j<NFREQ+1?j:0;
+            y3=j<NFREQ+1?0:2;
+            y2=y1-y3;
+            if (snr[k]>0) y2-=(snr[k]-MINSNR)*hh/(MAXSNR-MINSNR)-y3;
+            y2=y2<2?2:(y1<y2?y1:y2);
+            
+            QRect r1(x1,y1,www,y2-y1);
+            if (j==0) {
+                c->setBrush(QBrush(freq<NFREQ?SnrColor(snr[k]):color_sys[l],Qt::SolidPattern));
+                if (!Vsat[index][i]) c->setBrush(QBrush(QColor(0x0c,0x0c,0x0c),Qt::SolidPattern));
                 c->drawRect(r1);
-            } else {
-                c->setPen(j < NFREQ + 1 ? QColor(0x0c, 0x0c, 0x0c) : Qt::gray);
+            }
+            else {
+                c->setPen(j<NFREQ+1?QColor(0x0c,0x0c,0x0c):Qt::gray);
                 c->setBrush(Qt::NoBrush);
                 c->drawRect(r1);
             }
         }
-        DrawText(c, x1 + www / 2, y1 + 6, (s = id + 1), color[l], 1);
-        mask[l] = 1;
+        DrawText(c,x1+www/2,y1+6,(s=id+1),color[l],1);
+        mask[l]=1;
     }
-    for (i = n = 0; i < 6; i++) if (mask[i]) n++;
-    for (i = j = 0; i < 6; i++) {
+    for (i=n=0;i<6;i++) if (mask[i]) n++;
+    for (i=j=0;i<6;i++) {
         if (!mask[i]) continue;
-        sprintf(id, "%c", sys[i]);
-        DrawText(c, x0 + w - 15 + 8 * (-n + j++), y0 + 3, (s = id), color[i], 0);
+        sprintf(id,"%c",sys[i]);
+        DrawText(c,x0+w-15+8*(-n+j++),y0+3,(s=id),color[i],0);
     }
 }
 // draw satellites in skyplot -----------------------------------------------
-void MainWindow::DrawSat(QPainter *c, int w, int h, int x0, int y0,
-             int index, int freq)
+void  MainWindow::DrawSat(QPainter *c, int w, int h, int x0, int y0,
+    int index, int freq)
 {
-    static const QColor color_sys[] = {
-        Qt::green, QColor(0x00, 0xAA, 0xFF), QColor(0xff, 0x00, 0xff), Qt::blue, Qt::red, Qt::gray
+    static const QColor color_sys[]={
+        Qt::green,QColor(0x00,0xAA,0xFF),QColor(0xff,0x00,0xff),Qt::blue,Qt::red,Qt::gray
     };
-    QColor color_text;
     QString s;
-    QPoint p(w / 2, h / 2);
-    double r = MIN(w * 0.95, h * 0.95) / 2, azel[MAXSAT * 2], dop[4];
-    int i, j, k, l, d, x[MAXSAT], y[MAXSAT], snr[NFREQ+1], ns = 0;
-    char id[16], sys[] = "GREJCS", *q;
-
-    trace(4, "DrawSat: w=%d h=%d index=%d freq=%d\n", w, h, index, freq);
-
-    DrawSky(c, w, h, x0, y0);
-
-    for (i = 0, k = Nsat[index] - 1; i < Nsat[index] && i < MAXSAT; i++, k--) {
-        if (El[index][k] <= 0.0) continue;
-        for (j = snr[0] = 0; j < NFREQ; j++) {
-            snr[j + 1] = Snr[index][k][j];
-            if ((freq && freq == j + 1) || ((!freq || freq > NFREQ) && snr[j + 1] > snr[0])) {
-                snr[0] = snr[j + 1];
-            }
-        }
+    QPoint p(w/2,h/2);
+    double r=MIN(w*0.95,h*0.95)/2,azel[MAXSAT*2],dop[4];
+    int i,k,l,d,x[MAXSAT],y[MAXSAT],ns=0,f=!freq?0:freq-1;
+    char id[16],sys[]="GREJCS",*q;
+    
+    trace(4,"DrawSat: w=%d h=%d index=%d freq=%d\n",w,h,index,freq);
+    
+    DrawSky(c,w,h,x0,y0);
+    
+    for (i=0,k=Nsat[index]-1;i<Nsat[index]&&i<MAXSAT;i++,k--) {
+        if (El[index][k]<=0.0) continue;
         if (Vsat[index][k]) {
-            azel[ns * 2] = Az[index][k]; azel[1 + ns * 2] = El[index][k];
+            azel[ns*2]=Az[index][k]; azel[1+ns*2]=El[index][k];
             ns++;
         }
-        satno2id(Sat[index][k], id);
-        l = (q = strchr(sys, id[0])) ? (int)(q - sys) : 5;
-        x[i] = static_cast<int>(p.x() + r * (90 - El[index][k] * R2D) / 90 * sin(Az[index][k])) + x0;
-        y[i] = static_cast<int>(p.y() - r * (90 - El[index][k] * R2D) / 90 * cos(Az[index][k])) + y0;
-        c->setPen(Qt::gray);
-        d = SATSIZE / 2;
-
-        c->setBrush(!Vsat[index][k] ? QColor(0xc0, 0xc0, 0xc0) :
-                (freq < NFREQ ? SnrColor(snr[freq]) : color_sys[l]));
+        satno2id(Sat[index][k],id);
+        l=(q=strchr(sys,id[0]))?(int)(q-sys):5;
+        x[i]=static_cast<int>(p.x()+r*(90-El[index][k]*R2D)/90*sin(Az[index][k]))+x0;
+        y[i]=static_cast<int>(p.y()-r*(90-El[index][k]*R2D)/90*cos(Az[index][k]))+y0;
         c->setPen(Qt::gray);
-        color_text=Qt::white;
-        if (freq < NFREQ + 1 && snr[freq] <= 0) {
-            c->setPen(QColor(0xc0, 0xc0, 0xc0));
-            color_text=QColor(0xc0, 0xc0, 0xc0);
-        }
-        c->drawEllipse(x[i] - d, y[i] - d, 2 * d + 1, 2 * d + 1);
-        DrawText(c, x[i], y[i], s = id, color_text, 1);
+        d=SATSIZE/2;
+        c->setBrush(!Vsat[index][k]?QColor(0xc0,0xc0,0xc0):
+                        (freq<NFREQ?SnrColor(Snr[index][k][f]):color_sys[l]));
+        c->drawEllipse(x[i]-d,y[i]-d,2*d+1,2*d+1);
+        DrawText(c,x[i],y[i],s=id,Qt::white,1);
     }
-    dops(ns, azel, 0.0, dop);
-    DrawText(c, x0 + 3, y0 + h - 15, QString(tr("# Sat: %1/%2")).arg(ns,2).arg(Nsat[index], 2), Qt::gray, 0);
-    DrawText(c, x0 + w - 3, y0 + h - 15, QString(tr("GDOP: %1")).arg(dop[0], 0, 'f', 1), Qt::gray, 2);
+    dops(ns,azel,0.0,dop);
+    DrawText(c,x0+3,y0+h-15,QString("# Sat:%1").arg(Nsat[index],2),Qt::gray,0);
+    DrawText(c,x0+w-3,y0+h-15,QString("GDOP:%1").arg(dop[0],0,'f',1),Qt::gray,2);
 }
 // draw baseline plot -------------------------------------------------------
-void MainWindow::DrawBL(QPainter *c, int no, int w, int h)
+void  MainWindow::DrawBL(QPainter *c,QLabel *disp, int w, int h)
 {
-    QColor color[] = { QColor(0xc0, 0xc0, 0xc0), Qt::green, QColor(0x00, 0xAA, 0xFF), QColor(0xff, 0x00, 0xff), Qt::blue, Qt::red, QColor(0x80, 0x80, 0x00) };
-    QString label[] = { tr("N"), tr("E"), tr("S"), tr("W") };
-    QPoint p(w / 2, h / 2), p1, p2, pp;
-    double r = MIN(w * 0.95, h * 0.95) / 2;
-    double *rr = SolRov + PSol * 3, *rb = SolRef + PSol * 3;
-    double bl[3] = { 0 }, pos[3], enu[3], len = 0.0, pitch = 0.0, yaw = 0.0;
-    double cp, q, az = 0.0;
-    QColor col = Qt::white;
-    int i, d1 = 10, d2 = 16, d3 = 10, cy = 0, sy = 0, cya = 0, sya = 0, a, x1, x2, y1, y2, r1, digit, mode;
-
-    trace(4, "DrawBL: w=%d h=%d\n", w, h);
-
-    mode = BLMode[no];
-
-    if (PMODE_DGPS <= PrcOpt.mode && PrcOpt.mode <= PMODE_FIXED) {
-        col = rtksvr.state && SolStat[PSol] && SolCurrentStat ? color[SolStat[PSol]] : Qt::white;
+    QColor color[]={QColor(0xc0,0xc0,0xc0),Qt::green,QColor(0x00,0xAA,0xFF),QColor(0xff,0x00,0xff),Qt::blue,Qt::red,QColor(0x80,0x80,0x00)};
+    QString label[]={tr("N"),tr("E"),tr("S"),tr("W")};
+    QPoint p(w/2,h/2),p1,p2,pp;
+    double r=MIN(w*0.95,h*0.95)/2;
+    double *rr=SolRov+PSol*3,*rb=SolRef+PSol*3;
+    double bl[3]={0},pos[3],enu[3],len=0.0,pitch=0.0,yaw=0.0;
+    double cp,q,az=0.0;
+    QColor col=Qt::white;
+    int i,d1=10,d2=16,d3=10,cy=0,sy=0,cya=0,sya=0,a,x1,x2,y1,y2,r1,digit,mode;
+    
+    trace(4,"DrawBL: w=%d h=%d\n",w,h);
+    
+    mode=disp==Disp1?BLMode1:BLMode2;
 
-        if (norm(rr, 3) > 0.0 && norm(rb, 3) > 0.0)
-            for (i = 0; i < 3; i++) bl[i] = rr[i] - rb[i];
-        if ((len = norm(bl, 3)) > 0.0) {
-            ecef2pos(rb, pos); ecef2enu(pos, bl, enu);
-            pitch = asin(enu[2] / len);
-            yaw = atan2(enu[0], enu[1]); if (yaw < 0.0) yaw += 2.0 * PI;
-            if (mode) az = yaw;
+    if (PMODE_DGPS<=PrcOpt.mode&&PrcOpt.mode<=PMODE_FIXED) {
+        col=rtksvr.state&&SolStat[PSol]&&SolCurrentStat?color[SolStat[PSol]]:Qt::white;
+        
+        if (norm(rr,3)>0.0&&norm(rb,3)>0.0) {
+            for (i=0;i<3;i++) bl[i]=rr[i]-rb[i];
+        }
+        if ((len=norm(bl,3))>0.0) {
+            ecef2pos(rb,pos); ecef2enu(pos,bl,enu);
+            pitch=asin(enu[2]/len);
+            yaw=atan2(enu[0],enu[1]); if (yaw<0.0) yaw+=2.0*PI;
+            if (mode) az=yaw;
         }
     }
-    if (len >= MINBLLEN) {
-        cp = cos(pitch);
-        cy = static_cast<int>((r - d1 - d2 / 2) * cp * cos(yaw - az));
-        sy = static_cast<int>((r - d1 - d2 / 2) * cp * sin(yaw - az));
-        cya = static_cast<int>(((r - d1 - d2 / 2) * cp - d2 / 2 - 4) * cos(yaw - az));
-        sya = static_cast<int>(((r - d1 - d2 / 2) * cp - d2 / 2 - 4) * sin(yaw - az));
+    if (len>=MINBLLEN) {
+        cp =cos(pitch);
+        cy =static_cast<int>((r-d1-d2/2)*cp*cos(yaw-az));
+        sy =static_cast<int>((r-d1-d2/2)*cp*sin(yaw-az));
+        cya=static_cast<int>(((r-d1-d2/2)*cp-d2/2-4)*cos(yaw-az));
+        sya=static_cast<int>(((r-d1-d2/2)*cp-d2/2-4)*sin(yaw-az));
     }
-    p1.setX(p.x() - sy); p1.setY(p.y() + cy);       // base
-    p2.setX(p.x() + sy); p2.setY(p.y() - cy);       // rover
-
+    p1.setX(p.x()-sy); p1.setY(p.y()+cy); // base
+    p2.setX(p.x()+sy); p2.setY(p.y()-cy); // rover
+    
     c->setPen(Qt::gray);
-    c->drawEllipse(p.x() - r, p.y() - r, 2 * r + 1, 2 * r + 1);
-    r1 = static_cast<int>(r - d1 / 2);
-    c->drawEllipse(p.x() - r1, p.y() - r1, 2 * r1 + 1, 2 * r1 + 1);
-
-    pp = pitch < 0.0 ? p2 : p1;
-    c->setPen(QColor(0xc0, 0xc0, 0xc0));
-    c->drawLine(p, pp);
-    if (pitch < 0.0) {
+    c->drawEllipse(p.x()-r,p.y()-r,2*r+1,2*r+1);
+    r1=static_cast<int>(r-d1/2);
+    c->drawEllipse(p.x()-r1,p.y()-r1,2*r1+1,2*r1+1);
+    
+    pp=pitch<0.0?p2:p1;
+    c->setPen(QColor(0xc0,0xc0,0xc0));
+    c->drawLine(p,pp);
+    if (pitch<0.0) {
         c->setBrush(Qt::white);
-        c->drawEllipse(pp.x() - d2 / 2, pp.y() - d2 / 2, d2 + 1, d2 + 1);
-        DrawArrow(c, p.x() + sya, p.y() - cya, d3, static_cast<int>((yaw - az) * R2D), QColor(0xc0, 0xc0, 0xc0));
+        c->drawEllipse(pp.x()-d2/2,pp.y()-d2/2,d2+1,d2+1);
+        DrawArrow(c,p.x()+sya,p.y()-cya,d3,static_cast<int>((yaw-az)*R2D),QColor(0xc0,0xc0,0xc0));
     }
     c->setBrush(col);
-    c->drawEllipse(pp.x() - d2 / 2 + 2, pp.y() - d2 / 2 + 2, d2 - 1, d2 - 1);
-    for (a = 0; a < 360; a += 5) {
-        q = a % 90 == 0 ? 0 : (a % 30 == 0 ? r - d1 * 3 : (a % 10 == 0 ? r - d1 * 2 : r - d1));
-        x1 = static_cast<int>(r * sin(a * D2R - az));
-        y1 = static_cast<int>(r * cos(a * D2R - az));
-        x2 = static_cast<int>(q * sin(a * D2R - az));
-        y2 = static_cast<int>(q * cos(a * D2R - az));
-        c->setPen(QColor(0xc0, 0xc0, 0xc0));
-        c->drawLine(p.x() + x1, p.y() - y1, p.x() + x2, p.y() - y2);
+    c->drawEllipse(pp.x()-d2/2+2,pp.y()-d2/2+2,d2-1,d2-1);
+    for (a=0;a<360;a+=5) {
+        q=a%90==0?0:(a%30==0?r-d1*3:(a%10==0?r-d1*2:r-d1));
+        x1=static_cast<int>(r*sin(a*D2R-az));
+        y1=static_cast<int>(r*cos(a*D2R-az));
+        x2=static_cast<int>(q*sin(a*D2R-az));
+        y2=static_cast<int>(q*cos(a*D2R-az));
+        c->setPen(QColor(0xc0,0xc0,0xc0));
+        c->drawLine(p.x()+x1,p.y()-y1,p.x()+x2,p.y()-y2);
         c->setBrush(Qt::white);
-        if (a % 90 == 0)
-            DrawText(c, p.x() + x1, p.y() - y1, label[a / 90], Qt::gray, 1);
-        if (a == 0) {
-            x1 = static_cast<int>((r - d1 * 3 / 2) * sin(a * D2R - az));
-            y1 = static_cast<int>((r - d1 * 3 / 2) * cos(a * D2R - az));
-            DrawArrow(c, p.x() + x1, p.y() - y1, d3, -static_cast<int>(az * R2D), QColor(0xc0, 0xc0, 0xc0));
+        if (a%90==0) {
+            DrawText(c,p.x()+x1,p.y()-y1,label[a/90],Qt::gray,1);
+        }
+        if (a==0) {
+            x1=static_cast<int>((r-d1*3/2)*sin(a*D2R-az));
+            y1=static_cast<int>((r-d1*3/2)*cos(a*D2R-az));
+            DrawArrow(c,p.x()+x1,p.y()-y1,d3,-static_cast<int>(az*R2D),QColor(0xc0,0xc0,0xc0));
         }
     }
-    pp = pitch >= 0.0 ? p2 : p1;
+    pp=pitch>=0.0?p2:p1;
     c->setPen(Qt::gray);
-    c->drawLine(p, pp);
-    if (pitch >= 0.0) {
+    c->drawLine(p,pp);
+    if (pitch>=0.0) {
         c->setBrush(Qt::white);
-        c->drawEllipse(pp.x() - d2 / 2, pp.y() - d2 / 2, d2, d2);
-        DrawArrow(c, p.x() + sya, p.y() - cya, d3, static_cast<int>((yaw - az) * R2D), Qt::gray);
+        c->drawEllipse(pp.x()-d2/2,pp.y()-d2/2,d2,d2);
+        DrawArrow(c,p.x()+sya,p.y()-cya,d3,static_cast<int>((yaw-az)*R2D),Qt::gray);
     }
     c->setBrush(col);
-    c->drawEllipse(pp.x() - d2 / 2 + 2, pp.y() - d2 / 2 + 2, d2 - 4, d2 - 4);
+    c->drawEllipse(pp.x()-d2/2+2,pp.y()-d2/2+2,d2-4,d2-4);
     c->setBrush(Qt::white);
-    digit = len < 1000.0 ? 3 : (len < 10000.0 ? 2 : (len < 100000.0 ? 1 : 0));
-    DrawText(c, p.x(), p.y(), QString("%1 m").arg(len, 0, 'f', digit), Qt::gray, 1);
-    DrawText(c, 5, h - 15, QString("Y: %1%2").arg(yaw * R2D, 0, 'f', 1).arg(degreeChar), Qt::gray, 0);
-    DrawText(c, w - 3, h - 15, QString("P: %1%2").arg(pitch * R2D, 0, 'f', 1).arg(degreeChar), Qt::gray, 2);
+    digit=len<10.0?3:(len<100.0?2:(len<1000.0?1:0));
+    DrawText(c,p.x(),p.y() ,QString("%1 m").arg(len,0,'f',digit),Qt::gray,1);
+    DrawText(c,5,  h-15,QString("Y: %1%2").arg(yaw*R2D,0,'f',1).arg(degreeChar),Qt::gray,0);
+    DrawText(c,w-3,h-15,QString("P: %1%2").arg(pitch*R2D,0,'f',1).arg(degreeChar),Qt::gray,2);
 }
 // draw track plot ----------------------------------------------------------
-void MainWindow::DrawTrk(QPainter *c, int no, QPixmap &buff)
+void MainWindow::DrawTrk(QPainter *c, QLabel *disp, QPixmap &buff)
 {
-    QColor mcolor[] = { QColor(0xc0, 0xc0, 0xc0), Qt::green, QColor(0x00, 0xAA, 0xFF), QColor(0xff, 0x00, 0xff), Qt::blue, Qt::red, QColor(0x80, 0x80, 0x00) };
+    QColor mcolor[]={QColor(0xc0,0xc0,0xc0),Qt::green,QColor(0x00,0xAA,0xFF),QColor(0xff,0x00,0xff),Qt::blue,Qt::red,QColor(0x80,0x80,0x00)};
     Graph *graph = new Graph(&buff);
-
     QVector<QColor> color;
-    QPoint p1, p2;
+    QPoint p1,p2;
     QString label;
-    double scale[] = {
-        0.00021, 0.00047, 0.001, 0.0021, 0.0047, 0.01, 0.021, 0.047, 0.1,   0.21,   0.47,
-        1.0,	 2.1,	  4.7,	 10.0,	 21.0,	 47.0, 100.0, 210.0, 470.0, 1000.0, 2100.0,4700.0,
+    double scale[]={
+        0.00021,0.00047,0.001,0.0021,0.0047,0.01,0.021,0.047,0.1,0.21,0.47,
+        1.0,2.1,4.7,10.0,21.0,47.0,100.0,210.0,470.0,1000.0,2100.0,4700.0,
         10000.0
     };
-    double *x, *y, xt, yt, sx, sy, ref[3], pos[3], dr[3], enu[3];
-    int i, j, k, n = 0, type, scl;
+    double *x,*y,xt,yt,sx,sy,ref[3],pos[3],dr[3],enu[3];
+    int i,j,k,n=0,type,scl;
 
-    trace(3, "DrawTrk\n");
+    trace(3,"DrawTrk\n");
 
-    type = TrkType[no];
-    scl = TrkScale[no];
+    type=disp==Disp1?TrkType1 :TrkType2 ;
+    scl =disp==Disp1?TrkScale1:TrkScale2;
 
-    x = new double[SolBuffSize];
-    y = new double[SolBuffSize];
+    x=new double[SolBuffSize];
+    y=new double[SolBuffSize];
 
-    if (norm(TrkOri, 3) < 1E-6) {
-        if (norm(SolRef + PSol * 3, 3) > 1E-6)
-            matcpy(TrkOri, SolRef + PSol * 3, 3, 1);
-        else
-            matcpy(TrkOri, SolRov + PSol * 3, 3, 1);
+    if (norm(TrkOri,3)<1E-6) {
+        if (norm(SolRef+PSol*3,3)>1E-6) {
+            matcpy(TrkOri,SolRef+PSol*3,3,1);
+        }
+        else {
+            matcpy(TrkOri,SolRov+PSol*3,3,1);
+        }
     }
-    if (norm(SolRef + PSol * 3, 3) > 1E-6)
-        matcpy(ref, SolRef + PSol * 3, 3, 1);
-    else
-        matcpy(ref, TrkOri, 3, 1);
-    ecef2pos(ref, pos);
-    for (i = k = PSolS; i != PSolE; ) {
-        for (j = 0; j < 3; j++) dr[j] = SolRov[j + i * 3] - ref[j];
-        if (i == PSol) k = n;
-        ecef2enu(pos, dr, enu);
-        x[n] = enu[0];
-        y[n] = enu[1];
+    if (norm(SolRef+PSol*3,3)>1E-6) {
+        matcpy(ref,SolRef+PSol*3,3,1);
+    }
+    else {
+        matcpy(ref,TrkOri,3,1);
+    }
+    ecef2pos(ref,pos);
+    for (i=k=PSolS;i!=PSolE;) {
+        for (j=0;j<3;j++) dr[j]=SolRov[j+i*3]-ref[j];
+        if (i==PSol) k=n;
+        ecef2enu(pos,dr,enu);
+        x[n]=enu[0];
+        y[n]=enu[1];
         color.append(mcolor[SolStat[i]]);
         n++;
-        if (++i >= SolBuffSize) i = 0;
+        if (++i>=SolBuffSize) i=0;
     }
-    graph->SetSize(buff.width(), buff.height());
-    graph->SetScale(scale[scl], scale[scl]);
-    graph->Color[1] = QColor(0xc0, 0xc0, 0xc0);
+    graph->SetSize(buff.width(),buff.height());
+    graph->SetScale(scale[scl],scale[scl]);
+    graph->Color[1]=QColor(0xc0,0xc0,0xc0);
 
-    if (n > 0)
-        graph->SetCent(x[k], y[k]);
-    if (type == 1) {
-        graph->XLPos = 7;
-        graph->YLPos = 7;
-        graph->DrawCircles(*c, 0);
-    } else {
-        graph->XLPos = 2;
-        graph->YLPos = 4;
-        graph->DrawAxis(*c, 0, 0);
+    if (n>0) {
+        graph->SetCent(x[k],y[k]);
     }
-    graph->DrawPoly(*c, x, y, n, QColor(0xc0, 0xc0, 0xc0), 0);
-    graph->DrawMarks(*c, x, y, color, n, 0, 3, 0);
-    if (n > 0) {
-        graph->ToPoint(x[k], y[k], p1);
-        graph->DrawMark(*c, p1, 0, Qt::white, 18, 0);
-        graph->DrawMark(*c, p1, 1, rtksvr.state ? Qt::black : Qt::gray, 16, 0);
-        graph->DrawMark(*c, p1, 5, rtksvr.state ? Qt::black : Qt::gray, 20, 0);
-        graph->DrawMark(*c, p1, 0, rtksvr.state ? Qt::black : Qt::gray, 12, 0);
-        graph->DrawMark(*c, p1, 0, rtksvr.state ? color.at(k) : Qt::white, 10, 0);
+    if (type==1) {
+        graph->XLPos=7;
+        graph->YLPos=7;
+        graph->DrawCircles(*c,0);
+    }
+    else {
+        graph->XLPos=2;
+        graph->YLPos=4;
+        graph->DrawAxis(*c,0,0);
+    }
+    graph->DrawPoly(*c,x,y,n,QColor(0xc0,0xc0,0xc0),0);
+    graph->DrawMarks(*c,x,y,color,n,0,3,0);
+    if (n>0) {
+        graph->ToPoint(x[k],y[k],p1);
+        graph->DrawMark(*c,p1,0,Qt::white,18,0);
+        graph->DrawMark(*c,p1,1,Qt::black,16,0);
+        graph->DrawMark(*c,p1,5,Qt::black,20,0);
+        graph->DrawMark(*c,p1,0,Qt::black,12,0);
+        graph->DrawMark(*c,p1,0,color.at(k),10,0);
     }
     // scale
-    graph->GetPos(p1, p2);
-    graph->GetTick(xt, yt);
-    graph->GetScale(sx, sy);
-    p2.rx() = p2.x() - 35;
-    p2.ry() = p2.y() - 12;
-    graph->DrawMark(*c, p2, 11, Qt::gray, static_cast<int>(xt / sx + 0.5), 0);
-    p2.ry() = p2.y() - 2;
-    if (xt < 0.01) label.sprintf("%.0f mm", xt * 1000.0);
-    else if (xt < 1.0) label.sprintf("%.0f cm", xt * 100.0);
-    else if (xt < 1000.0) label.sprintf("%.0f m", xt);
-    else label.sprintf("%.0f km", xt / 1000.0);
-    graph->DrawText(*c, p2, label, Qt::gray, Qt::white, 0, 1, 0);
+    graph->GetPos(p1,p2);
+    graph->GetTick(xt,yt);
+    graph->GetScale(sx,sy);
+    p2.rx()=p2.x()-35;
+    p2.ry()=p2.y()-12;
+    graph->DrawMark(*c,p2,11,Qt::gray,static_cast<int>(xt/sx+0.5),0);
+    p2.ry()=p2.y()-2;
+    if      (xt<0.01  ) label.sprintf("%.0f mm",xt*1000.0);
+    else if (xt<1.0   ) label.sprintf("%.0f cm",xt*100.0);
+    else if (xt<1000.0) label.sprintf("%.0f m" ,xt);
+    else                label.sprintf("%.0f km",xt/1000.0);
+    graph->DrawText(*c,p2,label,Qt::gray,Qt::white,0,1,0);
 
     // ref position
-    if (norm(ref, 3) > 1E-6) {
-        p1.rx() += 2;
-        p1.ry() = p2.y() + 11;
-        label = QString("%1 %2").arg(pos[0] * R2D, 0, 'f').arg(pos[1] * R2D, 0, 'f', 9);
-        graph->DrawText(*c, p1, label, Qt::gray, Qt::white, 1, 1, 0);
+    if (norm(ref,3)>1E-6) {
+        p1.rx()+=2;
+        p1.ry()=p2.y()+12;
+        label=QString("%1 %2").arg(pos[0]*R2D,0,'f').arg(pos[1]*R2D,0,'f',9);
+        graph->DrawText(*c,p1,label,Qt::gray,Qt::white,1,1,0);
     }
     delete graph;
     delete [] x;
     delete [] y;
 }
 // draw skyplot -------------------------------------------------------------
-void MainWindow::DrawSky(QPainter *c, int w, int h, int x0, int y0)
+void  MainWindow::DrawSky(QPainter *c, int w, int h, int x0, int y0)
 {
-    QString label[] = { tr("N"), tr("E"), tr("S"), tr("W") };
-    QPoint p(x0 + w / 2, y0 + h / 2);
-    double r = MIN(w * 0.95, h * 0.95) / 2;
-    int a, e, d, x, y;
-
+    QString label[]={tr("N"),tr("E"),tr("S"),tr("W")};
+    QPoint p(x0+w/2,y0+h/2);
+    double r=MIN(w*0.95,h*0.95)/2;
+    int a,e,d,x,y;
+    
     c->setBrush(Qt::white);
-    for (e = 0; e < 90; e += 30) {
-        d = static_cast<int>(r * (90 - e) / 90);
-        c->setPen(e == 0 ? Qt::gray : QColor(0xc0, 0xc0, 0xc0));
-        c->drawEllipse(p.x() - d, p.y() - d, 2 * d + 1, 2 * d + 1);
+    for (e=0;e<90;e+=30) {
+        d=static_cast<int>(r*(90-e)/90);
+        c->setPen(e==0?Qt::gray:QColor(0xc0,0xc0,0xc0));
+        c->drawEllipse(p.x()-d,p.y()-d,2*d+1,2*d+1);
     }
-    for (a = 0; a < 360; a += 45) {
-        x = static_cast<int>(r * sin(a * D2R));
-        y = static_cast<int>(r * cos(a * D2R));
-        c->setPen(QColor(0xc0, 0xc0, 0xc0));
-        c->drawLine(p.x(), p.y(), p.x() + x, p.y() - y);
-        if (a % 90 == 0) DrawText(c, p.x() + x, p.y() - y, label[a / 90], Qt::gray, 1);
+    for (a=0;a<360;a+=45) {
+        x=static_cast<int>(r*sin(a*D2R));
+        y=static_cast<int>(r*cos(a*D2R));
+        c->setPen(QColor(0xc0,0xc0,0xc0));
+        c->drawLine(p.x(),p.y(),p.x()+x,p.y()-y);
+        if (a%90==0) DrawText(c,p.x()+x,p.y()-y,label[a/90],Qt::gray,1);
     }
 }
 // draw text ----------------------------------------------------------------
-void MainWindow::DrawText(QPainter *c, int x, int y, const QString &s,
-              const QColor &color, int align)
+void  MainWindow::DrawText(QPainter *c, int x, int y, const QString &s,
+    const QColor &color, int align)
 {
-    int flags = 0;
-
+    int flags=0;
     switch (align) {
-    case 0: flags |= Qt::AlignLeft; break;
-    case 1: flags |= Qt::AlignHCenter; break;
-    case 2: flags |= Qt::AlignRight; break;
+    case 0: flags|=Qt::AlignLeft;break;
+    case 1: flags|=Qt::AlignHCenter;break;
+    case 2: flags|=Qt::AlignRight;break;
     }
 
-    QRectF off = c->boundingRect(QRectF(), flags, s);
+    QRectF off=c->boundingRect(QRectF(),flags,s);
 
     c->setPen(color);
 
-    c->translate(x, y);
-    c->drawText(off, s);
-    c->translate(-x, -y);
+    c->translate(x,y);
+    c->drawText(off,s);
+    c->translate(-x,-y);
 }
 // draw arrow ---------------------------------------------------------------
-void MainWindow::DrawArrow(QPainter *c, int x, int y, int siz,
-               int ang, const QColor &color)
+void  MainWindow::DrawArrow(QPainter *c, int x, int y, int siz,
+    int ang, const QColor &color)
 {
-    QPoint p1[4], p2[4];
+    QPoint p1[4],p2[4];
     int i;
-
-    p1[0].setX(0); p1[1].setX(siz / 2); p1[2].setX(-siz / 2); p1[3].setX(0);
-    p1[0].setY(siz / 2); p1[1].setY(-siz / 2); p1[2].setY(-siz / 2); p1[3].setY(siz / 2);
-
-    for (i = 0; i < 4; i++) {
-        p2[i].setX(x + static_cast<int>(p1[i].x() * cos(-ang * D2R) - p1[i].y() * sin(-ang * D2R) + 0.5));
-        p2[i].setY(y - static_cast<int>(p1[i].x() * sin(-ang * D2R) + p1[i].y() * cos(-ang * D2R) + 0.5));
+    
+    p1[0].setX(0); p1[1].setX(siz/2); p1[2].setX(-siz/2); p1[3].setX(0);
+    p1[0].setY(siz/2); p1[1].setY(-siz/2);p1[2].setY(-siz/2); p1[3].setY(siz/2);
+    
+    for (i=0;i<4;i++) {
+        p2[i].setX(x+static_cast<int>(p1[i].x()*cos(-ang*D2R)-p1[i].y()*sin(-ang*D2R)+0.5));
+        p2[i].setY(y-static_cast<int>(p1[i].x()*sin(-ang*D2R)+p1[i].y()*cos(-ang*D2R)+0.5));
     }
-    c->setBrush(QBrush(color, Qt::SolidPattern));
+    c->setBrush(QBrush(color,Qt::SolidPattern));
     c->setPen(color);
-    c->drawPolygon(p2, 3);
+    c->drawPolygon(p2,3);
 }
 // open monitor port --------------------------------------------------------
-void MainWindow::OpenMoniPort(int port)
+void  MainWindow::OpenMoniPort(int port)
 {
     QString s;
     int i;
     char path[64];
-
-    if (port <= 0) return;
-
-    trace(3, "OpenMoniPort: port=%d\n", port);
-
-    for (i = 0; i <= MAXPORTOFF; i++) {
-        sprintf(path, ":%d", port + i);
-
-        if (stropen(&monistr, STR_TCPSVR, STR_MODE_RW, path)) {
-            strsettimeout(&monistr, TimeoutTime, ReconTime);
-            if (i > 0) setWindowTitle(QString(tr("%1 ver.%2 (%3)")).arg(PRGNAME).arg(VER_RTKLIB).arg(i + 1));
-            OpenPort = MoniPort + i;
+    
+    if (port<=0) return;
+    
+    trace(3,"OpenMoniPort: port=%d\n",port);
+    
+    for (i=0;i<=MAXPORTOFF;i++) {
+        
+        sprintf(path,":%d",port+i);
+        
+        if (stropen(&monistr,STR_TCPSVR,STR_MODE_RW,path)) {
+            strsettimeout(&monistr,TimeoutTime,ReconTime);
+            if (i>0) setWindowTitle(QString(tr("%1 ver.%2 (%3)")).arg(PRGNAME).arg(VER_RTKLIB).arg(i+1));
+            OpenPort=MoniPort+i;
             return;
         }
     }
-    QMessageBox::critical(this, tr("Error"), QString(tr("monitor port %1-%2 open error")).arg(port).arg(port + MAXPORTOFF));
-    OpenPort = 0;
+    QMessageBox::critical(this,tr("Error"),QString(tr("monitor port %1-%2 open error")).arg(port).arg(port+MAXPORTOFF));
+    OpenPort=0;
 }
 // initialize solution buffer -----------------------------------------------
-void MainWindow::InitSolBuff(void)
+void  MainWindow::InitSolBuff(void)
 {
-    double ep[] = { 2000, 1, 1, 0, 0, 0 };
-    int i, j;
-
-    trace(3, "InitSolBuff\n");
-
+    double ep[]={2000,1,1,0,0,0};
+    int i,j;
+    
+    trace(3,"InitSolBuff\n");
+    
     delete [] Time;   delete [] SolStat; delete [] Nvsat;  delete [] SolRov;
     delete [] SolRef; delete [] Qr;      delete [] VelRov; delete [] Age;
     delete [] Ratio;
-
-    if (SolBuffSize <= 0) SolBuffSize = 1;
-    Time = new gtime_t[SolBuffSize];
-    SolStat = new int[SolBuffSize];
-    Nvsat = new int[SolBuffSize];
-    SolRov = new double[SolBuffSize * 3];
-    SolRef = new double[SolBuffSize * 3];
-    VelRov = new double[SolBuffSize * 3];
-    Qr = new double[SolBuffSize * 9];
-    Age = new double[SolBuffSize];
-    Ratio = new double[SolBuffSize];
-    PSol = PSolS = PSolE = 0;
-    for (i = 0; i < SolBuffSize; i++) {
-        Time[i] = epoch2time(ep);
-        SolStat[i] = Nvsat[i] = 0;
-        for (j = 0; j < 3; j++) SolRov[j + i * 3] = SolRef[j + i * 3] = VelRov[j + i * 3] = 0.0;
-        for (j = 0; j < 9; j++) Qr[j + i * 9] = 0.0;
-        Age[i] = Ratio[i] = 0.0;
+    
+    if (SolBuffSize<=0) SolBuffSize=1;
+    Time   =new gtime_t[SolBuffSize];
+    SolStat=new int[SolBuffSize];
+    Nvsat  =new int[SolBuffSize];
+    SolRov =new double[SolBuffSize*3];
+    SolRef =new double[SolBuffSize*3];
+    VelRov =new double[SolBuffSize*3];
+    Qr     =new double[SolBuffSize*9];
+    Age    =new double[SolBuffSize];
+    Ratio  =new double[SolBuffSize];
+    PSol=PSolS=PSolE=0;
+    for (i=0;i<SolBuffSize;i++) {
+        Time[i]=epoch2time(ep);
+        SolStat[i]=Nvsat[i]=0;
+        for (j=0;j<3;j++) SolRov[j+i*3]=SolRef[j+i*3]=VelRov[j+i*3]=0.0;
+        for (j=0;j<9;j++) Qr[j+i*9]=0.0;
+        Age[i]=Ratio[i]=0.0;
     }
     ScbSol->setMaximum(0); ScbSol->setValue(0);
 }
 // save log file ------------------------------------------------------------
-void MainWindow::SaveLog(void)
+void  MainWindow::SaveLog(void)
 {
     QString fileName;
-    int posf[] = { SOLF_LLH, SOLF_LLH, SOLF_XYZ, SOLF_ENU, SOLF_ENU, SOLF_LLH };
+    int posf[]={SOLF_LLH,SOLF_LLH,SOLF_XYZ,SOLF_ENU,SOLF_ENU,SOLF_LLH};
     solopt_t opt;
-    sol_t sol = {};
-    double ep[6], pos[3];
+    sol_t sol={0};
+    double  ep[6],pos[3];
     QString fileTemplate;
     int i;
-
-    trace(3, "SaveLog\n");
-
-    time2epoch(timeget(), ep);
-    fileTemplate = QString("rtk_%1%2%3%4%5%6.txt")
-               .arg(ep[0], 4, 'f', 0, QChar('0')).arg(ep[1], 2, 'f', 0, QChar('0')).arg(ep[2], 2, 'f', 0, QChar('0'))
-               .arg(ep[3], 2, 'f', 0, QChar('0')).arg(ep[4], 2, 'f', 0, QChar('0')).arg(ep[5], 2, 'f', 0, QChar('0'));
-    fileName = QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, QString(), fileTemplate));
+    
+    trace(3,"SaveLog\n");
+    
+    time2epoch(timeget(),ep);
+    fileTemplate=QString("rtk_%1%2%3%4%5%6.txt")
+            .arg(ep[0],4,'f',0,QChar('0')).arg(ep[1],2,'f',0,QChar('0')).arg(ep[2],2,'f',0,QChar('0'))
+            .arg(ep[3],2,'f',0,QChar('0')).arg(ep[4],2,'f',0,QChar('0')).arg(ep[5],2,'f',0,QChar('0'));
+    fileName=QDir::toNativeSeparators(QFileDialog::getSaveFileName(this,QString(),fileTemplate));
     QFile file(fileName);
 
     if (!file.open(QIODevice::WriteOnly)) {
-        QMessageBox::critical(this, tr("Error"), tr("log file open error"));
+        QMessageBox::critical(this,tr("Error"),tr("log file open error"));
         return;
     }
     QTextStream str(&file);
 
-    opt = SolOpt;
-    opt.posf = posf[SolType];
+    opt=SolOpt;
+    opt.posf=posf[SolType];
     if (SolOpt.outhead) {
         QString data;
 
-        data = QString(tr("%% program   : %1 ver.%2\n")).arg(PRGNAME).arg(VER_RTKLIB);
-        str << data;
-        if (PrcOpt.mode == PMODE_DGPS || PrcOpt.mode == PMODE_KINEMA ||
-            PrcOpt.mode == PMODE_STATIC) {
-            ecef2pos(PrcOpt.rb, pos);
-            data = QString(tr("%% ref pos   :%1 %2 %3\n")).arg(pos[0] * R2D, 13, 'f', 9)
-                   .arg(pos[1] * R2D, 14, 'f', 9).arg(pos[2], 10, 'f', 4);
-            str << data;
+        data=QString("%% program   : %1 ver.%2\n").arg(PRGNAME).arg(VER_RTKLIB);
+        str<<data;
+        if (PrcOpt.mode==PMODE_DGPS||PrcOpt.mode==PMODE_KINEMA||
+            PrcOpt.mode==PMODE_STATIC) {
+            ecef2pos(PrcOpt.rb,pos);
+            data=QString("%% ref pos   :%1 %2 %3\n").arg(pos[0]*R2D,13,'f',9)
+                    .arg(pos[1]*R2D,14,'f',9).arg(pos[2],10,'f',4);
+            str<<data;
         }
         file.write("%%\n");
     }
-    FILE *f = fdopen(file.handle(), "w");
-    outsolhead(f, &opt);
+    FILE* f = fdopen(file.handle(), "w");
+    outsolhead(f,&opt);
 
-    for (i = PSolS; i != PSolE; ) {
-        sol.time = Time[i];
-        matcpy(sol.rr, SolRov + i * 3, 3, 1);
-        sol.stat = SolStat[i];
-        sol.ns = Nvsat[i];
-        sol.ratio = Ratio[i];
-        sol.age = Age[i];
-        outsol(f, &sol, SolRef + i * 3, &opt);
-        if (++i >= SolBuffSize) i = 0;
+    for (i=PSolS;i!=PSolE;) {
+        sol.time=Time[i];
+        matcpy(sol.rr,SolRov+i*3,3,1);
+        sol.stat=SolStat[i];
+        sol.ns=Nvsat[i];
+        sol.ratio=Ratio[i];
+        sol.age=Age[i];
+        outsol(f,&sol,SolRef+i*3,&opt);
+        if (++i>=SolBuffSize) i=0;
     }
 }
 // load navigation data -----------------------------------------------------
-void MainWindow::LoadNav(nav_t *nav)
+void  MainWindow::LoadNav(nav_t *nav)
 {
-    QSettings settings(IniFile, QSettings::IniFormat);
+    QSettings settings(IniFile,QSettings::IniFormat);
     QString str;
     eph_t eph0;
-    char buff[2049], *p;
-    long toe_time,toc_time,ttr_time;
+    char buff[2049],*p;
     int i;
+    
+    trace(3,"LoadNav\n");
+    
+    memset(&eph0,0,sizeof(eph_t));
 
-    trace(3, "LoadNav\n");
-
-    memset(&eph0, 0, sizeof(eph_t));
-
-    for (i = 0; i < MAXSAT; i++) {
-        if ((str = settings.value(QString("navi/eph_%1").arg(i, 2)).toString()).isEmpty()) continue;
-        nav->eph[i] = eph0;
-        strcpy(buff, qPrintable(str));
-        if (!(p = strchr(buff, ','))) continue;
-        *p = '\0';
-        if (!(nav->eph[i].sat = satid2no(buff))) continue;
-        sscanf(p + 1, "%d,%d,%d,%d,%ld,%ld,%ld,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%d,%d",
+    for (i=0;i<MAXSAT;i++) {
+        if ((str=settings.value(QString("navi/eph_%1").arg(i,2)).toString()).isEmpty()) continue;
+        nav->eph[i]=eph0;
+        strcpy(buff,qPrintable(str));
+        if (!(p=strchr(buff,','))) continue;
+        *p='\0';
+        if (!(nav->eph[i].sat=satid2no(buff))) continue;
+        sscanf(p+1,"%d,%d,%d,%d,%ld,%ld,%ld,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%lf,%d,%d",
                &nav->eph[i].iode,
                &nav->eph[i].iodc,
-               &nav->eph[i].sva,
-               &nav->eph[i].svh,
-               &toe_time,
-               &toc_time,
-               &ttr_time,
-               &nav->eph[i].A,
-               &nav->eph[i].e,
-               &nav->eph[i].i0,
+               &nav->eph[i].sva ,
+               &nav->eph[i].svh ,
+               &nav->eph[i].toe.time,
+               &nav->eph[i].toc.time,
+               &nav->eph[i].ttr.time,
+               &nav->eph[i].A   ,
+               &nav->eph[i].e   ,
+               &nav->eph[i].i0  ,
                &nav->eph[i].OMG0,
-               &nav->eph[i].omg,
-               &nav->eph[i].M0,
+               &nav->eph[i].omg ,
+               &nav->eph[i].M0  ,
                &nav->eph[i].deln,
                &nav->eph[i].OMGd,
                &nav->eph[i].idot,
-               &nav->eph[i].crc,
-               &nav->eph[i].crs,
-               &nav->eph[i].cuc,
-               &nav->eph[i].cus,
-               &nav->eph[i].cic,
-               &nav->eph[i].cis,
+               &nav->eph[i].crc ,
+               &nav->eph[i].crs ,
+               &nav->eph[i].cuc ,
+               &nav->eph[i].cus ,
+               &nav->eph[i].cic ,
+               &nav->eph[i].cis ,
                &nav->eph[i].toes,
-               &nav->eph[i].fit,
-               &nav->eph[i].f0,
-               &nav->eph[i].f1,
-               &nav->eph[i].f2,
+               &nav->eph[i].fit ,
+               &nav->eph[i].f0  ,
+               &nav->eph[i].f1  ,
+               &nav->eph[i].f2  ,
                &nav->eph[i].tgd[0],
                &nav->eph[i].code,
                &nav->eph[i].flag);
-        nav->eph[i].toe.time = toe_time;
-        nav->eph[i].toc.time = toc_time;
-        nav->eph[i].ttr.time = ttr_time;
     }
-    str = settings.value("navi/ion", "").toString();
-    QStringList tokens = str.split(",");
-    for (i = 0; i < 8; i++) nav->ion_gps[i] = 0.0;
-    for (i = 0; (i < 8) && (i < tokens.size()); i++) nav->ion_gps[i] = tokens.at(i).toDouble();
-
-    str = settings.value("navi/utc", "").toString();
-    tokens = str.split(",");
-    for (i = 0; i < 4; i++) nav->utc_gps[i] = 0.0;
-    for (i = 0; (i < 4) && (i < tokens.size()); i++) nav->utc_gps[i] = tokens.at(i).toDouble();
+    str=settings.value("navi/ion","").toString();
+    QStringList tokens=str.split(",");
+    for (i=0;i<8;i++) nav->ion_gps[i]=0.0;
+    for (i=0;(i<8)&&(i<tokens.size());i++) nav->ion_gps[i]=tokens.at(i).toDouble();
 
-    nav->leaps = settings.value("navi/leaps", 0).toInt();
+    str=settings.value("navi/utc","").toString();
+    tokens=str.split(",");
+    for (i=0;i<4;i++) nav->utc_gps[i]=0.0;
+    for (i=0;(i<4)&&(i<tokens.size());i++) nav->utc_gps[i]=tokens.at(i).toDouble();
+    
+    nav->leaps=settings.value("navi/leaps",0).toInt();
+    
 }
 // save navigation data -----------------------------------------------------
-void MainWindow::SaveNav(nav_t *nav)
+void  MainWindow::SaveNav(nav_t *nav)
 {
-    QSettings settings(IniFile, QSettings::IniFormat);
+    QSettings settings(IniFile,QSettings::IniFormat);
     QString str;
     char id[32];
     int i;
-
-    trace(3, "SaveNav\n");
-
-    for (i = 0; i < MAXSAT; i++) {
-        if (nav->eph[i].ttr.time == 0) continue;
-        str = "";
-        satno2id(nav->eph[i].sat, id);
-        str = str + id + ",";
-        str = str + QString("%1,").arg(nav->eph[i].iode);
-        str = str + QString("%1,").arg(nav->eph[i].iodc);
-        str = str + QString("%1,").arg(nav->eph[i].sva);
-        str = str + QString("%1,").arg(nav->eph[i].svh);
-        str = str + QString("%1,").arg(static_cast<int>(nav->eph[i].toe.time));
-        str = str + QString("%1,").arg(static_cast<int>(nav->eph[i].toc.time));
-        str = str + QString("%1,").arg(static_cast<int>(nav->eph[i].ttr.time));
-        str = str + QString("%1,").arg(nav->eph[i].A, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].e, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].i0, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].OMG0, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].omg, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].M0, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].deln, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].OMGd, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].idot, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].crc, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].crs, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].cuc, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].cus, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].cic, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].cis, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].toes, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].fit, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].f0, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].f1, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].f2, 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].tgd[0], 0, 'E', 14);
-        str = str + QString("%1,").arg(nav->eph[i].code);
-        str = str + QString("%1,").arg(nav->eph[i].flag);
-        settings.setValue(QString("navi/eph_%1").arg(i, 2), str);
+    
+    trace(3,"SaveNav\n");
+    
+    for (i=0;i<MAXSAT;i++) {
+        if (nav->eph[i].ttr.time==0) continue;
+        str="";
+        satno2id(nav->eph[i].sat,id);
+        str=str+id+",";
+        str=str+QString("%1,").arg(nav->eph[i].iode);
+        str=str+QString("%1,").arg(nav->eph[i].iodc);
+        str=str+QString("%1,").arg(nav->eph[i].sva);
+        str=str+QString("%1,").arg(nav->eph[i].svh);
+        str=str+QString("%1,").arg(static_cast<int>(nav->eph[i].toe.time));
+        str=str+QString("%1,").arg(static_cast<int>(nav->eph[i].toc.time));
+        str=str+QString("%1,").arg(static_cast<int>(nav->eph[i].ttr.time));
+        str=str+QString("%1,").arg(nav->eph[i].A,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].e,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].i0,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].OMG0,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].omg,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].M0,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].deln,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].OMGd,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].idot,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].crc,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].crs,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].cuc,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].cus,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].cic,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].cis,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].toes,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].fit,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].f0,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].f1,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].f2,0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].tgd[0],0,'E',14);
+        str=str+QString("%1,").arg(nav->eph[i].code);
+        str=str+QString("%1,").arg(nav->eph[i].flag);
+        settings.setValue(QString("navi/eph_%1").arg(i,2),str);
     }
-    str = "";
-    for (i = 0; i < 8; i++) str = str + QString("%1,").arg(nav->ion_gps[i], 0, 'E', 14);
-    settings.setValue("navi/ion", str);
-
-    str = "";
-    for (i = 0; i < 4; i++) str = str + QString("%1,").arg(nav->utc_gps[i], 0, 'E', 14);
-    settings.setValue("navi/utc", str);
+    str="";
+    for (i=0;i<8;i++) str=str+QString("%1,").arg(nav->ion_gps[i],0,'E',14);
+    settings.setValue("navi/ion",str);
+    
+    str="";
+    for (i=0;i<4;i++) str=str+QString("%1,").arg(nav->utc_gps[i],0,'E',14);
+    settings.setValue("navi/utc",str);
+    
+    settings.setValue("navi/leaps",nav->leaps);
 
-    settings.setValue("navi/leaps", nav->leaps);
 }
 // set tray icon ------------------------------------------------------------
-void MainWindow::SetTrayIcon(int index)
+void  MainWindow::SetTrayIcon(int index)
 {
     QPixmap pix(":/buttons/navi.bmp");
-
-    systemTray->setIcon(QIcon(pix.copy(index * 16, 0, 16, 16)));
+    systemTray->setIcon(QIcon(pix.copy(index*16,0,16,16)));
 }
 // load option from ini file ------------------------------------------------
-void MainWindow::LoadOpt(void)
+void  MainWindow::LoadOpt(void)
 {
-    QSettings settings(IniFile, QSettings::IniFormat);
+    QSettings settings(IniFile,QSettings::IniFormat);
     QString s;
-    int i, j, no, strno[] = { 0, 1, 6, 2, 3, 4, 5, 7 };
-
-    trace(3, "LoadOpt\n");
+    int i,j,no,strno[]={0,1,6,2,3,4,5,7};
+    
+    trace(3,"LoadOpt\n");
 
-    for (i = 0; i < 8; i++) {
-        no = strno[i];
-        StreamC[i] = settings.value(QString("stream/streamc%1").arg(no), 0).toInt();
-        Stream [i] = settings.value(QString("stream/stream%1").arg(no), 0).toInt();
-        Format [i] = settings.value(QString("stream/format%1").arg(no), 0).toInt();
-        for (j = 0; j < 4; j++)
-            Paths[i][j] = settings.value(QString("stream/path_%1_%2").arg(no).arg(j), "").toString();
-    }
-    for (i = 0; i < 3; i++)
-        RcvOpt [i] = settings.value(QString("stream/rcvopt%1").arg(i + 1), "").toString();
-    for (i = 0; i < 3; i++) for (j = 0; j < 3; j++) {
-            Cmds[i][j] = settings.value(QString("serial/cmd_%1_%2").arg(i).arg(j), "").toString();
-            CmdEna[i][j] = settings.value(QString("serial/cmdena_%1_%2").arg(i).arg(j), 0).toInt();
-            Cmds[i][j].replace("@@", "\r\n");
-        }
-    for (i = 0; i < 3; i++) for (j = 0; j < 3; j++) {
-            CmdsTcp[i][j] = settings.value(QString("tcpip/cmd_%1_%2").arg(i).arg(j), "").toString();
-            CmdEnaTcp[i][j] = settings.value(QString("tcpip/cmdena_%1_%2").arg(i).arg(j), 0).toInt();
-            CmdsTcp[i][j].replace("@@", "\r\n");
+    for (i=0;i<8;i++) {
+        no=strno[i];
+        StreamC[i]=settings.value(QString("stream/streamc%1").arg(no),0).toInt();
+        Stream [i]=settings.value(QString("stream/stream%1").arg(no),0).toInt();
+        Format [i]=settings.value(QString("stream/format%1").arg(no),0).toInt();
+        for (j=0;j<4;j++) {
+            Paths[i][j]=settings.value(QString("stream/path_%1_%2").arg(no).arg(j),"").toString();
         }
-    PrcOpt.mode = settings.value("prcopt/mode", 0).toInt();
-    PrcOpt.nf = settings.value("prcopt/nf", 2).toInt();
-    PrcOpt.elmin = settings.value("prcopt/elmin", 15.0 * D2R).toFloat();
-    PrcOpt.snrmask.ena[0] = settings.value("prcopt/snrmask_ena1", 0).toInt();
-    PrcOpt.snrmask.ena[1] = settings.value("prcopt/snrmask_ena2", 0).toInt();
-    for (i = 0; i < NFREQ; i++) for (j = 0; j < 9; j++)
-            PrcOpt.snrmask.mask[i][j] =
-                settings.value(QString("prcopt/snrmask_%1_%2").arg(i + 1).arg(j + 1), 0.0).toInt();
-
-    PrcOpt.dynamics = settings.value("prcopt/dynamics", 0).toInt();
-    PrcOpt.tidecorr = settings.value("prcopt/tidecorr", 0).toInt();
-    PrcOpt.modear = settings.value("prcopt/modear", 1).toInt();
-    PrcOpt.glomodear = settings.value("prcopt/glomodear", 0).toInt();
-    PrcOpt.bdsmodear = settings.value("prcopt/bdsmodear", 0).toInt();
-    PrcOpt.maxout = settings.value("prcopt/maxout", 5).toInt();
-    PrcOpt.minlock = settings.value("prcopt/minlock", 0).toInt();
-    PrcOpt.minfix = settings.value("prcopt/minfix", 10).toInt();
-    PrcOpt.ionoopt = settings.value("prcopt/ionoopt", IONOOPT_BRDC).toInt();
-    PrcOpt.tropopt = settings.value("prcopt/tropopt", TROPOPT_SAAS).toInt();
-    PrcOpt.sateph = settings.value("prcopt/ephopt", EPHOPT_BRDC).toInt();
-    PrcOpt.niter = settings.value("prcopt/niter", 1).toInt();
-    PrcOpt.eratio[0] = settings.value("prcopt/eratio0", 100.0).toDouble();
-    PrcOpt.eratio[1] = settings.value("prcopt/eratio1", 100.0).toDouble();
-    PrcOpt.err[1] = settings.value("prcopt/err1", 0.003).toDouble();
-    PrcOpt.err[2] = settings.value("prcopt/err2", 0.003).toDouble();
-    PrcOpt.err[3] = settings.value("prcopt/err3", 0.0).toDouble();
-    PrcOpt.err[4] = settings.value("prcopt/err4", 1.0).toDouble();
-    PrcOpt.prn[0] = settings.value("prcopt/prn0", 1E-4).toDouble();
-    PrcOpt.prn[1] = settings.value("prcopt/prn1", 1E-3).toDouble();
-    PrcOpt.prn[2] = settings.value("prcopt/prn2", 1E-4).toDouble();
-    PrcOpt.prn[3] = settings.value("prcopt/prn3", 10.0).toDouble();
-    PrcOpt.prn[4] = settings.value("prcopt/prn4", 10.0).toDouble();
-    PrcOpt.sclkstab = settings.value("prcopt/sclkstab", 5E-12).toDouble();
-    PrcOpt.thresar[0] = settings.value("prcopt/thresar", 3.0).toDouble();
-    PrcOpt.elmaskar = settings.value("prcopt/elmaskar", 0.0).toDouble();
-    PrcOpt.elmaskhold = settings.value("prcopt/elmaskhold", 0.0).toDouble();
-    PrcOpt.thresslip = settings.value("prcopt/thresslip", 0.05).toDouble();
-    PrcOpt.maxtdiff = settings.value("prcopt/maxtdiff", 30.0).toDouble();
-    PrcOpt.maxgdop = settings.value("prcopt/maxgdop", 30.0).toDouble();
-    PrcOpt.maxinno = settings.value("prcopt/maxinno", 30.0).toDouble();
-    PrcOpt.syncsol = settings.value("prcopt/syncsol", 0).toInt();
-    ExSats = settings.value("prcopt/exsats", "").toString();
-    PrcOpt.navsys = settings.value("prcopt/navsys", SYS_GPS).toInt();
-    PrcOpt.posopt[0] = settings.value("prcopt/posopt1", 0).toInt();
-    PrcOpt.posopt[1] = settings.value("prcopt/posopt2", 0).toInt();
-    PrcOpt.posopt[2] = settings.value("prcopt/posopt3", 0).toInt();
-    PrcOpt.posopt[3] = settings.value("prcopt/posopt4", 0).toInt();
-    PrcOpt.posopt[4] = settings.value("prcopt/posopt5", 0).toInt();
-    PrcOpt.posopt[5] = settings.value("prcopt/posopt6", 0).toInt();
-    PrcOpt.maxaveep = settings.value("prcopt/maxaveep", 3600).toInt();
-    PrcOpt.initrst = settings.value("prcopt/initrst", 1).toInt();
-
-    BaselineC = settings.value("prcopt/baselinec", 0).toInt();
-    Baseline[0] = settings.value("prcopt/baseline1", 0.0).toDouble();
-    Baseline[1] = settings.value("prcopt/baseline2", 0.0).toDouble();
-
-    SolOpt.posf = settings.value("solopt/posf", 0).toInt();
-    SolOpt.times = settings.value("solopt/times", 0).toInt();
-    SolOpt.timef = settings.value("solopt/timef", 1).toInt();
-    SolOpt.timeu = settings.value("solopt/timeu", 3).toInt();
-    SolOpt.degf = settings.value("solopt/degf", 0).toInt();
-    s = settings.value("solopt/sep", " ").toString();
-    strcpy(SolOpt.sep, qPrintable(s));
-    SolOpt.outhead = settings.value("solop/outhead", 0).toInt();
-    SolOpt.outopt = settings.value("solopt/outopt", 0).toInt();
-    PrcOpt.outsingle = settings.value("prcopt/outsingle", 0).toInt();
-    SolOpt.maxsolstd = settings.value("solopt/maxsolstd", 0).toInt();
-    SolOpt.datum = settings.value("solopt/datum", 0).toInt();
-    SolOpt.height = settings.value("solopt/height", 0).toInt();
-    SolOpt.geoid = settings.value("solopt/geoid", 0).toInt();
-    SolOpt.nmeaintv[0] = settings.value("solopt/nmeaintv1", 0.0).toDouble();
-    SolOpt.nmeaintv[1] = settings.value("solopt/nmeaintv2", 0.0).toDouble();
-    DebugStatusF = settings.value("setting/debugstatus", 0).toInt();
-    DebugTraceF = settings.value("setting/debugtrace", 0).toInt();
-
-    RovPosTypeF = settings.value("setting/rovpostype", 0).toInt();
-    RefPosTypeF = settings.value("setting/refpostype", 0).toInt();
-    RovAntPcvF = settings.value("setting/rovantpcv", 0).toInt();
-    RefAntPcvF = settings.value("setting/refantpcv", 0).toInt();
-    RovAntF = settings.value("setting/rovant", "").toString();
-    RefAntF = settings.value("setting/refant", "").toString();
-    SatPcvFileF = settings.value("setting/satpcvfile", "").toString();
-    AntPcvFileF = settings.value("setting/antpcvfile", "").toString();
-    StaPosFileF = settings.value("setting/staposfile", "").toString();
-    GeoidDataFileF = settings.value("setting/geoiddatafile", "").toString();
-    DCBFileF = settings.value("setting/dcbfile", "").toString();
-    EOPFileF = settings.value("setting/eopfile", "").toString();
-    TLEFileF = settings.value("setting/tlefile", "").toString();
-    TLESatFileF = settings.value("setting/tlesatfile", "").toString();
-    LocalDirectory = settings.value("setting/localdirectory", "C:\\Temp").toString();
-
-    SvrCycle = settings.value("setting/svrcycle", 10).toInt();
-    TimeoutTime = settings.value("setting/timeouttime", 10000).toInt();
-    ReconTime = settings.value("setting/recontime", 10000).toInt();
-    NmeaCycle = settings.value("setting/nmeacycle", 5000).toInt();
-    SvrBuffSize = settings.value("setting/svrbuffsize", 32768).toInt();
-    SolBuffSize = settings.value("setting/solbuffsize", 1000).toInt();
-    SavedSol = settings.value("setting/savedsol", 100).toInt();
-    NavSelect = settings.value("setting/navselect", 0).toInt();
-    PrcOpt.sbassatsel = settings.value("setting/sbassat", 0).toInt();
-    DgpsCorr = settings.value("setting/dgpscorr", 0).toInt();
-    SbasCorr = settings.value("setting/sbascorr", 0).toInt();
-
-    NmeaReq = settings.value("setting/nmeareq", 0).toInt();
-    InTimeTag = settings.value("setting/intimetag", 0).toInt();
-    InTimeSpeed = settings.value("setting/intimespeed", "x1").toString();
-    InTimeStart = settings.value("setting/intimestart", "0").toString();
-    InTime64Bit = settings.value("setting/intime64bit", "0").toInt();
-    OutTimeTag = settings.value("setting/outtimetag", 0).toInt();
-    OutAppend = settings.value("setting/outappend", 0).toInt();
-    OutSwapInterval = settings.value("setting/outswapinterval", "").toString();
-    LogTimeTag = settings.value("setting/logtimetag", 0).toInt();
-    LogAppend = settings.value("setting/logappend", 0).toInt();
-    LogSwapInterval = settings.value("setting/logswapinterval", "").toString();
-    NmeaPos[0] = settings.value("setting/nmeapos1", 0.0).toDouble();
-    NmeaPos[1] = settings.value("setting/nmeapos2", 0.0).toDouble();
-    NmeaPos[2] = settings.value("setting/nmeapos3", 0.0).toDouble();
-    ResetCmd = settings.value("setting/resetcmd", "").toString();
-    MaxBL = settings.value("setting/maxbl", 10.0).toDouble();
-    FileSwapMargin = settings.value("setting/fswapmargin", 30).toInt();
+    }
+    for (i=0;i<3;i++) {
+        RcvOpt [i]=settings.value(QString("stream/rcvopt%1").arg(i+1),"").toString();
+    }
+    for (i=0;i<3;i++) for (j=0;j<2;j++) {
+        Cmds[i][j]=settings.value(QString("serial/cmd_%1_%2").arg(i).arg(j),"").toString();
+        CmdEna[i][j]=settings.value(QString("serial/cmdena_%1_%2").arg(i).arg(j),0).toInt();
+        Cmds[i][j].replace("@@","\r\n");
+    }
+    for (i=0;i<3;i++) for (j=0;j<2;j++) {
+        CmdsTcp[i][j]=settings.value(QString("tcpip/cmd_%1_%2").arg(i).arg(j),"").toString();
+        CmdEnaTcp[i][j]=settings.value(QString("tcpip/cmdena_%1_%2").arg(i).arg(j),0).toInt();
+        CmdsTcp[i][j].replace("@@","\r\n");
+    }
+    PrcOpt.mode     =settings.value("prcopt/mode",            0).toInt();
+    PrcOpt.nf       =settings.value("prcopt/nf",              2).toInt();
+    PrcOpt.elmin    =settings.value("prcopt/elmin",    15.0*D2R).toInt();
+    PrcOpt.snrmask.ena[0]=settings.value("prcopt/snrmask_ena1",0).toInt();
+    PrcOpt.snrmask.ena[1]=settings.value("prcopt/snrmask_ena2",0).toInt();
+    for (i=0;i<NFREQ;i++) for (j=0;j<9;j++) {
+        PrcOpt.snrmask.mask[i][j]=
+            settings.value(QString("prcopt/snrmask_%1_%2").arg(i+1).arg(j+1),0.0).toInt();
+    }
+    PrcOpt.dynamics =settings.value("prcopt/dynamics",        0).toInt();
+    PrcOpt.tidecorr =settings.value("prcopt/tidecorr",        0).toInt();
+    PrcOpt.modear   =settings.value("prcopt/modear",          1).toInt();
+    PrcOpt.glomodear=settings.value("prcopt/glomodear",       0).toInt();
+    PrcOpt.bdsmodear=settings.value("prcopt/bdsmodear",       0).toInt();
+    PrcOpt.maxout   =settings.value("prcopt/maxout",          5).toInt();
+    PrcOpt.minlock  =settings.value("prcopt/minlock",         0).toInt();
+    PrcOpt.minfix   =settings.value("prcopt/minfix",         10).toInt();
+    PrcOpt.ionoopt  =settings.value("prcopt/ionoopt",IONOOPT_BRDC).toInt();
+    PrcOpt.tropopt  =settings.value("prcopt/tropopt",TROPOPT_SAAS).toInt();
+    PrcOpt.sateph   =settings.value("prcopt/ephopt",  EPHOPT_BRDC).toInt();
+    PrcOpt.niter    =settings.value("prcopt/niter",           1).toInt();
+    PrcOpt.eratio[0]=settings.value("prcopt/eratio0",     100.0).toDouble();
+    PrcOpt.eratio[1]=settings.value("prcopt/eratio1",     100.0).toDouble();
+    PrcOpt.err[1]   =settings.value("prcopt/err1",        0.003).toDouble();
+    PrcOpt.err[2]   =settings.value("prcopt/err2",        0.003).toDouble();
+    PrcOpt.err[3]   =settings.value("prcopt/err3",          0.0).toDouble();
+    PrcOpt.err[4]   =settings.value("prcopt/err4",          1.0).toDouble();
+    PrcOpt.prn[0]   =settings.value("prcopt/prn0",         1E-4).toDouble();
+    PrcOpt.prn[1]   =settings.value("prcopt/prn1",         1E-3).toDouble();
+    PrcOpt.prn[2]   =settings.value("prcopt/prn2",         1E-4).toDouble();
+    PrcOpt.prn[3]   =settings.value("prcopt/prn3",         10.0).toDouble();
+    PrcOpt.prn[4]   =settings.value("prcopt/prn4",         10.0).toDouble();
+    PrcOpt.sclkstab =settings.value("prcopt/sclkstab",    5E-12).toDouble();
+    PrcOpt.thresar[0]=settings.value("prcopt/thresar",       3.0).toDouble();
+    PrcOpt.elmaskar =settings.value("prcopt/elmaskar",      0.0).toDouble();
+    PrcOpt.elmaskhold=settings.value("prcopt/elmaskhold",    0.0).toDouble();
+    PrcOpt.thresslip=settings.value("prcopt/thresslip",    0.05).toDouble();
+    PrcOpt.maxtdiff =settings.value("prcopt/maxtdiff",     30.0).toDouble();
+    PrcOpt.maxgdop  =settings.value("prcopt/maxgdop",      30.0).toDouble();
+    PrcOpt.maxinno  =settings.value("prcopt/maxinno",      30.0).toDouble();
+    PrcOpt.syncsol  =settings.value("prcopt/syncsol",         0).toInt();
+    ExSats          =settings.value("prcopt/exsats",         "").toString();
+    PrcOpt.navsys   =settings.value("prcopt/navsys",    SYS_GPS).toInt();
+    PrcOpt.posopt[0]=settings.value("prcopt/posopt1",         0).toInt();
+    PrcOpt.posopt[1]=settings.value("prcopt/posopt2",         0).toInt();
+    PrcOpt.posopt[2]=settings.value("prcopt/posopt3",         0).toInt();
+    PrcOpt.posopt[3]=settings.value("prcopt/posopt4",         0).toInt();
+    PrcOpt.posopt[4]=settings.value("prcopt/posopt5",         0).toInt();
+    PrcOpt.posopt[5]=settings.value("prcopt/posopt6",         0).toInt();
+    PrcOpt.maxaveep =settings.value("prcopt/maxaveep",     3600).toInt();
+    PrcOpt.initrst  =settings.value("prcopt/initrst",         1).toInt();
 
-    TimeSys = settings.value("setting/timesys", 0).toInt();
-    SolType = settings.value("setting/soltype", 0).toInt();
-    PlotType[0] = settings.value("setting/plottype", 0).toInt();
-    PlotType[1] = settings.value("setting/plottype2", 0).toInt();
-    PlotType[2] = settings.value("setting/plottype3", 0).toInt();
-    PlotType[3] = settings.value("setting/plottype4", 0).toInt();
-    PanelMode = settings.value("setting/panelmode", 0).toInt();
-    ProxyAddr = settings.value("setting/proxyaddr", "").toString();
-    MoniPort = settings.value("setting/moniport", DEFAULTPORT).toInt();
-    PanelStack = settings.value("setting/panelstack", 0).toInt();
-    TrkType[0] = settings.value("setting/trktype1", 0).toInt();
-    TrkType[1] = settings.value("setting/trktype2", 0).toInt();
-    TrkType[2] = settings.value("setting/trktype3", 0).toInt();
-    TrkType[3] = settings.value("setting/trktype4", 0).toInt();
-    TrkScale[0] = settings.value("setting/trkscale1", 5).toInt();
-    TrkScale[1] = settings.value("setting/trkscale2", 5).toInt();
-    TrkScale[2] = settings.value("setting/trkscale3", 5).toInt();
-    TrkScale[3] = settings.value("setting/trkscale4", 5).toInt();
-    FreqType1 = settings.value("setting/freqtype1", 0).toInt();
-    FreqType2 = settings.value("setting/freqtype2", 0).toInt();
-    FreqType3 = settings.value("setting/freqtype3", 0).toInt();
-    FreqType4 = settings.value("setting/freqtype4", 0).toInt();
-    BLMode[0] = settings.value("setting/blmode1", 0).toInt();
-    BLMode[1] = settings.value("setting/blmode2", 0).toInt();
-    BLMode[2] = settings.value("setting/blmode3", 0).toInt();
-    BLMode[3] = settings.value("setting/blmode4", 0).toInt();
-    MarkerName = settings.value("setting/markername", "").toString();
-    MarkerComment = settings.value("setting/markercomment", "").toString();
+    BaselineC       =settings.value("prcopt/baselinec",       0).toInt();
+    Baseline[0]     =settings.value("prcopt/baseline1",     0.0).toDouble();
+    Baseline[1]     =settings.value("prcopt/baseline2",     0.0).toDouble();
+    
+    SolOpt.posf     =settings.value("solopt/posf",            0).toInt();
+    SolOpt.times    =settings.value("solopt/times",           0).toInt();
+    SolOpt.timef    =settings.value("solopt/timef",           1).toInt();
+    SolOpt.timeu    =settings.value("solopt/timeu",           3).toInt();
+    SolOpt.degf     =settings.value("solopt/degf",            0).toInt();
+    s=settings.value("solopt/sep"," ").toString();
+    strcpy(SolOpt.sep,qPrintable(s));
+    SolOpt.outhead  =settings.value("solop/outhead",         0).toInt();
+    SolOpt.outopt   =settings.value("solopt/outopt",          0).toInt();
+    SolOpt.datum    =settings.value("solopt/datum",           0).toInt();
+    SolOpt.height   =settings.value("solopt/height",          0).toInt();
+    SolOpt.geoid    =settings.value("solopt/geoid",           0).toInt();
+    SolOpt.nmeaintv[0]=settings.value("solopt/nmeaintv1",     0.0).toDouble();
+    SolOpt.nmeaintv[1]=settings.value("solopt/nmeaintv2",     0.0).toDouble();
+    DebugStatusF    =settings.value("setting/debugstatus",     0).toInt();
+    DebugTraceF     =settings.value("setting/debugtrace",      0).toInt();
+    
+    RovPosTypeF     =settings.value("setting/rovpostype",      0).toInt();
+    RefPosTypeF     =settings.value("setting/refpostype",      0).toInt();
+    RovAntPcvF      =settings.value("setting/rovantpcv",       0).toInt();
+    RefAntPcvF      =settings.value("setting/refantpcv",       0).toInt();
+    RovAntF         =settings.value("setting/rovant",         "").toString();
+    RefAntF         =settings.value("setting/refant",         "").toString();
+    SatPcvFileF     =settings.value("setting/satpcvfile",     "").toString();
+    AntPcvFileF     =settings.value("setting/antpcvfile",     "").toString();
+    StaPosFileF     =settings.value("setting/staposfile",     "").toString();
+    GeoidDataFileF  =settings.value("setting/geoiddatafile",  "").toString();
+    DCBFileF        =settings.value("setting/dcbfile",        "").toString();
+    EOPFileF        =settings.value("setting/eopfile",        "").toString();
+    TLEFileF        =settings.value("setting/tlefile",        "").toString();
+    TLESatFileF     =settings.value("setting/tlesatfile",     "").toString();
+    LocalDirectory  =settings.value("setting/localdirectory","C:\\Temp").toString();
+    
+    SvrCycle        =settings.value("setting/svrcycle",       10).toInt();
+    TimeoutTime     =settings.value("setting/timeouttime", 10000).toInt();
+    ReconTime       =settings.value("setting/recontime",   10000).toInt();
+    NmeaCycle       =settings.value("setting/nmeacycle",    5000).toInt();
+    SvrBuffSize     =settings.value("setting/svrbuffsize", 32768).toInt();
+    SolBuffSize     =settings.value("setting/solbuffsize",  1000).toInt();
+    SavedSol        =settings.value("setting/savedsol",      100).toInt();
+    NavSelect       =settings.value("setting/navselect",       0).toInt();
+    PrcOpt.sbassatsel=settings.value("setting/sbassat",        0).toInt();
+    DgpsCorr        =settings.value("setting/dgpscorr",        0).toInt();
+    SbasCorr        =settings.value("setting/sbascorr",        0).toInt();
+    
+    NmeaReq         =settings.value("setting/nmeareq",         0).toInt();
+    InTimeTag       =settings.value("setting/intimetag",       0).toInt();
+    InTimeSpeed     =settings.value("setting/intimespeed",  "x1").toString();
+    InTimeStart     =settings.value("setting/intimestart",   "0").toString();
+    OutTimeTag      =settings.value("setting/outtimetag",      0).toInt();
+    OutAppend       =settings.value("setting/outappend",       0).toInt();
+    OutSwapInterval =settings.value("setting/outswapinterval","").toString();
+    LogTimeTag      =settings.value("setting/logtimetag",      0).toInt();
+    LogAppend       =settings.value("setting/logappend",       0).toInt();
+    LogSwapInterval =settings.value("setting/logswapinterval","").toString();
+    NmeaPos[0]      =settings.value("setting/nmeapos1",      0.0).toDouble();
+    NmeaPos[1]      =settings.value("setting/nmeapos2",      0.0).toDouble();
+    FileSwapMargin  =settings.value("setting/fswapmargin",    30).toInt();
+    
+    TimeSys         =settings.value("setting/timesys",         0).toInt();
+    SolType         =settings.value("setting/soltype",         0).toInt();
+    PlotType1       =settings.value("setting/plottype",        0).toInt();
+    PlotType2       =settings.value("setting/plottype2",       0).toInt();
+    PanelMode       =settings.value("setting/panelmode",       0).toInt();
+    ProxyAddr       =settings.value("setting/proxyaddr",      "").toString();
+    MoniPort        =settings.value("setting/moniport",DEFAULTPORT).toInt();
+    PanelStack      =settings.value("setting/panelstack",      0).toInt();
+    TrkType1        =settings.value("setting/trktype1",        0).toInt();
+    TrkType2        =settings.value("setting/trktype2",        0).toInt();
+    TrkScale1       =settings.value("setting/trkscale1",       5).toInt();
+    TrkScale2       =settings.value("setting/trkscale2",       5).toInt();
+    BLMode1         =settings.value("setting/blmode1",         0).toInt();
+    BLMode2         =settings.value("setting/blmode2",         0).toInt();
+    MarkerName      =settings.value("setting/markername",     "").toString();
+    MarkerComment   =settings.value("setting/markercomment",  "").toString();
 
-    for (i = 0; i < 3; i++) {
-        RovAntDel[i] = settings.value(QString("setting/rovantdel_%1").arg(i), 0.0).toDouble();
-        RefAntDel[i] = settings.value(QString("setting/refantdel_%1").arg(i), 0.0).toDouble();
-        RovPos   [i] = settings.value(QString("setting/rovpos_%1").arg(i), 0.0).toDouble();
-        RefPos   [i] = settings.value(QString("setting/refpos_%1").arg(i), 0.0).toDouble();
+    for (i=0;i<3;i++) {
+        RovAntDel[i]=settings.value(QString("setting/rovantdel_%1").arg(i),0.0).toDouble();
+        RefAntDel[i]=settings.value(QString("setting/refantdel_%1").arg(i),0.0).toDouble();
+        RovPos   [i]=settings.value(QString("setting/rovpos_%1").arg(i),0.0).toDouble();
+        RefPos   [i]=settings.value(QString("setting/refpos_%1").arg(i),0.0).toDouble();
     }
-    for (i = 0; i < 10; i++)
-        History[i] = settings.value(QString("tcpopt/history%1").arg(i), "").toString();
-    for (i = 0; i < 10; i++)
-        MntpHist[i] = settings.value(QString("tcpopt/mntphist%1").arg(i), "").toString();
-    NMapPnt = settings.value("mapopt/nmappnt", 0).toInt();
-    for (i = 0; i < NMapPnt; i++) {
-        PntName[i] = settings.value(QString("mapopt/pntname%1").arg(i + 1), "").toString();
-        QString pos = settings.value(QString("mapopt/pntpos%1").arg(i + 1), "0,0,0").toString();
-        PntPos[i][0] = PntPos[i][1] = PntPos[i][2] = 0.0;
-        sscanf(qPrintable(pos), "%lf,%lf,%lf", PntPos[i], PntPos[i] + 1, PntPos[i] + 2);
+    for (i=0;i<10;i++) {
+        History[i]=settings.value(QString("tcpopt/history%1").arg(i),"").toString();
     }
-    PosFont.setFamily(settings.value("setting/posfontname", POSFONTNAME).toString());
-    PosFont.setPointSize(settings.value("setting/posfontsize", POSFONTSIZE).toInt());
+    for (i=0;i<10;i++) {
+        MntpHist[i]=settings.value(QString("tcpopt/mntphist%1").arg(i),"").toString();
+    }
+    NMapPnt        =settings.value("mapopt/nmappnt",0).toInt();
+    for (i=0;i<NMapPnt;i++) {
+        PntName[i]=settings.value(QString("mapopt/pntname%1").arg(i+1),"").toString();
+        QString pos=settings.value(QString("mapopt/pntpos%1").arg(i+1),"0,0,0").toString();
+        PntPos[i][0]=PntPos[i][1]=PntPos[i][2]=0.0;
+        sscanf(qPrintable(pos),"%lf,%lf,%lf",PntPos[i],PntPos[i]+1,PntPos[i]+2);
+    }
+    PosFont.setFamily(settings.value("setting/posfontname",POSFONTNAME).toString());
+    PosFont.setPointSize(settings.value("setting/posfontsize",POSFONTSIZE).toInt());
 //    PosFont.setStyle(QColor(settings.value("setting/posfontcolor",(int)clBlack).toInt());
-    if (settings.value("setting/posfontbold", 0).toInt()) PosFont.setBold(true);
-    if (settings.value("setting/posfontitalic", 0).toInt()) PosFont.setItalic(true); ;
-
-    TextViewer::Color1 = QColor(static_cast<QRgb>(settings.value("viewer/color1", static_cast<int>(Qt::black)).toInt()));
-    TextViewer::Color2 = QColor(static_cast<QRgb>(settings.value("viewer/color2", static_cast<int>(Qt::white)).toInt()));
-    TextViewer::FontD.setFamily(settings.value("viewer/fontname", "Courier New").toString());
-    TextViewer::FontD.setPointSize(settings.value("viewer/fontsize", 9).toInt());
-
+    if (settings.value("setting/posfontbold",  0).toInt()) PosFont.setBold(true);
+    if (settings.value("setting/posfontitalic",0).toInt()) PosFont.setItalic(true);;
+    
+    TextViewer::Color1=QColor(static_cast<QRgb>(settings.value("viewer/color1",static_cast<int>(Qt::black)).toInt()));
+    TextViewer::Color2=QColor(static_cast<QRgb>(settings.value("viewer/color2",static_cast<int>(Qt::white)).toInt()));
+    TextViewer::FontD.setFamily(settings.value("viewer/fontname","Courier New").toString());
+    TextViewer::FontD.setPointSize(settings.value("viewer/fontsize",9).toInt());
+    
     UpdatePanel();
 
-    splitter->restoreState(settings.value("window/splitpos").toByteArray());
+    Splitter1->restoreState(settings.value("window/splitpos").toByteArray());
+    Splitter2->restoreState(settings.value("window/splitpos2").toByteArray());
 
-    resize(settings.value("window/width", 388).toInt(),
-           settings.value("window/height", 284).toInt());
+    resize(settings.value("window/width",   388).toInt(),
+           settings.value("window/height",  284).toInt());
 }
 // save option to ini file --------------------------------------------------
-void MainWindow::SaveOpt(void)
+void  MainWindow::SaveOpt(void)
 {
-    QSettings settings(IniFile, QSettings::IniFormat);
-    int i, j, no, strno[] = { 0, 1, 6, 2, 3, 4, 5, 7 };
-
-    trace(3, "SaveOpt\n");
-
-    for (i = 0; i < 8; i++) {
-        no = strno[i];
-        settings.setValue(QString("stream/streamc%1").arg(no), StreamC[i]);
-        settings.setValue(QString("stream/stream%1").arg(no), Stream [i]);
-        settings.setValue(QString("stream/format%1").arg(no), Format [i]);
-        for (j = 0; j < 4; j++)
-            settings.setValue(QString("stream/path_%1_%2").arg(no).arg(j), Paths[i][j]);
-    }
-    for (i = 0; i < 3; i++)
-        settings.setValue(QString("stream/rcvopt%1").arg(i + 1), RcvOpt[i]);
-    for (i = 0; i < 3; i++) for (j = 0; j < 3; j++) {
-            Cmds[i][j].replace("\r\n", "@@");
-            settings.setValue(QString("serial/cmd_%1_%2").arg(i).arg(j), Cmds  [i][j]);
-            settings.setValue(QString("serial/cmdena_%1_%2").arg(i).arg(j), CmdEna[i][j]);
-        }
-    for (i = 0; i < 3; i++) for (j = 0; j < 3; j++) {
-            CmdsTcp[i][j].replace("\r\n", "@@");
-            settings.setValue(QString("tcpip/cmd_%1_%2").arg(i).arg(j), CmdsTcp  [i][j]);
-            settings.setValue(QString("tcpip/cmdena_%1_%2").arg(i).arg(j), CmdEnaTcp[i][j]);
+    QSettings settings(IniFile,QSettings::IniFormat);
+    int i,j,no,strno[]={0,1,6,2,3,4,5,7};
+    
+    trace(3,"SaveOpt\n");
+    
+    for (i=0;i<8;i++) {
+        no=strno[i];
+        settings.setValue(QString("stream/streamc%1").arg(no),StreamC[i]);
+        settings.setValue(QString("stream/stream%1").arg(no),Stream [i]);
+        settings.setValue(QString("stream/format%1").arg(no),Format [i]);
+        for (j=0;j<4;j++) {
+            settings.setValue(QString("stream/path_%1_%2").arg(no).arg(j),Paths[i][j]);
         }
-    settings.setValue("prcopt/mode", PrcOpt.mode);
-    settings.setValue("prcopt/nf", PrcOpt.nf);
-    settings.setValue("prcopt/elmin", PrcOpt.elmin);
-    settings.setValue("prcopt/snrmask_ena1", PrcOpt.snrmask.ena[0]);
-    settings.setValue("prcopt/snrmask_ena2", PrcOpt.snrmask.ena[1]);
-    for (i = 0; i < NFREQ; i++) for (j = 0; j < 9; j++)
-            settings.setValue(QString("prcopt/snrmask_%1_%2").arg(i + 1).arg(j + 1),
-                      PrcOpt.snrmask.mask[i][j]);
-
-    settings.setValue("prcopt/dynamics", PrcOpt.dynamics);
-    settings.setValue("prcopt/tidecorr", PrcOpt.tidecorr);
-    settings.setValue("prcopt/modear", PrcOpt.modear);
-    settings.setValue("prcopt/glomodear", PrcOpt.glomodear);
-    settings.setValue("prcopt/bdsmodear", PrcOpt.bdsmodear);
-    settings.setValue("prcopt/maxout", PrcOpt.maxout);
-    settings.setValue("prcopt/minlock", PrcOpt.minlock);
-    settings.setValue("prcopt/minfix", PrcOpt.minfix);
-    settings.setValue("prcopt/ionoopt", PrcOpt.ionoopt);
-    settings.setValue("prcopt/tropopt", PrcOpt.tropopt);
-    settings.setValue("prcopt/ephopt", PrcOpt.sateph);
-    settings.setValue("prcopt/niter", PrcOpt.niter);
-    settings.setValue("prcopt/eratio0", PrcOpt.eratio[0]);
-    settings.setValue("prcopt/eratio1", PrcOpt.eratio[1]);
-    settings.setValue("prcopt/err1", PrcOpt.err[1]);
-    settings.setValue("prcopt/err2", PrcOpt.err[2]);
-    settings.setValue("prcopt/err3", PrcOpt.err[3]);
-    settings.setValue("prcopt/err4", PrcOpt.err[4]);
-    settings.setValue("prcopt/prn0", PrcOpt.prn[0]);
-    settings.setValue("prcopt/prn1", PrcOpt.prn[1]);
-    settings.setValue("prcopt/prn2", PrcOpt.prn[2]);
-    settings.setValue("prcopt/prn3", PrcOpt.prn[3]);
-    settings.setValue("prcopt/prn4", PrcOpt.prn[4]);
-    settings.setValue("prcopt/sclkstab", PrcOpt.sclkstab);
-    settings.setValue("prcopt/thresar", PrcOpt.thresar[0]);
-    settings.setValue("prcopt/elmaskar", PrcOpt.elmaskar);
-    settings.setValue("prcopt/elmaskhold", PrcOpt.elmaskhold);
-    settings.setValue("prcopt/thresslip", PrcOpt.thresslip);
-    settings.setValue("prcopt/maxtdiff", PrcOpt.maxtdiff);
-    settings.setValue("prcopt/maxgdop", PrcOpt.maxgdop);
-    settings.setValue("prcopt/maxinno", PrcOpt.maxinno);
-    settings.setValue("prcopt/syncsol", PrcOpt.syncsol);
-    settings.setValue("prcopt/exsats", ExSats);
-    settings.setValue("prcopt/navsys", PrcOpt.navsys);
-    settings.setValue("prcopt/posopt1", PrcOpt.posopt[0]);
-    settings.setValue("prcopt/posopt2", PrcOpt.posopt[1]);
-    settings.setValue("prcopt/posopt3", PrcOpt.posopt[2]);
-    settings.setValue("prcopt/posopt4", PrcOpt.posopt[3]);
-    settings.setValue("prcopt/posopt5", PrcOpt.posopt[4]);
-    settings.setValue("prcopt/posopt6", PrcOpt.posopt[5]);
-    settings.setValue("prcopt/maxaveep", PrcOpt.maxaveep);
-    settings.setValue("prcopt/initrst", PrcOpt.initrst);
-
-    settings.setValue("prcopt/baselinec", BaselineC);
-    settings.setValue("prcopt/baseline1", Baseline[0]);
-    settings.setValue("prcopt/baseline2", Baseline[1]);
-
-    settings.setValue("solopt/posf", SolOpt.posf);
-    settings.setValue("solopt/times", SolOpt.times);
-    settings.setValue("solopt/timef", SolOpt.timef);
-    settings.setValue("solopt/timeu", SolOpt.timeu);
-    settings.setValue("solopt/degf", SolOpt.degf);
-    settings.setValue("solopt/sep", SolOpt.sep);
-    settings.setValue("solopt/outhead", SolOpt.outhead);
-    settings.setValue("solopt/outopt", SolOpt.outopt);
-    settings.setValue("prcopt/outsingle", PrcOpt.outsingle);
-    settings.setValue("solopt/maxsolstd", SolOpt.maxsolstd);
-    settings.setValue("solopt/datum", SolOpt.datum);
-    settings.setValue("solopt/height", SolOpt.height);
-    settings.setValue("solopt/geoid", SolOpt.geoid);
-    settings.setValue("solopt/nmeaintv1", SolOpt.nmeaintv[0]);
-    settings.setValue("solopt/nmeaintv2", SolOpt.nmeaintv[1]);
-    settings.setValue("setting/debugstatus", DebugStatusF);
-    settings.setValue("setting/debugtrace", DebugTraceF);
-
-    settings.setValue("setting/rovpostype", RovPosTypeF);
-    settings.setValue("setting/refpostype", RefPosTypeF);
-    settings.setValue("setting/rovantpcv", RovAntPcvF);
-    settings.setValue("setting/refantpcv", RefAntPcvF);
-    settings.setValue("setting/rovant", RovAntF);
-    settings.setValue("setting/refant", RefAntF);
-    settings.setValue("setting/satpcvfile", SatPcvFileF);
-    settings.setValue("setting/antpcvfile", AntPcvFileF);
-    settings.setValue("setting/staposfile", StaPosFileF);
-    settings.setValue("setting/geoiddatafile", GeoidDataFileF);
-    settings.setValue("setting/dcbfile", DCBFileF);
-    settings.setValue("setting/eopfile", EOPFileF);
-    settings.setValue("setting/tlefile", TLEFileF);
-    settings.setValue("setting/tlesatfile", TLESatFileF);
-    settings.setValue("setting/localdirectory", LocalDirectory);
-
-    settings.setValue("setting/svrcycle", SvrCycle);
-    settings.setValue("setting/timeouttime", TimeoutTime);
-    settings.setValue("setting/recontime", ReconTime);
-    settings.setValue("setting/nmeacycle", NmeaCycle);
-    settings.setValue("setting/svrbuffsize", SvrBuffSize);
-    settings.setValue("setting/solbuffsize", SolBuffSize);
-    settings.setValue("setting/savedsol", SavedSol);
-    settings.setValue("setting/navselect", NavSelect);
-    settings.setValue("setting/sbassat", PrcOpt.sbassatsel);
-    settings.setValue("setting/dgpscorr", DgpsCorr);
-    settings.setValue("setting/sbascorr", SbasCorr);
-
-    settings.setValue("setting/nmeareq", NmeaReq);
-    settings.setValue("setting/intimetag", InTimeTag);
-    settings.setValue("setting/intimespeed", InTimeSpeed);
-    settings.setValue("setting/intimestart", InTimeStart);
-    settings.setValue("setting/intime64bit", InTime64Bit);
-    settings.setValue("setting/outtimetag", OutTimeTag);
-    settings.setValue("setting/outappend", OutAppend);
-    settings.setValue("setting/outswapinterval", OutSwapInterval);
-    settings.setValue("setting/logtimetag", LogTimeTag);
-    settings.setValue("setting/logappend", LogAppend);
-    settings.setValue("setting/logswapinterval", LogSwapInterval);
-    settings.setValue("setting/nmeapos1", NmeaPos[0]);
-    settings.setValue("setting/nmeapos2", NmeaPos[1]);
-    settings.setValue("setting/nmeapos3", NmeaPos[2]);
-    settings.setValue("setting/resetcmd", ResetCmd);
-    settings.setValue("setting/maxbl", MaxBL);
-    settings.setValue("setting/fswapmargin", FileSwapMargin);
+    }
+    for (i=0;i<3;i++) {
+        settings.setValue(QString("stream/rcvopt%1").arg(i+1),RcvOpt[i]);
+    }
+    for (i=0;i<3;i++) for (j=0;j<2;j++) {
+        Cmds[i][j].replace("\r\n","@@");
+        settings.setValue(QString("serial/cmd_%1_%2").arg(i).arg(j),Cmds  [i][j]);
+        settings.setValue(QString("serial/cmdena_%1_%2").arg(i).arg(j),CmdEna[i][j]);
+    }
+    for (i=0;i<3;i++) for (j=0;j<2;j++) {
+        CmdsTcp[i][j].replace("\r\n","@@");
+        settings.setValue (QString("tcpip/cmd_%1_%2").arg(i).arg(j),CmdsTcp  [i][j]);
+        settings.setValue(QString("tcpip/cmdena_%1_%2").arg(i).arg(j),CmdEnaTcp[i][j]);
+    }
+    settings.setValue("prcopt/mode",       PrcOpt.mode        );
+    settings.setValue("prcopt/nf",         PrcOpt.nf          );
+    settings.setValue("prcopt/elmin",      PrcOpt.elmin       );
+    settings.setValue("prcopt/snrmask_ena1",PrcOpt.snrmask.ena[0]);
+    settings.setValue("prcopt/snrmask_ena2",PrcOpt.snrmask.ena[1]);
+    for (i=0;i<NFREQ;i++) for (j=0;j<9;j++) {
+        settings.setValue(QString("prcopt/snrmask_%1_%2").arg(i+1).arg(j+1),
+                        PrcOpt.snrmask.mask[i][j]);
+    }
+    settings.setValue("prcopt/dynamics",   PrcOpt.dynamics    );
+    settings.setValue("prcopt/tidecorr",   PrcOpt.tidecorr    );
+    settings.setValue("prcopt/modear",     PrcOpt.modear      );
+    settings.setValue("prcopt/glomodear",  PrcOpt.glomodear   );
+    settings.setValue("prcopt/bdsmodear",  PrcOpt.bdsmodear   );
+    settings.setValue("prcopt/maxout",     PrcOpt.maxout      );
+    settings.setValue("prcopt/minlock",    PrcOpt.minlock     );
+    settings.setValue("prcopt/minfix",     PrcOpt.minfix      );
+    settings.setValue("prcopt/ionoopt",    PrcOpt.ionoopt     );
+    settings.setValue("prcopt/tropopt",    PrcOpt.tropopt     );
+    settings.setValue("prcopt/ephopt",     PrcOpt.sateph      );
+    settings.setValue("prcopt/niter",      PrcOpt.niter       );
+    settings.setValue("prcopt/eratio0",    PrcOpt.eratio[0]   );
+    settings.setValue("prcopt/eratio1",    PrcOpt.eratio[1]   );
+    settings.setValue("prcopt/err1",       PrcOpt.err[1]      );
+    settings.setValue("prcopt/err2",       PrcOpt.err[2]      );
+    settings.setValue("prcopt/err3",       PrcOpt.err[3]      );
+    settings.setValue("prcopt/err4",       PrcOpt.err[4]      );
+    settings.setValue("prcopt/prn0",       PrcOpt.prn[0]      );
+    settings.setValue("prcopt/prn1",       PrcOpt.prn[1]      );
+    settings.setValue("prcopt/prn2",       PrcOpt.prn[2]      );
+    settings.setValue("prcopt/prn3",       PrcOpt.prn[3]      );
+    settings.setValue("prcopt/prn4",       PrcOpt.prn[4]      );
+    settings.setValue("prcopt/sclkstab",   PrcOpt.sclkstab    );
+    settings.setValue("prcopt/thresar",    PrcOpt.thresar[0]  );
+    settings.setValue("prcopt/elmaskar",   PrcOpt.elmaskar    );
+    settings.setValue("prcopt/elmaskhold", PrcOpt.elmaskhold  );
+    settings.setValue("prcopt/thresslip",  PrcOpt.thresslip   );
+    settings.setValue("prcopt/maxtdiff",   PrcOpt.maxtdiff    );
+    settings.setValue("prcopt/maxgdop",    PrcOpt.maxgdop     );
+    settings.setValue("prcopt/maxinno",    PrcOpt.maxinno     );
+    settings.setValue("prcopt/syncsol",    PrcOpt.syncsol     );
+    settings.setValue("prcopt/exsats",     ExSats             );
+    settings.setValue("prcopt/navsys",     PrcOpt.navsys      );
+    settings.setValue("prcopt/posopt1",    PrcOpt.posopt[0]   );
+    settings.setValue("prcopt/posopt2",    PrcOpt.posopt[1]   );
+    settings.setValue("prcopt/posopt3",    PrcOpt.posopt[2]   );
+    settings.setValue("prcopt/posopt4",    PrcOpt.posopt[3]   );
+    settings.setValue("prcopt/posopt5",    PrcOpt.posopt[4]   );
+    settings.setValue("prcopt/posopt6",    PrcOpt.posopt[5]   );
+    settings.setValue("prcopt/maxaveep",   PrcOpt.maxaveep    );
+    settings.setValue("prcopt/initrst",    PrcOpt.initrst     );
 
-    settings.setValue("setting/timesys", TimeSys);
-    settings.setValue("setting/soltype", SolType);
-    settings.setValue("setting/plottype", PlotType[0]);
-    settings.setValue("setting/plottype2", PlotType[1]);
-    settings.setValue("setting/plottype3", PlotType[2]);
-    settings.setValue("setting/plottype4", PlotType[3]);
-    settings.setValue("setting/panelmode", PanelMode);
-    settings.setValue("setting/proxyaddr", ProxyAddr);
-    settings.setValue("setting/moniport", MoniPort);
-    settings.setValue("setting/panelstack", PanelStack);
-    settings.setValue("setting/trktype1", TrkType[0]);
-    settings.setValue("setting/trktype2", TrkType[1]);
-    settings.setValue("setting/trktype3", TrkType[2]);
-    settings.setValue("setting/trktype4", TrkType[3]);
-    settings.setValue("setting/trkscale1", TrkScale[0]);
-    settings.setValue("setting/trkscale2", TrkScale[1]);
-    settings.setValue("setting/trkscale3", TrkScale[2]);
-    settings.setValue("setting/trkscale4", TrkScale[3]);
-    settings.setValue("setting/freqtype1", FreqType1);
-    settings.setValue("setting/freqtype2", FreqType2);
-    settings.setValue("setting/freqtype3", FreqType3);
-    settings.setValue("setting/freqtype4", FreqType4);
-    settings.setValue("setting/blmode1", BLMode[0]);
-    settings.setValue("setting/blmode2", BLMode[1]);
-    settings.setValue("setting/blmode3", BLMode[2]);
-    settings.setValue("setting/blmode4", BLMode[3]);
-    settings.setValue("setting/markername", MarkerName);
-    settings.setValue("setting/markercomment", MarkerComment);
+    settings.setValue("prcopt/baselinec",  BaselineC          );
+    settings.setValue("prcopt/baseline1",  Baseline[0]        );
+    settings.setValue("prcopt/baseline2",  Baseline[1]        );
+    
+    settings.setValue("solopt/posf",       SolOpt.posf        );
+    settings.setValue("solopt/times",      SolOpt.times       );
+    settings.setValue("solopt/timef",      SolOpt.timef       );
+    settings.setValue("solopt/timeu",      SolOpt.timeu       );
+    settings.setValue("solopt/degf",       SolOpt.degf        );
+    settings.setValue("solopt/sep",        SolOpt.sep         );
+    settings.setValue("solopt/outhead",    SolOpt.outhead     );
+    settings.setValue("solopt/outopt",     SolOpt.outopt      );
+    settings.setValue("solopt/datum",      SolOpt.datum       );
+    settings.setValue("solopt/height",     SolOpt.height      );
+    settings.setValue("solopt/geoid",      SolOpt.geoid       );
+    settings.setValue("solopt/nmeaintv1",  SolOpt.nmeaintv[0] );
+    settings.setValue("solopt/nmeaintv2",  SolOpt.nmeaintv[1] );
+    settings.setValue("setting/debugstatus",DebugStatusF       );
+    settings.setValue("setting/debugtrace", DebugTraceF        );
+    
+    settings.setValue("setting/rovpostype", RovPosTypeF        );
+    settings.setValue("setting/refpostype", RefPosTypeF        );
+    settings.setValue("setting/rovantpcv",  RovAntPcvF         );
+    settings.setValue("setting/refantpcv",  RefAntPcvF         );
+    settings.setValue("setting/rovant",     RovAntF            );
+    settings.setValue("setting/refant",     RefAntF            );
+    settings.setValue("setting/satpcvfile", SatPcvFileF        );
+    settings.setValue("setting/antpcvfile", AntPcvFileF        );
+    settings.setValue("setting/staposfile", StaPosFileF        );
+    settings.setValue("setting/geoiddatafile",GeoidDataFileF   );
+    settings.setValue("setting/dcbfile",    DCBFileF           );
+    settings.setValue("setting/eopfile",    EOPFileF           );
+    settings.setValue("setting/tlefile",    TLEFileF           );
+    settings.setValue("setting/tlesatfile", TLESatFileF        );
+    settings.setValue("setting/localdirectory",LocalDirectory  );
+    
+    settings.setValue("setting/svrcycle",   SvrCycle           );
+    settings.setValue("setting/timeouttime",TimeoutTime        );
+    settings.setValue("setting/recontime",  ReconTime          );
+    settings.setValue("setting/nmeacycle",  NmeaCycle          );
+    settings.setValue("setting/svrbuffsize",SvrBuffSize        );
+    settings.setValue("setting/solbuffsize",SolBuffSize        );
+    settings.setValue("setting/savedsol",   SavedSol           );
+    settings.setValue("setting/navselect",  NavSelect          );
+    settings.setValue("setting/sbassat",    PrcOpt.sbassatsel  );
+    settings.setValue("setting/dgpscorr",   DgpsCorr           );
+    settings.setValue("setting/sbascorr",   SbasCorr           );
+    
+    settings.setValue("setting/nmeareq",    NmeaReq            );
+    settings.setValue("setting/intimetag",  InTimeTag          );
+    settings.setValue("setting/intimespeed",InTimeSpeed        );
+    settings.setValue("setting/intimestart",InTimeStart        );
+    settings.setValue("setting/outtimetag", OutTimeTag         );
+    settings.setValue("setting/outappend",  OutAppend          );
+    settings.setValue("setting/outswapinterval",OutSwapInterval);
+    settings.setValue("setting/logtimetag", LogTimeTag         );
+    settings.setValue("setting/logappend",  LogAppend          );
+    settings.setValue("setting/logswapinterval",LogSwapInterval);
+    settings.setValue("setting/nmeapos1",   NmeaPos[0]         );
+    settings.setValue("setting/nmeapos2",   NmeaPos[1]         );
+    settings.setValue("setting/fswapmargin",FileSwapMargin     );
+    
+    settings.setValue("setting/timesys",    TimeSys            );
+    settings.setValue("setting/soltype",    SolType            );
+    settings.setValue("setting/plottype",   PlotType1          );
+    settings.setValue("setting/plottype2",  PlotType2          );
+    settings.setValue("setting/panelmode",  PanelMode          );
+    settings.setValue("setting/proxyaddr",  ProxyAddr          );
+    settings.setValue("setting/moniport",   MoniPort           );
+    settings.setValue("setting/panelstack", PanelStack         );
+    settings.setValue("setting/trktype1",   TrkType1           );
+    settings.setValue("setting/trktype2",   TrkType2           );
+    settings.setValue("setting/trkscale1",  TrkScale1          );
+    settings.setValue("setting/trkscale2",  TrkScale2          );
+    settings.setValue("setting/blmode1",    BLMode1            );
+    settings.setValue("setting/blmode2",    BLMode2            );
+    settings.setValue("setting/markername", MarkerName         );
+    settings.setValue("setting/markercomment",MarkerComment    );
 
-    for (i = 0; i < 3; i++) {
-        settings.setValue(QString("setting/rovantdel_%1").arg(i), RovAntDel[i]);
-        settings.setValue(QString("setting/refantdel_%1").arg(i), RefAntDel[i]);
-        settings.setValue(QString("setting/rovpos_%1").arg(i), RovPos[i]);
-        settings.setValue(QString("setting/refpos_%1").arg(i), RefPos[i]);
+    for (i=0;i<3;i++) {
+        settings.setValue(QString("setting/rovantdel_%1").arg(i),RovAntDel[i]);
+        settings.setValue(QString("setting/refantdel_%1").arg(i),RefAntDel[i]);
+        settings.setValue(QString("setting/rovpos_%1").arg(i),   RovPos[i]);
+        settings.setValue(QString("setting/refpos_%1").arg(i),   RefPos[i]);
     }
-    for (i = 0; i < 10; i++)
-        settings.setValue(QString("tcpopt/history%1").arg(i), History [i]);
-    for (i = 0; i < 10; i++)
-        settings.setValue(QString("tcpopt/mntphist%1").arg(i), MntpHist[i]);
-    settings.setValue("mapopt/nmappnt", NMapPnt);
-    for (i = 0; i < NMapPnt; i++) {
-        settings.setValue(QString("mapopt/pntname%1").arg(i + 1), PntName[i]);
-        settings.setValue(QString("mapopt/pntpos%1").arg(i + 1),
-                  QString("%1,%2,%3").arg(PntPos[i][0], 0, 'f', 4).arg(PntPos[i][1], 0, 'f', 4).arg(PntPos[i][2], 0, 'f', 4));
+    for (i=0;i<10;i++) {
+        settings.setValue(QString("tcpopt/history%1").arg(i),History [i]);
     }
-    settings.setValue("setting/posfontname", PosFont.family());
-    settings.setValue("setting/posfontsize", PosFont.pointSize());
+    for (i=0;i<10;i++) {
+        settings.setValue(QString("tcpopt/mntphist%1").arg(i),MntpHist[i]);
+    }
+    settings.setValue("mapopt/nmappnt",NMapPnt);
+    for (i=0;i<NMapPnt;i++) {
+        settings.setValue(QString("mapopt/pntname%1").arg(i+1),PntName[i]);
+        settings.setValue(QString("mapopt/pntpos%1").arg(i+1),
+            QString("%1,%2,%3").arg(PntPos[i][0],0,'f',4).arg(PntPos[i][1],0,'f',4).arg(PntPos[i][2],0,'f',4));
+    }
+    settings.setValue("setting/posfontname", PosFont.family()    );
+    settings.setValue("setting/posfontsize", PosFont.pointSize()    );
 //    settings.setValue("setting/posfontcolor",(int)PosFont->Color);
-    settings.setValue("setting/posfontbold", PosFont.bold());
-    settings.setValue("setting/posfontitalic", PosFont.italic());
-
-    settings.setValue("viewer/color1", static_cast<int>(TextViewer::Color1.rgb()));
-    settings.setValue("viewer/color2", static_cast<int>(TextViewer::Color2.rgb()));
-    settings.setValue("viewer/fontname", TextViewer::FontD.family());
-    settings.setValue("viewer/fontsize", TextViewer::FontD.pointSize());
+    settings.setValue("setting/posfontbold",  PosFont.bold());
+    settings.setValue("setting/posfontitalic",PosFont.italic());
 
-    settings.setValue("window/width", size().width());
-    settings.setValue("window/height", size().height());
+    settings.setValue("viewer/color1",  static_cast<int>(TextViewer::Color1.rgb()));
+    settings.setValue("viewer/color2",  static_cast<int>(TextViewer::Color2.rgb()));
+    settings.setValue("viewer/fontname",TextViewer::FontD.family());
+    settings.setValue("viewer/fontsize",TextViewer::FontD.pointSize());
+    
+    settings.setValue("window/width",    size().width());
+    settings.setValue("window/height",   size().height());
 
-    settings.setValue("window/splitpos", splitter->saveState());
+    settings.setValue("window/splitpos",Splitter1->saveState());
+    settings.setValue("window/splitpos2",Splitter2->saveState());
 }
 //---------------------------------------------------------------------------
 void MainWindow::BtnMarkClick()
 {
-    QMarkDialog *markDialog = new QMarkDialog(this);
-
-    markDialog->PosMode = rtksvr.rtk.opt.mode;
-    markDialog->Marker = MarkerName;
-    markDialog->Comment = MarkerComment;
+    QMarkDialog *markDialog=new QMarkDialog(this);
+    markDialog->PosMode=rtksvr.rtk.opt.mode;
+    markDialog->Marker=MarkerName;
+    markDialog->Comment=MarkerComment;
 
-    if (markDialog->exec() != QDialog::Accepted) return;
-    rtksvr.rtk.opt.mode = markDialog->PosMode;
-    MarkerName = markDialog->Marker;
-    MarkerComment = markDialog->Comment;
+    if (markDialog->exec()!=QDialog::Accepted) return;
+    rtksvr.rtk.opt.mode=markDialog->PosMode;
+    MarkerName=markDialog->Marker;
+    MarkerComment=markDialog->Comment;
 
     delete markDialog;
-
-    updatesEnabled();
 }
 //---------------------------------------------------------------------------
+
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/navimain.h RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/navimain.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/navimain.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/navimain.h	2019-08-19 02:04:50.000000000 +0300
@@ -32,156 +32,141 @@
     ~MainWindow();
 
 public slots:	
-    void TimerTimer();
+    void  TimerTimer        ();
 	
-    void BtnStartClick();
-    void BtnStopClick();
-    void BtnPlotClick();
-    void BtnOptClick();
-    void BtnExitClick();
+    void  BtnStartClick     ();
+    void  BtnStopClick      ();
+    void  BtnPlotClick      ();
+    void  BtnOptClick       ();
+    void  BtnExitClick      ();
 	
-    void BtnTimeSysClick();
-    void BtnInputStrClick();
-    void BtnOutputStrClick();
-    void BtnLogStrClick();
-    void BtnSolTypeClick();
-    void BtnPlotType1Click();
+    void  BtnTimeSysClick   ();
+    void  BtnInputStrClick  ();
+    void  BtnOutputStrClick ();
+    void  BtnLogStrClick    ();
+    void  BtnSolTypeClick   ();
+    void  BtnPlotType1Click  ();
 	
-    void BtnMonitorClick();
-    void BtnSaveClick();
-    void BtnAboutClick();
-    void BtnTaskTrayClick();
+    void  BtnMonitorClick   ();
+    void  BtnSaveClick      ();
+    void  BtnAboutClick     ();
+    void  BtnTaskTrayClick  ();
 	
-    void MenuExpandClick();
-    void MenuStartClick();
-    void MenuStopClick();
-    void MenuPlotClick();
-    void MenuMonitorClick();
-    void MenuExitClick();
-    void ScbSolChange();
+    void  MenuExpandClick   ();
+    void  MenuStartClick    ();
+    void  MenuStopClick     ();
+    void  MenuPlotClick     ();
+    void  MenuMonitorClick  ();
+    void  MenuExitClick     ();
 	
-    void TrayIconClick(QSystemTrayIcon::ActivationReason);
-    void BtnFreqType1Click();
-    void BtnPanelClick();
-    void BtnPlotType2Click();
-    void BtnFreqType2Click();
-    void BtnPlotType3Click();
-    void BtnFreqType3Click();
-    void BtnPlotType4Click();
-    void BtnFreqType4Click();
-    void BtnExpand1Click();
-    void BtnShrink1Click();
-    void BtnExpand2Click();
-    void BtnShrink2Click();
-    void BtnExpand3Click();
-    void BtnShrink3Click();
-    void BtnExpand4Click();
-    void BtnShrink4Click();
-    void BtnMarkClick();
-
+    void  ScbSolChange      ();
+	
+    void  TrayIconClick  (QSystemTrayIcon::ActivationReason);
+    void  BtnFreqType1Click();
+    void  BtnPanelClick();
+    void  BtnPlotType2Click();
+    void  BtnFreqType2Click();
+    void  BtnExpand1Click();
+    void  BtnShrink1Click();
+    void  BtnExpand2Click();
+    void  BtnShrink2Click();
+    void  BtnMarkClick();
 protected:
-    void showEvent(QShowEvent*);
-    void closeEvent(QCloseEvent *);
+    void  showEvent         (QShowEvent*);
+    void  closeEvent        (QCloseEvent *);
 
 private:
     tle_t TLEData;
 
     AboutDialog *aboutDialog;
+    OptDialog *optDialog;
     InputStrDialog *inputStrDialog;
     OutputStrDialog *outputStrDialog;
     LogStrDialog *logStrDialog;
     MonitorDialog *monitor;
     QSystemTrayIcon *systemTray;
-    QMenu *trayMenu;
-    QAction *MenuStartAction, *MenuStopAction, *MenuExitAction;
+    QMenu * trayMenu;
+    QAction *MenuStartAction,*MenuStopAction,*MenuExitAction;
 
-    void  UpdateLog (int stat, gtime_t time, double *rr, float *qr,
-                     double *rb, int ns, double age, double ratio);
-    void SvrStart(void);
-    void SvrStop(void);
-    void UpdatePanel(void);
-    void UpdateTimeSys(void);
-    void UpdateSolType(void);
-    void UpdateFont(void);
-    void UpdateTime(void);
-    void UpdatePos(void);
-    void UpdateStr(void);
-    void DrawPlot(QLabel *plot, int no);
-    void UpdatePlot(void);
-    void UpdateEnable(void);
-    void ChangePlot(void);
-    int ConfOverwrite(const QString &path);
+    void  UpdateLog    (int stat, gtime_t time, double *rr, float *qr,
+								  double *rb, int ns, double age, double ratio);
+    void  SvrStart     (void);
+    void  SvrStop      (void);
+    void  UpdatePanel  (void);
+    void  UpdateTimeSys(void);
+    void  UpdateSolType(void);
+    void  UpdateFont   (void);
+    void  UpdateTime   (void);
+    void  UpdatePos    (void);
+    void  UpdateStr    (void);
+    void  DrawPlot     (QLabel *plot, int type, int freq);
+    void  UpdatePlot   (void);
+    void  UpdateEnable (void);
+    void  ChangePlot   (void);
+    int   ConfOverwrite(const QString &path);
 	
-    void DrawSnr(QPainter *c, int w, int h, int x0, int y0, int index, int freq);
-    void DrawSat(QPainter *c, int w, int h, int x0, int y0, int index, int freq);
-    void DrawBL(QPainter *c, int no, int w, int h);
-    void DrawTrk(QPainter *c, int no, QPixmap &plot);
-    void DrawSky(QPainter *c, int w, int h, int x0, int y0);
-    void DrawText(QPainter *c, int x, int y, const QString &s,
-                   const QColor &color, int align);
-    void DrawArrow    (QPainter *c, int x, int y, int siz,
+    void  DrawSnr      (QPainter *c, int w, int h, int x0, int y0, int index, int freq);
+    void  DrawSat      (QPainter *c, int w, int h, int x0, int y0, int index, int freq);
+    void  DrawBL       (QPainter *c, QLabel *disp, int w, int h);
+    void  DrawTrk      (QPainter *c, QLabel *disp, QPixmap &plot);
+    void  DrawSky      (QPainter *c, int w, int h, int x0, int y0);
+    void  DrawText     (QPainter *c, int x, int y, const QString &s,
+                                  const QColor &color, int align);
+    void  DrawArrow    (QPainter *c, int x, int y, int siz,
                                   int ang, const QColor &color);
-    void OpenMoniPort(int port);
-    void InitSolBuff(void);
-    void SaveLog(void);
-    void LoadNav(nav_t *nav);
-    void SaveNav(nav_t *nav);
-    void LoadOpt(void);
-    void SaveOpt(void);
-    void SetTrayIcon(int index);
-    int ExecCmd(const QString &cmd, int show);
-    void BtnFreqTypeChange(int i);
-    QColor SnrColor(int snr);
+    void  OpenMoniPort (int port);
+    void  InitSolBuff  (void);
+    void  SaveLog      (void);
+    void  LoadNav      (nav_t *nav);
+    void  SaveNav      (nav_t *nav);
+    void  LoadOpt      (void);
+    void  SaveOpt      (void);
+    void  SetTrayIcon  (int index);
+    int   ExecCmd      (const QString &cmd, int show);
+    QColor  SnrColor   (int snr);
 public:
-    OptDialog *optDialog;
     QString IniFile;
 	
-    int PanelStack, PanelMode;
-    int SvrCycle, SvrBuffSize, Scale, SolBuffSize, NavSelect, SavedSol;
-
-    int NmeaReq,NmeaCycle,InTimeTag,InTime64Bit;
-    int OutTimeTag,OutAppend,LogTimeTag,LogAppend;
-    int TimeoutTime, ReconTime, SbasCorr, DgpsCorr, TideCorr, FileSwapMargin;
-    int Stream[MAXSTRRTK], StreamC[MAXSTRRTK], Format[MAXSTRRTK];
-    int CmdEna[3][3], CmdEnaTcp[3][3];
-    int TimeSys,SolType;
-    int PlotType[4],FreqType[4];
-    int TrkType[4];
-    int TrkScale[4];
-    int BLMode[4];
-    int FreqType1,FreqType2,FreqType3,FreqType4;
-    int MoniPort, OpenPort;
+	int PanelStack,PanelMode;
+	int SvrCycle,SvrBuffSize,Scale,SolBuffSize,NavSelect,SavedSol;
+	int NmeaReq,NmeaCycle,InTimeTag,OutTimeTag,OutAppend,LogTimeTag,LogAppend;
+	int TimeoutTime,ReconTime,SbasCorr,DgpsCorr,TideCorr,FileSwapMargin;
+	int Stream[MAXSTRRTK],StreamC[MAXSTRRTK],Format[MAXSTRRTK];
+	int CmdEna[3][2],CmdEnaTcp[3][2];
+	int TimeSys,SolType,PlotType1,FreqType1,PlotType2,FreqType2;
+    int TrkType1,TrkType2,TrkScale1,TrkScale2,BLMode1,BLMode2;
+	int MoniPort,OpenPort;
 	
-    int PSol, PSolS, PSolE, Nsat[2], SolCurrentStat;
-    int Sat[2][MAXSAT], Snr[2][MAXSAT][NFREQ], Vsat[2][MAXSAT];
-    double Az[2][MAXSAT], El[2][MAXSAT];
+	int PSol,PSolS,PSolE,Nsat[2],SolCurrentStat;
+	int Sat[2][MAXSAT],Snr[2][MAXSAT][NFREQ],Vsat[2][MAXSAT];
+	double Az[2][MAXSAT],El[2][MAXSAT];
 	gtime_t *Time;
-    int *SolStat, *Nvsat;
-    double *SolRov, *SolRef, *Qr, *VelRov, *Age, *Ratio;
-    double TrkOri[3], MaxBL;
+	int *SolStat,*Nvsat;
+	double *SolRov,*SolRef,*Qr,*VelRov,*Age,*Ratio;
+    double TrkOri[3];
 
-    QString Paths[MAXSTRRTK][4], Cmds[3][3], CmdsTcp[3][3];
-    QString InTimeStart, InTimeSpeed, ExSats;
-    QString RcvOpt[3], ProxyAddr;
-    QString OutSwapInterval, LogSwapInterval, ResetCmd;
+    QString Paths[MAXSTRRTK][4],Cmds[3][2],CmdsTcp[3][2];
+    QString InTimeStart,InTimeSpeed,ExSats;
+    QString RcvOpt[3],ProxyAddr;
+    QString OutSwapInterval,LogSwapInterval;
 
 	prcopt_t PrcOpt;
 	solopt_t SolOpt;
 
     QFont PosFont;
 
-    int DebugTraceF, DebugStatusF, OutputGeoidF, BaselineC;
-    int RovPosTypeF, RefPosTypeF, RovAntPcvF, RefAntPcvF;
-    QString RovAntF, RefAntF, SatPcvFileF, AntPcvFileF;
-    double RovAntDel[3], RefAntDel[3], RovPos[3], RefPos[3], NmeaPos[3];
+	int DebugTraceF,DebugStatusF,OutputGeoidF,BaselineC;
+    int RovPosTypeF,RefPosTypeF,RovAntPcvF,RefAntPcvF;
+    QString RovAntF,RefAntF,SatPcvFileF,AntPcvFileF;
+	double RovAntDel[3],RefAntDel[3],RovPos[3],RefPos[3],NmeaPos[2];
 	double Baseline[2];
 
-    QString History[10], MntpHist[10];
+    QString History[10],MntpHist[10];
 
     QTimer Timer;
 	
-    QString GeoidDataFileF, StaPosFileF, DCBFileF, EOPFileF, TLEFileF;
-    QString TLESatFileF, LocalDirectory, PntName[MAXMAPPNT];
+    QString GeoidDataFileF,StaPosFileF,DCBFileF,EOPFileF,TLEFileF;
+    QString TLESatFileF,LocalDirectory,PntName[MAXMAPPNT];
 
 	double PntPos[MAXMAPPNT][3];
 	int NMapPnt;
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/navimain.ui RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/navimain.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/navimain.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/navimain.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>740</width>
-    <height>438</height>
+    <width>646</width>
+    <height>323</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -50,6 +50,9 @@
       <string/>
      </property>
      <layout class="QHBoxLayout" name="horizontalLayout_8">
+      <property name="spacing">
+       <number>0</number>
+      </property>
       <property name="leftMargin">
        <number>0</number>
       </property>
@@ -77,7 +80,7 @@
          <string/>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
           <normaloff>:/buttons/sqr.bmp</normaloff>:/buttons/sqr.bmp</iconset>
         </property>
         <property name="flat">
@@ -148,6 +151,9 @@
          <string/>
         </property>
         <layout class="QHBoxLayout" name="horizontalLayout_7">
+         <property name="spacing">
+          <number>0</number>
+         </property>
          <property name="leftMargin">
           <number>0</number>
          </property>
@@ -186,245 +192,224 @@
           </widget>
          </item>
          <item>
-          <widget class="QWidget" name="widget" native="true">
-           <layout class="QHBoxLayout" name="horizontalLayout_10">
-            <property name="spacing">
-             <number>0</number>
-            </property>
-            <property name="leftMargin">
-             <number>0</number>
-            </property>
-            <property name="topMargin">
-             <number>0</number>
-            </property>
-            <property name="rightMargin">
-             <number>0</number>
-            </property>
-            <property name="bottomMargin">
-             <number>0</number>
-            </property>
-            <item>
-             <widget class="QLabel" name="Str1">
-              <property name="enabled">
-               <bool>true</bool>
-              </property>
-              <property name="maximumSize">
-               <size>
-                <width>16777215</width>
-                <height>20</height>
-               </size>
-              </property>
-              <property name="toolTip">
-               <string/>
-              </property>
-              <property name="frameShape">
-               <enum>QFrame::Box</enum>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QLabel" name="Str2">
-              <property name="enabled">
-               <bool>true</bool>
-              </property>
-              <property name="maximumSize">
-               <size>
-                <width>16777215</width>
-                <height>20</height>
-               </size>
-              </property>
-              <property name="toolTip">
-               <string/>
-              </property>
-              <property name="frameShape">
-               <enum>QFrame::Box</enum>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QLabel" name="Str3">
-              <property name="enabled">
-               <bool>true</bool>
-              </property>
-              <property name="maximumSize">
-               <size>
-                <width>16777215</width>
-                <height>20</height>
-               </size>
-              </property>
-              <property name="toolTip">
-               <string/>
-              </property>
-              <property name="frameShape">
-               <enum>QFrame::Box</enum>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QLabel" name="Image1">
-              <property name="enabled">
-               <bool>true</bool>
-              </property>
-              <property name="sizePolicy">
-               <sizepolicy hsizetype="Fixed" vsizetype="Ignored">
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
-              </property>
-              <property name="maximumSize">
-               <size>
-                <width>16777215</width>
-                <height>20</height>
-               </size>
-              </property>
-              <property name="toolTip">
-               <string/>
-              </property>
-              <property name="pixmap">
-               <pixmap resource="../rtkconv_qt/rtkconv_qt.qrc">:/buttons/rarrow.bmp</pixmap>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QLabel" name="Svr">
-              <property name="enabled">
-               <bool>true</bool>
-              </property>
-              <property name="maximumSize">
-               <size>
-                <width>16777215</width>
-                <height>20</height>
-               </size>
-              </property>
-              <property name="toolTip">
-               <string/>
-              </property>
-              <property name="frameShape">
-               <enum>QFrame::Box</enum>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QLabel" name="Image2">
-              <property name="enabled">
-               <bool>true</bool>
-              </property>
-              <property name="sizePolicy">
-               <sizepolicy hsizetype="Fixed" vsizetype="Ignored">
-                <horstretch>0</horstretch>
-                <verstretch>0</verstretch>
-               </sizepolicy>
-              </property>
-              <property name="maximumSize">
-               <size>
-                <width>16777215</width>
-                <height>20</height>
-               </size>
-              </property>
-              <property name="toolTip">
-               <string/>
-              </property>
-              <property name="pixmap">
-               <pixmap resource="../rtkconv_qt/rtkconv_qt.qrc">:/buttons/rarrow.bmp</pixmap>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QLabel" name="Str4">
-              <property name="enabled">
-               <bool>true</bool>
-              </property>
-              <property name="maximumSize">
-               <size>
-                <width>16777215</width>
-                <height>20</height>
-               </size>
-              </property>
-              <property name="toolTip">
-               <string/>
-              </property>
-              <property name="frameShape">
-               <enum>QFrame::Box</enum>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QLabel" name="Str5">
-              <property name="enabled">
-               <bool>true</bool>
-              </property>
-              <property name="maximumSize">
-               <size>
-                <width>16777215</width>
-                <height>20</height>
-               </size>
-              </property>
-              <property name="toolTip">
-               <string/>
-              </property>
-              <property name="frameShape">
-               <enum>QFrame::Box</enum>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QLabel" name="Str6">
-              <property name="enabled">
-               <bool>true</bool>
-              </property>
-              <property name="maximumSize">
-               <size>
-                <width>16777215</width>
-                <height>20</height>
-               </size>
-              </property>
-              <property name="toolTip">
-               <string/>
-              </property>
-              <property name="frameShape">
-               <enum>QFrame::Box</enum>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QLabel" name="Str7">
-              <property name="enabled">
-               <bool>true</bool>
-              </property>
-              <property name="maximumSize">
-               <size>
-                <width>16777215</width>
-                <height>20</height>
-               </size>
-              </property>
-              <property name="toolTip">
-               <string/>
-              </property>
-              <property name="frameShape">
-               <enum>QFrame::Box</enum>
-              </property>
-             </widget>
-            </item>
-            <item>
-             <widget class="QLabel" name="Str8">
-              <property name="enabled">
-               <bool>true</bool>
-              </property>
-              <property name="maximumSize">
-               <size>
-                <width>16777215</width>
-                <height>20</height>
-               </size>
-              </property>
-              <property name="toolTip">
-               <string/>
-              </property>
-              <property name="frameShape">
-               <enum>QFrame::Box</enum>
-              </property>
-             </widget>
-            </item>
-           </layout>
+          <widget class="QLabel" name="Str1">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="maximumSize">
+            <size>
+             <width>16777215</width>
+             <height>20</height>
+            </size>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="frameShape">
+            <enum>QFrame::Box</enum>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QLabel" name="Str2">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="maximumSize">
+            <size>
+             <width>16777215</width>
+             <height>20</height>
+            </size>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="frameShape">
+            <enum>QFrame::Box</enum>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QLabel" name="Str3">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="maximumSize">
+            <size>
+             <width>16777215</width>
+             <height>20</height>
+            </size>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="frameShape">
+            <enum>QFrame::Box</enum>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QLabel" name="Image1">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="sizePolicy">
+            <sizepolicy hsizetype="Fixed" vsizetype="Ignored">
+             <horstretch>0</horstretch>
+             <verstretch>0</verstretch>
+            </sizepolicy>
+           </property>
+           <property name="maximumSize">
+            <size>
+             <width>16777215</width>
+             <height>20</height>
+            </size>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="pixmap">
+            <pixmap resource="../rtkpost_qt/rtkpost_qt.qrc">:/buttons/rarrow.bmp</pixmap>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QLabel" name="Svr">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="maximumSize">
+            <size>
+             <width>16777215</width>
+             <height>20</height>
+            </size>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="frameShape">
+            <enum>QFrame::Box</enum>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QLabel" name="Image2">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="sizePolicy">
+            <sizepolicy hsizetype="Fixed" vsizetype="Ignored">
+             <horstretch>0</horstretch>
+             <verstretch>0</verstretch>
+            </sizepolicy>
+           </property>
+           <property name="maximumSize">
+            <size>
+             <width>16777215</width>
+             <height>20</height>
+            </size>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="pixmap">
+            <pixmap resource="../rtkpost_qt/rtkpost_qt.qrc">:/buttons/rarrow.bmp</pixmap>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QLabel" name="Str4">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="maximumSize">
+            <size>
+             <width>16777215</width>
+             <height>20</height>
+            </size>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="frameShape">
+            <enum>QFrame::Box</enum>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QLabel" name="Str5">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="maximumSize">
+            <size>
+             <width>16777215</width>
+             <height>20</height>
+            </size>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="frameShape">
+            <enum>QFrame::Box</enum>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QLabel" name="Str6">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="maximumSize">
+            <size>
+             <width>16777215</width>
+             <height>20</height>
+            </size>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="frameShape">
+            <enum>QFrame::Box</enum>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QLabel" name="Str7">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="maximumSize">
+            <size>
+             <width>16777215</width>
+             <height>20</height>
+            </size>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="frameShape">
+            <enum>QFrame::Box</enum>
+           </property>
+          </widget>
+         </item>
+         <item>
+          <widget class="QLabel" name="Str8">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="maximumSize">
+            <size>
+             <width>16777215</width>
+             <height>20</height>
+            </size>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="frameShape">
+            <enum>QFrame::Box</enum>
+           </property>
           </widget>
          </item>
          <item>
@@ -567,7 +552,7 @@
          <string/>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
           <normaloff>:/buttons/down.bmp</normaloff>:/buttons/down.bmp</iconset>
         </property>
         <property name="flat">
@@ -590,8 +575,23 @@
       <string/>
      </property>
      <layout class="QHBoxLayout" name="horizontalLayout_9">
+      <property name="spacing">
+       <number>0</number>
+      </property>
+      <property name="leftMargin">
+       <number>0</number>
+      </property>
+      <property name="topMargin">
+       <number>0</number>
+      </property>
+      <property name="rightMargin">
+       <number>0</number>
+      </property>
+      <property name="bottomMargin">
+       <number>0</number>
+      </property>
       <item>
-       <widget class="QSplitter" name="splitter">
+       <widget class="QSplitter" name="Splitter1">
         <property name="orientation">
          <enum>Qt::Horizontal</enum>
         </property>
@@ -1265,7 +1265,7 @@
              <string/>
             </property>
             <property name="icon">
-             <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+             <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
               <normaloff>:/buttons/down.bmp</normaloff>:/buttons/down.bmp</iconset>
             </property>
             <property name="flat">
@@ -1291,6 +1291,9 @@
              <string/>
             </property>
             <layout class="QHBoxLayout" name="horizontalLayout_5">
+             <property name="spacing">
+              <number>0</number>
+             </property>
              <property name="leftMargin">
               <number>0</number>
              </property>
@@ -1368,512 +1371,232 @@
          <property name="text" stdset="0">
           <string/>
          </property>
-         <layout class="QGridLayout" name="gridLayout_2">
-          <property name="leftMargin">
-           <number>0</number>
-          </property>
-          <property name="topMargin">
-           <number>0</number>
-          </property>
-          <property name="rightMargin">
-           <number>0</number>
-          </property>
-          <property name="bottomMargin">
-           <number>0</number>
-          </property>
-          <property name="spacing">
-           <number>0</number>
-          </property>
-          <item row="1" column="0" colspan="5">
-           <widget class="QLabel" name="Disp1">
-            <property name="enabled">
-             <bool>true</bool>
-            </property>
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Ignored" vsizetype="Ignored">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="toolTip">
-             <string/>
-            </property>
-           </widget>
-          </item>
-          <item row="0" column="4">
-           <widget class="QPushButton" name="BtnPlotType1">
-            <property name="enabled">
-             <bool>true</bool>
-            </property>
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="toolTip">
-             <string/>
-            </property>
-            <property name="icon">
-             <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-              <normaloff>:/buttons/down.bmp</normaloff>:/buttons/down.bmp</iconset>
-            </property>
-            <property name="flat">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item row="0" column="3">
-           <widget class="QPushButton" name="BtnFreqType1">
-            <property name="enabled">
-             <bool>true</bool>
-            </property>
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="toolTip">
-             <string/>
-            </property>
-            <property name="icon">
-             <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-              <normaloff>:/buttons/down.bmp</normaloff>:/buttons/down.bmp</iconset>
-            </property>
-            <property name="flat">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item row="0" column="0">
-           <widget class="QPushButton" name="BtnExpand1">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="text">
-             <string/>
-            </property>
-            <property name="icon">
-             <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-              <normaloff>:/buttons/expand.bmp</normaloff>:/buttons/expand.bmp</iconset>
-            </property>
-            <property name="flat">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item row="0" column="1">
-           <widget class="QPushButton" name="BtnShrink1">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="text">
-             <string/>
-            </property>
-            <property name="icon">
-             <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-              <normaloff>:/buttons/shrink.bmp</normaloff>:/buttons/shrink.bmp</iconset>
-            </property>
-            <property name="flat">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-         </layout>
-        </widget>
-        <widget class="QWidget" name="Panel23" native="true">
-         <property name="enabled">
-          <bool>true</bool>
-         </property>
-         <property name="toolTip">
-          <string/>
-         </property>
-         <property name="text" stdset="0">
-          <string/>
-         </property>
-         <layout class="QGridLayout" name="gridLayout_3">
-          <property name="leftMargin">
-           <number>0</number>
-          </property>
-          <property name="topMargin">
-           <number>0</number>
-          </property>
-          <property name="rightMargin">
-           <number>0</number>
-          </property>
-          <property name="bottomMargin">
-           <number>0</number>
-          </property>
-          <property name="spacing">
-           <number>0</number>
-          </property>
-          <item row="2" column="0" colspan="5">
-           <widget class="QLabel" name="Disp2">
-            <property name="enabled">
-             <bool>true</bool>
-            </property>
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Ignored" vsizetype="Ignored">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="toolTip">
-             <string/>
-            </property>
-           </widget>
-          </item>
-          <item row="0" column="0">
-           <widget class="QPushButton" name="BtnExpand2">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="text">
-             <string/>
-            </property>
-            <property name="icon">
-             <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-              <normaloff>:/buttons/expand.bmp</normaloff>:/buttons/expand.bmp</iconset>
-            </property>
-            <property name="flat">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item row="0" column="3">
-           <widget class="QPushButton" name="BtnFreqType2">
-            <property name="enabled">
-             <bool>true</bool>
-            </property>
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="toolTip">
-             <string/>
-            </property>
-            <property name="icon">
-             <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-              <normaloff>:/buttons/down.bmp</normaloff>:/buttons/down.bmp</iconset>
-            </property>
-            <property name="flat">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item row="0" column="4">
-           <widget class="QPushButton" name="BtnPlotType2">
-            <property name="enabled">
-             <bool>true</bool>
-            </property>
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="toolTip">
-             <string/>
-            </property>
-            <property name="icon">
-             <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-              <normaloff>:/buttons/down.bmp</normaloff>:/buttons/down.bmp</iconset>
-            </property>
-            <property name="flat">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item row="0" column="1">
-           <widget class="QPushButton" name="BtnShrink2">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="text">
-             <string/>
-            </property>
-            <property name="icon">
-             <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-              <normaloff>:/buttons/shrink.bmp</normaloff>:/buttons/shrink.bmp</iconset>
-            </property>
-            <property name="flat">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-         </layout>
-        </widget>
-        <widget class="QWidget" name="Panel24" native="true">
-         <property name="enabled">
-          <bool>true</bool>
-         </property>
-         <property name="toolTip">
-          <string/>
-         </property>
-         <property name="text" stdset="0">
-          <string/>
-         </property>
-         <layout class="QGridLayout" name="gridLayout_5">
-          <property name="leftMargin">
-           <number>0</number>
-          </property>
-          <property name="topMargin">
-           <number>0</number>
-          </property>
-          <property name="rightMargin">
-           <number>0</number>
-          </property>
-          <property name="bottomMargin">
-           <number>0</number>
-          </property>
-          <property name="spacing">
-           <number>0</number>
-          </property>
-          <item row="2" column="0" colspan="5">
-           <widget class="QLabel" name="Disp3">
-            <property name="enabled">
-             <bool>true</bool>
-            </property>
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Ignored" vsizetype="Ignored">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="toolTip">
-             <string/>
-            </property>
-           </widget>
-          </item>
-          <item row="0" column="0">
-           <widget class="QPushButton" name="BtnExpand3">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="text">
-             <string/>
-            </property>
-            <property name="icon">
-             <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-              <normaloff>:/buttons/expand.bmp</normaloff>:/buttons/expand.bmp</iconset>
-            </property>
-            <property name="flat">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item row="0" column="3">
-           <widget class="QPushButton" name="BtnFreqType3">
-            <property name="enabled">
-             <bool>true</bool>
-            </property>
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="toolTip">
-             <string/>
-            </property>
-            <property name="icon">
-             <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-              <normaloff>:/buttons/down.bmp</normaloff>:/buttons/down.bmp</iconset>
-            </property>
-            <property name="flat">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item row="0" column="4">
-           <widget class="QPushButton" name="BtnPlotType3">
-            <property name="enabled">
-             <bool>true</bool>
-            </property>
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="toolTip">
-             <string/>
-            </property>
-            <property name="icon">
-             <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-              <normaloff>:/buttons/down.bmp</normaloff>:/buttons/down.bmp</iconset>
-            </property>
-            <property name="flat">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item row="0" column="1">
-           <widget class="QPushButton" name="BtnShrink3">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="text">
-             <string/>
-            </property>
-            <property name="icon">
-             <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-              <normaloff>:/buttons/shrink.bmp</normaloff>:/buttons/shrink.bmp</iconset>
-            </property>
-            <property name="flat">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-         </layout>
-        </widget>
-        <widget class="QWidget" name="Panel25" native="true">
-         <property name="enabled">
-          <bool>true</bool>
-         </property>
-         <property name="toolTip">
-          <string/>
-         </property>
-         <property name="text" stdset="0">
-          <string/>
-         </property>
-         <layout class="QGridLayout" name="gridLayout_6">
-          <property name="leftMargin">
-           <number>0</number>
-          </property>
-          <property name="topMargin">
-           <number>0</number>
-          </property>
-          <property name="rightMargin">
-           <number>0</number>
-          </property>
-          <property name="bottomMargin">
-           <number>0</number>
-          </property>
-          <property name="spacing">
-           <number>0</number>
-          </property>
-          <item row="2" column="0" colspan="5">
-           <widget class="QLabel" name="Disp4">
-            <property name="enabled">
-             <bool>true</bool>
-            </property>
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Ignored" vsizetype="Ignored">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="toolTip">
-             <string/>
-            </property>
-           </widget>
-          </item>
-          <item row="0" column="0">
-           <widget class="QPushButton" name="BtnExpand4">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="text">
-             <string/>
-            </property>
-            <property name="icon">
-             <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-              <normaloff>:/buttons/expand.bmp</normaloff>:/buttons/expand.bmp</iconset>
-            </property>
-            <property name="flat">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item row="0" column="3">
-           <widget class="QPushButton" name="BtnFreqType4">
-            <property name="enabled">
-             <bool>true</bool>
-            </property>
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="toolTip">
-             <string/>
-            </property>
-            <property name="icon">
-             <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-              <normaloff>:/buttons/down.bmp</normaloff>:/buttons/down.bmp</iconset>
-            </property>
-            <property name="flat">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item row="0" column="4">
-           <widget class="QPushButton" name="BtnPlotType4">
-            <property name="enabled">
-             <bool>true</bool>
-            </property>
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="toolTip">
-             <string/>
-            </property>
-            <property name="icon">
-             <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-              <normaloff>:/buttons/down.bmp</normaloff>:/buttons/down.bmp</iconset>
-            </property>
-            <property name="flat">
-             <bool>true</bool>
-            </property>
-           </widget>
-          </item>
-          <item row="0" column="1">
-           <widget class="QPushButton" name="BtnShrink4">
-            <property name="sizePolicy">
-             <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-              <horstretch>0</horstretch>
-              <verstretch>0</verstretch>
-             </sizepolicy>
-            </property>
-            <property name="text">
-             <string/>
-            </property>
-            <property name="icon">
-             <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-              <normaloff>:/buttons/shrink.bmp</normaloff>:/buttons/shrink.bmp</iconset>
-            </property>
-            <property name="flat">
-             <bool>true</bool>
+         <layout class="QHBoxLayout" name="horizontalLayout_13">
+          <item>
+           <widget class="QSplitter" name="Splitter2">
+            <property name="orientation">
+             <enum>Qt::Vertical</enum>
             </property>
+            <widget class="QWidget" name="Panel222" native="true">
+             <property name="enabled">
+              <bool>true</bool>
+             </property>
+             <property name="toolTip">
+              <string/>
+             </property>
+             <property name="text" stdset="0">
+              <string/>
+             </property>
+             <layout class="QGridLayout" name="gridLayout_3">
+              <property name="leftMargin">
+               <number>0</number>
+              </property>
+              <property name="topMargin">
+               <number>0</number>
+              </property>
+              <property name="rightMargin">
+               <number>0</number>
+              </property>
+              <property name="bottomMargin">
+               <number>0</number>
+              </property>
+              <property name="spacing">
+               <number>0</number>
+              </property>
+              <item row="2" column="0" colspan="5">
+               <widget class="QLabel" name="Disp2">
+                <property name="enabled">
+                 <bool>true</bool>
+                </property>
+                <property name="sizePolicy">
+                 <sizepolicy hsizetype="Ignored" vsizetype="Ignored">
+                  <horstretch>0</horstretch>
+                  <verstretch>0</verstretch>
+                 </sizepolicy>
+                </property>
+                <property name="toolTip">
+                 <string/>
+                </property>
+               </widget>
+              </item>
+              <item row="0" column="0">
+               <widget class="QPushButton" name="BtnExpand">
+                <property name="sizePolicy">
+                 <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
+                  <horstretch>0</horstretch>
+                  <verstretch>0</verstretch>
+                 </sizepolicy>
+                </property>
+                <property name="text">
+                 <string/>
+                </property>
+                <property name="icon">
+                 <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
+                  <normaloff>:/buttons/expand.bmp</normaloff>:/buttons/expand.bmp</iconset>
+                </property>
+                <property name="flat">
+                 <bool>true</bool>
+                </property>
+               </widget>
+              </item>
+              <item row="0" column="3">
+               <widget class="QPushButton" name="BtnFreqType2">
+                <property name="enabled">
+                 <bool>true</bool>
+                </property>
+                <property name="sizePolicy">
+                 <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
+                  <horstretch>0</horstretch>
+                  <verstretch>0</verstretch>
+                 </sizepolicy>
+                </property>
+                <property name="toolTip">
+                 <string/>
+                </property>
+                <property name="icon">
+                 <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
+                  <normaloff>:/buttons/down.bmp</normaloff>:/buttons/down.bmp</iconset>
+                </property>
+                <property name="flat">
+                 <bool>true</bool>
+                </property>
+               </widget>
+              </item>
+              <item row="0" column="4">
+               <widget class="QPushButton" name="BtnPlotType2">
+                <property name="enabled">
+                 <bool>true</bool>
+                </property>
+                <property name="sizePolicy">
+                 <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
+                  <horstretch>0</horstretch>
+                  <verstretch>0</verstretch>
+                 </sizepolicy>
+                </property>
+                <property name="toolTip">
+                 <string/>
+                </property>
+                <property name="icon">
+                 <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
+                  <normaloff>:/buttons/down.bmp</normaloff>:/buttons/down.bmp</iconset>
+                </property>
+                <property name="flat">
+                 <bool>true</bool>
+                </property>
+               </widget>
+              </item>
+              <item row="0" column="1">
+               <widget class="QPushButton" name="BtnShrink">
+                <property name="sizePolicy">
+                 <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
+                  <horstretch>0</horstretch>
+                  <verstretch>0</verstretch>
+                 </sizepolicy>
+                </property>
+                <property name="text">
+                 <string/>
+                </property>
+                <property name="icon">
+                 <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
+                  <normaloff>:/buttons/shrink.bmp</normaloff>:/buttons/shrink.bmp</iconset>
+                </property>
+                <property name="flat">
+                 <bool>true</bool>
+                </property>
+               </widget>
+              </item>
+             </layout>
+            </widget>
+            <widget class="QWidget" name="Panel221" native="true">
+             <property name="enabled">
+              <bool>true</bool>
+             </property>
+             <property name="toolTip">
+              <string/>
+             </property>
+             <property name="text" stdset="0">
+              <string/>
+             </property>
+             <layout class="QGridLayout" name="gridLayout_2">
+              <property name="leftMargin">
+               <number>0</number>
+              </property>
+              <property name="topMargin">
+               <number>0</number>
+              </property>
+              <property name="rightMargin">
+               <number>0</number>
+              </property>
+              <property name="bottomMargin">
+               <number>0</number>
+              </property>
+              <property name="spacing">
+               <number>0</number>
+              </property>
+              <item row="1" column="0" colspan="3">
+               <widget class="QLabel" name="Disp1">
+                <property name="enabled">
+                 <bool>true</bool>
+                </property>
+                <property name="sizePolicy">
+                 <sizepolicy hsizetype="Ignored" vsizetype="Ignored">
+                  <horstretch>0</horstretch>
+                  <verstretch>0</verstretch>
+                 </sizepolicy>
+                </property>
+                <property name="toolTip">
+                 <string/>
+                </property>
+               </widget>
+              </item>
+              <item row="0" column="2">
+               <widget class="QPushButton" name="BtnPlotType1">
+                <property name="enabled">
+                 <bool>true</bool>
+                </property>
+                <property name="sizePolicy">
+                 <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
+                  <horstretch>0</horstretch>
+                  <verstretch>0</verstretch>
+                 </sizepolicy>
+                </property>
+                <property name="toolTip">
+                 <string/>
+                </property>
+                <property name="icon">
+                 <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
+                  <normaloff>:/buttons/down.bmp</normaloff>:/buttons/down.bmp</iconset>
+                </property>
+                <property name="flat">
+                 <bool>true</bool>
+                </property>
+               </widget>
+              </item>
+              <item row="0" column="1">
+               <widget class="QPushButton" name="BtnFreqType1">
+                <property name="enabled">
+                 <bool>true</bool>
+                </property>
+                <property name="sizePolicy">
+                 <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
+                  <horstretch>0</horstretch>
+                  <verstretch>0</verstretch>
+                 </sizepolicy>
+                </property>
+                <property name="toolTip">
+                 <string/>
+                </property>
+                <property name="icon">
+                 <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
+                  <normaloff>:/buttons/down.bmp</normaloff>:/buttons/down.bmp</iconset>
+                </property>
+                <property name="flat">
+                 <bool>true</bool>
+                </property>
+               </widget>
+              </item>
+             </layout>
+            </widget>
            </widget>
           </item>
          </layout>
@@ -1925,7 +1648,7 @@
          <string>RTK Monitor</string>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
           <normaloff>:/buttons/sqr.bmp</normaloff>:/buttons/sqr.bmp</iconset>
         </property>
         <property name="flat">
@@ -1994,7 +1717,7 @@
             <string>Hide</string>
            </property>
            <property name="icon">
-            <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+            <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
              <normaloff>:/buttons/ttray.bmp</normaloff>:/buttons/ttray.bmp</iconset>
            </property>
            <property name="flat">
@@ -2048,6 +1771,9 @@
       <string/>
      </property>
      <layout class="QHBoxLayout" name="horizontalLayout_2">
+      <property name="spacing">
+       <number>0</number>
+      </property>
       <property name="leftMargin">
        <number>0</number>
       </property>
@@ -2072,7 +1798,7 @@
          <string>&amp;Start</string>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="rtknavi_qt.qrc">
           <normaloff>:/buttons/start.bmp</normaloff>:/buttons/start.bmp</iconset>
         </property>
        </widget>
@@ -2086,7 +1812,7 @@
          <string>S&amp;top</string>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="rtknavi_qt.qrc">
           <normaloff>:/buttons/stop2.bmp</normaloff>:/buttons/stop2.bmp</iconset>
         </property>
        </widget>
@@ -2097,7 +1823,7 @@
          <string>Mark...</string>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
           <normaloff>:/buttons/point.bmp</normaloff>:/buttons/point.bmp</iconset>
         </property>
        </widget>
@@ -2114,7 +1840,7 @@
          <string>&amp;Plot...</string>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
           <normaloff>:/buttons/chart.bmp</normaloff>:/buttons/chart.bmp</iconset>
         </property>
        </widget>
@@ -2131,7 +1857,7 @@
          <string>&amp;Options...</string>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
           <normaloff>:/buttons/toolbmp</normaloff>:/buttons/toolbmp</iconset>
         </property>
        </widget>
@@ -2161,7 +1887,8 @@
   </layout>
  </widget>
  <resources>
-  <include location="../rtkconv_qt/rtkconv_qt.qrc"/>
+  <include location="../rtkpost_qt/rtkpost_qt.qrc"/>
+  <include location="rtknavi_qt.qrc"/>
  </resources>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/naviopt.cpp RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/naviopt.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/naviopt.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/naviopt.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -19,23 +19,23 @@
 #define MAXSTR      1024                /* max length of a string */
 
 // receiver options table ---------------------------------------------------
-static int strtype[] = {                  /* stream types */
-    STR_NONE, STR_NONE, STR_NONE, STR_NONE, STR_NONE, STR_NONE, STR_NONE, STR_NONE
+static int strtype[]={                  /* stream types */
+    STR_NONE,STR_NONE,STR_NONE,STR_NONE,STR_NONE,STR_NONE,STR_NONE,STR_NONE
 };
-static char strpath[8][MAXSTR] = { "" };        /* stream paths */
-static int strfmt[] = {                         /* stream formats */
-    STRFMT_RTCM3, STRFMT_RTCM3, STRFMT_SP3, SOLF_LLH, SOLF_NMEA, 0, 0, 0
+static char strpath[8][MAXSTR]={""};    /* stream paths */
+static int strfmt[]={                   /* stream formats */
+    STRFMT_RTCM3,STRFMT_RTCM3,STRFMT_SP3,SOLF_LLH,SOLF_NMEA,0,0,0
 };
-static int svrcycle = 10;               /* server cycle (ms) */
-static int timeout = 10000;             /* timeout time (ms) */
-static int reconnect = 10000;           /* reconnect interval (ms) */
-static int nmeacycle = 5000;            /* nmea request cycle (ms) */
-static int fswapmargin = 30;            /* file swap marign (s) */
-static int buffsize = 32768;            /* input buffer size (bytes) */
-static int navmsgsel = 0;               /* navigation mesaage select */
-static int nmeareq = 0;                 /* nmea request type (0:off,1:lat/lon,2:single) */
-static double nmeapos[] = { 0, 0 };     /* nmea position (lat/lon) (deg) */
-static char proxyaddr[MAXSTR] = "";     /* proxy address */
+static int svrcycle     =10;            /* server cycle (ms) */
+static int timeout      =10000;         /* timeout time (ms) */
+static int reconnect    =10000;         /* reconnect interval (ms) */
+static int nmeacycle    =5000;          /* nmea request cycle (ms) */
+static int fswapmargin  =30;            /* file swap marign (s) */
+static int buffsize     =32768;         /* input buffer size (bytes) */
+static int navmsgsel    =0;             /* navigation mesaage select */
+static int nmeareq      =0;             /* nmea request type (0:off,1:lat/lon,2:single) */
+static double nmeapos[] ={0,0};         /* nmea position (lat/lon) (deg) */
+static char proxyaddr[MAXSTR]="";       /* proxy address */
 
 #define TIMOPT  "0:gpst,1:utc,2:jst,3:tow"
 #define CONOPT  "0:dms,1:deg,2:xyz,3:enu,4:pyl"
@@ -47,73 +47,73 @@
 #define SOLOPT  "0:llh,1:xyz,2:enu,3:nmea"
 #define MSGOPT  "0:all,1:rover,2:base,3:corr"
 
-static opt_t rcvopts[] = {
-    { "inpstr1-type",     3, (void *)&strtype[0],  ISTOPT  },
-    { "inpstr2-type",     3, (void *)&strtype[1],  ISTOPT  },
-    { "inpstr3-type",     3, (void *)&strtype[2],  ISTOPT  },
-    { "inpstr1-path",     2, (void *)strpath [0],  ""      },
-    { "inpstr2-path",     2, (void *)strpath [1],  ""      },
-    { "inpstr3-path",     2, (void *)strpath [2],  ""      },
-    { "inpstr1-format",   3, (void *)&strfmt [0],  FMTOPT  },
-    { "inpstr2-format",   3, (void *)&strfmt [1],  FMTOPT  },
-    { "inpstr3-format",   3, (void *)&strfmt [2],  FMTOPT  },
-    { "inpstr2-nmeareq",  3, (void *)&nmeareq,     NMEOPT  },
-    { "inpstr2-nmealat",  1, (void *)&nmeapos[0],  "deg"   },
-    { "inpstr2-nmealon",  1, (void *)&nmeapos[1],  "deg"   },
-    { "outstr1-type",     3, (void *)&strtype[3],  OSTOPT  },
-    { "outstr2-type",     3, (void *)&strtype[4],  OSTOPT  },
-    { "outstr1-path",     2, (void *)strpath [3],  ""      },
-    { "outstr2-path",     2, (void *)strpath [4],  ""      },
-    { "outstr1-format",   3, (void *)&strfmt [3],  SOLOPT  },
-    { "outstr2-format",   3, (void *)&strfmt [4],  SOLOPT  },
-    { "logstr1-type",     3, (void *)&strtype[5],  OSTOPT  },
-    { "logstr2-type",     3, (void *)&strtype[6],  OSTOPT  },
-    { "logstr3-type",     3, (void *)&strtype[7],  OSTOPT  },
-    { "logstr1-path",     2, (void *)strpath [5],  ""      },
-    { "logstr2-path",     2, (void *)strpath [6],  ""      },
-    { "logstr3-path",     2, (void *)strpath [7],  ""      },
-
-    { "misc-svrcycle",    0, (void *)&svrcycle,    "ms"    },
-    { "misc-timeout",     0, (void *)&timeout,     "ms"    },
-    { "misc-reconnect",   0, (void *)&reconnect,   "ms"    },
-    { "misc-nmeacycle",   0, (void *)&nmeacycle,   "ms"    },
-    { "misc-buffsize",    0, (void *)&buffsize,    "bytes" },
-    { "misc-navmsgsel",   3, (void *)&navmsgsel,   MSGOPT  },
-    { "misc-proxyaddr",   2, (void *)proxyaddr,    ""      },
-    { "misc-fswapmargin", 0, (void *)&fswapmargin, "s"     },
-
-    { "",		      0, NULL,		       ""      }
+static opt_t rcvopts[]={
+    {"inpstr1-type",    3,  (void *)&strtype[0],         ISTOPT },
+    {"inpstr2-type",    3,  (void *)&strtype[1],         ISTOPT },
+    {"inpstr3-type",    3,  (void *)&strtype[2],         ISTOPT },
+    {"inpstr1-path",    2,  (void *)strpath [0],         ""     },
+    {"inpstr2-path",    2,  (void *)strpath [1],         ""     },
+    {"inpstr3-path",    2,  (void *)strpath [2],         ""     },
+    {"inpstr1-format",  3,  (void *)&strfmt [0],         FMTOPT },
+    {"inpstr2-format",  3,  (void *)&strfmt [1],         FMTOPT },
+    {"inpstr3-format",  3,  (void *)&strfmt [2],         FMTOPT },
+    {"inpstr2-nmeareq", 3,  (void *)&nmeareq,            NMEOPT },
+    {"inpstr2-nmealat", 1,  (void *)&nmeapos[0],         "deg"  },
+    {"inpstr2-nmealon", 1,  (void *)&nmeapos[1],         "deg"  },
+    {"outstr1-type",    3,  (void *)&strtype[3],         OSTOPT },
+    {"outstr2-type",    3,  (void *)&strtype[4],         OSTOPT },
+    {"outstr1-path",    2,  (void *)strpath [3],         ""     },
+    {"outstr2-path",    2,  (void *)strpath [4],         ""     },
+    {"outstr1-format",  3,  (void *)&strfmt [3],         SOLOPT },
+    {"outstr2-format",  3,  (void *)&strfmt [4],         SOLOPT },
+    {"logstr1-type",    3,  (void *)&strtype[5],         OSTOPT },
+    {"logstr2-type",    3,  (void *)&strtype[6],         OSTOPT },
+    {"logstr3-type",    3,  (void *)&strtype[7],         OSTOPT },
+    {"logstr1-path",    2,  (void *)strpath [5],         ""     },
+    {"logstr2-path",    2,  (void *)strpath [6],         ""     },
+    {"logstr3-path",    2,  (void *)strpath [7],         ""     },
+    
+    {"misc-svrcycle",   0,  (void *)&svrcycle,           "ms"   },
+    {"misc-timeout",    0,  (void *)&timeout,            "ms"   },
+    {"misc-reconnect",  0,  (void *)&reconnect,          "ms"   },
+    {"misc-nmeacycle",  0,  (void *)&nmeacycle,          "ms"   },
+    {"misc-buffsize",   0,  (void *)&buffsize,           "bytes"},
+    {"misc-navmsgsel",  3,  (void *)&navmsgsel,          MSGOPT },
+    {"misc-proxyaddr",  2,  (void *)proxyaddr,           ""     },
+    {"misc-fswapmargin",0,  (void *)&fswapmargin,        "s"    },
+    
+    {"",0,NULL,""}
 };
 //---------------------------------------------------------------------------
-OptDialog::OptDialog(QWidget *parent)
+OptDialog::OptDialog(QWidget* parent)
     : QDialog(parent)
 {
     QString label;
-    int freq[] = { 1, 2, 5, 6, 7, 8, 9 }, nglo = MAXPRNGLO, ngal = MAXPRNGAL, nqzs = MAXPRNQZS;
-    int ncmp = MAXPRNCMP, nirn = MAXPRNIRN;
+    int freq[]={1,2,5,6,7,8,9},nglo=MAXPRNGLO,ngal=MAXPRNGAL,nqzs=MAXPRNQZS;
+    int ncmp=MAXPRNCMP,nirn=MAXPRNIRN;
 
     setupUi(this);
 
-    PrcOpt = prcopt_default;
-    SolOpt = solopt_default;
+	PrcOpt=prcopt_default;
+	SolOpt=solopt_default;
 
-    textViewer = new TextViewer(this);
+    textViewer =new TextViewer(this);
 
     UpdateEnable();
-
+	
     Freq->clear();
-    for (int i = 0; i < NFREQ; i++) {
-        label = label + (i > 0 ? "+" : "") + QString(tr("L%1")).arg(freq[i]);
+	for (int i=0;i<NFREQ;i++) {
+        label=label+(i>0?"+":"")+QString("L%1").arg(freq[i]);
         Freq->addItem(label);
 	}
-    if (nglo <= 0) NavSys2->setEnabled(false);
-    if (ngal <= 0) NavSys3->setEnabled(false);
-    if (nqzs <= 0) NavSys4->setEnabled(false);
-    if (ncmp <= 0) NavSys6->setEnabled(false);
-    if (nirn <= 0) NavSys7->setEnabled(false);
+    if (nglo<=0) NavSys2->setEnabled(false);
+    if (ngal<=0) NavSys3->setEnabled(false);
+    if (nqzs<=0) NavSys4->setEnabled(false);
+    if (ncmp<=0) NavSys6->setEnabled(false);
+    if (nirn<=0) NavSys7->setEnabled(false);
 
-    QCompleter *fileCompleter = new QCompleter(this);
-    QFileSystemModel *fileModel = new QFileSystemModel(fileCompleter);
+    QCompleter *fileCompleter=new QCompleter(this);
+    QFileSystemModel *fileModel=new QFileSystemModel(fileCompleter);
     fileModel->setRootPath("");
     fileCompleter->setModel(fileModel);
     StaPosFile->setCompleter(fileCompleter);
@@ -126,48 +126,48 @@
     TLEFile->setCompleter(fileCompleter);
     TLESatFile->setCompleter(fileCompleter);
 
-    QCompleter *dirCompleter = new QCompleter(this);
-    QFileSystemModel *dirModel = new QFileSystemModel(dirCompleter);
+    QCompleter *dirCompleter=new QCompleter(this);
+    QFileSystemModel *dirModel=new QFileSystemModel(dirCompleter);
     dirModel->setRootPath("");
-    dirModel->setFilter(QDir::AllDirs | QDir::Drives | QDir::NoDotAndDotDot);
+    dirModel->setFilter(QDir::AllDirs|QDir::Drives|QDir::NoDotAndDotDot);
     dirCompleter->setModel(dirModel);
     LocalDir->setCompleter(dirCompleter);
 
 	UpdateEnable();
 
-    connect(BtnAntPcvFile, SIGNAL(clicked(bool)), this, SLOT(BtnAntPcvFileClick()));
-    connect(BtnAntPcvView, SIGNAL(clicked(bool)), this, SLOT(BtnAntPcvViewClick()));
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(BtnDCBFile, SIGNAL(clicked(bool)), this, SLOT(BtnDCBFileClick()));
-    connect(BtnEOPFile, SIGNAL(clicked(bool)), this, SLOT(BtnEOPFileClick()));
-    connect(BtnEOPView, SIGNAL(clicked(bool)), this, SLOT(BtnEOPViewClick()));
-    connect(BtnFont, SIGNAL(clicked(bool)), this, SLOT(BtnFontClick()));
-    connect(BtnGeoidDataFile, SIGNAL(clicked(bool)), this, SLOT(BtnGeoidDataFileClick()));
-    connect(BtnLoad, SIGNAL(clicked(bool)), this, SLOT(BtnLoadClick()));
-    connect(BtnLocalDir, SIGNAL(clicked(bool)), this, SLOT(BtnLocalDirClick()));
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
+    connect(BtnAntPcvFile,SIGNAL(clicked(bool)),this,SLOT(BtnAntPcvFileClick()));
+    connect(BtnAntPcvView,SIGNAL(clicked(bool)),this,SLOT(BtnAntPcvViewClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(BtnDCBFile,SIGNAL(clicked(bool)),this,SLOT(BtnDCBFileClick()));
+    connect(BtnEOPFile,SIGNAL(clicked(bool)),this,SLOT(BtnEOPFileClick()));
+    connect(BtnEOPView,SIGNAL(clicked(bool)),this,SLOT(BtnEOPViewClick()));
+    connect(BtnFont,SIGNAL(clicked(bool)),this,SLOT(BtnFontClick()));
+    connect(BtnGeoidDataFile,SIGNAL(clicked(bool)),this,SLOT(BtnGeoidDataFileClick()));
+    connect(BtnLoad,SIGNAL(clicked(bool)),this,SLOT(BtnLoadClick()));
+    connect(BtnLocalDir,SIGNAL(clicked(bool)),this,SLOT(BtnLocalDirClick()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
 //    connect(BtnOLFile,SIGNAL(clicked(bool)),this,SLOT(Btn));//Ocean Load
-    connect(BtnRefPos, SIGNAL(clicked(bool)), this, SLOT(BtnRefPosClick()));
-    connect(BtnRovPos, SIGNAL(clicked(bool)), this, SLOT(BtnRovPosClick()));
-    connect(BtnSatPcvFile, SIGNAL(clicked(bool)), this, SLOT(BtnSatPcvFileClick()));
-    connect(BtnSatPcvView, SIGNAL(clicked(bool)), this, SLOT(BtnSatPcvViewClick()));
-    connect(BtnSave, SIGNAL(clicked(bool)), this, SLOT(BtnSaveClick()));
-    connect(BtnSnrMask, SIGNAL(clicked(bool)), this, SLOT(BtnSnrMaskClick()));
-    connect(BtnStaPosFile, SIGNAL(clicked(bool)), this, SLOT(BtnStaPosFileClick()));
-    connect(BtnStaPosView, SIGNAL(clicked(bool)), this, SLOT(BtnStaPosViewClick()));
-    connect(BtnTLEFile, SIGNAL(clicked(bool)), this, SLOT(BtnTLEFileClick()));
-    connect(BtnTLESatFile, SIGNAL(clicked(bool)), this, SLOT(BtnTLESatFileClick()));
-    connect(PosMode, SIGNAL(currentIndexChanged(int)), this, SLOT(PosModeChange(int)));
-    connect(SolFormat, SIGNAL(currentIndexChanged(int)), this, SLOT(SolFormatChange(int)));
-    connect(RefPosTypeP, SIGNAL(currentIndexChanged(int)), this, SLOT(RefPosTypePChange(int)));
-    connect(RovPosTypeP, SIGNAL(currentIndexChanged(int)), this, SLOT(RovPosTypePChange(int)));
-    connect(AmbRes, SIGNAL(currentIndexChanged(int)), this, SLOT(AmbResChange(int)));
-    connect(RovAntPcv, SIGNAL(clicked(bool)), this, SLOT(RovAntPcvClick()));
-    connect(RefAntPcv, SIGNAL(clicked(bool)), this, SLOT(RovAntPcvClick()));
-    connect(OutputHeight, SIGNAL(currentIndexChanged(int)), this, SLOT(OutputHeightClick()));
-    connect(NavSys2, SIGNAL(clicked(bool)), this, SLOT(NavSys2Click()));
-    connect(NavSys6, SIGNAL(clicked(bool)), this, SLOT(NavSys6Click()));
-    connect(BaselineConst, SIGNAL(clicked(bool)), this, SLOT(BaselineConstClick()));
+    connect(BtnRefPos,SIGNAL(clicked(bool)),this,SLOT(BtnRefPosClick()));
+    connect(BtnRovPos,SIGNAL(clicked(bool)),this,SLOT(BtnRovPosClick()));
+    connect(BtnSatPcvFile,SIGNAL(clicked(bool)),this,SLOT(BtnSatPcvFileClick()));
+    connect(BtnSatPcvView,SIGNAL(clicked(bool)),this,SLOT(BtnSatPcvViewClick()));
+    connect(BtnSave,SIGNAL(clicked(bool)),this,SLOT(BtnSaveClick()));
+    connect(BtnSnrMask,SIGNAL(clicked(bool)),this,SLOT(BtnSnrMaskClick()));
+    connect(BtnStaPosFile,SIGNAL(clicked(bool)),this,SLOT(BtnStaPosFileClick()));
+    connect(BtnStaPosView,SIGNAL(clicked(bool)),this,SLOT(BtnStaPosViewClick()));
+    connect(BtnTLEFile,SIGNAL(clicked(bool)),this,SLOT(BtnTLEFileClick()));
+    connect(BtnTLESatFile,SIGNAL(clicked(bool)),this,SLOT(BtnTLESatFileClick()));
+    connect(PosMode,SIGNAL(currentIndexChanged(int)),this,SLOT(PosModeChange(int)));
+    connect(SolFormat,SIGNAL(currentIndexChanged(int)),this,SLOT(SolFormatChange(int)));
+    connect(RefPosTypeP,SIGNAL(currentIndexChanged(int)),this,SLOT(RefPosTypePChange(int)));
+    connect(RovPosTypeP,SIGNAL(currentIndexChanged(int)),this,SLOT(RovPosTypePChange(int)));
+    connect(AmbRes,SIGNAL(currentIndexChanged(int)),this,SLOT(AmbResChange(int)));
+    connect(RovAntPcv,SIGNAL(clicked(bool)),this,SLOT(RovAntPcvClick()));
+    connect(RefAntPcv,SIGNAL(clicked(bool)),this,SLOT(RovAntPcvClick()));
+    connect(OutputHeight,SIGNAL(currentIndexChanged(int)),this,SLOT(OutputHeightClick()));
+    connect(NavSys2,SIGNAL(clicked(bool)),this,SLOT(NavSys2Click()));
+    connect(NavSys6,SIGNAL(clicked(bool)),this,SLOT(NavSys6Click()));
+    connect(BaselineConst,SIGNAL(clicked(bool)),this,SLOT(BaselineConstClick()));
 }
 //---------------------------------------------------------------------------
 void OptDialog::showEvent(QShowEvent *event)
@@ -187,8 +187,7 @@
 void OptDialog::BtnLoadClick()
 {
     QString fileName;
-
-    fileName = QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Load Options..."), QString(), tr("Options File (*.conf);;All (*.*)")));
+    fileName=QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Load Options..."),QString(),tr("Options File (*.conf);;All (*.*)")));
 
     LoadOpt(fileName);
 }
@@ -197,18 +196,18 @@
 {
     QString file;
 
-    file = QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, tr("Save Options..."), QString(), tr("Options File (*.conf);;All (*.*)")));
+    file=QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Save Options..."),QString(),tr("Options File (*.conf);;All (*.*)")));
 
-    if (!file.contains('.')) file += ".conf";
+    if (!file.contains('.')) file+=".conf";
 
     SaveOpt(file);
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnStaPosViewClick()
 {
-    if (StaPosFile->text() == "") return;
+    if (StaPosFile->text()=="") return;
 
-    TextViewer *viewer = new TextViewer(this);
+    TextViewer *viewer=new TextViewer(this);
     viewer->show();
 
     viewer->Read(StaPosFile->text());
@@ -218,7 +217,7 @@
 {
     QString fileName;
 
-    fileName = QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Station Position File"), QString(), tr("Position File (*.pos);;All (*.*)")));
+    fileName=QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Station Postion File"),QString(),tr("Position File (*.pos);;All (*.*)")));
 
     StaPosFile->setText(fileName);
 }
@@ -226,33 +225,33 @@
 void OptDialog::BtnSnrMaskClick()
 {
     MaskOptDialog maskOptDialog(this);
-
-    maskOptDialog.Mask = PrcOpt.snrmask;
+    maskOptDialog.Mask=PrcOpt.snrmask;
 
     maskOptDialog.exec();
-    if (maskOptDialog.result() != QDialog::Accepted) return;
-    PrcOpt.snrmask = maskOptDialog.Mask;
+    if (maskOptDialog.result()!=QDialog::Accepted) return;
+    PrcOpt.snrmask=maskOptDialog.Mask;
 }
 //---------------------------------------------------------------------------
 void OptDialog::RovPosTypePChange(int)
 {
-    QLineEdit *edit[] = { RovPos1, RovPos2, RovPos3 };
+    QLineEdit *edit[]={RovPos1,RovPos2,RovPos3};
 	double pos[3];
 
-    GetPos(RovPosTypeF, edit, pos);
-    SetPos(RovPosTypeP->currentIndex(), edit, pos);
-    RovPosTypeF = RovPosTypeP->currentIndex();
+    GetPos(RovPosTypeF,edit,pos);
+    SetPos(RovPosTypeP->currentIndex(),edit,pos);
+    RovPosTypeF=RovPosTypeP->currentIndex();
 	UpdateEnable();
+
 }
 //---------------------------------------------------------------------------
 void OptDialog::RefPosTypePChange(int)
 {
-    QLineEdit *edit[] = { RefPos1, RefPos2, RefPos3 };
+    QLineEdit *edit[]={RefPos1,RefPos2,RefPos3};
 	double pos[3];
 
-    GetPos(RefPosTypeF, edit, pos);
-    SetPos(RefPosTypeP->currentIndex(), edit, pos);
-    RefPosTypeF = RefPosTypeP->currentIndex();
+	GetPos(RefPosTypeF,edit,pos);
+    SetPos(RefPosTypeP->currentIndex(),edit,pos);
+    RefPosTypeF=RefPosTypeP->currentIndex();
 
 	UpdateEnable();
 }
@@ -260,59 +259,59 @@
 void OptDialog::BtnRovPosClick()
 {
     RefDialog refDialog(this);
-    QLineEdit *edit[] = { RovPos1, RovPos2, RovPos3 };
-    double p[3], posi[3];
+    QLineEdit *edit[]={RovPos1,RovPos2,RovPos3};
+    double p[3],posi[3];
 
-    GetPos(RovPosTypeP->currentIndex(), edit, p);
-    ecef2pos(p, posi);
+    GetPos(RovPosTypeP->currentIndex(),edit,p);
+    ecef2pos(p,posi);
 
-    refDialog.RovPos[0] = posi[0] * R2D;
-    refDialog.RovPos[1] = posi[1] * R2D;
-    refDialog.Pos[2] = posi[2];
-    refDialog.StaPosFile = StaPosFile->text();
-    refDialog.move(pos().x() + size().width() / 2 - refDialog.size().width() / 2,
-               pos().y() + size().height() / 2 - refDialog.size().height() / 2);
+    refDialog.RovPos[0]=posi[0]*R2D;
+    refDialog.RovPos[1]=posi[1]*R2D;
+    refDialog.Pos[2]=posi[2];
+    refDialog.StaPosFile=StaPosFile->text();
+    refDialog.move(pos().x()+size().width()/2-refDialog.size().width()/2,
+        pos().y()+size().height()/2-refDialog.size().height()/2);
 
     refDialog.exec();
-    if (refDialog.result() != QDialog::Accepted) return;
+    if (refDialog.result()!=QDialog::Accepted) return;
 
-    posi[0] = refDialog.Pos[0] * D2R;
-    posi[1] = refDialog.Pos[1] * D2R;
-    posi[2] = refDialog.Pos[2];
+    posi[0]=refDialog.Pos[0]*D2R;
+    posi[1]=refDialog.Pos[1]*D2R;
+    posi[2]=refDialog.Pos[2];
 
-    pos2ecef(posi, p);
-    SetPos(RovPosTypeP->currentIndex(), edit, p);
+    pos2ecef(posi,p);
+    SetPos(RovPosTypeP->currentIndex(),edit,p);
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnRefPosClick()
 {
     RefDialog refDialog(this);
-    QLineEdit *edit[] = { RefPos1, RefPos2, RefPos3 };
-    double p[3], posi[3];
+    QLineEdit *edit[]={RefPos1,RefPos2,RefPos3};
+    double p[3],posi[3];
 
-    GetPos(RefPosTypeP->currentIndex(), edit, p);
-    ecef2pos(p, posi);
-    refDialog.RovPos[0] = posi[0] * R2D;
-    refDialog.RovPos[1] = posi[1] * R2D;
-    refDialog.RovPos[2] = posi[2];
-    refDialog.StaPosFile = StaPosFile->text();
-    refDialog.move(pos().x() + size().width() / 2 - refDialog.size().width() / 2,
-               pos().y() + size().height() / 2 - refDialog.size().height() / 2);
+    GetPos(RefPosTypeP->currentIndex(),edit,p);
+    ecef2pos(p,posi);
+    refDialog.RovPos[0]=posi[0]*R2D;
+    refDialog.RovPos[1]=posi[1]*R2D;
+    refDialog.RovPos[2]=posi[2];
+    refDialog.StaPosFile=StaPosFile->text();
+    refDialog.move(pos().x()+size().width()/2-refDialog.size().width()/2,
+        pos().y()+size().height()/2-refDialog.size().height()/2);
 
     refDialog.exec();
-    if (refDialog.result() != QDialog::Accepted) return;
+    if (refDialog.result()!=QDialog::Accepted) return;
 
-    posi[0] = refDialog.Pos[0] * D2R;
-    posi[1] = refDialog.Pos[1] * D2R;
-    posi[2] = refDialog.Pos[2];
+    posi[0]=refDialog.Pos[0]*D2R;
+    posi[1]=refDialog.Pos[1]*D2R;
+    posi[2]=refDialog.Pos[2];
 
-    pos2ecef(posi, p);
-    SetPos(RefPosTypeP->currentIndex(), edit, p);
+    pos2ecef(posi,p);
+    SetPos(RefPosTypeP->currentIndex(),edit,p);
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnSatPcvViewClick()
 {
-    if (SatPcvFile->text() == "") return;
+    if (SatPcvFile->text()=="") return;
 
     textViewer->show();
 
@@ -321,12 +320,12 @@
 //---------------------------------------------------------------------------
 void OptDialog::BtnSatPcvFileClick()
 {
-    SatPcvFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Satellite Antenna PCV File"), QString(), tr("PCV File (*.pcv *.atx);;All (*.*)"))));
+    SatPcvFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Satellite Antenna PCV File"),QString(),tr("PCV File (*.pcv *.atx);;All (*.*)"))));
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnAntPcvViewClick()
 {
-    if (AntPcvFile->text() == "") return;
+    if (AntPcvFile->text()=="") return;
 
     textViewer->show();
 
@@ -335,34 +334,31 @@
 //---------------------------------------------------------------------------
 void OptDialog::BtnAntPcvFileClick()
 {
-    AntPcvFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Receiver Antenna PCV File"), QString(), tr("PCV File (*.pcv *.atx);;All (*.*)"))));
+    AntPcvFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Receiver Antenna PCV File"),QString(),tr("PCV File (*.pcv *.atx);;All (*.*)"))));
     ReadAntList();
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnGeoidDataFileClick()
 {
-    QString fileName = QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Geoid Data File"), QString(), tr("All (*.*)")));
-
+    QString fileName=QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Geoid Data File"),QString(),tr("All (*.*)")));
     GeoidDataFile->setText(fileName);
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnDCBFileClick()
 {
-    QString fileName = QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("DCB Data File"), QString(), tr("DCB (*.dcb)")));
-
+    QString fileName=QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("DCB Data File"),QString(),tr("DCB (*.dcb)")));
     DCBFile->setText(fileName);
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnEOPFileClick()
 {
-    QString fileName = QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("EOP Data File"), QString(), tr("EOP (*.erp)")));
-
+    QString fileName=QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("EOP Data File"),QString(),tr("EOP (*.erp)")));
     EOPFile->setText(fileName);
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnEOPViewClick()
 {
-    if (EOPFile->text() == "") return;
+    if (EOPFile->text()=="") return;
 
     textViewer->show();
 
@@ -371,9 +367,8 @@
 //---------------------------------------------------------------------------
 void OptDialog::BtnLocalDirClick()
 {
-    QString dir = LocalDir->text();
-
-    dir = QDir::toNativeSeparators(QFileDialog::getExistingDirectory(this, tr("FTP/HTTP Local Directory"), dir));
+    QString dir=LocalDir->text();
+    dir=QDir::toNativeSeparators(QFileDialog::getExistingDirectory(this,tr("FTP/HTTP Local Directory"),dir));
     LocalDir->setText(dir);
 }
 //---------------------------------------------------------------------------
@@ -385,19 +380,19 @@
     dialog.exec();
 
     FontLabel->setFont(dialog.selectedFont());
-    FontLabel->setText(FontLabel->font().family() + QString::number(FontLabel->font().pointSize()) + " pt");
+    FontLabel->setText(FontLabel->font().family()+QString::number(FontLabel->font().pointSize())+" pt");
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnTLESatFileClick()
 {
-    QString fileName = QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("TLE Satellite Number File"), QString(), tr("All (*.*)")));
+    QString fileName=QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("TLE Satellite Number File"),QString(),tr("All (*.*)")));
 
     TLESatFile->setText(fileName);
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnTLEFileClick()
 {
-    QString fileName = QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("TLE Data File"), QString(), tr("All (*.*)")));
+    QString fileName=QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("TLE Data File"),QString(),tr("All (*.*)")));
 
     TLEFile->setText(fileName);
 }
@@ -444,787 +439,743 @@
 //---------------------------------------------------------------------------
 void OptDialog::GetOpt(void)
 {
-    QLineEdit *editu[] = { RovPos1, RovPos2, RovPos3 };
-    QLineEdit *editr[] = { RefPos1, RefPos2, RefPos3 };
-
-    PosMode->setCurrentIndex(PrcOpt.mode);
-    Freq->setCurrentIndex(PrcOpt.nf - 1 > NFREQ - 1 ? NFREQ - 1 : PrcOpt.nf - 1);
-    ElMask->setCurrentIndex(ElMask->findText(QString::number(PrcOpt.elmin * R2D)));
-    DynamicModel->setCurrentIndex(PrcOpt.dynamics);
-    TideCorr->setCurrentIndex(PrcOpt.tidecorr);
-    IonoOpt->setCurrentIndex(PrcOpt.ionoopt);
-    TropOpt->setCurrentIndex(PrcOpt.tropopt);
-    SatEphem->setCurrentIndex(PrcOpt.sateph);
-    AmbRes->setCurrentIndex(PrcOpt.modear);
-    GloAmbRes->setCurrentIndex(PrcOpt.glomodear);
-    BdsAmbRes->setCurrentIndex(PrcOpt.bdsmodear);
-    ValidThresAR->setValue(PrcOpt.thresar[0]);
-    OutCntResetAmb->setValue(PrcOpt.maxout);
-    LockCntFixAmb->setValue(PrcOpt.minlock);
-    FixCntHoldAmb->setValue(PrcOpt.minfix);
-    ElMaskAR->setValue(PrcOpt.elmaskar * R2D);
-    ElMaskHold->setValue(PrcOpt.elmaskhold * R2D);
-    MaxAgeDiff->setValue(PrcOpt.maxtdiff);
-    RejectGdop->setValue(PrcOpt.maxgdop);
-    RejectThres->setValue(PrcOpt.maxinno);
-    SlipThres->setValue(PrcOpt.thresslip);
-    NumIter->setValue(PrcOpt.niter);
-    SyncSol->setCurrentIndex(PrcOpt.syncsol);
-    ExSatsE->setText(ExSats);
-    NavSys1->setChecked(PrcOpt.navsys & SYS_GPS);
-    NavSys2->setChecked(PrcOpt.navsys & SYS_GLO);
-    NavSys3->setChecked(PrcOpt.navsys & SYS_GAL);
-    NavSys4->setChecked(PrcOpt.navsys & SYS_QZS);
-    NavSys5->setChecked(PrcOpt.navsys & SYS_SBS);
-    NavSys6->setChecked(PrcOpt.navsys & SYS_CMP);
-    NavSys7->setChecked(PrcOpt.navsys & SYS_IRN);
-    PosOpt1->setChecked(PrcOpt.posopt[0]);
-    PosOpt2->setChecked(PrcOpt.posopt[1]);
-    PosOpt3->setChecked(PrcOpt.posopt[2]);
-    PosOpt4->setChecked(PrcOpt.posopt[3]);
-    PosOpt5->setChecked(PrcOpt.posopt[4]);
-
-    SolFormat->setCurrentIndex(SolOpt.posf);
-    TimeFormat->setCurrentIndex(SolOpt.timef == 0 ? 0 : SolOpt.times + 1);
-    TimeDecimal->setValue(SolOpt.timeu);
-    LatLonFormat->setCurrentIndex(SolOpt.degf);
-    FieldSep->setText(SolOpt.sep);
-    OutputHead->setCurrentIndex(SolOpt.outhead);
-    OutputOpt->setCurrentIndex(SolOpt.outopt);
-    OutputSingle->setCurrentIndex(PrcOpt.outsingle);
-    MaxSolStd->setValue(SolOpt.maxsolstd);
-    OutputDatum->setCurrentIndex(SolOpt.datum);
-    OutputHeight->setCurrentIndex(SolOpt.height);
-    OutputGeoid->setCurrentIndex(SolOpt.geoid);
-    NmeaIntv1->setValue(SolOpt.nmeaintv[0]);
-    NmeaIntv2->setValue(SolOpt.nmeaintv[1]);
-    DebugStatus->setCurrentIndex(DebugStatusF);
-    DebugTrace->setCurrentIndex(DebugTraceF);
-
+    QLineEdit *editu[]={RovPos1,RovPos2,RovPos3};
+    QLineEdit *editr[]={RefPos1,RefPos2,RefPos3};
+	
+    PosMode		 ->setCurrentIndex(PrcOpt.mode);
+    Freq		 ->setCurrentIndex(PrcOpt.nf-1>NFREQ-1?NFREQ-1:PrcOpt.nf-1);
+    ElMask		 ->setCurrentIndex(ElMask->findText(QString::number(PrcOpt.elmin*R2D)));
+    DynamicModel ->setCurrentIndex(PrcOpt.dynamics);
+    TideCorr	 ->setCurrentIndex(PrcOpt.tidecorr);
+    IonoOpt		 ->setCurrentIndex(PrcOpt.ionoopt);
+    TropOpt		 ->setCurrentIndex(PrcOpt.tropopt);
+    SatEphem	 ->setCurrentIndex(PrcOpt.sateph);
+    AmbRes		 ->setCurrentIndex(PrcOpt.modear);
+    GloAmbRes	 ->setCurrentIndex(PrcOpt.glomodear);
+    BdsAmbRes	 ->setCurrentIndex(PrcOpt.bdsmodear);
+    ValidThresAR ->setText(QString::number(PrcOpt.thresar[0]));
+    OutCntResetAmb->setText(QString::number(PrcOpt.maxout));
+    LockCntFixAmb->setText(QString::number(PrcOpt.minlock));
+    FixCntHoldAmb->setText(QString::number(PrcOpt.minfix));
+    ElMaskAR	 ->setText(QString::number(PrcOpt.elmaskar*R2D));
+    ElMaskHold	 ->setText(QString::number(PrcOpt.elmaskhold*R2D));
+    MaxAgeDiff	 ->setText(QString::number(PrcOpt.maxtdiff));
+    RejectGdop   ->setText(QString::number(PrcOpt.maxgdop));
+    RejectThres  ->setText(QString::number(PrcOpt.maxinno));
+    SlipThres	 ->setText(QString::number(PrcOpt.thresslip));
+    NumIter		 ->setText(QString::number(PrcOpt.niter));
+    SyncSol		 ->setCurrentIndex(PrcOpt.syncsol);
+    ExSatsE		 ->setText(ExSats);
+    NavSys1		 ->setChecked(PrcOpt.navsys&SYS_GPS);
+    NavSys2		 ->setChecked(PrcOpt.navsys&SYS_GLO);
+    NavSys3		 ->setChecked(PrcOpt.navsys&SYS_GAL);
+    NavSys4		 ->setChecked(PrcOpt.navsys&SYS_QZS);
+    NavSys5		 ->setChecked(PrcOpt.navsys&SYS_SBS);
+    NavSys6		 ->setChecked(PrcOpt.navsys&SYS_CMP);
+    NavSys7		 ->setChecked(PrcOpt.navsys&SYS_IRN);
+    PosOpt1		 ->setChecked(PrcOpt.posopt[0]);
+    PosOpt2		 ->setChecked(PrcOpt.posopt[1]);
+    PosOpt3		 ->setChecked(PrcOpt.posopt[2]);
+    PosOpt4		 ->setChecked(PrcOpt.posopt[3]);
+    PosOpt5		 ->setChecked(PrcOpt.posopt[4]);
+	
+    SolFormat	 ->setCurrentIndex(SolOpt.posf);
+    TimeFormat	 ->setCurrentIndex(SolOpt.timef==0?0:SolOpt.times+1);
+    TimeDecimal	 ->setText(QString::number(SolOpt.timeu));
+    LatLonFormat ->setCurrentIndex(SolOpt.degf);
+    FieldSep	 ->setText(SolOpt.sep);
+    OutputHead	 ->setCurrentIndex(SolOpt.outhead);
+    OutputOpt	 ->setCurrentIndex(SolOpt.outopt);
+    OutputDatum  ->setCurrentIndex(SolOpt.datum);
+    OutputHeight ->setCurrentIndex(SolOpt.height);
+    OutputGeoid  ->setCurrentIndex(SolOpt.geoid);
+    NmeaIntv1    ->setText(QString::number(SolOpt.nmeaintv[0]));
+    NmeaIntv2    ->setText(QString::number(SolOpt.nmeaintv[1]));
+    DebugStatus	 ->setCurrentIndex(DebugStatusF);
+    DebugTrace	 ->setCurrentIndex(DebugTraceF);
+	
     BaselineConst->setChecked(BaselineC);
-    BaselineLen->setValue(Baseline[0]);
-    BaselineSig->setValue(Baseline[1]);
-
-    MeasErrR1->setValue(PrcOpt.eratio[0]);
-    MeasErrR2->setValue(PrcOpt.eratio[1]);
-    MeasErr2->setValue(PrcOpt.err[1]);
-    MeasErr3->setValue(PrcOpt.err[2]);
-    MeasErr4->setValue(PrcOpt.err[3]);
-    MeasErr5->setValue(PrcOpt.err[4]);
-    PrNoise1->setText(QString::number(PrcOpt.prn[0]));
-    PrNoise2->setText(QString::number(PrcOpt.prn[1]));
-    PrNoise3->setText(QString::number(PrcOpt.prn[2]));
-    PrNoise4->setText(QString::number(PrcOpt.prn[3]));
-    PrNoise5->setText(QString::number(PrcOpt.prn[4]));
-    SatClkStab->setText(QString::number(PrcOpt.sclkstab));
-    MaxAveEp->setValue(PrcOpt.maxaveep);
+    BaselineLen->setText(QString::number(Baseline[0]));
+    BaselineSig->setText(QString::number(Baseline[1]));
+	
+    MeasErrR1	 ->setText(QString::number(PrcOpt.eratio[0]));
+    MeasErrR2	 ->setText(QString::number(PrcOpt.eratio[1]));
+    MeasErr2	 ->setText(QString::number(PrcOpt.err[1]));
+    MeasErr3	 ->setText(QString::number(PrcOpt.err[2]));
+    MeasErr4	 ->setText(QString::number(PrcOpt.err[3]));
+    MeasErr5	 ->setText(QString::number(PrcOpt.err[4]));
+    PrNoise1	 ->setText(QString::number(PrcOpt.prn[0]));
+    PrNoise2	 ->setText(QString::number(PrcOpt.prn[1]));
+    PrNoise3	 ->setText(QString::number(PrcOpt.prn[2]));
+    PrNoise4	 ->setText(QString::number(PrcOpt.prn[3]));
+    PrNoise5	 ->setText(QString::number(PrcOpt.prn[4]));
+    SatClkStab	 ->setText(QString::number(PrcOpt.sclkstab));
+    MaxAveEp	 ->setValue(PrcOpt.maxaveep);
     ChkInitRestart->setChecked(PrcOpt.initrst);
-
-    RovPosTypeP->setCurrentIndex(RovPosTypeF);
-    RefPosTypeP->setCurrentIndex(RefPosTypeF);
-    RovAntPcv->setChecked(RovAntPcvF);
-    RefAntPcv->setChecked(RefAntPcvF);
-    RovAntE->setValue(RovAntDel[0]);
-    RovAntN->setValue(RovAntDel[1]);
-    RovAntU->setValue(RovAntDel[2]);
-    RefAntE->setValue(RefAntDel[0]);
-    RefAntN->setValue(RefAntDel[1]);
-    RefAntU->setValue(RefAntDel[2]);
-    SetPos(RovPosTypeP->currentIndex(), editu, RovPos);
-    SetPos(RefPosTypeP->currentIndex(), editr, RefPos);
-
-    SatPcvFile->setText(SatPcvFileF);
-    AntPcvFile->setText(AntPcvFileF);
-    StaPosFile->setText(StaPosFileF);
+	
+    RovPosTypeP	 ->setCurrentIndex(RovPosTypeF);
+    RefPosTypeP	 ->setCurrentIndex(RefPosTypeF);
+    RovAntPcv	 ->setChecked(RovAntPcvF);
+    RefAntPcv	 ->setChecked(RefAntPcvF);
+    RovAntE		 ->setText(QString::number(RovAntDel[0]));
+    RovAntN		 ->setText(QString::number(RovAntDel[1]));
+    RovAntU		 ->setText(QString::number(RovAntDel[2]));
+    RefAntE		 ->setText(QString::number(RefAntDel[0]));
+    RefAntN		 ->setText(QString::number(RefAntDel[1]));
+    RefAntU		 ->setText(QString::number(RefAntDel[2]));
+    SetPos(RovPosTypeP->currentIndex(),editu,RovPos);
+    SetPos(RefPosTypeP->currentIndex(),editr,RefPos);
+	
+    SatPcvFile	 ->setText(SatPcvFileF);
+    AntPcvFile	 ->setText(AntPcvFileF);
+    StaPosFile	 ->setText(StaPosFileF);
     GeoidDataFile->setText(GeoidDataFileF);
-    DCBFile->setText(DCBFileF);
-    EOPFile->setText(EOPFileF);
-    TLEFile->setText(TLEFileF);
-    TLESatFile->setText(TLESatFileF);
-    LocalDir->setText(LocalDirectory);
+    DCBFile      ->setText(DCBFileF);
+    EOPFile      ->setText(EOPFileF);
+    TLEFile      ->setText(TLEFileF);
+    TLESatFile   ->setText(TLESatFileF);
+    LocalDir	 ->setText(LocalDirectory);
 	ReadAntList();
 
-    RovAnt->setCurrentIndex(RovAnt->findText(RovAntF));
-    RefAnt->setCurrentIndex(RefAnt->findText(RefAntF));
-
-    SvrCycleE->setValue(SvrCycle);
-    TimeoutTimeE->setValue(TimeoutTime);
-    ReconTimeE->setValue(ReconTime);
-    NmeaCycleE->setValue(NmeaCycle);
-    FileSwapMarginE->setValue(FileSwapMargin);
-    SvrBuffSizeE->setValue(SvrBuffSize);
-    SolBuffSizeE->setValue(SolBuffSize);
-    SavedSolE->setValue(SavedSol);
-    NavSelectS->setCurrentIndex(NavSelect);
-    SbasSatE->setValue(PrcOpt.sbassatsel);
-    ProxyAddrE->setText(ProxyAddr);
-    MoniPortE->setValue(MoniPort);
-    SolBuffSizeE->setValue(SolBuffSize);
-    PanelStackE->setCurrentIndex(PanelStack);
+    RovAnt		 ->setCurrentIndex(RovAnt->findText(RovAntF));
+    RefAnt		 ->setCurrentIndex(RefAnt->findText(RefAntF));
 
+    SvrCycleE	 ->setText(QString::number(SvrCycle));
+    TimeoutTimeE ->setText(QString::number(TimeoutTime));
+    ReconTimeE   ->setText(QString::number(ReconTime));
+    NmeaCycleE   ->setText(QString::number(NmeaCycle));
+    FileSwapMarginE->setText(QString::number(FileSwapMargin));
+    SvrBuffSizeE ->setText(QString::number(SvrBuffSize));
+    SolBuffSizeE ->setText(QString::number(SolBuffSize));
+    SavedSolE    ->setText(QString::number(SavedSol));
+    NavSelectS   ->setCurrentIndex(NavSelect);
+    SbasSatE     ->setText(QString::number(PrcOpt.sbassatsel));
+    ProxyAddrE   ->setText(ProxyAddr);
+    MoniPortE    ->setText(QString::number(MoniPort));
+    SolBuffSizeE ->setText(QString::number(SolBuffSize));
+    PanelStackE  ->setCurrentIndex(PanelStack);
+	
     FontLabel->setFont(PosFont);
-    FontLabel->setText(FontLabel->font().family() + QString::number(FontLabel->font().pointSize()) + "pt");
+    FontLabel->setText(FontLabel->font().family()+QString::number(FontLabel->font().pointSize())+"pt");
 
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
 void OptDialog::SetOpt(void)
 {
-    QString FieldSep_Text = FieldSep->text();
-    QLineEdit *editu[] = { RovPos1, RovPos2, RovPos3 };
-    QLineEdit *editr[] = { RefPos1, RefPos2, RefPos3 };
-
-    PrcOpt.mode = PosMode->currentIndex();
-    PrcOpt.nf = Freq->currentIndex() + 1;
-    PrcOpt.elmin = ElMask->currentText().toDouble() * D2R;
-    PrcOpt.dynamics = DynamicModel->currentIndex();
-    PrcOpt.tidecorr = TideCorr->currentIndex();
-    PrcOpt.ionoopt = IonoOpt->currentIndex();
-    PrcOpt.tropopt = TropOpt->currentIndex();
-    PrcOpt.sateph = SatEphem->currentIndex();
-    PrcOpt.modear = AmbRes->currentIndex();
-    PrcOpt.glomodear = GloAmbRes->currentIndex();
-    PrcOpt.bdsmodear = BdsAmbRes->currentIndex();
-    PrcOpt.thresar[0] = ValidThresAR->value();
-    PrcOpt.maxout = OutCntResetAmb->value();
-    PrcOpt.minlock = LockCntFixAmb->value();
-    PrcOpt.minfix = FixCntHoldAmb->value();
-    PrcOpt.elmaskar = ElMaskAR->value() * D2R;
-    PrcOpt.elmaskhold = ElMaskHold->value() * D2R;
-    PrcOpt.maxtdiff = MaxAgeDiff->value();
-    PrcOpt.maxgdop = RejectGdop->value();
-    PrcOpt.maxinno = RejectThres->value();
-    PrcOpt.thresslip = SlipThres->value();
-    PrcOpt.niter = NumIter->value();
-    PrcOpt.syncsol = SyncSol->currentIndex();
-    ExSats = ExSatsE->text();
-    PrcOpt.navsys = 0;
-
-    if (NavSys1->isChecked()) PrcOpt.navsys |= SYS_GPS;
-    if (NavSys2->isChecked()) PrcOpt.navsys |= SYS_GLO;
-    if (NavSys3->isChecked()) PrcOpt.navsys |= SYS_GAL;
-    if (NavSys4->isChecked()) PrcOpt.navsys |= SYS_QZS;
-    if (NavSys5->isChecked()) PrcOpt.navsys |= SYS_SBS;
-    if (NavSys6->isChecked()) PrcOpt.navsys |= SYS_CMP;
-    if (NavSys7->isChecked()) PrcOpt.navsys |= SYS_IRN;
-    PrcOpt.posopt[0] = PosOpt1->isChecked();
-    PrcOpt.posopt[1] = PosOpt2->isChecked();
-    PrcOpt.posopt[2] = PosOpt3->isChecked();
-    PrcOpt.posopt[3] = PosOpt4->isChecked();
-    PrcOpt.posopt[4] = PosOpt5->isChecked();
-
-    SolOpt.posf = SolFormat->currentIndex();
-    SolOpt.timef = TimeFormat->currentIndex() == 0 ? 0 : 1;
-    SolOpt.times = TimeFormat->currentIndex() == 0 ? 0 : TimeFormat->currentIndex() - 1;
-    SolOpt.timeu = static_cast<int>(TimeDecimal->value());
-    SolOpt.degf = LatLonFormat->currentIndex();
-    strcpy(SolOpt.sep, qPrintable(FieldSep_Text));
-    SolOpt.outhead = OutputHead->currentIndex();
-    SolOpt.outopt = OutputOpt->currentIndex();
-    PrcOpt.outsingle = OutputSingle->currentIndex();
-    SolOpt.maxsolstd = MaxSolStd->value();
-    SolOpt.datum = OutputDatum->currentIndex();
-    SolOpt.height = OutputHeight->currentIndex();
-    SolOpt.geoid = OutputGeoid->currentIndex();
-    SolOpt.nmeaintv[0] = NmeaIntv1->value();
-    SolOpt.nmeaintv[1] = NmeaIntv2->value();
-    DebugStatusF = DebugStatus->currentIndex();
-    DebugTraceF = DebugTrace->currentIndex();
-
-    BaselineC = BaselineConst->isChecked();
-    Baseline[0] = BaselineLen->value();
-    Baseline[1] = BaselineSig->value();
-
-    PrcOpt.eratio[0] = MeasErrR1->value();
-    PrcOpt.eratio[1] = MeasErrR2->value();
-    PrcOpt.err[1] = MeasErr2->value();
-    PrcOpt.err[2] = MeasErr3->value();
-    PrcOpt.err[3] = MeasErr4->value();
-    PrcOpt.err[4] = MeasErr5->value();
-    PrcOpt.prn[0] = PrNoise1->text().toDouble();
-    PrcOpt.prn[1] = PrNoise2->text().toDouble();
-    PrcOpt.prn[2] = PrNoise3->text().toDouble();
-    PrcOpt.prn[3] = PrNoise4->text().toDouble();
-    PrcOpt.prn[4] = PrNoise5->text().toDouble();
-    PrcOpt.sclkstab = SatClkStab->text().toDouble();
-    PrcOpt.maxaveep = MaxAveEp->value();
-    PrcOpt.initrst = ChkInitRestart->isChecked();
-
-    RovPosTypeF = RovPosTypeP->currentIndex();
-    RefPosTypeF = RefPosTypeP->currentIndex();
-    RovAntPcvF = RovAntPcv->isChecked();
-    RefAntPcvF = RefAntPcv->isChecked();
-    RovAntF = RovAnt->currentText();
-    RefAntF = RefAnt->currentText();
-    RovAntDel[0] = RovAntE->value();
-    RovAntDel[1] = RovAntN->value();
-    RovAntDel[2] = RovAntU->value();
-    RefAntDel[0] = RefAntE->value();
-    RefAntDel[1] = RefAntN->value();
-    RefAntDel[2] = RefAntU->value();
-    GetPos(RovPosTypeP->currentIndex(), editu, RovPos);
-    GetPos(RefPosTypeP->currentIndex(), editr, RefPos);
-
-    SatPcvFileF = SatPcvFile->text();
-    AntPcvFileF = AntPcvFile->text();
-    StaPosFileF = StaPosFile->text();
-    GeoidDataFileF = GeoidDataFile->text();
-    DCBFileF = DCBFile->text();
-    EOPFileF = EOPFile->text();
-    TLEFileF = TLEFile->text();
-    TLESatFileF = TLESatFile->text();
-    LocalDirectory = LocalDir->text();
+    QString FieldSep_Text=FieldSep->text();
+    QLineEdit *editu[]={RovPos1,RovPos2,RovPos3};
+    QLineEdit *editr[]={RefPos1,RefPos2,RefPos3};
+	
+    PrcOpt.mode      =PosMode     ->currentIndex();
+    PrcOpt.nf        =Freq        ->currentIndex()+1;
+    PrcOpt.elmin     =ElMask      ->currentText().toDouble()*D2R;
+    PrcOpt.dynamics  =DynamicModel->currentIndex();
+    PrcOpt.tidecorr  =TideCorr    ->currentIndex();
+    PrcOpt.ionoopt   =IonoOpt     ->currentIndex();
+    PrcOpt.tropopt   =TropOpt     ->currentIndex();
+    PrcOpt.sateph    =SatEphem    ->currentIndex();
+    PrcOpt.modear    =AmbRes      ->currentIndex();
+    PrcOpt.glomodear =GloAmbRes   ->currentIndex();
+    PrcOpt.bdsmodear =BdsAmbRes   ->currentIndex();
+    PrcOpt.thresar[0]=ValidThresAR->text().toDouble();
+    PrcOpt.maxout    =OutCntResetAmb->text().toInt();
+    PrcOpt.minlock   =LockCntFixAmb->text().toInt();
+    PrcOpt.minfix    =FixCntHoldAmb->text().toInt();
+    PrcOpt.elmaskar  =ElMaskAR   ->text().toDouble()*D2R;
+    PrcOpt.elmaskhold=ElMaskHold ->text().toDouble()*D2R;
+    PrcOpt.maxtdiff  =MaxAgeDiff ->text().toDouble();
+    PrcOpt.maxgdop   =RejectGdop ->text().toDouble();
+    PrcOpt.maxinno   =RejectThres->text().toDouble();
+    PrcOpt.thresslip =SlipThres  ->text().toDouble();
+    PrcOpt.niter     =NumIter     ->text().toInt();
+    PrcOpt.syncsol   =SyncSol     ->currentIndex();
+    ExSats			 =ExSatsE	  ->text();
+	PrcOpt.navsys    =0;
 
-    SvrCycle = SvrCycleE->value();
-    TimeoutTime = TimeoutTimeE->value();
-    ReconTime = ReconTimeE->value();
-    NmeaCycle = NmeaCycleE->value();
-    FileSwapMargin = FileSwapMarginE->value();
-    SvrBuffSize = SvrBuffSizeE->value();
-    SolBuffSize = SolBuffSizeE->value();
-    SavedSol = SavedSolE->value();
-    NavSelect = NavSelectS->currentIndex();
-    PrcOpt.sbassatsel = SbasSatE->value();
-    ProxyAddr = ProxyAddrE->text();
-    MoniPort = MoniPortE->value();
-    PanelStack = PanelStackE->currentIndex();
-    PosFont = FontLabel->font();
+    if (NavSys1->isChecked()) PrcOpt.navsys|=SYS_GPS;
+    if (NavSys2->isChecked()) PrcOpt.navsys|=SYS_GLO;
+    if (NavSys3->isChecked()) PrcOpt.navsys|=SYS_GAL;
+    if (NavSys4->isChecked()) PrcOpt.navsys|=SYS_QZS;
+    if (NavSys5->isChecked()) PrcOpt.navsys|=SYS_SBS;
+    if (NavSys6->isChecked()) PrcOpt.navsys|=SYS_CMP;
+    if (NavSys7->isChecked()) PrcOpt.navsys|=SYS_IRN;
+    PrcOpt.posopt[0] =PosOpt1   ->isChecked();
+    PrcOpt.posopt[1] =PosOpt2   ->isChecked();
+    PrcOpt.posopt[2] =PosOpt3   ->isChecked();
+    PrcOpt.posopt[3] =PosOpt4   ->isChecked();
+    PrcOpt.posopt[4] =PosOpt5   ->isChecked();
+	
+    SolOpt.posf      =SolFormat   ->currentIndex();
+    SolOpt.timef     =TimeFormat->currentIndex()==0?0:1;
+    SolOpt.times     =TimeFormat->currentIndex()==0?0:TimeFormat->currentIndex()-1;
+    SolOpt.timeu     =static_cast<int>(TimeDecimal->text().toDouble());
+    SolOpt.degf      =LatLonFormat->currentIndex();
+    strcpy(SolOpt.sep,qPrintable(FieldSep_Text));
+    SolOpt.outhead   =OutputHead  ->currentIndex();
+    SolOpt.outopt    =OutputOpt   ->currentIndex();
+    SolOpt.datum     =OutputDatum ->currentIndex();
+    SolOpt.height    =OutputHeight->currentIndex();
+    SolOpt.geoid     =OutputGeoid ->currentIndex();
+    SolOpt.nmeaintv[0]=NmeaIntv1->text().toDouble();
+    SolOpt.nmeaintv[1]=NmeaIntv2->text().toDouble();
+    DebugStatusF     =DebugStatus ->currentIndex();
+    DebugTraceF      =DebugTrace  ->currentIndex();
+	
+    BaselineC        =BaselineConst->isChecked();
+    Baseline[0]      =BaselineLen->text().toDouble();
+    Baseline[1]      =BaselineSig->text().toDouble();
+	
+    PrcOpt.eratio[0] =MeasErrR1 ->text().toDouble();
+    PrcOpt.eratio[1] =MeasErrR2 ->text().toDouble();
+    PrcOpt.err[1]    =MeasErr2  ->text().toDouble();
+    PrcOpt.err[2]    =MeasErr3  ->text().toDouble();
+    PrcOpt.err[3]    =MeasErr4  ->text().toDouble();
+    PrcOpt.err[4]    =MeasErr5  ->text().toDouble();
+    PrcOpt.prn[0]    =PrNoise1  ->text().toDouble();
+    PrcOpt.prn[1]    =PrNoise2  ->text().toDouble();
+    PrcOpt.prn[2]    =PrNoise3  ->text().toDouble();
+    PrcOpt.prn[3]    =PrNoise4  ->text().toDouble();
+    PrcOpt.prn[4]    =PrNoise5  ->text().toDouble();
+    PrcOpt.sclkstab  =SatClkStab->text().toDouble();
+    PrcOpt.maxaveep  =MaxAveEp  ->text().toInt();
+    PrcOpt.initrst   =ChkInitRestart->isChecked();
+	
+    RovPosTypeF      =RovPosTypeP ->currentIndex();
+    RefPosTypeF      =RefPosTypeP ->currentIndex();
+    RovAntPcvF       =RovAntPcv   ->isChecked();
+    RefAntPcvF       =RefAntPcv   ->isChecked();
+    RovAntF          =RovAnt      ->currentText();
+    RefAntF          =RefAnt      ->currentText();
+    RovAntDel[0]     =RovAntE   ->text().toDouble();
+    RovAntDel[1]     =RovAntN   ->text().toDouble();
+    RovAntDel[2]     =RovAntU   ->text().toDouble();
+    RefAntDel[0]     =RefAntE   ->text().toDouble();
+    RefAntDel[1]     =RefAntN   ->text().toDouble();
+    RefAntDel[2]     =RefAntU   ->text().toDouble();
+    GetPos(RovPosTypeP->currentIndex(),editu,RovPos);
+    GetPos(RefPosTypeP->currentIndex(),editr,RefPos);
+	
+    SatPcvFileF      =SatPcvFile  ->text();
+    AntPcvFileF      =AntPcvFile  ->text();
+    StaPosFileF      =StaPosFile  ->text();
+    GeoidDataFileF   =GeoidDataFile->text();
+    DCBFileF         =DCBFile     ->text();
+    EOPFileF         =EOPFile     ->text();
+    TLEFileF         =TLEFile     ->text();
+    TLESatFileF      =TLESatFile  ->text();
+    LocalDirectory   =LocalDir    ->text();
+	
+    SvrCycle	     =SvrCycleE   ->text().toInt();
+    TimeoutTime      =TimeoutTimeE->text().toInt();
+    ReconTime        =ReconTimeE  ->text().toInt();
+    NmeaCycle	     =NmeaCycleE  ->text().toInt();
+    FileSwapMargin   =FileSwapMarginE->text().toInt();
+    SvrBuffSize      =SvrBuffSizeE->text().toInt();
+    SolBuffSize      =SolBuffSizeE->text().toInt();
+    SavedSol         =SavedSolE   ->text().toInt();
+    NavSelect        =NavSelectS  ->currentIndex();
+    PrcOpt.sbassatsel=SbasSatE    ->text().toInt();
+    ProxyAddr        =ProxyAddrE  ->text();
+    MoniPort         =MoniPortE   ->text().toInt();
+    PanelStack       =PanelStackE ->currentIndex();
+    PosFont=FontLabel->font();
 
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
 void OptDialog::LoadOpt(const QString &file)
 {
-    int itype[] = { STR_SERIAL, STR_TCPCLI, STR_TCPSVR, STR_NTRIPCLI, STR_FILE, STR_FTP, STR_HTTP };
-    int otype[] = { STR_SERIAL, STR_TCPCLI, STR_TCPSVR, STR_NTRIPSVR, STR_NTRIPC_C, STR_FILE };
-    QLineEdit *editu[] = { RovPos1, RovPos2, RovPos3 };
-    QLineEdit *editr[] = { RefPos1, RefPos2, RefPos3 };
+    int itype[]={STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPCLI,STR_FILE,STR_FTP,STR_HTTP};
+    int otype[]={STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPSVR,STR_FILE};
+    QLineEdit *editu[]={RovPos1,RovPos2,RovPos3};
+    QLineEdit *editr[]={RefPos1,RefPos2,RefPos3};
     QString buff;
     char id[32];
 	int sat;
-    prcopt_t prcopt = prcopt_default;
-    solopt_t solopt = solopt_default;
+	prcopt_t prcopt=prcopt_default;
+	solopt_t solopt=solopt_default;
     filopt_t filopt;
 
-    memset(&filopt, 0, sizeof(filopt_t));
-
+    memset(&filopt,0,sizeof(filopt_t));
+	
 	resetsysopts();
-    if (!loadopts(qPrintable(file), sysopts) ||
-        !loadopts(qPrintable(file), rcvopts)) return;
-    getsysopts(&prcopt, &solopt, &filopt);
-
-    for (int i = 0; i < 8; i++) {
-        mainForm->StreamC[i] = strtype[i] != STR_NONE;
-        mainForm->Stream[i] = STR_NONE;
-        for (int j = 0; j < (i < 3 ? 7 : 5); j++) {
-            if (strtype[i] != (i < 3 ? itype[j] : otype[j])) continue;
-            mainForm->Stream[i] = j;
+    if (!loadopts(qPrintable(file),sysopts)||
+        !loadopts(qPrintable(file),rcvopts)) return;
+	getsysopts(&prcopt,&solopt,&filopt);
+	
+	for (int i=0;i<8;i++) {
+        mainForm->StreamC[i]=strtype[i]!=STR_NONE;
+        mainForm->Stream[i]=STR_NONE;
+		for (int j=0;j<(i<3?7:5);j++) {
+			if (strtype[i]!=(i<3?itype[j]:otype[j])) continue;
+            mainForm->Stream[i]=j;
 			break;
 		}
-        if (i < 5) mainForm->Format[i] = strfmt[i];
-
-        if (strtype[i] == STR_SERIAL)
-            mainForm->Paths[i][0] = strpath[i];
-        else if (strtype[i] == STR_FILE)
-            mainForm->Paths[i][2] = strpath[i];
-        else if (strtype[i] <= STR_NTRIPCLI)
-            mainForm->Paths[i][1] = strpath[i];
-        else if (strtype[i] <= STR_HTTP)
-            mainForm->Paths[i][3] = strpath[i];
+        if (i<5) mainForm->Format[i]=strfmt[i];
+		
+		if (strtype[i]==STR_SERIAL) {
+            mainForm->Paths[i][0]=strpath[i];
+		}
+		else if (strtype[i]==STR_FILE) {
+            mainForm->Paths[i][2]=strpath[i];
+		}
+		else if (strtype[i]<=STR_NTRIPCLI) {
+            mainForm->Paths[i][1]=strpath[i];
+		}
+		else if (strtype[i]<=STR_HTTP) {
+            mainForm->Paths[i][3]=strpath[i];
+		}
 	}
-    mainForm->NmeaReq = nmeareq;
-    mainForm->NmeaPos[0] = nmeapos[0];
-    mainForm->NmeaPos[1] = nmeapos[1];
-
-    SbasSatE->setValue(prcopt.sbassatsel);
-
-    PosMode->setCurrentIndex(prcopt.mode);
-    Freq->setCurrentIndex(prcopt.nf > NFREQ - 1 ? NFREQ - 1 : prcopt.nf - 1);
-    Solution->setCurrentIndex(prcopt.soltype);
-    ElMask->setCurrentIndex(ElMask->findText(QString::number(prcopt.elmin * R2D, 'f', 0)));
-    DynamicModel->setCurrentIndex(prcopt.dynamics);
-    TideCorr->setCurrentIndex(prcopt.tidecorr);
-    IonoOpt->setCurrentIndex(prcopt.ionoopt);
-    TropOpt->setCurrentIndex(prcopt.tropopt);
-    SatEphem->setCurrentIndex(prcopt.sateph);
-    ExSatsE->setText("");
-    for (sat = 1; sat <= MAXSAT; sat++) {
-        if (!prcopt.exsats[sat - 1]) continue;
-        satno2id(sat, id);
-        buff += QString(buff.isEmpty() ? "" : " ") + (prcopt.exsats[sat - 1] == 2 ? "+" : "") + id;
+    mainForm->NmeaReq=nmeareq;
+    mainForm->NmeaPos[0]=nmeapos[0];
+    mainForm->NmeaPos[1]=nmeapos[1];
+	
+    SbasSatE     ->setText(QString::number(prcopt.sbassatsel));
+	
+    PosMode		 ->setCurrentIndex(prcopt.mode);
+    Freq		 ->setCurrentIndex(prcopt.nf>NFREQ-1?NFREQ-1:prcopt.nf-1);
+    Solution	 ->setCurrentIndex(prcopt.soltype);
+    ElMask		 ->setCurrentIndex(ElMask->findText(QString::number(prcopt.elmin*R2D,'f',0)));
+    DynamicModel ->setCurrentIndex(prcopt.dynamics);
+    TideCorr	 ->setCurrentIndex(prcopt.tidecorr);
+    IonoOpt		 ->setCurrentIndex(prcopt.ionoopt);
+    TropOpt		 ->setCurrentIndex(prcopt.tropopt);
+    SatEphem	 ->setCurrentIndex(prcopt.sateph);
+    ExSatsE	     ->setText("");
+    for (sat=1;sat<=MAXSAT;sat++) {
+		if (!prcopt.exsats[sat-1]) continue;
+		satno2id(sat,id);
+        buff+=QString(buff.isEmpty()?"":" ")+(prcopt.exsats[sat-1]==2?"+":"")+id;
 	}
-    ExSatsE->setText(buff);
-    NavSys1->setChecked(prcopt.navsys & SYS_GPS);
-    NavSys2->setChecked(prcopt.navsys & SYS_GLO);
-    NavSys3->setChecked(prcopt.navsys & SYS_GAL);
-    NavSys4->setChecked(prcopt.navsys & SYS_QZS);
-    NavSys5->setChecked(prcopt.navsys & SYS_SBS);
-    NavSys6->setChecked(prcopt.navsys & SYS_CMP);
-    NavSys7->setChecked(prcopt.navsys & SYS_IRN);
-    PosOpt1->setChecked(prcopt.posopt[0]);
-    PosOpt2->setChecked(prcopt.posopt[1]);
-    PosOpt3->setChecked(prcopt.posopt[2]);
-    PosOpt4->setChecked(prcopt.posopt[3]);
-    PosOpt5->setChecked(prcopt.posopt[4]);
-
-    AmbRes->setCurrentIndex(prcopt.modear);
-    GloAmbRes->setCurrentIndex(prcopt.glomodear);
-    BdsAmbRes->setCurrentIndex(prcopt.bdsmodear);
-    ValidThresAR->setValue(prcopt.thresar[0]);
-    OutCntResetAmb->setValue(prcopt.maxout);
-    FixCntHoldAmb->setValue(prcopt.minfix);
-    LockCntFixAmb->setValue(prcopt.minlock);
-    ElMaskAR->setValue(prcopt.elmaskar * R2D);
-    ElMaskHold->setValue(prcopt.elmaskhold * R2D);
-    MaxAgeDiff->setValue(prcopt.maxtdiff);
-    RejectGdop->setValue(prcopt.maxgdop);
-    RejectThres->setValue(prcopt.maxinno);
-    SlipThres->setValue(prcopt.thresslip);
-    NumIter->setValue(prcopt.niter);
-    SyncSol->setCurrentIndex(prcopt.syncsol);
-    BaselineLen->setValue(prcopt.baseline[0]);
-    BaselineSig->setValue(prcopt.baseline[1]);
-    BaselineConst->setChecked(prcopt.baseline[0] > 0.0);
-
-    SolFormat->setCurrentIndex(solopt.posf);
-    TimeFormat->setCurrentIndex(solopt.timef == 0 ? 0 : solopt.times + 1);
-    TimeDecimal->setValue(solopt.timeu);
-    LatLonFormat->setCurrentIndex(solopt.degf);
-    FieldSep->setText(solopt.sep);
-    OutputHead->setCurrentIndex(solopt.outhead);
-    OutputOpt->setCurrentIndex(solopt.outopt);
-    OutputSingle->setCurrentIndex(prcopt.outsingle);
-    MaxSolStd->setValue(solopt.maxsolstd);
-    OutputDatum->setCurrentIndex(solopt.datum);
-    OutputHeight->setCurrentIndex(solopt.height);
-    OutputGeoid->setCurrentIndex(solopt.geoid);
-    NmeaIntv1->setValue(solopt.nmeaintv[0]);
-    NmeaIntv2->setValue(solopt.nmeaintv[1]);
-    DebugTrace->setCurrentIndex(solopt.trace);
-    DebugStatus->setCurrentIndex(solopt.sstat);
-
-    MeasErrR1->setValue(prcopt.eratio[0]);
-    MeasErrR2->setValue(prcopt.eratio[1]);
-    MeasErr2->setValue(prcopt.err[1]);
-    MeasErr3->setValue(prcopt.err[2]);
-    MeasErr4->setValue(prcopt.err[3]);
-    MeasErr5->setValue(prcopt.err[4]);
-    SatClkStab->setText(QString::number(prcopt.sclkstab));
-    PrNoise1->setText(QString::number(prcopt.prn[0]));
-    PrNoise2->setText(QString::number(prcopt.prn[1]));
-    PrNoise3->setText(QString::number(prcopt.prn[2]));
-    PrNoise4->setText(QString::number(prcopt.prn[3]));
-    PrNoise5->setText(QString::number(prcopt.prn[4]));
-
-    RovAntPcv->setChecked(*prcopt.anttype[0]);
-    RefAntPcv->setChecked(*prcopt.anttype[1]);
-    RovAnt->setCurrentIndex(RovAnt->findText(prcopt.anttype[0]));
-    RefAnt->setCurrentIndex(RefAnt->findText(prcopt.anttype[1]));
-    RovAntE->setValue(prcopt.antdel[0][0]);
-    RovAntN->setValue(prcopt.antdel[0][1]);
-    RovAntU->setValue(prcopt.antdel[0][2]);
-    RefAntE->setValue(prcopt.antdel[1][0]);
-    RefAntN->setValue(prcopt.antdel[1][1]);
-    RefAntU->setValue(prcopt.antdel[1][2]);
-    MaxAveEp->setValue(prcopt.maxaveep);
-
+    ExSatsE		 ->setText(buff);
+    NavSys1	     ->setChecked(prcopt.navsys&SYS_GPS);
+    NavSys2	     ->setChecked(prcopt.navsys&SYS_GLO);
+    NavSys3	     ->setChecked(prcopt.navsys&SYS_GAL);
+    NavSys4	     ->setChecked(prcopt.navsys&SYS_QZS);
+    NavSys5	     ->setChecked(prcopt.navsys&SYS_SBS);
+    NavSys6	     ->setChecked(prcopt.navsys&SYS_CMP);
+    NavSys7	     ->setChecked(prcopt.navsys&SYS_IRN);
+    PosOpt1		 ->setChecked(prcopt.posopt[0]);
+    PosOpt2		 ->setChecked(prcopt.posopt[1]);
+    PosOpt3		 ->setChecked(prcopt.posopt[2]);
+    PosOpt4		 ->setChecked(prcopt.posopt[3]);
+    PosOpt5		 ->setChecked(prcopt.posopt[4]);
+	
+    AmbRes		 ->setCurrentIndex(prcopt.modear);
+    GloAmbRes	 ->setCurrentIndex(prcopt.glomodear);
+    BdsAmbRes	 ->setCurrentIndex(prcopt.bdsmodear);
+    ValidThresAR ->setText(QString::number(prcopt.thresar[0],'f',1));
+    OutCntResetAmb->setText(QString::number(prcopt.maxout   ));
+    FixCntHoldAmb->setText(QString::number(prcopt.minfix   ));
+    LockCntFixAmb->setText(QString::number(prcopt.minlock  ));
+    ElMaskAR	 ->setText(QString::number(prcopt.elmaskar*R2D,'f',0));
+    ElMaskHold	 ->setText(QString::number(prcopt.elmaskhold*R2D,'f',0));
+    MaxAgeDiff	 ->setText(QString::number(prcopt.maxtdiff ,'f',1));
+    RejectGdop   ->setText(QString::number(prcopt.maxgdop  ,'f',1));
+    RejectThres  ->setText(QString::number(prcopt.maxinno  ,'f',1));
+    SlipThres	 ->setText(QString::number(prcopt.thresslip,'f',3));
+    NumIter		 ->setText(QString::number(prcopt.niter    ));
+    SyncSol		 ->setCurrentIndex(prcopt.syncsol);
+    BaselineLen	 ->setText(QString::number(prcopt.baseline[0],'f',3));
+    BaselineSig	 ->setText(QString::number(prcopt.baseline[1],'f',3));
+    BaselineConst->setChecked(prcopt.baseline[0]>0.0);
+	
+    SolFormat	 ->setCurrentIndex(solopt.posf);
+    TimeFormat	 ->setCurrentIndex(solopt.timef==0?0:solopt.times+1);
+    TimeDecimal	 ->setText(QString::number(solopt.timeu));
+    LatLonFormat ->setCurrentIndex(solopt.degf);
+    FieldSep	 ->setText(solopt.sep);
+    OutputHead	 ->setCurrentIndex(solopt.outhead);
+    OutputOpt	 ->setCurrentIndex(solopt.outopt);
+    OutputDatum  ->setCurrentIndex(solopt.datum);
+    OutputHeight ->setCurrentIndex(solopt.height);
+    OutputGeoid  ->setCurrentIndex(solopt.geoid);
+    NmeaIntv1	 ->setText(QString::number(solopt.nmeaintv[0],'g',2));
+    NmeaIntv2	 ->setText(QString::number(solopt.nmeaintv[1],'g',2));
+    DebugTrace	 ->setCurrentIndex(solopt.trace);
+    DebugStatus	 ->setCurrentIndex(solopt.sstat);
+	
+    MeasErrR1	 ->setText(QString::number(prcopt.eratio[0],'f',1));
+    MeasErrR2	 ->setText(QString::number(prcopt.eratio[1],'f',3));
+    MeasErr2	 ->setText(QString::number(prcopt.err[1],'f',3));
+    MeasErr3	 ->setText(QString::number(prcopt.err[2],'f',3));
+    MeasErr4	 ->setText(QString::number(prcopt.err[3],'f',3));
+    MeasErr5	 ->setText(QString::number(prcopt.err[4],'f',3));
+    SatClkStab	 ->setText(QString::number(prcopt.sclkstab,'E',2));
+    PrNoise1	 ->setText(QString::number(prcopt.prn[0],'E',2));
+    PrNoise2	 ->setText(QString::number(prcopt.prn[1],'E',2));
+    PrNoise3	 ->setText(QString::number(prcopt.prn[2],'E',2));
+    PrNoise4	 ->setText(QString::number(prcopt.prn[3],'E',2));
+    PrNoise5	 ->setText(QString::number(prcopt.prn[4],'E',2));
+	
+    RovAntPcv	 ->setChecked(*prcopt.anttype[0]);
+    RefAntPcv	 ->setChecked(*prcopt.anttype[1]);
+    RovAnt		 ->setCurrentIndex(RovAnt->findText(prcopt.anttype[0]));
+    RefAnt		 ->setCurrentIndex(RefAnt->findText(prcopt.anttype[1]));
+    RovAntE		 ->setText(QString::number(prcopt.antdel[0][0],'f',4));
+    RovAntN		 ->setText(QString::number(prcopt.antdel[0][1],'f',4));
+    RovAntU		 ->setText(QString::number(prcopt.antdel[0][2],'f',4));
+    RefAntE		 ->setText(QString::number(prcopt.antdel[1][0],'f',4));
+    RefAntN		 ->setText(QString::number(prcopt.antdel[1][1],'f',4));
+    RefAntU		 ->setText(QString::number(prcopt.antdel[1][2],'f',4));
+    MaxAveEp	 ->setValue(prcopt.maxaveep);
+	
     ChkInitRestart->setChecked(prcopt.initrst);
 
-    RovPosTypeP->setCurrentIndex(0);
-    RefPosTypeP->setCurrentIndex(0);
-    if (prcopt.refpos == POSOPT_RTCM) RefPosTypeP->setCurrentIndex(3);
-    else if (prcopt.refpos == POSOPT_RAW) RefPosTypeP->setCurrentIndex(4);
-    else if (prcopt.refpos == POSOPT_SINGLE) RefPosTypeP->setCurrentIndex(5);
-
-    RovPosTypeF = RovPosTypeP->currentIndex();
-    RefPosTypeF = RefPosTypeP->currentIndex();
-    SetPos(RovPosTypeP->currentIndex(), editu, prcopt.ru);
-    SetPos(RefPosTypeP->currentIndex(), editr, prcopt.rb);
+    RovPosTypeP	 ->setCurrentIndex(0);
+    RefPosTypeP	 ->setCurrentIndex(0);
+    if      (prcopt.refpos==POSOPT_RTCM  ) RefPosTypeP->setCurrentIndex(3);
+    else if (prcopt.refpos==POSOPT_RAW   ) RefPosTypeP->setCurrentIndex(4);
+    else if (prcopt.refpos==POSOPT_SINGLE) RefPosTypeP->setCurrentIndex(5);
 
-    SatPcvFile->setText(filopt.satantp);
-    AntPcvFile->setText(filopt.rcvantp);
-    StaPosFile->setText(filopt.stapos);
+    RovPosTypeF					=RovPosTypeP->currentIndex();
+    RefPosTypeF					=RefPosTypeP->currentIndex();
+    SetPos(RovPosTypeP->currentIndex(),editu,prcopt.ru);
+    SetPos(RefPosTypeP->currentIndex(),editr,prcopt.rb);
+	
+    SatPcvFile ->setText(filopt.satantp);
+    AntPcvFile ->setText(filopt.rcvantp);
+    StaPosFile ->setText(filopt.stapos);
     GeoidDataFile->setText(filopt.geoid);
-    DCBFile->setText(filopt.dcb);
-    LocalDir->setText(filopt.tempdir);
-
+    DCBFile    ->setText(filopt.dcb);
+    LocalDir   ->setText(filopt.tempdir);
+	
 	ReadAntList();
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
 void OptDialog::SaveOpt(const QString &file)
 {
-    QString ProxyAddrE_Text = ProxyAddrE->text();
-    QString ExSatsE_Text = ExSatsE->text();
-    QString FieldSep_Text = FieldSep->text();
-    QString RovAnt_Text = RovAnt->currentText(), RefAnt_Text = RefAnt->currentText();
-    QString SatPcvFile_Text = SatPcvFile->text();
-    QString AntPcvFile_Text = AntPcvFile->text();
-    QString StaPosFile_Text = StaPosFile->text();
-    QString GeoidDataFile_Text = GeoidDataFile->text();
-    QString DCBFile_Text = DCBFile->text();
-    QString LocalDir_Text = LocalDir->text();
-    int itype[] = { STR_SERIAL, STR_TCPCLI, STR_TCPSVR, STR_NTRIPCLI, STR_FILE, STR_FTP, STR_HTTP };
-    int otype[] = { STR_SERIAL, STR_TCPCLI, STR_TCPSVR, STR_NTRIPSVR, STR_NTRIPC_C, STR_FILE };
-    QLineEdit *editu[] = { RovPos1, RovPos2, RovPos3 };
-    QLineEdit *editr[] = { RefPos1, RefPos2, RefPos3 };
-    char buff[1024], *p, *q, comment[256], s[64];
-    int sat, ex;
-    prcopt_t prcopt = prcopt_default;
-    solopt_t solopt = solopt_default;
+    QString ProxyAddrE_Text=ProxyAddrE->text();
+    QString ExSatsE_Text=ExSatsE->text();
+    QString FieldSep_Text=FieldSep->text();
+    QString RovAnt_Text=RovAnt->currentText(),RefAnt_Text=RefAnt->currentText();
+    QString SatPcvFile_Text=SatPcvFile->text();
+    QString AntPcvFile_Text=AntPcvFile->text();
+    QString StaPosFile_Text=StaPosFile->text();
+    QString GeoidDataFile_Text=GeoidDataFile->text();
+    QString DCBFile_Text=DCBFile->text();
+    QString LocalDir_Text=LocalDir->text();
+    int itype[]={STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPCLI,STR_FILE,STR_FTP,STR_HTTP};
+    int otype[]={STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPSVR,STR_FILE};
+    QLineEdit *editu[]={RovPos1,RovPos2,RovPos3};
+    QLineEdit *editr[]={RefPos1,RefPos2,RefPos3};
+    char buff[1024],*p,comment[256],s[64];
+	int sat,ex;
+	prcopt_t prcopt=prcopt_default;
+	solopt_t solopt=solopt_default;
     filopt_t filopt;
+	
+    memset(&filopt,0,sizeof(filopt_t));
 
-    memset(&filopt, 0, sizeof(filopt_t));
-
-    for (int i = 0; i < 8; i++) {
-        strtype[i] = i < 3 ? itype[mainForm->Stream[i]] : otype[mainForm->Stream[i]];
-        strfmt[i] = mainForm->Format[i];
-
+	for (int i=0;i<8;i++) {
+        strtype[i]=i<3?itype[mainForm->Stream[i]]:otype[mainForm->Stream[i]];
+        strfmt[i]=mainForm->Format[i];
+		
         if (!mainForm->StreamC[i]) {
-            strtype[i] = STR_NONE;
-            strcpy(strpath[i], "");
-        } else if (strtype[i] == STR_SERIAL) {
-            strcpy(strpath[i], qPrintable(mainForm->Paths[i][0]));
-        } else if (strtype[i] == STR_FILE) {
-            strcpy(strpath[i], qPrintable(mainForm->Paths[i][2]));
-        } else if (strtype[i] == STR_TCPSVR) {
-            strcpy(buff,qPrintable(mainForm->Paths[i][1]));
-            if ((p=strchr(buff,'/'))) *p='\0'; // TODO
-            if ((p=strrchr(buff,':'))) {
-                strcpy(strpath[i],p);
-            }
-            else {
-                strcpy(strpath[i],"");
-            }
-        }
-        else if (strtype[i]==STR_TCPCLI) {
-            strcpy(buff,qPrintable(mainForm->Paths[i][1]));
-            if ((p=strchr(buff,'/'))) *p='\0';
-            if ((p=strrchr(buff,'@'))) {
-                strcpy(strpath[i],p+1);
-            }
-            else {
-                strcpy(strpath[i],buff);
-            }
-        }
-        else if (strtype[i]==STR_NTRIPSVR) {
-            strcpy(buff,qPrintable(mainForm->Paths[i][1]));
-            if ((p=strchr(buff,':'))&&strchr(p+1,'@')) {
-                strcpy(strpath[i],p);
-            }
-            else {
-                strcpy(strpath[i],buff);
-            }
-        }
-        else if (strtype[i]==STR_NTRIPCLI) {
-            strcpy(buff,qPrintable(mainForm->Paths[i][1]));
-            if ((p=strchr(buff,'/'))&&(q=strchr(p+1,':'))) *q='\0';
-            strcpy(strpath[i],buff);
-        }
-        else if (strtype[i]==STR_NTRIPC_S||strtype[i]==STR_NTRIPC_C) {
-            strcpy(buff,qPrintable(mainForm->Paths[i][1]));
-            if ((p=strchr(buff,'/'))&&(q=strchr(p+1,':'))) *q='\0';
-            if ((p=strchr(buff,'@'))) {
-                *(p+1)='\0';
-                strcpy(strpath[i],buff);
-            }
-            if ((p=strchr(p?p+2:buff,':'))) {
-                strcat(strpath[i],p);
-            }
-        } else if (strtype[i]==STR_FTP||strtype[i]==STR_HTTP)
-        {
-            strcpy(strpath[i], qPrintable(mainForm->Paths[i][3]));
+			strtype[i]=STR_NONE;
+			strcpy(strpath[i],"");
+		}
+		else if (strtype[i]==STR_SERIAL) {
+            strcpy(strpath[i],qPrintable(mainForm->Paths[i][0]));
+		}
+		else if (strtype[i]==STR_FILE) {
+            strcpy(strpath[i],qPrintable(mainForm->Paths[i][2]));
+		}
+		else if (strtype[i]<=STR_NTRIPCLI) {
+            strcpy(strpath[i],qPrintable(mainForm->Paths[i][1]));
+		}
+		else if (strtype[i]<=STR_HTTP) {
+            strcpy(strpath[i],qPrintable(mainForm->Paths[i][3]));
 		}
 	}
-    nmeareq = mainForm->NmeaReq;
-    nmeapos[0] = mainForm->NmeaPos[0];
-    nmeapos[1] = mainForm->NmeaPos[1];
+    nmeareq   =mainForm->NmeaReq;
+    nmeapos[0]=mainForm->NmeaPos[0];
+    nmeapos[1]=mainForm->NmeaPos[1];
 
-    svrcycle = SvrCycleE->value();
-    timeout = TimeoutTimeE->value();
-    reconnect = ReconTimeE->value();
-    nmeacycle = NmeaCycleE->value();
-    buffsize = SvrBuffSizeE->value();
-    navmsgsel = NavSelectS->currentIndex();
-    strcpy(proxyaddr, qPrintable(ProxyAddrE_Text));
-    fswapmargin = FileSwapMarginE->value();
-    prcopt.sbassatsel = SbasSatE->value();
+    svrcycle    =SvrCycleE   ->text().toInt();
+    timeout     =TimeoutTimeE->text().toInt();
+    reconnect   =ReconTimeE  ->text().toInt();
+    nmeacycle   =NmeaCycleE  ->text().toInt();
+    buffsize    =SvrBuffSizeE->text().toInt();
+    navmsgsel   =NavSelectS  ->currentIndex();
+    strcpy(proxyaddr,qPrintable(ProxyAddrE_Text));
+    fswapmargin =FileSwapMarginE->text().toInt();
+    prcopt.sbassatsel=SbasSatE->text().toInt();
 
-    prcopt.mode = PosMode->currentIndex();
-    prcopt.nf = Freq->currentIndex() + 1;
-    prcopt.soltype = Solution->currentIndex();
-    prcopt.elmin = ElMask->currentText().toDouble() * D2R;
-    prcopt.dynamics = DynamicModel->currentIndex();
-    prcopt.tidecorr = TideCorr->currentIndex();
-    prcopt.ionoopt = IonoOpt->currentIndex();
-    prcopt.tropopt = TropOpt->currentIndex();
-    prcopt.sateph = SatEphem->currentIndex();
-    if (ExSatsE->text() != "") {
-        strcpy(buff, qPrintable(ExSatsE_Text));
-        for (p = strtok(buff, " "); p; p = strtok(NULL, " ")) {
-            if (*p == '+') {
-                ex = 2; p++;
-            } else {
-                ex = 1;
-            }
-            if (!(sat = satid2no(p))) continue;
-            prcopt.exsats[sat - 1] = (unsigned char)ex;
+    prcopt.mode		=PosMode	 ->currentIndex();
+    prcopt.nf		=Freq		 ->currentIndex()+1;
+    prcopt.soltype	=Solution	 ->currentIndex();
+    prcopt.elmin	=ElMask	->currentText().toDouble()*D2R;
+    prcopt.dynamics	=DynamicModel->currentIndex();
+    prcopt.tidecorr	=TideCorr	 ->currentIndex();
+    prcopt.ionoopt	=IonoOpt	 ->currentIndex();
+    prcopt.tropopt	=TropOpt	 ->currentIndex();
+    prcopt.sateph	=SatEphem	 ->currentIndex();
+    if (ExSatsE->text()!="") {
+        strcpy(buff,qPrintable(ExSatsE_Text));
+		for (p=strtok(buff," ");p;p=strtok(NULL," ")) {
+			if (*p=='+') {ex=2; p++;} else ex=1;
+			if (!(sat=satid2no(p))) continue;
+			prcopt.exsats[sat-1]=ex;
 		}
 	}
-    prcopt.navsys = (NavSys1->isChecked() ? SYS_GPS : 0) |
-            (NavSys2->isChecked() ? SYS_GLO : 0) |
-            (NavSys3->isChecked() ? SYS_GAL : 0) |
-            (NavSys4->isChecked() ? SYS_QZS : 0) |
-            (NavSys5->isChecked() ? SYS_SBS : 0) |
-            (NavSys6->isChecked() ? SYS_CMP : 0) |
-            (NavSys7->isChecked() ? SYS_IRN : 0);
-    prcopt.posopt[0] = PosOpt1->isChecked();
-    prcopt.posopt[1] = PosOpt2->isChecked();
-    prcopt.posopt[2] = PosOpt3->isChecked();
-    prcopt.posopt[3] = PosOpt4->isChecked();
-    prcopt.posopt[4] = PosOpt5->isChecked();
-
-    prcopt.modear = AmbRes->currentIndex();
-    prcopt.glomodear = GloAmbRes->currentIndex();
-    prcopt.bdsmodear = BdsAmbRes->currentIndex();
-    prcopt.thresar[0] = ValidThresAR->value();
-    prcopt.maxout = OutCntResetAmb->value();
-    prcopt.minfix = FixCntHoldAmb->value();
-    prcopt.minlock = LockCntFixAmb->value();
-    prcopt.elmaskar = ElMaskAR->value() * D2R;
-    prcopt.elmaskhold = ElMaskHold->value() * D2R;
-    prcopt.maxtdiff = MaxAgeDiff->value();
-    prcopt.maxgdop = RejectGdop->value();
-    prcopt.maxinno = RejectThres->value();
-    prcopt.thresslip = SlipThres->value();
-    prcopt.niter = NumIter->value();
-    prcopt.syncsol = SyncSol->currentIndex();
-    if (prcopt.mode == PMODE_MOVEB && BaselineConst->isChecked()) {
-        prcopt.baseline[0] = BaselineLen->value();
-        prcopt.baseline[1] = BaselineSig->value();
+    prcopt.navsys	= (NavSys1->isChecked()?SYS_GPS:0)|
+                      (NavSys2->isChecked()?SYS_GLO:0)|
+                      (NavSys3->isChecked()?SYS_GAL:0)|
+                      (NavSys4->isChecked()?SYS_QZS:0)|
+                      (NavSys5->isChecked()?SYS_SBS:0)|
+                      (NavSys6->isChecked()?SYS_CMP:0)|
+                      (NavSys7->isChecked()?SYS_IRN:0);
+    prcopt.posopt[0]=PosOpt1->isChecked();
+    prcopt.posopt[1]=PosOpt2->isChecked();
+    prcopt.posopt[2]=PosOpt3->isChecked();
+    prcopt.posopt[3]=PosOpt4->isChecked();
+    prcopt.posopt[4]=PosOpt5->isChecked();
+	
+    prcopt.modear	=AmbRes		->currentIndex();
+    prcopt.glomodear=GloAmbRes	->currentIndex();
+    prcopt.bdsmodear=BdsAmbRes	->currentIndex();
+    prcopt.thresar[0]=ValidThresAR->text().toDouble();
+    prcopt.maxout	=OutCntResetAmb->text().toInt();
+    prcopt.minfix	=FixCntHoldAmb->text().toInt();
+    prcopt.minlock	=LockCntFixAmb->text().toInt();
+    prcopt.elmaskar	=ElMaskAR	->text().toDouble()*D2R;
+    prcopt.elmaskhold=ElMaskHold->text().toDouble()*D2R;
+    prcopt.maxtdiff	=MaxAgeDiff	->text().toDouble();
+    prcopt.maxgdop	=RejectGdop ->text().toDouble();
+    prcopt.maxinno	=RejectThres->text().toDouble();
+    prcopt.thresslip=SlipThres	->text().toDouble();
+    prcopt.niter	=NumIter	->text().toInt();
+    prcopt.syncsol	=SyncSol->currentIndex();
+    if (prcopt.mode==PMODE_MOVEB&&BaselineConst->isChecked()) {
+        prcopt.baseline[0]=BaselineLen->text().toDouble();
+        prcopt.baseline[1]=BaselineSig->text().toDouble();
 	}
-    solopt.posf = SolFormat->currentIndex();
-    solopt.timef = TimeFormat->currentIndex() == 0 ? 0 : 1;
-    solopt.times = TimeFormat->currentIndex() == 0 ? 0 : TimeFormat->currentIndex() - 1;
-    solopt.timeu = TimeDecimal->value();
-    solopt.degf = LatLonFormat->currentIndex();
-    strcpy(solopt.sep, qPrintable(FieldSep_Text));
-    solopt.outhead = OutputHead->currentIndex();
-    solopt.outopt = OutputOpt->currentIndex();
-    prcopt.outsingle = OutputSingle->currentIndex();
-    solopt.maxsolstd = MaxSolStd->value();
-    solopt.datum = OutputDatum->currentIndex();
-    solopt.height = OutputHeight->currentIndex();
-    solopt.geoid = OutputGeoid->currentIndex();
-    solopt.nmeaintv[0] = NmeaIntv1->value();
-    solopt.nmeaintv[1] = NmeaIntv2->value();
-    solopt.trace = DebugTrace->currentIndex();
-    solopt.sstat = DebugStatus->currentIndex();
-
-    prcopt.eratio[0] = MeasErrR1->value();
-    prcopt.eratio[1] = MeasErrR2->value();
-    prcopt.err[1] = MeasErr2->value();
-    prcopt.err[2] = MeasErr3->value();
-    prcopt.err[3] = MeasErr4->value();
-    prcopt.err[4] = MeasErr5->value();
-    prcopt.sclkstab = SatClkStab->text().toDouble();
-    prcopt.prn[0] = PrNoise1->text().toDouble();
-    prcopt.prn[1] = PrNoise2->text().toDouble();
-    prcopt.prn[2] = PrNoise3->text().toDouble();
-    prcopt.prn[3] = PrNoise4->text().toDouble();
-    prcopt.prn[4] = PrNoise5->text().toDouble();
-
-    if (RovAntPcv->isChecked()) strcpy(prcopt.anttype[0], qPrintable(RovAnt_Text));
-    if (RefAntPcv->isChecked()) strcpy(prcopt.anttype[1], qPrintable(RefAnt_Text));
-    prcopt.antdel[0][0] = RovAntE->value();
-    prcopt.antdel[0][1] = RovAntN->value();
-    prcopt.antdel[0][2] = RovAntU->value();
-    prcopt.antdel[1][0] = RefAntE->value();
-    prcopt.antdel[1][1] = RefAntN->value();
-    prcopt.antdel[1][2] = RefAntU->value();
-    prcopt.maxaveep = MaxAveEp->value();
-    prcopt.initrst = ChkInitRestart->isChecked();
-
-    prcopt.rovpos = POSOPT_POS;
-    prcopt.refpos = POSOPT_POS;
-    if (RefPosTypeP->currentIndex() == 3) prcopt.refpos = POSOPT_RTCM;
-    else if (RefPosTypeP->currentIndex() == 4) prcopt.refpos = POSOPT_RAW;
-    else if (RefPosTypeP->currentIndex() == 5) prcopt.refpos = POSOPT_SINGLE;
-
-    if (prcopt.rovpos == POSOPT_POS) GetPos(RovPosTypeP->currentIndex(), editu, prcopt.ru);
-    if (prcopt.refpos == POSOPT_POS) GetPos(RefPosTypeP->currentIndex(), editr, prcopt.rb);
-
-    strcpy(filopt.satantp, qPrintable(SatPcvFile_Text));
-    strcpy(filopt.rcvantp, qPrintable(AntPcvFile_Text));
+    solopt.posf		=SolFormat	->currentIndex();
+    solopt.timef	=TimeFormat	->currentIndex()==0?0:1;
+    solopt.times	=TimeFormat	->currentIndex()==0?0:TimeFormat->currentIndex()-1;
+    solopt.timeu	=TimeDecimal ->text().toInt();
+    solopt.degf		=LatLonFormat->currentIndex();
+    strcpy(solopt.sep,qPrintable(FieldSep_Text));
+    solopt.outhead	=OutputHead	 ->currentIndex();
+    solopt.outopt	=OutputOpt	 ->currentIndex();
+    solopt.datum	=OutputDatum ->currentIndex();
+    solopt.height	=OutputHeight->currentIndex();
+    solopt.geoid	=OutputGeoid ->currentIndex();
+    solopt.nmeaintv[0]=NmeaIntv1->text().toDouble();
+    solopt.nmeaintv[1]=NmeaIntv2->text().toDouble();
+    solopt.trace	=DebugTrace	 ->currentIndex();
+    solopt.sstat	=DebugStatus ->currentIndex();
+	
+    prcopt.eratio[0]=MeasErrR1->text().toDouble();
+    prcopt.eratio[1]=MeasErrR2->text().toDouble();
+    prcopt.err[1]	=MeasErr2->text().toDouble();
+    prcopt.err[2]	=MeasErr3->text().toDouble();
+    prcopt.err[3]	=MeasErr4->text().toDouble();
+    prcopt.err[4]	=MeasErr5->text().toDouble();
+    prcopt.sclkstab	=SatClkStab->text().toDouble();
+    prcopt.prn[0]	=PrNoise1->text().toDouble();
+    prcopt.prn[1]	=PrNoise2->text().toDouble();
+    prcopt.prn[2]	=PrNoise3->text().toDouble();
+    prcopt.prn[3]	=PrNoise4->text().toDouble();
+    prcopt.prn[4]	=PrNoise5->text().toDouble();
+	
+    if (RovAntPcv->isChecked()) strcpy(prcopt.anttype[0],qPrintable(RovAnt_Text));
+    if (RefAntPcv->isChecked()) strcpy(prcopt.anttype[1],qPrintable(RefAnt_Text));
+    prcopt.antdel[0][0]=RovAntE->text().toDouble();
+    prcopt.antdel[0][1]=RovAntN->text().toDouble();
+    prcopt.antdel[0][2]=RovAntU->text().toDouble();
+    prcopt.antdel[1][0]=RefAntE->text().toDouble();
+    prcopt.antdel[1][1]=RefAntN->text().toDouble();
+    prcopt.antdel[1][2]=RefAntU->text().toDouble();
+    prcopt.maxaveep=MaxAveEp->text().toInt();
+    prcopt.initrst=ChkInitRestart->isChecked();
+	
+    prcopt.rovpos=POSOPT_POS;
+    prcopt.refpos=POSOPT_POS;
+    if      (RefPosTypeP->currentIndex()==3) prcopt.refpos=POSOPT_RTCM;
+    else if (RefPosTypeP->currentIndex()==4) prcopt.refpos=POSOPT_RAW;
+    else if (RefPosTypeP->currentIndex()==5) prcopt.refpos=POSOPT_SINGLE;
+	
+    if (prcopt.rovpos==POSOPT_POS) GetPos(RovPosTypeP->currentIndex(),editu,prcopt.ru);
+    if (prcopt.refpos==POSOPT_POS) GetPos(RefPosTypeP->currentIndex(),editr,prcopt.rb);
+	
+    strcpy(filopt.satantp,qPrintable(SatPcvFile_Text));
+    strcpy(filopt.rcvantp,qPrintable(AntPcvFile_Text));
     strcpy(filopt.stapos, qPrintable(StaPosFile_Text));
-    strcpy(filopt.geoid, qPrintable(GeoidDataFile_Text));
-    strcpy(filopt.dcb, qPrintable(DCBFile_Text));
-    strcpy(filopt.tempdir, qPrintable(LocalDir_Text));
-
-    time2str(utc2gpst(timeget()), s, 0);
-    sprintf(comment, qPrintable(tr("RTKNAVI options (%s, v.%s)")), s, VER_RTKLIB);
-    setsysopts(&prcopt, &solopt, &filopt);
-    if (!saveopts(qPrintable(file), "w", comment, sysopts) ||
-        !saveopts(qPrintable(file), "a", "", rcvopts)) return;
+    strcpy(filopt.geoid,  qPrintable(GeoidDataFile_Text));
+    strcpy(filopt.dcb,    qPrintable(DCBFile_Text));
+    strcpy(filopt.tempdir,qPrintable(LocalDir_Text));
+	
+	time2str(utc2gpst(timeget()),s,0);
+    sprintf(comment,qPrintable(tr("RTKNAVI options (%s, v.%s)")),s,VER_RTKLIB);
+	setsysopts(&prcopt,&solopt,&filopt);
+    if (!saveopts(qPrintable(file),"w",comment,sysopts)||
+        !saveopts(qPrintable(file),"a","",rcvopts)) return;
 }
 //---------------------------------------------------------------------------
 void OptDialog::UpdateEnable(void)
 {
-    bool rel = PMODE_DGPS <= PosMode->currentIndex() && PosMode->currentIndex() <= PMODE_FIXED;
-    bool rtk = PMODE_KINEMA <= PosMode->currentIndex() && PosMode->currentIndex() <= PMODE_FIXED;
-    bool ppp = PosMode->currentIndex() >= PMODE_PPP_KINEMA;
-    bool ar = rtk || ppp;
-
-    Freq->setEnabled(rel);
-    Solution->setEnabled(false);
-    DynamicModel->setEnabled(rel);
-    TideCorr->setEnabled(rel || ppp);
-    PosOpt1->setEnabled(ppp);
-    PosOpt2->setEnabled(ppp);
-    PosOpt3->setEnabled(ppp);
-    PosOpt4->setEnabled(ppp);
-
-    AmbRes->setEnabled(ar);
-    GloAmbRes->setEnabled(ar && AmbRes->currentIndex() > 0 && NavSys2->isChecked());
-    BdsAmbRes->setEnabled(ar && AmbRes->currentIndex() > 0 && NavSys6->isChecked());
-    ValidThresAR->setEnabled(ar && AmbRes->currentIndex() >= 1 && AmbRes->currentIndex() < 4);
-    ThresAR2->setEnabled(ar && AmbRes->currentIndex() >= 4);
-    ThresAR3->setEnabled(ar && AmbRes->currentIndex() >= 4);
-    LockCntFixAmb->setEnabled(ar && AmbRes->currentIndex() >= 1);
-    ElMaskAR->setEnabled(ar && AmbRes->currentIndex() >= 1);
-    OutCntResetAmb->setEnabled(ar || ppp);
-    FixCntHoldAmb->setEnabled(ar && AmbRes->currentIndex() == 3);
-    ElMaskHold->setEnabled(ar && AmbRes->currentIndex() == 3);
-    SlipThres->setEnabled(ar || ppp);
-    MaxAgeDiff->setEnabled(rel);
-    RejectThres->setEnabled(rel || ppp);
-    NumIter->setEnabled(rel || ppp);
-    SyncSol->setEnabled(rel || ppp);
-    BaselineConst->setEnabled(PosMode->currentIndex() == PMODE_MOVEB);
-    BaselineLen->setEnabled(BaselineConst->isChecked() && PosMode->currentIndex() == PMODE_MOVEB);
-    BaselineSig->setEnabled(BaselineConst->isChecked() && PosMode->currentIndex() == PMODE_MOVEB);
-
-    OutputHead->setEnabled(SolFormat->currentIndex() != 3);
-    OutputOpt->setEnabled(false);
-    TimeFormat->setEnabled(SolFormat->currentIndex() != 3);
-    TimeDecimal->setEnabled(SolFormat->currentIndex() != 3);
-    LatLonFormat->setEnabled(SolFormat->currentIndex() == 0);
-    FieldSep->setEnabled(SolFormat->currentIndex() != 3);
-    OutputSingle->setEnabled(PosMode->currentIndex() != 0);
-    OutputDatum->setEnabled(SolFormat->currentIndex() == 0);
-    OutputHeight->setEnabled(SolFormat->currentIndex() == 0);
-    OutputGeoid->setEnabled(SolFormat->currentIndex() == 0 && OutputHeight->currentIndex() == 1);
-
-    RovAntPcv->setEnabled(rel || ppp);
-    RovAnt->setEnabled((rel || ppp) && RovAntPcv->isChecked());
-    RovAntE->setEnabled((rel || ppp) && RovAntPcv->isChecked());
-    RovAntN->setEnabled((rel || ppp) && RovAntPcv->isChecked());
-    RovAntU->setEnabled((rel || ppp) && RovAntPcv->isChecked());
-    LabelRovAntD->setEnabled((rel || ppp) && RovAntPcv->isChecked());
-    RefAntPcv->setEnabled(rel);
-    RefAnt->setEnabled(rel && RefAntPcv->isChecked());
-    RefAntE->setEnabled(rel && RefAntPcv->isChecked());
-    RefAntN->setEnabled(rel && RefAntPcv->isChecked());
-    RefAntU->setEnabled(rel && RefAntPcv->isChecked());
-    LabelRefAntD->setEnabled(rel && RefAntPcv->isChecked());
-
-    RovPosTypeP->setEnabled(PosMode->currentIndex() == PMODE_FIXED || PosMode->currentIndex() == PMODE_PPP_FIXED);
-    RovPos1->setEnabled(RovPosTypeP->isEnabled() && RovPosTypeP->currentIndex() <= 2);
-    RovPos2->setEnabled(RovPosTypeP->isEnabled() && RovPosTypeP->currentIndex() <= 2);
-    RovPos3->setEnabled(RovPosTypeP->isEnabled() && RovPosTypeP->currentIndex() <= 2);
-    BtnRovPos->setEnabled(RovPosTypeP->isEnabled() && RovPosTypeP->currentIndex() <= 2);
-
-    RefPosTypeP->setEnabled(rel && PosMode->currentIndex() != PMODE_MOVEB);
-    RefPos1->setEnabled(RefPosTypeP->isEnabled() && RefPosTypeP->currentIndex() <= 2);
-    RefPos2->setEnabled(RefPosTypeP->isEnabled() && RefPosTypeP->currentIndex() <= 2);
-    RefPos3->setEnabled(RefPosTypeP->isEnabled() && RefPosTypeP->currentIndex() <= 2);
-    BtnRefPos->setEnabled(RefPosTypeP->isEnabled() && RefPosTypeP->currentIndex() <= 2);
-
-    LabelMaxAveEp->setVisible(RefPosTypeP->currentIndex() == 5);
-    MaxAveEp->setVisible(RefPosTypeP->currentIndex() == 5);
-    ChkInitRestart->setVisible(RefPosTypeP->currentIndex() == 5);
+    bool rel=PMODE_DGPS<=PosMode->currentIndex()&&PosMode->currentIndex()<=PMODE_FIXED;
+    bool rtk=PMODE_KINEMA<=PosMode->currentIndex()&&PosMode->currentIndex()<=PMODE_FIXED;
+    bool ppp=PosMode->currentIndex()>=PMODE_PPP_KINEMA;
+    bool ar=rtk||ppp;
+	
+    Freq           ->setEnabled(rel);
+    Solution       ->setEnabled(false);
+    DynamicModel   ->setEnabled(rel);
+    TideCorr       ->setEnabled(rel||ppp);
+    PosOpt1        ->setEnabled(ppp);
+    PosOpt2        ->setEnabled(ppp);
+    PosOpt3        ->setEnabled(ppp);
+    PosOpt4        ->setEnabled(ppp);
+	
+    AmbRes         ->setEnabled(ar);
+    GloAmbRes      ->setEnabled(ar&&AmbRes->currentIndex()>0&&NavSys2->isChecked());
+    BdsAmbRes      ->setEnabled(ar&&AmbRes->currentIndex()>0&&NavSys6->isChecked());
+    ValidThresAR   ->setEnabled(ar&&AmbRes->currentIndex()>=1&&AmbRes->currentIndex()<4);
+    ThresAR2       ->setEnabled(ar&&AmbRes->currentIndex()>=4);
+    ThresAR3       ->setEnabled(ar&&AmbRes->currentIndex()>=4);
+    LockCntFixAmb  ->setEnabled(ar&&AmbRes->currentIndex()>=1);
+    ElMaskAR       ->setEnabled(ar&&AmbRes->currentIndex()>=1);
+    OutCntResetAmb ->setEnabled(ar||ppp);
+    FixCntHoldAmb  ->setEnabled(ar&&AmbRes->currentIndex()==3);
+    ElMaskHold     ->setEnabled(ar&&AmbRes->currentIndex()==3);
+    SlipThres      ->setEnabled(ar||ppp);
+    MaxAgeDiff     ->setEnabled(rel);
+    RejectThres    ->setEnabled(rel||ppp);
+    NumIter        ->setEnabled(rel||ppp);
+    SyncSol        ->setEnabled(rel||ppp);
+    BaselineConst  ->setEnabled(PosMode->currentIndex()==PMODE_MOVEB);
+    BaselineLen    ->setEnabled(BaselineConst->isChecked()&&PosMode->currentIndex()==PMODE_MOVEB);
+    BaselineSig    ->setEnabled(BaselineConst->isChecked()&&PosMode->currentIndex()==PMODE_MOVEB);
+	
+    OutputHead     ->setEnabled(SolFormat->currentIndex()!=3);
+    OutputOpt      ->setEnabled(false);
+    TimeFormat     ->setEnabled(SolFormat->currentIndex()!=3);
+    TimeDecimal    ->setEnabled(SolFormat->currentIndex()!=3);
+    LatLonFormat   ->setEnabled(SolFormat->currentIndex()==0);
+    FieldSep       ->setEnabled(SolFormat->currentIndex()!=3);
+    OutputDatum    ->setEnabled(SolFormat->currentIndex()==0);
+    OutputHeight   ->setEnabled(SolFormat->currentIndex()==0);
+    OutputGeoid    ->setEnabled(SolFormat->currentIndex()==0&&OutputHeight->currentIndex()==1);
+	
+    RovAntPcv      ->setEnabled(rel||ppp);
+    RovAnt         ->setEnabled((rel||ppp)&&RovAntPcv->isChecked());
+    RovAntE        ->setEnabled((rel||ppp)&&RovAntPcv->isChecked());
+    RovAntN        ->setEnabled((rel||ppp)&&RovAntPcv->isChecked());
+    RovAntU        ->setEnabled((rel||ppp)&&RovAntPcv->isChecked());
+    LabelRovAntD   ->setEnabled((rel||ppp)&&RovAntPcv->isChecked());
+    RefAntPcv      ->setEnabled(rel);
+    RefAnt         ->setEnabled(rel&&RefAntPcv->isChecked());
+    RefAntE        ->setEnabled(rel&&RefAntPcv->isChecked());
+    RefAntN        ->setEnabled(rel&&RefAntPcv->isChecked());
+    RefAntU        ->setEnabled(rel&&RefAntPcv->isChecked());
+    LabelRefAntD   ->setEnabled(rel&&RefAntPcv->isChecked());
+	
+    RovPosTypeP    ->setEnabled(PosMode->currentIndex()==PMODE_FIXED||PosMode->currentIndex()==PMODE_PPP_FIXED);
+    RovPos1        ->setEnabled(RovPosTypeP->isEnabled()&&RovPosTypeP->currentIndex()<=2);
+    RovPos2        ->setEnabled(RovPosTypeP->isEnabled()&&RovPosTypeP->currentIndex()<=2);
+    RovPos3        ->setEnabled(RovPosTypeP->isEnabled()&&RovPosTypeP->currentIndex()<=2);
+    BtnRovPos      ->setEnabled(RovPosTypeP->isEnabled()&&RovPosTypeP->currentIndex()<=2);
+	
+    RefPosTypeP    ->setEnabled(rel&&PosMode->currentIndex()!=PMODE_MOVEB);
+    RefPos1        ->setEnabled(RefPosTypeP->isEnabled()&&RefPosTypeP->currentIndex()<=2);
+    RefPos2        ->setEnabled(RefPosTypeP->isEnabled()&&RefPosTypeP->currentIndex()<=2);
+    RefPos3        ->setEnabled(RefPosTypeP->isEnabled()&&RefPosTypeP->currentIndex()<=2);
+    BtnRefPos      ->setEnabled(RefPosTypeP->isEnabled()&&RefPosTypeP->currentIndex()<=2);
+	
+    LabelMaxAveEp  ->setVisible(RefPosTypeP->currentIndex()==5);
+    MaxAveEp       ->setVisible(RefPosTypeP->currentIndex()==5);
+    ChkInitRestart ->setVisible(RefPosTypeP->currentIndex()==5);
 
-    SbasSatE->setEnabled(PosMode->currentIndex() == 0);
+    SbasSatE       ->setEnabled(PosMode->currentIndex()==0);
 }
 //---------------------------------------------------------------------------
 void OptDialog::GetPos(int type, QLineEdit **edit, double *pos)
 {
-    double p[3] = { 0 }, dms1[3] = { 0 }, dms2[3] = { 0 };
-
-    if (type == 1) { /* lat/lon/height dms/m */
-        QStringList tokens = edit[0]->text().split(" ");
-        for (int i = 0; i < 3 || i < tokens.size(); i++)
-            dms1[i] = tokens.at(i).toDouble();
+	double p[3]={0},dms1[3]={0},dms2[3]={0};
+	
+	if (type==1) { /* lat/lon/height dms/m */
+        QStringList tokens=edit[0]->text().split(" ");
+        for (int i=0;i<3||i<tokens.size();i++)
+            dms1[i]=tokens.at(i).toDouble();
 
-        tokens = edit[1]->text().split(" ");
-        for (int i = 0; i < 3 || i < tokens.size(); i++)
-            dms2[i] = tokens.at(i).toDouble();
+        tokens=edit[1]->text().split(" ");
+        for (int i=0;i<3||i<tokens.size();i++)
+            dms2[i]=tokens.at(i).toDouble();
 
-        p[0] = (dms1[0] < 0 ? -1 : 1) * (fabs(dms1[0]) + dms1[1] / 60 + dms1[2] / 3600) * D2R;
-        p[1] = (dms2[0] < 0 ? -1 : 1) * (fabs(dms2[0]) + dms2[1] / 60 + dms2[2] / 3600) * D2R;
-        p[2] = edit[2]->text().toDouble();
-        pos2ecef(p, pos);
-    } else if (type == 2) { /* x/y/z-ecef */
-        pos[0] = edit[0]->text().toDouble();
-        pos[1] = edit[1]->text().toDouble();
-        pos[2] = edit[2]->text().toDouble();
-    } else {
-        p[0] = edit[0]->text().toDouble() * D2R;
-        p[1] = edit[1]->text().toDouble() * D2R;
-        p[2] = edit[2]->text().toDouble();
-        pos2ecef(p, pos);
+		p[0]=(dms1[0]<0?-1:1)*(fabs(dms1[0])+dms1[1]/60+dms1[2]/3600)*D2R;
+		p[1]=(dms2[0]<0?-1:1)*(fabs(dms2[0])+dms2[1]/60+dms2[2]/3600)*D2R;
+        p[2]=edit[2]->text().toDouble();
+		pos2ecef(p,pos);
+	}
+	else if (type==2) { /* x/y/z-ecef */
+        pos[0]=edit[0]->text().toDouble();
+        pos[1]=edit[1]->text().toDouble();
+        pos[2]=edit[2]->text().toDouble();
+	}
+	else {
+        p[0]=edit[0]->text().toDouble()*D2R;
+        p[1]=edit[1]->text().toDouble()*D2R;
+        p[2]=edit[2]->text().toDouble();
+		pos2ecef(p,pos);
 	}
 }
 //---------------------------------------------------------------------------
 void OptDialog::SetPos(int type, QLineEdit **edit, double *pos)
 {
-    double p[3], dms1[3], dms2[3], s1, s2;
-
-    if (type == 1) { /* lat/lon/height dms/m */
-        ecef2pos(pos, p); s1 = p[0] < 0 ? -1 : 1; s2 = p[1] < 0 ? -1 : 1;
-        p[0] = fabs(p[0]) * R2D + 1E-12; p[1] = fabs(p[1]) * R2D + 1E-12;
-        dms1[0] = floor(p[0]); p[0] = (p[0] - dms1[0]) * 60.0;
-        dms1[1] = floor(p[0]); dms1[2] = (p[0] - dms1[1]) * 60.0;
-        dms2[0] = floor(p[1]); p[1] = (p[1] - dms2[0]) * 60.0;
-        dms2[1] = floor(p[1]); dms2[2] = (p[1] - dms2[1]) * 60.0;
-        edit[0]->setText(QString("%1 %2 %3").arg(s1 * dms1[0], 0, 'f', 0).arg(dms1[1], 2, 'f', 0, '0').arg(dms1[2], 9, 'f', 6, '0'));
-        edit[1]->setText(QString("%1 %2 %3").arg(s2 * dms2[0], 0, 'f', 0).arg(dms2[1], 2, 'f', 0, '0').arg(dms2[2], 9, 'f', 6, '0'));
-        edit[2]->setText(QString::number(p[2], 'f', 4));
-    } else if (type == 2) { /* x/y/z-ecef */
-        edit[0]->setText(QString::number(pos[0], 'f', 4));
-        edit[1]->setText(QString::number(pos[1], 'f', 4));
-        edit[2]->setText(QString::number(pos[2], 'f', 4));
-    } else {
-        ecef2pos(pos, p);
-        edit[0]->setText(QString::number(p[0] * R2D, 'f', 9));
-        edit[1]->setText(QString::number(p[1] * R2D, 'f', 9));
-        edit[2]->setText(QString::number(p[2], 'f', 4));
+    double p[3],dms1[3],dms2[3],s1,s2;
+	
+	if (type==1) { /* lat/lon/height dms/m */
+		ecef2pos(pos,p); s1=p[0]<0?-1:1; s2=p[1]<0?-1:1;
+		p[0]=fabs(p[0])*R2D+1E-12; p[1]=fabs(p[1])*R2D+1E-12;
+		dms1[0]=floor(p[0]); p[0]=(p[0]-dms1[0])*60.0;
+		dms1[1]=floor(p[0]); dms1[2]=(p[0]-dms1[1])*60.0;
+		dms2[0]=floor(p[1]); p[1]=(p[1]-dms2[0])*60.0;
+		dms2[1]=floor(p[1]); dms2[2]=(p[1]-dms2[1])*60.0;
+        edit[0]->setText(QString("%1 %2 %3").arg(s1*dms1[0],0,'f',0).arg(dms1[1],2,'f',0,'0').arg(dms1[2],9,'f',6,'0'));
+        edit[1]->setText(QString("%1 %2 %3").arg(s2*dms2[0],0,'f',0).arg(dms2[1],2,'f',0,'0').arg(dms2[2],9,'f',6,'0'));
+        edit[2]->setText(QString::number(p[2],'f',4));
+	}
+	else if (type==2) { /* x/y/z-ecef */
+        edit[0]->setText(QString::number(pos[0],'f',4));
+        edit[1]->setText(QString::number(pos[1],'f',4));
+        edit[2]->setText(QString::number(pos[2],'f',4));
+	}
+	else {
+		ecef2pos(pos,p);
+        edit[0]->setText(QString::number(p[0]*R2D,'f',9));
+        edit[1]->setText(QString::number(p[1]*R2D,'f',9));
+        edit[2]->setText(QString::number(p[2],'f',4));
 	}
 }
 //---------------------------------------------------------------------------
 void OptDialog::ReadAntList(void)
 {
-    QString AntPcvFile_Text = AntPcvFile->text();
+    QString AntPcvFile_Text=AntPcvFile->text();
     QStringList list;
-    pcvs_t pcvs = { 0, 0, NULL };
+    pcvs_t pcvs={0,0,NULL};
 	char *p;
-
-    if (!readpcv(qPrintable(AntPcvFile_Text), &pcvs)) return;
-
+	
+    if (!readpcv(qPrintable(AntPcvFile_Text),&pcvs)) return;
+	
     list.append("");
     list.append("*");
-
-    for (int i = 0; i < pcvs.n; i++) {
+	
+	for (int i=0;i<pcvs.n;i++) {
 		if (pcvs.pcv[i].sat) continue;
-        if ((p = strchr(pcvs.pcv[i].type, ' '))) *p = '\0';
-        if (i > 0 && !strcmp(pcvs.pcv[i].type, pcvs.pcv[i - 1].type)) continue;
+		if ((p=strchr(pcvs.pcv[i].type,' '))) *p='\0';
+		if (i>0&&!strcmp(pcvs.pcv[i].type,pcvs.pcv[i-1].type)) continue;
         list.append(pcvs.pcv[i].type);
 	}
     RovAnt->clear();
     RefAnt->clear();
     RovAnt->addItems(list);
     RefAnt->addItems(list);
-
+	
 	free(pcvs.pcv);
 }
 //---------------------------------------------------------------------------
@@ -1234,3 +1185,4 @@
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/naviopt.h RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/naviopt.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/naviopt.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/naviopt.h	2019-08-19 02:04:50.000000000 +0300
@@ -63,19 +63,19 @@
     QFont PosFont;
     TextViewer *textViewer;
 
-    int SvrCycle, SvrBuffSize, SolBuffSize, NavSelect, SavedSol;
-    int NmeaReq, NmeaCycle, TimeoutTime, ReconTime, DgpsCorr, SbasCorr;
-    int DebugTraceF, DebugStatusF;
-    int RovPosTypeF, RefPosTypeF, RovAntPcvF, RefAntPcvF, BaselineC;
-    int MoniPort, FileSwapMargin, PanelStack;
+	int SvrCycle,SvrBuffSize,SolBuffSize,NavSelect,SavedSol;
+	int NmeaReq,NmeaCycle,TimeoutTime,ReconTime,DgpsCorr,SbasCorr;
+	int DebugTraceF,DebugStatusF;
+	int RovPosTypeF,RefPosTypeF,RovAntPcvF,RefAntPcvF,BaselineC;
+    int MoniPort,FileSwapMargin,PanelStack;
 
-    QString ExSats, LocalDirectory;
-    QString RovAntF, RefAntF, SatPcvFileF, AntPcvFileF, StaPosFileF;
-    QString GeoidDataFileF, DCBFileF, EOPFileF, TLEFileF, TLESatFileF;
+    QString ExSats,LocalDirectory;
+    QString RovAntF,RefAntF,SatPcvFileF,AntPcvFileF,StaPosFileF;
+    QString GeoidDataFileF,DCBFileF,EOPFileF,TLEFileF,TLESatFileF;
     QString ProxyAddr;
 
-    double RovAntDel[3], RefAntDel[3], RovPos[3], RefPos[3];
-    double Baseline[2], NmeaIntv[2];
+	double RovAntDel[3],RefAntDel[3],RovPos[3],RefPos[3];
+	double Baseline[2],NmeaIntv[2];
 
     explicit OptDialog(QWidget* parent);
 };
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/naviopt.ui RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/naviopt.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/naviopt.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/naviopt.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>639</width>
-    <height>555</height>
+    <width>640</width>
+    <height>549</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -703,128 +703,6 @@
        <string>Setting&amp;2</string>
       </attribute>
       <layout class="QGridLayout" name="gridLayout_2">
-       <item row="2" column="1" colspan="4">
-        <widget class="QDoubleSpinBox" name="ValidThresAR">
-         <property name="decimals">
-          <number>1</number>
-         </property>
-         <property name="value">
-          <double>3.000000000000000</double>
-         </property>
-        </widget>
-       </item>
-       <item row="4" column="1" colspan="2">
-        <widget class="QDoubleSpinBox" name="ThresAR2">
-         <property name="decimals">
-          <number>4</number>
-         </property>
-         <property name="value">
-          <double>0.999900000000000</double>
-         </property>
-        </widget>
-       </item>
-       <item row="16" column="1" colspan="2">
-        <widget class="QSpinBox" name="NumIter">
-         <property name="value">
-          <number>1</number>
-         </property>
-        </widget>
-       </item>
-       <item row="4" column="3" colspan="2">
-        <widget class="QDoubleSpinBox" name="ThresAR3">
-         <property name="value">
-          <double>0.200000000000000</double>
-         </property>
-        </widget>
-       </item>
-       <item row="17" column="3" colspan="2">
-        <widget class="QDoubleSpinBox" name="BaselineSig">
-         <property name="suffix">
-          <string> m</string>
-         </property>
-         <property name="decimals">
-          <number>3</number>
-         </property>
-         <property name="maximum">
-          <double>1000000.000000000000000</double>
-         </property>
-        </widget>
-       </item>
-       <item row="17" column="1" colspan="2">
-        <widget class="QDoubleSpinBox" name="BaselineLen">
-         <property name="suffix">
-          <string> m</string>
-         </property>
-         <property name="decimals">
-          <number>3</number>
-         </property>
-         <property name="maximum">
-          <double>1000000.000000000000000</double>
-         </property>
-        </widget>
-       </item>
-       <item row="6" column="1" colspan="2">
-        <widget class="QSpinBox" name="LockCntFixAmb">
-         <property name="maximum">
-          <number>10000</number>
-         </property>
-        </widget>
-       </item>
-       <item row="6" column="3" colspan="2">
-        <widget class="QDoubleSpinBox" name="ElMaskAR">
-         <property name="suffix">
-          <string>°</string>
-         </property>
-         <property name="decimals">
-          <number>0</number>
-         </property>
-         <property name="maximum">
-          <double>90.000000000000000</double>
-         </property>
-        </widget>
-       </item>
-       <item row="8" column="1" colspan="2">
-        <widget class="QSpinBox" name="FixCntHoldAmb">
-         <property name="maximum">
-          <number>100000</number>
-         </property>
-         <property name="value">
-          <number>10</number>
-         </property>
-        </widget>
-       </item>
-       <item row="8" column="3" colspan="2">
-        <widget class="QDoubleSpinBox" name="ElMaskHold">
-         <property name="suffix">
-          <string>°</string>
-         </property>
-         <property name="decimals">
-          <number>0</number>
-         </property>
-         <property name="maximum">
-          <double>90.000000000000000</double>
-         </property>
-         <property name="value">
-          <double>10.000000000000000</double>
-         </property>
-        </widget>
-       </item>
-       <item row="12" column="1" colspan="2">
-        <widget class="QDoubleSpinBox" name="MaxAgeDiff">
-         <property name="suffix">
-          <string> s</string>
-         </property>
-         <property name="decimals">
-          <number>1</number>
-         </property>
-         <property name="maximum">
-          <double>3600.000000000000000</double>
-         </property>
-         <property name="value">
-          <double>30.000000000000000</double>
-         </property>
-        </widget>
-       </item>
        <item row="0" column="0">
         <widget class="QLabel" name="Label25">
          <property name="enabled">
@@ -913,7 +791,7 @@
          </item>
         </widget>
        </item>
-       <item row="2" column="0">
+       <item row="1" column="0">
         <widget class="QLabel" name="Label24">
          <property name="enabled">
           <bool>true</bool>
@@ -926,7 +804,20 @@
          </property>
         </widget>
        </item>
-       <item row="4" column="0">
+       <item row="1" column="1" colspan="4">
+        <widget class="QLineEdit" name="ValidThresAR">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>3.0</string>
+         </property>
+        </widget>
+       </item>
+       <item row="2" column="0">
         <widget class="QLabel" name="Label12">
          <property name="enabled">
           <bool>true</bool>
@@ -939,7 +830,33 @@
          </property>
         </widget>
        </item>
-       <item row="6" column="0">
+       <item row="2" column="1" colspan="2">
+        <widget class="QLineEdit" name="ThresAR2">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>0.9999</string>
+         </property>
+        </widget>
+       </item>
+       <item row="2" column="3" colspan="2">
+        <widget class="QLineEdit" name="ThresAR3">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>0.20</string>
+         </property>
+        </widget>
+       </item>
+       <item row="3" column="0">
         <widget class="QLabel" name="Label13">
          <property name="enabled">
           <bool>true</bool>
@@ -948,21 +865,37 @@
           <string/>
          </property>
          <property name="text">
-          <string>Min Lock / Elevation to Fix Amb</string>
+          <string>Min Lock / Elevation (°) to Fix Amb</string>
          </property>
         </widget>
        </item>
-       <item row="10" column="1" colspan="2">
-        <widget class="QSpinBox" name="OutCntResetAmb">
-         <property name="maximum">
-          <number>1000</number>
+       <item row="3" column="1" colspan="2">
+        <widget class="QLineEdit" name="LockCntFixAmb">
+         <property name="enabled">
+          <bool>true</bool>
          </property>
-         <property name="value">
-          <number>5</number>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>0</string>
          </property>
         </widget>
        </item>
-       <item row="8" column="0">
+       <item row="3" column="3" colspan="2">
+        <widget class="QLineEdit" name="ElMaskAR">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>0</string>
+         </property>
+        </widget>
+       </item>
+       <item row="4" column="0">
         <widget class="QLabel" name="LabelHold">
          <property name="enabled">
           <bool>true</bool>
@@ -971,11 +904,37 @@
           <string/>
          </property>
          <property name="text">
-          <string>Min Fix / Elevation to Hold Amb</string>
+          <string>Min Fix / Elevation (°) to Hold Amb</string>
          </property>
         </widget>
        </item>
-       <item row="10" column="0">
+       <item row="4" column="1" colspan="2">
+        <widget class="QLineEdit" name="FixCntHoldAmb">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>10</string>
+         </property>
+        </widget>
+       </item>
+       <item row="4" column="3" colspan="2">
+        <widget class="QLineEdit" name="ElMaskHold">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>10</string>
+         </property>
+        </widget>
+       </item>
+       <item row="5" column="0">
         <widget class="QLabel" name="Label22">
          <property name="enabled">
           <bool>true</bool>
@@ -984,11 +943,37 @@
           <string/>
          </property>
          <property name="text">
-          <string>Outage to Reset Amb / Slip Thres</string>
+          <string>Outage to Reset Amb / Slip Thres (m)</string>
          </property>
         </widget>
        </item>
-       <item row="12" column="0">
+       <item row="5" column="1" colspan="2">
+        <widget class="QLineEdit" name="OutCntResetAmb">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>5</string>
+         </property>
+        </widget>
+       </item>
+       <item row="5" column="3" colspan="2">
+        <widget class="QLineEdit" name="SlipThres">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>0.05</string>
+         </property>
+        </widget>
+       </item>
+       <item row="6" column="0">
         <widget class="QLabel" name="Label14">
          <property name="enabled">
           <bool>true</bool>
@@ -997,11 +982,24 @@
           <string/>
          </property>
          <property name="text">
-          <string>Max Age of Diff / Sync Solution</string>
+          <string>Max Age of Diff (s) / Sync Solution</string>
          </property>
         </widget>
        </item>
-       <item row="12" column="3" colspan="2">
+       <item row="6" column="1" colspan="2">
+        <widget class="QLineEdit" name="MaxAgeDiff">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>30</string>
+         </property>
+        </widget>
+       </item>
+       <item row="6" column="3" colspan="2">
         <widget class="QComboBox" name="SyncSol">
          <property name="enabled">
           <bool>true</bool>
@@ -1021,7 +1019,7 @@
          </item>
         </widget>
        </item>
-       <item row="14" column="0">
+       <item row="7" column="0">
         <widget class="QLabel" name="Label11">
          <property name="enabled">
           <bool>true</bool>
@@ -1030,11 +1028,37 @@
           <string/>
          </property>
          <property name="text">
-          <string>Reject Threshold of GDOP/Innov</string>
+          <string>Reject Threshold of GDOP/Innov (m)</string>
          </property>
         </widget>
        </item>
-       <item row="16" column="0">
+       <item row="7" column="1" colspan="2">
+        <widget class="QLineEdit" name="RejectGdop">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>30</string>
+         </property>
+        </widget>
+       </item>
+       <item row="7" column="3" colspan="2">
+        <widget class="QLineEdit" name="RejectThres">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>30</string>
+         </property>
+        </widget>
+       </item>
+       <item row="8" column="0">
         <widget class="QLabel" name="Label37">
          <property name="enabled">
           <bool>true</bool>
@@ -1047,55 +1071,55 @@
          </property>
         </widget>
        </item>
-       <item row="17" column="0">
-        <widget class="QCheckBox" name="BaselineConst">
+       <item row="8" column="1" colspan="4">
+        <widget class="QLineEdit" name="NumIter">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
          <property name="toolTip">
           <string/>
          </property>
          <property name="text">
-          <string>Baseline Length Constraint</string>
-         </property>
-         <property name="checked">
-          <bool>false</bool>
+          <string>1</string>
          </property>
         </widget>
        </item>
-       <item row="14" column="1" colspan="2">
-        <widget class="QDoubleSpinBox" name="RejectGdop">
-         <property name="suffix">
-          <string> m</string>
+       <item row="9" column="0">
+        <widget class="QCheckBox" name="BaselineConst">
+         <property name="toolTip">
+          <string/>
          </property>
-         <property name="decimals">
-          <number>1</number>
+         <property name="text">
+          <string>Baseline Length Constraint (m)</string>
          </property>
-         <property name="value">
-          <double>30.000000000000000</double>
+         <property name="checked">
+          <bool>false</bool>
          </property>
         </widget>
        </item>
-       <item row="14" column="3" colspan="2">
-        <widget class="QDoubleSpinBox" name="RejectThres">
-         <property name="suffix">
-          <string> m</string>
+       <item row="9" column="1" colspan="2">
+        <widget class="QLineEdit" name="BaselineLen">
+         <property name="enabled">
+          <bool>true</bool>
          </property>
-         <property name="decimals">
-          <number>1</number>
+         <property name="toolTip">
+          <string/>
          </property>
-         <property name="value">
-          <double>30.000000000000000</double>
+         <property name="text">
+          <string>0.000</string>
          </property>
         </widget>
        </item>
-       <item row="10" column="3" colspan="2">
-        <widget class="QDoubleSpinBox" name="SlipThres">
-         <property name="suffix">
-          <string> m</string>
+       <item row="9" column="3" colspan="2">
+        <widget class="QLineEdit" name="BaselineSig">
+         <property name="enabled">
+          <bool>true</bool>
          </property>
-         <property name="decimals">
-          <number>3</number>
+         <property name="toolTip">
+          <string/>
          </property>
-         <property name="value">
-          <double>0.050000000000000</double>
+         <property name="text">
+          <string>0.000</string>
          </property>
         </widget>
        </item>
@@ -1109,97 +1133,116 @@
        <string>O&amp;utput</string>
       </attribute>
       <layout class="QGridLayout" name="gridLayout_3">
-       <item row="4" column="3">
-        <widget class="QSpinBox" name="TimeDecimal">
-         <property name="value">
-          <number>3</number>
-         </property>
-        </widget>
-       </item>
-       <item row="12" column="3">
-        <widget class="QDoubleSpinBox" name="NmeaIntv2">
-         <property name="suffix">
-          <string> s</string>
+       <item row="0" column="0">
+        <widget class="QLabel" name="LabelSolFormat">
+         <property name="enabled">
+          <bool>true</bool>
          </property>
-         <property name="value">
-          <double>1.000000000000000</double>
+         <property name="toolTip">
+          <string/>
          </property>
-        </widget>
-       </item>
-       <item row="12" column="1" colspan="2">
-        <widget class="QDoubleSpinBox" name="NmeaIntv1">
-         <property name="suffix">
-          <string> s</string>
+         <property name="text">
+          <string>Solution Format</string>
          </property>
         </widget>
        </item>
-       <item row="13" column="2" colspan="2">
-        <widget class="QComboBox" name="DebugTrace">
+       <item row="0" column="1" colspan="3">
+        <widget class="QComboBox" name="SolFormat">
          <property name="enabled">
-          <bool>true</bool>
+          <bool>false</bool>
          </property>
          <property name="toolTip">
           <string/>
          </property>
          <item>
           <property name="text">
-           <string>OFF</string>
+           <string>Lat/Lon/Height</string>
           </property>
          </item>
          <item>
           <property name="text">
-           <string>Level 1</string>
+           <string>X/Y/Z-ECEF</string>
           </property>
          </item>
          <item>
           <property name="text">
-           <string>Level 2</string>
+           <string>E/N/U-Baseline</string>
           </property>
          </item>
          <item>
           <property name="text">
-           <string>Level 3</string>
+           <string>NMEA0183</string>
           </property>
          </item>
+        </widget>
+       </item>
+       <item row="1" column="0">
+        <widget class="QLabel" name="Label20">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>Output Header/Processing Options</string>
+         </property>
+        </widget>
+       </item>
+       <item row="1" column="1">
+        <widget class="QComboBox" name="OutputHead">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
          <item>
           <property name="text">
-           <string>Level 4</string>
+           <string>OFF</string>
           </property>
          </item>
          <item>
           <property name="text">
-           <string>Level 5</string>
+           <string>ON</string>
           </property>
          </item>
         </widget>
        </item>
-       <item row="8" column="0">
-        <widget class="QLabel" name="Label2">
+       <item row="1" column="2" colspan="2">
+        <widget class="QComboBox" name="OutputOpt">
          <property name="enabled">
-          <bool>true</bool>
+          <bool>false</bool>
          </property>
          <property name="toolTip">
           <string/>
          </property>
-         <property name="text">
-          <string>Datum / Height</string>
-         </property>
+         <item>
+          <property name="text">
+           <string>OFF</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>ON</string>
+          </property>
+         </item>
         </widget>
        </item>
-       <item row="10" column="0">
-        <widget class="QLabel" name="Label21">
+       <item row="2" column="0">
+        <widget class="QLabel" name="LabelTimeFormat">
          <property name="enabled">
-          <bool>false</bool>
+          <bool>true</bool>
          </property>
          <property name="toolTip">
           <string/>
          </property>
          <property name="text">
-          <string>Solution for Static Mode</string>
+          <string>Time Format / # of Decimals</string>
          </property>
         </widget>
        </item>
-       <item row="4" column="1" colspan="2">
+       <item row="2" column="1" colspan="2">
         <widget class="QComboBox" name="TimeFormat">
          <property name="enabled">
           <bool>true</bool>
@@ -1229,8 +1272,8 @@
          </item>
         </widget>
        </item>
-       <item row="13" column="0">
-        <widget class="QLabel" name="Label36">
+       <item row="2" column="3">
+        <widget class="QLineEdit" name="TimeDecimal">
          <property name="enabled">
           <bool>true</bool>
          </property>
@@ -1238,12 +1281,12 @@
           <string/>
          </property>
          <property name="text">
-          <string>Output Solution Status / Output Debug Trace</string>
+          <string>3</string>
          </property>
         </widget>
        </item>
-       <item row="2" column="0">
-        <widget class="QLabel" name="Label20">
+       <item row="3" column="0">
+        <widget class="QLabel" name="LabelLatLonFormat">
          <property name="enabled">
           <bool>true</bool>
          </property>
@@ -1251,12 +1294,12 @@
           <string/>
          </property>
          <property name="text">
-          <string>Output Header/Processing Options</string>
+          <string>Latitude / Longitude Format</string>
          </property>
         </widget>
        </item>
-       <item row="9" column="1" colspan="3">
-        <widget class="QComboBox" name="OutputGeoid">
+       <item row="3" column="1" colspan="3">
+        <widget class="QComboBox" name="LatLonFormat">
          <property name="enabled">
           <bool>true</bool>
          </property>
@@ -1265,32 +1308,17 @@
          </property>
          <item>
           <property name="text">
-           <string>Internal</string>
-          </property>
-         </item>
-         <item>
-          <property name="text">
-           <string>EGM96-BE 15&quot;</string>
-          </property>
-         </item>
-         <item>
-          <property name="text">
-           <string>EGM2008-SE 2.5&quot;</string>
-          </property>
-         </item>
-         <item>
-          <property name="text">
-           <string>EGM2008-SE 1&quot;</string>
+           <string>ddd.ddddddd</string>
           </property>
          </item>
          <item>
           <property name="text">
-           <string>GSI2000 1x1.5&quot;</string>
+           <string>ddd mm ss.sss</string>
           </property>
          </item>
         </widget>
        </item>
-       <item row="7" column="0">
+       <item row="4" column="0">
         <widget class="QLabel" name="LabelFieldSep">
          <property name="enabled">
           <bool>true</bool>
@@ -1299,41 +1327,72 @@
           <string/>
          </property>
          <property name="text">
-          <string>Output Single if Sol Outage / Max Sol Std</string>
+          <string>Field Separator</string>
          </property>
         </widget>
        </item>
-       <item row="0" column="1" colspan="3">
-        <widget class="QComboBox" name="SolFormat">
+       <item row="4" column="1" colspan="3">
+        <widget class="QLineEdit" name="FieldSep">
          <property name="enabled">
-          <bool>false</bool>
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string/>
+         </property>
+        </widget>
+       </item>
+       <item row="5" column="0">
+        <widget class="QLabel" name="Label2">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>Datum/Height</string>
+         </property>
+        </widget>
+       </item>
+       <item row="5" column="1">
+        <widget class="QComboBox" name="OutputDatum">
+         <property name="enabled">
+          <bool>true</bool>
          </property>
          <property name="toolTip">
           <string/>
          </property>
          <item>
           <property name="text">
-           <string>Lat/Lon/Height</string>
-          </property>
-         </item>
-         <item>
-          <property name="text">
-           <string>X/Y/Z-ECEF</string>
+           <string>WGS84</string>
           </property>
          </item>
+        </widget>
+       </item>
+       <item row="5" column="2" colspan="2">
+        <widget class="QComboBox" name="OutputHeight">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
          <item>
           <property name="text">
-           <string>E/N/U-Baseline</string>
+           <string>Ellipsoidal</string>
           </property>
          </item>
          <item>
           <property name="text">
-           <string>NMEA0183</string>
+           <string>Geodetic</string>
           </property>
          </item>
         </widget>
        </item>
-       <item row="9" column="0">
+       <item row="6" column="0">
         <widget class="QLabel" name="Label18">
          <property name="enabled">
           <bool>true</bool>
@@ -1346,76 +1405,76 @@
          </property>
         </widget>
        </item>
-       <item row="10" column="1" colspan="3">
-        <widget class="QComboBox" name="SolStatic">
+       <item row="6" column="1" colspan="3">
+        <widget class="QComboBox" name="OutputGeoid">
          <property name="enabled">
-          <bool>false</bool>
+          <bool>true</bool>
          </property>
          <property name="toolTip">
           <string/>
          </property>
          <item>
           <property name="text">
-           <string>All</string>
+           <string>Internal</string>
           </property>
          </item>
          <item>
           <property name="text">
-           <string>Single</string>
+           <string>EGM96-BE 15&quot;</string>
           </property>
          </item>
-        </widget>
-       </item>
-       <item row="5" column="1" colspan="2">
-        <widget class="QComboBox" name="LatLonFormat">
-         <property name="enabled">
-          <bool>true</bool>
-         </property>
-         <property name="toolTip">
-          <string/>
-         </property>
          <item>
           <property name="text">
-           <string>ddd.ddddddd</string>
+           <string>EGM2008-SE 2.5&quot;</string>
           </property>
          </item>
          <item>
           <property name="text">
-           <string>ddd mm ss.sss</string>
+           <string>EGM2008-SE 1&quot;</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>GSI2000 1x1.5&quot;</string>
           </property>
          </item>
         </widget>
        </item>
-       <item row="5" column="0">
-        <widget class="QLabel" name="LabelLatLonFormat">
+       <item row="7" column="0">
+        <widget class="QLabel" name="Label21">
          <property name="enabled">
-          <bool>true</bool>
+          <bool>false</bool>
          </property>
          <property name="toolTip">
           <string/>
          </property>
          <property name="text">
-          <string>Latitude Longitude Format / Field Separator</string>
+          <string>Solution for Static Mode</string>
          </property>
         </widget>
        </item>
-       <item row="8" column="1">
-        <widget class="QComboBox" name="OutputDatum">
+       <item row="7" column="1" colspan="3">
+        <widget class="QComboBox" name="SolStatic">
          <property name="enabled">
-          <bool>true</bool>
+          <bool>false</bool>
          </property>
          <property name="toolTip">
           <string/>
          </property>
          <item>
           <property name="text">
-           <string>WGS84</string>
+           <string>All</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>Single</string>
           </property>
          </item>
         </widget>
        </item>
-       <item row="4" column="0">
-        <widget class="QLabel" name="LabelTimeFormat">
+       <item row="8" column="0">
+        <widget class="QLabel" name="Label17">
          <property name="enabled">
           <bool>true</bool>
          </property>
@@ -1423,12 +1482,12 @@
           <string/>
          </property>
          <property name="text">
-          <string>Time Format / # of Decimals</string>
+          <string>NMEA Interval (s) RMC/GGA, GSA/GSV</string>
          </property>
         </widget>
        </item>
-       <item row="12" column="0">
-        <widget class="QLabel" name="Label17">
+       <item row="8" column="1">
+        <widget class="QLineEdit" name="NmeaIntv1">
          <property name="enabled">
           <bool>true</bool>
          </property>
@@ -1436,32 +1495,25 @@
           <string/>
          </property>
          <property name="text">
-          <string>NMEA Interval (s) RMC/GGA, GSA/GSV</string>
+          <string>0</string>
          </property>
         </widget>
        </item>
-       <item row="2" column="1">
-        <widget class="QComboBox" name="OutputHead">
+       <item row="8" column="2" colspan="2">
+        <widget class="QLineEdit" name="NmeaIntv2">
          <property name="enabled">
           <bool>true</bool>
          </property>
          <property name="toolTip">
           <string/>
          </property>
-         <item>
-          <property name="text">
-           <string>OFF</string>
-          </property>
-         </item>
-         <item>
-          <property name="text">
-           <string>ON</string>
-          </property>
-         </item>
+         <property name="text">
+          <string>1</string>
+         </property>
         </widget>
        </item>
-       <item row="0" column="0">
-        <widget class="QLabel" name="LabelSolFormat">
+       <item row="9" column="0">
+        <widget class="QLabel" name="Label36">
          <property name="enabled">
           <bool>true</bool>
          </property>
@@ -1469,11 +1521,11 @@
           <string/>
          </property>
          <property name="text">
-          <string>Solution Format</string>
+          <string>Output Solution Status / Debug Trace</string>
          </property>
         </widget>
        </item>
-       <item row="13" column="1">
+       <item row="9" column="1">
         <widget class="QComboBox" name="DebugStatus">
          <property name="enabled">
           <bool>true</bool>
@@ -1498,21 +1550,14 @@
          </item>
         </widget>
        </item>
-       <item row="5" column="3">
-        <widget class="QLineEdit" name="FieldSep">
+       <item row="9" column="2" colspan="2">
+        <widget class="QComboBox" name="DebugTrace">
          <property name="enabled">
           <bool>true</bool>
          </property>
          <property name="toolTip">
           <string/>
          </property>
-         <property name="text">
-          <string/>
-         </property>
-        </widget>
-       </item>
-       <item row="7" column="1">
-        <widget class="QComboBox" name="OutputSingle">
          <item>
           <property name="text">
            <string>OFF</string>
@@ -1520,54 +1565,27 @@
          </item>
          <item>
           <property name="text">
-           <string>ON</string>
+           <string>Level 1</string>
           </property>
          </item>
-        </widget>
-       </item>
-       <item row="7" column="3">
-        <widget class="QDoubleSpinBox" name="MaxSolStd">
-         <property name="suffix">
-          <string> m</string>
-         </property>
-        </widget>
-       </item>
-       <item row="2" column="3">
-        <widget class="QComboBox" name="OutputOpt">
-         <property name="enabled">
-          <bool>false</bool>
-         </property>
-         <property name="toolTip">
-          <string/>
-         </property>
          <item>
           <property name="text">
-           <string>OFF</string>
+           <string>Level 2</string>
           </property>
          </item>
          <item>
           <property name="text">
-           <string>ON</string>
+           <string>Level 3</string>
           </property>
          </item>
-        </widget>
-       </item>
-       <item row="8" column="3">
-        <widget class="QComboBox" name="OutputHeight">
-         <property name="enabled">
-          <bool>true</bool>
-         </property>
-         <property name="toolTip">
-          <string/>
-         </property>
          <item>
           <property name="text">
-           <string>Ellipsoidal</string>
+           <string>Level 4</string>
           </property>
          </item>
          <item>
           <property name="text">
-           <string>Geodetic</string>
+           <string>Level 5</string>
           </property>
          </item>
         </widget>
@@ -1582,17 +1600,17 @@
        <string>S&amp;tatistics</string>
       </attribute>
       <layout class="QGridLayout" name="gridLayout_4">
-       <item row="1" column="0" colspan="2">
-        <widget class="QGroupBox" name="GroupBox4">
+       <item row="0" column="0" colspan="2">
+        <widget class="QGroupBox" name="GroupBox3">
          <property name="toolTip">
           <string/>
          </property>
          <property name="title">
-          <string>Process Noises (1-sigma/sqrt(s))</string>
+          <string>Measurement Errors (1-sigma)</string>
          </property>
-         <layout class="QGridLayout" name="gridLayout_9">
+         <layout class="QGridLayout" name="gridLayout_8">
           <item row="0" column="0">
-           <widget class="QLabel" name="Label33">
+           <widget class="QLabel" name="Label6">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1600,12 +1618,12 @@
              <string/>
             </property>
             <property name="text">
-             <string>Receiver Accel Horiz/Vertical (m/s2)</string>
+             <string>Code/Carrier-Phase Error Ratio L1/L2</string>
             </property>
            </widget>
           </item>
           <item row="0" column="1">
-           <widget class="QLineEdit" name="PrNoise4">
+           <widget class="QLineEdit" name="MeasErrR1">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1613,12 +1631,12 @@
              <string/>
             </property>
             <property name="text">
-             <string>1.0E-04</string>
+             <string>100.0</string>
             </property>
            </widget>
           </item>
           <item row="0" column="2">
-           <widget class="QLineEdit" name="PrNoise5">
+           <widget class="QLineEdit" name="MeasErrR2">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1626,12 +1644,12 @@
              <string/>
             </property>
             <property name="text">
-             <string>1.0E-04</string>
+             <string>100.0</string>
             </property>
            </widget>
           </item>
           <item row="1" column="0">
-           <widget class="QLabel" name="Label26">
+           <widget class="QLabel" name="Label7">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1639,12 +1657,12 @@
              <string/>
             </property>
             <property name="text">
-             <string>Carrier-Phase Bias (cycle)</string>
+             <string>Carrier-Phase Error a+b/sinEl (m)</string>
             </property>
            </widget>
           </item>
-          <item row="1" column="1" colspan="2">
-           <widget class="QLineEdit" name="PrNoise1">
+          <item row="1" column="1">
+           <widget class="QLineEdit" name="MeasErr2">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1652,12 +1670,25 @@
              <string/>
             </property>
             <property name="text">
-             <string>1.0E-04</string>
+             <string>0.003</string>
+            </property>
+           </widget>
+          </item>
+          <item row="1" column="2">
+           <widget class="QLineEdit" name="MeasErr3">
+            <property name="enabled">
+             <bool>true</bool>
+            </property>
+            <property name="toolTip">
+             <string/>
+            </property>
+            <property name="text">
+             <string>0.003</string>
             </property>
            </widget>
           </item>
           <item row="2" column="0">
-           <widget class="QLabel" name="Label27">
+           <widget class="QLabel" name="Label16">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1665,12 +1696,12 @@
              <string/>
             </property>
             <property name="text">
-             <string>Vertical Ionospheric Delay (m/10km)</string>
+             <string>Carrier-Phase Error/Baseline (m/10km)</string>
             </property>
            </widget>
           </item>
           <item row="2" column="1" colspan="2">
-           <widget class="QLineEdit" name="PrNoise2">
+           <widget class="QLineEdit" name="MeasErr4">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1678,12 +1709,12 @@
              <string/>
             </property>
             <property name="text">
-             <string>1.0E-03</string>
+             <string>0.000</string>
             </property>
            </widget>
           </item>
           <item row="3" column="0">
-           <widget class="QLabel" name="Label28">
+           <widget class="QLabel" name="Label10">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1691,12 +1722,12 @@
              <string/>
             </property>
             <property name="text">
-             <string>Zenith Tropospheric Delay (m)</string>
+             <string>Doppler Frequency (Hz)</string>
             </property>
            </widget>
           </item>
           <item row="3" column="1" colspan="2">
-           <widget class="QLineEdit" name="PrNoise3">
+           <widget class="QLineEdit" name="MeasErr5">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1704,73 +1735,63 @@
              <string/>
             </property>
             <property name="text">
-             <string>1.0E-04</string>
+             <string>1.000</string>
             </property>
            </widget>
           </item>
          </layout>
         </widget>
        </item>
-       <item row="0" column="0" colspan="2">
-        <widget class="QGroupBox" name="GroupBox3">
+       <item row="1" column="0" colspan="2">
+        <widget class="QGroupBox" name="GroupBox4">
          <property name="toolTip">
           <string/>
          </property>
          <property name="title">
-          <string>Measurement Errors (1-sigma)</string>
+          <string>Process Noises (1-sigma/sqrt(s))</string>
          </property>
-         <layout class="QGridLayout" name="gridLayout_8">
-          <item row="1" column="2">
-           <widget class="QDoubleSpinBox" name="MeasErrR2">
-            <property name="maximum">
-             <double>1000000.000000000000000</double>
-            </property>
-            <property name="value">
-             <double>100.000000000000000</double>
-            </property>
-           </widget>
-          </item>
-          <item row="1" column="1">
-           <widget class="QDoubleSpinBox" name="MeasErrR1">
-            <property name="decimals">
-             <number>1</number>
+         <layout class="QGridLayout" name="gridLayout_9">
+          <item row="0" column="0">
+           <widget class="QLabel" name="Label33">
+            <property name="enabled">
+             <bool>true</bool>
             </property>
-            <property name="maximum">
-             <double>100000.000000000000000</double>
+            <property name="toolTip">
+             <string/>
             </property>
-            <property name="value">
-             <double>100.000000000000000</double>
+            <property name="text">
+             <string>Receiver Accel Horiz/Vertical (m/s2)</string>
             </property>
            </widget>
           </item>
-          <item row="5" column="1" colspan="2">
-           <widget class="QDoubleSpinBox" name="MeasErr4">
-            <property name="suffix">
-             <string> m/100km</string>
+          <item row="0" column="1">
+           <widget class="QLineEdit" name="PrNoise4">
+            <property name="enabled">
+             <bool>true</bool>
             </property>
-            <property name="decimals">
-             <number>3</number>
+            <property name="toolTip">
+             <string/>
+            </property>
+            <property name="text">
+             <string>1.0E-04</string>
             </property>
            </widget>
           </item>
-          <item row="6" column="1" colspan="2">
-           <widget class="QDoubleSpinBox" name="MeasErr5">
-            <property name="suffix">
-             <string> Hz</string>
-            </property>
-            <property name="minimum">
-             <double>-10000.000000000000000</double>
+          <item row="0" column="2">
+           <widget class="QLineEdit" name="PrNoise5">
+            <property name="enabled">
+             <bool>true</bool>
             </property>
-            <property name="maximum">
-             <double>10000.000000000000000</double>
+            <property name="toolTip">
+             <string/>
             </property>
-            <property name="value">
-             <double>1.000000000000000</double>
+            <property name="text">
+             <string>1.0E-04</string>
             </property>
            </widget>
           </item>
           <item row="1" column="0">
-           <widget class="QLabel" name="Label6">
+           <widget class="QLabel" name="Label26">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1778,12 +1799,12 @@
              <string/>
             </property>
             <property name="text">
-             <string>Code/Carrier-Phase Error Ratio L1/L2</string>
+             <string>Carrier-Phase Bias (cycle)</string>
             </property>
            </widget>
           </item>
-          <item row="3" column="0">
-           <widget class="QLabel" name="Label7">
+          <item row="1" column="1" colspan="2">
+           <widget class="QLineEdit" name="PrNoise1">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1791,12 +1812,12 @@
              <string/>
             </property>
             <property name="text">
-             <string>Carrier-Phase Error a+b/sinEl (m)</string>
+             <string>1.0E-04</string>
             </property>
            </widget>
           </item>
-          <item row="5" column="0">
-           <widget class="QLabel" name="Label16">
+          <item row="2" column="0">
+           <widget class="QLabel" name="Label27">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1804,12 +1825,12 @@
              <string/>
             </property>
             <property name="text">
-             <string>Carrier-Phase Error/Baseline</string>
+             <string>Vertical Ionospheric Delay (m/10km)</string>
             </property>
            </widget>
           </item>
-          <item row="6" column="0">
-           <widget class="QLabel" name="Label10">
+          <item row="2" column="1" colspan="2">
+           <widget class="QLineEdit" name="PrNoise2">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1817,45 +1838,33 @@
              <string/>
             </property>
             <property name="text">
-             <string>Doppler Frequency (Hz)</string>
+             <string>1.0E-03</string>
             </property>
            </widget>
           </item>
-          <item row="3" column="2">
-           <widget class="QDoubleSpinBox" name="MeasErr3">
-            <property name="suffix">
-             <string> m</string>
-            </property>
-            <property name="decimals">
-             <number>3</number>
-            </property>
-            <property name="maximum">
-             <double>10.000000000000000</double>
+          <item row="3" column="0">
+           <widget class="QLabel" name="Label28">
+            <property name="enabled">
+             <bool>true</bool>
             </property>
-            <property name="singleStep">
-             <double>0.001000000000000</double>
+            <property name="toolTip">
+             <string/>
             </property>
-            <property name="value">
-             <double>0.003000000000000</double>
+            <property name="text">
+             <string>Zenith Tropospheric Delay (m)</string>
             </property>
            </widget>
           </item>
-          <item row="3" column="1">
-           <widget class="QDoubleSpinBox" name="MeasErr2">
-            <property name="suffix">
-             <string> m</string>
-            </property>
-            <property name="decimals">
-             <number>3</number>
-            </property>
-            <property name="maximum">
-             <double>10.000000000000000</double>
+          <item row="3" column="1" colspan="2">
+           <widget class="QLineEdit" name="PrNoise3">
+            <property name="enabled">
+             <bool>true</bool>
             </property>
-            <property name="singleStep">
-             <double>0.001000000000000</double>
+            <property name="toolTip">
+             <string/>
             </property>
-            <property name="value">
-             <double>0.003000000000000</double>
+            <property name="text">
+             <string>1.0E-04</string>
             </property>
            </widget>
           </item>
@@ -1898,34 +1907,55 @@
        <string>&amp;Positions</string>
       </attribute>
       <layout class="QGridLayout" name="gridLayout_5">
-       <item row="4" column="0">
-        <widget class="QWidget" name="widget_3" native="true">
-         <property name="sizePolicy">
-          <sizepolicy hsizetype="Preferred" vsizetype="Maximum">
-           <horstretch>0</horstretch>
-           <verstretch>0</verstretch>
-          </sizepolicy>
+       <item row="0" column="0" rowspan="2" colspan="4">
+        <widget class="QGroupBox" name="GroupRovAnt">
+         <property name="toolTip">
+          <string/>
          </property>
-         <layout class="QGridLayout" name="gridLayout_12">
-          <item row="1" column="1">
-           <widget class="QPushButton" name="BtnStaPosView">
+         <property name="title">
+          <string>Rover</string>
+         </property>
+         <layout class="QGridLayout" name="gridLayout_11">
+          <item row="0" column="0" colspan="2">
+           <widget class="QComboBox" name="RovPosTypeP">
             <property name="enabled">
-             <bool>true</bool>
+             <bool>false</bool>
             </property>
             <property name="toolTip">
              <string/>
             </property>
-            <property name="icon">
-             <iconset resource="../rtkvideo_qt/rtkvideo_qt.qrc">
-              <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
-            </property>
-            <property name="flat">
+            <item>
+             <property name="text">
+              <string>Lat/Lon/Height deg/m</string>
+             </property>
+            </item>
+            <item>
+             <property name="text">
+              <string>Lat/Lon/Height dms/m</string>
+             </property>
+            </item>
+            <item>
+             <property name="text">
+              <string>X/Y/Z-ECEF m</string>
+             </property>
+            </item>
+           </widget>
+          </item>
+          <item row="0" column="5">
+           <widget class="QPushButton" name="BtnRovPos">
+            <property name="enabled">
              <bool>true</bool>
             </property>
+            <property name="toolTip">
+             <string/>
+            </property>
+            <property name="text">
+             <string>...</string>
+            </property>
            </widget>
           </item>
           <item row="1" column="0">
-           <widget class="QLineEdit" name="StaPosFile">
+           <widget class="QLineEdit" name="RovPos1">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1933,12 +1963,12 @@
              <string/>
             </property>
             <property name="text">
-             <string/>
+             <string>0</string>
             </property>
            </widget>
           </item>
-          <item row="0" column="0">
-           <widget class="QLabel" name="Label30">
+          <item row="1" column="1" colspan="2">
+           <widget class="QLineEdit" name="RovPos2">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1946,12 +1976,12 @@
              <string/>
             </property>
             <property name="text">
-             <string>Station Position File</string>
+             <string>0</string>
             </property>
            </widget>
           </item>
-          <item row="1" column="2">
-           <widget class="QPushButton" name="BtnStaPosFile">
+          <item row="1" column="3" colspan="3">
+           <widget class="QLineEdit" name="RovPos3">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1959,24 +1989,12 @@
              <string/>
             </property>
             <property name="text">
-             <string>...</string>
+             <string>0</string>
             </property>
            </widget>
           </item>
-         </layout>
-        </widget>
-       </item>
-       <item row="3" column="0">
-        <widget class="QGroupBox" name="GroupRefAnt">
-         <property name="toolTip">
-          <string/>
-         </property>
-         <property name="title">
-          <string>Base Station</string>
-         </property>
-         <layout class="QGridLayout" name="gridLayout_10">
           <item row="2" column="0" colspan="2">
-           <widget class="QCheckBox" name="RefAntPcv">
+           <widget class="QCheckBox" name="RovAntPcv">
             <property name="toolTip">
              <string/>
             </property>
@@ -1988,15 +2006,8 @@
             </property>
            </widget>
           </item>
-          <item row="0" column="5">
-           <widget class="QCheckBox" name="ChkInitRestart">
-            <property name="text">
-             <string>Init by Restart</string>
-            </property>
-           </widget>
-          </item>
-          <item row="0" column="6">
-           <widget class="QPushButton" name="BtnRefPos">
+          <item row="2" column="2" colspan="3">
+           <widget class="QLabel" name="LabelRovAntD">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -2004,25 +2015,22 @@
              <string/>
             </property>
             <property name="text">
-             <string>...</string>
+             <string>Delta-E/N/U (m)</string>
             </property>
            </widget>
           </item>
-          <item row="1" column="0">
-           <widget class="QLineEdit" name="RefPos1">
+          <item row="3" column="0" colspan="2">
+           <widget class="QComboBox" name="RovAnt">
             <property name="enabled">
              <bool>true</bool>
             </property>
             <property name="toolTip">
              <string/>
             </property>
-            <property name="text">
-             <string>0</string>
-            </property>
            </widget>
           </item>
-          <item row="1" column="1" colspan="2">
-           <widget class="QLineEdit" name="RefPos2">
+          <item row="3" column="2" colspan="2">
+           <widget class="QLineEdit" name="RovAntE">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -2034,8 +2042,8 @@
             </property>
            </widget>
           </item>
-          <item row="1" column="3" colspan="4">
-           <widget class="QLineEdit" name="RefPos3">
+          <item row="3" column="4">
+           <widget class="QLineEdit" name="RovAntN">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -2047,103 +2055,68 @@
             </property>
            </widget>
           </item>
-          <item row="0" column="4">
-           <widget class="QSpinBox" name="MaxAveEp">
-            <property name="maximum">
-             <number>10000</number>
-            </property>
-            <property name="value">
-             <number>3600</number>
-            </property>
-           </widget>
-          </item>
-          <item row="0" column="0">
-           <widget class="QComboBox" name="RefPosTypeP">
+          <item row="3" column="5">
+           <widget class="QLineEdit" name="RovAntU">
             <property name="enabled">
              <bool>true</bool>
             </property>
             <property name="toolTip">
              <string/>
             </property>
-            <item>
-             <property name="text">
-              <string>Lat/Lon/Height (deg/m)</string>
-             </property>
-            </item>
-            <item>
-             <property name="text">
-              <string>Lat/Lon/Height (dms/m)</string>
-             </property>
-            </item>
-            <item>
-             <property name="text">
-              <string>X/Y/Z-ECEF m</string>
-             </property>
-            </item>
-            <item>
-             <property name="text">
-              <string>RTCM Antenna Position</string>
-             </property>
-            </item>
-            <item>
-             <property name="text">
-              <string>Raw Antenna Position</string>
-             </property>
-            </item>
-            <item>
-             <property name="text">
-              <string>Average of Single Position</string>
-             </property>
-            </item>
-           </widget>
-          </item>
-          <item row="0" column="1" colspan="3">
-           <widget class="QLabel" name="LabelMaxAveEp">
             <property name="text">
-             <string>Max # Ave (ep)</string>
-            </property>
-           </widget>
-          </item>
-          <item row="4" column="6">
-           <widget class="QDoubleSpinBox" name="RefAntU">
-            <property name="suffix">
-             <string> m</string>
-            </property>
-            <property name="decimals">
-             <number>4</number>
-            </property>
-            <property name="maximum">
-             <double>1000000.000000000000000</double>
+             <string>0</string>
             </property>
            </widget>
           </item>
-          <item row="4" column="5">
-           <widget class="QDoubleSpinBox" name="RefAntN">
-            <property name="suffix">
-             <string> m</string>
-            </property>
-            <property name="decimals">
-             <number>4</number>
+         </layout>
+        </widget>
+       </item>
+       <item row="1" column="1">
+        <widget class="QLabel" name="Label4">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string/>
+         </property>
+        </widget>
+       </item>
+       <item row="2" column="0" colspan="4">
+        <widget class="QGroupBox" name="GroupRefAnt">
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="title">
+          <string>Base Station</string>
+         </property>
+         <layout class="QGridLayout" name="gridLayout_10">
+          <item row="3" column="0" colspan="2">
+           <widget class="QComboBox" name="RefAnt">
+            <property name="enabled">
+             <bool>true</bool>
             </property>
-            <property name="maximum">
-             <double>1000000.000000000000000</double>
+            <property name="toolTip">
+             <string/>
             </property>
            </widget>
           </item>
-          <item row="4" column="4">
-           <widget class="QDoubleSpinBox" name="RefAntE">
-            <property name="suffix">
-             <string> m</string>
+          <item row="2" column="0" colspan="2">
+           <widget class="QCheckBox" name="RefAntPcv">
+            <property name="toolTip">
+             <string/>
             </property>
-            <property name="decimals">
-             <number>4</number>
+            <property name="text">
+             <string>Antenna Type (*: Auto)</string>
             </property>
-            <property name="maximum">
-             <double>1000000.000000000000000</double>
+            <property name="checked">
+             <bool>false</bool>
             </property>
            </widget>
           </item>
-          <item row="2" column="4">
+          <item row="2" column="2" colspan="4">
            <widget class="QLabel" name="LabelRefAntD">
             <property name="enabled">
              <bool>true</bool>
@@ -2156,55 +2129,15 @@
             </property>
            </widget>
           </item>
-          <item row="4" column="0" colspan="3">
-           <widget class="QComboBox" name="RefAnt">
-            <property name="enabled">
-             <bool>true</bool>
-            </property>
-            <property name="toolTip">
-             <string/>
-            </property>
-           </widget>
-          </item>
-         </layout>
-        </widget>
-       </item>
-       <item row="1" column="0">
-        <widget class="QGroupBox" name="GroupRovAnt">
-         <property name="toolTip">
-          <string/>
-         </property>
-         <property name="title">
-          <string>Rover</string>
-         </property>
-         <layout class="QGridLayout" name="gridLayout_11">
-          <item row="0" column="0" colspan="2">
-           <widget class="QComboBox" name="RovPosTypeP">
-            <property name="enabled">
-             <bool>false</bool>
-            </property>
-            <property name="toolTip">
-             <string/>
+          <item row="0" column="5">
+           <widget class="QCheckBox" name="ChkInitRestart">
+            <property name="text">
+             <string>Init by Restart</string>
             </property>
-            <item>
-             <property name="text">
-              <string>Lat/Lon/Height deg/m</string>
-             </property>
-            </item>
-            <item>
-             <property name="text">
-              <string>Lat/Lon/Height dms/m</string>
-             </property>
-            </item>
-            <item>
-             <property name="text">
-              <string>X/Y/Z-ECEF m</string>
-             </property>
-            </item>
            </widget>
           </item>
-          <item row="0" column="5">
-           <widget class="QPushButton" name="BtnRovPos">
+          <item row="0" column="6">
+           <widget class="QPushButton" name="BtnRefPos">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -2217,7 +2150,7 @@
            </widget>
           </item>
           <item row="1" column="0">
-           <widget class="QLineEdit" name="RovPos1">
+           <widget class="QLineEdit" name="RefPos1">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -2230,7 +2163,7 @@
            </widget>
           </item>
           <item row="1" column="1" colspan="2">
-           <widget class="QLineEdit" name="RovPos2">
+           <widget class="QLineEdit" name="RefPos2">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -2242,8 +2175,8 @@
             </property>
            </widget>
           </item>
-          <item row="1" column="3" colspan="3">
-           <widget class="QLineEdit" name="RovPos3">
+          <item row="1" column="3" colspan="4">
+           <widget class="QLineEdit" name="RefPos3">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -2255,21 +2188,21 @@
             </property>
            </widget>
           </item>
-          <item row="3" column="0" colspan="2">
-           <widget class="QCheckBox" name="RovAntPcv">
+          <item row="3" column="6">
+           <widget class="QLineEdit" name="RefAntU">
+            <property name="enabled">
+             <bool>true</bool>
+            </property>
             <property name="toolTip">
              <string/>
             </property>
             <property name="text">
-             <string>Antenna Type (*: Auto)</string>
-            </property>
-            <property name="checked">
-             <bool>false</bool>
+             <string>0</string>
             </property>
            </widget>
           </item>
-          <item row="3" column="2" colspan="3">
-           <widget class="QLabel" name="LabelRovAntD">
+          <item row="3" column="2" colspan="2">
+           <widget class="QLineEdit" name="RefAntE">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -2277,74 +2210,85 @@
              <string/>
             </property>
             <property name="text">
-             <string>Delta-E/N/U</string>
+             <string>0</string>
             </property>
            </widget>
           </item>
-          <item row="5" column="0" colspan="2">
-           <widget class="QComboBox" name="RovAnt">
+          <item row="3" column="5">
+           <widget class="QLineEdit" name="RefAntN">
             <property name="enabled">
              <bool>true</bool>
             </property>
             <property name="toolTip">
              <string/>
             </property>
+            <property name="text">
+             <string>0</string>
+            </property>
            </widget>
           </item>
-          <item row="5" column="2">
-           <widget class="QDoubleSpinBox" name="RovAntE">
-            <property name="suffix">
-             <string> m</string>
-            </property>
-            <property name="decimals">
-             <number>4</number>
-            </property>
+          <item row="0" column="4">
+           <widget class="QSpinBox" name="MaxAveEp">
             <property name="maximum">
-             <double>1000000.000000000000000</double>
+             <number>10000</number>
+            </property>
+            <property name="value">
+             <number>3600</number>
             </property>
            </widget>
           </item>
-          <item row="5" column="5">
-           <widget class="QDoubleSpinBox" name="RovAntU">
-            <property name="suffix">
-             <string> m</string>
-            </property>
-            <property name="decimals">
-             <number>4</number>
+          <item row="0" column="0">
+           <widget class="QComboBox" name="RefPosTypeP">
+            <property name="enabled">
+             <bool>true</bool>
             </property>
-            <property name="maximum">
-             <double>1000000.000000000000000</double>
+            <property name="toolTip">
+             <string/>
             </property>
+            <item>
+             <property name="text">
+              <string>Lat/Lon/Height (deg/m)</string>
+             </property>
+            </item>
+            <item>
+             <property name="text">
+              <string>Lat/Lon/Height (dms/m)</string>
+             </property>
+            </item>
+            <item>
+             <property name="text">
+              <string>X/Y/Z-ECEF m</string>
+             </property>
+            </item>
+            <item>
+             <property name="text">
+              <string>RTCM Antenna Position</string>
+             </property>
+            </item>
+            <item>
+             <property name="text">
+              <string>Raw Antenna Position</string>
+             </property>
+            </item>
+            <item>
+             <property name="text">
+              <string>Average of Single Position</string>
+             </property>
+            </item>
            </widget>
           </item>
-          <item row="5" column="3" colspan="2">
-           <widget class="QDoubleSpinBox" name="RovAntN">
-            <property name="suffix">
-             <string> m</string>
-            </property>
-            <property name="decimals">
-             <number>4</number>
-            </property>
-            <property name="maximum">
-             <double>1000000.000000000000000</double>
+          <item row="0" column="1" colspan="3">
+           <widget class="QLabel" name="LabelMaxAveEp">
+            <property name="text">
+             <string>Max # Ave (ep)</string>
             </property>
            </widget>
           </item>
          </layout>
         </widget>
        </item>
-      </layout>
-     </widget>
-     <widget class="QWidget" name="TabSheet7">
-      <property name="toolTip">
-       <string/>
-      </property>
-      <attribute name="title">
-       <string>&amp;Files</string>
-      </attribute>
-      <layout class="QGridLayout" name="gridLayout_6">
-       <item row="1" column="3">
-        <widget class="QPushButton" name="BtnSatPcvFile">
+       <item row="3" column="0" colspan="2">
+        <widget class="QLabel" name="Label30">
          <property name="enabled">
           <bool>true</bool>
          </property>
@@ -2352,25 +2296,29 @@
           <string/>
          </property>
          <property name="text">
-          <string>...</string>
+          <string>Station Position File</string>
          </property>
         </widget>
        </item>
-       <item row="20" column="0" colspan="2">
-        <widget class="QLineEdit" name="OLFile">
+       <item row="4" column="2">
+        <widget class="QPushButton" name="BtnStaPosView">
          <property name="enabled">
           <bool>true</bool>
          </property>
          <property name="toolTip">
           <string/>
          </property>
-         <property name="text">
-          <string/>
+         <property name="icon">
+          <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+           <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
+         </property>
+         <property name="flat">
+          <bool>true</bool>
          </property>
         </widget>
        </item>
-       <item row="7" column="0" colspan="2">
-        <widget class="QLineEdit" name="DCBFile">
+       <item row="4" column="0">
+        <widget class="QLineEdit" name="StaPosFile">
          <property name="enabled">
           <bool>true</bool>
          </property>
@@ -2382,8 +2330,8 @@
          </property>
         </widget>
        </item>
-       <item row="23" column="0">
-        <widget class="QLabel" name="Label31">
+       <item row="4" column="3">
+        <widget class="QPushButton" name="BtnStaPosFile">
          <property name="enabled">
           <bool>true</bool>
          </property>
@@ -2391,10 +2339,20 @@
           <string/>
          </property>
          <property name="text">
-          <string>FTP/HTTP Local Directory</string>
+          <string>...</string>
          </property>
         </widget>
        </item>
+      </layout>
+     </widget>
+     <widget class="QWidget" name="TabSheet7">
+      <property name="toolTip">
+       <string/>
+      </property>
+      <attribute name="title">
+       <string>&amp;Files</string>
+      </attribute>
+      <layout class="QGridLayout" name="gridLayout_6">
        <item row="0" column="1">
         <widget class="QPushButton" name="BtnSatPcvView">
          <property name="enabled">
@@ -2413,7 +2371,7 @@
           <string/>
          </property>
          <property name="icon">
-          <iconset resource="../rtkvideo_qt/rtkvideo_qt.qrc">
+          <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
            <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
          </property>
          <property name="flat">
@@ -2434,6 +2392,19 @@
          </property>
         </widget>
        </item>
+       <item row="1" column="3">
+        <widget class="QPushButton" name="BtnSatPcvFile">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>...</string>
+         </property>
+        </widget>
+       </item>
        <item row="2" column="3">
         <widget class="QPushButton" name="BtnAntPcvFile">
          <property name="enabled">
@@ -2499,7 +2470,20 @@
          </property>
         </widget>
        </item>
-       <item row="24" column="0" colspan="2">
+       <item row="5" column="0">
+        <widget class="QLabel" name="Label1">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>DCB Data File</string>
+         </property>
+        </widget>
+       </item>
+       <item row="15" column="0" colspan="2">
         <widget class="QLineEdit" name="LocalDir">
          <property name="enabled">
           <bool>true</bool>
@@ -2512,7 +2496,20 @@
          </property>
         </widget>
        </item>
-       <item row="24" column="3">
+       <item row="14" column="0">
+        <widget class="QLabel" name="Label31">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>FTP/HTTP Local Directory</string>
+         </property>
+        </widget>
+       </item>
+       <item row="15" column="3">
         <widget class="QPushButton" name="BtnLocalDir">
          <property name="enabled">
           <bool>true</bool>
@@ -2554,7 +2551,20 @@
          </property>
         </widget>
        </item>
-       <item row="11" column="3" rowspan="2">
+       <item row="6" column="0" rowspan="2" colspan="2">
+        <widget class="QLineEdit" name="DCBFile">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string/>
+         </property>
+        </widget>
+       </item>
+       <item row="8" column="3" rowspan="2">
         <widget class="QPushButton" name="BtnEOPView">
          <property name="enabled">
           <bool>true</bool>
@@ -2570,7 +2580,46 @@
          </property>
         </widget>
        </item>
-       <item row="18" column="3" rowspan="2">
+       <item row="8" column="0">
+        <widget class="QLabel" name="Label23">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>EOP Data File</string>
+         </property>
+        </widget>
+       </item>
+       <item row="9" column="0" rowspan="2" colspan="2">
+        <widget class="QLineEdit" name="EOPFile">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string/>
+         </property>
+        </widget>
+       </item>
+       <item row="10" column="3">
+        <widget class="QPushButton" name="BtnEOPFile">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>...</string>
+         </property>
+        </widget>
+       </item>
+       <item row="11" column="3" rowspan="2">
         <widget class="QPushButton" name="BtnOLFileView">
          <property name="enabled">
           <bool>true</bool>
@@ -2586,7 +2635,33 @@
          </property>
         </widget>
        </item>
-       <item row="20" column="3">
+       <item row="12" column="0" rowspan="2" colspan="2">
+        <widget class="QLineEdit" name="OLFile">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string/>
+         </property>
+        </widget>
+       </item>
+       <item row="11" column="0">
+        <widget class="QLabel" name="Label34">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>Ocean Loading BLQ Format</string>
+         </property>
+        </widget>
+       </item>
+       <item row="13" column="3">
         <widget class="QPushButton" name="BtnOLFile">
          <property name="enabled">
           <bool>true</bool>
@@ -2630,7 +2705,7 @@
           <string/>
          </property>
          <property name="icon">
-          <iconset resource="../rtkvideo_qt/rtkvideo_qt.qrc">
+          <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
            <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
          </property>
          <property name="flat">
@@ -2638,8 +2713,18 @@
          </property>
         </widget>
        </item>
-       <item row="13" column="3">
-        <widget class="QPushButton" name="BtnEOPFile">
+      </layout>
+     </widget>
+     <widget class="QWidget" name="TabSheet8">
+      <property name="toolTip">
+       <string/>
+      </property>
+      <attribute name="title">
+       <string>&amp;Misc</string>
+      </attribute>
+      <layout class="QGridLayout" name="gridLayout_7">
+       <item row="0" column="0" colspan="4">
+        <widget class="QLabel" name="Label19">
          <property name="enabled">
           <bool>true</bool>
          </property>
@@ -2647,12 +2732,12 @@
           <string/>
          </property>
          <property name="text">
-          <string>...</string>
+          <string>Process Cycle (ms) / Buffer Size (bytes)</string>
          </property>
         </widget>
        </item>
-       <item row="13" column="0" colspan="2">
-        <widget class="QLineEdit" name="EOPFile">
+       <item row="0" column="4">
+        <widget class="QLineEdit" name="SvrCycleE">
          <property name="enabled">
           <bool>true</bool>
          </property>
@@ -2660,12 +2745,25 @@
           <string/>
          </property>
          <property name="text">
+          <string>10</string>
+         </property>
+        </widget>
+       </item>
+       <item row="0" column="5">
+        <widget class="QLineEdit" name="SvrBuffSizeE">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
           <string/>
          </property>
+         <property name="text">
+          <string>32768</string>
+         </property>
         </widget>
        </item>
-       <item row="19" column="0">
-        <widget class="QLabel" name="Label34">
+       <item row="1" column="0" colspan="4">
+        <widget class="QLabel" name="Label44">
          <property name="enabled">
           <bool>true</bool>
          </property>
@@ -2673,12 +2771,12 @@
           <string/>
          </property>
          <property name="text">
-          <string>Ocean Loading BLQ Format</string>
+          <string>Timeout / Reconnect Interval (ms)</string>
          </property>
         </widget>
        </item>
-       <item row="12" column="0">
-        <widget class="QLabel" name="Label23">
+       <item row="1" column="4">
+        <widget class="QLineEdit" name="TimeoutTimeE">
          <property name="enabled">
           <bool>true</bool>
          </property>
@@ -2686,12 +2784,12 @@
           <string/>
          </property>
          <property name="text">
-          <string>EOP Data File</string>
+          <string>10000</string>
          </property>
         </widget>
        </item>
-       <item row="6" column="0">
-        <widget class="QLabel" name="Label1">
+       <item row="1" column="5">
+        <widget class="QLineEdit" name="ReconTimeE">
          <property name="enabled">
           <bool>true</bool>
          </property>
@@ -2699,22 +2797,12 @@
           <string/>
          </property>
          <property name="text">
-          <string>DCB Data File</string>
+          <string>10000</string>
          </property>
         </widget>
        </item>
-      </layout>
-     </widget>
-     <widget class="QWidget" name="TabSheet8">
-      <property name="toolTip">
-       <string/>
-      </property>
-      <attribute name="title">
-       <string>&amp;Misc</string>
-      </attribute>
-      <layout class="QGridLayout" name="gridLayout_7">
-       <item row="1" column="0" colspan="4">
-        <widget class="QLabel" name="Label19">
+       <item row="2" column="0" colspan="4">
+        <widget class="QLabel" name="Label46">
          <property name="enabled">
           <bool>true</bool>
          </property>
@@ -2722,12 +2810,12 @@
           <string/>
          </property>
          <property name="text">
-          <string>Process Cycle / Buffer Size</string>
+          <string>NMEA Cycle (ms) / File Swap Margin (s)</string>
          </property>
         </widget>
        </item>
-       <item row="3" column="0" colspan="4">
-        <widget class="QLabel" name="Label44">
+       <item row="2" column="4">
+        <widget class="QLineEdit" name="NmeaCycleE">
          <property name="enabled">
           <bool>true</bool>
          </property>
@@ -2735,12 +2823,12 @@
           <string/>
          </property>
          <property name="text">
-          <string>Timeout / Reconnect Interval</string>
+          <string>5000</string>
          </property>
         </widget>
        </item>
-       <item row="5" column="0" colspan="4">
-        <widget class="QLabel" name="Label46">
+       <item row="2" column="5">
+        <widget class="QLineEdit" name="FileSwapMarginE">
          <property name="enabled">
           <bool>true</bool>
          </property>
@@ -2748,11 +2836,11 @@
           <string/>
          </property>
          <property name="text">
-          <string>NMEA Cycle / File Swap Margin</string>
+          <string>30</string>
          </property>
         </widget>
        </item>
-       <item row="7" column="0" colspan="4">
+       <item row="3" column="0" colspan="4">
         <widget class="QLabel" name="Label41">
          <property name="enabled">
           <bool>true</bool>
@@ -2761,11 +2849,37 @@
           <string/>
          </property>
          <property name="text">
-          <string>Solution Buffer/ Log Size</string>
+          <string>Solution Buffer/ Log Size (epochs)</string>
          </property>
         </widget>
        </item>
-       <item row="8" column="0" colspan="4">
+       <item row="3" column="4">
+        <widget class="QLineEdit" name="SolBuffSizeE">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>1000</string>
+         </property>
+        </widget>
+       </item>
+       <item row="3" column="5">
+        <widget class="QLineEdit" name="SavedSolE">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>100</string>
+         </property>
+        </widget>
+       </item>
+       <item row="4" column="0" colspan="4">
         <widget class="QLabel" name="Label42">
          <property name="enabled">
           <bool>true</bool>
@@ -2778,7 +2892,7 @@
          </property>
         </widget>
        </item>
-       <item row="8" column="4" colspan="2">
+       <item row="4" column="4" colspan="2">
         <widget class="QComboBox" name="NavSelectS">
          <property name="enabled">
           <bool>true</bool>
@@ -2808,7 +2922,7 @@
          </item>
         </widget>
        </item>
-       <item row="10" column="0" colspan="4">
+       <item row="5" column="0" colspan="4">
         <widget class="QLabel" name="Label5">
          <property name="enabled">
           <bool>true</bool>
@@ -2821,7 +2935,33 @@
          </property>
         </widget>
        </item>
-       <item row="11" column="0" colspan="3">
+       <item row="5" column="4">
+        <widget class="QLineEdit" name="SbasSatE">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>0</string>
+         </property>
+        </widget>
+       </item>
+       <item row="5" column="5">
+        <widget class="QLineEdit" name="MoniPortE">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>0</string>
+         </property>
+        </widget>
+       </item>
+       <item row="6" column="0" colspan="3">
         <widget class="QLabel" name="Label45">
          <property name="enabled">
           <bool>true</bool>
@@ -2834,7 +2974,7 @@
          </property>
         </widget>
        </item>
-       <item row="11" column="3" colspan="3">
+       <item row="6" column="3" colspan="3">
         <widget class="QLineEdit" name="ProxyAddrE">
          <property name="enabled">
           <bool>true</bool>
@@ -2847,7 +2987,40 @@
          </property>
         </widget>
        </item>
-       <item row="13" column="3">
+       <item row="7" column="0" colspan="2">
+        <widget class="QLabel" name="Label43">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>Layout</string>
+         </property>
+        </widget>
+       </item>
+       <item row="7" column="2">
+        <widget class="QComboBox" name="PanelStackE">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <item>
+          <property name="text">
+           <string>Horizontal</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>Vertical</string>
+          </property>
+         </item>
+        </widget>
+       </item>
+       <item row="7" column="3">
         <widget class="QLabel" name="Label40">
          <property name="enabled">
           <bool>true</bool>
@@ -2860,7 +3033,7 @@
          </property>
         </widget>
        </item>
-       <item row="13" column="4">
+       <item row="7" column="4" colspan="2">
         <widget class="QLabel" name="FontLabel">
          <property name="enabled">
           <bool>true</bool>
@@ -2913,7 +3086,7 @@
          </property>
         </widget>
        </item>
-       <item row="13" column="5">
+       <item row="7" column="6">
         <widget class="QPushButton" name="BtnFont">
          <property name="enabled">
           <bool>true</bool>
@@ -2932,7 +3105,7 @@
          </property>
         </widget>
        </item>
-       <item row="14" column="0">
+       <item row="8" column="0">
         <widget class="QLabel" name="Label15">
          <property name="enabled">
           <bool>true</bool>
@@ -2945,7 +3118,7 @@
          </property>
         </widget>
        </item>
-       <item row="14" column="1" colspan="4">
+       <item row="8" column="1" colspan="5">
         <widget class="QLineEdit" name="TLEFile">
          <property name="enabled">
           <bool>true</bool>
@@ -2958,7 +3131,7 @@
          </property>
         </widget>
        </item>
-       <item row="14" column="5">
+       <item row="8" column="6">
         <widget class="QPushButton" name="BtnTLEFile">
          <property name="enabled">
           <bool>true</bool>
@@ -2977,7 +3150,7 @@
          </property>
         </widget>
        </item>
-       <item row="15" column="0">
+       <item row="9" column="0">
         <widget class="QLabel" name="Label39">
          <property name="enabled">
           <bool>true</bool>
@@ -2990,7 +3163,7 @@
          </property>
         </widget>
        </item>
-       <item row="15" column="1" colspan="4">
+       <item row="9" column="1" colspan="5">
         <widget class="QLineEdit" name="TLESatFile">
          <property name="enabled">
           <bool>true</bool>
@@ -3003,7 +3176,7 @@
          </property>
         </widget>
        </item>
-       <item row="15" column="5">
+       <item row="9" column="6">
         <widget class="QPushButton" name="BtnTLESatFile">
          <property name="enabled">
           <bool>true</bool>
@@ -3022,157 +3195,6 @@
          </property>
         </widget>
        </item>
-       <item row="3" column="4">
-        <widget class="QSpinBox" name="TimeoutTimeE">
-         <property name="suffix">
-          <string> ms</string>
-         </property>
-         <property name="maximum">
-          <number>1000000</number>
-         </property>
-         <property name="value">
-          <number>10000</number>
-         </property>
-        </widget>
-       </item>
-       <item row="10" column="4">
-        <widget class="QSpinBox" name="SbasSatE">
-         <property name="maximum">
-          <number>65535</number>
-         </property>
-        </widget>
-       </item>
-       <item row="1" column="4">
-        <widget class="QSpinBox" name="SvrCycleE">
-         <property name="suffix">
-          <string> ms</string>
-         </property>
-         <property name="maximum">
-          <number>10000</number>
-         </property>
-         <property name="value">
-          <number>10</number>
-         </property>
-        </widget>
-       </item>
-       <item row="5" column="4">
-        <widget class="QSpinBox" name="NmeaCycleE">
-         <property name="suffix">
-          <string> ms</string>
-         </property>
-         <property name="maximum">
-          <number>1000000</number>
-         </property>
-         <property name="value">
-          <number>5000</number>
-         </property>
-        </widget>
-       </item>
-       <item row="3" column="5">
-        <widget class="QSpinBox" name="ReconTimeE">
-         <property name="suffix">
-          <string> ms</string>
-         </property>
-         <property name="maximum">
-          <number>1000000</number>
-         </property>
-         <property name="value">
-          <number>10000</number>
-         </property>
-        </widget>
-       </item>
-       <item row="1" column="5">
-        <widget class="QSpinBox" name="SvrBuffSizeE">
-         <property name="suffix">
-          <string> bytes</string>
-         </property>
-         <property name="maximum">
-          <number>10000000</number>
-         </property>
-         <property name="value">
-          <number>32768</number>
-         </property>
-        </widget>
-       </item>
-       <item row="7" column="4">
-        <widget class="QSpinBox" name="SolBuffSizeE">
-         <property name="suffix">
-          <string> epochs</string>
-         </property>
-         <property name="maximum">
-          <number>1000000</number>
-         </property>
-         <property name="value">
-          <number>1000</number>
-         </property>
-        </widget>
-       </item>
-       <item row="7" column="5">
-        <widget class="QSpinBox" name="SavedSolE">
-         <property name="suffix">
-          <string> epochs</string>
-         </property>
-         <property name="maximum">
-          <number>1000000</number>
-         </property>
-         <property name="value">
-          <number>100</number>
-         </property>
-        </widget>
-       </item>
-       <item row="5" column="5">
-        <widget class="QSpinBox" name="FileSwapMarginE">
-         <property name="suffix">
-          <string> s</string>
-         </property>
-         <property name="maximum">
-          <number>10000</number>
-         </property>
-         <property name="value">
-          <number>30</number>
-         </property>
-        </widget>
-       </item>
-       <item row="10" column="5">
-        <widget class="QSpinBox" name="MoniPortE">
-         <property name="maximum">
-          <number>65535</number>
-         </property>
-        </widget>
-       </item>
-       <item row="13" column="0">
-        <widget class="QLabel" name="Label43">
-         <property name="enabled">
-          <bool>true</bool>
-         </property>
-         <property name="toolTip">
-          <string/>
-         </property>
-         <property name="text">
-          <string>Layout</string>
-         </property>
-        </widget>
-       </item>
-       <item row="13" column="1" colspan="2">
-        <widget class="QComboBox" name="PanelStackE">
-         <property name="enabled">
-          <bool>true</bool>
-         </property>
-         <property name="toolTip">
-          <string/>
-         </property>
-         <item>
-          <property name="text">
-           <string>Horizontal</string>
-          </property>
-         </item>
-         <item>
-          <property name="text">
-           <string>Vertical</string>
-          </property>
-         </item>
-        </widget>
-       </item>
       </layout>
      </widget>
     </widget>
@@ -3256,142 +3278,8 @@
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>BtnOk</tabstop>
-  <tabstop>BtnCancel</tabstop>
-  <tabstop>Options</tabstop>
-  <tabstop>PosMode</tabstop>
-  <tabstop>Freq</tabstop>
-  <tabstop>Solution</tabstop>
-  <tabstop>ElMask</tabstop>
-  <tabstop>BtnSnrMask</tabstop>
-  <tabstop>DynamicModel</tabstop>
-  <tabstop>TideCorr</tabstop>
-  <tabstop>IonoOpt</tabstop>
-  <tabstop>TropOpt</tabstop>
-  <tabstop>SatEphem</tabstop>
-  <tabstop>PosOpt1</tabstop>
-  <tabstop>PosOpt2</tabstop>
-  <tabstop>PosOpt3</tabstop>
-  <tabstop>PosOpt4</tabstop>
-  <tabstop>PosOpt5</tabstop>
-  <tabstop>ExSatsE</tabstop>
-  <tabstop>NavSys1</tabstop>
-  <tabstop>NavSys2</tabstop>
-  <tabstop>NavSys3</tabstop>
-  <tabstop>NavSys4</tabstop>
-  <tabstop>NavSys5</tabstop>
-  <tabstop>NavSys6</tabstop>
-  <tabstop>NavSys7</tabstop>
-  <tabstop>AmbRes</tabstop>
-  <tabstop>GloAmbRes</tabstop>
-  <tabstop>BdsAmbRes</tabstop>
-  <tabstop>ValidThresAR</tabstop>
-  <tabstop>ThresAR2</tabstop>
-  <tabstop>ThresAR3</tabstop>
-  <tabstop>LockCntFixAmb</tabstop>
-  <tabstop>ElMaskAR</tabstop>
-  <tabstop>FixCntHoldAmb</tabstop>
-  <tabstop>ElMaskHold</tabstop>
-  <tabstop>OutCntResetAmb</tabstop>
-  <tabstop>SlipThres</tabstop>
-  <tabstop>MaxAgeDiff</tabstop>
-  <tabstop>SyncSol</tabstop>
-  <tabstop>RejectGdop</tabstop>
-  <tabstop>RejectThres</tabstop>
-  <tabstop>NumIter</tabstop>
-  <tabstop>BaselineConst</tabstop>
-  <tabstop>BaselineLen</tabstop>
-  <tabstop>BaselineSig</tabstop>
-  <tabstop>SolFormat</tabstop>
-  <tabstop>OutputHead</tabstop>
-  <tabstop>OutputOpt</tabstop>
-  <tabstop>TimeFormat</tabstop>
-  <tabstop>TimeDecimal</tabstop>
-  <tabstop>LatLonFormat</tabstop>
-  <tabstop>FieldSep</tabstop>
-  <tabstop>OutputSingle</tabstop>
-  <tabstop>MaxSolStd</tabstop>
-  <tabstop>OutputDatum</tabstop>
-  <tabstop>OutputHeight</tabstop>
-  <tabstop>OutputGeoid</tabstop>
-  <tabstop>SolStatic</tabstop>
-  <tabstop>NmeaIntv1</tabstop>
-  <tabstop>NmeaIntv2</tabstop>
-  <tabstop>DebugStatus</tabstop>
-  <tabstop>DebugTrace</tabstop>
-  <tabstop>MeasErrR1</tabstop>
-  <tabstop>MeasErrR2</tabstop>
-  <tabstop>MeasErr2</tabstop>
-  <tabstop>MeasErr3</tabstop>
-  <tabstop>MeasErr4</tabstop>
-  <tabstop>MeasErr5</tabstop>
-  <tabstop>PrNoise4</tabstop>
-  <tabstop>PrNoise5</tabstop>
-  <tabstop>PrNoise1</tabstop>
-  <tabstop>PrNoise2</tabstop>
-  <tabstop>PrNoise3</tabstop>
-  <tabstop>SatClkStab</tabstop>
-  <tabstop>RovPosTypeP</tabstop>
-  <tabstop>BtnRovPos</tabstop>
-  <tabstop>RovPos1</tabstop>
-  <tabstop>RovPos2</tabstop>
-  <tabstop>RovPos3</tabstop>
-  <tabstop>RovAntPcv</tabstop>
-  <tabstop>RovAnt</tabstop>
-  <tabstop>RovAntE</tabstop>
-  <tabstop>RovAntN</tabstop>
-  <tabstop>RovAntU</tabstop>
-  <tabstop>RefPosTypeP</tabstop>
-  <tabstop>MaxAveEp</tabstop>
-  <tabstop>ChkInitRestart</tabstop>
-  <tabstop>BtnRefPos</tabstop>
-  <tabstop>RefPos1</tabstop>
-  <tabstop>RefPos2</tabstop>
-  <tabstop>RefPos3</tabstop>
-  <tabstop>RefAntPcv</tabstop>
-  <tabstop>RefAnt</tabstop>
-  <tabstop>RefAntE</tabstop>
-  <tabstop>RefAntN</tabstop>
-  <tabstop>RefAntU</tabstop>
-  <tabstop>StaPosFile</tabstop>
-  <tabstop>BtnStaPosView</tabstop>
-  <tabstop>BtnStaPosFile</tabstop>
-  <tabstop>BtnSatPcvView</tabstop>
-  <tabstop>BtnAntPcvView</tabstop>
-  <tabstop>SatPcvFile</tabstop>
-  <tabstop>AntPcvFile</tabstop>
-  <tabstop>BtnAntPcvFile</tabstop>
-  <tabstop>GeoidDataFile</tabstop>
-  <tabstop>BtnGeoidDataFile</tabstop>
-  <tabstop>BtnDCBView</tabstop>
-  <tabstop>BtnEOPView</tabstop>
-  <tabstop>BtnOLFileView</tabstop>
-  <tabstop>LocalDir</tabstop>
-  <tabstop>BtnLocalDir</tabstop>
-  <tabstop>SvrCycleE</tabstop>
-  <tabstop>SvrBuffSizeE</tabstop>
-  <tabstop>TimeoutTimeE</tabstop>
-  <tabstop>ReconTimeE</tabstop>
-  <tabstop>NmeaCycleE</tabstop>
-  <tabstop>FileSwapMarginE</tabstop>
-  <tabstop>SolBuffSizeE</tabstop>
-  <tabstop>SavedSolE</tabstop>
-  <tabstop>NavSelectS</tabstop>
-  <tabstop>SbasSatE</tabstop>
-  <tabstop>MoniPortE</tabstop>
-  <tabstop>ProxyAddrE</tabstop>
-  <tabstop>PanelStackE</tabstop>
-  <tabstop>BtnFont</tabstop>
-  <tabstop>TLEFile</tabstop>
-  <tabstop>BtnTLEFile</tabstop>
-  <tabstop>TLESatFile</tabstop>
-  <tabstop>BtnTLESatFile</tabstop>
-  <tabstop>BtnLoad</tabstop>
-  <tabstop>BtnSave</tabstop>
- </tabstops>
  <resources>
-  <include location="../rtkvideo_qt/rtkvideo_qt.qrc"/>
+  <include location="../rtkconv_qt/rtkconv_qt.qrc"/>
  </resources>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/outstrdlg.cpp RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/outstrdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/outstrdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/outstrdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -14,7 +14,7 @@
 
 //---------------------------------------------------------------------------
 //---------------------------------------------------------------------------
-OutputStrDialog::OutputStrDialog(QWidget *parent)
+OutputStrDialog::OutputStrDialog(QWidget* parent)
     : QDialog(parent)
 {
     setupUi(this);
@@ -23,24 +23,24 @@
     serialOptDialog = new SerialOptDialog(this);
     tcpOptDialog = new TcpOptDialog(this);
 
-    QCompleter *fileCompleter = new QCompleter(this);
-    QFileSystemModel *fileModel = new QFileSystemModel(fileCompleter);
+    QCompleter *fileCompleter=new QCompleter(this);
+    QFileSystemModel *fileModel=new QFileSystemModel(fileCompleter);
     fileModel->setRootPath("");
     fileCompleter->setModel(fileModel);
     FilePath1->setCompleter(fileCompleter);
     FilePath2->setCompleter(fileCompleter);
 
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(BtnFile1, SIGNAL(clicked(bool)), this, SLOT(BtnFile1Click()));
-    connect(BtnFile2, SIGNAL(clicked(bool)), this, SLOT(BtnFile2Click()));
-    connect(BtnKey, SIGNAL(clicked(bool)), this, SLOT(BtnKeyClick()));
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnStr1, SIGNAL(clicked(bool)), this, SLOT(BtnStr1Click()));
-    connect(BtnStr2, SIGNAL(clicked(bool)), this, SLOT(BtnStr2Click()));
-    connect(Stream1, SIGNAL(currentIndexChanged(int)), this, SLOT(Stream1Change(int)));
-    connect(Stream2, SIGNAL(currentIndexChanged(int)), this, SLOT(Stream2Change(int)));
-    connect(Stream1C, SIGNAL(clicked(bool)), this, SLOT(Stream1CClick()));
-    connect(Stream2C, SIGNAL(clicked(bool)), this, SLOT(Stream2CClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(BtnFile1,SIGNAL(clicked(bool)),this,SLOT(BtnFile1Click()));
+    connect(BtnFile2,SIGNAL(clicked(bool)),this,SLOT(BtnFile2Click()));
+    connect(BtnKey,SIGNAL(clicked(bool)),this,SLOT(BtnKeyClick()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnStr1,SIGNAL(clicked(bool)),this,SLOT(BtnStr1Click()));
+    connect(BtnStr2,SIGNAL(clicked(bool)),this,SLOT(BtnStr2Click()));
+    connect(Stream1,SIGNAL(currentIndexChanged(int)),this,SLOT(Stream1Change(int)));
+    connect(Stream2,SIGNAL(currentIndexChanged(int)),this,SLOT(Stream2Change(int)));
+    connect(Stream1C,SIGNAL(clicked(bool)),this,SLOT(Stream1CClick()));
+    connect(Stream2C,SIGNAL(clicked(bool)),this,SLOT(Stream2CClick()));
 
     SwapIntv->setValidator(new QDoubleValidator(this));
 }
@@ -49,44 +49,44 @@
 {
     if (event->spontaneous()) return;
 
-    Stream1C->setChecked(StreamC[0]);
-    Stream2C->setChecked(StreamC[1]);
-    Stream1->setCurrentIndex(Stream[0]);
-    Stream2->setCurrentIndex(Stream[1]);
-    Format1->setCurrentIndex(Format[0]);
-    Format2->setCurrentIndex(Format[1]);
+    Stream1C ->setChecked(StreamC[0]);
+    Stream2C ->setChecked(StreamC[1]);
+    Stream1  ->setCurrentIndex(Stream[0]);
+    Stream2  ->setCurrentIndex(Stream[1]);
+    Format1  ->setCurrentIndex(Format[0]);
+    Format2  ->setCurrentIndex(Format[1]);
     FilePath1->setText(GetFilePath(Paths[0][2]));
     FilePath2->setText(GetFilePath(Paths[1][2]));
-    SwapIntv->insertItem(0, SwapInterval); SwapIntv->setCurrentIndex(0);
-    TimeTagC->setChecked(OutTimeTag);
+    SwapIntv->insertItem(0,SwapInterval);SwapIntv->setCurrentIndex(0);
+    TimeTagC ->setChecked(OutTimeTag);
 
     UpdateEnable();
 }
 //---------------------------------------------------------------------------
 void OutputStrDialog::BtnOkClick()
 {
-    StreamC[0] = Stream1C->isChecked();
-    StreamC[1] = Stream2C->isChecked();
-    Stream[0] = Stream1->currentIndex();
-    Stream[1] = Stream2->currentIndex();
-    Format[0] = Format1->currentIndex();
-    Format[1] = Format2->currentIndex();
-    Paths [0][2] = SetFilePath(FilePath1->text());
-    Paths [1][2] = SetFilePath(FilePath2->text());
-    SwapInterval = SwapIntv->currentText();
-    OutTimeTag = TimeTagC->isChecked();
+    StreamC[0]  =Stream1C->isChecked();
+    StreamC[1]  =Stream2C->isChecked();
+    Stream[0]   =Stream1->currentIndex();
+    Stream[1]   =Stream2->currentIndex();
+    Format[0]   =Format1->currentIndex();
+    Format[1]   =Format2->currentIndex();
+    Paths [0][2]=SetFilePath(FilePath1->text());
+    Paths [1][2]=SetFilePath(FilePath2->text());
+    SwapInterval=SwapIntv->currentText();
+    OutTimeTag  =TimeTagC->isChecked();
 
     accept();
 }
 //---------------------------------------------------------------------------
 void OutputStrDialog::BtnFile1Click()
 {
-    FilePath1->setText(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, tr("Load..."), FilePath1->text())));
+    FilePath1->setText(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this,tr("Load..."),FilePath1->text())));
 }
 //---------------------------------------------------------------------------
 void OutputStrDialog::BtnFile2Click()
 {
-    FilePath2->setText(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, tr("Load..."), FilePath2->text())));
+    FilePath2->setText(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this,tr("Load..."),FilePath2->text())));
 }
 //---------------------------------------------------------------------------
 void OutputStrDialog::Stream1Change(int)
@@ -117,96 +117,95 @@
 void OutputStrDialog::BtnStr1Click()
 {
     switch (Stream1->currentIndex()) {
-    case 0: SerialOpt(0, 0); break;
-    case 1: TcpOpt(0, 1); break;
-    case 2: TcpOpt(0, 0); break;
-    case 3: TcpOpt(0, 2); break;
-    case 4: TcpOpt(0, 4); break;
-    }
+		case 0: SerialOpt(0,0); break;
+		case 1: TcpOpt(0,1); break;
+		case 2: TcpOpt(0,0); break;
+		case 3: TcpOpt(0,2); break;
+	}
 }
 //---------------------------------------------------------------------------
 void OutputStrDialog::BtnStr2Click()
 {
     switch (Stream2->currentIndex()) {
-    case 0: SerialOpt(1, 0); break;
-    case 1: TcpOpt(1, 1); break;
-    case 2: TcpOpt(1, 0); break;
-    case 3: TcpOpt(1, 2); break;
-    case 4: TcpOpt(0, 4); break;
-    }
+		case 0: SerialOpt(1,0); break;
+		case 1: TcpOpt(1,1); break;
+		case 2: TcpOpt(1,0); break;
+		case 3: TcpOpt(1,2); break;
+	}
 }
 //---------------------------------------------------------------------------
 QString OutputStrDialog::GetFilePath(const QString path)
 {
     QString file;
-
-    file = path.mid(0, path.indexOf("::"));
+    file=path.mid(0,path.indexOf("::"));
 
     return file;
 }
 //---------------------------------------------------------------------------
 QString OutputStrDialog::SetFilePath(const QString p)
 {
-    QString path = p;
+    QString path=p;
     QString str;
     bool okay;
 
-    if (TimeTagC->isChecked()) path += "::T";
-    str = SwapIntv->currentText();
+    if (TimeTagC->isChecked()) path+="::T";
+    str=SwapIntv->currentText();
     str.toDouble(&okay);
-    if (okay)
-        path += "::S=" + str;
+    if (okay) {
+        path+="::S="+str;
+    }
     return path;
 }
 //---------------------------------------------------------------------------
 void OutputStrDialog::SerialOpt(int index, int opt)
 {
-    serialOptDialog->Path = Paths[index][0];
-    serialOptDialog->Opt = opt;
+    serialOptDialog->Path=Paths[index][0];
+    serialOptDialog->Opt=opt;
 
     serialOptDialog->exec();
-    if (serialOptDialog->result() != QDialog::Accepted) return;
+    if (serialOptDialog->result()!=QDialog::Accepted) return;
 
-    Paths[index][0] = serialOptDialog->Path;
+    Paths[index][0]=serialOptDialog->Path;
 }
 //---------------------------------------------------------------------------
 void OutputStrDialog::TcpOpt(int index, int opt)
 {
-    tcpOptDialog->Path = Paths[index][1];
-    tcpOptDialog->Opt = opt;
-    for (int i = 0; i < 10; i++) {
-        tcpOptDialog->History[i] = History[i];
-        tcpOptDialog->MntpHist[i] = MntpHist[i];
+    tcpOptDialog->Path=Paths[index][1];
+    tcpOptDialog->Opt=opt;
+	for (int i=0;i<10;i++) {
+        tcpOptDialog->History[i]=History[i];
+        tcpOptDialog->MntpHist[i]=MntpHist[i];
 	}
 
     tcpOptDialog->exec();
-    if (tcpOptDialog->exec() != QDialog::Accepted) return;
+    if (tcpOptDialog->exec()!=QDialog::Accepted) return;
 
-    Paths[index][1] = tcpOptDialog->Path;
-    for (int i = 0; i < 10; i++) {
-        History[i] = tcpOptDialog->History[i];
-        MntpHist[i] = tcpOptDialog->MntpHist[i];
+    Paths[index][1]=tcpOptDialog->Path;
+	for (int i=0;i<10;i++) {
+        History[i]=tcpOptDialog->History[i];
+        MntpHist[i]=tcpOptDialog->MntpHist[i];
 	}
 }
 //---------------------------------------------------------------------------
 void OutputStrDialog::UpdateEnable(void)
 {
-    int ena = (Stream1C->isChecked() && (Stream1->currentIndex() == 5)) ||
-          (Stream2C->isChecked() && (Stream2->currentIndex() == 5));
+    int ena=(Stream1C->isChecked()&&(Stream1->currentIndex()==4))||
+            (Stream2C->isChecked()&&(Stream2->currentIndex()==4));
 
-    Stream1->setEnabled(Stream1C->isChecked());
-    Stream2->setEnabled(Stream2C->isChecked());
-    BtnStr1->setEnabled(Stream1C->isChecked() && Stream1->currentIndex() <= 4);
-    BtnStr2->setEnabled(Stream2C->isChecked() && Stream2->currentIndex() <= 4);
-    FilePath1->setEnabled(Stream1C->isChecked() && Stream1->currentIndex() == 5);
-    FilePath2->setEnabled(Stream2C->isChecked() && Stream2->currentIndex() == 5);
-    BtnFile1->setEnabled(Stream1C->isChecked() && Stream1->currentIndex() == 5);
-    BtnFile2->setEnabled(Stream2C->isChecked() && Stream2->currentIndex() == 5);
-    LabelF1->setEnabled(ena);
-    Label1->setEnabled(ena);
-    Label2->setEnabled(ena);
-    TimeTagC->setEnabled(ena);
-    SwapIntv->setEnabled(ena);
-    BtnKey->setEnabled(ena);
+    Stream1  ->setEnabled(Stream1C->isChecked());
+    Stream2  ->setEnabled(Stream2C->isChecked());
+    BtnStr1  ->setEnabled(Stream1C->isChecked()&&Stream1->currentIndex()<=3);
+    BtnStr2  ->setEnabled(Stream2C->isChecked()&&Stream2->currentIndex()<=3);
+    FilePath1->setEnabled(Stream1C->isChecked()&&Stream1->currentIndex()==4);
+    FilePath2->setEnabled(Stream2C->isChecked()&&Stream2->currentIndex()==4);
+    BtnFile1 ->setEnabled(Stream1C->isChecked()&&Stream1->currentIndex()==4);
+    BtnFile2 ->setEnabled(Stream2C->isChecked()&&Stream2->currentIndex()==4);
+    LabelF1  ->setEnabled(ena);
+    Label1   ->setEnabled(ena);
+    Label2   ->setEnabled(ena);
+    TimeTagC ->setEnabled(ena);
+    SwapIntv ->setEnabled(ena);
+    BtnKey   ->setEnabled(ena);
 }
 //---------------------------------------------------------------------------
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/outstrdlg.h RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/outstrdlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/outstrdlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/outstrdlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -40,9 +40,9 @@
     void UpdateEnable(void);
 
 public:
-    int StreamC[2], Stream[2], Format[2], OutTimeTag, OutAppend;
-    QString Paths[2][4], SwapInterval;
-    QString History[10], MntpHist[10];
+	int StreamC[2],Stream[2],Format[2],OutTimeTag,OutAppend;
+    QString Paths[2][4],SwapInterval;
+    QString History[10],MntpHist[10];
 
     explicit OutputStrDialog(QWidget* parent);
 };
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/outstrdlg.ui RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/outstrdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/outstrdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/outstrdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>581</width>
-    <height>287</height>
+    <width>595</width>
+    <height>233</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -22,12 +22,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -41,12 +35,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -55,6 +43,32 @@
      </property>
     </widget>
    </item>
+   <item row="0" column="6" colspan="2">
+    <widget class="QLabel" name="Label6">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>Option</string>
+     </property>
+    </widget>
+   </item>
+   <item row="0" column="9">
+    <widget class="QLabel" name="Label7">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>Format</string>
+     </property>
+    </widget>
+   </item>
    <item row="1" column="0" colspan="3">
     <widget class="QCheckBox" name="Stream1C">
      <property name="toolTip">
@@ -95,11 +109,6 @@
      </item>
      <item>
       <property name="text">
-       <string>NTRIP Caster</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
        <string>File</string>
       </property>
      </item>
@@ -193,11 +202,6 @@
      </item>
      <item>
       <property name="text">
-       <string>NTRIP Caster</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
        <string>File</string>
       </property>
      </item>
@@ -256,12 +260,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -533,44 +531,6 @@
      </property>
     </widget>
    </item>
-   <item row="0" column="7">
-    <widget class="QLabel" name="Label6">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="text">
-      <string>Option</string>
-     </property>
-    </widget>
-   </item>
-   <item row="0" column="8">
-    <widget class="QLabel" name="Label7">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="text">
-      <string>Format</string>
-     </property>
-    </widget>
-   </item>
   </layout>
  </widget>
  <resources/>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/rcvoptdlg.cpp RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/rcvoptdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/rcvoptdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/rcvoptdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -5,13 +5,13 @@
 #include <QShowEvent>
 
 //---------------------------------------------------------------------------
-RcvOptDialog::RcvOptDialog(QWidget *parent)
+RcvOptDialog::RcvOptDialog(QWidget* parent)
     : QDialog(parent)
 {
     setupUi(this);
 
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
 }
 //---------------------------------------------------------------------------
 void RcvOptDialog::showEvent(QShowEvent *event)
@@ -23,7 +23,7 @@
 //---------------------------------------------------------------------------
 void RcvOptDialog::BtnOkClick()
 {
-    Option = OptionE->text();
+    Option=OptionE->text();
 
     accept();
 }
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/rtknavi_qt.pro RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/rtknavi_qt.pro
--- RTKLIB-rtklib_2.4.3_orig/app/rtknavi_qt/rtknavi_qt.pro	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtknavi_qt/rtknavi_qt.pro	2019-08-19 02:04:50.000000000 +0300
@@ -4,15 +4,40 @@
 #
 #-------------------------------------------------
 
-QT       += widgets core gui serialport
+QT       += widgets core gui
 
-include(../app.pri)
+greaterThan(QT_MAJOR_VERSION, 4) {
+    QT += widgets serialport
+    DEFINES += QT5
+}
+
+lessThan(QT_MAJOR_VERSION, 5) {
+    LIBS += -lqextserialport-1.2
+    DEFINES += QEXTSERIALPORT
+}
+
+include(../../RTKLib.pri)
 
 TARGET = rtknavi_qt
 TEMPLATE = app
 
-INCLUDEPATH += ../../src/ ../appcmn_qt
+INCLUDEPATH += ../../src/ ../appcmn_qt ../rtkplot_qt
 
+linux{
+    RTKLIB =../../src/libRTKLib.a
+    LIBS += -lpng $${RTKLIB}
+}
+win32 {
+    CONFIG(debug) {
+        RTKLIB = ../../src/debug/libRTKLib.a
+    } else {
+        RTKLIB =../../src/release/libRTKLib.a
+    }
+
+    LIBS+= $${RTKLIB} -lWs2_32 -lwinmm
+}
+
+PRE_TARGETDEPS = $${RTKLIB}
 SOURCES += \
     ../appcmn_qt/aboutdlg.cpp \
     ../appcmn_qt/cmdoptdlg.cpp \
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot/plotcmn.cpp RTKLIB-rtklib_2.4.3_new/app/rtkplot/plotcmn.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot/plotcmn.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot/plotcmn.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -8,7 +8,7 @@
 
 //---------------------------------------------------------------------------
 extern "C" {
-int showmsg(const char *format,...) {return 0;}
+int showmsg(char *format,...) {return 0;}
 }
 //---------------------------------------------------------------------------
 const char *PTypes[]={
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/conndlg.cpp RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/conndlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/conndlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/conndlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -10,247 +10,245 @@
 
 //---------------------------------------------------------------------------
 
-ConnectDialog::ConnectDialog(QWidget *parent)
+ ConnectDialog::ConnectDialog(QWidget *parent)
     : QDialog(parent)
 {
     setupUi(this);
 
-    Stream1 = Stream2 = Format1 = Format2 = 0;
-    CmdEna1[0] = CmdEna1[1] = CmdEna2[0] = CmdEna2[1] = 0;
+	Stream1=Stream2=Format1=Format2=0;
+	CmdEna1[0]=CmdEna1[1]=CmdEna2[0]=CmdEna2[1]=0;
 
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnCmd1, SIGNAL(clicked(bool)), this, SLOT(BtnCmd1Click()));
-    connect(BtnCmd2, SIGNAL(clicked(bool)), this, SLOT(BtnCmd2Click()));
-    connect(BtnOpt1, SIGNAL(clicked(bool)), this, SLOT(BtnOpt1Click()));
-    connect(BtnOpt2, SIGNAL(clicked(bool)), this, SLOT(BtnOpt2Click()));
-    connect(SolFormat1, SIGNAL(currentIndexChanged(int)), this, SLOT(SolFormat1Change()));
-    connect(SolFormat2, SIGNAL(currentIndexChanged(int)), this, SLOT(SolFormat2Change()));
-    connect(SelStream1, SIGNAL(currentIndexChanged(int)), this, SLOT(SelStream1Change()));
-    connect(SelStream2, SIGNAL(currentIndexChanged(int)), this, SLOT(SelStream2Change()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnCmd1,SIGNAL(clicked(bool)),this,SLOT(BtnCmd1Click()));
+    connect(BtnCmd2,SIGNAL(clicked(bool)),this,SLOT(BtnCmd2Click()));
+    connect(BtnOpt1,SIGNAL(clicked(bool)),this,SLOT(BtnOpt1Click()));
+    connect(BtnOpt2,SIGNAL(clicked(bool)),this,SLOT(BtnOpt2Click()));
+    connect(SolFormat1,SIGNAL(currentIndexChanged(int)),this,SLOT(SolFormat1Change()));
+    connect(SolFormat2,SIGNAL(currentIndexChanged(int)),this,SLOT(SolFormat2Change()));
+    connect(SelStream1,SIGNAL(currentIndexChanged(int)),this,SLOT(SelStream1Change()));
+    connect(SelStream2,SIGNAL(currentIndexChanged(int)),this,SLOT(SelStream2Change()));
 }
 //---------------------------------------------------------------------------
-void ConnectDialog::showEvent(QShowEvent *event)
+void  ConnectDialog::showEvent(QShowEvent*event)
 {
-    int str[] = { STR_NONE, STR_SERIAL, STR_TCPCLI, STR_TCPSVR, STR_NTRIPCLI, STR_FILE };
+	int str[]={STR_NONE,STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPCLI,STR_FILE};
 
     if (event->spontaneous()) return;
 
-    for (int i = 0; i < 6; i++) {
-        if (str[i] == Stream1) SelStream1->setCurrentIndex(i);
-        if (str[i] == Stream2) SelStream2->setCurrentIndex(i);
+	for (int i=0;i<6;i++) {
+        if (str[i]==Stream1) SelStream1->setCurrentIndex(i);
+        if (str[i]==Stream2) SelStream2->setCurrentIndex(i);
 	}
     SolFormat1->setCurrentIndex(Format1);
     SolFormat2->setCurrentIndex(Format2);
     TimeFormS->setCurrentIndex(TimeForm);
-    DegFormS->setCurrentIndex(DegForm);
+    DegFormS ->setCurrentIndex(DegForm);
     FieldSepS->setText(FieldSep);
-    TimeOutTimeE->setValue(TimeOutTime);
-    ReConnTimeE->setValue(ReConnTime);
+    TimeOutTimeE->setText(QString::number(TimeOutTime));
+    ReConnTimeE ->setText(QString::number(ReConnTime));
 
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void ConnectDialog::BtnOkClick()
+void  ConnectDialog::BtnOkClick()
 {
-    int str[] = { STR_NONE, STR_SERIAL, STR_TCPCLI, STR_TCPSVR, STR_NTRIPCLI, STR_FILE };
+	int str[]={STR_NONE,STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPCLI,STR_FILE};
 
-    Stream1 = str[SelStream1->currentIndex()];
-    Stream2 = str[SelStream2->currentIndex()];
-    Format1 = SolFormat1->currentIndex();
-    Format2 = SolFormat2->currentIndex();
-    TimeForm = TimeFormS->currentIndex();
-    DegForm = DegFormS->currentIndex();
-    FieldSep = FieldSepS->text();
-    TimeOutTime = TimeOutTimeE->value();
-    ReConnTime = ReConnTimeE->value();
+    Stream1=str[SelStream1->currentIndex()];
+    Stream2=str[SelStream2->currentIndex()];
+    Format1=SolFormat1->currentIndex();
+    Format2=SolFormat2->currentIndex();
+    TimeForm=TimeFormS->currentIndex();
+    DegForm =DegFormS ->currentIndex();
+    FieldSep=FieldSepS->text();
+    TimeOutTime=TimeOutTimeE->text().toInt();
+    ReConnTime =ReConnTimeE ->text().toInt();
 
     accept();
 }
 //---------------------------------------------------------------------------
-void ConnectDialog::BtnOpt1Click()
+void  ConnectDialog::BtnOpt1Click()
 {
     switch (SelStream1->currentIndex()) {
-        case 1: SerialOpt1(0); break;
-        case 2: TcpOpt1(1);   break;
-        case 3: TcpOpt1(0);   break;
-        case 4: TcpOpt1(3);   break;
-        case 5: FileOpt1(0);   break;
+		case 1: SerialOpt1(0); break;
+		case 2: TcpOpt1 (1);   break;
+		case 3: TcpOpt1 (0);   break;
+		case 4: TcpOpt1 (3);   break;
+		case 5: FileOpt1(0);   break;
 	}
 }
 //---------------------------------------------------------------------------
-void ConnectDialog::BtnOpt2Click()
+void  ConnectDialog::BtnOpt2Click()
 {
     switch (SelStream2->currentIndex()) {
-        case 1: SerialOpt2(0); break;
-        case 2: TcpOpt2(1);   break;
-        case 3: TcpOpt2(0);   break;
-        case 4: TcpOpt2(3);   break;
-        case 5: FileOpt2(0);   break;
+		case 1: SerialOpt2(0); break;
+		case 2: TcpOpt2 (1);   break;
+		case 3: TcpOpt2 (0);   break;
+		case 4: TcpOpt2 (3);   break;
+		case 5: FileOpt2(0);   break;
 	}
 }
 //---------------------------------------------------------------------------
-void ConnectDialog::BtnCmd1Click()
+void  ConnectDialog::BtnCmd1Click()
 {
     CmdOptDialog dialog(this);
-
-    dialog.Cmds  [0] = Cmds1  [0];
-    dialog.Cmds  [1] = Cmds1  [1];
-    dialog.CmdEna[0] = CmdEna1[0];
-    dialog.CmdEna[1] = CmdEna1[1];
+    dialog.Cmds  [0]=Cmds1  [0];
+    dialog.Cmds  [1]=Cmds1  [1];
+    dialog.CmdEna[0]=CmdEna1[0];
+    dialog.CmdEna[1]=CmdEna1[1];
     dialog.exec();
 
-    if (dialog.result() != QDialog::Accepted) return;
+    if (dialog.result()!=QDialog::Accepted) return;
 
-    Cmds1  [0] = dialog.Cmds  [0];
-    Cmds1  [1] = dialog.Cmds  [1];
-    CmdEna1[0] = dialog.CmdEna[0];
-    CmdEna1[1] = dialog.CmdEna[1];
+    Cmds1  [0]=dialog.Cmds  [0];
+    Cmds1  [1]=dialog.Cmds  [1];
+    CmdEna1[0]=dialog.CmdEna[0];
+    CmdEna1[1]=dialog.CmdEna[1];
 }
 //---------------------------------------------------------------------------
-void ConnectDialog::BtnCmd2Click()
+void  ConnectDialog::BtnCmd2Click()
 {
     CmdOptDialog dialog(this);
-
-    dialog.Cmds  [0] = Cmds2  [0];
-    dialog.Cmds  [1] = Cmds2  [1];
-    dialog.CmdEna[0] = CmdEna2[0];
-    dialog.CmdEna[1] = CmdEna2[1];
+    dialog.Cmds  [0]=Cmds2  [0];
+    dialog.Cmds  [1]=Cmds2  [1];
+    dialog.CmdEna[0]=CmdEna2[0];
+    dialog.CmdEna[1]=CmdEna2[1];
     dialog.exec();
 
-    if (dialog.result() != QDialog::Accepted) return;
+    if (dialog.result()!=QDialog::Accepted) return;
 
-    Cmds2  [0] = dialog.Cmds  [0];
-    Cmds2  [1] = dialog.Cmds  [1];
-    CmdEna2[0] = dialog.CmdEna[0];
-    CmdEna2[1] = dialog.CmdEna[1];
+    Cmds2  [0]=dialog.Cmds  [0];
+    Cmds2  [1]=dialog.Cmds  [1];
+    CmdEna2[0]=dialog.CmdEna[0];
+    CmdEna2[1]=dialog.CmdEna[1];
 }
 //---------------------------------------------------------------------------
-void ConnectDialog::SelStream1Change()
+void  ConnectDialog::SelStream1Change()
 {
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void ConnectDialog::SelStream2Change()
+void  ConnectDialog::SelStream2Change()
 {
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void ConnectDialog::SolFormat1Change()
+void  ConnectDialog::SolFormat1Change()
 {
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void ConnectDialog::SolFormat2Change()
+void  ConnectDialog::SolFormat2Change()
 {
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void ConnectDialog::SerialOpt1(int opt)
+void  ConnectDialog::SerialOpt1(int opt)
 {
     SerialOptDialog dialog(this);
 
-    dialog.Path = Paths1[0];
-    dialog.Opt = opt;
+    dialog.Path=Paths1[0];
+    dialog.Opt=opt;
     dialog.exec();
 
-    if (dialog.result() != QDialog::Accepted) return;
+    if (dialog.result()!=QDialog::Accepted) return;
 
-    Paths1[0] = dialog.Path;
+    Paths1[0]=dialog.Path;
 }
 //---------------------------------------------------------------------------
-void ConnectDialog::SerialOpt2(int opt)
+void  ConnectDialog::SerialOpt2(int opt)
 {
     SerialOptDialog dialog(this);
 
-    dialog.Path = Paths2[0];
-    dialog.Opt = opt;
+    dialog.Path=Paths2[0];
+    dialog.Opt=opt;
     dialog.exec();
 
-    if (dialog.result() != QDialog::Accepted) return;
+    if (dialog.result()!=QDialog::Accepted) return;
 
-    Paths2[0] = dialog.Path;
+    Paths2[0]=dialog.Path;
 }
 //---------------------------------------------------------------------------
-void ConnectDialog::TcpOpt1(int opt)
+void  ConnectDialog::TcpOpt1(int opt)
 {
     TcpOptDialog dialog(this);
 
-    dialog.Path = Paths1[1];
-    dialog.Opt = opt;
-    for (int i = 0; i < MAXHIST; i++) dialog.History [i] = TcpHistory [i];
-    for (int i = 0; i < MAXHIST; i++) dialog.MntpHist[i] = TcpMntpHist[i];
+    dialog.Path=Paths1[1];
+    dialog.Opt=opt;
+    for (int i=0;i<MAXHIST;i++) dialog.History [i]=TcpHistory [i];
+    for (int i=0;i<MAXHIST;i++) dialog.MntpHist[i]=TcpMntpHist[i];
     dialog.exec();
 
-    if (dialog.result() != QDialog::Accepted) return;
+    if (dialog.result()!=QDialog::Accepted) return;
 
-    Paths1[1] = dialog.Path;
-    for (int i = 0; i < MAXHIST; i++) TcpHistory [i] = dialog.History [i];
-    for (int i = 0; i < MAXHIST; i++) TcpMntpHist[i] = dialog.MntpHist[i];
+    Paths1[1]=dialog.Path;
+    for (int i=0;i<MAXHIST;i++) TcpHistory [i]=dialog.History [i];
+    for (int i=0;i<MAXHIST;i++) TcpMntpHist[i]=dialog.MntpHist[i];
 }
 //---------------------------------------------------------------------------
-void ConnectDialog::TcpOpt2(int opt)
+void  ConnectDialog::TcpOpt2(int opt)
 {
     TcpOptDialog dialog(this);
 
-    dialog.Path = Paths2[1];
-    dialog.Opt = opt;
-    for (int i = 0; i < MAXHIST; i++) dialog.History [i] = TcpHistory [i];
-    for (int i = 0; i < MAXHIST; i++) dialog.MntpHist[i] = TcpMntpHist[i];
+    dialog.Path=Paths2[1];
+    dialog.Opt=opt;
+    for (int i=0;i<MAXHIST;i++) dialog.History [i]=TcpHistory [i];
+    for (int i=0;i<MAXHIST;i++) dialog.MntpHist[i]=TcpMntpHist[i];
     dialog.exec();
 
-    if (dialog.result() != QDialog::Accepted) return;
+    if (dialog.result()!=QDialog::Accepted) return;
 
-    Paths2[1] = dialog.Path;
-    for (int i = 0; i < MAXHIST; i++) TcpHistory [i] = dialog.History [i];
-    for (int i = 0; i < MAXHIST; i++) TcpMntpHist[i] = dialog.MntpHist[i];
+    Paths2[1]=dialog.Path;
+    for (int i=0;i<MAXHIST;i++) TcpHistory [i]=dialog.History [i];
+    for (int i=0;i<MAXHIST;i++) TcpMntpHist[i]=dialog.MntpHist[i];
 }
 //---------------------------------------------------------------------------
-void ConnectDialog::FileOpt1(int opt)
+void  ConnectDialog::FileOpt1(int opt)
 {
     FileOptDialog dialog(this);
 
-    dialog.Path = Paths1[2];
-    dialog.Opt = opt;
+    dialog.Path=Paths1[2];
+    dialog.Opt=opt;
     dialog.exec();
 
-    if (dialog.result() != QDialog::Accepted) return;
+    if (dialog.result()!=QDialog::Accepted) return;
 
-    Paths1[2] = dialog.Path;
+    Paths1[2]=dialog.Path;
 }
 //---------------------------------------------------------------------------
-void ConnectDialog::FileOpt2(int opt)
+void  ConnectDialog::FileOpt2(int opt)
 {
     FileOptDialog dialog(this);
 
-    dialog.Path = Paths2[2];
-    dialog.Opt = opt;
+    dialog.Path=Paths2[2];
+    dialog.Opt=opt;
     dialog.exec();
 
-    if (dialog.result() != QDialog::Accepted) return;
+    if (dialog.result()!=QDialog::Accepted) return;
 
-    Paths2[2] = dialog.Path;
+    Paths2[2]=dialog.Path;
 }
 //---------------------------------------------------------------------------
-void ConnectDialog::UpdateEnable(void)
+void  ConnectDialog::UpdateEnable(void)
 {
-    BtnOpt1->setEnabled(SelStream1->currentIndex() > 0);
-    BtnOpt2->setEnabled(SelStream2->currentIndex() > 0);
-    BtnCmd1->setEnabled(SelStream1->currentIndex() == 1);
-    BtnCmd2->setEnabled(SelStream2->currentIndex() == 1);
-    SolFormat1->setEnabled(SelStream1->currentIndex() > 0);
-    SolFormat2->setEnabled(SelStream2->currentIndex() > 0);
-    TimeFormS->setEnabled(SolFormat1->currentIndex() != 3 || SolFormat2->currentIndex() != 3);
-    DegFormS->setEnabled(SolFormat1->currentIndex() == 0 || SolFormat2->currentIndex() == 0);
-    FieldSepS->setEnabled(SolFormat1->currentIndex() != 3 || SolFormat2->currentIndex() != 3);
-    Label5->setEnabled(SolFormat1->currentIndex() != 3 || SolFormat2->currentIndex() != 3);
-    Label6->setEnabled(SolFormat1->currentIndex() == 0 || SolFormat2->currentIndex() == 0);
-    Label7->setEnabled(SolFormat1->currentIndex() != 3 || SolFormat2->currentIndex() != 3);
-    Label8->setEnabled((2 <= SelStream1->currentIndex() && SelStream1->currentIndex() <= 4) ||
-               (2 <= SelStream2->currentIndex() && SelStream2->currentIndex() <= 4));
-    TimeOutTimeE->setEnabled((2 <= SelStream1->currentIndex() && SelStream1->currentIndex() <= 4) ||
-                 (2 <= SelStream2->currentIndex() && SelStream2->currentIndex() <= 4));
-    ReConnTimeE->setEnabled((2 <= SelStream1->currentIndex() && SelStream1->currentIndex() <= 4) ||
-                (2 <= SelStream2->currentIndex() && SelStream2->currentIndex() <= 4));
+    BtnOpt1     ->setEnabled(SelStream1->currentIndex()>0);
+    BtnOpt2     ->setEnabled(SelStream2->currentIndex()>0);
+    BtnCmd1     ->setEnabled(SelStream1->currentIndex()==1);
+    BtnCmd2     ->setEnabled(SelStream2->currentIndex()==1);
+    SolFormat1  ->setEnabled(SelStream1->currentIndex()>0);
+    SolFormat2  ->setEnabled(SelStream2->currentIndex()>0);
+    TimeFormS   ->setEnabled(SolFormat1->currentIndex()!=3||SolFormat2->currentIndex()!=3);
+    DegFormS    ->setEnabled(SolFormat1->currentIndex()==0||SolFormat2->currentIndex()==0);
+    FieldSepS   ->setEnabled(SolFormat1->currentIndex()!=3||SolFormat2->currentIndex()!=3);
+    Label5      ->setEnabled(SolFormat1->currentIndex()!=3||SolFormat2->currentIndex()!=3);
+    Label6      ->setEnabled(SolFormat1->currentIndex()==0||SolFormat2->currentIndex()==0);
+    Label7      ->setEnabled(SolFormat1->currentIndex()!=3||SolFormat2->currentIndex()!=3);
+    Label8      ->setEnabled((2<=SelStream1->currentIndex()&&SelStream1->currentIndex()<=4)||
+                          (2<=SelStream2->currentIndex()&&SelStream2->currentIndex()<=4));
+    TimeOutTimeE->setEnabled((2<=SelStream1->currentIndex()&&SelStream1->currentIndex()<=4)||
+                          (2<=SelStream2->currentIndex()&&SelStream2->currentIndex()<=4));
+    ReConnTimeE ->setEnabled((2<=SelStream1->currentIndex()&&SelStream1->currentIndex()<=4)||
+                          (2<=SelStream2->currentIndex()&&SelStream2->currentIndex()<=4));
 }
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/conndlg.h RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/conndlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/conndlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/conndlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -40,11 +40,11 @@
     void UpdateEnable(void);
 
 public:
-    int Stream1, Stream2, Format1, Format2, CmdEna1[2], CmdEna2[2];
-    int TimeForm, DegForm, TimeOutTime, ReConnTime;
-    QString Path, Paths1[4], Paths2[4];
-    QString TcpHistory[MAXHIST], TcpMntpHist[MAXHIST];
-    QString Cmds1[2], Cmds2[2], FieldSep;
+	int Stream1,Stream2,Format1,Format2,CmdEna1[2],CmdEna2[2];
+	int TimeForm,DegForm,TimeOutTime,ReConnTime;
+    QString Path,Paths1[4],Paths2[4];
+    QString TcpHistory[MAXHIST],TcpMntpHist[MAXHIST];
+    QString Cmds1[2],Cmds2[2],FieldSep;
 
     explicit ConnectDialog(QWidget *parent=NULL);
 };
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/conndlg.ui RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/conndlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/conndlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/conndlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,7 +6,7 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>650</width>
+    <width>491</width>
     <height>229</height>
    </rect>
   </property>
@@ -17,8 +17,8 @@
    <string/>
   </property>
   <layout class="QGridLayout" name="gridLayout">
-   <item row="2" column="0">
-    <widget class="QLabel" name="Label10">
+   <item row="0" column="1">
+    <widget class="QLabel" name="Label1">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -26,48 +26,60 @@
       <string/>
      </property>
      <property name="text">
-      <string>(2)</string>
+      <string>Stream Type</string>
      </property>
     </widget>
    </item>
-   <item row="2" column="1" colspan="2">
-    <widget class="QComboBox" name="SelStream2">
+   <item row="0" column="3">
+    <widget class="QLabel" name="Label2">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <item>
-      <property name="text">
-       <string/>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>Serial</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>TCP Client</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>TCP Server</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>NTRIP Client</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>File</string>
-      </property>
-     </item>
+     <property name="text">
+      <string>Opt</string>
+     </property>
+    </widget>
+   </item>
+   <item row="0" column="4">
+    <widget class="QLabel" name="Label4">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>Cmd</string>
+     </property>
+    </widget>
+   </item>
+   <item row="0" column="5" colspan="3">
+    <widget class="QLabel" name="Label3">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>Solution Format</string>
+     </property>
+    </widget>
+   </item>
+   <item row="1" column="0">
+    <widget class="QLabel" name="Label9">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>(1)</string>
+     </property>
     </widget>
    </item>
    <item row="1" column="1" colspan="2">
@@ -110,8 +122,8 @@
      </item>
     </widget>
    </item>
-   <item row="1" column="4">
-    <widget class="QPushButton" name="BtnCmd1">
+   <item row="1" column="3">
+    <widget class="QPushButton" name="BtnOpt1">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -123,8 +135,8 @@
      </property>
     </widget>
    </item>
-   <item row="1" column="3">
-    <widget class="QPushButton" name="BtnOpt1">
+   <item row="1" column="4">
+    <widget class="QPushButton" name="BtnCmd1">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -171,93 +183,57 @@
      </item>
     </widget>
    </item>
-   <item row="0" column="1">
-    <widget class="QLabel" name="Label1">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="text">
-      <string>Stream Type</string>
-     </property>
-    </widget>
-   </item>
-   <item row="0" column="3">
-    <widget class="QLabel" name="Label2">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="text">
-      <string>Opt</string>
-     </property>
-    </widget>
-   </item>
-   <item row="0" column="4">
-    <widget class="QLabel" name="Label4">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="text">
-      <string>Cmd</string>
-     </property>
-    </widget>
-   </item>
-   <item row="0" column="5" colspan="3">
-    <widget class="QLabel" name="Label3">
+   <item row="2" column="0">
+    <widget class="QLabel" name="Label10">
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
      <property name="text">
-      <string>Solution Format</string>
+      <string>(2)</string>
      </property>
     </widget>
    </item>
-   <item row="1" column="0">
-    <widget class="QLabel" name="Label9">
+   <item row="2" column="1" colspan="2">
+    <widget class="QComboBox" name="SelStream2">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <property name="text">
-      <string>(1)</string>
-     </property>
+     <item>
+      <property name="text">
+       <string/>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>Serial</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>TCP Client</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>TCP Server</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>NTRIP Client</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>File</string>
+      </property>
+     </item>
     </widget>
    </item>
    <item row="2" column="3">
@@ -326,12 +302,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -345,12 +315,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -364,12 +328,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -441,7 +399,7 @@
      </property>
     </widget>
    </item>
-   <item row="6" column="0" colspan="5">
+   <item row="5" column="0" colspan="5">
     <widget class="QLabel" name="Label8">
      <property name="enabled">
       <bool>true</bool>
@@ -450,12 +408,12 @@
       <string/>
      </property>
      <property name="text">
-      <string>Timeout/Re-connect Intvl</string>
+      <string>Timeout/Re-connect Intvl (ms)</string>
      </property>
     </widget>
    </item>
-   <item row="7" column="2" colspan="4">
-    <widget class="QPushButton" name="BtnOk">
+   <item row="5" column="5" colspan="2">
+    <widget class="QLineEdit" name="TimeOutTimeE">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -463,18 +421,25 @@
       <string/>
      </property>
      <property name="text">
-      <string>&amp;OK</string>
+      <string>0</string>
      </property>
-     <property name="autoDefault">
+    </widget>
+   </item>
+   <item row="5" column="7">
+    <widget class="QLineEdit" name="ReConnTimeE">
+     <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="default">
-      <bool>true</bool>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>10000</string>
      </property>
     </widget>
    </item>
-   <item row="7" column="6" colspan="2">
-    <widget class="QPushButton" name="BtnCancel">
+   <item row="6" column="2" colspan="4">
+    <widget class="QPushButton" name="BtnOk">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -482,52 +447,31 @@
       <string/>
      </property>
      <property name="text">
-      <string>&amp;Cancel</string>
+      <string>&amp;OK</string>
      </property>
-    </widget>
-   </item>
-   <item row="6" column="5">
-    <widget class="QSpinBox" name="TimeOutTimeE">
-     <property name="suffix">
-      <string> ms</string>
+     <property name="autoDefault">
+      <bool>true</bool>
      </property>
-     <property name="maximum">
-      <number>1000000</number>
+     <property name="default">
+      <bool>true</bool>
      </property>
     </widget>
    </item>
-   <item row="6" column="7">
-    <widget class="QSpinBox" name="ReConnTimeE">
-     <property name="suffix">
-      <string> ms</string>
+   <item row="6" column="6" colspan="2">
+    <widget class="QPushButton" name="BtnCancel">
+     <property name="enabled">
+      <bool>true</bool>
      </property>
-     <property name="maximum">
-      <number>1000000</number>
+     <property name="toolTip">
+      <string/>
      </property>
-     <property name="value">
-      <number>10000</number>
+     <property name="text">
+      <string>&amp;Cancel</string>
      </property>
     </widget>
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>BtnOk</tabstop>
-  <tabstop>BtnCancel</tabstop>
-  <tabstop>SelStream1</tabstop>
-  <tabstop>BtnOpt1</tabstop>
-  <tabstop>BtnCmd1</tabstop>
-  <tabstop>SolFormat1</tabstop>
-  <tabstop>SelStream2</tabstop>
-  <tabstop>BtnOpt2</tabstop>
-  <tabstop>BtnCmd2</tabstop>
-  <tabstop>SolFormat2</tabstop>
-  <tabstop>TimeFormS</tabstop>
-  <tabstop>DegFormS</tabstop>
-  <tabstop>FieldSepS</tabstop>
-  <tabstop>TimeOutTimeE</tabstop>
-  <tabstop>ReConnTimeE</tabstop>
- </tabstops>
  <resources/>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/fileseldlg.cpp RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/fileseldlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/fileseldlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/fileseldlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -18,55 +18,54 @@
 {
     setupUi(this);
 
-    dirModel = new QFileSystemModel(this);
-    dirModel->setFilter(QDir::Dirs | QDir::NoDotAndDotDot);
+    dirModel=new QFileSystemModel(this);
+    dirModel->setFilter(QDir::Dirs|QDir::NoDotAndDotDot);
 
 #ifdef FLOATING_DIRSELECTOR
-    DirSelector = new QTreeView(0);
-    DirSelector->setWindowFlags(Qt::Window | Qt::X11BypassWindowManagerHint | Qt::FramelessWindowHint);
+    DirSelector= new QTreeView(0);
+    DirSelector->setWindowFlags(Qt::Window|Qt::X11BypassWindowManagerHint|Qt::FramelessWindowHint);
 #else
-    DirSelector = new QTreeView(this);
+    DirSelector= new QTreeView(this);
 #endif
     Panel2->layout()->addWidget(DirSelector);
     DirSelector->setModel(dirModel);
-    DirSelector->hideColumn(1); DirSelector->hideColumn(2); DirSelector->hideColumn(3); //only show names
+    DirSelector->hideColumn(1); DirSelector->hideColumn(2);DirSelector->hideColumn(3); //only show names
 
     fileModel = new QFileSystemModel(this);
-    fileModel->setFilter((fileModel->filter() & ~QDir::Dirs & ~QDir::AllDirs));
+    fileModel->setFilter((fileModel->filter()& ~QDir::Dirs & ~QDir::AllDirs));
     fileModel->setNameFilterDisables(false);
     FileList->setModel(fileModel);
 
-    connect(DriveSel, SIGNAL(currentIndexChanged(QString)), this, SLOT(DriveSelChanged()));
-    connect(DirSelector, SIGNAL(clicked(QModelIndex)), this, SLOT(DirSelChange(QModelIndex)));
-    connect(DirSelector, SIGNAL(doubleClicked(QModelIndex)), this, SLOT(DirSelSelected(QModelIndex)));
-    connect(BtnDirSel, SIGNAL(clicked(bool)), this, SLOT(BtnDirSelClick()));
-    connect(FileList, SIGNAL(clicked(QModelIndex)), this, SLOT(FileListClick(QModelIndex)));
-    connect(Filter, SIGNAL(currentIndexChanged(QString)), this, SLOT(FilterClick()));
+    connect(DriveSel,SIGNAL(currentIndexChanged(QString)),this,SLOT(DriveSelChanged()));
+    connect(DirSelector,SIGNAL(clicked(QModelIndex)),this,SLOT(DirSelChange(QModelIndex)));
+    connect(DirSelector,SIGNAL(doubleClicked(QModelIndex)),this,SLOT(DirSelSelected(QModelIndex)));
+    connect(BtnDirSel,SIGNAL(clicked(bool)),this,SLOT(BtnDirSelClick()));
+    connect(FileList,SIGNAL(clicked(QModelIndex)),this,SLOT(FileListClick(QModelIndex)));
+    connect(Filter,SIGNAL(currentIndexChanged(QString)),this,SLOT(FilterClick()));
+
 }
-//---------------------------------------------------------------------------
-FileSelDialog::~FileSelDialog()
-{
+FileSelDialog::~FileSelDialog() {
     delete DirSelector;
 }
+
 //---------------------------------------------------------------------------
-void FileSelDialog::showEvent(QShowEvent *event)
+void  FileSelDialog::showEvent(QShowEvent *event)
 {
     if (event->spontaneous()) return;
 
-    QFileInfoList drives = QDir::drives();
-    if (drives.size() > 1 && drives.at(0).filePath() != "/") {
+    QFileInfoList drives=QDir::drives();
+    if (drives.size()>1&&drives.at(0).filePath()!="/"){
         Panel1->setVisible(true);
         DriveSel->clear();
 
-        foreach(const QFileInfo &drive, drives) {
+        foreach (const QFileInfo & drive,drives) {
             DriveSel->addItem(drive.filePath());
         }
-    } else {
-        Panel1->setVisible(false); // do not show drive selection on unix
-    }
-    if (Dir == "") Dir = drives.at(0).filePath();
+    } else Panel1->setVisible(false); // do not show drive selection on unix
 
-    DriveSel->setCurrentText(Dir.mid(0, Dir.indexOf(":") + 2));
+    if (Dir=="") Dir=drives.at(0).filePath();
+
+    DriveSel->setCurrentText(Dir.mid(0,Dir.indexOf(":")+2));
     dirModel->setRootPath(Dir);
     DirSelector->setVisible(false);
     DirSelected->setText(Dir);
@@ -74,7 +73,7 @@
     FileList->setRootIndex(fileModel->index(Dir));
 }
 //---------------------------------------------------------------------------
-void FileSelDialog::DriveSelChanged()
+void  FileSelDialog::DriveSelChanged()
 {
     DirSelector->setVisible(false);
 
@@ -82,52 +81,52 @@
     DirSelected->setText(DriveSel->currentText());
 }
 //---------------------------------------------------------------------------
-void FileSelDialog::BtnDirSelClick()
+void  FileSelDialog::BtnDirSelClick()
 {
 #ifdef FLOATING_DIRSELECTOR
-    QPoint pos = Panel5->mapToGlobal(BtnDirSel->pos());
-    pos.rx() += BtnDirSel->width() - DirSelector->width();
-    pos.ry() += BtnDirSel->height();
+    QPoint pos=Panel5->mapToGlobal(BtnDirSel->pos());
+    pos.rx()+=BtnDirSel->width()-DirSelector->width();
+    pos.ry()+=BtnDirSel->height();
 
     DirSelector->move(pos);
 #endif
     DirSelector->setVisible(!DirSelector->isVisible());
 }
 //---------------------------------------------------------------------------
-void FileSelDialog::DirSelChange(QModelIndex index)
+void  FileSelDialog::DirSelChange(QModelIndex index)
 {
     DirSelector->expand(index);
 
-    Dir = dirModel->filePath(index);
+    Dir=dirModel->filePath(index);
     DirSelected->setText(Dir);
     fileModel->setRootPath(Dir);
     FileList->setRootIndex(fileModel->index(Dir));
 }
 //---------------------------------------------------------------------------
-void FileSelDialog::DirSelSelected(QModelIndex)
+void  FileSelDialog::DirSelSelected(QModelIndex)
 {
     DirSelector->setVisible(false);
 }
 //---------------------------------------------------------------------------
-void FileSelDialog::FileListClick(QModelIndex index)
+void  FileSelDialog::FileListClick(QModelIndex index)
 {
     QStringList file;
-
     file.append(fileModel->filePath(index));
-    plot->ReadSol(file, 0);
+    plot->ReadSol(file,0);
 
     DirSelector->setVisible(false);
 }
 //---------------------------------------------------------------------------
-void FileSelDialog::FilterClick()
+void  FileSelDialog::FilterClick()
 {
-    QString filter = Filter->currentText();
+    QString filter=Filter->currentText();
 
     // only keep data between brackets
-    filter = filter.mid(filter.indexOf("(") + 1);
+    filter=filter.mid(filter.indexOf("(")+1);
     filter.remove(")");
 
     fileModel->setNameFilters(filter.split(" "));
     DirSelector->setVisible(false);
 }
 //---------------------------------------------------------------------------
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/fileseldlg.h RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/fileseldlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/fileseldlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/fileseldlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -16,7 +16,6 @@
 class FileSelDialog : public QDialog, private Ui::FileSelDialog
 {
     Q_OBJECT
-
 public slots:
     void FileListClick(QModelIndex);
     void DirSelChange(QModelIndex);
@@ -24,15 +23,13 @@
     void DriveSelChanged();
     void FilterClick();
     void BtnDirSelClick();
-
 protected:
     void showEvent(QShowEvent*);
     QTreeView *DirSelector;
-    QFileSystemModel *fileModel, *dirModel;
+    QFileSystemModel *fileModel,*dirModel;
 
 public:
     QString Dir;
-
     explicit FileSelDialog(QWidget *parent=0);
     ~FileSelDialog();
 };
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/fileseldlg.ui RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/fileseldlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/fileseldlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/fileseldlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>257</width>
-    <height>513</height>
+    <width>251</width>
+    <height>507</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -207,12 +207,6 @@
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>DriveSel</tabstop>
-  <tabstop>BtnDirSel</tabstop>
-  <tabstop>FileList</tabstop>
-  <tabstop>Filter</tabstop>
- </tabstops>
  <resources/>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/geview.cpp RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/geview.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/geview.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/geview.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -39,471 +39,461 @@
 
 //---------------------------------------------------------------------------
  GoogleEarthView::GoogleEarthView(QWidget *parent)
-     : QMainWindow(parent)
- {
-     setupUi(this);
- #ifdef QWEBKIT
-     WebBrowser = new QWebView(this);
-
-     setCentralWidget(WebBrowser);
- #endif
- #ifdef QWEBENGINE
-     WebBrowser = new QWebEngineView(this);
-     setCentralWidget(WebBrowser);
-     pageState = new GEPageState(this);
-
-     connect(WebBrowser, SIGNAL(loadFinished(bool)), this, SLOT(PageLoaded(bool)));
- #endif
+    : QMainWindow(parent)
+{
+    setupUi(this);
+#ifdef QWEBKIT
+    WebBrowser=new QWebView(this);
 
-     toolBar->addWidget(Panel8);
-     toolBar_2->addWidget(BtnFixCent);
-     toolBar_2->addWidget(BtnEnaAlt);
-     toolBar_2->addSeparator();
-     toolBar_2->addWidget(BtnGENorm);
-     toolBar_2->addWidget(BtnGETilt);
-     toolBar_2->addWidget(BtnExpand);
-     toolBar_2->addWidget(BtnShrink);
-     toolBar_2->addSeparator();
-     toolBar_2->addWidget(BtnRotL);
-     toolBar_2->addWidget(BtnRotR);
-     toolBar_2->addWidget(BtnHeading);
-     toolBar_2->addWidget(BtnClose);
+    setCentralWidget(WebBrowser);
+#endif
+#ifdef QWEBENGINE
+    WebBrowser = new QWebEngineView(this);
+    setCentralWidget(WebBrowser);
+    pageState=new GEPageState(this);
 
-     State = 0;
-     Expand = Rotate = 0;
-     Lat = Lon = 0.0;
-     Range = 0.0;
-     Heading = 0.0;
-     loaded = false;
-     MarkVis[0] = MarkVis[1] = TrackVis[0] = TrackVis[1] = 0;
-     MarkPos[0][0] = MarkPos[0][1] = 0.0;
-     MarkPos[1][0] = MarkPos[1][1] = 0.0;
-     FixCent = BtnFixCent->isChecked();
+    connect(WebBrowser,SIGNAL(loadFinished(bool)),this,SLOT(PageLoaded(bool)));
+#endif
 
-     connect(BtnClose, SIGNAL(clicked(bool)), this, SLOT(BtnCloseClick()));
-     connect(BtnEnaAlt, SIGNAL(clicked(bool)), this, SLOT(BtnEnaAltClick()));
-     connect(BtnFixCent, SIGNAL(clicked(bool)), this, SLOT(BtnFixCentClick()));
-     connect(BtnGENorm, SIGNAL(clicked(bool)), this, SLOT(BtnGENormClick()));
-     connect(BtnGETilt, SIGNAL(clicked(bool)), this, SLOT(BtnGETiltClick()));
-     connect(BtnHeading, SIGNAL(clicked(bool)), this, SLOT(BtnHeadingClick()));
-     connect(BtnRotL, SIGNAL(pressed()), this, SLOT(BtnRotLPressed()));
-     connect(BtnRotL, SIGNAL(released()), this, SLOT(BtnRotLReleased()));
-     connect(BtnRotR, SIGNAL(pressed()), this, SLOT(BtnRotRPressed()));
-     connect(BtnRotR, SIGNAL(released()), this, SLOT(BtnRotRReleased()));
-     connect(BtnShrink, SIGNAL(pressed()), this, SLOT(BtnShrinkPressed()));
-     connect(BtnShrink, SIGNAL(released()), this, SLOT(BtnShrinkReleased()));
-     connect(&Timer1, SIGNAL(timeout()), this, SLOT(Timer1Timer()));
-     connect(&Timer2, SIGNAL(timeout()), this, SLOT(Timer2Timer()));
+    toolBar->addWidget(Panel8);
+    toolBar_2->addWidget(BtnFixCent);
+    toolBar_2->addWidget(BtnEnaAlt);
+    toolBar_2->addSeparator();
+    toolBar_2->addWidget(BtnGENorm);
+    toolBar_2->addWidget(BtnGETilt);
+    toolBar_2->addWidget(BtnExpand);
+    toolBar_2->addWidget(BtnShrink);
+    toolBar_2->addSeparator();
+    toolBar_2->addWidget(BtnRotL);
+    toolBar_2->addWidget(BtnRotR);
+    toolBar_2->addWidget(BtnHeading);
+    toolBar_2->addWidget(BtnClose);
 
-     Timer1.setInterval(1000); // 1s
+    State=0;
+    Expand=Rotate=0;
+    Lat=Lon=0.0;
+    Range=0.0;
+    Heading=0.0;
+    loaded=false;
+    MarkVis[0]=MarkVis[1]=TrackVis[0]=TrackVis[1]=0;
+    MarkPos[0][0]=MarkPos[0][1]=0.0;
+    MarkPos[1][0]=MarkPos[1][1]=0.0;
+    FixCent=BtnFixCent->isChecked();
 
-     setWindowTitle("Google Earth View");
+    connect(BtnClose,SIGNAL(clicked(bool)),this,SLOT(BtnCloseClick()));
+    connect(BtnEnaAlt,SIGNAL(clicked(bool)),this,SLOT(BtnEnaAltClick()));
+    connect(BtnFixCent,SIGNAL(clicked(bool)),this,SLOT(BtnFixCentClick()));
+    connect(BtnGENorm,SIGNAL(clicked(bool)),this,SLOT(BtnGENormClick()));
+    connect(BtnGETilt,SIGNAL(clicked(bool)),this,SLOT(BtnGETiltClick()));
+    connect(BtnHeading,SIGNAL(clicked(bool)),this,SLOT(BtnHeadingClick()));
+    connect(BtnRotL,SIGNAL(pressed()),this,SLOT(BtnRotLPressed()));
+    connect(BtnRotL,SIGNAL(released()),this,SLOT(BtnRotLReleased()));
+    connect(BtnRotR,SIGNAL(pressed()),this,SLOT(BtnRotRPressed()));
+    connect(BtnRotR,SIGNAL(released()),this,SLOT(BtnRotRReleased()));
+    connect(BtnShrink,SIGNAL(pressed()),this,SLOT(BtnShrinkPressed()));
+    connect(BtnShrink,SIGNAL(released()),this,SLOT(BtnShrinkReleased()));
+    connect(&Timer1,SIGNAL(timeout()),this,SLOT(Timer1Timer()));
+    connect(&Timer2,SIGNAL(timeout()),this,SLOT(Timer2Timer()));
 
-     QTimer::singleShot(0, this, SLOT(FormCreate()));
- }
+    QTimer::singleShot(0,this,SLOT(FormCreate()));
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::FormCreate()
- {
-     QString dir;
-
-     dir = qApp->applicationDirPath(); // exe directory
-     dir = dir + "/" + RTKPLOT_GE_FILE;
- #ifdef QWEBKIT
-     WebBrowser->load(QUrl::fromLocalFile(dir));
-     WebBrowser->show();
-     loaded = true;
-     Clear();
- #endif
- #ifdef QWEBENGINE
-     WebBrowser->load(QUrl::fromLocalFile(dir));
-     QWebChannel *channel = new QWebChannel(this);
-     channel->registerObject(QStringLiteral("state"), pageState);
+void  GoogleEarthView::FormCreate()
+{
+    QString dir;
+    
+    dir=qApp->applicationDirPath(); // exe directory
+    dir=dir+"/"+RTKPLOT_GE_FILE;
+#ifdef QWEBKIT
+    WebBrowser->load(QUrl::fromLocalFile(dir));
+    WebBrowser->show();
+    loaded=true;
+    Clear();
+#endif
+#ifdef QWEBENGINE
+    WebBrowser->load(QUrl::fromLocalFile(dir));
+    QWebChannel *channel=new QWebChannel(this);
+    channel->registerObject(QStringLiteral("state"),pageState);
 
-     WebBrowser->page()->setWebChannel(channel);
+    WebBrowser->page()->setWebChannel(channel);
 
-     WebBrowser->show();
- #endif
+    WebBrowser->show();
+#endif
 
-     Timer1.start();
- }
+    Timer1.start();
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::PageLoaded(bool ok)
- {
-     if (!ok) return;
+void GoogleEarthView::PageLoaded(bool ok)
+{
+    if (!ok) return;
 
-     loaded = true;
- #ifdef QWEBENGINE
-     QFile webchannel(":/html/qwebchannel.js");
-     webchannel.open(QIODevice::ReadOnly);
-     WebBrowser->page()->runJavaScript(webchannel.readAll());
-     WebBrowser->page()->runJavaScript("new QWebChannel(qt.webChannelTransport,function(channel) {channel.objects.state.text=document.getElementById('state').value;" \
-                       "channel.objects.state.view=document.getElementById('view').value;});");
- #endif
-     Clear();
- }
+    loaded=true;
+#ifdef QWEBENGINE
+    QFile webchannel(":/html/qwebchannel.js");
+    webchannel.open(QIODevice::ReadOnly);
+    WebBrowser->page()->runJavaScript(webchannel.readAll());
+    WebBrowser->page()->runJavaScript("new QWebChannel(qt.webChannelTransport,function(channel) {channel.objects.state.text=document.getElementById('state').value;" \
+                                      "channel.objects.state.view=document.getElementById('view').value;});");
+#endif
+    Clear();
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::Timer1Timer()
- {
-     if (!GetState()) return;
+void  GoogleEarthView::Timer1Timer()
+{
+    if (!GetState()) return;
 
-     State = 1;
-     UpdateOpts();
-     SetView(Lat, Lon, Range, Heading);
-     Timer1.stop();
-     plot->Refresh_GEView();
- }
+    State=1;
+    SetView(Lat,Lon,Range,Heading);
+    Timer1.stop();
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::BtnCloseClick()
- {
-     close();
- }
+void  GoogleEarthView::BtnCloseClick()
+{
+    close();
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::BtnOpt1Click()
- {
-     UpdateOpts();
- }
+void  GoogleEarthView::BtnOpt1Click()
+{
+    UpdateOpts();
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::BtnHeadingClick()
- {
-     if (!BtnHeading->isChecked()) SetHeading(0.0);
-     UpdateEnable();
- }
+void  GoogleEarthView::BtnHeadingClick()
+{
+    if (!BtnHeading->isChecked()) SetHeading(0.0);
+    UpdateEnable();
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::BtnFixCentClick()
- {
-     FixCent = BtnFixCent->isChecked();
-     if (FixCent) SetCent(Lat, Lon);
- }
+void  GoogleEarthView::BtnFixCentClick()
+{
+    FixCent=BtnFixCent->isChecked();
+    if (FixCent) SetCent(Lat,Lon);
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::BtnEnaAltClick()
- {
-     UpdateOpts();
-     plot->Refresh_GEView();
- }
+void  GoogleEarthView::BtnEnaAltClick()
+{
+    UpdateOpts();
+    plot->Refresh_GEView();
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::BtnGENormClick()
- {
-     ExecFunc("SetTilt(0.0)");
- }
+void  GoogleEarthView::BtnGENormClick()
+{
+    ExecFunc("SetTilt(0.0)");
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::BtnGETiltClick()
- {
-     ExecFunc(QString("SetTilt(%1)").arg(TILT_ANGLE, 0, 'f', 1));
- }
+void  GoogleEarthView::BtnGETiltClick()
+{
+    ExecFunc(QString("SetTilt(%1)").arg(TILT_ANGLE,0,'f',1));
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::BtnShrinkPressed()
- {
-     Timer2.start();
-     Expand = 1;
- }
+void  GoogleEarthView::BtnShrinkPressed()
+{
+    Timer2.start();
+    Expand=1;
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::BtnShrinkReleased()
- {
-     Expand = 0;
-     Timer2.stop();
-     ExecFunc("UpdateState()");
- }
+void  GoogleEarthView::BtnShrinkReleased()
+{
+    Expand=0;
+    Timer2.stop();
+    ExecFunc("UpdateState()");
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::BtnRotLPressed()
- {
-     Timer2.start();
-     Rotate = 1;
- }
+void  GoogleEarthView::BtnRotLPressed()
+{
+    Timer2.start();
+    Rotate=1;
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::BtnRotLReleased()
- {
-     Rotate = 0;
-     Timer2.stop();
-     ExecFunc("UpdateState()");
- }
+void  GoogleEarthView::BtnRotLReleased()
+{
+    Rotate=0;
+    Timer2.stop();
+    ExecFunc("UpdateState()");
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::BtnRotRPressed()
- {
-     Timer2.start();
-     Rotate = -1;
- }
+void  GoogleEarthView::BtnRotRPressed()
+{
+    Timer2.start();
+    Rotate=-1;
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::BtnRotRReleased()
- {
-     Rotate = 0;
-     Timer2.stop();
-     ExecFunc("UpdateState()");
- }
+void  GoogleEarthView::BtnRotRReleased()
+{
+    Rotate=0;
+    Timer2.stop();
+    ExecFunc("UpdateState()");
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::BtnOptClick()
- {
-     Panel8->setVisible(!Panel8->isVisible());
- }
+void GoogleEarthView::BtnOptClick()
+{
+    Panel8->setVisible(!Panel8->isVisible());
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::resizeEvent(QResizeEvent *)
- {
-     if (FixCent) SetCent(Lat, Lon);
- }
+void GoogleEarthView::resizeEvent(QResizeEvent * )
+{
+    if (FixCent) SetCent(Lat,Lon);
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::Timer2Timer()
- {
-     if (Expand) {
-         if (Expand > 0) Range = MIN(MAX_RANGE, Range * 1.05);
-         else Range = MAX(MIN_RANGE, Range / 1.05);
-         SetRange(Range);
-     }
-     if (Rotate) {
-         if (Rotate > 0) Heading += 3.0;
-         else Heading -= 3.0;
-         if (Heading > 180.0) Heading -= 360.0;
-         else if (Heading < -180.0) Heading += 360.0;
-         SetHeading(Heading);
-     }
- }
+void  GoogleEarthView::Timer2Timer()
+{
+    if (Expand) {
+        if (Expand>0) Range=MIN(MAX_RANGE,Range*1.05);
+        else          Range=MAX(MIN_RANGE,Range/1.05);
+        SetRange(Range);
+    }
+    if (Rotate) {
+        if (Rotate>0) Heading+=3.0;
+        else          Heading-=3.0;
+        if      (Heading> 180.0) Heading-=360.0;
+        else if (Heading<-180.0) Heading+=360.0;
+        SetHeading(Heading);
+    }
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::Clear(void)
- {
-     MarkVis[0] = MarkVis[1] = TrackVis[0] = TrackVis[1] = 0;
-     MarkPos[0][0] = MarkPos[0][1] = 0.0;
-     MarkPos[1][0] = MarkPos[1][1] = 0.0;
-     ExecFunc("ClearTrack(1)");
-     ExecFunc("ClearTrack(2)");
-     ExecFunc("SetMark(1,0.0,0.0)");
-     ExecFunc("SetMark(2,0.0,0.0)");
- }
+void  GoogleEarthView::Clear(void)
+{
+    MarkVis[0]=MarkVis[1]=TrackVis[0]=TrackVis[1]=0;
+    MarkPos[0][0]=MarkPos[0][1]=0.0;
+    MarkPos[1][0]=MarkPos[1][1]=0.0;
+    ExecFunc("ClearTrack(1)");
+    ExecFunc("ClearTrack(2)");
+    ExecFunc("SetMark(1,0.0,0.0)");
+    ExecFunc("SetMark(2,0.0,0.0)");
+}
 // --------------------------------------------------------------------------
- void GoogleEarthView::SetView(double lat, double lon, double range,
-                   double heading)
- {
-     if (range <= 0.0) range = INIT_RANGE;
-     Lat = lat;
-     Lon = lon;
-     Range = range;
-     Heading = heading;
-     ExecFunc(QString("SetView(%1,%2,%3,%4)").arg(lat, 0, 'f', 9).arg(lon, 0, 'f', 9).arg(range, 0, 'f', 3).arg(heading, 0, 'f', 1));
- }
+void  GoogleEarthView::SetView(double lat, double lon, double range,
+    double heading)
+{
+    if (range<=0.0) range=INIT_RANGE;
+    Lat=lat;
+    Lon=lon;
+    Range=range;
+    Heading=heading;
+    ExecFunc(QString("SetView(%1,%2,%3,%4)").arg(lat,0,'f',9).arg(lon,0,'f',9).arg(range,0,'f',3).arg(heading,0,'f',1));
+}
 // --------------------------------------------------------------------------
- void GoogleEarthView::SetCent(double lat, double lon)
- {
-     Lat = lat;
-     Lon = lon;
-     if (FixCent) ExecFunc(QString("SetCent(%1,%2)").arg(lat, 0, 'f', 9).arg(lon, 0, 'f', 9));
- }
+void  GoogleEarthView::SetCent(double lat, double lon)
+{
+    Lat=lat;
+    Lon=lon;
+    if (FixCent) ExecFunc(QString("SetCent(%1,%2)").arg(lat,0,'f',9).arg(lon,0,'f',9));
+}
 // --------------------------------------------------------------------------
- void GoogleEarthView::SetRange(double range)
- {
-     if (range <= 0.0) range = INIT_RANGE;
-     Range = range;
-     ExecFunc(QString("SetRange(%1)").arg(range, 0, 'f', 3));
- }
+void  GoogleEarthView::SetRange(double range)
+{
+    if (range<=0.0) range=INIT_RANGE;
+    Range=range;
+    ExecFunc(QString("SetRange(%1)").arg(range,0,'f',3));
+}
 /// --------------------------------------------------------------------------
- void GoogleEarthView::SetHeading(double angle)
- {
-     Heading = angle;
-     ExecFunc(QString("SetHeading(%1)").arg(angle, 0, 'f', 2));
- }
+void  GoogleEarthView::SetHeading(double angle)
+{
+    Heading=angle;
+    ExecFunc(QString("SetHeading(%1)").arg(angle,0,'f',2));
+}
 // --------------------------------------------------------------------------
- void GoogleEarthView::SetMark(int index, const double *pos)
- {
-     if (index < 1 || 2 < index) return;
-     ExecFunc(QString("SetMark(%1,%2,%3,%4)").arg(index).arg(pos[0] * R2D, 0, 'f', 9)
-          .arg(pos[1] * R2D, 0, 'f', 9).arg(pos[2], 0, 'f', 3));
-     MarkPos[index - 1][0] = pos[0] * R2D;
-     MarkPos[index - 1][1] = pos[1] * R2D;
-     SetCent(Lat,Lon);
- }
+void  GoogleEarthView::SetMark(int index, const double *pos)
+{
+    if (index<1||2<index) return;
+    MarkPos[index-1][0]=pos[0]*R2D;
+    MarkPos[index-1][1]=pos[1]*R2D;
+    ExecFunc(QString("SetMark(%1,%2,%3,%4)").arg(index).arg(pos[0]*R2D,0,'f',9)
+             .arg(pos[1]*R2D,0,'f',9).arg(pos[2],0,'f',3));
+}
 // --------------------------------------------------------------------------
- void GoogleEarthView::ShowMark(int index)
- {
-     if (index < 1 || 2 < index) return;
-     ExecFunc(QString("ShowMark(%1)").arg(index));
-     MarkVis[index - 1] = 1;
-     UpdateEnable();
- }
+void  GoogleEarthView::ShowMark(int index)
+{
+    if (index<1||2<index) return;
+    ExecFunc(QString("ShowMark(%1)").arg(index));
+    MarkVis[index-1]=1;
+    UpdateEnable();
+}
 // --------------------------------------------------------------------------
- void GoogleEarthView::HideMark(int index)
- {
-     if (index < 1 || 2 < index) return;
-     ExecFunc(QString("HideMark(%1)").arg(index));
-     MarkVis[index - 1] = 0;
-     UpdateEnable();
- }
+void  GoogleEarthView::HideMark(int index)
+{
+    if (index<1||2<index) return;
+    ExecFunc(QString("HideMark(%1)").arg(index));
+    MarkVis[index-1]=0;
+    UpdateEnable();
+}
 // --------------------------------------------------------------------------
- void GoogleEarthView::ClearTrack(int index)
- {
-     if (index < 1 || 2 < index) return;
-     ExecFunc(QString("ClearTrack(%1)").arg(index));
-     TrackVis[index - 1] = 0;
-     UpdateEnable();
- }
+void  GoogleEarthView::ClearTrack(int index)
+{
+    if (index<1||2<index) return;
+    ExecFunc(QString("ClearTrack(%1)").arg(index));
+    TrackVis[index-1]=0;
+    UpdateEnable();
+}
 // --------------------------------------------------------------------------
- int GoogleEarthView::UpdateTrack(int index, solbuf_t *sol)
- {
-     sol_t *data;
-     double prev[3] = { 0 }, pos[3];
-     int i, intv;
-
-     if (index < 1 || 2 < index || !State || sol->n <= 0) return 0;
-
-     setCursor(Qt::WaitCursor);
-
-     ClearTrack(index);
-
-     intv = sol->n / MAXTRACKS + 1; // interval to reduce points
-
-     for (i = 0; (data = getsol(sol, i)) != NULL; i++) {
-         if (i % intv != 0) continue;
-         ecef2pos(data->rr, pos);
-         if (fabs(pos[0] - prev[0]) < 1E-8 && fabs(pos[1] - prev[1]) < 1E-8) continue;
-         prev[0] = pos[0];
-         prev[1] = pos[1];
-         ExecFunc(QString("AddTrack(%d,%.9f,%.9f)").arg(index).arg(pos[0] * R2D, 0, 'f', 9)
-              .arg(pos[1] * R2D, 0, 'f', 9));
-     }
-     setCursor(Qt::ArrowCursor);
-     UpdateEnable();
-     return 1;
- }
+int  GoogleEarthView::UpdateTrack(int index, solbuf_t *sol)
+{
+    sol_t *data;
+    double prev[3]={0},pos[3];
+    int i,intv;
+    
+    if (index<1||2<index||!State||sol->n<=0) return 0;
+    
+    setCursor(Qt::WaitCursor);
+    
+    ClearTrack(index);
+    
+    intv=sol->n/MAXTRACKS+1; // interval to reduce points
+    
+    for (i=0;(data=getsol(sol,i))!=NULL;i++) {
+        if (i%intv!=0) continue;
+        ecef2pos(data->rr,pos);
+        if (fabs(pos[0]-prev[0])<1E-8&&fabs(pos[1]-prev[1])<1E-8) continue;
+        prev[0]=pos[0];
+        prev[1]=pos[1];
+        ExecFunc(QString("AddTrack(%d,%.9f,%.9f)").arg(index).arg(pos[0]*R2D,0,'f',9)
+                 .arg(pos[1]*R2D,0,'f',9));
+    }
+    setCursor(Qt::ArrowCursor);
+    UpdateEnable();
+    return 1;
+}
 // --------------------------------------------------------------------------
- void GoogleEarthView::ShowTrack(int index)
- {
-     if (index < 1 || 2 < index) return;
-     ExecFunc(QString("ShowTrack(%1)").arg(index));
-     TrackVis[index - 1] = 1;
-     UpdateEnable();
- }
+void  GoogleEarthView::ShowTrack(int index)
+{
+    if (index<1||2<index) return;
+    ExecFunc(QString("ShowTrack(%1)").arg(index));
+    TrackVis[index-1]=1;
+    UpdateEnable();
+}
 // --------------------------------------------------------------------------
- void GoogleEarthView::HideTrack(int index)
- {
-     if (index < 1 || 2 < index) return;
-     ExecFunc(QString("HideTrack(%1)").arg(index));
-     TrackVis[index - 1] = 0;
-     UpdateEnable();
- }
+void  GoogleEarthView::HideTrack(int index)
+{
+    if (index<1||2<index) return;
+    ExecFunc(QString("HideTrack(%1)").arg(index));
+    TrackVis[index-1]=0;
+    UpdateEnable();
+}
 // ----------------------------------------------------------------------------
- void GoogleEarthView::UpdatePoint(void)
- {
-     double pos[3];
-     int i;
-
-     ExecFunc("ClearPoint()");
-
-     for (i = 0; i < plot->NWayPnt; i++) {
-         ecef2pos(plot->PntPos[i], pos);
-         ExecFunc(QString("AddPoint('%1',%2,%3,%4)").arg(plot->PntName[i])
-              .arg(pos[0] * R2D, 0, 'f', 9).arg(pos[1] * R2D, 0, 'f', 9).arg(pos[2], 0, 'f', 2));
-     }
- }
+void  GoogleEarthView::UpdatePoint(void)
+{
+    double pos[3];
+    int i;
+    
+    ExecFunc("ClearPoint()");
+    
+    for (i=0;i<plot->NWayPnt;i++) {
+        ecef2pos(plot->PntPos[i],pos);
+        ExecFunc(QString("AddPoint('%1',%2,%3,%4)").arg(plot->PntName[i])
+                 .arg(pos[0]*R2D,0,'f',9).arg(pos[1]*R2D,0,'f',9).arg(pos[2],0,'f',2));
+    }
+}
 // --------------------------------------------------------------------------
- void GoogleEarthView::ShowPoint(void)
- {
-     ExecFunc("ShowPoint()");
- }
+void  GoogleEarthView::ShowPoint(void)
+{
+    ExecFunc("ShowPoint()");
+}
 // --------------------------------------------------------------------------
- void GoogleEarthView::HidePoint(void)
- {
-     ExecFunc("HidePoint()");
- }
+void  GoogleEarthView::HidePoint(void)
+{
+    ExecFunc("HidePoint()");
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::SetOpts(const int *opts)
- {
-     QToolButton *btn[] = {
-         BtnOpt1, BtnOpt2,   BtnOpt3, BtnOpt4, BtnOpt5, BtnOpt6, BtnOpt7, BtnOpt8,
-         BtnOpt9, BtnEnaAlt, BtnHeading
-     };
-
-     for (int i = 0; i < 11; i++)
-         btn[i]->setChecked(opts[i]);
- }
+void  GoogleEarthView::SetOpts(const int *opts)
+{
+    QToolButton *btn[]={
+        BtnOpt1,BtnOpt2,BtnOpt3,BtnOpt4,BtnOpt5,BtnOpt6,BtnOpt7,BtnOpt8,
+        BtnOpt9,BtnEnaAlt,BtnHeading
+    };
+    for (int i=0;i<11;i++) {
+        btn[i]->setChecked(opts[i]);
+    }
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::GetOpts(int *opts)
- {
-     QToolButton *btn[] = {
-         BtnOpt1, BtnOpt2,   BtnOpt3, BtnOpt4, BtnOpt5, BtnOpt6, BtnOpt7, BtnOpt8,
-         BtnOpt9, BtnEnaAlt, BtnHeading
-     };
-
-     for (int i = 0; i < 11; i++)
-         opts[i] = btn[i]->isChecked();
- }
+void  GoogleEarthView::GetOpts(int *opts)
+{
+    QToolButton *btn[]={
+        BtnOpt1,BtnOpt2,BtnOpt3,BtnOpt4,BtnOpt5,BtnOpt6,BtnOpt7,BtnOpt8,
+        BtnOpt9,BtnEnaAlt,BtnHeading
+    };
+    for (int i=0;i<11;i++) {
+        opts[i]=btn[i]->isChecked();
+    }
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::UpdateOpts(void)
- {
-     QString f;
-     int opts[12];
-
-     GetOpts(opts);
-     ExecFunc(QString("SetOpts(%1,%2,%3,%4,%5,%6,%7,%8,%9,%10)").arg(opts[0])
-          .arg(opts[1]).arg(opts[2]).arg(opts[3]).arg(opts[4]).arg(opts[5]).arg(opts[6]).arg(opts[7]).arg(opts[8])
-          .arg(opts[9]));
- }
+void  GoogleEarthView::UpdateOpts(void)
+{
+    QString f;
+    int opts[12];
+    
+    GetOpts(opts);
+    ExecFunc(QString("SetOpts(%1,%2,%3,%4,%5,%6,%7,%8,%9,%10)").arg(opts[0])
+             .arg(opts[1]).arg(opts[2]).arg(opts[3]).arg(opts[4]).arg(opts[5]).arg(opts[6]).arg(opts[7]).arg(opts[8])
+             .arg(opts[9]));
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::UpdateEnable(void)
- {
-     BtnEnaAlt->setEnabled(MarkVis[0] || MarkVis[1]);
-     BtnRotR->setEnabled(!BtnHeading->isChecked());
-     BtnRotL->setEnabled(!BtnHeading->isChecked());
- }
+void  GoogleEarthView::UpdateEnable(void)
+{
+    BtnEnaAlt ->setEnabled(MarkVis[0]||MarkVis[1]);
+    BtnRotR   ->setEnabled(!BtnHeading->isChecked());
+    BtnRotL   ->setEnabled(!BtnHeading->isChecked());
+}
 //---------------------------------------------------------------------------
- int GoogleEarthView::GetState(void)
- {
- #ifdef QWEBKIT
-     QWebElement ele1, ele2;
-     int state;
+int  GoogleEarthView::GetState(void)
+{
+#ifdef QWEBKIT
+    QWebElement ele1,ele2;
+    int state;
 
-     if (!WebBrowser->page()) return 0;
-     if (!WebBrowser->page()->mainFrame()) return 0;
+    if (!WebBrowser->page()) return 0;
+    if (!WebBrowser->page()->mainFrame()) return 0;
 
-     QWebFrame *frame = WebBrowser->page()->mainFrame();
+    QWebFrame *frame=WebBrowser->page()->mainFrame();
 
-     ele1 = frame->findFirstElement("state");
-     ele2 = frame->findFirstElement("view");
+    ele1=frame->findFirstElement("state");
+    ele2=frame->findFirstElement("view");
 
-     if (ele1.isNull() || ele2.isNull()) return 0;
+    if (ele1.isNull()||ele2.isNull()) return 0;
 
-     if (!ele1.hasAttribute("value") ||
+    if (!ele1.hasAttribute("value")||
          ele2.hasAttribute("value")) return 0;
 
-     QStringList tokens = ele2.attribute("value").split(',');
+    QStringList tokens=ele2.attribute("value").split(',');
 
-     if (tokens.size() != 4) return 0;
+    if (tokens.size()!=4) return 0;
 
-     state = ele1.attribute("value").toInt();
+    state=ele1.attribute("value").toInt();
 
 
-     return state;
- #else
+    return state;    
+#else
  #ifdef QWEBENGINE
-     QStringList tokens = pageState->getView().split(',');
+    QStringList tokens=pageState->getView().split(',');
 
-     if (tokens.size() != 4) return 0;
+    if (tokens.size()!=4) return 0;
 
-     int state = pageState->getText().toInt();
+    int state=pageState->getText().toInt();
 
-     return state;
+    return state;
  #else
-     return 0;
- #endif
+    return 0;
  #endif
- }
+#endif
+}
 //---------------------------------------------------------------------------
- void GoogleEarthView::ExecFunc(const QString &func)
- {
- #ifdef QWEBKIT
-     if (!WebBrowser->page()) return;
-     if (!WebBrowser->page()->mainFrame()) return;
-     QWebFrame *frame = WebBrowser->page()->mainFrame();
+void  GoogleEarthView::ExecFunc(const QString &func)
+{
+#ifdef QWEBKIT
+    if (!WebBrowser->page()) return;
+    if (!WebBrowser->page()->mainFrame()) return;
+    QWebFrame *frame=WebBrowser->page()->mainFrame();
 
-     frame->evaluateJavaScript(func);
- #else
- #ifdef QWEBENGINE
-     if (!loaded) return;
+    frame->evaluateJavaScript(func);
+#else
+#ifdef QWEBENGINE
+   if (!loaded) return;
 
-     QWebEnginePage *page = WebBrowser->page();
-     if (page == NULL) return;
+   QWebEnginePage *page=WebBrowser->page();
+   if (page==NULL) return;
 
-     page->runJavaScript(func);
- #else
-     Q_UNUSED(func)
- #endif
- #endif
-#if 1 // for debug
-    trace(2, "GE: %s\n", qPrintable(func));
+   page->runJavaScript(func);
+#else
+   Q_UNUSED(func)
 #endif
- }
+#endif
+}
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/geview.h RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/geview.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/geview.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/geview.h	2019-08-19 02:04:50.000000000 +0300
@@ -20,14 +20,12 @@
     Q_PROPERTY(QString text MEMBER text NOTIFY textChanged)
     Q_PROPERTY(QString view MEMBER view NOTIFY viewChanged)
 public:
-    explicit GEPageState(QObject *parent = NULL): QObject(parent) {}
+    explicit GEPageState(QObject *parent=NULL): QObject(parent){}
     QString getText() {return text;}
     QString getView() {return view;}
-
 signals:
     void textChanged(const QString &text);
     void viewChanged(const QString &view);
-
 private:
     QString text;
     QString view;
@@ -65,10 +63,10 @@
     void resizeEvent(QResizeEvent * );
 
 private:
-    int State, Expand, Rotate, MarkVis[2], TrackVis[2];
-    double Lat, Lon, Range, Heading;
+    int State,Expand,Rotate,MarkVis[2],TrackVis[2];
+    double Lat,Lon,Range,Heading;
     double MarkPos[2][2];
-    QTimer Timer1, Timer2;
+    QTimer Timer1,Timer2;
     bool loaded;
 #ifdef QWEBKIT
     QWebView *WebBrowser;
@@ -77,32 +75,32 @@
     QWebEngineView *WebBrowser;
     GEPageState *pageState;
 #endif
-
-    void UpdateOpts(void);
+    void UpdateOpts (void);
     void UpdateEnable(void);
-    void ExecFunc(const QString &func);
+    void ExecFunc   (const QString &func);
+
 public:
     explicit GoogleEarthView(QWidget *parent=NULL);
 
-    int GetState(void);
-    void Init(void);
-    void Clear(void);
-    void SetView(double lat, double lon, double range, double heading);
-    void SetCent(double lat, double lon);
-    void SetRange(double range);
-    void SetHeading(double angle);
-    void SetMark(int index, const double *pos);
-    void ShowMark(int index);
-    void HideMark(int index);
-    void ClearTrack(int index);
-    int UpdateTrack(int index, solbuf_t *sol);
-    void ShowTrack(int index);
-    void HideTrack(int index);
+    int  GetState   (void);
+    void Init       (void);
+    void Clear      (void);
+    void SetView    (double lat, double lon, double range, double heading);
+    void SetCent    (double lat, double lon);
+    void SetRange   (double range);
+    void SetHeading (double angle);
+    void SetMark    (int index, const double *pos);
+    void ShowMark   (int index);
+    void HideMark   (int index);
+    void ClearTrack (int index);
+    int  UpdateTrack(int index, solbuf_t *sol);
+    void ShowTrack  (int index);
+    void HideTrack  (int index);
     void UpdatePoint(void);
-    void ShowPoint(void);
-    void HidePoint(void);
-    void SetOpts(const int *opts);
-    void GetOpts(int *opts);
+    void ShowPoint  (void);
+    void HidePoint  (void);
+    void SetOpts    (const int *opts);
+    void GetOpts    (int *opts);
 
     int FixCent;
 };
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/geview.ui RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/geview.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/geview.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/geview.ui	2019-08-19 02:04:50.000000000 +0300
@@ -599,28 +599,6 @@
    </attribute>
   </widget>
  </widget>
- <tabstops>
-  <tabstop>BtnOpt</tabstop>
-  <tabstop>BtnFixCent</tabstop>
-  <tabstop>BtnEnaAlt</tabstop>
-  <tabstop>BtnGENorm</tabstop>
-  <tabstop>BtnGETilt</tabstop>
-  <tabstop>BtnShrink</tabstop>
-  <tabstop>BtnExpand</tabstop>
-  <tabstop>BtnRotL</tabstop>
-  <tabstop>BtnHeading</tabstop>
-  <tabstop>BtnRotR</tabstop>
-  <tabstop>BtnClose</tabstop>
-  <tabstop>BtnOpt1</tabstop>
-  <tabstop>BtnOpt2</tabstop>
-  <tabstop>BtnOpt3</tabstop>
-  <tabstop>BtnOpt4</tabstop>
-  <tabstop>BtnOpt5</tabstop>
-  <tabstop>BtnOpt6</tabstop>
-  <tabstop>BtnOpt7</tabstop>
-  <tabstop>BtnOpt8</tabstop>
-  <tabstop>BtnOpt9</tabstop>
- </tabstops>
  <resources>
   <include location="../rtkconv_qt/rtkconv_qt.qrc"/>
   <include location="rtkplot_qt.qrc"/>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/.gitignore RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/.gitignore
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/.gitignore	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/.gitignore	2019-08-19 02:04:50.000000000 +0300
@@ -8,6 +8,3 @@
 rtkplot_qt
 rtkplot_qt.exe
 object_script*
-debug
-release
-*.stat
\ В конце файла нет новой строки
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/mapdlg.cpp RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/mapdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/mapdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/mapdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -9,17 +9,19 @@
 #include "mapdlg.h"
 
 extern Plot *plot;
+
+//---------------------------------------------------------------------------
 //---------------------------------------------------------------------------
 MapAreaDialog::MapAreaDialog(QWidget *parent)
     : QDialog(parent)
 {
     setupUi(this);
 
-    connect(BtnCenter, SIGNAL(clicked(bool)), this, SLOT(BtnCenterClick()));
-    connect(BtnClose, SIGNAL(clicked(bool)), this, SLOT(BtnCloseClick()));
-    connect(BtnSave, SIGNAL(clicked(bool)), this, SLOT(BtnSaveClick()));
-    connect(BtnUpdate, SIGNAL(clicked(bool)), this, SLOT(BtnUpdateClick()));
-    connect(ScaleEq, SIGNAL(clicked(bool)), this, SLOT(ScaleEqClick()));
+    connect(BtnCenter,SIGNAL(clicked(bool)),this,SLOT(BtnCenterClick()));
+    connect(BtnClose,SIGNAL(clicked(bool)),this,SLOT(BtnCloseClick()));
+    connect(BtnSave,SIGNAL(clicked(bool)),this,SLOT(BtnSaveClick()));
+    connect(BtnUpdate,SIGNAL(clicked(bool)),this,SLOT(BtnUpdateClick()));
+    connect(ScaleEq,SIGNAL(clicked(bool)),this,SLOT(ScaleEqClick()));
 }
 //---------------------------------------------------------------------------
 void MapAreaDialog::showEvent(QShowEvent *event)
@@ -34,35 +36,36 @@
 {
     QFile fp;
     QString data;
-    QString file = plot->MapImageFile;
+    QString file=plot->MapImageFile;
 
-    if (file == "") return;
+	if (file=="") return;
 
-    file = file + ".tag";
+	file=file+".tag";
 
-    if (QFile::exists(file))
-        if (QMessageBox::question(this, file, tr("File exists. Overwrite it?")) != QMessageBox::Yes) return;
+    if (QFile::exists(file)) {
+        if (QMessageBox::question(this,file,tr("File exists. Overwrite it?"))!=QMessageBox::Yes) return;
+	}
     if (!(fp.open(QIODevice::WriteOnly))) return;
 
-    data = QString("%% map image tag file: rtkplot %1 %2\n\n").arg(VER_RTKLIB).arg(PATCH_LEVEL);
-    data += QString("scalex  = %1\n").arg(plot->MapScaleX, 0, 'g', 6);
-    data += QString("scaley  = %1\n").arg(plot->MapScaleEq ? plot->MapScaleX : plot->MapScaleY, 0, 'g', 6);
-    data += QString("scaleeq = %1\n").arg(plot->MapScaleEq);
-    data += QString("lat     = %1\n").arg(plot->MapLat, 0, 'g', 9);
-    data += QString("lon     = %1\n").arg(plot->MapLon, 0, 'g', 9);
+    data=QString("%% map image tag file: rtkplot %1 %2\n\n").arg(VER_RTKLIB).arg(PATCH_LEVEL);
+    data+=QString("scalex  = %1\n").arg(plot->MapScaleX,0,'g',6);
+    data+=QString("scaley  = %1\n").arg(plot->MapScaleEq?plot->MapScaleX:plot->MapScaleY,0,'g',6);
+    data+=QString("scaleeq = %1\n").arg(plot->MapScaleEq);
+    data+=QString("lat     = %1\n").arg(plot->MapLat,0,'g',9);
+    data+=QString("lon     = %1\n").arg(plot->MapLon,0,'g',9);
 
     fp.write(data.toLatin1());
 };
 //---------------------------------------------------------------------------
 void MapAreaDialog::BtnCenterClick()
 {
-    double rr[3], pos[3];
+	double rr[3],pos[3];
 
     if (!plot->GetCenterPos(rr)) return;
 
-    ecef2pos(rr, pos);
-    Lat->setValue(pos[0] * R2D);
-    Lon->setValue(pos[1] * R2D);
+	ecef2pos(rr,pos);
+    Lat->setValue(pos[0]*R2D);
+    Lon->setValue(pos[1]*R2D);
 
 	UpdateMap();
 }
@@ -98,16 +101,16 @@
 //---------------------------------------------------------------------------
 void MapAreaDialog::UpdateMap(void)
 {
-    plot->MapScaleX = ScaleX->value();
-    plot->MapScaleY = ScaleY->value();
-    plot->MapLat = Lat->value();
-    plot->MapLon = Lon->value();
-    plot->MapScaleEq = ScaleEq->isChecked();
+    plot->MapScaleX=ScaleX->text().toDouble();
+    plot->MapScaleY=ScaleY->text().toDouble();
+    plot->MapLat=Lat->text().toDouble();
+    plot->MapLon=Lon->text().toDouble();
+    plot->MapScaleEq=ScaleEq->isChecked();
     plot->UpdatePlot();
 }
 //---------------------------------------------------------------------------
 void MapAreaDialog::UpdateEnable(void)
 {
-    ScaleY->setEnabled(!ScaleEq->isChecked());
+    ScaleY      ->setEnabled(!ScaleEq->isChecked());
 }
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/mapdlg.h RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/mapdlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/mapdlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/mapdlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -28,7 +28,7 @@
     void UpdateEnable(void);
 	
 public:
-    explicit MapAreaDialog(QWidget *parent = NULL);
+    explicit MapAreaDialog(QWidget *parent=NULL);
 
     void UpdateField(void);
 };
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/mapdlg.ui RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/mapdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/mapdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/mapdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>489</width>
-    <height>197</height>
+    <width>488</width>
+    <height>198</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -149,7 +149,7 @@
          <double>180.000000000000000</double>
         </property>
         <property name="singleStep">
-         <double>0.000001000000000</double>
+         <double>0.000005000000000</double>
         </property>
        </widget>
       </item>
@@ -171,7 +171,7 @@
          <double>90.000000000000000</double>
         </property>
         <property name="singleStep">
-         <double>0.000001000000000</double>
+         <double>0.000005000000000</double>
         </property>
        </widget>
       </item>
@@ -216,7 +216,7 @@
          <double>1.000000000000000</double>
         </property>
         <property name="singleStep">
-         <double>0.000100000000000</double>
+         <double>0.000500000000000</double>
         </property>
        </widget>
       </item>
@@ -235,7 +235,7 @@
          <double>8.000000000000000</double>
         </property>
         <property name="singleStep">
-         <double>0.000100000000000</double>
+         <double>0.000500000000000</double>
         </property>
        </widget>
       </item>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotcmn.cpp RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotcmn.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotcmn.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotcmn.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -11,22 +11,20 @@
 
 #include "rtklib.h"
 
-QString color2String(const QColor &c)
-{
+#define SQR(x)  ((x)*(x))
+
+QString color2String(const QColor &c){
     return QString("rgb(%1,%2,%3)").arg(c.red()).arg(c.green()).arg(c.blue());
 }
 
 //---------------------------------------------------------------------------
 extern "C" {
-int showmsg(const char *format, ...)
-{
-    Q_UNUSED(format); return 0;
-}
+int showmsg(char *format,...) {Q_UNUSED(format); return 0;}
 }
 //---------------------------------------------------------------------------
-const QString PTypes[] = {
-    QT_TR_NOOP("Gnd Trk"), QT_TR_NOOP("Position"), QT_TR_NOOP("Velocity"), QT_TR_NOOP("Accel"),	QT_TR_NOOP("NSat"),	 QT_TR_NOOP("Residuals"),
-    QT_TR_NOOP("Sat Vis"), QT_TR_NOOP("Skyplot"),  QT_TR_NOOP("DOP/NSat"), QT_TR_NOOP("SNR/MP/EL"), QT_TR_NOOP("SNR/MP-EL"), QT_TR_NOOP("MP-Skyplot"), ""
+const QString PTypes[]={
+    QT_TR_NOOP("Gnd Trk"),QT_TR_NOOP("Position"),QT_TR_NOOP("Velocity"),QT_TR_NOOP("Accel"),QT_TR_NOOP("NSat"),QT_TR_NOOP("Residuals"),
+    QT_TR_NOOP("Sat Vis"),QT_TR_NOOP("Skyplot"),QT_TR_NOOP("DOP/NSat"),QT_TR_NOOP("SNR/MP/EL"),QT_TR_NOOP("SNR/MP-EL"),QT_TR_NOOP("MP-Skyplot"),""
 };
 // show message in status-bar -----------------------------------------------
 void Plot::ShowMsg(const QString &msg)
@@ -43,45 +41,49 @@
 // get time span and time interval ------------------------------------------
 void Plot::TimeSpan(gtime_t *ts, gtime_t *te, double *tint)
 {
-    gtime_t t0 = { 0, 0 };
-
-    trace(3, "TimeSpan\n");
-
-    *ts = *te = t0; *tint = 0.0;
-    if (TimeEna[0]) *ts = TimeStart;
-    if (TimeEna[1]) *te = TimeEnd;
-    if (TimeEna[2]) *tint = TimeInt;
+    gtime_t t0={0,0};
+    
+    trace(3,"TimeSpan\n");
+    
+    *ts=*te=t0; *tint=0.0;
+    if (TimeEna[0]) *ts=TimeStart;
+    if (TimeEna[1]) *te=TimeEnd;
+    if (TimeEna[2]) *tint=TimeInt;
 }
 // get position regarding time ----------------------------------------------
 double Plot::TimePos(gtime_t time)
 {
     double tow;
     int week;
-
-    if (TimeLabel <= 1)             // www/ssss or gpst
-        tow = time2gpst(time, &week);
-    else if (TimeLabel == 2)        // utc
-        tow = time2gpst(gpst2utc(time), &week);
-    else                            // jst
-        tow = time2gpst(timeadd(gpst2utc(time), 9 * 3600.0), &week);
-    return tow + (week - Week) * 86400.0 * 7;
+    
+    if (TimeLabel<=1) { // www/ssss or gpst
+        tow=time2gpst(time,&week);
+    }
+    else if (TimeLabel==2) { // utc
+        tow=time2gpst(gpst2utc(time),&week);
+    }
+    else { // jst
+        tow=time2gpst(timeadd(gpst2utc(time),9*3600.0),&week);
+    }
+    return tow+(week-Week)*86400.0*7;
 }
 // show legand in status-bar ------------------------------------------------
 void Plot::ShowLegend(QString msgs[])
 {
-    QLabel *ql[] = { QL1, QL2, QL3, QL4, QL5, QL6, QL7 };
-    int i, sel = !BtnSol1->isChecked() && BtnSol2->isChecked() ? 1 : 0;
-
-    trace(3, "ShowLegend\n");
-
-    for (i = 0; i < 7; i++) {
-        if (!msgs || msgs[i] == NULL) {
+    QLabel *ql[]={QL1,QL2,QL3,QL4,QL5,QL6,QL7};
+    int i,sel=!BtnSol1->isChecked()&&BtnSol2->isChecked()?1:0;
+    
+    trace(3,"ShowLegend\n");
+    
+    for (i=0;i<7;i++) {
+        if (!msgs||msgs[i]==NULL) {
             ql[i]->setText("");
             ql[i]->adjustSize();
-        } else {
+        }
+        else {
             ql[i]->setText(msgs[i]);
             ql[i]->adjustSize();
-            ql[i]->setStyleSheet(QString("QLabel {color: %1;}").arg(color2String(MColor[sel][i + 1])));
+            ql[i]->setStyleSheet(QString("QLabel {color: %1;}").arg(color2String(MColor[sel][i+1])));
         }
     }
     Panel21->updateGeometry();
@@ -90,326 +92,332 @@
 int Plot::GetCurrentPos(double *rr)
 {
     sol_t *data;
-    int i, sel = !BtnSol1->isChecked() && BtnSol2->isChecked() ? 1 : 0;
-
-    trace(3, "GetCurrentPos\n");
-
-    if (PLOT_OBS <= PlotType && PlotType <= PLOT_DOP) return 0;
-    if (!(data = getsol(SolData + sel, SolIndex[sel]))) return 0;
+    int i,sel=!BtnSol1->isChecked()&&BtnSol2->isChecked()?1:0;
+    
+    trace(3,"GetCurrentPos\n");
+    
+    if (PLOT_OBS<=PlotType&&PlotType<=PLOT_DOP) return 0;
+    if (!(data=getsol(SolData+sel,SolIndex[sel]))) return 0;
     if (data->type) return 0;
 
-    for (i = 0; i < 3; i++) rr[i] = data->rr[i];
+    for (i=0;i<3;i++) rr[i]=data->rr[i];
 
     return 1;
 }
 // get center position of plot ----------------------------------------------
 int Plot::GetCenterPos(double *rr)
 {
-    double xc, yc, opos[3], pos[3], enu[3] = { 0 }, dr[3];
-    int i, j;
-
-    trace(3, "GetCenterPos\n");
-
-    if (PLOT_OBS <= PlotType && PlotType <= PLOT_DOP && PlotType != PLOT_TRK) return 0;
-    if (norm(OPos, 3) <= 0.0) return 0;
+    double xc,yc,opos[3],pos[3],enu[3]={0},dr[3];
+    int i,j;
+    
+    trace(3,"GetCenterPos\n");
+    
+    if (PLOT_OBS<=PlotType&&PlotType<=PLOT_DOP&&PlotType!=PLOT_TRK) return 0;
+    if (norm(OPos,3)<=0.0) return 0;
 
-    GraphT->GetCent(xc, yc);
-    ecef2pos(OPos, opos);
-    enu[0] = xc;
-    enu[1] = yc;
+    GraphT->GetCent(xc,yc);
+    ecef2pos(OPos,opos);
+    enu[0]=xc;
+    enu[1]=yc;
 
-    for (i = 0; i < 6; i++) {
-        enu2ecef(opos, enu, dr);
-        for (j = 0; j < 3; j++) rr[j] = OPos[j] + dr[j];
-        ecef2pos(rr, pos);
-        enu[2] -= pos[2];
+    for (i=0;i<6;i++) {
+        enu2ecef(opos,enu,dr);
+        for (j=0;j<3;j++) rr[j]=OPos[j]+dr[j];
+        ecef2pos(rr,pos);
+        enu[2]-=pos[2];
     }
 
     return 1;
 }
 // get position, velocity or accel from solutions ---------------------------
-TIMEPOS *Plot::SolToPos(solbuf_t *sol, int index, int qflag, int type)
+TIMEPOS * Plot::SolToPos(solbuf_t *sol, int index, int qflag, int type)
 {
-    TIMEPOS *pos, *vel, *acc;
-    gtime_t ts = { 0, 0 };
+    TIMEPOS *pos,*vel,*acc;
+    gtime_t ts={0,0};
     sol_t *data;
-    double tint, xyz[3], xyzs[4];
+    double tint,xyz[3],xyzs[4];
     int i;
-
-    trace(3, "SolToPos: n=%d\n", sol->n);
-
-    pos = new TIMEPOS(index < 0 ? sol->n : 3, 1);
-
-    if (index >= 0) {
-        if (type == 1 && index > sol->n - 2) index = sol->n - 2;
-        if (type == 2 && index > sol->n - 3) index = sol->n - 3;
+    
+    trace(3,"SolToPos: n=%d\n",sol->n);
+    
+    pos=new TIMEPOS(index<0?sol->n:3,1);
+    
+    if (index>=0) {
+        if (type==1&&index>sol->n-2) index=sol->n-2;
+        if (type==2&&index>sol->n-3) index=sol->n-3;
     }
 
-    tint = TimeEna[2] ? TimeInt : 0.0;
-
-    for (i = index < 0 ? 0 : index; (data = getsol(sol, i)) != NULL; i++) {
-        if (index < 0 && !screent(data->time, ts, ts, tint)) continue;
-        if (qflag && data->stat != qflag) continue;
-
-        PosToXyz(data->time, data->rr, data->type, xyz);
-        CovToXyz(data->rr, data->qr, data->type, xyzs);
-        if (xyz[2]<-RE_WGS84) continue;
+    tint=TimeEna[2]?TimeInt:0.0;
 
-        pos->t  [pos->n] = data->time;
-        pos->x  [pos->n] = xyz [0];
-        pos->y  [pos->n] = xyz [1];
-        pos->z  [pos->n] = xyz [2];
-        pos->xs [pos->n] = xyzs[0];     // var x^2
-        pos->ys [pos->n] = xyzs[1];     // var y^2
-        pos->zs [pos->n] = xyzs[2];     // var z^2
-        pos->xys[pos->n] = xyzs[3];     // cov xy
-        pos->q  [pos->n] = data->stat;
+    for (i=index<0?0:index;(data=getsol(sol,i))!=NULL;i++) {
+        
+        if (index<0&&!screent(data->time,ts,ts,tint)) continue;
+        if (qflag&&data->stat!=qflag) continue;
+        
+        PosToXyz(data->time,data->rr,data->type,xyz);
+        CovToXyz(data->rr,data->qr,data->type,xyzs);
+        
+        pos->t  [pos->n]=data->time;
+        pos->x  [pos->n]=xyz [0];
+        pos->y  [pos->n]=xyz [1];
+        pos->z  [pos->n]=xyz [2];
+        pos->xs [pos->n]=xyzs[0]; // var x^2
+        pos->ys [pos->n]=xyzs[1]; // var y^2
+        pos->zs [pos->n]=xyzs[2]; // var z^2
+        pos->xys[pos->n]=xyzs[3]; // cov xy
+        pos->q  [pos->n]=data->stat;
         pos->n++;
-
-        if (index >= 0 && pos->n >= 3) break;
+        
+        if (index>=0&&pos->n>=3) break;
     }
-    if (type != 1 && type != 2) return pos; // position
-
-    vel = pos->tdiff();
+    if (type!=1&&type!=2) return pos; // position
+    
+    vel=pos->tdiff();
     delete pos;
-    if (type == 1) return vel; // velocity
-
-    acc = vel->tdiff();
+    if (type==1) return vel; // velocity
+    
+    acc=vel->tdiff();
     delete vel;
     return acc; // acceleration
 }
 // get number of satellites, age and ratio from solutions -------------------
-TIMEPOS *Plot::SolToNsat(solbuf_t *sol, int index, int qflag)
+TIMEPOS * Plot::SolToNsat(solbuf_t *sol, int index, int qflag)
 {
     TIMEPOS *ns;
     sol_t *data;
     int i;
-
-    trace(3, "SolToNsat: n=%d\n", sol->n);
-
-    ns = new TIMEPOS(index < 0 ? sol->n : 3, 1);
-
-    for (i = index < 0 ? 0 : index; (data = getsol(sol, i)) != NULL; i++) {
-        if (qflag && data->stat != qflag) continue;
-
-        ns->t[ns->n] = data->time;
-        ns->x[ns->n] = data->ns;
-        ns->y[ns->n] = data->age;
-        ns->z[ns->n] = data->ratio;
-        ns->q[ns->n] = data->stat;
+    
+    trace(3,"SolToNsat: n=%d\n",sol->n);
+    
+    ns=new TIMEPOS(index<0?sol->n:3,1);
+    
+    for (i=index<0?0:index;(data=getsol(sol,i))!=NULL;i++) {
+        
+        if (qflag&&data->stat!=qflag) continue;
+        
+        ns->t[ns->n]=data->time;
+        ns->x[ns->n]=data->ns;
+        ns->y[ns->n]=data->age;
+        ns->z[ns->n]=data->ratio;
+        ns->q[ns->n]=data->stat;
         ns->n++;
-
-        if (index >= 0 && i >= 2) break;
+        
+        if (index>=0&&i>=2) break;
     }
     return ns;
 }
 // transform solution to xyz-terms ------------------------------------------
 void Plot::PosToXyz(gtime_t time, const double *rr, int type,
-            double *xyz)
+                                double *xyz)
 {
-    double opos[3], pos[3], r[3], enu[3];
+    double opos[3],pos[3],r[3],enu[3];
     int i;
-
-    trace(4, "PosToXyz:\n");
-
-    if (type == 0) { // xyz
-        for (i = 0; i < 3; i++) {
-            opos[i] = OPos[i];
-            if (time.time == 0.0 || OEpoch.time == 0.0) continue;
-            opos[i] += OVel[i] * timediff(time, OEpoch);
+    
+    trace(4,"SolToXyz:\n");
+    
+    if (type==0) { // xyz
+        for (i=0;i<3;i++) {
+            opos[i]=OPos[i];
+            if (time.time==0.0||OEpoch.time==0.0) continue;
+            opos[i]+=OVel[i]*timediff(time,OEpoch);
         }
-        for (i = 0; i < 3; i++) r[i] = rr[i] - opos[i];
-        ecef2pos(opos, pos);
-        ecef2enu(pos, r, enu);
-        xyz[0] = enu[0];
-        xyz[1] = enu[1];
-        xyz[2] = enu[2];
-    } else { // enu
-        xyz[0] = rr[0];
-        xyz[1] = rr[1];
-        xyz[2] = rr[2];
+        for (i=0;i<3;i++) r[i]=rr[i]-opos[i];
+        ecef2pos(opos,pos);
+        ecef2enu(pos,r,enu);
+        xyz[0]=enu[0];
+        xyz[1]=enu[1];
+        xyz[2]=enu[2];
+    }
+    else { // enu
+        xyz[0]=rr[0];
+        xyz[1]=rr[1];
+        xyz[2]=rr[2];
     }
 }
 // transform covariance to xyz-terms ----------------------------------------
 void Plot::CovToXyz(const double *rr, const float *qr, int type,
-            double *xyzs)
+                                double *xyzs)
 {
-    double pos[3], P[9], Q[9];
-
-    trace(4, "CovToXyz:\n");
-
-    if (type == 0) { // xyz
-        ecef2pos(rr, pos);
-        P[0] = qr[0];
-        P[4] = qr[1];
-        P[8] = qr[2];
-        P[1] = P[3] = qr[3];
-        P[5] = P[7] = qr[4];
-        P[2] = P[6] = qr[5];
-        covenu(pos, P, Q);
-        xyzs[0] = Q[0];
-        xyzs[1] = Q[4];
-        xyzs[2] = Q[8];
-        xyzs[3] = Q[1];
-    } else { // enu
-        xyzs[0] = qr[0];
-        xyzs[1] = qr[1];
-        xyzs[2] = qr[2];
-        xyzs[3] = qr[3];
+    double pos[3],P[9],Q[9];
+    
+    trace(4,"CovToXyz:\n");
+    
+    if (type==0) { // xyz
+        ecef2pos(rr,pos);
+        P[0]=qr[0];
+        P[4]=qr[1];
+        P[8]=qr[2];
+        P[1]=P[3]=qr[3];
+        P[5]=P[7]=qr[4];
+        P[2]=P[6]=qr[5];
+        covenu(pos,P,Q);
+        xyzs[0]=Q[0];
+        xyzs[1]=Q[4];
+        xyzs[2]=Q[8];
+        xyzs[3]=Q[1];
+    }
+    else { // enu
+        xyzs[0]=qr[0];
+        xyzs[1]=qr[1];
+        xyzs[2]=qr[2];
+        xyzs[3]=qr[3];
     }
 }
 // computes solution statistics ---------------------------------------------
 void Plot::CalcStats(const double *x, int n,
-             double ref, double &ave, double &std, double &rms)
+    double ref, double &ave, double &std, double &rms)
 {
-    double sum = 0.0, sumsq = 0.0;
+    double sum=0.0,sumsq=0.0;
     int i;
-
-    trace(3, "CalcStats: n=%d\n", n);
-
-    if (n <= 0) {
-        ave = std = rms = 0.0;
+    
+    trace(3,"CalcStats: n=%d\n",n);
+    
+    if (n<=0) {
+        ave=std=rms=0.0;
         return;
     }
-    ave = std = rms = 0.0;
-
-    for (i = 0; i < n; i++) {
-        sum += x[i];
-        sumsq += x[i] * x[i];
+    ave=std=rms=0.0;
+    
+    for (i=0;i<n;i++) {
+        sum  +=x[i];
+        sumsq+=x[i]*x[i];
     }
-    ave = sum / n;
-    std = n > 1 ? SQRT((sumsq - 2.0 * sum * ave + ave * ave * n) / (n - 1)) : 0.0;
-    rms = SQRT((sumsq - 2.0 * sum * ref + ref * ref * n) / n);
+    ave=sum/n;
+    std=n>1?SQRT((sumsq-2.0*sum*ave+ave*ave*n)/(n-1)):0.0;
+    rms=SQRT((sumsq-2.0*sum*ref+ref*ref*n)/n);
 }
 // get system color ---------------------------------------------------------
 QColor Plot::SysColor(int sat)
 {
-    switch (satsys(sat, NULL)) {
-    case SYS_GPS: return MColor[0][1];
-    case SYS_GLO: return MColor[0][2];
-    case SYS_GAL: return MColor[0][3];
-    case SYS_QZS: return MColor[0][4];
-    case SYS_CMP: return MColor[0][5];
-    case SYS_SBS: return MColor[0][6];
+    switch (satsys(sat,NULL)) {
+        case SYS_GPS: return MColor[0][1];
+        case SYS_GLO: return MColor[0][2];
+        case SYS_GAL: return MColor[0][3];
+        case SYS_QZS: return MColor[0][4];
+        case SYS_CMP: return MColor[0][5];
+        case SYS_SBS: return MColor[0][6];
     }
     return MColor[0][0];
 }
 // get observation data color -----------------------------------------------
 QColor Plot::ObsColor(const obsd_t *obs, double az, double el)
 {
-    QColor color = Qt::black;
+    QColor color=Qt::black;
     QString ObsType_Text;
     char code[16];
     int i;
+    
+    code[0]='\0';
 
-    code[0] = '\0';
-
-    trace(4, "ObsColor\n");
-
-    if (!SatSel[obs->sat - 1]) return Qt::black;
-
-    if (PlotType == PLOT_SNR || PlotType == PLOT_SNRE) {
-        ObsType_Text = ObsType2->currentText();
-        strcpy(code, qPrintable(ObsType_Text.mid(1)));
-    } else if (ObsType->currentIndex() != 0) {
-        ObsType_Text = ObsType->currentText();
-        strcpy(code, qPrintable(ObsType_Text.mid(1)));
+    trace(4,"ObsColor\n");
+    
+    if (!SatSel[obs->sat-1]) return Qt::black;
+    
+    if (PlotType==PLOT_SNR||PlotType==PLOT_SNRE) {
+        ObsType_Text=ObsType2->currentText();
+        strcpy(code,qPrintable(ObsType_Text.mid(1)));
+    }
+    else if (ObsType->currentIndex()!=0) {
+        ObsType_Text=ObsType->currentText();
+        strcpy(code,qPrintable(ObsType_Text.mid(1)));
     }
     if (SimObs) {
-        color = SysColor(obs->sat);
-    } else if (*code) {
-        for (i = 0; i < NFREQ + NEXOBS; i++) {
-            if (!strstr(code2obs(obs->code[i], NULL), code)) continue;
-            color = SnrColor(obs->SNR[i] * 0.25);
+        color=SysColor(obs->sat);
+    }
+    else if (*code) {
+        for (i=0;i<NFREQ+NEXOBS;i++) {
+            if (!strstr(code2obs(obs->code[i],NULL),code)) continue;
+            color=SnrColor(obs->SNR[i]*0.25);
             break;
         }
-        if (i >= NFREQ + NEXOBS) return Qt::black;
-    } else {
-        if (obs->L[0] != 0.0 && obs->L[1] != 0.0 && obs->L[2] != 0.0) color = MColor[0][4];
-        else if (obs->L[0] != 0.0 && obs->L[1] != 0.0) color = MColor[0][1];
-        else if (obs->L[0] != 0.0 && obs->L[2] != 0.0) color = MColor[0][5];
-        else if (obs->L[0] != 0.0) color = MColor[0][2];
-        else if (obs->P[1] != 0.0) color = MColor[0][3];
-        else if (obs->P[2] != 0.0) color = MColor[0][6];
+        if (i>=NFREQ+NEXOBS) return Qt::black;
+    }
+    else {
+        if      (obs->L[0]!=0.0&&obs->L[1]!=0.0&&obs->L[2]!=0.0) color=MColor[0][4];
+        else if (obs->L[0]!=0.0&&obs->L[1]!=0.0) color=MColor[0][1];
+        else if (obs->L[0]!=0.0&&obs->L[2]!=0.0) color=MColor[0][5];
+        else if (obs->L[0]!=0.0) color=MColor[0][2];
+        else if (obs->P[1]!=0.0) color=MColor[0][3];
+        else if (obs->P[2]!=0.0) color=MColor[0][6];
         else return Qt::black;
     }
-    if (el < ElMask * D2R || (ElMaskP && el < ElMaskData[static_cast<int>(az * R2D + 0.5)]))
-        return HideLowSat ? Qt::black : MColor[0][0];
+    if (el<ElMask*D2R||(ElMaskP&&el<ElMaskData[static_cast<int>(az*R2D+0.5)])) {
+        return HideLowSat?Qt::black:MColor[0][0];
+    }
     return color;
 }
 // get observation data color -----------------------------------------------
 QColor Plot::SnrColor(double snr)
 {
-    QColor c1, c2;
-    unsigned int r1, b1, g1;
+    QColor c1,c2;
+    unsigned int r1,b1,g1;
     double a;
     int i;
-
-    if (snr < 25.0) return MColor[0][7];
-    if (snr < 27.5) return MColor[0][5];
-    if (snr > 47.5) return MColor[0][1];
-    a = (snr - 27.5) / 5.0;
-    i = static_cast<int>(a);
-    a -= i;
-    c1 = MColor[0][4 - i];
-    c2 = MColor[0][5 - i];
-    r1 = static_cast<unsigned int>(a * c1.red() + (1.0 - a) * c2.red()) & 0xFF;
-    g1 = static_cast<unsigned int>(a * c1.green() + (1.0 - a) * c2.green()) & 0xFF;
-    b1 = static_cast<unsigned int>(a * c1.blue() + (1.0 - a) * c2.blue()) & 0xFF;
-
-    return QColor(r1, g1, b1);
+    
+    if (snr<25.0) return MColor[0][7];
+    if (snr<27.5) return MColor[0][5];
+    if (snr>47.5) return MColor[0][1];
+    a=(snr-27.5)/5.0;
+    i=static_cast<int>(a);
+    a-=i;
+    c1=MColor[0][4-i];
+    c2=MColor[0][5-i];
+    r1=static_cast<unsigned int>(a*c1.red()+(1.0-a)*c2.red())&0xFF;
+    g1=static_cast<unsigned int>(a*c1.green()+(1.0-a)*c2.green())&0xFF;
+    b1=static_cast<unsigned int>(a*c1.blue()+(1.0-a)*c2.blue())&0xFF;
+    
+    return QColor(r1,g1,b1);
 }
 // get mp color -------------------------------------------------------------
 QColor Plot::MpColor(double mp)
 {
     QColor colors[5];
-    QColor c1, c2;
-    unsigned int r1, b1, g1;
+    QColor c1,c2;
+    unsigned int r1,b1,g1;
     double a;
     int i;
+    
+    colors[4]=MColor[0][5]; /*      mp> 0.6 */
+    colors[3]=MColor[0][4]; /*  0.6>mp> 0.2 */
+    colors[2]=MColor[0][3]; /*  0.2>mp>-0.2 */
+    colors[1]=MColor[0][2]; /* -0.2>mp>-0.6 */
+    colors[0]=MColor[0][1]; /* -0.6>mp      */
+     
+    if (mp>= 0.6) return colors[4];
+    if (mp<=-0.6) return colors[0];
+    a=mp/0.4+0.6;
+    i=static_cast<int>(a);
+    a-=i;
+    c1=colors[i  ];
+    c2=colors[i+1];
+    r1=static_cast<unsigned int>(a*c1.red()+(1.0-a)*c2.red())&0xFF;
+    g1=static_cast<unsigned int>(a*c1.green()+(1.0-a)*c2.green())&0xFF;
+    b1=static_cast<unsigned int>(a*c1.blue()+(1.0-a)*c2.blue())&0xFF;
 
-    colors[4] = MColor[0][5];       /*      mp> 0.6 */
-    colors[3] = MColor[0][4];       /*  0.6>mp> 0.2 */
-    colors[2] = MColor[0][3];       /*  0.2>mp>-0.2 */
-    colors[1] = MColor[0][2];       /* -0.2>mp>-0.6 */
-    colors[0] = MColor[0][1];       /* -0.6>mp      */
-
-    if (mp >= 0.6) return colors[4];
-    if (mp <= -0.6) return colors[0];
-    a = mp / 0.4 + 0.6;
-    i = static_cast<int>(a);
-    a -= i;
-    c1 = colors[i];
-    c2 = colors[i + 1];
-    r1 = static_cast<unsigned int>(a * c1.red() + (1.0 - a) * c2.red()) & 0xFF;
-    g1 = static_cast<unsigned int>(a * c1.green() + (1.0 - a) * c2.green()) & 0xFF;
-    b1 = static_cast<unsigned int>(a * c1.blue() + (1.0 - a) * c2.blue()) & 0xFF;
-
-    return QColor(r1, g1, b1);
+    return QColor(r1,g1,b1);
 }
 // search solution by xy-position in plot -----------------------------------
 int Plot::SearchPos(int x, int y)
 {
     sol_t *data;
-    QPoint p(x, y);
-    double xp, yp, xs, ys, r, xyz[3];
-    int i, sel = !BtnSol1->isChecked() && BtnSol2->isChecked() ? 1 : 0;
-
-    trace(3, "SearchPos: x=%d y=%d\n", x, y);
-
-    if (!BtnShowTrack->isChecked() || (!BtnSol1->isChecked() && !BtnSol2->isChecked())) return -1;
-
-    GraphT->ToPos(Disp->mapFromGlobal(p), xp, yp);
-    GraphT->GetScale(xs, ys);
-    r = (MarkSize / 2 + 2) * xs;
-
-    for (i = 0; (data = getsol(SolData + sel, i)) != NULL; i++) {
-        if (QFlag->currentIndex() && data->stat != QFlag->currentIndex()) continue;
-
-        PosToXyz(data->time, data->rr, data->type, xyz);
-        if (xyz[2]<-RE_WGS84) continue;
-
-        if (SQR(xp - xyz[0]) + SQR(yp - xyz[1]) <= SQR(r)) return i;
+    QPoint p(x,y);
+    double xp,yp,xs,ys,r,xyz[3];
+    int i,sel=!BtnSol1->isChecked()&&BtnSol2->isChecked()?1:0;
+    
+    trace(3,"SearchPos: x=%d y=%d\n",x,y);
+    
+    if (!BtnShowTrack->isChecked()||(!BtnSol1->isChecked()&&!BtnSol2->isChecked())) return -1;
+    
+    GraphT->ToPos(Disp->mapFromGlobal(p),xp,yp);
+    GraphT->GetScale(xs,ys);
+    r=(MarkSize/2+2)*xs;
+    
+    for (i=0;(data=getsol(SolData+sel,i))!=NULL;i++) {
+        if (QFlag->currentIndex()&&data->stat!=QFlag->currentIndex()) continue;
+        
+        PosToXyz(data->time,data->rr,data->type,xyz);
+        
+        if (SQR(xp-xyz[0])+SQR(yp-xyz[1])<=SQR(r)) return i;
     }
     return -1;
 }
@@ -418,46 +426,50 @@
 {
     struct tm *t;
     char tstr[64];
-    QString label = "";
+    QString label="";
     double tow;
     int week;
-
     Q_UNUSED(tsys);
-
-    if (TimeLabel == 0) { // www/ssss
-        tow = time2gpst(time, &week);
-        strcpy(tstr, qPrintable(QString("%1/%2").arg(week, 4).arg(tow, (n > 0 ? 6 : 5) + n, 'f', n)));
-    } else if (TimeLabel == 1) { // gpst
-        time2str(time, tstr, n);
-        label = " GPST";
-    } else if (TimeLabel == 2) { // utc
-        time2str(gpst2utc(time), tstr, n);
-        label = " UTC";
-    } else { // lt
-        time = gpst2utc(time);
-        if (!(t = localtime(&time.time))) strcpy(tstr, "2000/01/01 00:00:00.0");
-        else strcpy(tstr, qPrintable(QString("%1/%2/%3 %4:%5:%6.%7").arg(t->tm_year + 1900, 4, 10, QChar('0'))
-                         .arg(t->tm_mon + 1, 2, 10, QChar('0')).arg(t->tm_mday, 2, 10, QChar('0')).arg(t->tm_hour, 2, 10, QChar('0')).arg(t->tm_min, 2, 10, QChar('0'))
-                         .arg(t->tm_sec, 2, 10, QChar('0')).arg(static_cast<int>(time.sec * pow(10.0, n)), n, 10)));
-        label = " LT";
+    
+    if (TimeLabel==0) { // www/ssss
+        tow=time2gpst(time,&week);
+        strcpy(tstr,qPrintable(QString("%1/%2").arg(week,4).arg(tow,(n>0?6:5)+n,'f',n)));
     }
-    str = tstr + label;
+    else if (TimeLabel==1) { // gpst
+        time2str(time,tstr,n);
+        label=" GPST";
+    }
+    else if (TimeLabel==2) { // utc
+        time2str(gpst2utc(time),tstr,n);
+        label=" UTC";
+    }
+    else { // lt
+        time=gpst2utc(time);
+        if (!(t=localtime(&time.time))) strcpy(tstr,"2000/01/01 00:00:00.0");
+        else strcpy(tstr,qPrintable(QString("%1/%2/%3 %4:%5:%6.%7").arg(t->tm_year+1900,4,10,QChar('0'))
+                     .arg(t->tm_mon+1,2,10,QChar('0')).arg(t->tm_mday,2,10,QChar('0')).arg(t->tm_hour,2,10,QChar('0')).arg(t->tm_min,2,10,QChar('0'))
+                     .arg(t->tm_sec,2,10,QChar('0')).arg(static_cast<int>(time.sec*pow(10.0,n)),n,10)));
+        label=" LT";
+    }
+    str=tstr+label;
 }
 // latitude/longitude/height string -----------------------------------------
 QString Plot::LatLonStr(const double *pos, int ndec)
 {
     QString s;
-    double dms1[3], dms2[3];
+    double dms1[3],dms2[3];
+    
+    if (LatLonFmt==0) {
+        s=QStringLiteral("%1%2%3 %4%5%6").arg(fabs(pos[0]*R2D),ndec+4,'f',ndec).arg(degreeChar).arg(pos[0]<0.0?"S":"N")
+                  .arg(fabs(pos[1]*R2D),ndec+5,'f',ndec).arg(degreeChar).arg(pos[1]<0.0?"W":"E");
 
-    if (LatLonFmt == 0) {
-        s = QStringLiteral("%1%2%3 %4%5%6").arg(fabs(pos[0] * R2D), ndec + 4, 'f', ndec).arg(degreeChar).arg(pos[0] < 0.0 ? "S" : "N")
-            .arg(fabs(pos[1] * R2D), ndec + 5, 'f', ndec).arg(degreeChar).arg(pos[1] < 0.0 ? "W" : "E");
-    } else {
-        deg2dms(pos[0] * R2D, dms1, ndec - 5);
-        deg2dms(pos[1] * R2D, dms2, ndec - 5);
-        s = QStringLiteral("%1%2 %3' %4\" %5 %6%7 %8' %9\" %10")
-            .arg(fabs(dms1[0]), 3, 'f', 0).arg(degreeChar).arg(dms1[1], 2, 'f', 0, QChar('0')).arg(dms1[2], ndec - 2, 'f', ndec - 5, QChar('0')).arg(pos[0] < 0.0 ? "S" : "N")
-            .arg(fabs(dms2[0]), 4, 'f', 0).arg(degreeChar).arg(dms2[1], 2, 'f', 0, QChar('0')).arg(dms2[2], ndec - 2, 'f', ndec - 5, QChar('0')).arg(pos[1] < 0.0 ? "W" : "E");
+    }
+    else {
+        deg2dms(pos[0]*R2D,dms1);
+        deg2dms(pos[1]*R2D,dms2);
+        s=QStringLiteral("%1%2 %3' %4\" %5 %6%7 %8' %9\" %10")
+                  .arg(fabs(dms1[0]),3,'f',0).arg(degreeChar).arg(dms1[1],2,'f',0,QChar('0')).arg(dms1[2],ndec-2,'f',ndec-5,QChar('0')).arg(pos[0]<0.0?"S":"N")
+                  .arg(fabs(dms2[0]),4,'f',0).arg(degreeChar).arg(dms2[1],2,'f',0,QChar('0')).arg(dms2[2],ndec-2,'f',ndec-5,QChar('0')).arg(pos[1]<0.0?"W":"E");
     }
     return s;
 }
@@ -468,21 +480,20 @@
 // constructor --------------------------------------------------------------
 TIMEPOS::TIMEPOS(int nmax, int sflg)
 {
-    nmax_ = nmax;
-    n = 0;
-    t = new gtime_t[nmax];
-    x = new double [nmax];
-    y = new double [nmax];
-    z = new double [nmax];
+    nmax_=nmax;
+    n=0;
+    t=new gtime_t[nmax];
+    x=new double [nmax];
+    y=new double [nmax];
+    z=new double [nmax];
     if (sflg) {
-        xs = new double [nmax];
-        ys = new double [nmax];
-        zs = new double [nmax];
-        xys = new double [nmax];
-    } else {
-        xs = ys = zs = xys = NULL;
+        xs =new double [nmax];
+        ys =new double [nmax];
+        zs =new double [nmax];
+        xys=new double [nmax];
     }
-    q = new int [nmax];
+    else xs=ys=zs=xys=NULL;
+    q=new int [nmax];
 }
 // destructor ---------------------------------------------------------------
 TIMEPOS::~TIMEPOS()
@@ -500,28 +511,29 @@
     delete [] q;
 }
 // xyz-position difference from previous ------------------------------------
-TIMEPOS *TIMEPOS::tdiff(void)
+TIMEPOS * TIMEPOS::tdiff(void)
 {
-    TIMEPOS *pos = new TIMEPOS(n, 1);
+    TIMEPOS *pos=new TIMEPOS(n,1);
     double tt;
     int i;
-
-    for (i = 0; i < n - 1; i++) {
-        tt = timediff(t[i + 1], t[i]);
-
-        if (tt == 0.0 || fabs(tt) > MAXTDIFF) continue;
-
-        pos->t[pos->n] = timeadd(t[i], tt / 2.0);
-        pos->x[pos->n] = (x[i + 1] - x[i]) / tt;
-        pos->y[pos->n] = (y[i + 1] - y[i]) / tt;
-        pos->z[pos->n] = (z[i + 1] - z[i]) / tt;
+    
+    for (i=0;i<n-1;i++) {
+        
+        tt=timediff(t[i+1],t[i]);
+        
+        if (tt==0.0||fabs(tt)>MAXTDIFF) continue;
+        
+        pos->t[pos->n]=timeadd(t[i],tt/2.0);
+        pos->x[pos->n]=(x[i+1]-x[i])/tt;
+        pos->y[pos->n]=(y[i+1]-y[i])/tt;
+        pos->z[pos->n]=(z[i+1]-z[i])/tt;
         if (xs) {
-            pos->xs [pos->n] = SQR(xs [i + 1]) + SQR(xs [i]);
-            pos->ys [pos->n] = SQR(ys [i + 1]) + SQR(ys [i]);
-            pos->zs [pos->n] = SQR(zs [i + 1]) + SQR(zs [i]);
-            pos->xys[pos->n] = SQR(xys[i + 1]) + SQR(xys[i]);
+            pos->xs [pos->n]=SQR(xs [i+1])+SQR(xs [i]);
+            pos->ys [pos->n]=SQR(ys [i+1])+SQR(ys [i]);
+            pos->zs [pos->n]=SQR(zs [i+1])+SQR(zs [i]);
+            pos->xys[pos->n]=SQR(xys[i+1])+SQR(xys[i]);
         }
-        pos->q[pos->n] = MAX(q[i], q[i + 1]);
+        pos->q[pos->n]=MAX(q[i],q[i+1]);
         pos->n++;
     }
     return pos;
@@ -529,33 +541,32 @@
 // xyz-position difference between TIMEPOS ----------------------------------
 TIMEPOS *TIMEPOS::diff(const TIMEPOS *pos2, int qflag)
 {
-    TIMEPOS *pos1 = this, *pos = new TIMEPOS(MIN(n, pos2->n), 1);
+    TIMEPOS *pos1=this,*pos=new TIMEPOS(MIN(n,pos2->n),1);
     double tt;
-    int i, j, q;
-
-    for (i = 0, j = 0; i < pos1->n && j < pos2->n; i++, j++) {
-        tt = timediff(pos1->t[i], pos2->t[j]);
-
-        if (tt < -TTOL) {
-            j--; continue;
-        } else if (tt > TTOL) {
-            i--; continue;
-        }
-
-        pos->t[pos->n] = pos1->t[i];
-        pos->x[pos->n] = pos1->x[i] - pos2->x[j];
-        pos->y[pos->n] = pos1->y[i] - pos2->y[j];
-        pos->z[pos->n] = pos1->z[i] - pos2->z[j];
+    int i,j,q;
+    
+    for (i=0,j=0;i<pos1->n&&j<pos2->n;i++,j++) {
+        
+        tt=timediff(pos1->t[i],pos2->t[j]);
+        
+        if      (tt<-TTOL) {j--; continue;}
+        else if (tt> TTOL) {i--; continue;}
+        
+        pos->t[pos->n]=pos1->t[i];
+        pos->x[pos->n]=pos1->x[i]-pos2->x[j];
+        pos->y[pos->n]=pos1->y[i]-pos2->y[j];
+        pos->z[pos->n]=pos1->z[i]-pos2->z[j];
         if (pos->xs) {
-            pos->xs [pos->n] = SQR(pos1->xs [i]) + SQR(pos2->xs [j]);
-            pos->ys [pos->n] = SQR(pos1->ys [i]) + SQR(pos2->ys [j]);
-            pos->zs [pos->n] = SQR(pos1->zs [i]) + SQR(pos2->zs [j]);
-            pos->xys[pos->n] = SQR(pos1->xys[i]) + SQR(pos2->xys[j]);
+            pos->xs [pos->n]=SQR(pos1->xs [i])+SQR(pos2->xs [j]);
+            pos->ys [pos->n]=SQR(pos1->ys [i])+SQR(pos2->ys [j]);
+            pos->zs [pos->n]=SQR(pos1->zs [i])+SQR(pos2->zs [j]);
+            pos->xys[pos->n]=SQR(pos1->xys[i])+SQR(pos2->xys[j]);
+        }
+        q=MAX(pos1->q[i],pos2->q[j]);
+        
+        if (!qflag||qflag==q) {
+            pos->q[pos->n++]=q;
         }
-        q = MAX(pos1->q[i], pos2->q[j]);
-
-        if (!qflag || qflag == q)
-            pos->q[pos->n++] = q;
     }
     return pos;
 }
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotdata.cpp RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotdata.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotdata.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotdata.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -10,7 +10,6 @@
 #include <QDebug>
 #include <QXmlStreamReader>
 #include <QXmlStreamWriter>
-#include <QFileInfo>
 
 #include "rtklib.h"
 #include "plotmain.h"
@@ -18,96 +17,91 @@
 #include "pntdlg.h"
 #include "geview.h"
 
-#define MAX_SIMOBS   16384              // max genrated obs epochs
-#define MAX_SKYIMG_R 2048               // max size of resampled sky image
+#define MAX_SIMOBS	16384			// max genrated obs epochs
+#define MAX_SKYIMG_R 2048			// max size of resampled sky image
 
-#define THRES_SLIP  2.0                 // threshold of cycle-slip
+#define THRES_SLIP  2.0             // threshold of cycle-slip
 
 
 static char path_str[MAXNFILE][1024];
-static const char *XMLNS = "http://www.topografix.com/GPX/1/1";
+static const char *XMLNS="http://www.topografix.com/GPX/1/1";
 
 // read solutions -----------------------------------------------------------
 void Plot::ReadSol(const QStringList &files, int sel)
 {
     solbuf_t sol;
-    gtime_t ts, te;
-    double tint, ep[6];
-    int i, n = 0;
+    gtime_t ts,te;
+    double tint;
+    int i,n=0;
     char *paths[MAXNFILE];
+    
+    trace(3,"ReadSol: sel=%d\n",sel);
 
-    trace(3, "ReadSol: sel=%d\n", sel);
-
-    setlocale(LC_NUMERIC, "C"); // use point as decimal separator in formatted output
-
-    memset(&sol, 0, sizeof(solbuf_t));
-
-    for (i = 0; i < MAXNFILE; i++) paths[i] = path_str[i];
-
-    if (files.count() <= 0) return;
+    setlocale(LC_NUMERIC,"C"); // use point as decimal separator in formated output
 
+    memset(&sol,0,sizeof(solbuf_t));
+    
+    for (i=0;i<MAXNFILE;i++) paths[i]=path_str[i];
+    
+    if (files.count()<=0) return;
+    
     ReadWaitStart();
-
-    QFileInfo fi(files.at(0));
-    QDateTime created = fi.created();
-
-    ep[0]=created.date().year();
-    ep[1]=created.date().month();
-    ep[2]=created.date().day();
-    ep[3]=created.time().hour();
-    ep[4]=created.time().minute();
-    ep[5]=created.time().second();
-    sol.time=utc2gpst(epoch2time(ep));
-
-    for (i = 0; i < files.count() && n < MAXNFILE; i++)
-        strcpy(paths[n++], qPrintable(files.at(i)));
-    TimeSpan(&ts, &te, &tint);
-
-    ShowMsg(tr("reading %1...").arg(paths[0]));
+    
+    for (i=0;i<files.count()&&n<MAXNFILE;i++) {
+        strcpy(paths[n++],qPrintable(files.at(i)));
+    }
+    TimeSpan(&ts,&te,&tint);
+    
+    ShowMsg(QString("reading %1...").arg(paths[0]));
     ShowLegend(NULL);
-
-    if (!readsolt(paths, n, ts, te, tint, 0, &sol)) {
-        ShowMsg(tr("no solution data : %1...").arg(paths[0]));
+    
+    if (!readsolt(paths,n,ts,te,tint,0,&sol)) {
+        ShowMsg(QString("no solution data : %1...").arg(paths[0]));
         ShowLegend(NULL);
         ReadWaitEnd();
         return;
     }
-    freesolbuf(SolData + sel);
-    SolData[sel] = sol;
-
-    if (SolFiles[sel] != files)
-        SolFiles[sel] = files;
+    freesolbuf(SolData+sel);
+    SolData[sel]=sol;
+    
+    if (SolFiles[sel]!=files) {
+        SolFiles[sel]=files;
+    }
     setWindowTitle("");
-
-    ReadSolStat(files, sel);
-
-    for (i = 0; i < 2; i++) {
-        if (SolFiles[i].length() == 0) continue;
-        setWindowTitle(windowTitle() + SolFiles[i].at(0) + (SolFiles[i].count() > 1 ? "... " : " "));
+    
+    ReadSolStat(files,sel);
+    
+    for (i=0;i<2;i++) {
+        if (SolFiles[i].length()==0) continue;
+        setWindowTitle(windowTitle()+SolFiles[i].at(0)+(SolFiles[i].count()>1?"... ":" "));
     }
     BtnSol12->setChecked(false);
-    if (sel == 0) BtnSol1->setChecked(true);
-    else BtnSol2->setChecked(true);
-
-    if (sel == 0 || SolData[0].n <= 0) {
-        time2gpst(SolData[sel].data[0].time, &Week);
+    if (sel==0) BtnSol1->setChecked(true);
+    else        BtnSol2->setChecked(true);
+    
+    if (sel==0||SolData[0].n<=0) {
+        time2gpst(SolData[sel].data[0].time,&Week);
         UpdateOrigin();
     }
-    SolIndex[0] = SolIndex[1] = ObsIndex = 0;
-
-    GEDataState[sel] = 0;
-
-    if (PlotType > PLOT_NSAT)
+    SolIndex[0]=SolIndex[1]=ObsIndex=0;
+    
+    GEDataState[sel]=0;
+    
+    if (PlotType>PLOT_NSAT) {
         UpdateType(PLOT_TRK);
-    else
+    }
+    else {
         UpdatePlotType();
+    }
     FitTime();
-    if (AutoScale && PlotType <= PLOT_SOLA)
+    if (AutoScale&&PlotType<=PLOT_SOLA) {
         FitRange(1);
-    else
-        SetRange(1, YRange);
+    }
+    else {
+        SetRange(1,YRange);
+    }
     ReadWaitEnd();
-
+    
     UpdateTime();
     UpdatePlot();
     UpdateEnable();
@@ -115,81 +109,85 @@
 // read solution status -----------------------------------------------------
 void Plot::ReadSolStat(const QStringList &files, int sel)
 {
-    gtime_t ts, te;
+    gtime_t ts,te;
     double tint;
-    int i, n = 0;
+    int i,n=0;
     char *paths[MAXNFILE];
+    
+    trace(3,"ReadSolStat\n");
+    
+    setlocale(LC_NUMERIC,"C"); // use point as decimal separator in formated output
 
-    trace(3, "ReadSolStat\n");
-
-    setlocale(LC_NUMERIC, "C"); // use point as decimal separator in formatted output
-
-    freesolstatbuf(SolStat + sel);
-
-    for (i = 0; i < MAXNFILE; i++) paths[i] = path_str[i];
-
-    TimeSpan(&ts, &te, &tint);
-
-    for (i = 0; i < files.count() && n < MAXNFILE; i++)
-        strcpy(paths[n++], qPrintable(files.at(i)));
-    ShowMsg(tr("reading %1...").arg(paths[0]));
+    freesolstatbuf(SolStat+sel);
+    
+    for (i=0;i<MAXNFILE;i++) paths[i]=path_str[i];
+    
+    TimeSpan(&ts,&te,&tint);
+    
+    for (i=0;i<files.count()&&n<MAXNFILE;i++) {
+        strcpy(paths[n++],qPrintable(files.at(i)));
+    }
+    ShowMsg(QString("reading %1...").arg(paths[0]));
     ShowLegend(NULL);
-
-    readsolstatt(paths, n, ts, te, tint, SolStat + sel);
-
+    
+    readsolstatt(paths,n,ts,te,tint,SolStat+sel);
+    
     UpdateSatList();
 }
 // read observation data ----------------------------------------------------
 void Plot::ReadObs(const QStringList &files)
 {
-    obs_t obs = { 0, 0, NULL };
+    obs_t obs={0,0,NULL};
     nav_t nav;
     sta_t sta;
     int nobs;
+    
+    trace(3,"ReadObs\n");
+    
+    setlocale(LC_NUMERIC,"C"); // use point as decimal separator in formated output
 
-    trace(3, "ReadObs\n");
-
-    setlocale(LC_NUMERIC, "C"); // use point as decimal separator in formatted output
-
-    memset(&nav, 0, sizeof(nav_t));
-    memset(&sta, 0, sizeof(sta_t));
-
-    if (files.size() == 0) return;
+    memset(&nav,0,sizeof(nav_t));
+    memset(&sta,0,sizeof(sta_t));
 
+    if (files.size()==0) return;
+    
     ReadWaitStart();
     ShowLegend(NULL);
-
-    if ((nobs = ReadObsRnx(files, &obs, &nav, &sta)) <= 0) {
+    
+    if ((nobs=ReadObsRnx(files,&obs,&nav,&sta))<=0) {
         ReadWaitEnd();
         return;
     }
     ClearObs();
 
-    Obs = obs;
-    Nav = nav;
-    Sta = sta;
-    SimObs = 0;
+    Obs=obs;
+    Nav=nav;
+    Sta=sta;
+    SimObs=0;
 
     UpdateObs(nobs);
     UpdateMp();
-
-    if (ObsFiles != files)
-        ObsFiles = files;
+    
+    if (ObsFiles!=files) {
+        ObsFiles=files;
+    }
     NavFiles.clear();
-
-    setWindowTitle(files.at(0) + (files.size() > 1 ? "..." : ""));
-
+    
+    setWindowTitle(files.at(0) + (files.size()>1?"...":""));
+    
     BtnSol1->setChecked(true);
 
-    time2gpst(Obs.data[0].time, &Week);
-    SolIndex[0] = SolIndex[1] = ObsIndex = 0;
-
-    if (PlotType < PLOT_OBS || PLOT_DOP < PlotType)
+    time2gpst(Obs.data[0].time,&Week);
+    SolIndex[0]=SolIndex[1]=ObsIndex=0;
+    
+    if (PlotType<PLOT_OBS||PLOT_DOP<PlotType) {
         UpdateType(PLOT_OBS);
-    else
+    }
+    else {
         UpdatePlotType();
+    }
     FitTime();
-
+    
     ReadWaitEnd();
     UpdateObsType();
     UpdateTime();
@@ -198,28 +196,27 @@
 }
 // read observation data rinex ----------------------------------------------
 int Plot::ReadObsRnx(const QStringList &files, obs_t *obs, nav_t *nav,
-             sta_t *sta)
+                                 sta_t *sta)
 {
-    gtime_t ts, te;
+    gtime_t ts,te;
     double tint;
-    int i, n;
-    char obsfile[1024], navfile[1024] = "", *p, *q, opt[2048];
-
-    strcpy(opt, qPrintable(RnxOpts));
-
-    trace(3, "ReadObsRnx\n");
-
-    setlocale(LC_NUMERIC, "C"); // use point as decimal separator in formatted output
-
-    TimeSpan(&ts, &te, &tint);
-
-    for (i = 0; i < files.count(); i++) {
-        strcpy(obsfile, qPrintable(QDir::toNativeSeparators(files.at(i))));
+    int i,n;
+    char obsfile[1024],navfile[1024]="",*p,*q,opt[2048];
+    strcpy(opt,qPrintable(RnxOpts));
+    
+    trace(3,"ReadObsRnx\n");
+    
+    setlocale(LC_NUMERIC,"C"); // use point as decimal separator in formated output
 
+    TimeSpan(&ts,&te,&tint);
+    
+    for (i=0;i<files.count();i++) {
+        strcpy(obsfile,qPrintable(QDir::toNativeSeparators(files.at(i))));
+        
         ShowMsg(QString(tr("reading obs data... %1")).arg(obsfile));
         qApp->processEvents();
 
-        if (readrnxt(obsfile, 1, ts, te, tint, opt, obs, nav, sta) < 0) {
+        if (readrnxt(obsfile,1,ts,te,tint,opt,obs,nav,sta)<0) {
             ShowMsg(tr("error: insufficient memory"));
             return -1;
         }
@@ -227,43 +224,40 @@
     ShowMsg(tr("reading nav data..."));
     qApp->processEvents();
 
-    for (i = 0; i < files.count(); i++) {
-        strcpy(navfile, qPrintable(QDir::toNativeSeparators(files.at(i))));
-
-        if (!(p = strrchr(navfile, '.'))) continue;
-
-        if (!strcmp(p, ".obs") || !strcmp(p, ".OBS")) {
-            strcpy(p, ".nav"); readrnxt(navfile, 1, ts, te, tint, opt, NULL, nav, NULL);
-            strcpy(p, ".gnav"); readrnxt(navfile, 1, ts, te, tint, opt, NULL, nav, NULL);
-            strcpy(p, ".hnav"); readrnxt(navfile, 1, ts, te, tint, opt, NULL, nav, NULL);
-            strcpy(p, ".qnav"); readrnxt(navfile, 1, ts, te, tint, opt, NULL, nav, NULL);
-            strcpy(p, ".lnav"); readrnxt(navfile, 1, ts, te, tint, opt, NULL, nav, NULL);
-            strcpy(p, ".cnav"); readrnxt(navfile, 1, ts, te, tint, opt, NULL, nav, NULL);
-            strcpy(p, ".inav"); readrnxt(navfile, 1, ts, te, tint, opt, NULL, nav, NULL);
-        } else if (!strcmp(p + 3, "o") || !strcmp(p + 3, "d") ||
-               !strcmp(p + 3, "O") || !strcmp(p + 3, "D")) {
-            n = nav->n;
-
-            strcpy(p + 3, "N"); readrnxt(navfile, 1, ts, te, tint, opt, NULL, nav, NULL);
-            strcpy(p + 3, "G"); readrnxt(navfile, 1, ts, te, tint, opt, NULL, nav, NULL);
-            strcpy(p + 3, "H"); readrnxt(navfile, 1, ts, te, tint, opt, NULL, nav, NULL);
-            strcpy(p + 3, "Q"); readrnxt(navfile, 1, ts, te, tint, opt, NULL, nav, NULL);
-            strcpy(p + 3, "L"); readrnxt(navfile, 1, ts, te, tint, opt, NULL, nav, NULL);
-            strcpy(p + 3, "C"); readrnxt(navfile, 1, ts, te, tint, opt, NULL, nav, NULL);
-            strcpy(p + 3, "I"); readrnxt(navfile, 1, ts, te, tint, opt, NULL, nav, NULL);
-            strcpy(p + 3, "P"); readrnxt(navfile, 1, ts, te, tint, opt, NULL, nav, NULL);
-
-            if (nav->n > n || !(q = strrchr(navfile, '\\'))) continue;
-
+    for (i=0;i<files.count();i++) {
+        strcpy(navfile,qPrintable(QDir::toNativeSeparators(files.at(i))));
+        
+        if (!(p=strrchr(navfile,'.'))) continue;
+        
+        if (!strcmp(p,".obs")||!strcmp(p,".OBS")) {
+            strcpy(p,".nav" ); readrnxt(navfile,1,ts,te,tint,opt,NULL,nav,NULL);
+            strcpy(p,".gnav"); readrnxt(navfile,1,ts,te,tint,opt,NULL,nav,NULL);
+            strcpy(p,".hnav"); readrnxt(navfile,1,ts,te,tint,opt,NULL,nav,NULL);
+            strcpy(p,".qnav"); readrnxt(navfile,1,ts,te,tint,opt,NULL,nav,NULL);
+            strcpy(p,".lnav"); readrnxt(navfile,1,ts,te,tint,opt,NULL,nav,NULL);
+        }
+        else if (!strcmp(p+3,"o" )||!strcmp(p+3,"d" )||
+                 !strcmp(p+3,"O" )||!strcmp(p+3,"D" )) {
+            n=nav->n;
+            
+            strcpy(p+3,"N"); readrnxt(navfile,1,ts,te,tint,opt,NULL,nav,NULL);
+            strcpy(p+3,"G"); readrnxt(navfile,1,ts,te,tint,opt,NULL,nav,NULL);
+            strcpy(p+3,"H"); readrnxt(navfile,1,ts,te,tint,opt,NULL,nav,NULL);
+            strcpy(p+3,"Q"); readrnxt(navfile,1,ts,te,tint,opt,NULL,nav,NULL);
+            strcpy(p+3,"L"); readrnxt(navfile,1,ts,te,tint,opt,NULL,nav,NULL);
+            strcpy(p+3,"P"); readrnxt(navfile,1,ts,te,tint,opt,NULL,nav,NULL);
+            
+            if (nav->n>n||!(q=strrchr(navfile,'\\'))) continue;
+            
             // read brdc navigation data
-            memcpy(q + 1, "BRDC", 4);
-            strcpy(p + 3, "N"); readrnxt(navfile, 1, ts, te, tint, opt, NULL, nav, NULL);
+            memcpy(q+1,"BRDC",4);
+            strcpy(p+3,"N"); readrnxt(navfile,1,ts,te,tint,opt,NULL,nav,NULL);
         }
     }
-    if (obs->n <= 0) {
+    if (obs->n<=0) {
         ShowMsg(QString(tr("no observation data: %1...")).arg(files.at(0)));
         qApp->processEvents();
-        freenav(nav, 0xFF);
+        freenav(nav,0xFF);
         return 0;
     }
     uniqnav(nav);
@@ -272,49 +266,49 @@
 // read navigation data -----------------------------------------------------
 void Plot::ReadNav(const QStringList &files)
 {
-    gtime_t ts, te;
+    gtime_t ts,te;
     double tint;
-    char navfile[1024], opt[2048];
+    char navfile[1024],opt[2048];
     int i;
+    strcpy(opt,qPrintable(RnxOpts));
 
-    strcpy(opt, qPrintable(RnxOpts));
-
-    trace(3, "ReadNav\n");
-
-    if (files.size() <= 0) return;
-
-    setlocale(LC_NUMERIC, "C"); // use point as decimal separator in formatted output
+    trace(3,"ReadNav\n");
+    
+    if (files.size()<=0) return;
+    
+    setlocale(LC_NUMERIC,"C"); // use point as decimal separator in formated output
 
     ReadWaitStart();
     ShowLegend(NULL);
-
-    TimeSpan(&ts, &te, &tint);
-
-    freenav(&Nav, 0xFF);
-
+    
+    TimeSpan(&ts,&te,&tint);
+    
+    freenav(&Nav,0xFF);
+    
     ShowMsg(tr("reading nav data..."));
 
     qApp->processEvents();
-
-    for (i = 0; i < files.size(); i++) {
-        strcpy(navfile, qPrintable(QDir::toNativeSeparators(files.at(i))));
-        readrnxt(navfile, 1, ts, te, tint, opt, NULL, &Nav, NULL);
+    
+    for (i=0;i<files.size();i++) {
+        strcpy(navfile,qPrintable(QDir::toNativeSeparators(files.at(i))));
+        readrnxt(navfile,1,ts,te,tint,opt,NULL,&Nav,NULL);
     }
     uniqnav(&Nav);
-
-    if (Nav.n <= 0 && Nav.ng <= 0 && Nav.ns <= 0) {
+    
+    if (Nav.n<=0&&Nav.ng<=0&&Nav.ns<=0) {
         ShowMsg(QString(tr("no nav message: %1...")).arg(QDir::toNativeSeparators(files.at(i))));
         ReadWaitEnd();
         return;
     }
-    if (NavFiles != files)
-        NavFiles = files;
-    for (i = 0; i < NavFiles.size(); i++) NavFiles[i] = QDir::toNativeSeparators(NavFiles.at(i));
+    if (NavFiles!=files) {
+        NavFiles=files;
+    }
+    for (i=0;i<NavFiles.size();i++) NavFiles[i]=QDir::toNativeSeparators(NavFiles.at(i));
 
     UpdateObs(NObs);
     UpdateMp();
     ReadWaitEnd();
-
+    
     UpdatePlot();
     UpdateEnable();
 }
@@ -322,34 +316,35 @@
 void Plot::ReadElMaskData(const QString &file)
 {
     QFile fp(file);
-    double az0 = 0.0, el0 = 0.0, az1, el1;
-    int i, j;
+    double az0=0.0,el0=0.0,az1,el1;
+    int i,j;
     QByteArray buff;
-
-    trace(3, "ReadElMaskData\n");
-
-    for (i = 0; i <= 360; i++) ElMaskData[i] = 0.0;
-
+    
+    trace(3,"ReadElMaskData\n");
+    
+    for (i=0;i<=360;i++) ElMaskData[i]=0.0;
+    
     if (!fp.open(QIODevice::ReadOnly)) {
         ShowMsg(QString(tr("no el mask data: %1...")).arg(file));
         ShowLegend(NULL);
         return;
     }
     while (!fp.atEnd()) {
-        buff = fp.readLine();
+        buff=fp.readLine();
 
-        if (buff.at(0) == '%') continue;
-        QList<QByteArray> tokens = buff.split(' ');
-        if (tokens.size() != 2) continue;
+        if (buff.at(0)=='%') continue;
+        QList<QByteArray> tokens=buff.split(' ');
+        if (tokens.size()!=2) continue;
         bool okay;
-        az1 = tokens.at(0).toDouble(&okay); if (!okay) continue;
-        el1 = tokens.at(1).toDouble(&okay); if (!okay) continue;
-
-        if (az0 < az1 && az1 <= 360.0 && 0.0 <= el1 && el1 <= 90.0) {
-            for (j = static_cast<int>(az0); j < static_cast<int>(az1); j++) ElMaskData[j] = el0 * D2R;
-            ElMaskData[j] = el1 * D2R;
+        az1=tokens.at(0).toDouble(&okay); if (!okay) continue;
+        el1=tokens.at(1).toDouble(&okay); if (!okay) continue;
+        
+        if (az0<az1&&az1<=360.0&&0.0<=el1&&el1<=90.0) {
+            
+            for (j=static_cast<int>(az0);j<static_cast<int>(az1);j++) ElMaskData[j]=el0*D2R;
+            ElMaskData[j]=el1*D2R;
         }
-        az0 = az1; el0 = el1;
+        az0=az1; el0=el1;
     }
     UpdatePlot();
     UpdateEnable();
@@ -357,72 +352,74 @@
 // generate visibility data ----------------------------------------------------
 void Plot::GenVisData(void)
 {
-    gtime_t time, ts, te;
+    gtime_t time,ts,te;
     obsd_t data;
-    double tint, pos[3], rr[3], rs[6], e[3], azel[2];
-    unsigned char i, j;
-    int nobs = 0;
+    double tint,pos[3],rr[3],rs[6],e[3],azel[2];
+    unsigned char i,j;
+    int nobs=0;
     char name[16];
-
-    trace(3, "GenVisData\n");
-
-    memset(&data, 0, sizeof(obsd_t));
+    
+    trace(3,"GenVisData\n");
+    
+    memset(&data,0,sizeof(obsd_t));
 
     ClearObs();
-    SimObs = 1;
-
-    ts = TimeStart;
-    te = TimeEnd;
-    tint = TimeInt;
-    matcpy(pos, OOPos, 3, 1);
-    pos2ecef(pos, rr);
-
+    SimObs=1;
+    
+    ts=TimeStart;
+    te=TimeEnd;
+    tint=TimeInt;
+    matcpy(pos,OOPos,3,1);
+    pos2ecef(pos,rr);
+    
     ReadWaitStart();
     ShowLegend(NULL);
     ShowMsg(tr("generating satellite visibility..."));
     qApp->processEvents();
-
-    for (time = ts; timediff(time, te) <= 0.0; time = timeadd(time, tint)) {
-        for (i = 0; i < MAXSAT; i++) {
-            satno2id(i + 1, name);
-            if (!tle_pos(time, name, "", "", &TLEData, NULL, rs)) continue;
-            if ((geodist(rs, rr, e)) <= 0.0) continue;
-            if (satazel(pos, e, azel) <= 0.0) continue;
-            if (Obs.n >= Obs.nmax) {
-                Obs.nmax = Obs.nmax <= 0 ? 4096 : Obs.nmax * 2;
-                Obs.data = static_cast<obsd_t *>(realloc(Obs.data, sizeof(obsd_t) * Obs.nmax));
+    
+    for (time=ts;timediff(time,te)<=0.0;time=timeadd(time,tint)) {
+        for (i=0;i<MAXSAT;i++) {
+            satno2id(i+1,name);
+            if (!tle_pos(time,name,"","",&TLEData,NULL,rs)) continue;
+            if ((geodist(rs,rr,e))<=0.0) continue;
+            if (satazel(pos,e,azel)<=0.0) continue;
+            if (Obs.n>=Obs.nmax) {
+                Obs.nmax=Obs.nmax<=0?4096:Obs.nmax*2;
+                Obs.data=static_cast<obsd_t *>(realloc(Obs.data,sizeof(obsd_t)*Obs.nmax));
                 if (!Obs.data) {
-                    Obs.n = Obs.nmax = 0;
+                    Obs.n=Obs.nmax=0;
                     break;
                 }
             }
-            data.time = time;
-            data.sat = i + 1;
-
-            for (j = 0; j < NFREQ; j++) {
-                data.P[j] = data.L[j] = 0.0;
-                data.code[j] = CODE_NONE;
+            data.time=time;
+            data.sat=i+1;
+            
+            for (j=0;j<NFREQ;j++) {
+                data.P[j]=data.L[j]=0.0;
+                data.code[j]=CODE_NONE;
             }
-            data.code[0] = CODE_L1C;
-            Obs.data[Obs.n++] = data;
+            data.code[0]=CODE_L1C;
+            Obs.data[Obs.n++]=data;
         }
-        if (++nobs >= MAX_SIMOBS) break;
+        if (++nobs>=MAX_SIMOBS) break;
     }
-    if (Obs.n <= 0) {
+    if (Obs.n<=0) {
         ReadWaitEnd();
         ShowMsg(tr("no satellite visibility"));
         return;
     }
     UpdateObs(nobs);
-
+    
     setWindowTitle(tr("Satellite Visibility (Predicted)"));
     BtnSol1->setChecked(true);
-    time2gpst(Obs.data[0].time, &Week);
-    SolIndex[0] = SolIndex[1] = ObsIndex = 0;
-    if (PlotType < PLOT_OBS || PLOT_DOP < PlotType)
+    time2gpst(Obs.data[0].time,&Week);
+    SolIndex[0]=SolIndex[1]=ObsIndex=0;
+    if (PlotType<PLOT_OBS||PLOT_DOP<PlotType) {
         UpdateType(PLOT_OBS);
-    else
+    }
+    else {
         UpdatePlotType();
+    }
     FitTime();
     ReadWaitEnd();
     UpdateObsType();
@@ -434,33 +431,25 @@
 void Plot::ReadMapData(const QString &file)
 {
     QImage image;
-    double pos[3];
-
-    trace(3, "ReadMapData\n");
-
-    ShowMsg(tr("reading map image... %1").arg(file));
+    
+    trace(3,"ReadMapData\n");
 
+    ShowMsg(QString("reading map image... %1").arg(file));
+    
     if (!image.load(file)) {
-        ShowMsg(tr("map file read error: %1").arg(file));
+        ShowMsg(QString(tr("map file read error: %1")).arg(file));
         ShowLegend(NULL);
         return;
     }
-    MapImage = image;
-    MapImageFile = file;
-    MapSize[0] = MapImage.width();
-    MapSize[1] = MapImage.height();
-
+    MapImage=image;
+    MapImageFile=file;
+    MapSize[0]=MapImage.width();
+    MapSize[1]=MapImage.height();
+    
     ReadMapTag(file);
-
-    if (norm(OPos, 3) <= 0.0 && (MapLat != 0.0 || MapLon != 0.0)) {
-        pos[0] = MapLat * D2R;
-        pos[1] = MapLon * D2R;
-        pos[2] = 0.0;
-        pos2ecef(pos, OPos);
-    }
-
+    
     BtnShowImg->setChecked(true);
-
+    
     mapAreaDialog->UpdateField();
     UpdatePlot();
     UpdateOrigin();
@@ -468,129 +457,137 @@
     ShowMsg("");
 }
 // resample image pixel -----------------------------------------------------
-#define ResPixelNN(img1, x, y, b1, pix) { \
-        int ix = static_cast<int>((x) + 0.5), iy = static_cast<int>((y) + 0.5); \
-        pix = img1.pixel(ix, iy); \
+#define ResPixelNN(img1,x,y,b1,pix) {\
+    int ix=static_cast<int>((x)+0.5),iy=static_cast<int>((y)+0.5);\
+    pix=img1.pixel(ix,iy);\
 }
-#define ResPixelBL(img1, x, y, b1, pix) { \
-        int ix = static_cast<int>(x), iy = static_cast<int>(y); \
-        double dx1 = (x) - ix, dy1 = (y) - iy, dx2 = 1.0 - dx1, dy2 = 1.0 - dy1; \
-        double a1 = dx2 * dy2, a2 = dx2 * dy1, a3 = dx1 * dy2, a4 = dx1 * dy1; \
-        QRgb p1 = img1.pixel(ix, iy); \
-        QRgb p2 = img1.pixel(ix, iy + 1); \
-        pix = qRgb(static_cast<quint8>(a1 * qRed(p1) + a2 * qRed(p2) + a3 * qRed(p1) + a4 * qRed(p2)), \
-               static_cast<quint8>(a1 * qRed(p1) + a2 * qGreen(p2) + a3 * qGreen(p1) + a4 * qGreen(p2)), \
-               static_cast<quint8>(a1 * qRed(p1) + a2 * qBlue(p2) + a3 * qBlue(p1) + a4 * qBlue(p2))); \
+#define ResPixelBL(img1,x,y,b1,pix) {\
+    int ix=static_cast<int>(x),iy=static_cast<int>(y);\
+    double dx1=(x)-ix,dy1=(y)-iy,dx2=1.0-dx1,dy2=1.0-dy1;\
+    double a1=dx2*dy2,a2=dx2*dy1,a3=dx1*dy2,a4=dx1*dy1;\
+    QRgb p1=img1.pixel(ix,iy); \
+    QRgb p2=img1.pixel(ix,iy+1); \
+    pix=qRgb(static_cast<quint8>(a1*qRed(p1)+a2*qRed(p2)  +a3*qRed(p1)  +a4*qRed(p2)),\
+             static_cast<quint8>(a1*qRed(p1)+a2*qGreen(p2)+a3*qGreen(p1)+a4*qGreen(p2)),\
+             static_cast<quint8>(a1*qRed(p1)+a2*qBlue(p2) +a3*qBlue(p1) +a4*qBlue(p2)));\
 }
 // rotate coordintates roll-pitch-yaw ---------------------------------------
 static void RPY(const double *rpy, double *R)
 {
-    double sr = sin(-rpy[0] * D2R), cr = cos(-rpy[0] * D2R);
-    double sp = sin(-rpy[1] * D2R), cp = cos(-rpy[1] * D2R);
-    double sy = sin(-rpy[2] * D2R), cy = cos(-rpy[2] * D2R);
-
-    R[0] = cy * cr - sy * sp * sr; R[1] = -sy * cp; R[2] = cy * sr + sy * sp * cr;
-    R[3] = sy * cr + cy * sp * sr; R[4] = cy * cp;  R[5] = sy * sr - cy * sp * cr;
-    R[6] = -cp * sr;         R[7] = sp;     R[8] = cp * cr;
+    double sr=sin(-rpy[0]*D2R),cr=cos(-rpy[0]*D2R);
+    double sp=sin(-rpy[1]*D2R),cp=cos(-rpy[1]*D2R);
+    double sy=sin(-rpy[2]*D2R),cy=cos(-rpy[2]*D2R);
+    R[0]=cy*cr-sy*sp*sr; R[1]=-sy*cp; R[2]=cy*sr+sy*sp*cr;
+    R[3]=sy*cr+cy*sp*sr; R[4]=cy*cp;  R[5]=sy*sr-cy*sp*cr;
+    R[6]=-cp*sr;         R[7]=sp;     R[8]=cp*cr;
 }
 // RGB -> YCrCb (ITU-R BT.601) ----------------------------------------------
 static void YCrCb(const QRgb *pix, double *Y)
 {
     //         R(0-255)     G(0-255)     B(0-255)
-    Y[0] = (0.299 * qRed(*pix) + 0.587 * qGreen(*pix) + 0.114 * qBlue(*pix)) / 255;         // Y  (0-1)
-    Y[1] = (0.500 * qRed(*pix) - 0.419 * qGreen(*pix) + 0.081 * qBlue(*pix)) / 255;         // Cr (-.5-.5)
-    Y[2] = (-0.169 * qRed(*pix) - 0.331 * qGreen(*pix) + 0.500 * qBlue(*pix)) / 255;        // Cb (-.5-.5)
+    Y[0]=( 0.299*qRed(*pix)+0.587*qGreen(*pix)+0.114*qBlue(*pix))/255; // Y  (0-1)
+    Y[1]=( 0.500*qRed(*pix)-0.419*qGreen(*pix)+0.081*qBlue(*pix))/255; // Cr (-.5-.5)
+    Y[2]=(-0.169*qRed(*pix)-0.331*qGreen(*pix)+0.500*qBlue(*pix))/255; // Cb (-.5-.5)
 }
 // update sky image ---------------------------------------------------------
 void Plot::UpdateSky(void)
 {
-    QImage &bm1 = SkyImageI, &bm2 = SkyImageR;
+    QImage &bm1=SkyImageI,&bm2=SkyImageR;
     QRgb pix;
-    double x, y, xp, yp, r, a, p[3], q[3], R[9] = { 0 }, dr, dist, Yz[3] = { 0 }, Y[3];
-    int i, j, k, w1, h1, w2, h2, wz, nz = 0;
-
-
-    w1 = bm1.width(); h1 = bm1.height();
-    w2 = bm2.width(); h2 = bm2.height();
-
-    if (w1 <= 0 || h1 <= 0 || w2 <= 0 || h2 <= 0) return;
+    double x,y,xp,yp,r,a,p[3],q[3],R[9]={0},dr,dist,Yz[3]={0},Y[3];
+    int i,j,k,w1,h1,w2,h2,wz,nz=0;
+    
 
+    w1=bm1.width(); h1=bm1.height();
+    w2=bm2.width(); h2=bm2.height();
+    
+    if (w1<=0||h1<=0||w2<=0||h2<=0) return;
+    
     bm2.fill(QColor("silver")); // fill bitmap by silver
-
-    if (norm(SkyFov, 3) > 1e-12)
-        RPY(SkyFov, R);
-    if (SkyBinarize) {      // average of zenith image
-        wz = h1 / 16;   // sky area size
-        for (i = w1 / 2 - wz; i <= w1 / 2 + wz; i++) for (j = h1 / 2 - wz; j <= h1 / 2 + wz; j++) {
-                pix = bm1.pixel(i, j);
-                YCrCb(&pix, Y);
-                for (k = 0; k < 3; k++) Yz[k] += Y[k];
-                nz++;
-            }
-        if (nz > 0)
-            for (k = 0; k < 3; k++) Yz[k] /= nz;
+    
+    if (norm(SkyFov,3)>1e-12) {
+        RPY(SkyFov,R);
     }
-    for (j = 0; j < h2; j++) for (i = 0; i < w2; i++) {
-            xp = (w2 / 2.0 - i) / SkyScaleR;
-            yp = (j - h2 / 2.0) / SkyScaleR;
-            r = SQRT(SQR(xp) + SQR(yp));
-            if (SkyElMask && r > 1.0) continue;
-
-            // rotate coordinates roll-pitch-yaw
-            if (norm(SkyFov, 3) > 1e-12) {
-                if (r < 1e-12) {
-                    p[0] = p[1] = 0.0;
-                    p[2] = 1.0;
-                } else {
-                    a = sin(r * PI / 2.0);
-                    p[0] = a * xp / r;
-                    p[1] = a * yp / r;
-                    p[2] = cos(r * PI / 2.0);
-                }
-                q[0] = R[0] * p[0] + R[3] * p[1] + R[6] * p[2];
-                q[1] = R[1] * p[0] + R[4] * p[1] + R[7] * p[2];
-                q[2] = R[2] * p[0] + R[5] * p[1] + R[8] * p[2];
-                if (q[2] >= 1.0) {
-                    xp = yp = r = 0.0;
-                } else {
-                    r = acos(q[2]) / (PI / 2.0);
-                    a = sqrt(SQR(q[0]) + SQR(q[1]));
-                    xp = r * q[0] / a;
-                    yp = r * q[1] / a;
-                }
+    if (SkyBinarize) { // average of zenith image
+        wz=h1/16; // sky area size
+        for (i=w1/2-wz;i<=w1/2+wz;i++) for (j=h1/2-wz;j<=h1/2+wz;j++) {
+            pix=bm1.pixel(i,j);
+            YCrCb(&pix,Y);
+            for (k=0;k<3;k++) Yz[k]+=Y[k];
+            nz++;
+        }
+        if (nz>0) {
+            for (k=0;k<3;k++) Yz[k]/=nz;
+        }
+    }
+    for (j=0;j<h2;j++) for (i=0;i<w2;i++) {
+        xp=(w2/2.0-i)/SkyScaleR;
+        yp=(j-h2/2.0)/SkyScaleR;
+        r=sqrt(SQR(xp)+SQR(yp));
+        if (SkyElMask&&r>1.0) continue;
+        
+        // rotate coordinates roll-pitch-yaw
+        if (norm(SkyFov,3)>1e-12) {
+            if (r<1e-12) {
+                p[0]=p[1]=0.0;
+                p[2]=1.0;
             }
-            // correct lense distortion
-            if (SkyDestCorr) {
-                if (r <= 0.0 || r >= 1.0) continue;
-                k = static_cast<int>(r * 9.0);
-                dr = r * 9.0 - k;
-                dist = k > 8 ? SkyDest[9] : (1.0 - dr) * SkyDest[k] + dr * SkyDest[k + 1];
-                xp *= dist / r;
-                yp *= dist / r;
-            } else {
-                xp *= SkyScale;
-                yp *= SkyScale;
+            else {
+                a=sin(r*PI/2.0);
+                p[0]=a*xp/r;
+                p[1]=a*yp/r;
+                p[2]=cos(r*PI/2.0);
             }
-            if (SkyFlip) xp = -xp;
-            x = SkyCent[0] + xp;
-            y = SkyCent[1] + yp;
-            if (x < 0.0 || x >= w1 - 1 || y < 0.0 || y >= h1 - 1) continue;
-            if (!SkyRes)
-                ResPixelNN(bm1, x, y, b1, pix)
-            else
-                ResPixelBL(bm1, x, y, b1, pix)
-            bm2.setPixel(i, j, pix);
-            if (SkyBinarize) {
-                YCrCb(&pix, Y);
-                for (k = 1; k < 3; k++) Y[k] -= Yz[k];
-
-                // threshold by brightness and color-distance
-                if (Y[0] > SkyBinThres1 && norm(Y + 1, 2) < SkyBinThres2)
-                    bm2.setPixel(i, j, qRgb(255, 255, 255));        // sky
-                else
-                    bm2.setPixel(i, j, qRgb(96, 96, 96));           // others
+            q[0]=R[0]*p[0]+R[3]*p[1]+R[6]*p[2];
+            q[1]=R[1]*p[0]+R[4]*p[1]+R[7]*p[2];
+            q[2]=R[2]*p[0]+R[5]*p[1]+R[8]*p[2];
+            if (q[2]>=1.0) {
+                xp=yp=r=0.0;
+            }
+            else {
+                r=acos(q[2])/(PI/2.0);
+                a=sqrt(SQR(q[0])+SQR(q[1]));
+                xp=r*q[0]/a;
+                yp=r*q[1]/a;
             }
         }
+        // correct lense distortion
+        if (SkyDestCorr) {
+            if (r<=0.0||r>=1.0) continue;
+            k=static_cast<int>(r*9.0);
+            dr=r*9.0-k;
+            dist=k>8?SkyDest[9]:(1.0-dr)*SkyDest[k]+dr*SkyDest[k+1];
+            xp*=dist/r;
+            yp*=dist/r;
+        }
+        else {
+            xp*=SkyScale;
+            yp*=SkyScale;
+        }
+        if (SkyFlip) xp=-xp;
+        x=SkyCent[0]+xp;
+        y=SkyCent[1]+yp;
+        if (x<0.0||x>=w1-1||y<0.0||y>=h1-1) continue;
+        if (!SkyRes) {
+            ResPixelNN(bm1,x,y,b1,pix)
+        }
+        else {
+            ResPixelBL(bm1,x,y,b1,pix)
+        }
+        bm2.setPixel(i,j,pix);
+        if (SkyBinarize) {
+            YCrCb(&pix,Y);
+            for (k=1;k<3;k++) Y[k]-=Yz[k];
+            
+            // threshold by brightness and color-distance
+            if (Y[0]>SkyBinThres1&&norm(Y+1,2)<SkyBinThres2) {
+                bm2.setPixel(i,j,qRgb(255,255,255)); // sky
+            }
+            else {
+                bm2.setPixel(i,j,qRgb(96,96,96)); // others
+            }
+        }
+    }
     UpdatePlot();
 }
 // read sky tag data --------------------------------------------------------
@@ -598,152 +595,132 @@
 {
     QFile fp(file);
     QByteArray buff;
-
-    trace(3, "ReadSkyTag\n");
-
+    
+    trace(3,"ReadSkyTag\n");
+    
     if (!fp.open(QIODevice::ReadOnly)) return;
-
+    
     while (!fp.atEnd()) {
-        buff = fp.readLine();
-        if (buff.at(0) == '\0' || buff.at(0) == '%' || buff.at(0) == '#') continue;
-        QList<QByteArray> tokens = buff.split('=');
-        if (tokens.size() < 2) continue;
+        buff=fp.readLine();
+        if (buff.at(0)=='\0'||buff.at(0)=='%'||buff.at(0)=='#') continue;
+        QList<QByteArray> tokens=buff.split('=');
+        if (tokens.size()<2) continue;
 
-        if (tokens.at(0) == "centx") {
-            SkyCent[0] = tokens.at(1).toDouble();
-        } else if (tokens.at(0) == "centy") {
-            SkyCent[1] = tokens.at(1).toDouble();
-        } else if (tokens.at(0) == "scale") {
-            SkyScale = tokens.at(1).toDouble();
-        } else if (tokens.at(0) == "roll") {
-            SkyFov[0] = tokens.at(1).toDouble();
-        } else if (tokens.at(0) == "pitch") {
-            SkyFov[1] = tokens.at(1).toDouble();
-        } else if (tokens.at(0) == "yaw") {
-            SkyFov[2] = tokens.at(1).toDouble();
-        } else if (tokens.at(0) == "destcorr") {
-            SkyDestCorr = tokens.at(1).toInt();
-        } else if (tokens.at(0) == "elmask") {
-            SkyElMask = tokens.at(1).toInt();
-        } else if (tokens.at(0) == "resample") {
-            SkyRes = tokens.at(1).toInt();
-        } else if (tokens.at(0) == "flip") {
-            SkyFlip = tokens.at(1).toInt();
-        } else if (tokens.at(0) == "dest") {
-            QList<QByteArray> t = tokens.at(1).split(' ');
-            if (t.size() == 9)
-                for (int i = 0; i < 9; i++) SkyDest[i] = t.at(i).toDouble();
-        } else if (tokens.at(0) == "binarize") {
-            SkyBinarize = tokens.at(1).toInt();
-        } else if (tokens.at(0) == "binthr1") {
-            SkyBinThres1 = tokens.at(1).toInt();
-        } else if (tokens.at(0) == "binthr2") {
-            SkyBinThres2 = tokens.at(1).toInt();
+        if      (tokens.at(0)=="centx")  SkyCent[0]=tokens.at(1).toDouble();
+        else if (tokens.at(0)=="centy")  SkyCent[1]=tokens.at(1).toDouble();
+        else if (tokens.at(0)=="scale")  SkyScale=tokens.at(1).toDouble();
+        else if (tokens.at(0)=="roll")   SkyFov[0]=tokens.at(1).toDouble();
+        else if (tokens.at(0)=="pitch")  SkyFov[1]=tokens.at(1).toDouble();
+        else if (tokens.at(0)=="yaw")    SkyFov[2]=tokens.at(1).toDouble();
+        else if (tokens.at(0)=="destcorr")SkyDestCorr=tokens.at(1).toInt();
+        else if (tokens.at(0)=="elmask")   SkyElMask=tokens.at(1).toInt();
+        else if (tokens.at(0)=="resample")   SkyRes=tokens.at(1).toInt();
+        else if (tokens.at(0)=="flip")   SkyFlip=tokens.at(1).toInt();
+        else if (tokens.at(0)=="dest") {
+            QList<QByteArray> t=tokens.at(1).split(' ');
+            if (t.size()==9)
+                for (int i=0;i<9;i++) SkyDest[i]=t.at(i).toDouble();
         }
+        else if (tokens.at(0)=="binarize")   SkyBinarize=tokens.at(1).toInt();
+        else if (tokens.at(0)=="binthr1")   SkyBinThres1=tokens.at(1).toInt();
+        else if (tokens.at(0)=="binthr2")   SkyBinThres2=tokens.at(1).toInt();
     }
 }
 // read sky image data ------------------------------------------------------
 void Plot::ReadSkyData(const QString &file)
 {
     QImage image;
-    int i, w, h, wr;
-
-    trace(3, "ReadSkyData\n");
-
-    ShowMsg(tr("reading sky data... %1").arg(file));
+    int i,w,h,wr;
+    
+    trace(3,"ReadSkyData\n");
+    
+    ShowMsg(QString("reading sky data... %1").arg(file));
 
     if (!image.load(file)) {
         ShowMsg(QString(tr("sky image file read error: %1")).arg(file));
         ShowLegend(NULL);
         return;
     }
-    SkyImageI = image;
-    SkyImageR = image;
-    w = MAX(SkyImageI.width(), SkyImageI.height());
-    h = MIN(SkyImageI.width(), SkyImageI.height());
-    wr = MIN(w, MAX_SKYIMG_R);
-    SkyImageR = QImage(wr, wr, QImage::Format_RGB32);
-    SkyImageFile = file;
-    SkySize[0] = SkyImageI.width();
-    SkySize[1] = SkyImageI.height();
-    SkyCent[0] = SkySize[0] / 2.0;
-    SkyCent[1] = SkySize[1] / 2.0;
-    SkyFov[0] = SkyFov[1] = SkyFov[2] = 0.0;
-    SkyScale = h / 2.0;
-    SkyScaleR = SkyScale * wr / w;
-    SkyDestCorr = SkyRes = SkyFlip = 0;
-    SkyElMask = 1;
-    for (i = 0; i < 10; i++) SkyDest[i] = 0.0;
-
-    ReadSkyTag(file + ".tag");
-
+    SkyImageI=image;
+    SkyImageR=image;
+    w=MAX(SkyImageI.width(),SkyImageI.height());
+    h=MIN(SkyImageI.width(),SkyImageI.height());
+    wr=MIN(w,MAX_SKYIMG_R);
+    SkyImageR=QImage(wr,wr,QImage::Format_RGB32);
+    SkyImageFile=file;
+    SkySize[0]=SkyImageI.width();
+    SkySize[1]=SkyImageI.height();
+    SkyCent[0]=SkySize[0]/2.0;
+    SkyCent[1]=SkySize[1]/2.0;
+    SkyFov[0]=SkyFov[1]=SkyFov[2]=0.0;
+    SkyScale=h/2.0;
+    SkyScaleR=SkyScale*wr/w;
+    SkyDestCorr=SkyRes=SkyFlip=0;
+    SkyElMask=1;
+    for (i=0;i<10;i++) SkyDest[i]=0.0;
+    
+    ReadSkyTag(file+".tag");
+    
     ShowMsg("");
     BtnShowImg->setChecked(true);
-
+    
     UpdateSky();
 }
 // read map tag data --------------------------------------------------------
 void Plot::ReadMapTag(const QString &file)
 {
-    QFile fp(file + ".tag");
+    QFile fp(file+".tag");
     QByteArray buff;
-
-    trace(3, "ReadMapTag\n");
-
+    
+    trace(3,"ReadMapTag\n");
+    
     if (!(fp.open(QIODevice::ReadOnly))) return;
-
-    MapScaleX = MapScaleY = 1.0;
-    MapScaleEq = 0;
-    MapLat = MapLon = 0.0;
-
+    
+    MapScaleX=MapScaleY=1.0;
+    MapScaleEq=0;
+    MapLat=MapLon=0.0;
+    
     while (!fp.atEnd()) {
-        buff = fp.readLine();
-        if (buff.at(0) == '\0' || buff.at(0) == '%' || buff.at(0) == '#') continue;
-        QList<QByteArray> tokens = buff.split('=');
-        if (tokens.size() < 2) continue;
+        buff=fp.readLine();
+        if (buff.at(0)=='\0'||buff.at(0)=='%'||buff.at(0)=='#') continue;
+        QList<QByteArray> tokens=buff.split('=');
+        if (tokens.size()<2) continue;
 
-        if (tokens.at(0) == "scalex") MapScaleX = tokens.at(1).toDouble();
-        else if (tokens.at(0) == "scaley") MapScaleY = tokens.at(1).toDouble();
-        else if (tokens.at(0) == "scaleeq") MapScaleEq = tokens.at(1).toInt();
-        else if (tokens.at(0) == "lat") MapLat = tokens.at(1).toDouble();
-        else if (tokens.at(0) == "lon") MapLon = tokens.at(1).toDouble();
+        if      (tokens.at(0)=="scalex")  MapScaleX=tokens.at(1).toDouble();
+        else if (tokens.at(0)=="scaley")  MapScaleY=tokens.at(1).toDouble();
+        else if (tokens.at(0)=="scaleeq") MapScaleEq=tokens.at(1).toInt();
+        else if (tokens.at(0)=="lat")     MapLat=tokens.at(1).toDouble();
+        else if (tokens.at(0)=="lon")     MapLon=tokens.at(1).toDouble();
     }
 }
 // read shapefile -----------------------------------------------------------
 void Plot::ReadShapeFile(const QStringList &files)
 {
     int i;
-    double pos[3];
     char path[1024];
-
+    
     ReadWaitStart();
-
+    
     gis_free(&Gis);
 
-    for (i = 0; i < files.count() && i < MAXMAPLAYER; i++) {
-        strcpy(path, qPrintable(files.at(i)));
-        ShowMsg(tr("reading shapefile... %1").arg(path));
-        gis_read(path, &Gis, i);
+    for (i=0;i<files.count()&&i<MAXMAPLAYER;i++) {
+        strcpy(path,qPrintable(files.at(i)));
+        ShowMsg(QString("reading shapefile... %1").arg(path));
+        gis_read(path,&Gis,i);
 
         QFileInfo fi(files.at(i));
 
-        strcpy(Gis.name[i], qPrintable(fi.baseName()));
+        strcpy(Gis.name[i],qPrintable(fi.baseName()));
     }
-
+    
     ReadWaitEnd();
     ShowMsg("");
     BtnShowMap->setChecked(true);
-
-    if (norm(OPos, 3) <= 0.0) {
-        pos[0] = (Gis.bound[0] + Gis.bound[1]) / 2.0;
-        pos[1] = (Gis.bound[2] + Gis.bound[3]) / 2.0;
-        pos[2] = 0.0;
-        pos2ecef(pos, OPos);
-    }
-
+    
     UpdateOrigin();
     UpdatePlot();
     UpdateEnable();
+
 }
 // read waypoint ------------------------------------------------------------
 void Plot::ReadWaypoint(const QString &file)
@@ -751,37 +728,40 @@
     QFile fp(file);
     QByteArray buff;
     QString name;
-    double pos[3] = { 0 };
+    double pos[3]={0};
 
-    if (!fp.open(QIODevice::ReadOnly | QIODevice::Text)) return;
+    if (!fp.open(QIODevice::ReadOnly|QIODevice::Text)) return;
 
     ReadWaitStart();
-    ShowMsg(tr("reading waypoint... %1").arg(file));
+    ShowMsg(QString("reading waypoint... %1").arg(file));
 
-    NWayPnt = 0;
+    NWayPnt=0;
 
     QXmlStreamReader inputStream(&fp);
-    while (!inputStream.atEnd() && !inputStream.hasError() && NWayPnt < MAXWAYPNT) {
+    while (!inputStream.atEnd() && !inputStream.hasError()&&NWayPnt<MAXWAYPNT)
+    {
         inputStream.readNext();
         if (inputStream.isStartElement()) {
             QString tag = inputStream.name().toString();
-            if (tag.toLower() == "wpt") {
-                pos[0] = inputStream.attributes().value("lat").toFloat();
-                pos[1] = inputStream.attributes().value("lon").toFloat();
-            } else if ((tag.toLower() == "ele") && norm(pos, 2) > 0.0) {
-                pos[2] = inputStream.text().toFloat();
-            } else if ((tag.toLower() == "name") && norm(pos, 3) > 0.0) {
+            if (tag.toLower() == "wpt")
+            {
+                pos[0]=inputStream.attributes().value("lat").toFloat();
+                pos[1]=inputStream.attributes().value("lon").toFloat();
+            } else if ((tag.toLower() == "ele")&&norm(pos,2)>0.0) {
+                pos[2]=inputStream.text().toFloat();
+            } else if ((tag.toLower() == "name")&&norm(pos,3)>0.0) {
                 inputStream.readNext();
-                name = inputStream.text().toString();
+                name=inputStream.text().toString();
             }
         } else if (inputStream.isEndElement()) {
             QString tag = inputStream.name().toString();
-            if (tag.toLower() == "wpt") {
-                PntPos[NWayPnt][0] = pos[0];
-                PntPos[NWayPnt][1] = pos[1];
-                PntPos[NWayPnt][2] = pos[2];
-                PntName[NWayPnt++] = name;
-                pos[0] = pos[1] = pos[2] = 0.0;
+            if (tag.toLower() == "wpt")
+            {
+                PntPos[NWayPnt][0]=pos[0];
+                PntPos[NWayPnt][1]=pos[1];
+                PntPos[NWayPnt][2]=pos[2];
+                PntName[NWayPnt++]=name;
+                pos[0]=pos[1]=pos[2]=0.0;
                 name.clear();
             }
         }
@@ -803,24 +783,25 @@
     QFile fp(file);
     int i;
 
-    if (!fp.open(QIODevice::WriteOnly | QIODevice::Text)) return;
+    if (!fp.open(QIODevice::WriteOnly|QIODevice::Text)) return;
     QXmlStreamWriter stream(&fp);
 
     stream.setAutoFormatting(true);
     stream.writeStartDocument("1.0");
 
     stream.writeStartElement("gpx");
-    stream.writeAttribute("version", "1.1");
-    stream.writeAttribute("creator", "RTKLIB");
-    stream.writeAttribute("xmlns", XMLNS);
+    stream.writeAttribute("version","1.1");
+    stream.writeAttribute("creator","RTKLIB");
+    stream.writeAttribute("xmlns",XMLNS);
 
-    for (i = 0; i < NWayPnt; i++) {
+    for (i=0;i<NWayPnt;i++) {
         stream.writeStartElement("wpt");
-        stream.writeAttribute("lat", QString::number(PntPos[i][0], 'f', 9));
-        stream.writeAttribute("lon", QString::number(PntPos[i][1], 'f', 9));
-        if (PntPos[i][2] != 0.0)
-            stream.writeTextElement("ele", QString::number(PntPos[i][2], 'f', 4));
-        stream.writeTextElement("name", PntName[i]);
+        stream.writeAttribute("lat",QString::number(PntPos[i][0],'f',9));
+        stream.writeAttribute("lon",QString::number(PntPos[i][1],'f',9));
+        if (PntPos[i][2]!=0.0) {
+            stream.writeTextElement("ele",QString::number(PntPos[i][2],'f',4));
+        }
+        stream.writeTextElement("name",PntName[i]);
         stream.writeEndElement();
     }
     stream.writeEndElement();
@@ -829,40 +810,39 @@
 }
 // read station position data -----------------------------------------------
 void Plot::ReadStaPos(const QString &file, const QString &sta,
-              double *rr)
+                                  double *rr)
 {
     QFile fp(file);
     QByteArray buff;
     QString code;
     double pos[3];
-    int sinex = 0;
-
+    int sinex=0;
+    
     if (!(fp.open(QIODevice::ReadOnly))) return;
 
     while (!fp.atEnd()) {
-        buff = fp.readLine();
-        if (buff.indexOf("%=SNX")) sinex = 1;
-        if (buff.at(0) == '%' || buff.at(1) == '#') continue;
+        buff=fp.readLine();
+        if (buff.indexOf("%=SNX")) sinex=1;
+        if (buff.at(0)=='%'||buff.at(1)=='#') continue;
         if (sinex) {
-            if ((buff.length() < 68) || (buff.mid(14, 4) != sta)) continue;
-            if (buff.mid(7, 4) == "STAX") rr[0] = buff.mid(47, 21).toDouble();
-            if (buff.mid(7, 4) == "STAY") rr[1] = buff.mid(47, 21).toDouble();
-            if (buff.mid(7, 4) == "STAZ") {
-                rr[2] = buff.mid(47, 21).toDouble(); break;
-            }
-            ;
-        } else {
-            QList<QByteArray> tokens = buff.split(' ');
-            if (tokens.size() < 4) continue;
-            for (int i = 0; i < 3; i++) pos[i] = tokens.at(i).toDouble();
-            for (int i = 3; i < tokens.size(); i++) code = tokens.at(i) + ' ';
-            code = code.simplified();
 
-            if (code != sta) continue;
+            if ((buff.length()<68)||(buff.mid(14,4)!=sta)) continue;
+            if (buff.mid(7,4)=="STAX") rr[0]=buff.mid(47,21).toDouble();
+            if (buff.mid(7,4)=="STAY") rr[1]=buff.mid(47,21).toDouble();
+            if (buff.mid(7,4)=="STAZ") {rr[2]=buff.mid(47,21).toDouble();break;};
+        }
+        else {
+            QList<QByteArray> tokens=buff.split(' ');
+            if (tokens.size()<4) continue;
+            for (int i=0;i<3;i++) pos[i]=tokens.at(i).toDouble();
+            for (int i=3;i<tokens.size();i++) code=tokens.at(i)+' ';
+            code.simplified();
 
-            pos[0] *= D2R;
-            pos[1] *= D2R;
-            pos2ecef(pos, rr);
+            if (code!=sta) continue;
+
+            pos[0]*=D2R;
+            pos[1]*=D2R;
+            pos2ecef(pos,rr);
             break;
         }
     }
@@ -873,48 +853,51 @@
     QFile fp(file);
     gtime_t time;
     QString data;
-    double azel[MAXOBS * 2], dop[4], tow;
-    int i, j, ns, week;
+    double azel[MAXOBS*2],dop[4],tow;
+    int i,j,ns,week;
     char tstr[64];
     QString tlabel;
-
-    trace(3, "SaveDop: file=%s\n", qPrintable(file));
-
+    
+    trace(3,"SaveDop: file=%s\n",qPrintable(file));
+    
     if (!(fp.open(QIODevice::WriteOnly))) return;
-
-    tlabel = TimeLabel <= 1 ? tr("TIME (GPST)") : (TimeLabel <= 2 ? tr("TIME (UTC)") : tr("TIME (JST))"));
-
-    data = QString(tr("%% %1 %2 %3 %4 %5 %6 (EL>=%7deg)\n"))
-           .arg(tlabel, TimeLabel == 0 ? 13 : 19).arg("NSAT", 6).arg("GDOP", 8).arg("PDOP", 8).arg("HDOP", 8).arg("VDOP", 8).arg(ElMask, 0, 'f', 0);
+    
+    tlabel=TimeLabel<=1?tr("TIME (GPST)"):(TimeLabel<=2?tr("TIME (UTC)"):tr("TIME (JST))"));
+    
+    data=QString(tr("%% %1 %2 %3 %4 %5 %6 (EL>=%7deg)\n"))
+            .arg(tlabel,TimeLabel==0?13:19).arg("NSAT",6).arg("GDOP",8).arg("PDOP",8).arg("HDOP",8).arg("VDOP",8).arg(ElMask,0,'f',0);
     fp.write(data.toLatin1());
 
-    for (i = 0; i < NObs; i++) {
-        ns = 0;
-        for (j = IndexObs[i]; j < Obs.n && j < IndexObs[i + 1]; j++) {
-            if (SatMask[Obs.data[j].sat - 1]) continue;
-            if (El[j] < ElMask * D2R) continue;
-            if (ElMaskP && El[j] < ElMaskData[static_cast<int>(Az[j] * R2D + 0.5)]) continue;
-            azel[ns * 2] = Az[j];
-            azel[1 + ns * 2] = El[j];
+    for (i=0;i<NObs;i++) {
+        ns=0;
+        for (j=IndexObs[i];j<Obs.n&&j<IndexObs[i+1];j++) {
+            if (SatMask[Obs.data[j].sat-1]) continue;
+            if (El[j]<ElMask*D2R) continue;
+            if (ElMaskP&&El[j]<ElMaskData[static_cast<int>(Az[j]*R2D+0.5)]) continue;
+            azel[  ns*2]=Az[j];
+            azel[1+ns*2]=El[j];
             ns++;
         }
-        if (ns <= 0) continue;
-
-        dops(ns, azel, ElMask * D2R, dop);
-
-        time = Obs.data[IndexObs[i]].time;
-        if (TimeLabel == 0) {
-            tow = time2gpst(time, &week);
-            sprintf(tstr, "%4d %8.1f ", week, tow);
-        } else if (TimeLabel == 1) {
-            time2str(time, tstr, 1);
-        } else if (TimeLabel == 2) {
-            time2str(gpst2utc(time), tstr, 1);
-        } else {
-            time2str(timeadd(gpst2utc(time), 9 * 3600.0), tstr, 1);
+        if (ns<=0) continue;
+        
+        dops(ns,azel,ElMask*D2R,dop);
+        
+        time=Obs.data[IndexObs[i]].time;
+        if (TimeLabel==0) {
+            tow=time2gpst(time,&week);
+            sprintf(tstr,"%4d %8.1f ",week,tow);
         }
-        data = QString("%1 %2 %3 %4 %5 %6\n").arg(tstr).arg(ns, 6).arg(dop[0], 8, 'f', 1).arg(dop[1], 8, 'f', 1)
-               .arg(dop[2], 8, 'f', 1).arg(dop[3], 8, 'f', 1);
+        else if (TimeLabel==1) {
+            time2str(time,tstr,1);
+        }
+        else if (TimeLabel==2) {
+            time2str(gpst2utc(time),tstr,1);
+        }
+        else {
+            time2str(timeadd(gpst2utc(time),9*3600.0),tstr,1);
+        }
+        data=QString("%1 %2 %3 %4 %5 %6\n").arg(tstr).arg(ns,6).arg(dop[0],8,'f',1).arg(dop[1],8,'f',1)
+                .arg(dop[2],8,'f',1).arg(dop[3],8,'f',1);
         fp.write(data.toLatin1());
     }
 }
@@ -922,51 +905,54 @@
 void Plot::SaveSnrMp(const QString &file)
 {
     QFile fp(file);
-    QString ObsTypeText = ObsType2->currentText();
+    QString ObsTypeText=ObsType2->currentText();
     gtime_t time;
     double tow;
-    char sat[32], tstr[64], code[64];
-    QString mp, data, tlabel;
-    int i, j, k, week;
-
-    strcpy(code, qPrintable(ObsTypeText.mid(1)));
-
-    trace(3, "SaveSnrMp: file=%s\n", qPrintable(file));
-
+    char sat[32],tstr[64],code[64];
+    QString mp,data,tlabel;
+    int i,j,k,week;
+    strcpy(code,qPrintable(ObsTypeText.mid(1)));
+    
+    trace(3,"SaveSnrMp: file=%s\n",qPrintable(file));
+    
     if (!(fp.open(QIODevice::WriteOnly))) return;
 
-    tlabel = TimeLabel <= 1 ? tr("TIME (GPST)") : (TimeLabel <= 2 ? tr("TIME (UTC)") : tr("TIME (JST)"));
-
-    mp = ObsTypeText + " MP(m)";
-    data = QString("%% %1 %2 %3 %4 %5 %6\n").arg(tlabel, TimeLabel == 0 ? 13 : 19).arg("SAT", 6)
-           .arg("AZ(deg)", 8).arg("EL(deg)", 8).arg("SNR(dBHz)", 9).arg(mp, 10);
+    tlabel=TimeLabel<=1?tr("TIME (GPST)"):(TimeLabel<=2?tr("TIME (UTC)"):tr("TIME (JST)"));
+    
+    mp=ObsTypeText +" MP(m)";
+    data=QString("%% %1 %2 %3 %4 %5 %6\n").arg(tlabel,TimeLabel==0?13:19).arg("SAT",6)
+            .arg("AZ(deg)",8).arg("EL(deg)",8).arg("SNR(dBHz)",9).arg(mp,10);
     fp.write(data.toLatin1());
 
-    for (i = 0; i < MAXSAT; i++) {
-        if (SatMask[i] || !SatSel[i]) continue;
-        satno2id(i + 1, sat);
-
-        for (j = 0; j < Obs.n; j++) {
-            if (Obs.data[j].sat != i + 1) continue;
-
-            for (k = 0; k < NFREQ + NEXOBS; k++)
-                if (strstr(code2obs(Obs.data[j].code[k], NULL), code)) break;
-            if (k >= NFREQ + NEXOBS) continue;
-
-            time = Obs.data[j].time;
-
-            if (TimeLabel == 0) {
-                tow = time2gpst(time, &week);
-                sprintf(tstr, "%4d %9.1f ", week, tow);
-            } else if (TimeLabel == 1) {
-                time2str(time, tstr, 1);
-            } else if (TimeLabel == 2) {
-                time2str(gpst2utc(time), tstr, 1);
-            } else {
-                time2str(timeadd(gpst2utc(time), 9 * 3600.0), tstr, 1);
+    for (i=0;i<MAXSAT;i++) {
+        if (SatMask[i]||!SatSel[i]) continue;
+        satno2id(i+1,sat);
+        
+        for (j=0;j<Obs.n;j++) {
+            if (Obs.data[j].sat!=i+1) continue;
+            
+            for (k=0;k<NFREQ+NEXOBS;k++) {
+                if (strstr(code2obs(Obs.data[j].code[k],NULL),code)) break;
             }
-            data = QString("%1 %2 %3 %4 %5 %6f\n").arg(tstr).arg(sat, 6).arg(Az[j] * R2D, 8, 'f', 1)
-                   .arg(El[j] * R2D, 8, 'f', 1).arg(Obs.data[j].SNR[k] * 0.25, 9, 'f', 2).arg(!Mp[k] ? 0.0 : Mp[k][j], 10, 'f', 4);
+            if (k>=NFREQ+NEXOBS) continue;
+            
+            time=Obs.data[j].time;
+            
+            if (TimeLabel==0) {
+                tow=time2gpst(time,&week);
+                sprintf(tstr,"%4d %9.1f ",week,tow);
+            }
+            else if (TimeLabel==1) {
+                time2str(time,tstr,1);
+            }
+            else if (TimeLabel==2) {
+                time2str(gpst2utc(time),tstr,1);
+            }
+            else {
+                time2str(timeadd(gpst2utc(time),9*3600.0),tstr,1);
+            }
+            data=QString("%1 %2 %3 %4 %5 %6f\n").arg(tstr).arg(sat,6).arg(Az[j]*R2D,8,'f',1)
+                    .arg(El[j]*R2D,8,'f',1).arg(Obs.data[j].SNR[k]*0.25,9,'f',2).arg(!Mp[k]?0.0:Mp[k][j],10,'f',4);
             fp.write(data.toLatin1());
         }
     }
@@ -976,81 +962,78 @@
 {
     QFile fp(file);
     QString data;
-    double el, el0 = 0.0;
+    double el,el0=0.0;
     int az;
-
-    trace(3, "SaveElMask: file=%s\n", qPrintable(file));
-
+    
+    trace(3,"SaveElMask: file=%s\n",qPrintable(file));
+    
     if (!(fp.open(QIODevice::WriteOnly))) return;
-
+    
     fp.write("%% Elevation Mask\n");
     fp.write("%% AZ(deg) EL(deg)\n");
-
-    for (az = 0; az <= 360; az++) {
-        el = floor(ElMaskData[az] * R2D / 0.1 + 0.5) * 0.1;
-        if (qFuzzyCompare(el, el0)) continue;
-        data = QString("%1 %2\n").arg(static_cast<double>(az), 9, 'f', 1).arg(el, 6, 'f', 1);
+    
+    for (az=0;az<=360;az++) {
+        el=floor(ElMaskData[az]*R2D/0.1+0.5)*0.1;
+        if (qFuzzyCompare(el,el0)) continue;
+        data=QString("%1 %2\n").arg(static_cast<double>(az),9,'f',1).arg(el,6,'f',1);
         fp.write(data.toLatin1());
-        el0 = el;
+        el0=el;
     }
 }
 // connect to external sources ----------------------------------------------
 void Plot::Connect(void)
 {
-    char cmd[1024], path[1024], buff[MAXSTRPATH], *name[2] = { 0, 0 }, *p;
-    int i, mode = STR_MODE_R;
-
-    trace(3, "Connect\n");
-
+    char cmd[1024],path[1024],buff[MAXSTRPATH],*name[2]={"",""},*p;
+    int i,mode=STR_MODE_R;
+    
+    trace(3,"Connect\n");
+    
     if (ConnectState) return;
-
-    for (i = 0; i < 2; i++) {
-        if (RtStream[i] == STR_NONE) continue;
-        else if (RtStream[i] == STR_SERIAL) strcpy(path, qPrintable(StrPaths[i][0]));
-        else if (RtStream[i] == STR_FILE) strcpy(path, qPrintable(StrPaths[i][2]));
-        else if (RtStream[i] <= STR_NTRIPCLI) strcpy(path, qPrintable(StrPaths[i][1]));
+    
+    for (i=0;i<2;i++) {
+        if      (RtStream[i]==STR_NONE    ) continue;
+        else if (RtStream[i]==STR_SERIAL  ) strcpy(path,qPrintable(StrPaths[i][0]));
+        else if (RtStream[i]==STR_FILE    ) strcpy(path,qPrintable(StrPaths[i][2]));
+        else if (RtStream[i]<=STR_NTRIPCLI) strcpy(path,qPrintable(StrPaths[i][1]));
         else continue;
-
-        if (RtStream[i] == STR_FILE || !SolData[i].cyclic || SolData[i].nmax != RtBuffSize + 1) {
+        
+        if (RtStream[i]==STR_FILE||!SolData[i].cyclic||SolData[i].nmax!=RtBuffSize+1) {
             Clear();
-            initsolbuf(SolData + i, 1, RtBuffSize + 1);
+            initsolbuf(SolData+i,1,RtBuffSize+1);
         }
-        if (RtStream[i] == STR_SERIAL) mode |= STR_MODE_W;
-
-        strcpy(buff, path);
-        if ((p = strstr(buff, "::"))) *p = '\0';
-        if ((p = strstr(buff, "/:"))) *p = '\0';
-        if ((p = strstr(buff, "@"))) name[i] = p + 1; else name[i] = buff;
-
-        if (!stropen(Stream + i, RtStream[i], mode, path)) {
-            ShowMsg(tr("connect error: %1").arg(name[0]));
+        if (RtStream[i]==STR_SERIAL) mode|=STR_MODE_W;
+        
+        strcpy(buff,path);
+        if ((p=strstr(buff,"::"))) *p='\0';
+        if ((p=strstr(buff,"/:"))) *p='\0';
+        if ((p=strstr(buff,"@"))) name[i]=p+1; else name[i]=buff;
+        
+        if (!stropen(Stream+i,RtStream[i],mode,path)) {
+            ShowMsg(QString(tr("connect error: %1")).arg(name[0]));
             ShowLegend(NULL);
-            trace(1, "stream open error: ch=%d type=%d path=%s\n", i + 1, RtStream[i], path);
+            trace(1,"stream open error: ch=%d type=%d path=%s\n",i+1,RtStream[i],path);
             continue;
         }
-        strsettimeout(Stream + i, RtTimeOutTime, RtReConnTime);
-
+        strsettimeout(Stream+i,RtTimeOutTime,RtReConnTime);
+        
         if (StrCmdEna[i][0]) {
-            strcpy(cmd, qPrintable(StrCmds[i][0]));
-            strwrite(Stream + i, (unsigned char *)cmd, strlen(cmd));
+            strcpy(cmd,qPrintable(StrCmds[i][0]));
+            strwrite(Stream+i,(unsigned char *)cmd,strlen(cmd));
         }
-        ConnectState = 1;
+        ConnectState=1;
     }
     if (!ConnectState) return;
-
-    if (Title != "") setWindowTitle(Title);
-    else setWindowTitle(tr("CONNECT %1 %2").arg(name[0]).arg(name[1]));
-
+    
+    if (Title!="") setWindowTitle(Title);
+    else setWindowTitle(QString(tr("CONNECT %1 %2")).arg(name[0]).arg(name[1]));
+    
     BtnConnect->setChecked(true);
-    BtnSol1->setChecked(name[0]);
-    BtnSol2->setChecked(name[1]);
-    BtnSol12->setChecked(false);
+    BtnSol1   ->setChecked(*name[0]);
+    BtnSol2   ->setChecked(*name[1]);
+    BtnSol12  ->setChecked(false);
     BtnShowTrack->setChecked(true);
     BtnFixHoriz->setChecked(true);
-
-    BtnReload->setVisible(false);
-    StrStatus->setVisible(true);
-
+    UpdateEnable();
     UpdateTime();
     UpdatePlot();
     UpdateEnable();
@@ -1060,31 +1043,29 @@
 {
     char cmd[1024];
     int i;
-
-    trace(3, "Disconnect\n");
-
+    
+    trace(3,"Disconnect\n");
+    
     if (!ConnectState) return;
-
-    ConnectState = 0;
-
-    for (i = 0; i < 2; i++) {
+    
+    ConnectState=0;
+    
+    for (i=0;i<2;i++) {
         if (StrCmdEna[i][1]) {
-            strcpy(cmd, qPrintable(StrCmds[i][1]));
-            strwrite(Stream + i, (unsigned char *)cmd, strlen(cmd));
+            strcpy(cmd,qPrintable(StrCmds[i][1]));
+            strwrite(Stream+i,(unsigned char *)cmd,strlen(cmd));
         }
-        strclose(Stream + i);
+        strclose(Stream+i);
     }
-
-    if (windowTitle().indexOf(tr("CONNECT")))
+    
+    if (windowTitle().indexOf(tr("CONNECT"))) {
         setWindowTitle(QString(tr("DISCONNECT%1")).arg(windowTitle().mid(7)));
+    }
 
     StrStatus1->setStyleSheet(QStringLiteral("QLabel {color: gray;}"));
     StrStatus2->setStyleSheet(QStringLiteral("QLabel {color: gray;}"));
     ConnectMsg->setText("");
 
-    BtnReload->setVisible(true);
-    StrStatus->setVisible(false);
-
     UpdateTime();
     UpdatePlot();
     UpdateEnable();
@@ -1092,281 +1073,294 @@
 // check observation data types ---------------------------------------------
 int Plot::CheckObs(const QString &file)
 {
+    
     if (!file.indexOf('.')) return 0;
-    int p = file.lastIndexOf('.');
-    if (file.indexOf(".z") || file.indexOf(".gz") || file.indexOf(".zip") ||
-        file.indexOf(".Z") || file.indexOf(".GZ") || file.indexOf(".ZIP"))
-        return file.at(p - 1) == 'o' || file.at(p - 1) == 'O' || file.at(p - 1) == 'd' || file.at(p - 1) == 'D';
-    return file.indexOf(".obs") || file.indexOf(".OBS") ||
-           file.mid(p + 3) == "o" || file.mid(p + 3) == "O" ||
-           file.mid(p + 3) == "d" || file.mid(p + 3) == "D";
+    int p=file.lastIndexOf('.');
+    if (file.indexOf(".z")||file.indexOf(".gz")||file.indexOf(".zip")||
+        file.indexOf(".Z")||file.indexOf(".GZ")||file.indexOf(".ZIP")) {
+        return file.at(p-1)=='o'||file.at(p-1)=='O'||file.at(p-1)=='d'||file.at(p-1)=='D';
+    }
+    return file.indexOf(".obs")||file.indexOf(".OBS")||
+           file.mid(p+3)=="o" ||file.mid(p+3)=="O"||
+           file.mid(p+3)=="d" ||file.mid(p+3)=="D" ;
 }
 // update observation data index, azimuth/elevation, satellite list ---------
 void Plot::UpdateObs(int nobs)
 {
-    prcopt_t opt = prcopt_default;
+    prcopt_t opt=prcopt_default;
     gtime_t time;
     sol_t sol;
-    double pos[3], rr[3], e[3], azel[MAXOBS * 2] = { 0 }, rs[6], dts[2], var;
-    int i, j, k, svh, per, per_ = -1;
-    char msg[128], name[16];
-
-    trace(3, "UpdateObs\n");
-
-    memset(&sol, 0, sizeof(sol_t));
-
-    delete [] IndexObs; IndexObs = NULL;
-    delete [] Az; Az = NULL;
-    delete [] El; El = NULL;
-    NObs = 0;
-    if (nobs <= 0) return;
-
-    IndexObs = new int[nobs + 1];
-    Az = new double[Obs.n];
-    El = new double[Obs.n];
-
-    opt.err[0] = 900.0;
+    double pos[3],rr[3],e[3],azel[MAXOBS*2]={0},rs[6],dts[2],var;
+    int i,j,k,svh,per,per_=-1;
+    char msg[128],name[16];
+    
+    trace(3,"UpdateObs\n");
+    
+    memset(&sol,0,sizeof(sol_t));
 
+    delete [] IndexObs; IndexObs=NULL;
+    delete [] Az; Az=NULL;
+    delete [] El; El=NULL;
+    NObs=0;
+    if (nobs<=0) return;
+    
+    IndexObs=new int[nobs+1];
+    Az=new double[Obs.n];
+    El=new double[Obs.n];
+    
+    opt.err[0]=900.0;
+    
     ReadWaitStart();
     ShowLegend(NULL);
-
-    for (i = 0; i < Obs.n; i = j) {
-        time = Obs.data[i].time;
-        for (j = i; j < Obs.n; j++)
-            if (timediff(Obs.data[j].time, time) > TTOL) break;
-        IndexObs[NObs++] = i;
-
-        for (k = 0; k < j - i; k++)
-            azel[k * 2] = azel[1 + k * 2] = 0.0;
-        if (RcvPos == 0) {
-            pntpos(Obs.data + i, j - i, &Nav, &opt, &sol, azel, NULL, msg);
-            matcpy(rr, sol.rr, 3, 1);
-            ecef2pos(rr, pos);
-        } else {
-            if (RcvPos == 1) { // lat/lon/height
-                for (k = 0; k < 3; k++) pos[k] = OOPos[k];
-                pos2ecef(pos, rr);
-            } else { // rinex header position
-                for (k = 0; k < 3; k++) rr[k] = Sta.pos[k];
-                ecef2pos(rr, pos);
+    
+    for (i=0;i<Obs.n;i=j) {
+        time=Obs.data[i].time;
+        for (j=i;j<Obs.n;j++) {
+            if (timediff(Obs.data[j].time,time)>TTOL) break;
+        }
+        IndexObs[NObs++]=i;
+        
+        for (k=0;k<j-i;k++) {
+            azel[k*2]=azel[1+k*2]=0.0;
+        }
+        if (RcvPos==0) {
+            pntpos(Obs.data+i,j-i,&Nav,&opt,&sol,azel,NULL,msg);
+            matcpy(rr,sol.rr,3,1);
+            ecef2pos(rr,pos);
+        }
+        else {
+            if (RcvPos==1) { // lat/lon/height
+                for (k=0;k<3;k++) pos[k]=OOPos[k];
+                pos2ecef(pos,rr);
             }
-            for (k = 0; k < j - i; k++) {
-                azel[k * 2] = azel[1 + k * 2] = 0.0;
-                if (!satpos(time, time, Obs.data[i + k].sat, EPHOPT_BRDC, &Nav, rs, dts,
-                        &var, &svh)) continue;
-                if (geodist(rs, rr, e) > 0.0) satazel(pos, e, azel + k * 2);
+            else { // rinex header position
+                for (k=0;k<3;k++) rr[k]=Sta.pos[k];
+                ecef2pos(rr,pos);
+            }
+            for (k=0;k<j-i;k++) {
+                azel[k*2]=azel[1+k*2]=0.0;
+                if (!satpos(time,time,Obs.data[i+k].sat,EPHOPT_BRDC,&Nav,rs,dts,
+                            &var,&svh)) continue;
+                if (geodist(rs,rr,e)>0.0) satazel(pos,e,azel+k*2);
             }
         }
         // satellite azel by tle data
-        for (k = 0; k < j - i; k++) {
-            if (azel[k * 2] != 0.0 || azel[1 + k * 2] != 0.0) continue;
-            satno2id(Obs.data[i + k].sat, name);
-            if (!tle_pos(time, name, "", "", &TLEData, NULL, rs)) continue;
-            if (geodist(rs, rr, e) > 0.0) satazel(pos, e, azel + k * 2);
+        for (k=0;k<j-i;k++) {
+            if (azel[k*2]!=0.0||azel[1+k*2]!=0.0) continue;
+            satno2id(Obs.data[i+k].sat,name);
+            if (!tle_pos(time,name,"","",&TLEData,NULL,rs)) continue;
+            if (geodist(rs,rr,e)>0.0) satazel(pos,e,azel+k*2);
         }
-        for (k = 0; k < j - i; k++) {
-            Az[i + k] = azel[k * 2];
-            El[i + k] = azel[1 + k * 2];
-            if (Az[i + k] < 0.0) Az[i + k] += 2.0 * PI;
+        for (k=0;k<j-i;k++) {
+            Az[i+k]=azel[  k*2];
+            El[i+k]=azel[1+k*2];
+            if (Az[i+k]<0.0) Az[i+k]+=2.0*PI;
         }
-        per = (i + 1) * 100 / Obs.n;
-        if (per != per_) {
-            ShowMsg(tr("updating azimuth/elevation... (%1%)").arg(per_ = per));
+        per=(i+1)*100/Obs.n;
+        if (per!=per_) {
+            ShowMsg(QString(tr("updating azimuth/elevation... (%1%)")).arg(per_=per));
             qApp->processEvents();
         }
     }
-    IndexObs[NObs] = Obs.n;
-
+    IndexObs[NObs]=Obs.n;
+    
     UpdateSatList();
-
+    
     ReadWaitEnd();
 }
 // update Multipath ------------------------------------------------------------
 void Plot::UpdateMp(void)
 {
     obsd_t *data;
-    double lam1, lam2, I, C, B;
-    int i, j, k, f1, f2, sat, sys, per, per_ = -1, n;
-
-    trace(3, "UpdateMp\n");
-
-    for (i = 0; i < NFREQ + NEXOBS; i++) {
-        delete [] Mp[i]; Mp[i] = NULL;
+    double lam1,lam2,I,C,B;
+    int i,j,k,f1,f2,sat,sys,per,per_=-1,n;
+    
+    trace(3,"UpdateMp\n");
+    
+    for (i=0;i<NFREQ+NEXOBS;i++) {
+        delete [] Mp[i]; Mp[i]=NULL;
+    }
+    if (Obs.n<=0) return;
+    
+    for (i=0;i<NFREQ+NEXOBS;i++) {
+        Mp[i]=new double[Obs.n];
     }
-    if (Obs.n <= 0) return;
-
-    for (i = 0; i < NFREQ + NEXOBS; i++)
-        Mp[i] = new double[Obs.n];
     ReadWaitStart();
     ShowLegend(NULL);
-
-    for (i = 0; i < Obs.n; i++) {
-        data = Obs.data + i;
-        sys = satsys(data->sat, NULL);
-
-        for (j = 0; j < NFREQ + NEXOBS; j++) {
-            Mp[j][i] = 0.0;
-
-            code2obs(data->code[j], &f1);
-
-            if (sys == SYS_CMP) {
-                if (f1 == 5) f1 = 2;                    /* B2 */
-                else if (f1 == 4) f1 = 3;               /* B3 */
+    
+    for (i=0;i<Obs.n;i++) {
+        data=Obs.data+i;
+        sys=satsys(data->sat,NULL);
+        
+        for (j=0;j<NFREQ+NEXOBS;j++) {
+            Mp[j][i]=0.0;
+            
+            code2obs(data->code[j],&f1);
+            
+            if (sys==SYS_CMP) {
+                if      (f1==5) f1=2; /* B2 */
+                else if (f1==4) f1=3; /* B3 */
             }
-            if (sys == SYS_GAL) f2 = f1 == 1 ? 3 : 1;       /* E1/E5a */
-            else if (sys == SYS_SBS) f2 = f1 == 1 ? 3 : 1;  /* L1/L5 */
-            else if (sys == SYS_CMP) f2 = f1 == 1 ? 2 : 1;  /* B1/B2 */
-            else f2 = f1 == 1 ? 2 : 1;                      /* L1/L2 */
-
-            lam1 = satwavelen(data->sat, f1 - 1, &Nav);
-            lam2 = satwavelen(data->sat, f2 - 1, &Nav);
-            if (lam1 == 0.0 || lam2 == 0.0) continue;
-
-            if (data->P[j] != 0.0 && data->L[j] != 0.0 && data->L[f2 - 1] != 0.0) {
-                C = SQR(lam1) / (SQR(lam1) - SQR(lam2));
-                I = lam1 * data->L[j] - lam2 * data->L[f2 - 1];
-                Mp[j][i] = data->P[j] - lam1 * data->L[j] + 2.0 * C * I;
+            if      (sys==SYS_GAL) f2=f1==1?3:1; /* E1/E5a */
+            else if (sys==SYS_SBS) f2=f1==1?3:1; /* L1/L5 */
+            else if (sys==SYS_CMP) f2=f1==1?2:1; /* B1/B2 */
+            else                   f2=f1==1?2:1; /* L1/L2 */
+            
+            lam1=satwavelen(data->sat,f1-1,&Nav);
+            lam2=satwavelen(data->sat,f2-1,&Nav);
+            if (lam1==0.0||lam2==0.0) continue;
+            
+            if (data->P[j]!=0.0&&data->L[j]!=0.0&&data->L[f2-1]!=0.0) {
+                C=SQR(lam1)/(SQR(lam1)-SQR(lam2));
+                I=lam1*data->L[j]-lam2*data->L[f2-1];
+                Mp[j][i]=data->P[j]-lam1*data->L[j]+2.0*C*I;
             }
         }
     }
-    for (sat = 1; sat <= MAXSAT; sat++) for (i = 0; i < NFREQ + NEXOBS; i++) {
-            sys = satsys(sat, NULL);
-
-            for (j = k = n = 0, B = 0.0; j < Obs.n; j++) {
-                if (Obs.data[j].sat != sat) continue;
-
-                code2obs(Obs.data[j].code[i], &f1);
-
-                if (sys == SYS_CMP) {
-                    if (f1 == 5) f1 = 2;            /* B2 */
-                    else if (f1 == 4) f1 = 3;       /* B3 */
-                }
-                if (sys == SYS_GAL) f2 = f1 == 1 ? 3 : 1;
-                else if (sys == SYS_CMP) f2 = f1 == 1 ? 2 : 1;
-                else f2 = f1 == 1 ? 2 : 1;
-
-                if ((Obs.data[j].LLI[i] & 1) || (Obs.data[j].LLI[f2 - 1] & 1) ||
-                    fabs(Mp[i][j] - B) > THRES_SLIP) {
-                    for (; k < j; k++) if (Obs.data[k].sat == sat) Mp[i][k] -= B;
-                    B = Mp[i][j]; n = 1; k = j;
-                } else {
-                    if (n == 0) k = j;
-                    B += (Mp[i][j] - B) / ++n;
-                }
+    for (sat=1;sat<=MAXSAT;sat++) for (i=0;i<NFREQ+NEXOBS;i++) {
+        sys=satsys(sat,NULL);
+        
+        for (j=k=n=0,B=0.0;j<Obs.n;j++) {
+            if (Obs.data[j].sat!=sat) continue;
+            
+            code2obs(Obs.data[j].code[i],&f1);
+            
+            if (sys==SYS_CMP) {
+                if      (f1==5) f1=2; /* B2 */
+                else if (f1==4) f1=3; /* B3 */
             }
-            if (n > 0)
-                for (; k < j; k++) if (Obs.data[k].sat == sat) Mp[i][k] -= B;
-            per = sat * 100 / MAXSAT;
-            if (per != per_) {
-                ShowMsg(tr("updating multipath... (%1%)").arg(per));
-                per_ = per;
-                qApp->processEvents();
+            if      (sys==SYS_GAL) f2=f1==1?3:1;
+            else if (sys==SYS_CMP) f2=f1==1?2:1;
+            else                   f2=f1==1?2:1;
+            
+            if ((Obs.data[j].LLI[i]&1)||(Obs.data[j].LLI[f2-1]&1)||
+                fabs(Mp[i][j]-B)>THRES_SLIP) {
+                
+                for (;k<j;k++) if (Obs.data[k].sat==sat) Mp[i][k]-=B;
+                B=Mp[i][j]; n=1; k=j;
             }
+            else {
+                if (n==0) k=j;
+                B+=(Mp[i][j]-B)/++n;
+            }
+        }
+        if (n>0) {
+            for (;k<j;k++) if (Obs.data[k].sat==sat) Mp[i][k]-=B;
+        }
+        per=sat*100/MAXSAT;
+        if (per!=per_) {
+            ShowMsg(QString(tr("updating multipath... (%1%)")).arg(per));
+            per_=per;
+            qApp->processEvents();
         }
+    }
     ReadWaitEnd();
 }
 // set connect path ---------------------------------------------------------
 void Plot::ConnectPath(const QString &path, int ch)
 {
-    trace(3, "ConnectPath: path=%s ch=%d\n", qPrintable(path), ch);
-
-    RtStream[ch] = STR_NONE;
-
+    trace(3,"ConnectPath: path=%s ch=%d\n",qPrintable(path),ch);
+    
+    RtStream[ch]=STR_NONE;
+    
     if (!path.indexOf("://")) return;
-    if (path.indexOf("serial") != -1) RtStream[ch] = STR_SERIAL;
-    else if (path.indexOf("tcpsvr") != -1) RtStream[ch] = STR_TCPSVR;
-    else if (path.indexOf("tcpcli") != -1) RtStream[ch] = STR_TCPCLI;
-    else if (path.indexOf("ntrip") != -1) RtStream[ch] = STR_NTRIPCLI;
-    else if (path.indexOf("file") != -1) RtStream[ch] = STR_FILE;
+    if      (path.indexOf("serial")!=-1) RtStream[ch]=STR_SERIAL;
+    else if (path.indexOf("tcpsvr")!=-1) RtStream[ch]=STR_TCPSVR;
+    else if (path.indexOf("tcpcli")!=-1) RtStream[ch]=STR_TCPCLI;
+    else if (path.indexOf("ntrip" )!=-1) RtStream[ch]=STR_NTRIPCLI;
+    else if (path.indexOf("file"  )!=-1) RtStream[ch]=STR_FILE;
     else return;
-
-    StrPaths[ch][1] = path.mid(path.indexOf("://") + 3);
-    RtFormat[ch] = SOLF_LLH;
-    RtTimeForm = 0;
-    RtDegForm = 0;
-    RtFieldSep = " ";
-    RtTimeOutTime = 0;
-    RtReConnTime = 10000;
-
+    
+    StrPaths[ch][1]=path.mid(path.indexOf("://")+3);
+    RtFormat[ch]=SOLF_LLH;
+    RtTimeForm=0;
+    RtDegForm =0;
+    RtFieldSep=" ";
+    RtTimeOutTime=0;
+    RtReConnTime =10000;
+    
     BtnShowTrack->setChecked(true);
-    BtnFixHoriz->setChecked(true);
-    BtnFixVert->setChecked(true);
+    BtnFixHoriz ->setChecked(true);
+    BtnFixVert  ->setChecked(true);
 }
 // clear obs data --------------------------------------------------------------
 void Plot::ClearObs(void)
 {
     sta_t sta0;
     int i;
-
-    memset(&sta0, 0, sizeof(sta_t));
+    
+    memset(&sta0,0,sizeof(sta_t));
 
     freeobs(&Obs);
-    freenav(&Nav, 0xFF);
-    delete [] IndexObs; IndexObs = NULL;
-    delete [] Az; Az = NULL;
-    delete [] El; El = NULL;
-    for (i = 0; i < NFREQ + NEXOBS; i++) {
-        delete [] Mp[i]; Mp[i] = NULL;
+    freenav(&Nav,0xFF);
+    delete [] IndexObs; IndexObs=NULL;
+    delete [] Az; Az=NULL;
+    delete [] El; El=NULL;
+    for (i=0;i<NFREQ+NEXOBS;i++) {
+        delete [] Mp[i]; Mp[i]=NULL;
     }
     ObsFiles.clear();
     NavFiles.clear();
-    NObs = 0;
-    Sta = sta0;
-    ObsIndex = 0;
-    SimObs = 0;
+    NObs=0;
+    Sta=sta0;
+    ObsIndex=0;
+    SimObs=0;
 }
 // clear solution --------------------------------------------------------------
 void Plot::ClearSol(void)
 {
     int i;
-
-    for (i = 0; i < 2; i++) {
-        freesolbuf(SolData + i);
+    
+    for (i=0;i<2;i++) {
+        freesolbuf(SolData+i);
         free(SolStat[i].data);
-        SolStat[i].n = 0;
-        SolStat[i].data = NULL;
+        SolStat[i].n=0;
+        SolStat[i].data=NULL;
     }
     SolFiles[0].clear();
     SolFiles[1].clear();
-    SolIndex[0] = SolIndex[1] = 0;
+    SolIndex[0]=SolIndex[1]=0;
 }
 // clear data ------------------------------------------------------------------
 void Plot::Clear(void)
 {
-    double ep[] = { 2010, 1, 1, 0, 0, 0 };
+    double ep[]={2010,1,1,0,0,0};
     int i;
-
-    trace(3, "Clear\n");
-
-    Week = 0;
-
+    
+    trace(3,"Clear\n");
+    
+    Week=0;
+    
     ClearObs();
     ClearSol();
     gis_free(&Gis);
+    
+    MapImage=QImage();
+    MapImageFile="";
+    MapSize[0]=MapSize[1]=0;
 
-    MapImage = QImage();
-    MapImageFile = "";
-    MapSize[0] = MapSize[1] = 0;
-
-    for (i = 0; i < 3; i++)
-        TimeEna[i] = 0;
-    TimeStart = TimeEnd = epoch2time(ep);
+    for (i=0;i<3;i++) {
+        TimeEna[i]=0;
+    }
+    TimeStart=TimeEnd=epoch2time(ep);
     BtnAnimate->setChecked(false);
-
-    if (PlotType > PLOT_NSAT)
+    
+    if (PlotType>PLOT_NSAT) {
         UpdateType(PLOT_TRK);
+    }
     if (!ConnectState) {
-        initsolbuf(SolData, 0, 0);
-        initsolbuf(SolData + 1, 0, 0);
-        setWindowTitle(Title != "" ? Title : tr("%1 ver.%2 %3").arg(PRGNAME).arg(VER_RTKLIB).arg(PATCH_LEVEL));
-    } else {
-        initsolbuf(SolData, 1, RtBuffSize + 1);
-        initsolbuf(SolData + 1, 1, RtBuffSize + 1);
+        initsolbuf(SolData  ,0,0);
+        initsolbuf(SolData+1,0,0);
+        setWindowTitle(Title!=""?Title:QString(tr("%1 ver.%2 %3")).arg(PRGNAME).arg(VER_RTKLIB).arg(PATCH_LEVEL));
+    }
+    else {
+        initsolbuf(SolData  ,1,RtBuffSize+1);
+        initsolbuf(SolData+1,1,RtBuffSize+1);
     }
     googleEarthView->Clear();
-
-    for (i = 0; i <= 360; i++) ElMaskData[i] = 0.0;
-
+    
+    for (i=0;i<=360;i++) ElMaskData[i]=0.0;
+    
     UpdateTime();
     UpdatePlot();
     UpdateEnable();
@@ -1374,21 +1368,22 @@
 // reload data --------------------------------------------------------------
 void Plot::Reload(void)
 {
-    QStringList obsfiles, navfiles;
-
-    trace(3, "Reload\n");
-
+    QStringList obsfiles,navfiles;
+    
+    trace(3,"Reload\n");
+    
     if (SimObs) {
         GenVisData();
         return;
     }
-    obsfiles = ObsFiles;
-    navfiles = NavFiles;
-
+    obsfiles=ObsFiles;
+    navfiles=NavFiles;
+    
     ReadObs(obsfiles);
     ReadNav(navfiles);
-    ReadSol(SolFiles[0], 0);
-    ReadSol(SolFiles[1], 1);
+    ReadSol(SolFiles[0],0);
+    ReadSol(SolFiles[1],1);
+    
 }
 // read wait start ----------------------------------------------------------
 void Plot::ReadWaitStart(void)
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotdraw.cpp RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotdraw.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotdraw.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotdraw.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -3,7 +3,6 @@
 //---------------------------------------------------------------------------
 #include <QColor>
 #include <QPainter>
-#include <QDebug>
 
 #include "rtklib.h"
 #include "plotmain.h"
@@ -13,34 +12,34 @@
 #include "gmview.h"
 
 #define COL_ELMASK  Qt::red
-#define ATAN2(x, y)  ((x) * (x) + (y) * (y) > 1E-12 ? atan2(x, y) : 0.0)
+#define ATAN2(x,y)  ((x)*(x)+(y)*(y)>1E-12?atan2(x,y):0.0)
 
 // update plot --------------------------------------------------------------
 void Plot::UpdatePlot(void)
 {
-    trace(3, "UpdatePlot\n");
-
+    trace(3,"UpdatePlot\n");
+    
     UpdateInfo();
     Refresh();
 }
 // refresh plot -------------------------------------------------------------
 void Plot::Refresh(void)
 {
-    trace(3, "Refresh\n");
-
-    Flush = 1;
+    trace(3,"Refresh\n");
+    
+    Flush=1;
     UpdateDisp();
     Disp->update();
 }
 // draw plot ----------------------------------------------------------------
 void Plot::UpdateDisp(void)
 {
-    int level = Drag ? 0 : 1;
-
-    trace(3, "UpdateDisp\n");
-
+    int level=Drag?0:1;
+    
+    trace(3,"UpdateDisp\n");
+    
     if (Flush) {
-        Buff = QPixmap(Disp->size());
+        Buff=QPixmap(Disp->size());
         if (Buff.isNull()) return;
         Buff.fill(CColor[0]);
 
@@ -51,1931 +50,1877 @@
         c.setBrush(CColor[0]);
 
         switch (PlotType) {
-            case  PLOT_TRK: DrawTrk(c, level);   break;
-            case  PLOT_SOLP: DrawSol(c, level, 0); break;
-            case  PLOT_SOLV: DrawSol(c, level, 1); break;
-            case  PLOT_SOLA: DrawSol(c, level, 2); break;
-            case  PLOT_NSAT: DrawNsat(c, level);   break;
-            case  PLOT_OBS: DrawObs(c, level);   break;
-            case  PLOT_SKY: DrawSky(c, level);   break;
-            case  PLOT_DOP: DrawDop(c, level);   break;
-            case  PLOT_RES: DrawRes(c, level);   break;
-            case  PLOT_SNR: DrawSnr(c, level);   break;
-            case  PLOT_SNRE: DrawSnrE(c, level);   break;
-            case  PLOT_MPS: DrawMpS(c, level);   break;
+            case  PLOT_TRK : DrawTrk (c,level);   break;
+            case  PLOT_SOLP: DrawSol (c,level,0); break;
+            case  PLOT_SOLV: DrawSol (c,level,1); break;
+            case  PLOT_SOLA: DrawSol (c,level,2); break;
+            case  PLOT_NSAT: DrawNsat(c,level);   break;
+            case  PLOT_OBS : DrawObs (c,level);   break;
+            case  PLOT_SKY : DrawSky (c,level);   break;
+            case  PLOT_DOP : DrawDop (c,level);   break;
+            case  PLOT_RES : DrawRes (c,level);   break;
+            case  PLOT_SNR : DrawSnr (c,level);   break;
+            case  PLOT_SNRE: DrawSnrE(c,level);   break;
+            case  PLOT_MPS : DrawMpS (c,level);   break;
         }
 
         Disp->setPixmap(Buff);
-
     }
 
-    Flush = 0;
+    Flush=0;
 }
 // draw track-plot ----------------------------------------------------------
-void Plot::DrawTrk(QPainter &c, int level)
+void Plot::DrawTrk(QPainter &c,int level)
 {
-    QString label, header;
-    TIMEPOS *pos, *pos1, *pos2, *vel;
-    gtime_t time1 = { 0, 0 }, time2 = { 0, 0 };
+    QString label,header;
+    TIMEPOS *pos,*pos1,*pos2,*vel;
+    gtime_t time1={0,0},time2={0,0};
     sol_t *sol;
-    QPoint p1, p2;
-    double xt, yt, sx, sy, opos[3], pnt[3], rr[3], enu[3]={}, cent[3];
-    int i, sel = !BtnSol1->isChecked() && BtnSol2->isChecked() ? 1 : 0, p = 0;
-
-    trace(3, "DrawTrk: level=%d\n", level);
-
-    if (BtnShowTrack->isChecked() && BtnFixCent->isChecked()) {
+    QPoint p1,p2;
+    double xt,yt,sx,sy,opos[3],pnt[3],rr[3],enu[3],cent[3];
+    int i,sel=!BtnSol1->isChecked()&&BtnSol2->isChecked()?1:0,p=0;
+    
+    trace(3,"DrawTrk: level=%d\n",level);
+    
+    if (BtnShowTrack->isChecked()&&BtnFixCent->isChecked()) {
         if (!BtnSol12->isChecked()) {
-            pos = SolToPos(SolData + sel, SolIndex[sel], 0, 0);
-
-            if (pos->n > 0) GraphT->SetCent(pos->x[0], pos->y[0]);
-
+            pos=SolToPos(SolData+sel,SolIndex[sel],0,0);
+            if (pos->n>0) GraphT->SetCent(pos->x[0],pos->y[0]);
             delete pos;
-        } else {
-            pos1 = SolToPos(SolData, SolIndex[0], 0, 0);
-            pos2 = SolToPos(SolData + 1, SolIndex[1], 0, 0);
-            pos = pos1->diff(pos2, 0);
-
-            if (pos->n > 0) GraphT->SetCent(pos->x[0], pos->y[0]);
-
+        }
+        else {
+            pos1=SolToPos(SolData  ,SolIndex[0],0,0);
+            pos2=SolToPos(SolData+1,SolIndex[1],0,0);
+            pos=pos1->diff(pos2,0);
+            if (pos->n>0) GraphT->SetCent(pos->x[0],pos->y[0]);
             delete pos;
             delete pos1;
             delete pos2;
         }
     }
-    if (!BtnSol12->isChecked() && BtnShowImg->isChecked())  // image
-        DrawTrkImage(c, level);
-
-    if (BtnShowMap->isChecked())                            // map
-        DrawTrkMap(c, level);
-
-    if (BtnShowGrid->isChecked()) { // grid
-        if (level) { // center +
-            GraphT->GetPos(p1, p2);
-            p1.setX((p1.x() + p2.x()) / 2);
-            p1.setY((p1.y() + p2.y()) / 2);
-            DrawMark(GraphT, c, p1, 5, CColor[1], 20, 0);
-        }
-        if (ShowGLabel >= 3) { // circles
-            GraphT->XLPos = 7; GraphT->YLPos = 7;
-            GraphT->DrawCircles(c, ShowGLabel == 4);
-        }
-        else if (ShowGLabel >= 1) { // grid
-            GraphT->XLPos = 2; GraphT->YLPos = 4;
-            GraphT->DrawAxis(c, ShowLabel, ShowGLabel == 2);
-        }
+    if (!BtnSol12->isChecked()&&BtnShowImg->isChecked()) {// image
+        DrawTrkImage(c,level);
     }
-
-    if (norm(OPos, 3) > 0.0) {
-        ecef2pos(OPos, opos);
-        header = "ORI=" + LatLonStr(opos, 9) + QString(" %1m").arg(opos[2], 0, 'f', 4);
+    if (BtnShowMap->isChecked()) {// map
+        DrawTrkMap(c,level);
+    }
+    if (level) { // center +
+        GraphT->GetPos(p1,p2);
+        p1.rx()=(p1.x()+p2.x())/2;
+        p1.ry()=(p1.y()+p2.y())/2;
+        DrawMark(GraphT,c,p1,5,CColor[1],20,0);
+    }
+    if (ShowGLabel>=3) {// circles
+        GraphT->XLPos=7; GraphT->YLPos=7;
+        GraphT->DrawCircles(c,ShowGLabel==4);
+    }
+    else if (ShowGLabel>=1) {// grid
+        GraphT->XLPos=2; GraphT->YLPos=4;
+        GraphT->DrawAxis(c,ShowLabel,ShowGLabel==2);
     }
 
+    if (norm(OPos,3)>0.0) {
+        ecef2pos(OPos,opos);
+        header="ORI="+LatLonStr(opos,9)+QString(" %1m").arg(opos[2],0,'f',4);
+    }
     if (BtnSol1->isChecked()) {
-        pos = SolToPos(SolData, -1, QFlag->currentIndex(), 0);
-        DrawTrkPnt(c, pos, level, 0);
-        if (BtnShowMap->isChecked() && norm(SolData[0].rb, 3) > 1E-3)
-            DrawTrkPos(c, SolData[0].rb, 0, 8, CColor[2], tr("Base Station 1"));
-        DrawTrkStat(c, pos, header, p++);
-        header = "";
+        pos=SolToPos(SolData,-1,QFlag->currentIndex(),0);
+        DrawTrkPnt(c,pos,level,0);
+        if (BtnShowMap->isChecked()) {
+            DrawTrkPos(c,SolData[0].rb,0,8,CColor[2],tr("Base Station 1"));
+        }
+        DrawTrkStat(c,pos,header,p++);
+        header="";
         delete pos;
     }
-
-    if (BtnSol2->isChecked() && norm(SolData[1].rb, 3) > 1E-3) {
-        pos = SolToPos(SolData + 1, -1, QFlag->currentIndex(), 0);
-        DrawTrkPnt(c, pos, level, 1);
-        if (BtnShowMap->isChecked())
-            DrawTrkPos(c, SolData[1].rb, 0, 8, CColor[2], tr("Base Station 2"));
-        DrawTrkStat(c, pos, header, p++);
+    if (BtnSol2->isChecked()) {
+        pos=SolToPos(SolData+1,-1,QFlag->currentIndex(),0);
+        DrawTrkPnt(c,pos,level,1);
+        if (BtnShowMap->isChecked()) {
+            DrawTrkPos(c,SolData[1].rb,0,8,CColor[2],tr("Base Station 2"));
+        }
+        DrawTrkStat(c,pos,header,p++);
         delete pos;
     }
-
     if (BtnSol12->isChecked()) {
-        pos1 = SolToPos(SolData, -1, 0, 0);
-        pos2 = SolToPos(SolData + 1, -1, 0, 0);
-        pos = pos1->diff(pos2, QFlag->currentIndex());
-        DrawTrkPnt(c, pos, level, 0);
-        DrawTrkStat(c, pos, "", p++);
+        pos1=SolToPos(SolData  ,-1,0,0);
+        pos2=SolToPos(SolData+1,-1,0,0);
+        pos=pos1->diff(pos2,QFlag->currentIndex());
+        DrawTrkPnt(c,pos,level,0);
+        DrawTrkStat(c,pos,"",p++);
         delete pos;
         delete pos1;
         delete pos2;
     }
-
-    if (BtnShowTrack->isChecked() && BtnSol1->isChecked()) {
-        pos = SolToPos(SolData, SolIndex[0], 0, 0);
-
-        if ((sol = getsol(SolData, SolIndex[0]))) time1 = sol->time;
-
+    if (BtnShowTrack->isChecked()&&BtnSol1->isChecked()) {
+        
+        pos=SolToPos(SolData,SolIndex[0],0,0);
+        
+        if ((sol=getsol(SolData,SolIndex[0]))) time1=sol->time;
+        
         if (pos->n) {
-            pos->n = 1;
-            DrawTrkError(c, pos, 0);
-            GraphT->ToPoint(pos->x[0], pos->y[0], p1);
-            GraphT->DrawMark(c, p1, 0, CColor[0], MarkSize * 2 + 12, 0);
-            GraphT->DrawMark(c, p1, 1, CColor[2], MarkSize * 2 + 10, 0);
-            GraphT->DrawMark(c, p1, 5, CColor[2], MarkSize * 2 + 14, 0);
-            GraphT->DrawMark(c, p1, 0, CColor[2], MarkSize * 2 + 6, 0);
-            GraphT->DrawMark(c, p1, 0, MColor[0][pos->q[0]], MarkSize * 2 + 4, 0);
-
+            pos->n=1;
+            DrawTrkError(c,pos,0);
+            GraphT->ToPoint(pos->x[0],pos->y[0],p1);
+            GraphT->DrawMark(c,p1,0,CColor[0],MarkSize*2+12,0);
+            GraphT->DrawMark(c,p1,1,CColor[2],MarkSize*2+10,0);
+            GraphT->DrawMark(c,p1,5,CColor[2],MarkSize*2+14,0);
+            GraphT->DrawMark(c,p1,0,CColor[2],MarkSize*2+6,0);
+            GraphT->DrawMark(c,p1,0,MColor[0][pos->q[0]],MarkSize*2+4,0);
             if (BtnSol2->isChecked()) {
-                p1.rx() += MarkSize + 8;
-                DrawLabel(GraphT, c, p1, "1", 1, 0);
+                p1.rx()+=MarkSize+8;
+                DrawLabel(GraphT,c,p1,"1",1,0);
             }
         }
         delete pos;
     }
-
-    if (BtnShowTrack->isChecked() && BtnSol2->isChecked()) {
-        pos = SolToPos(SolData + 1, SolIndex[1], 0, 0);
-
-        if ((sol = getsol(SolData + 1, SolIndex[1]))) time2 = sol->time;
-
-        if (pos->n > 0 && (time1.time == 0 || fabs(timediff(time1, time2)) < DTTOL * 2.0)) {
-            pos->n = 1;
-            DrawTrkError(c, pos, 1);
-            GraphT->ToPoint(pos->x[0], pos->y[0], p1);
-            GraphT->DrawMark(c, p1, 0, CColor[0], MarkSize * 2 + 12, 0);
-            GraphT->DrawMark(c, p1, 1, CColor[1], MarkSize * 2 + 10, 0);
-            GraphT->DrawMark(c, p1, 5, CColor[1], MarkSize * 2 + 14, 0);
-            GraphT->DrawMark(c, p1, 0, CColor[2], MarkSize * 2 + 6, 0);
-            GraphT->DrawMark(c, p1, 0, MColor[1][pos->q[0]], MarkSize * 2 + 4, 0);
-
+    if (BtnShowTrack->isChecked()&&BtnSol2->isChecked()) {
+        
+        pos=SolToPos(SolData+1,SolIndex[1],0,0);
+        
+        if ((sol=getsol(SolData+1,SolIndex[1]))) time2=sol->time;
+        
+        if (pos->n>0&&(time1.time==0||fabs(timediff(time1,time2))<DTTOL*2.0)) {
+            pos->n=1;
+            DrawTrkError(c,pos,1);
+            GraphT->ToPoint(pos->x[0],pos->y[0],p1);
+            GraphT->DrawMark(c,p1,0,CColor[0],MarkSize*2+12,0);
+            GraphT->DrawMark(c,p1,1,CColor[1],MarkSize*2+10,0);
+            GraphT->DrawMark(c,p1,5,CColor[1],MarkSize*2+14,0);
+            GraphT->DrawMark(c,p1,0,CColor[2],MarkSize*2+6,0);
+            GraphT->DrawMark(c,p1,0,MColor[1][pos->q[0]],MarkSize*2+4,0);
             if (BtnSol1->isChecked()) {
-                p1.setX(p1.x() + MarkSize + 8);
-                DrawLabel(GraphT, c, p1, "2", 1, 0);
+                p1.setX(p1.x()+MarkSize+8);
+                DrawLabel(GraphT,c,p1,"2",1,0);
             }
         }
         delete pos;
     }
-    if (BtnShowTrack->isChecked() && BtnSol12->isChecked()) {
-        pos1 = SolToPos(SolData, SolIndex[0], 0, 0);
-        pos2 = SolToPos(SolData + 1, SolIndex[1], 0, 0);
-        pos = pos1->diff(pos2, 0);
-
-        if (pos->n > 0) {
-            pos->n = 1;
-            DrawTrkError(c, pos, 1);
-            GraphT->ToPoint(pos->x[0], pos->y[0], p1);
-            GraphT->DrawMark(c, p1, 0, CColor[0], MarkSize * 2 + 12, 0);
-            GraphT->DrawMark(c, p1, 1, CColor[2], MarkSize * 2 + 10, 0);
-            GraphT->DrawMark(c, p1, 5, CColor[2], MarkSize * 2 + 14, 0);
-            GraphT->DrawMark(c, p1, 0, CColor[2], MarkSize * 2 + 6, 0);
-            GraphT->DrawMark(c, p1, 0, MColor[0][pos->q[0]], MarkSize * 2 + 4, 0);
+    if (BtnShowTrack->isChecked()&&BtnSol12->isChecked()) {
+        
+        pos1=SolToPos(SolData  ,SolIndex[0],0,0);
+        pos2=SolToPos(SolData+1,SolIndex[1],0,0);
+        pos=pos1->diff(pos2,0);
+        
+        if (pos->n>0) {
+            pos->n=1;
+            DrawTrkError(c,pos,1);
+            GraphT->ToPoint(pos->x[0],pos->y[0],p1);
+            GraphT->DrawMark(c,p1,0,CColor[0],MarkSize*2+12,0);
+            GraphT->DrawMark(c,p1,1,CColor[2],MarkSize*2+10,0);
+            GraphT->DrawMark(c,p1,5,CColor[2],MarkSize*2+14,0);
+            GraphT->DrawMark(c,p1,0,CColor[2],MarkSize*2+6,0);
+            GraphT->DrawMark(c,p1,0,MColor[0][pos->q[0]],MarkSize*2+4,0);
         }
         delete pos;
         delete pos1;
         delete pos2;
     }
     if (BtnShowMap->isChecked()) {
-        for (i = 0; i < NWayPnt; i++) {
-            pnt[0] = PntPos[i][0] * D2R;
-            pnt[1] = PntPos[i][1] * D2R;
-            pnt[2] = PntPos[i][2];
-            pos2ecef(pnt, rr);
-            DrawTrkPos(c, rr, 0, i == SelWayPnt ? 12 : 8, CColor[2], PntName[i]);
+        for (i=0;i<NWayPnt;i++) {
+            pnt[0]=PntPos[i][0]*D2R;
+            pnt[1]=PntPos[i][1]*D2R;
+            pnt[2]=PntPos[i][2];
+            pos2ecef(pnt,rr);
+            DrawTrkPos(c,rr,0,i==SelWayPnt?12:8,CColor[2],PntName[i]);
         }
     }
 
     if (ShowCompass) {
-        GraphT->GetPos(p1, p2);
-        p1.rx() += SIZE_COMP / 2 + 25;
-        p1.ry() += SIZE_COMP / 2 + 35;
-        DrawMark(GraphT, c, p1, 13, CColor[2], SIZE_COMP, 0);
+        GraphT->GetPos(p1,p2);
+        p1.rx()+=SIZE_COMP/2+25;
+        p1.ry()+=SIZE_COMP/2+35;
+        DrawMark(GraphT,c,p1,13,CColor[2],SIZE_COMP,0);
     }
-
-    if (ShowArrow && BtnShowTrack->isChecked()) {
-        vel = SolToPos(SolData + sel, SolIndex[sel], 0, 1);
-        DrawTrkVel(c, vel);
+    if (ShowArrow&&BtnShowTrack->isChecked()) {
+        vel=SolToPos(SolData+sel,SolIndex[sel],0,1);
+        DrawTrkVel(c,vel);
         delete vel;
     }
-
     if (ShowScale) {
-        GraphT->GetPos(p1, p2);
-        GraphT->GetTick(xt, yt);
-        GraphT->GetScale(sx, sy);
-        p2.rx() -= 70;
-        p2.ry() -= 25;
-        DrawMark(GraphT, c, p2, 11, CColor[2], static_cast<int>(xt / sx + 0.5), 0);
-        p2.ry() -= 3;
-        if (xt < 0.01) label = QString("%1 mm").arg(xt * 1000.0, 0, 'f', 0);
-        else if (xt < 1.0) label = QString("%1 cm").arg(xt * 100.0, 0, 'f', 0);
-        else if (xt < 1000.0) label = QString("%1 m").arg(xt, 0, 'f', 0);
-        else label = QString("%1 km").arg(xt / 1000.0, 0, 'f', 0);
-        DrawLabel(GraphT, c, p2, label, 0, 1);
+        GraphT->GetPos(p1,p2);
+        GraphT->GetTick(xt,yt);
+        GraphT->GetScale(sx,sy);
+        p2.rx()-=70;
+        p2.ry()-=25;
+        DrawMark(GraphT,c,p2,11,CColor[2],static_cast<int>(xt/sx+0.5),0);
+        p2.ry()-=3;
+        if      (xt<0.01  ) label=QString("%1 mm").arg(xt*1000.0,0,'f',0);
+        else if (xt<1.0   ) label=QString("%1 cm").arg(xt*100.0,0,'f',0);
+        else if (xt<1000.0) label=QString("%1 m" ).arg(xt,0,'f',0);
+        else                label=QString("%1 km").arg(xt/1000.0,0,'f',0);
+        DrawLabel(GraphT,c,p2,label,0,1);
     }
 
     if (!level) { // center +
-        GraphT->GetCent(xt, yt);
-        GraphT->ToPoint(xt, yt, p1);
-        DrawMark(GraphT, c, p1, 5, CColor[2], 20, 0);
+        GraphT->GetCent(xt,yt);
+        GraphT->ToPoint(xt,yt,p1);
+        DrawMark(GraphT,c,p1,5,CColor[2],20,0);
     }
-
     // update geview and gmview center
-    if (level) {
-        if (norm(OPos, 3) > 0.0) {
-            GraphT->GetCent(xt, yt);
-            GraphT->ToPoint(xt, yt, p1);
-            GraphT->ToPos(p1, enu[0], enu[1]);
-            ecef2pos(OPos, opos);
-            enu2ecef(opos, enu, rr);
-            for (i=0; i<3; i++) rr[i] += OPos[i];
-            ecef2pos(rr, cent);
-            googleEarthView->SetCent(cent[0] * R2D, cent[1] * R2D);
-            googleMapView  ->SetCent(cent[0] * R2D, cent[1] * R2D);
-        }
-        Refresh_GEView();
+    if (level&&norm(OPos,3)>0.0) {
+        GraphT->GetCent(xt,yt);
+        GraphT->ToPoint(xt,yt,p1);
+        GraphT->ToPos(p1,enu[0],enu[1]);
+        enu[2]=0;
+        ecef2pos(OPos,opos);
+        enu2ecef(opos,enu,rr);
+        for (i=0;i<3;i++) rr[i]+=OPos[i];
+        ecef2pos(rr,cent);
+
+        googleEarthView->SetCent(cent[0]*R2D,cent[1]*R2D);
+        googleMapView->SetCent(cent[0]*R2D,cent[1]*R2D);
     }
+    Refresh_GEView();
 }
 // draw map-image on track-plot ---------------------------------------------
-void Plot::DrawTrkImage(QPainter &c, int level)
+void Plot::DrawTrkImage(QPainter &c,int level)
 {
-    gtime_t time = { 0, 0 };
-    QPoint p1, p2;
-    double pos[3] = { 0 }, rr[3], xyz[3] = { 0 }, x1, x2, y1, y2;
-
-    trace(3, "DrawTrkImage: level=%d\n", level);
-
-    pos[0] = MapLat * D2R;
-    pos[1] = MapLon * D2R;
-    pos2ecef(pos, rr);
-    if (norm(OPos, 3) > 0.0)
-        PosToXyz(time, rr, 0, xyz);
-    x1 = xyz[0] - MapSize[0] * 0.5 * MapScaleX;
-    x2 = xyz[0] + MapSize[0] * 0.5 * MapScaleX;
-    y1 = xyz[1] - MapSize[1] * 0.5 * (MapScaleEq ? MapScaleX : MapScaleY);
-    y2 = xyz[1] + MapSize[1] * 0.5 * (MapScaleEq ? MapScaleX : MapScaleY);
-
-    GraphT->ToPoint(x1, y2, p1);
-    GraphT->ToPoint(x2, y1, p2);
-    QRect r(p1, p2);
-    c.drawImage(r, MapImage);
+    gtime_t time={0,0};
+    QPoint p1,p2;
+    double pos[3]={0},rr[3],xyz[3]={0},x1,x2,y1,y2;
+    
+    trace(3,"DrawTrkImage: level=%d\n",level);
+    
+    pos[0]=MapLat*D2R;
+    pos[1]=MapLon*D2R;
+    pos2ecef(pos,rr);
+    if (norm(OPos,3)>0.0) {
+        PosToXyz(time,rr,0,xyz);
+    }
+    x1=xyz[0]-MapSize[0]*0.5*MapScaleX;
+    x2=xyz[0]+MapSize[0]*0.5*MapScaleX;
+    y1=xyz[1]-MapSize[1]*0.5*(MapScaleEq?MapScaleX:MapScaleY);
+    y2=xyz[1]+MapSize[1]*0.5*(MapScaleEq?MapScaleX:MapScaleY);
+    
+    GraphT->ToPoint(x1,y2,p1);
+    GraphT->ToPoint(x2,y1,p2);
+    QRect r(p1,p2);
+    c.drawImage(r,MapImage);
 }
-// check in boundrary --------------------------------------------------------
-#define P_IN_B(pos, bound) \
-    (pos[0] >= bound[0] && pos[0] <= bound[1] && pos[1] >= bound[2] && pos[1] <= bound[3])
-
-#define B_IN_B(bound1, bound2) \
-    (bound1[0] <= bound2[1] && bound1[1] >= bound2[0] && bound1[2] <= bound2[3] && bound1[3] >= bound2[2])
-
 // draw gis-map on track-plot ----------------------------------------------
-void Plot::DrawTrkMap(QPainter &c, int level)
+void Plot::DrawTrkMap(QPainter &c,int level)
 {
     gisd_t *data;
-    gis_pnt_t *pnt;
-    gis_poly_t *poly;
-    gis_polygon_t *polygon;
-    gtime_t time = { 0, 0 };
+    gtime_t time={0,0};
     QColor color;
-    QPoint *p, p1;
-    double xyz[3], S, xl[2], yl[2], enu[8][3] = { { 0 } }, opos[3], pos[3], rr[3];
-    double bound[4] = { PI / 2.0, -PI / 2.0, PI, -PI };
-    int i, j, n, m;
-
-    trace(3, "DrawTrkPath: level=%d\n", level);
-
-    // get map boundary
-    GraphT->GetLim(xl, yl);
-    enu[0][0] = xl[0]; enu[0][1] = yl[0];
-    enu[1][0] = xl[1]; enu[1][1] = yl[0];
-    enu[2][0] = xl[0]; enu[2][1] = yl[1];
-    enu[3][0] = xl[1]; enu[3][1] = yl[1];
-    enu[4][0] = (xl[0] + xl[1]) / 2.0; enu[4][1] = yl[0];
-    enu[5][0] = (xl[0] + xl[1]) / 2.0; enu[5][1] = yl[1];
-    enu[6][0] = xl[0]; enu[6][1] = (yl[0] + yl[1]) / 2.0;
-    enu[7][0] = xl[1]; enu[7][1] = (yl[0] + yl[1]) / 2.0;
-
-    ecef2pos(OPos, opos);
-
-    for (i = 0; i < 8; i++) {
-        if (norm(enu[i], 2) >= 1000000.0) {
-            bound[0] =-PI / 2.0;
-            bound[1] = PI / 2.0;
-            bound[2] =-PI;
-            bound[3] = PI;
-            break;
-        }
-        enu2ecef(opos, enu[i], rr);
-        for (j = 0; j < 3; j++) rr[j] += OPos[j];
-        ecef2pos(rr, pos);
-        if (pos[0] < bound[0]) bound[0] = pos[0];       // min lat
-        if (pos[0] > bound[1]) bound[1] = pos[0];       // max lat
-        if (pos[1] < bound[2]) bound[2] = pos[1];       // min lon
-        if (pos[1] > bound[3]) bound[3] = pos[1];       // max lon
-    }
+    QPoint *p,p1;
+    double xyz[3],S;
+    int i,j,n,m;
+    
+    trace(3,"DrawTrkPath: level=%d\n",level);    
 
-    for (i = MAXMAPLAYER - 1; i >= 0; i--) {
+    for (i=MAXMAPLAYER-1;i>=0;i--) {
         if (!Gis.flag[i]) continue;
-        for (data = Gis.data[i]; data; data = data->next) {
-            if (data->type == 1) { // point
-                pnt = static_cast<gis_pnt_t *>(data->data);
-                if (!P_IN_B(pnt->pos, bound)) continue;
-                PosToXyz(time, pnt->pos, 0, xyz);
-                if (xyz[2]<-RE_WGS84) continue;
-                GraphT->ToPoint(xyz[0], xyz[1], p1);
-                DrawMark(GraphT, c, p1, 1, CColor[2], 6, 0);
-                DrawMark(GraphT, c, p1, 0, CColor[2], 2, 0);
-            } else if (level && data->type == 2) { // polyline
-                poly = static_cast<gis_poly_t *>(data->data);
-                if ((n = poly->npnt) <= 0 || !B_IN_B(poly->bound, bound))
+        for (data=Gis.data[i];data;data=data->next) {
+
+            if (data->type==1) { // point
+                PosToXyz(time,(static_cast<gis_pnt_t *>(data->data))->pos,0,xyz);
+                GraphT->ToPoint(xyz[0],xyz[1],p1);
+                DrawMark(GraphT,c,p1,1,CColor[2],6,0);
+                DrawMark(GraphT,c,p1,0,CColor[2],2,0);
+            }
+            else if (level&&data->type==2) { // polyline
+                if ((n=(static_cast<gis_poly_t *>(data->data))->npnt)<=0) {
                     continue;
-                p = new QPoint [n];
-                for (j = m = 0; j < n; j++) {
-                    PosToXyz(time, poly->pos + j * 3, 0, xyz);
-                    if (xyz[2] < -RE_WGS84) {
-                        if (m > 1) {
-                            GraphT->DrawPoly(c, p, m, MapColor[i], 0);
-                            m = 0;
-                        }
-                        continue;
+                }
+                p=new QPoint [n];
+                for (j=m=0;j<n;j++) {
+                    PosToXyz(time,(static_cast<gis_poly_t *>(data->data))->pos+j*3,0,xyz);
+                    GraphT->ToPoint(xyz[0],xyz[1],p1);
+                    if (m==0||p1.x()!=p[m-1].x()||p1.y()!=p[m-1].y()) {
+                        p[m++]=p1;
                     }
-                    GraphT->ToPoint(xyz[0], xyz[1], p1);
-                    if (m == 0 || p1.x() != p[m - 1].x() || p1.y() != p[m - 1].y())
-                        p[m++] = p1;
                 }
-                GraphT->DrawPoly(c, p, m, MapColor[i], 0);
+                GraphT->DrawPoly(c,p,m,MapColor[i],0);
                 delete [] p;
-            } else if (level && data->type == 3) { // polygon
-                polygon = (gis_polygon_t *)data->data;
-                if ((n = polygon->npnt) <= 0 || !B_IN_B(polygon->bound, bound))
+            }
+            else if (level&&data->type==3) { // polygon
+                if ((n=(static_cast<gis_polygon_t *>(data->data))->npnt)<=0) {
                     continue;
-                p = new QPoint [n];
-                for (j = m = 0; j < n; j++) {
-                    PosToXyz(time, polygon->pos + j * 3, 0, xyz);
-                    if (xyz[2] < -RE_WGS84) {
-                        continue;
+                }
+                p=new QPoint [n];
+                for (j=m=0;j<n;j++) {
+                    PosToXyz(time,(static_cast<gis_polygon_t *>(data->data))->pos+j*3,0,xyz);
+                    GraphT->ToPoint(xyz[0],xyz[1],p1);
+                    if (m==0||p1.x()!=p[m-1].x()||p1.y()!=p[m-1].y()) {
+                        p[m++]=p1;
                     }
-                    GraphT->ToPoint(xyz[0], xyz[1], p1);
-                    if (m == 0 || p1.x() != p[m - 1].x() || p1.y() != p[m - 1].y())
-                        p[m++] = p1;
                 }
-                            // judge hole
-                for (j = 0, S = 0.0; j < m - 1; j++)
-                    S += static_cast<double>(p[j].x() * p[j + 1].y() - p[j + 1].x() * p[j].y());
-                color = S < 0.0 ? CColor[0] : MapColor[i];
-                GraphT->DrawPatch(c, p, m, color, color, 0);
+                // judge hole
+                for (j=0,S=0.0;j<m-1;j++) {
+                    S+=static_cast<double>(p[j].x()*p[j+1].y()-p[j+1].x()*p[j].y());
+                }
+                color=S<0.0?CColor[0]:MapColor[i];
+                GraphT->DrawPatch(c,p,m,color,color,0);
                 delete [] p;
             }
         }
     }
 }
 // draw track-points on track-plot ------------------------------------------
-void Plot::DrawTrkPnt(QPainter &c, const TIMEPOS *pos, int level, int style)
+void Plot::DrawTrkPnt(QPainter &c,const TIMEPOS *pos, int level, int style)
 {
     QVector<QColor> color;
     int i;
-
-    trace(3, "DrawTrkPnt: level=%d style=%d\n", level, style);
-
-    if (level) DrawTrkArrow(c, pos);
-
-    if (level && PlotStyle <= 1 && !BtnShowTrack->isChecked()) // error circle
-        DrawTrkError(c, pos, style);
-
-    if (!(PlotStyle % 2))
-        GraphT->DrawPoly(c, pos->x, pos->y, pos->n, CColor[3], style);
-
-    if (level && PlotStyle < 2) {
+    
+    trace(3,"DrawTrkPnt: level=%d style=%d\n",level,style);
+    
+    if (level) DrawTrkArrow(c,pos);
+    
+    if (level&&PlotStyle<=1&&!BtnShowTrack->isChecked()) { // error circle
+        DrawTrkError(c,pos,style);
+    }
+    if (!(PlotStyle%2)) {
+        GraphT->DrawPoly(c,pos->x,pos->y,pos->n,CColor[3],style);
+    }
+    if (level&&PlotStyle<2) {
         if (BtnShowImg->isChecked()) {
-            for (i = 0; i < pos->n; i++) color.append(CColor[0]);
-            GraphT->DrawMarks(c, pos->x, pos->y, color, pos->n, 0, MarkSize + 2, 0);
+            for (i=0;i<pos->n;i++) color.append(CColor[0]);
+            GraphT->DrawMarks(c,pos->x,pos->y,color,pos->n,0,MarkSize+2,0);
         }
         color.clear();
-
-        for (i = 0; i < pos->n; i++) color.append(MColor[style][pos->q[i]]);
-
-        GraphT->DrawMarks(c, pos->x, pos->y, color, pos->n, 0, MarkSize, 0);
+        for (i=0;i<pos->n;i++) color.append(MColor[style][pos->q[i]]);
+        GraphT->DrawMarks(c,pos->x,pos->y,color,pos->n,0,MarkSize,0);
     }
 }
 // draw point with label on track-plot --------------------------------------
-void Plot::DrawTrkPos(QPainter &c, const double *rr, int type, int siz,
-              QColor color, const QString &label)
+void Plot::DrawTrkPos(QPainter &c,const double *rr, int type, int siz,
+                      QColor color,  const QString &label)
 {
-    gtime_t time = { 0, 0 };
+    gtime_t time={0,0};
     QPoint p1;
-    double xyz[3], xs, ys;
-
-    trace(3, "DrawTrkPos: type=%d\n", type);
-
-    if (norm(rr, 3) > 0.0) {
-        GraphT->GetScale(xs, ys);
-        PosToXyz(time, rr, type, xyz);
-        GraphT->ToPoint(xyz[0], xyz[1], p1);
-        DrawMark(GraphT, c, p1, 5, color, siz + 8, 0);
-        DrawMark(GraphT, c, p1, 1, color, siz, 0);
-        DrawMark(GraphT, c, p1, 1, color, siz - 6, 0);
-        p1.ry() += 10;
-        DrawLabel(GraphT, c, p1, label, 0, 2);
+    double xyz[3],xs,ys;
+    
+    trace(3,"DrawTrkPos: type=%d\n",type);
+    
+    if (norm(rr,3)>0.0) {
+        GraphT->GetScale(xs,ys);
+        PosToXyz(time,rr,type,xyz);
+        GraphT->ToPoint(xyz[0],xyz[1],p1);
+        DrawMark(GraphT,c,p1,5,color,siz+8,0);
+        DrawMark(GraphT,c,p1,1,color,siz,0);
+        DrawMark(GraphT,c,p1,1,color,siz-6,0);
+        p1.ry()+=10;
+        DrawLabel(GraphT,c,p1,label,0,2);
     }
 }
 // draw statistics on track-plot --------------------------------------------
-void Plot::DrawTrkStat(QPainter &c, const TIMEPOS *pos, const QString &header, int p)
+void Plot::DrawTrkStat(QPainter &c,const TIMEPOS *pos, const QString &header, int p)
 {
     QString s[6];
-    QPoint p1, p2;
-    double *d, ave[4], std[4], rms[4];
-    int i, n = 0, fonth = static_cast<int>(Disp->font().pointSize() * 1.5);
-
-    trace(3, "DrawTrkStat: p=%d\n", p);
-
+    QPoint p1,p2;
+    double *d,ave[4],std[4],rms[4];
+    int i,n=0,fonth=static_cast<int>(Disp->font().pointSize()*1.5);
+    
+    trace(3,"DrawTrkStat: p=%d\n",p);
+    
     if (!ShowStats) return;
-
-    if (p == 0 && header != "") s[n++] = header;
-
-    if (pos->n > 0) {
-        d = new double[pos->n];
-
-        for (i = 0; i < pos->n; i++)
-            d[i] = SQRT(SQR(pos->x[i]) + SQR(pos->y[i]));
-
-        CalcStats(pos->x, pos->n, 0.0, ave[0], std[0], rms[0]);
-        CalcStats(pos->y, pos->n, 0.0, ave[1], std[1], rms[1]);
-        CalcStats(pos->z, pos->n, 0.0, ave[2], std[2], rms[2]);
-        CalcStats(d, pos->n, 0.0, ave[3], std[3], rms[3]);
-
-        s[n++] = QString("AVE=E:%1m N:%2m U:%3m").arg(ave[0], 7, 'f', 4).arg(ave[1], 7, 'f', 4).arg(ave[2], 7, 'f', 4);
-        s[n++] = QString("STD=E:%1m N:%2m U:%3m").arg(std[0], 7, 'f', 4).arg(std[1], 7, 'f', 4).arg(std[2], 7, 'f', 4);
-        s[n++] = QString("RMS=E:%1m N:%2m U:%3m 2D:%4m")
-             .arg(rms[0], 7, 'f', 4).arg(rms[1], 7, 'f', 4).arg(rms[2], 7, 'f', 4).arg(2.0 * rms[3], 7, 'f', 4);
-
+    
+    if (p==0&&header!="") s[n++]=header;
+    
+    if (pos->n>0) {
+        d=new double[pos->n];
+        for (i=0;i<pos->n;i++) {
+            d[i]=SQRT(SQR(pos->x[i])+SQR(pos->y[i]));
+        }
+        CalcStats(pos->x,pos->n,0.0,ave[0],std[0],rms[0]);
+        CalcStats(pos->y,pos->n,0.0,ave[1],std[1],rms[1]);
+        CalcStats(pos->z,pos->n,0.0,ave[2],std[2],rms[2]);
+        CalcStats(d     ,pos->n,0.0,ave[3],std[3],rms[3]);
+        s[n++]=QString("AVE=E:%1m N:%2m U:%3m").arg(ave[0],7,'f',4).arg(ave[1],7,'f',4).arg(ave[2],7,'f',4);
+        s[n++]=QString("STD=E:%1m N:%2m U:%3m").arg(std[0],7,'f',4).arg(std[1],7,'f',4).arg(std[2],7,'f',4);
+        s[n++]=QString("RMS=E:%1m N:%2m U:%3m 2D:%4m")
+                       .arg(rms[0],7,'f',4).arg(rms[1],7,'f',4).arg(rms[2],7,'f',4).arg(2.0*rms[3],7,'f',4);
         delete [] d;
     }
-    GraphT->GetPos(p1, p2);
-    p1.rx() = p2.x() - 10;
-    p1.ry() += 8 + fonth * 4 * p;
-
-    for (i = 0; i < n; i++, p1.ry() += fonth)
-        DrawLabel(GraphT, c, p1, s[i], 2, 2);
+    GraphT->GetPos(p1,p2);
+    p1.rx()=p2.x()-10;
+    p1.ry()+=8+fonth*4*p;
+    for (i=0;i<n;i++,p1.ry()+=fonth) {
+        DrawLabel(GraphT,c,p1,s[i],2,2);
+    }
 }
 // draw error-circle on track-plot ------------------------------------------
-void Plot::DrawTrkError(QPainter &c, const TIMEPOS *pos, int style)
+void Plot::DrawTrkError(QPainter &c,const TIMEPOS *pos, int style)
 {
-    const double sint[36] = {
-        0.0000,	 0.1736,  0.3420,  0.5000,  0.6428,  0.7660,  0.8660,  0.9397,	0.9848,
-        1.0000,	 0.9848,  0.9397,  0.8660,  0.7660,  0.6428,  0.5000,  0.3420,	0.1736,
-        0.0000,	 -0.1736, -0.3420, -0.5000, -0.6428, -0.7660, -0.8660, -0.9397, -0.9848,
-        -1.0000, -0.9848, -0.9397, -0.8660, -0.7660, -0.6428, -0.5000, -0.3420, -0.1736
+    const double sint[36]={
+         0.0000, 0.1736, 0.3420, 0.5000, 0.6428, 0.7660, 0.8660, 0.9397, 0.9848,
+         1.0000, 0.9848, 0.9397, 0.8660, 0.7660, 0.6428, 0.5000, 0.3420, 0.1736,
+         0.0000,-0.1736,-0.3420,-0.5000,-0.6428,-0.7660,-0.8660,-0.9397,-0.9848,
+        -1.0000,-0.9848,-0.9397,-0.8660,-0.7660,-0.6428,-0.5000,-0.3420,-0.1736
     };
-    double xc[37], yc[37], a, b, s, cc;
-    int i, j;
-
-    trace(3, "DrawTrkError: style=%d\n", style);
-
+    double xc[37],yc[37],a,b,s,cc;
+    int i,j;
+    
+    trace(3,"DrawTrkError: style=%d\n",style);
+    
     if (!ShowErr) return;
-
-    for (i = 0; i < pos->n; i++) {
-        if (pos->xs[i] <= 0.0 || pos->ys[i] <= 0.0) continue;
-
-        a = pos->xys[i] / SQRT(pos->xs[i]);
-
-        if ((b = pos->ys[i] - a * a) >= 0.0) b = SQRT(b); else continue;
-
-        for (j = 0; j < 37; j++) {
-            s = sint[j % 36];
-            cc = sint[(45 - j) % 36];
-            xc[j] = pos->x[i] + SQRT(pos->xs[i]) * cc;
-            yc[j] = pos->y[i] + a * cc + b * s;
+    
+    for (i=0;i<pos->n;i++) {
+        if (pos->xs[i]<=0.0||pos->ys[i]<=0.0) continue;
+        
+        a=pos->xys[i]/SQRT(pos->xs[i]);
+        
+        if ((b=pos->ys[i]-a*a)>=0.0) b=SQRT(b); else continue;
+        
+        for (j=0;j<37;j++) {
+            s=sint[j%36];
+            cc=sint[(45-j)%36];
+            xc[j]=pos->x[i]+SQRT(pos->xs[i])*cc;
+            yc[j]=pos->y[i]+a*cc+b*s;
         }
-        GraphT->DrawPoly(c, xc, yc, 37, CColor[1], ShowErr == 1 ? 0 : 1);
+        GraphT->DrawPoly(c,xc,yc,37,CColor[1],ShowErr==1?0:1);
     }
 }
 // draw direction-arrow on track-plot ---------------------------------------
-void Plot::DrawTrkArrow(QPainter &c, const TIMEPOS *pos)
+void Plot::DrawTrkArrow(QPainter &c,const TIMEPOS *pos)
 {
     QPoint p;
-    double tt, d[2], dist, dt, vel;
-    int i, off = 8;
-
-    trace(3, "DrawTrkArrow\n");
-
+    double tt,d[2],dist,dt,vel;
+    int i,off=8;
+    
+    trace(3,"DrawTrkArrow\n");
+    
     if (!ShowArrow) return;
-
-    for (i = 1; i < pos->n - 1; i++) {
-        tt = time2gpst(pos->t[i], NULL);
-        d[0] = pos->x[i + 1] - pos->x[i - 1];
-        d[1] = pos->y[i + 1] - pos->y[i - 1];
-        dist = norm(d, 2);
-        dt = timediff(pos->t[i + 1], pos->t[i - 1]);
-        vel = dt == 0.0 ? 0.0 : dist / dt;
-
-        if (vel < 0.5 || fmod(tt + 0.005, INTARROW) >= 0.01) continue;
-
-        GraphT->ToPoint(pos->x[i], pos->y[i], p);
-        p.rx() -= static_cast<int>(off * d[1] / dist);
-        p.ry() -= static_cast<int>(off * d[0] / dist);
-        DrawMark(GraphT, c, p, 10, CColor[3], 15, static_cast<int>(ATAN2(d[1], d[0]) * R2D));
+    
+    for (i=1;i<pos->n-1;i++) {
+        tt=time2gpst(pos->t[i],NULL);
+        d[0]=pos->x[i+1]-pos->x[i-1];
+        d[1]=pos->y[i+1]-pos->y[i-1];
+        dist=norm(d,2);
+        dt=timediff(pos->t[i+1],pos->t[i-1]);
+        vel=dt==0.0?0.0:dist/dt;
+        
+        if (vel<0.5||fmod(tt+0.005,INTARROW)>=0.01) continue;
+        
+        GraphT->ToPoint(pos->x[i],pos->y[i],p);
+        p.rx()-=static_cast<int>(off*d[1]/dist);
+        p.ry()-=static_cast<int>(off*d[0]/dist);
+        DrawMark(GraphT,c,p,10,CColor[3],15,static_cast<int>(ATAN2(d[1],d[0])*R2D));
     }
 }
 // draw velocity-indicator on track-plot ------------------------------------
-void Plot::DrawTrkVel(QPainter &c, const TIMEPOS *vel)
+void Plot::DrawTrkVel(QPainter &c,const TIMEPOS *vel)
 {
     QString label;
-    QPoint p1, p2;
-    double v = 0.0, dir = 0.0;
-
-    trace(3, "DrawTrkVel\n");
-
-    if (vel && vel->n > 0) {
-        if ((v = SQRT(SQR(vel->x[0]) + SQR(vel->y[0]))) > 1.0)
-            dir = ATAN2(vel->x[0], vel->y[0]) * R2D;
+    QPoint p1,p2;
+    double v=0.0,dir=0.0;
+    
+    trace(3,"DrawTrkVel\n");
+    
+    if (vel&&vel->n>0) {
+        if ((v=sqrt(SQR(vel->x[0])+SQR(vel->y[0])))>1.0) {
+            dir=ATAN2(vel->x[0],vel->y[0])*R2D;
+        }
     }
-
-    GraphT->GetPos(p1, p2);
-    p1.rx() += SIZE_VELC / 2 + 30;
-    p1.ry() = p2.y() - SIZE_VELC / 2 - 30;
-    DrawMark(GraphT, c, p1, 1, CColor[2], SIZE_VELC, 0);
-
-    p1.ry() += SIZE_VELC / 2;
-    label = QString("%1 km/h").arg(v * 3600.0 / 1000.0, 0, 'f', 0);
-    DrawLabel(GraphT, c, p1, label, 0, 2);
-
-    p1.ry() -= SIZE_VELC / 2;
-    if (v >= 1.0) DrawMark(GraphT, c, p1, 10, CColor[2], SIZE_VELC, 90 - static_cast<int>(dir));
-    DrawMark(GraphT, c, p1, 0, CColor[0], 8, 0);
-    DrawMark(GraphT, c, p1, 1, CColor[2], 8, 0);
+    GraphT->GetPos(p1,p2);
+    p1.rx()+=SIZE_VELC/2+30;
+    p1.ry()=p2.y()-SIZE_VELC/2-30;
+    DrawMark(GraphT,c,p1,1,CColor[2],SIZE_VELC,0);
+    p1.ry()+=SIZE_VELC/2;
+    label=QString("%1 km/h").arg(v*3600.0/1000.0,0,'f',0);
+    DrawLabel(GraphT,c,p1,label,0,2);
+    p1.ry()-=SIZE_VELC/2;
+    if (v>=1.0) DrawMark(GraphT,c,p1,10,CColor[2],SIZE_VELC,90-static_cast<int>(dir));
+    DrawMark(GraphT,c,p1,0,CColor[0],8,0);
+    DrawMark(GraphT,c,p1,1,CColor[2],8,0);
 }
 // draw solution-plot -------------------------------------------------------
-void Plot::DrawSol(QPainter &c, int level, int type)
+void Plot::DrawSol(QPainter &c,int level, int type)
 {
-    QString label[] = { tr("E-W"), tr("N-S"), tr("U-D") }, unit[] = { "m", "m/s", QString("m/s%1").arg(up2Char) };
-    QPushButton *btn[] = { BtnOn1, BtnOn2, BtnOn3 };
-    TIMEPOS *pos, *pos1, *pos2;
-    gtime_t time1 = { 0, 0 }, time2 = { 0, 0 };
-    QPoint p1, p2;
-    double xc, yc, xl[2], yl[2], off, y;
-    int i, j, k, sel = !BtnSol1->isChecked() && BtnSol2->isChecked() ? 1 : 0, p = 0;
-
-    trace(3, "DrawSol: level=%d\n", level);
-
-    if (BtnShowTrack->isChecked() && (BtnFixHoriz->isChecked() || BtnFixVert->isChecked())) {
-        pos = SolToPos(SolData + sel, SolIndex[sel], 0, type);
-
-        for (i = 0; i < 3 && pos->n > 0; i++) {
-            GraphG[i]->GetCent(xc, yc);
-            if (BtnFixVert->isChecked())
-                yc = i == 0 ? pos->x[0] : (i == 1 ? pos->y[0] : pos->z[0]);
-
+    QString label[]={tr("E-W"),tr("N-S"),tr("U-D")},unit[]={"m","m/s",QString("m/s%1").arg(up2Char)};
+    QPushButton *btn[]={BtnOn1,BtnOn2,BtnOn3};
+    TIMEPOS *pos,*pos1,*pos2;
+    gtime_t time1={0,0},time2={0,0};
+    QPoint p1,p2;
+    double xc,yc,xl[2],yl[2],off,y;
+    int i,j,k,sel=!BtnSol1->isChecked()&&BtnSol2->isChecked()?1:0,p=0;
+    
+    trace(3,"DrawSol: level=%d\n",level);
+    
+    if (BtnShowTrack->isChecked()&&(BtnFixHoriz->isChecked()||BtnFixVert->isChecked())) {
+        
+        pos=SolToPos(SolData+sel,SolIndex[sel],0,type);
+        
+        for (i=0;i<3&&pos->n>0;i++) {
+            GraphG[i]->GetCent(xc,yc);
+            if (BtnFixVert->isChecked()) {
+                yc=i==0?pos->x[0]:(i==1?pos->y[0]:pos->z[0]);
+            }
             if (BtnFixHoriz->isChecked()) {
-                GraphG[i]->GetLim(xl, yl);
-                off = Xcent * (xl[1] - xl[0]) / 2.0;
-                GraphG[i]->SetCent(TimePos(pos->t[0]) - off, yc);
-            } else {
-                GraphG[i]->SetCent(xc, yc);
+                GraphG[i]->GetLim(xl,yl);
+                off=Xcent*(xl[1]-xl[0])/2.0;
+                GraphG[i]->SetCent(TimePos(pos->t[0])-off,yc);
+            }
+            else {
+                GraphG[i]->SetCent(xc,yc);
             }
         }
         delete pos;
     }
-    j = -1;
-
-    for (i = 0; i < 3; i++) if (btn[i]->isChecked()) j = i;
-
-    for (i = 0; i < 3; i++) {
+    j=-1;
+    for (i=0;i<3;i++) if (btn[i]->isChecked()) j=i;
+    for (i=0;i<3;i++) {
         if (!btn[i]->isChecked()) continue;
-        GraphG[i]->XLPos = TimeLabel ? (i == j ? 6 : 5) : (i == j ? 1 : 0);
-        GraphG[i]->Week = Week;
-        GraphG[i]->DrawAxis(c, ShowLabel, ShowLabel);
+        GraphG[i]->XLPos=TimeLabel?(i==j?6:5):(i==j?1:0);
+        GraphG[i]->Week=Week;
+        GraphG[i]->DrawAxis(c,ShowLabel,ShowLabel);
     }
-
     if (BtnSol1->isChecked()) {
-        pos = SolToPos(SolData, -1, QFlag->currentIndex(), type);
-        DrawSolPnt(c, pos, level, 0);
-        DrawSolStat(c, pos, unit[type], p++);
-
+        pos=SolToPos(SolData,-1,QFlag->currentIndex(),type);
+        DrawSolPnt(c,pos,level,0);
+        DrawSolStat(c,pos,unit[type],p++);
         delete pos;
     }
-
     if (BtnSol2->isChecked()) {
-        pos = SolToPos(SolData + 1, -1, QFlag->currentIndex(), type);
-        DrawSolPnt(c, pos, level, 1);
-        DrawSolStat(c, pos, unit[type], p++);
-
+        pos=SolToPos(SolData+1,-1,QFlag->currentIndex(),type);
+        DrawSolPnt(c,pos,level,1);
+        DrawSolStat(c,pos,unit[type],p++);
         delete pos;
     }
-
     if (BtnSol12->isChecked()) {
-        pos1 = SolToPos(SolData, -1, 0, type);
-        pos2 = SolToPos(SolData + 1, -1, 0, type);
-        pos = pos1->diff(pos2, QFlag->currentIndex());
-        DrawSolPnt(c, pos, level, 0);
-        DrawSolStat(c, pos, unit[type], p++);
-
+        pos1=SolToPos(SolData  ,-1,0,type);
+        pos2=SolToPos(SolData+1,-1,0,type);
+        pos=pos1->diff(pos2,QFlag->currentIndex());
+        DrawSolPnt(c,pos,level,0);
+        DrawSolStat(c,pos,unit[type],p++);
         delete pos;
         delete pos1;
         delete pos2;
     }
-
-    if (BtnShowTrack->isChecked() && (BtnSol1->isChecked() || BtnSol2->isChecked() || BtnSol12->isChecked())) {
-        pos = SolToPos(SolData + sel, SolIndex[sel], 0, type);
-        pos1 = SolToPos(SolData, SolIndex[0], 0, type);
-        pos2 = SolToPos(SolData + 1, SolIndex[1], 0, type);
-        if (pos1->n > 0) time1 = pos1->t[0];
-        if (pos2->n > 0) time2 = pos2->t[0];
-
-        for (j = k = 0; j < 3 && pos->n > 0; j++) {
+    if (BtnShowTrack->isChecked()&&(BtnSol1->isChecked()||BtnSol2->isChecked()||BtnSol12->isChecked())) {
+        
+        pos =SolToPos(SolData+sel,SolIndex[sel],0,type);
+        pos1=SolToPos(SolData    ,SolIndex[0]  ,0,type);
+        pos2=SolToPos(SolData+1  ,SolIndex[1]  ,0,type);
+        if (pos1->n>0) time1=pos1->t[0];
+        if (pos2->n>0) time2=pos2->t[0];
+        
+        for (j=k=0;j<3&&pos->n>0;j++) {
+            
             if (!btn[j]->isChecked()) continue;
-
-            GraphG[j]->GetLim(xl, yl);
-            xl[0] = xl[1] = TimePos(pos->t[0]);
-            GraphG[j]->DrawPoly(c, xl, yl, 2, CColor[2], 0);
-
-            if (BtnSol2->isChecked() && pos2->n > 0 && (time1.time == 0 || fabs(timediff(time1, time2)) < DTTOL * 2.0)) {
-                xl[0] = xl[1] = TimePos(time2);
-                y = j == 0 ? pos2->x[0] : (j == 1 ? pos2->y[0] : pos2->z[0]);
-
-                GraphG[j]->DrawMark(c, xl[0], y, 0, CColor[0], MarkSize * 2 + 6, 0);
-                GraphG[j]->DrawMark(c, xl[0], y, 1, CColor[1], MarkSize * 2 + 6, 0);
-                GraphG[j]->DrawMark(c, xl[0], y, 1, CColor[2], MarkSize * 2 + 2, 0);
-                GraphG[j]->DrawMark(c, xl[0], y, 0, MColor[1][pos->q[0]], MarkSize * 2, 0);
-
-                if (BtnSol1->isChecked() && pos1->n > 0 && GraphG[j]->ToPoint(xl[0], y, p1)) {
-                    p1.rx() += MarkSize + 4;
-                    DrawLabel(GraphG[j], c, p1, "2", 1, 0);
+            
+            GraphG[j]->GetLim(xl,yl);
+            xl[0]=xl[1]=TimePos(pos->t[0]);
+            GraphG[j]->DrawPoly(c,xl,yl,2,CColor[2],0);
+            
+            if (BtnSol2->isChecked()&&pos2->n>0&&(time1.time==0||fabs(timediff(time1,time2))<DTTOL*2.0)) {
+                xl[0]=xl[1]=TimePos(time2);
+                y=j==0?pos2->x[0]:(j==1?pos2->y[0]:pos2->z[0]);
+                GraphG[j]->DrawMark(c,xl[0],y,0,CColor[0],MarkSize*2+6,0);
+                GraphG[j]->DrawMark(c,xl[0],y,1,CColor[1],MarkSize*2+6,0);
+                GraphG[j]->DrawMark(c,xl[0],y,1,CColor[2],MarkSize*2+2,0);
+                GraphG[j]->DrawMark(c,xl[0],y,0,MColor[1][pos->q[0]],MarkSize*2,0);
+                if (BtnSol1->isChecked()&&pos1->n>0&&GraphG[j]->ToPoint(xl[0],y,p1)) {
+                    p1.rx()+=MarkSize+4;
+                    DrawLabel(GraphG[j],c,p1,"2",1,0);
                 }
             }
-            if (BtnSol1->isChecked() && pos1->n > 0) {
-                xl[0] = xl[1] = TimePos(time1);
-                y = j == 0 ? pos1->x[0] : (j == 1 ? pos1->y[0] : pos1->z[0]);
-
-                GraphG[j]->DrawMark(c, xl[0], y, 0, CColor[0], MarkSize * 2 + 6, 0);
-                GraphG[j]->DrawMark(c, xl[0], y, 1, CColor[2], MarkSize * 2 + 6, 0);
-                GraphG[j]->DrawMark(c, xl[0], y, 1, CColor[2], MarkSize * 2 + 2, 0);
-                GraphG[j]->DrawMark(c, xl[0], y, 0, MColor[0][pos->q[0]], MarkSize * 2, 0);
-
-                if (BtnSol2->isChecked() && pos2->n > 0 && GraphG[j]->ToPoint(xl[0], y, p1)) {
-                    p1.rx() += MarkSize + 4;
-                    DrawLabel(GraphG[j], c, p1, "1", 1, 0);
+            if (BtnSol1->isChecked()&&pos1->n>0) {
+                xl[0]=xl[1]=TimePos(time1);
+                y=j==0?pos1->x[0]:(j==1?pos1->y[0]:pos1->z[0]);
+                GraphG[j]->DrawMark(c,xl[0],y,0,CColor[0],MarkSize*2+6,0);
+                GraphG[j]->DrawMark(c,xl[0],y,1,CColor[2],MarkSize*2+6,0);
+                GraphG[j]->DrawMark(c,xl[0],y,1,CColor[2],MarkSize*2+2,0);
+                GraphG[j]->DrawMark(c,xl[0],y,0,MColor[0][pos->q[0]],MarkSize*2,0);
+                if (BtnSol2->isChecked()&&pos2->n>0&&GraphG[j]->ToPoint(xl[0],y,p1)) {
+                    p1.rx()+=MarkSize+4;
+                    DrawLabel(GraphG[j],c,p1,"1",1,0);
                 }
             }
-            xl[0] = xl[1] = TimePos(pos->t[0]);
-            if (k++ == 0) {
-                GraphG[j]->DrawMark(c, xl[0], yl[1] - 1E-6, 0, CColor[2], 5, 0);
-
-                if (!BtnFixHoriz->isChecked())
-                    GraphG[j]->DrawMark(c, xl[0], yl[1] - 1E-6, 1, CColor[2], 9, 0);
+            xl[0]=xl[1]=TimePos(pos->t[0]);
+            if (k++==0) {
+                GraphG[j]->DrawMark(c,xl[0],yl[1]-1E-6,0,CColor[2],5,0);
+                
+                if (!BtnFixHoriz->isChecked()) {
+                    GraphG[j]->DrawMark(c,xl[0],yl[1]-1E-6,1,CColor[2],9,0);
+                }
             }
         }
-
         delete pos;
         delete pos1;
         delete pos2;
     }
-    for (i = 0; i < 3; i++) {
+    for (i=0;i<3;i++) {
         if (!btn[i]->isChecked()) continue;
-        GraphG[i]->GetPos(p1, p2);
-        p1.rx() += 5; p1.ry() += 3;
-        DrawLabel(GraphG[i], c, p1, label[i] + " (" + unit[type] + ")", 1, 2);
+        GraphG[i]->GetPos(p1,p2);
+        p1.rx()+=5; p1.ry()+=3;
+        DrawLabel(GraphG[i],c,p1,label[i]+" ("+unit[type]+")",1,2);
     }
 }
 // draw points and line on solution-plot ------------------------------------
-void Plot::DrawSolPnt(QPainter &c, const TIMEPOS *pos, int level, int style)
+void Plot::DrawSolPnt(QPainter &c,const TIMEPOS *pos, int level, int style)
 {
-    QPushButton *btn[] = { BtnOn1, BtnOn2, BtnOn3 };
-    double *x, *y, *s, xs, ys, *yy;
-    int i, j;
-
-    trace(3, "DrawSolPnt: level=%d style=%d\n", level, style);
-
-    x = new double [pos->n];
-
-    for (i = 0; i < pos->n; i++)
-        x[i] = TimePos(pos->t[i]);
-
-    for (i = 0; i < 3; i++) {
+    QPushButton *btn[]={BtnOn1,BtnOn2,BtnOn3};
+    double *x,*y,*s,xs,ys,*yy;
+    int i,j;
+    
+    trace(3,"DrawSolPnt: level=%d style=%d\n",level,style);
+    
+    x=new double [pos->n];
+    
+    for (i=0;i<pos->n;i++) {
+        x[i]=TimePos(pos->t[i]);
+    }
+    for (i=0;i<3;i++) {
         if (!btn[i]->isChecked()) continue;
-
-        y = i == 0 ? pos->x : (i == 1 ? pos->y : pos->z);
-        s = i == 0 ? pos->xs : (i == 1 ? pos->ys : pos->zs);
-
-        if (!level || !(PlotStyle % 2))
-            DrawPolyS(GraphG[i], c, x, y, pos->n, CColor[3], style);
-
-        if (level && ShowErr && PlotType <= PLOT_SOLA && PlotStyle < 2) {
-            GraphG[i]->GetScale(xs, ys);
-
-            if (ShowErr == 1) {
-                for (j = 0; j < pos->n; j++)
-                    GraphG[i]->DrawMark(c, x[j], y[j], 12, CColor[1], static_cast<int>(SQRT(s[j]) * 2.0 / ys), 0);
-            } else {
-                yy = new double [pos->n];
-
-                for (j = 0; j < pos->n; j++) yy[j] = y[j] - SQRT(s[j]);
-                DrawPolyS(GraphG[i], c, x, yy, pos->n, CColor[1], 1);
-
-                for (j = 0; j < pos->n; j++) yy[j] = y[j] + SQRT(s[j]);
-                DrawPolyS(GraphG[i], c, x, yy, pos->n, CColor[1], 1);
-
+        
+        y=i==0?pos->x :(i==1?pos->y :pos->z );
+        s=i==0?pos->xs:(i==1?pos->ys:pos->zs);
+        
+        if (!level||!(PlotStyle%2)) {
+            DrawPolyS(GraphG[i],c,x,y,pos->n,CColor[3],style);
+        }
+        if (level&&ShowErr&&PlotType<=PLOT_SOLA&&PlotStyle<2) {
+            
+            GraphG[i]->GetScale(xs,ys);
+            
+            if (ShowErr==1) {
+                for (j=0;j<pos->n;j++) {
+                    GraphG[i]->DrawMark(c,x[j],y[j],12,CColor[1],static_cast<int>(SQRT(s[j])*2.0/ys),0);
+                }
+            }
+            else {
+                yy=new double [pos->n];
+                
+                for (j=0;j<pos->n;j++) yy[j]=y[j]-SQRT(s[j]);
+                DrawPolyS(GraphG[i],c,x,yy,pos->n,CColor[1],1);
+                
+                for (j=0;j<pos->n;j++) yy[j]=y[j]+SQRT(s[j]);
+                DrawPolyS(GraphG[i],c,x,yy,pos->n,CColor[1],1);
+                
                 delete [] yy;
             }
         }
-        if (level && PlotStyle < 2) {
+        if (level&&PlotStyle<2) {
             QVector<QColor> color;
-            for (j = 0; j < pos->n; j++) color.append(MColor[style][pos->q[j]]);
-            GraphG[i]->DrawMarks(c, x, y, color, pos->n, 0, MarkSize, 0);
+            for (j=0;j<pos->n;j++) color.append(MColor[style][pos->q[j]]);
+            GraphG[i]->DrawMarks(c,x,y,color,pos->n,0,MarkSize,0);
         }
     }
     delete [] x;
 }
 // draw statistics on solution-plot -----------------------------------------
-void Plot::DrawSolStat(QPainter &c, const TIMEPOS *pos, const QString &unit, int p)
+void Plot::DrawSolStat(QPainter &c,const TIMEPOS *pos, const QString &unit, int p)
 {
-    QPushButton *btn[] = { BtnOn1, BtnOn2, BtnOn3 };
-    QPoint p1, p2;
-    double ave, std, rms, *y, opos[3];
-    int i, j = 0, k = 0, fonth = static_cast<int>(Disp->font().pointSize() * 1.5);
-    QString label, s;
-
-    trace(3, "DrawSolStat: p=%d\n", p);
-
-    if (!ShowStats || pos->n <= 0) return;
-
-    for (i = 0; i < 3; i++) {
+    QPushButton *btn[]={BtnOn1,BtnOn2,BtnOn3};
+    QPoint p1,p2;
+    double ave,std,rms,*y,opos[3];
+    int i,j=0,k=0,fonth=static_cast<int>(Disp->font().pointSize()*1.5);
+    QString label,s;
+    
+    trace(3,"DrawSolStat: p=%d\n",p);
+    
+    if (!ShowStats||pos->n<=0) return;
+    
+    for (i=0;i<3;i++) {
         if (!btn[i]->isChecked()) continue;
-
-        y = i == 0 ? pos->x : (i == 1 ? pos->y : pos->z);
-        CalcStats(y, pos->n, 0.0, ave, std, rms);
-        GraphG[i]->GetPos(p1, p2);
-        p1.rx() = p2.x() - 5;
-        p1.ry() += 3 + fonth * (p + (!k++ && p > 0 ? 1 : 0));
-
-        if (j == 0 && p == 0) {
-            if (norm(OPos, 3) > 0.0) {
-                ecef2pos(OPos, opos);
-                label = "ORI=" + LatLonStr(opos, 9) + QString(" %1m").arg(opos[2], 0, 'f', 4);
-                DrawLabel(GraphG[j], c, p1, label, 2, 2);
-                j++; p1.ry() += fonth;
+        
+        y=i==0?pos->x:(i==1?pos->y:pos->z);
+        CalcStats(y,pos->n,0.0,ave,std,rms);
+        GraphG[i]->GetPos(p1,p2);
+        p1.rx()=p2.x()-5;
+        p1.ry()+=3+fonth*(p+(!k++&&p>0?1:0));
+        
+        if (j==0&&p==0) {
+            
+            if (norm(OPos,3)>0.0) {
+                ecef2pos(OPos,opos);
+                label="ORI="+LatLonStr(opos,9)+QString(" %1m").arg(opos[2],0,'f',4);
+                DrawLabel(GraphG[j],c,p1,label,2,2);
+                j++; p1.ry()+=fonth;
             }
         }
-        s = QString("AVE=%1%2 STD=%3%2 RMS=%4%2").arg(ave, 0, 'f', 4).arg(unit).arg(std, 0, 'f', 4).arg(rms, 0, 'f', 4);
-        DrawLabel(GraphG[i], c, p1, s, 2, 2);
+        s=QString("AVE=%1%2 STD=%3%2 RMS=%4%2").arg(ave,0,'f',4).arg(unit).arg(std,0,'f',4).arg(rms,0,'f',4);
+        DrawLabel(GraphG[i],c,p1,s,2,2);
     }
 }
 // draw number-of-satellite plot --------------------------------------------
-void Plot::DrawNsat(QPainter &c, int level)
+void Plot::DrawNsat(QPainter &c,int level)
 {
-    QString label[] = {
+    QString label[]={
         tr("# of Valid Satellites"),
         tr("Age of Differential (s)"),
         tr("Ratio Factor for AR Validation")
     };
-    QPushButton *btn[] = { BtnOn1, BtnOn2, BtnOn3 };
+    QPushButton *btn[]={BtnOn1,BtnOn2,BtnOn3};
     TIMEPOS *ns;
-    QPoint p1, p2;
-    double xc, yc, y, xl[2], yl[2], off;
-    int i, j, k, sel = !BtnSol1->isChecked() && BtnSol2->isChecked() ? 1 : 0;
-
-    trace(3, "DrawNsat: level=%d\n", level);
-
-    if (BtnShowTrack->isChecked() && BtnFixHoriz->isChecked()) {
-        ns = SolToNsat(SolData + sel, SolIndex[sel], 0);
-
-        for (i = 0; i < 3; i++) {
+    QPoint p1,p2;
+    double xc,yc,y,xl[2],yl[2],off;
+    int i,j,k,sel=!BtnSol1->isChecked()&&BtnSol2->isChecked()?1:0;
+    
+    trace(3,"DrawNsat: level=%d\n",level);
+    
+    if (BtnShowTrack->isChecked()&&BtnFixHoriz->isChecked()) {
+        
+        ns=SolToNsat(SolData+sel,SolIndex[sel],0);
+        
+        for (i=0;i<3;i++) {
             if (BtnFixHoriz->isChecked()) {
-                GraphG[i]->GetLim(xl, yl);
-                off = Xcent * (xl[1] - xl[0]) / 2.0;
-                GraphG[i]->GetCent(xc, yc);
-                GraphG[i]->SetCent(TimePos(ns->t[0]) - off, yc);
-            } else {
-                GraphG[i]->GetRight(xc, yc);
-                GraphG[i]->SetRight(TimePos(ns->t[0]), yc);
+                GraphG[i]->GetLim(xl,yl);
+                off=Xcent*(xl[1]-xl[0])/2.0;
+                GraphG[i]->GetCent(xc,yc);
+                GraphG[i]->SetCent(TimePos(ns->t[0])-off,yc);
+            }
+            else {
+                GraphG[i]->GetRight(xc,yc);
+                GraphG[i]->SetRight(TimePos(ns->t[0]),yc);
             }
         }
         delete ns;
     }
-    j = -1;
-    for (i = 0; i < 3; i++) if (btn[i]->isChecked()) j = i;
-    for (i = 0; i < 3; i++) {
+    j=-1;
+    for (i=0;i<3;i++) if (btn[i]->isChecked()) j=i;
+    for (i=0;i<3;i++) {
         if (!btn[i]->isChecked()) continue;
-        GraphG[i]->XLPos = TimeLabel ? (i == j ? 6 : 5) : (i == j ? 1 : 0);
-        GraphG[i]->Week = Week;
-        GraphG[i]->DrawAxis(c, ShowLabel, ShowLabel);
+        GraphG[i]->XLPos=TimeLabel?(i==j?6:5):(i==j?1:0);
+        GraphG[i]->Week=Week;
+        GraphG[i]->DrawAxis(c,ShowLabel,ShowLabel);
     }
-
     if (BtnSol1->isChecked()) {
-        ns = SolToNsat(SolData, -1, QFlag->currentIndex());
-        DrawSolPnt(c, ns, level, 0);
+        ns=SolToNsat(SolData,-1,QFlag->currentIndex());
+        DrawSolPnt(c,ns,level,0);
         delete ns;
     }
-
     if (BtnSol2->isChecked()) {
-        ns = SolToNsat(SolData + 1, -1, QFlag->currentIndex());
-        DrawSolPnt(c, ns, level, 1);
+        ns=SolToNsat(SolData+1,-1,QFlag->currentIndex());
+        DrawSolPnt(c,ns,level,1);
         delete ns;
     }
-
-    if (BtnShowTrack->isChecked() && (BtnSol1->isChecked() || BtnSol2->isChecked())) {
-        ns = SolToNsat(SolData + sel, SolIndex[sel], 0);
-
-        for (j = k = 0; j < 3 && ns->n > 0; j++) {
+    if (BtnShowTrack->isChecked()&&(BtnSol1->isChecked()||BtnSol2->isChecked())) {
+        
+        ns=SolToNsat(SolData+sel,SolIndex[sel],0);
+        
+        for (j=k=0;j<3&&ns->n>0;j++) {
+            
             if (!btn[j]->isChecked()) continue;
-
-            y = j == 0 ? ns->x[0] : (j == 1 ? ns->y[0] : ns->z[0]);
-            GraphG[j]->GetLim(xl, yl);
-            xl[0] = xl[1] = TimePos(ns->t[0]);
-
-            GraphG[j]->DrawPoly(c, xl, yl, 2, CColor[2], 0);
-            GraphG[j]->DrawMark(c, xl[0], y, 0, CColor[0], MarkSize * 2 + 6, 0);
-            GraphG[j]->DrawMark(c, xl[0], y, 1, CColor[2], MarkSize * 2 + 6, 0);
-            GraphG[j]->DrawMark(c, xl[0], y, 1, CColor[2], MarkSize * 2 + 2, 0);
-            GraphG[j]->DrawMark(c, xl[0], y, 0, MColor[sel][ns->q[0]], MarkSize * 2, 0);
-
-            if (k++ == 0) {
-                GraphG[j]->DrawMark(c, xl[0], yl[1] - 1E-6, 0, CColor[2], 5, 0);
-
-                if (!BtnFixHoriz->isChecked())
-                    GraphG[j]->DrawMark(c, xl[0], yl[1] - 1E-6, 1, CColor[2], 9, 0);
+            
+            y=j==0?ns->x[0]:(j==1?ns->y[0]:ns->z[0]);
+            GraphG[j]->GetLim(xl,yl);
+            xl[0]=xl[1]=TimePos(ns->t[0]);
+            
+            GraphG[j]->DrawPoly(c,xl,yl,2,CColor[2],0);
+            GraphG[j]->DrawMark(c,xl[0],y,0,CColor[0],MarkSize*2+6,0);
+            GraphG[j]->DrawMark(c,xl[0],y,1,CColor[2],MarkSize*2+6,0);
+            GraphG[j]->DrawMark(c,xl[0],y,1,CColor[2],MarkSize*2+2,0);
+            GraphG[j]->DrawMark(c,xl[0],y,0,MColor[sel][ns->q[0]],MarkSize*2,0);
+            
+            if (k++==0) {
+                GraphG[j]->DrawMark(c,xl[0],yl[1]-1E-6,0,CColor[2],5,0);
+                
+                if (!BtnFixHoriz->isChecked()) {
+                    GraphG[j]->DrawMark(c,xl[0],yl[1]-1E-6,1,CColor[2],9,0);
+                }
             }
         }
         delete ns;
     }
-    for (i = 0; i < 3; i++) {
+    for (i=0;i<3;i++) {
         if (!btn[i]->isChecked()) continue;
-        GraphG[i]->GetPos(p1, p2);
-        p1.rx() += 5; p1.ry() += 3;
-        DrawLabel(GraphG[i], c, p1, label[i], 1, 2);
+        GraphG[i]->GetPos(p1,p2);
+        p1.rx()+=5; p1.ry()+=3;
+        DrawLabel(GraphG[i],c,p1,label[i],1,2);
     }
 }
 // draw observation-data-plot -----------------------------------------------
-void Plot::DrawObs(QPainter &c, int level)
+void Plot::DrawObs(QPainter &c,int level)
 {
     QString label;
-    QPoint p1, p2, p;
+    QPoint p1,p2,p;
     gtime_t time;
     obsd_t *obs;
-    double xs, ys, xt, xl[2], yl[2], tt[MAXSAT] = { 0 }, xp, xc, yc, yp[MAXSAT] = { 0 };
-    int i, j, m = 0, sats[MAXSAT] = { 0 }, ind = ObsIndex;
+    double xs,ys,xt,xl[2],yl[2],tt[MAXSAT]={0},xp,xc,yc,yp[MAXSAT]={0};
+    int i,j,m=0,sats[MAXSAT]={0},ind=ObsIndex;
     char id[16];
-
-    trace(3, "DrawObs: level=%d\n", level);
-
-    for (i = 0; i < Obs.n; i++) {
-        if (SatMask[Obs.data[i].sat - 1]) continue;
-        sats[Obs.data[i].sat - 1] = 1;
+    
+    trace(3,"DrawObs: level=%d\n",level);
+    
+    for (i=0;i<Obs.n;i++) {
+        if (SatMask[Obs.data[i].sat-1]) continue;
+        sats[Obs.data[i].sat-1]=1;
     }
-    for (i = 0; i < MAXSAT; i++) if (sats[i]) m++;
-
-    GraphR->XLPos = TimeLabel ? 6 : 1;
-    GraphR->YLPos = 0;
-    GraphR->Week = Week;
-    GraphR->GetLim(xl, yl);
-    yl[0] = 0.5;
-    yl[1] = m > 0 ? m + 0.5 : m + 10.5;
-    GraphR->SetLim(xl, yl);
-    GraphR->SetTick(0.0, 1.0);
-
-    if (0 <= ind && ind < NObs && BtnShowTrack->isChecked() && BtnFixHoriz->isChecked()) {
-        xp = TimePos(Obs.data[IndexObs[ind]].time);
+    for (i=0;i<MAXSAT;i++) if (sats[i]) m++;
+    
+    GraphR->XLPos=TimeLabel?6:1; 
+    GraphR->YLPos=0;
+    GraphR->Week=Week;
+    GraphR->GetLim(xl,yl);
+    yl[0]=0.5;
+    yl[1]=m>0?m+0.5:m+10.5;
+    GraphR->SetLim(xl,yl);
+    GraphR->SetTick(0.0,1.0);
+    
+    if (0<=ind&&ind<NObs&&BtnShowTrack->isChecked()&&BtnFixHoriz->isChecked()) {
+        xp=TimePos(Obs.data[IndexObs[ind]].time);
         if (BtnFixHoriz->isChecked()) {
-            double xl[2], yl[2], off;
-            GraphR->GetLim(xl, yl);
-            off = Xcent * (xl[1] - xl[0]) / 2.0;
-            GraphR->GetCent(xc, yc);
-            GraphR->SetCent(xp - off, yc);
-        } else {
-            GraphR->GetRight(xc, yc);
-            GraphR->SetRight(xp, yc);
+            double xl[2],yl[2],off;
+            GraphR->GetLim(xl,yl);
+            off=Xcent*(xl[1]-xl[0])/2.0;
+            GraphR->GetCent(xc,yc);
+            GraphR->SetCent(xp-off,yc);
+        }
+        else {
+            GraphR->GetRight(xc,yc);
+            GraphR->SetRight(xp,yc);
         }
     }
-    GraphR->DrawAxis(c, 1, 1);
-    GraphR->GetPos(p1, p2);
-
-    for (i = 0, j = 0; i < MAXSAT; i++) {
+    GraphR->DrawAxis(c,1,1);
+    GraphR->GetPos(p1,p2);
+    
+    for (i=0,j=0;i<MAXSAT;i++) {
         if (!sats[i]) continue;
         p.setX(p1.x());
-        p.setY(p1.y() + static_cast<int>((p2.y() - p1.y()) * (j + 0.5) / m));
-        yp[i] = m - (j++);
-        satno2id(i + 1, id);
-        label = id;
-        GraphR->DrawText(c, p, label, CColor[2], 2, 0, 0);
+        p.setY(p1.y()+static_cast<int>((p2.y()-p1.y())*(j+0.5)/m));
+        yp[i]=m-(j++);
+        satno2id(i+1,id);
+        label=id;
+        GraphR->DrawText(c,p,label,CColor[2],2,0,0);
     }
     p1.setX(Disp->font().pointSize());
-    p1.setY((p1.y() + p2.y()) / 2);
-    GraphR->DrawText(c, p1, tr("SATELLITE NO"), CColor[2], 0, 0, 90);
-
+    p1.setY((p1.y()+p2.y())/2);
+    GraphR->DrawText(c,p1,tr("SATELLITE NO"),CColor[2],0,0,90);
+    
     if (!BtnSol1->isChecked()) return;
-
-    if (level && PlotStyle <= 2)
-        DrawObsEphem(c, yp);
-
-    if (level && PlotStyle <= 2) {
-        GraphR->GetScale(xs, ys);
-        for (i = 0; i < Obs.n; i++) {
-            obs = &Obs.data[i];
-            QColor col = ObsColor(obs, Az[i], El[i]);
-            if (col == Qt::black) continue;
-
-            xt = TimePos(obs->time);
-            if (fabs(xt - tt[obs->sat - 1]) / xs > 0.9) {
-                GraphR->DrawMark(c, xt, yp[obs->sat - 1], 0, PlotStyle < 2 ? col : CColor[3],
-                         PlotStyle < 2 ? MarkSize : 0, 0);
-                tt[obs->sat - 1] = xt;
+    
+    if (level&&PlotStyle<=2) {
+        DrawObsEphem(c,yp);
+    }
+    if (level&&PlotStyle<=2) {
+        GraphR->GetScale(xs,ys);
+        for (i=0;i<Obs.n;i++) {
+            obs=&Obs.data[i];
+            QColor col=ObsColor(obs,Az[i],El[i]);
+            if (col==Qt::black) continue;
+            
+            xt=TimePos(obs->time);
+            if (fabs(xt-tt[obs->sat-1])/xs>0.9) {
+                GraphR->DrawMark(c,xt,yp[obs->sat-1],0,PlotStyle<2?col:CColor[3],
+                                 PlotStyle<2?MarkSize:0,0);
+                tt[obs->sat-1]=xt;
             }
         }
     }
-    if (level && PlotStyle <= 2)
-        DrawObsSlip(c, yp);
-
-    if (BtnShowTrack->isChecked() && 0 <= ind && ind < NObs) {
-        i = IndexObs[ind];
-        time = Obs.data[i].time;
-
-        GraphR->GetLim(xl, yl);
-        xl[0] = xl[1] = TimePos(Obs.data[i].time);
-        GraphR->DrawPoly(c, xl, yl, 2, CColor[2], 0);
-
-        for (; i < Obs.n && timediff(Obs.data[i].time, time) == 0.0; i++) {
-            obs = &Obs.data[i];
-            QColor col = ObsColor(obs, Az[i], El[i]);
-            if (col == Qt::black) continue;
-            GraphR->DrawMark(c, xl[0], yp[obs->sat - 1], 0, col, MarkSize * 2 + 2, 0);
+    if (level&&PlotStyle<=2) {
+        DrawObsSlip(c,yp);
+    }
+    if (BtnShowTrack->isChecked()&&0<=ind&&ind<NObs) {
+        i=IndexObs[ind];
+        time=Obs.data[i].time;
+        
+        GraphR->GetLim(xl,yl);
+        xl[0]=xl[1]=TimePos(Obs.data[i].time);
+        GraphR->DrawPoly(c,xl,yl,2,CColor[2],0);
+        
+        for (;i<Obs.n&&timediff(Obs.data[i].time,time)==0.0;i++) {
+            obs=&Obs.data[i];
+            QColor col=ObsColor(obs,Az[i],El[i]);
+            if (col==Qt::black) continue;
+            GraphR->DrawMark(c,xl[0],yp[obs->sat-1],0,col,MarkSize*2+2,0);
+        }
+        GraphR->DrawMark(c,xl[0],yl[1]-1E-6,0,CColor[2],5,0);
+        if (!BtnFixHoriz->isChecked()) {
+            GraphR->DrawMark(c,xl[0],yl[1]-1E-6,1,CColor[2],9,0);
         }
-        GraphR->DrawMark(c, xl[0], yl[1] - 1E-6, 0, CColor[2], 5, 0);
-        if (!BtnFixHoriz->isChecked())
-            GraphR->DrawMark(c, xl[0], yl[1] - 1E-6, 1, CColor[2], 9, 0);
     }
 }
 // draw slip on observation-data-plot ---------------------------------------
-void Plot::DrawObsSlip(QPainter &c, double *yp)
+void Plot::DrawObsSlip(QPainter &c,double *yp)
 {
-    QString ObsTypeText = ObsType->currentText();
+    QString ObsTypeText=ObsType->currentText();
     obsd_t *obs;
     QPoint ps[2];
-    double gfp[MAXSAT] = { 0 }, gf;
+    double gfp[MAXSAT]={0},gf;
     char code[32];
-    int i, j, slip;
-
-    trace(3, "DrawObsSlip\n");
-
-    strncpy(code, ObsType->currentIndex() ? qPrintable(ObsTypeText) + 1 : "", 32);
-
-    if (ShowHalfC) {
-        for (i = 0; i < Obs.n; i++) {
-            if (El[i] < ElMask * D2R) continue;
-            if (ElMaskP && El[i] < ElMaskData[(int)(Az[i] * R2D + 0.5)]) continue;
-            obs = &Obs.data[i];
-            if (!SatSel[obs->sat-1]) continue;
-            slip = 0;
-            for (j = 0; j < NFREQ + NEXOBS; j++)
-                if ((!*code || strstr(code2obs(obs->code[j], NULL), code)) &&
-                    (obs->LLI[j] & 2)) slip = 1;
-            if (!slip) continue;
-            if (!GraphR->ToPoint(TimePos(obs->time), yp[obs->sat-1], ps[0])) continue;
-            ps[1].setX(ps[0].x());
-            ps[1].setY(ps[0].y() + MarkSize * 3 / 2 + 1);
-            ps[0].setY(ps[0].y() - MarkSize * 3 / 2);
-            GraphR->DrawPoly(c, ps, 2, MColor[0][0], 0);
+    int i,j,slip;
+    
+    trace(3,"DrawObsSlip\n");
+    
+    strncpy(code,ObsType->currentIndex()?qPrintable(ObsTypeText)+1:"",32);
+    
+    for (i=0;i<Obs.n;i++) {
+        if (El[i]<ElMask*D2R) continue;
+        if (ElMaskP&&El[i]<ElMaskData[static_cast<int>(Az[i]*R2D+0.5)]) continue;
+        obs=&Obs.data[i];
+        if (!SatSel[obs->sat-1]) continue;
+            
+        if (!GraphR->ToPoint(TimePos(obs->time),yp[obs->sat-1],ps[0])) continue;
+        ps[1].rx()=ps[0].x();
+        ps[1].ry()=ps[0].y()+MarkSize*3/2+1;
+        ps[0].ry()=ps[0].y()-MarkSize*3/2;
+        
+        if (ShowHalfC) {
+            slip=0;
+            for (j=0;j<NFREQ+NEXOBS;j++) {
+                if ((!*code||strstr(code2obs(obs->code[j],NULL),code))&&
+                    (obs->LLI[j]&2)) slip=1;
+            }
+            if (slip) GraphR->DrawPoly(c,ps,2,MColor[0][0],0);
         }
-    }
-    if (ShowSlip) {
-        for (i = 0; i < Obs.n; i++) {
-            if (El[i] < ElMask * D2R) continue;
-            if (ElMaskP && El[i] < ElMaskData[(int)(Az[i] * R2D + 0.5)]) continue;
-            obs = &Obs.data[i];
-            if (!SatSel[obs->sat-1]) continue;
-            slip = 0;
-            if (ShowSlip == 2) { // LLI
-                for (j = 0; j < NFREQ + NEXOBS; j++)
-                    if ((!*code || strstr(code2obs(obs->code[j], NULL), code)) &&
-                        (obs->LLI[j] & 1)) slip = 1;
-            } else if (!*code || !strcmp(code, "1") || !strcmp(code, "2")) {
-                if (obs->L[0] != 0.0 && obs->L[1] != 0.0 &&
-                    satsys(obs->sat, NULL) != SYS_GLO) {
-                    gf = CLIGHT * (obs->L[0] / FREQ1 - obs->L[1] / FREQ2);
-                    if (fabs(gfp[obs->sat - 1] - gf) > THRESLIP) slip = 1;
-                    gfp[obs->sat - 1] = gf;
+        if (ShowSlip) {
+            slip=0;
+            if (ShowSlip==2) { // LLI
+                for (j=0;j<NFREQ+NEXOBS;j++) {
+                    if ((!*code||strstr(code2obs(obs->code[j],NULL),code))&&
+                        (obs->LLI[j]&1)) slip=1;
                 }
             }
-            if (!slip) continue;
-            if (!GraphR->ToPoint(TimePos(obs->time), yp[obs->sat-1], ps[0])) continue;
-            ps[1].setX(ps[0].x());
-            ps[1].setY(ps[0].y() + MarkSize * 3 / 2 + 1);
-            ps[0].setY(ps[0].y() - MarkSize * 3 / 2);
-            GraphR->DrawPoly(c, ps, 2, MColor[0][5], 0);
+            else if (!*code||!strcmp(code,"1")||!strcmp(code,"2")) {
+                if (obs->L[0]!=0.0&&obs->L[1]!=0.0&&
+                    satsys(obs->sat,NULL)!=SYS_GLO) {
+                    gf=CLIGHT*(obs->L[0]/FREQ1-obs->L[1]/FREQ2);
+                    if (fabs(gfp[obs->sat-1]-gf)>THRESLIP) slip=1;
+                    gfp[obs->sat-1]=gf;
+                }
+            }
+            if (slip) GraphR->DrawPoly(c,ps,2,MColor[0][5],0);
         }
     }
 }
 // draw ephemeris on observation-data-plot ----------------------------------
-void Plot::DrawObsEphem(QPainter &c, double *yp)
+void Plot::DrawObsEphem(QPainter &c,double *yp)
 {
     QPoint ps[3];
-    int i, j, k, in, svh, off[MAXSAT] = { 0 };
-
-    trace(3, "DrawObsEphem\n");
-
+    int i,j,k,in,svh,off[MAXSAT]={0};
+    
+    trace(3,"DrawObsEphem\n");
+    
     if (!ShowEph) return;
-
-    for (i = 0; i < MAXSAT; i++) {
+    
+    for (i=0;i<MAXSAT;i++) {
         if (!SatSel[i]) continue;
-        for (j = 0; j < Nav.n; j++) {
-            if (Nav.eph[j].sat != i + 1) continue;
-            GraphR->ToPoint(TimePos(Nav.eph[j].ttr), yp[i], ps[0]);
-            in = GraphR->ToPoint(TimePos(Nav.eph[j].toe), yp[i], ps[2]);
-            ps[1] = ps[0];
-            off[Nav.eph[j].sat - 1] = off[Nav.eph[j].sat - 1] ? 0 : 3;
-
-            for (k = 0; k < 3; k++) ps[k].ry() += MarkSize + 2 + off[Nav.eph[j].sat - 1];
-            ps[0].ry() -= 2;
-
-            svh = Nav.eph[j].svh;
-            if (satsys(i + 1, NULL) == SYS_QZS) svh &= 0xFE; /* mask QZS LEX health */
-
-            GraphR->DrawPoly(c, ps, 3, svh ? MColor[0][5] : CColor[1], 0);
-
-            if (in) GraphR->DrawMark(c, ps[2], 0, svh ? MColor[0][5] : CColor[1], svh ? 4 : 3, 0);
+        for (j=0;j<Nav.n;j++) {
+            if (Nav.eph[j].sat!=i+1) continue;
+            GraphR->ToPoint(TimePos(Nav.eph[j].ttr),yp[i],ps[0]);
+            in=GraphR->ToPoint(TimePos(Nav.eph[j].toe),yp[i],ps[2]);
+            ps[1]=ps[0];
+            off[Nav.eph[j].sat-1]=off[Nav.eph[j].sat-1]?0:3;
+            
+            for (k=0;k<3;k++) ps[k].ry()+=MarkSize+2+off[Nav.eph[j].sat-1];
+            ps[0].ry()-=2;
+            
+            svh=Nav.eph[j].svh;
+            if (satsys(i+1,NULL)==SYS_QZS) svh&=0xFE; /* mask QZS LEX health */
+            
+            GraphR->DrawPoly(c,ps,3,svh?MColor[0][5]:CColor[1],0);
+            
+            if (in) GraphR->DrawMark(c,ps[2],0,svh?MColor[0][5]:CColor[1],svh?4:3,0);
         }
-        for (j = 0; j < Nav.ng; j++) {
-            if (Nav.geph[j].sat != i + 1) continue;
-            GraphR->ToPoint(TimePos(Nav.geph[j].tof), yp[i], ps[0]);
-            in = GraphR->ToPoint(TimePos(Nav.geph[j].toe), yp[i], ps[2]);
-            ps[1] = ps[0];
-            off[Nav.geph[j].sat - 1] = off[Nav.geph[j].sat - 1] ? 0 : 3;
-            for (k = 0; k < 3; k++) ps[k].ry() += MarkSize + 2 + off[Nav.geph[j].sat - 1];
-            ps[0].ry() -= 2;
-
-            GraphR->DrawPoly(c, ps, 3, Nav.geph[j].svh ? MColor[0][5] : CColor[1], 0);
-
-            if (in) GraphR->DrawMark(c, ps[2], 0, Nav.geph[j].svh ? MColor[0][5] : CColor[1],
-                         Nav.geph[j].svh ? 4 : 3, 0);
+        for (j=0;j<Nav.ng;j++) {
+            if (Nav.geph[j].sat!=i+1) continue;
+            GraphR->ToPoint(TimePos(Nav.geph[j].tof),yp[i],ps[0]);
+            in=GraphR->ToPoint(TimePos(Nav.geph[j].toe),yp[i],ps[2]);
+            ps[1]=ps[0];
+            off[Nav.geph[j].sat-1]=off[Nav.geph[j].sat-1]?0:3;
+            for (k=0;k<3;k++) ps[k].ry()+=MarkSize+2+off[Nav.geph[j].sat-1];
+            ps[0].ry()-=2;
+            
+            GraphR->DrawPoly(c,ps,3,Nav.geph[j].svh?MColor[0][5]:CColor[1],0);
+            
+            if (in) GraphR->DrawMark(c,ps[2],0,Nav.geph[j].svh?MColor[0][5]:CColor[1],
+                                     Nav.geph[j].svh?4:3,0);
         }
-        for (j = 0; j < Nav.ns; j++) {
-            if (Nav.seph[j].sat != i + 1) continue;
-            GraphR->ToPoint(TimePos(Nav.seph[j].tof), yp[i], ps[0]);
-            in = GraphR->ToPoint(TimePos(Nav.seph[j].t0), yp[i], ps[2]);
-            ps[1] = ps[0];
-            off[Nav.seph[j].sat - 1] = off[Nav.seph[j].sat - 1] ? 0 : 3;
-            for (k = 0; k < 3; k++) ps[k].ry() += MarkSize + 2 + off[Nav.seph[j].sat - 1];
-            ps[0].ry() -= 2;
-
-            GraphR->DrawPoly(c, ps, 3, Nav.seph[j].svh ? MColor[0][5] : CColor[1], 0);
-
-            if (in) GraphR->DrawMark(c, ps[2], 0, Nav.seph[j].svh ? MColor[0][5] : CColor[1],
-                         Nav.seph[j].svh ? 4 : 3, 0);
+        for (j=0;j<Nav.ns;j++) {
+            if (Nav.seph[j].sat!=i+1) continue;
+            GraphR->ToPoint(TimePos(Nav.seph[j].tof),yp[i],ps[0]);
+            in=GraphR->ToPoint(TimePos(Nav.seph[j].t0),yp[i],ps[2]);
+            ps[1]=ps[0];
+            off[Nav.seph[j].sat-1]=off[Nav.seph[j].sat-1]?0:3;
+            for (k=0;k<3;k++) ps[k].ry()+=MarkSize+2+off[Nav.seph[j].sat-1];
+            ps[0].ry()-=2;
+            
+            GraphR->DrawPoly(c,ps,3,Nav.seph[j].svh?MColor[0][5]:CColor[1],0);
+            
+            if (in) GraphR->DrawMark(c,ps[2],0,Nav.seph[j].svh?MColor[0][5]:CColor[1],
+                                     Nav.seph[j].svh?4:3,0);
         }
     }
 }
 // draw sky-image on sky-plot -----------------------------------------------
-void Plot::DrawSkyImage(QPainter &c, int level)
+void Plot::DrawSkyImage(QPainter &c,int level)
 {
-    QPoint p1, p2;
-    double xl[2], yl[2], r, s, mx[190], my[190];
-
-    trace(3, "DrawSkyImage: level=%d\n", level);
-
-    if (SkySize[0] <= 0 || SkySize[1] <= 0) return;
-
-    GraphS->GetLim(xl, yl);
-    r = (xl[1] - xl[0] < yl[1] - yl[0] ? xl[1] - xl[0] : yl[1] - yl[0]) * 0.45;
-    s = r * SkyImageR.width() / 2.0 / SkyScaleR;
-    GraphS->ToPoint(-s, s, p1);
-    GraphS->ToPoint(s, -s, p2);
-    QRect rect(p1, p2);
-    c.drawImage(rect, SkyImageR);
-
+    QPoint p1,p2;
+    double xl[2],yl[2],r,s,mx[190],my[190];
+    
+    trace(3,"DrawSkyImage: level=%d\n",level);
+    
+    if (SkySize[0]<=0||SkySize[1]<=0) return;
+    
+    GraphS->GetLim(xl,yl);
+    r=(xl[1]-xl[0]<yl[1]-yl[0]?xl[1]-xl[0]:yl[1]-yl[0])*0.45;
+    s=r*SkyImageR.width()/2.0/SkyScaleR;
+    GraphS->ToPoint(-s,s,p1);
+    GraphS->ToPoint(s,-s,p2);
+    QRect rect(p1,p2);
+    c.drawImage(rect,SkyImageR);
+    
     if (SkyElMask) { // elevation mask
-        int n = 0;
-
-        mx[n] = 0.0;   my[n++] = yl[1];
-        for (int i = 0; i <= 180; i++) {
-            mx[n] = r * sin(i * 2.0 * D2R);
-            my[n++] = r * cos(i * 2.0 * D2R);
+        int n=0;
+        
+        mx[n]=0.0;   my[n++]=yl[1];
+        for (int i=0;i<=180;i++) {
+            mx[n  ]=r*sin(i*2.0*D2R);
+            my[n++]=r*cos(i*2.0*D2R);
         }
-        mx[n] = 0.0;   my[n++] = yl[1];
-        mx[n] = xl[0]; my[n++] = yl[1];
-        mx[n] = xl[0]; my[n++] = yl[0];
-        mx[n] = xl[1]; my[n++] = yl[0];
-        mx[n] = xl[1]; my[n++] = yl[1];
-        GraphS->DrawPatch(c, mx, my, n, CColor[0], CColor[0], 0);
+        mx[n]=0.0;   my[n++]=yl[1];
+        mx[n]=xl[0]; my[n++]=yl[1];
+        mx[n]=xl[0]; my[n++]=yl[0];
+        mx[n]=xl[1]; my[n++]=yl[0];
+        mx[n]=xl[1]; my[n++]=yl[1];
+        GraphS->DrawPatch(c,mx,my,n,CColor[0],CColor[0],0);
     }
 }
 // draw sky-plot ------------------------------------------------------------
-void Plot::DrawSky(QPainter &c, int level)
+void Plot::DrawSky(QPainter &c,int level)
 {
-    QPoint p1, p2;
-    QString s, ObsTypeText = ObsType->currentText();
+    QPoint p1,p2;
+    QString s,ObsTypeText=ObsType->currentText();
     obsd_t *obs;
-    gtime_t t[MAXSAT] = { { 0, 0 } };
-    double p[MAXSAT][2] = { { 0 } }, gfp[MAXSAT] = { 0 }, p0[MAXSAT][2] = { { 0 } };
-    double x, y, xp, yp, xs, ys, dt, dx, dy, xl[2], yl[2], r, gf;
-    int i, j, ind = ObsIndex;
-    int hh = static_cast<int>(Disp->font().pointSize() * 1.5), slip;
+    gtime_t t[MAXSAT]={{0,0}};
+    double p[MAXSAT][2]={{0}},gfp[MAXSAT]={0},p0[MAXSAT][2]={{0}};
+    double x,y,xp,yp,xs,ys,dt,dx,dy,xl[2],yl[2],r,gf;
+    int i,j,ind=ObsIndex;
+    int hh=static_cast<int>(Disp->font().pointSize()*1.5),slip;
     char code[32];
     char id[16];
+    
+    strncpy(code,ObsType->currentIndex()?qPrintable(ObsTypeText)+1:"",32);
 
-    strncpy(code, ObsType->currentIndex() ? qPrintable(ObsTypeText) + 1 : "", 32);
-
-    trace(3, "DrawSky: level=%d\n", level);
-
-    GraphS->GetLim(xl, yl);
-    r = (xl[1] - xl[0] < yl[1] - yl[0] ? xl[1] - xl[0] : yl[1] - yl[0]) * 0.45;
-
-    if (BtnShowImg->isChecked())
-        DrawSkyImage(c, level);
-    if (BtnShowSkyplot->isChecked())
-        GraphS->DrawSkyPlot(c, 0.0, 0.0, CColor[1], CColor[2], CColor[0], r * 2.0);
+    trace(3,"DrawSky: level=%d\n",level);
+    
+    GraphS->GetLim(xl,yl);
+    r=(xl[1]-xl[0]<yl[1]-yl[0]?xl[1]-xl[0]:yl[1]-yl[0])*0.45;
+    
+    if (BtnShowImg->isChecked()) {
+        DrawSkyImage(c,level);
+    }
+    if (BtnShowSkyplot->isChecked()) {
+        GraphS->DrawSkyPlot(c,0.0,0.0,CColor[1],CColor[2],CColor[0],r*2.0);
+    }
     if (!BtnSol1->isChecked()) return;
-
-    GraphS->GetScale(xs, ys);
-
-    if (PlotStyle <= 2) {
-        for (i = 0; i < Obs.n; i++) {
-            obs = &Obs.data[i];
-            if (SatMask[obs->sat - 1] || !SatSel[obs->sat - 1] || El[i] <= 0.0) continue;
-            QColor col = ObsColor(obs, Az[i], El[i]);
-            if (col == Qt::black) continue;
-
-            x = r * sin(Az[i]) * (1.0 - 2.0 * El[i] / PI);
-            y = r * cos(Az[i]) * (1.0 - 2.0 * El[i] / PI);
-            xp = p[obs->sat - 1][0];
-            yp = p[obs->sat - 1][1];
-
-            if ((x - xp) * (x - xp) + (y - yp) * (y - yp) >= xs * xs) {
-                int siz = PlotStyle < 2 ? MarkSize : 1;
-                GraphS->DrawMark(c, x, y, 0, PlotStyle < 2 ? col : CColor[3], siz, 0);
-                p[obs->sat - 1][0] = x;
-                p[obs->sat - 1][1] = y;
+    
+    GraphS->GetScale(xs,ys);
+    
+    if (PlotStyle<=2) {
+        for (i=0;i<Obs.n;i++) {
+            obs=&Obs.data[i];
+            if (SatMask[obs->sat-1]||!SatSel[obs->sat-1]||El[i]<=0.0) continue;
+            QColor col=ObsColor(obs,Az[i],El[i]);
+            if (col==Qt::black) continue;
+            
+            x =r*sin(Az[i])*(1.0-2.0*El[i]/PI);
+            y =r*cos(Az[i])*(1.0-2.0*El[i]/PI);
+            xp=p[obs->sat-1][0];
+            yp=p[obs->sat-1][1];
+            
+            if ((x-xp)*(x-xp)+(y-yp)*(y-yp)>=xs*xs) {
+                int siz=PlotStyle<2?MarkSize:1;
+                GraphS->DrawMark(c,x,y,0,PlotStyle<2?col:CColor[3],siz,0);
+                p[obs->sat-1][0]=x;
+                p[obs->sat-1][1]=y;
             }
-            if (xp == 0.0 && yp == 0.0) {
-                p0[obs->sat - 1][0] = x;
-                p0[obs->sat - 1][1] = y;
+            if (xp==0.0&&yp==0.0) {
+                p0[obs->sat-1][0]=x;
+                p0[obs->sat-1][1]=y;
             }
         }
     }
-    if ((PlotStyle == 0 || PlotStyle == 2) && !BtnShowTrack->isChecked()) {
-        for (i = 0; i < MAXSAT; i++) {
-            if (p0[i][0] != 0.0 || p0[i][1] != 0.0) {
+    if ((PlotStyle==0||PlotStyle==2)&&!BtnShowTrack->isChecked()) {
+        
+        for (i=0;i<MAXSAT;i++) {
+            if (p0[i][0]!=0.0||p0[i][1]!=0.0) {
                 QPoint pnt;
-                if (GraphS->ToPoint(p0[i][0], p0[i][1], pnt)) {
-                    satno2id(i + 1, id); s = id;
-                    DrawLabel(GraphS, c, pnt, s, 1, 0);
+                if (GraphS->ToPoint(p0[i][0],p0[i][1],pnt)) {
+                    satno2id(i+1,id); s=id;
+                    DrawLabel(GraphS,c,pnt,s,1,0);
                 }
             }
         }
     }
     if (!level) return;
-
-    if (ShowSlip && PlotStyle <= 2) {
-        for (i = 0; i < Obs.n; i++) {
-            obs = &Obs.data[i];
-            if (SatMask[obs->sat - 1] || !SatSel[obs->sat - 1] || El[i] <= 0.0) continue;
-
-            slip = 0;
-            if (ShowSlip == 2) { // LLI
-                for (j = 0; j < NFREQ + NEXOBS; j++)
-                    if ((!*code || strstr(code2obs(obs->code[j], NULL), code)) &&
-                        (obs->LLI[j] & 1)) slip = 1;
-            } else if (!*code || !strcmp(code, "1") || !strcmp(code, "2")) {
-                if (obs->L[0] != 0.0 && obs->L[1] != 0.0 &&
-                    satsys(obs->sat, NULL) != SYS_GLO) {
-                    gf = CLIGHT * (obs->L[0] / FREQ1 - obs->L[1] / FREQ2);
-                    if (fabs(gfp[obs->sat - 1] - gf) > THRESLIP) slip = 1;
-                    gfp[obs->sat - 1] = gf;
+    
+    if (ShowSlip&&PlotStyle<=2) {
+        
+        for (i=0;i<Obs.n;i++) {
+            obs=&Obs.data[i];
+            if (SatMask[obs->sat-1]||!SatSel[obs->sat-1]||El[i]<=0.0) continue;
+            
+            slip=0;
+            if (ShowSlip==2) { // LLI
+                for (j=0;j<NFREQ+NEXOBS;j++) {
+                    if ((!*code||strstr(code2obs(obs->code[j],NULL),code))&&
+                        (obs->LLI[j]&1)) slip=1;
                 }
             }
-            x = r * sin(Az[i]) * (1.0 - 2.0 * El[i] / PI);
-            y = r * cos(Az[i]) * (1.0 - 2.0 * El[i] / PI);
-            dt = timediff(obs->time, t[obs->sat - 1]);
-            dx = x - p[obs->sat - 1][0];
-            dy = y - p[obs->sat - 1][1];
-            t[obs->sat - 1] = obs->time;
-            p[obs->sat - 1][0] = x;
-            p[obs->sat - 1][1] = y;
-            if (fabs(dt) > 300.0) continue;
-            if (El[i] < ElMask * D2R) continue;
-            if (ElMaskP && El[i] < ElMaskData[static_cast<int>(Az[i] * R2D + 0.5)]) continue;
-            if (slip)
-                GraphS->DrawMark(c, x, y, 4, MColor[0][5], MarkSize * 3 + 2, static_cast<int>(ATAN2(dy, dx) * R2D + 90));
+            else if (!*code||!strcmp(code,"1")||!strcmp(code,"2")) {
+                if (obs->L[0]!=0.0&&obs->L[1]!=0.0&&
+                    satsys(obs->sat,NULL)!=SYS_GLO) {
+                    gf=CLIGHT*(obs->L[0]/FREQ1-obs->L[1]/FREQ2);
+                    if (fabs(gfp[obs->sat-1]-gf)>THRESLIP) slip=1;
+                    gfp[obs->sat-1]=gf;
+                }
+            }
+            x=r*sin(Az[i])*(1.0-2.0*El[i]/PI);
+            y=r*cos(Az[i])*(1.0-2.0*El[i]/PI);
+            dt=timediff(obs->time,t[obs->sat-1]);
+            dx=x-p[obs->sat-1][0];
+            dy=y-p[obs->sat-1][1];
+            t[obs->sat-1]=obs->time;
+            p[obs->sat-1][0]=x;
+            p[obs->sat-1][1]=y;
+            if (fabs(dt)>300.0) continue;
+            if (El[i]<ElMask*D2R) continue;
+            if (ElMaskP&&El[i]<ElMaskData[static_cast<int>(Az[i]*R2D+0.5)]) continue;
+            if (slip) {
+                GraphS->DrawMark(c,x,y,4,MColor[0][5],MarkSize*3+2,static_cast<int>(ATAN2(dy,dx)*R2D+90));
+            }
         }
     }
-
     if (ElMaskP) {
-        double *x = new double [361];
-        double *y = new double [361];
-        for (i = 0; i <= 360; i++) {
-            x[i] = r * sin(i * D2R) * (1.0 - 2.0 * ElMaskData[i] / PI);
-            y[i] = r * cos(i * D2R) * (1.0 - 2.0 * ElMaskData[i] / PI);
+        double *x=new double [361];
+        double *y=new double [361];
+        for (i=0;i<=360;i++) {
+            x[i]=r*sin(i*D2R)*(1.0-2.0*ElMaskData[i]/PI);
+            y[i]=r*cos(i*D2R)*(1.0-2.0*ElMaskData[i]/PI);
         }
-        QPen pen = c.pen(); pen.setWidth(2); c.setPen(pen);
-        GraphS->DrawPoly(c, x, y, 361, COL_ELMASK, 0);
-        pen.setWidth(1); c.setPen(pen);
+        QPen pen=c.pen();pen.setWidth(2);c.setPen(pen);
+        GraphS->DrawPoly(c,x,y,361,COL_ELMASK,0);
+        pen.setWidth(1);c.setPen(pen);
         delete [] x;
         delete [] y;
     }
-
-    if (BtnShowTrack->isChecked() && 0 <= ind && ind < NObs) {
-        for (i = IndexObs[ind]; i < Obs.n && i < IndexObs[ind + 1]; i++) {
-            obs = &Obs.data[i];
-            if (SatMask[obs->sat - 1] || !SatSel[obs->sat - 1] || El[i] <= 0.0) continue;
-            QColor col = ObsColor(obs, Az[i], El[i]);
-            if (col == Qt::black) continue;
-
-            x = r * sin(Az[i]) * (1.0 - 2.0 * El[i] / PI);
-            y = r * cos(Az[i]) * (1.0 - 2.0 * El[i] / PI);
-
-            satno2id(obs->sat, id);
-            GraphS->DrawMark(c, x, y, 0, col, Disp->font().pointSize() * 2 + 5, 0);
-            GraphS->DrawMark(c, x, y, 1, col == Qt::black ? MColor[0][0] : CColor[2], Disp->font().pointSize() * 2 + 5, 0);
-            GraphS->DrawText(c, x, y, s = id, CColor[0], 0, 0, 0);
+    if (BtnShowTrack->isChecked()&&0<=ind&&ind<NObs) {
+        
+        for (i=IndexObs[ind];i<Obs.n&&i<IndexObs[ind+1];i++) {
+            obs=&Obs.data[i];
+            if (SatMask[obs->sat-1]||!SatSel[obs->sat-1]||El[i]<=0.0) continue;
+            QColor col=ObsColor(obs,Az[i],El[i]);
+            if (col==Qt::black) continue;
+            
+            x=r*sin(Az[i])*(1.0-2.0*El[i]/PI);
+            y=r*cos(Az[i])*(1.0-2.0*El[i]/PI);
+            
+            satno2id(obs->sat,id);
+            GraphS->DrawMark(c,x,y,0,col,Disp->font().pointSize()*2+5,0);
+            GraphS->DrawMark(c,x,y,1,col==Qt::black?MColor[0][0]:CColor[2],Disp->font().pointSize()*2+5,0);
+            GraphS->DrawText(c,x,y,s=id,CColor[0],0,0,0);
         }
     }
-
-    GraphS->GetPos(p1, p2);
-    p1.rx() += 10; p1.ry() += 8; p2.rx() -= 10; p2.ry() = p1.y();
-
-    if (ShowStats && !SimObs) {
-        s = QString(tr("MARKER: %1 %2")).arg(Sta.name).arg(Sta.marker);
-        DrawLabel(GraphS, c, p1, s, 1, 2); p1.ry() += hh;
-        s = QString(tr("REC: %1 %2 %3")).arg(Sta.rectype).arg(Sta.recver).arg(Sta.recsno);
-        DrawLabel(GraphS, c, p1, s, 1, 2); p1.ry() += hh;
-        s = QString(tr("ANT: %1 %2")).arg(Sta.antdes).arg(Sta.antsno);
-        DrawLabel(GraphS, c, p1, s, 1, 2); p1.ry() += hh;
+    GraphS->GetPos(p1,p2);
+    p1.rx()+=10; p1.ry()+=8; p2.rx()-=10; p2.ry()=p1.y();
+    
+    if (ShowStats&&!SimObs) {
+        s=QString(tr("MARKER: %1 %2")).arg(Sta.name).arg(Sta.marker);
+        DrawLabel(GraphS,c,p1,s,1,2); p1.ry()+=hh;
+        s=QString(tr("REC: %1 %2 %3")).arg(Sta.rectype).arg(Sta.recver).arg(Sta.recsno);
+        DrawLabel(GraphS,c,p1,s,1,2); p1.ry()+=hh;
+        s=QString(tr("ANT: %1 %2")).arg(Sta.antdes).arg(Sta.antsno);
+        DrawLabel(GraphS,c,p1,s,1,2); p1.ry()+=hh;
     }
-        // show statistics
-    if (ShowStats && BtnShowTrack->isChecked() && 0 <= ind && ind < NObs && !SimObs) {
-        s = QString(tr("SAT: OBS : SNR : LLI%1")).arg(!*code ? "" : tr(" : CODE"));
-        DrawLabel(GraphS, c, p2, s, 2, 2);
-        p2.ry() += 3;
-
-        for (i = IndexObs[ind]; i < Obs.n && i < IndexObs[ind + 1]; i++) {
-            obs = &Obs.data[i];
-            if (SatMask[obs->sat - 1] || !SatSel[obs->sat - 1]) continue;
-            if (HideLowSat && El[i] < ElMask * D2R) continue;
-            if (HideLowSat && ElMaskP && El[i] < ElMaskData[static_cast<int>(Az[i] * R2D + 0.5)]) continue;
-
-            satno2id(obs->sat, id);
-            s = QString("%1: ").arg(id, 3, QChar('-'));
-
+    // show statistics
+    if (ShowStats&&BtnShowTrack->isChecked()&&0<=ind&&ind<NObs&&!SimObs) {
+        
+        s=QString(tr("SAT: OBS : SNR : LLI%1")).arg(!*code?"":tr(" : CODE"));
+        DrawLabel(GraphS,c,p2,s,2,2);
+        p2.ry()+=3;
+        
+        for (i=IndexObs[ind];i<Obs.n&&i<IndexObs[ind+1];i++) {
+            obs=&Obs.data[i];
+            if (SatMask[obs->sat-1]||!SatSel[obs->sat-1]) continue;
+            if (HideLowSat&&El[i]<ElMask*D2R) continue;
+            if (HideLowSat&&ElMaskP&&El[i]<ElMaskData[static_cast<int>(Az[i]*R2D+0.5)]) continue;
+            
+            satno2id(obs->sat,id);
+            s=QString("%1: ").arg(id,3,QChar('-'));
+            
             if (!*code) {
-                for (j = 0; j < NFREQ; j++) s += obs->P[j] == 0.0 ? "-" : "C";
-                for (j = 0; j < NFREQ; j++) s += obs->L[j] == 0.0 ? "-" : "L";
-                s += " : ";
-                for (j = 0; j < NFREQ; j++) s += QString("%1 ").arg(obs->SNR[j] * 0.25, 2, 'f', 0, QChar('0'));
-                s += ": ";
-                for (j = 0; j < NFREQ; j++) s += QString("%1").arg(obs->LLI[j]);
-            } else {
-                for (j = 0; j < NFREQ + NEXOBS; j++)
-                    if (strstr(code2obs(obs->code[j], NULL), code)) break;
-                if (j >= NFREQ + NEXOBS) continue;
-
-                s += QString("%1%2%3 : %4 : %5 : %6").arg(obs->P[j] == 0.0 ? "-" : "C")
-                     .arg(obs->L[j] == 0.0 ? "-" : "L").arg(obs->D[j] == 0.0 ? "-" : "D")
-                     .arg(obs->SNR[j] * 0.25, 4, 'f', 1, QChar('0')).arg(obs->LLI[j])
-                     .arg(code2obs(obs->code[j], NULL));
+                for (j=0;j<NFREQ;j++) s+=obs->P[j]==0.0?"-":"C";
+                for (j=0;j<NFREQ;j++) s+=obs->L[j]==0.0?"-":"L";
+                s+=" : ";
+                for (j=0;j<NFREQ;j++) s+=QString("%1 ").arg(obs->SNR[j]*0.25,2,'f',0,QChar('0'));
+                s+=": ";
+                for (j=0;j<NFREQ;j++) s+=QString("%1").arg(obs->LLI[j]);
             }
-            QColor col = ObsColor(obs, Az[i], El[i]);
-            p2.ry() += hh;
-            GraphS->DrawText(c, p2, s, col == Qt::black ? MColor[0][0] : col, 2, 2, 0);
+            else {
+                for (j=0;j<NFREQ+NEXOBS;j++) {
+                    if (strstr(code2obs(obs->code[j],NULL),code)) break;
+                }
+                if (j>=NFREQ+NEXOBS) continue;
+                
+                s+=QString("%1%2%3 : %4 : %5 : %6").arg(obs->P[j]==0.0?"-":"C")
+                              .arg(obs->L[j]==0.0?"-":"L").arg(obs->D[j]==0.0?"-":"D")
+                              .arg(obs->SNR[j]*0.25,4,'f',1,QChar('0')).arg(obs->LLI[j])
+                              .arg(code2obs(obs->code[j],NULL));
+            }
+            QColor col=ObsColor(obs,Az[i],El[i]);
+            p2.ry()+=hh;
+            GraphS->DrawText(c,p2,s,col==Qt::black?MColor[0][0]:col,2,2,0);
         }
     }
-    if (Nav.n <= 0 && Nav.ng <= 0 && !SimObs) {
-        GraphS->GetPos(p1, p2);
-        p2.rx() -= 10;
-        p2.ry() -= 3;
-        DrawLabel(GraphS, c, p2, tr("No Navigation Data"), 2, 1);
+    if (Nav.n<=0&&Nav.ng<=0&&!SimObs) {
+        GraphS->GetPos(p1,p2);
+        p2.rx()-=10;
+        p2.ry()-=3;
+        DrawLabel(GraphS,c,p2,tr("No Navigation Data"),2,1);
     }
 }
 // draw dop and number-of-satellite plot ------------------------------------
-void Plot::DrawDop(QPainter &c, int level)
+void Plot::DrawDop(QPainter &c,int level)
 {
     QString label;
-    QPoint p1, p2;
-    double xp, xc, yc, xl[2], yl[2], azel[MAXSAT * 2], *dop, *x, *y;
-    int i, j, *ns, n = 0;
-    int ind = ObsIndex, doptype = DopType->currentIndex();
-
-    trace(3, "DrawDop: level=%d\n", level);
-
-    GraphR->XLPos = TimeLabel ? 6 : 1;
-    GraphR->YLPos = 1;
-    GraphR->Week = Week;
-    GraphR->GetLim(xl, yl);
-    yl[0] = 0.0; yl[1] = MaxDop;
-    GraphR->SetLim(xl, yl);
-    GraphR->SetTick(0.0, 0.0);
-
-    if (0 <= ind && ind < NObs && BtnShowTrack->isChecked() && BtnFixHoriz->isChecked()) {
-        double xl[2], yl[2], off;
-        GraphR->GetLim(xl, yl);
-        off = Xcent * (xl[1] - xl[0]) / 2.0;
-        xp = TimePos(Obs.data[IndexObs[ind]].time);
-        GraphR->GetCent(xc, yc);
-        GraphR->SetCent(xp - off, yc);
+    QPoint p1,p2;
+    double xp,xc,yc,xl[2],yl[2],azel[MAXSAT*2],*dop,*x,*y;
+    int i,j,*ns,n=0;
+    int ind=ObsIndex,doptype=DopType->currentIndex();
+    
+    trace(3,"DrawDop: level=%d\n",level);
+    
+    GraphR->XLPos=TimeLabel?6:1; 
+    GraphR->YLPos=1;
+    GraphR->Week=Week;
+    GraphR->GetLim(xl,yl);
+    yl[0]=0.0; yl[1]=MaxDop;
+    GraphR->SetLim(xl,yl);
+    GraphR->SetTick(0.0,0.0);
+    
+    if (0<=ind&&ind<NObs&&BtnShowTrack->isChecked()&&BtnFixHoriz->isChecked()) {
+        double xl[2],yl[2],off;
+        GraphR->GetLim(xl,yl);
+        off=Xcent*(xl[1]-xl[0])/2.0;
+        xp=TimePos(Obs.data[IndexObs[ind]].time);
+        GraphR->GetCent(xc,yc);
+        GraphR->SetCent(xp-off,yc);
     }
-    GraphR->DrawAxis(c, 1, 1);
-    GraphR->GetPos(p1, p2);
+    GraphR->DrawAxis(c,1,1);
+    GraphR->GetPos(p1,p2);
     p1.setX(Disp->font().pointSize());
-    p1.setY((p1.y() + p2.y()) / 2);
-    if (doptype == 0)
-        label = QString("# OF SATELLITES / DOP (EL>=%1%2)").arg(ElMask, 0, 'f', 0).arg(degreeChar);
-    else if (doptype == 1)
-        label = QString("# OF SATELLITES (EL>=%1%2)").arg(ElMask, 0, 'f', 0).arg(degreeChar);
-    else
-        label = QString("DOP (EL>=%1%2)").arg(ElMask, 0, 'f', 0).arg(degreeChar);
-    GraphR->DrawText(c, p1, label, CColor[2], 0, 0, 90);
-
+    p1.setY((p1.y()+p2.y())/2);
+    if (doptype==0) {
+        label=QString("# OF SATELLITES / DOP (EL>=%1%2)").arg(ElMask,0,'f',0).arg(degreeChar);
+    }
+    else if (doptype==1) {
+        label=QString("# OF SATELLITES (EL>=%1%2)").arg(ElMask,0,'f',0).arg(degreeChar);
+    }
+    else {
+        label=QString("DOP (EL>=%1%2)").arg(ElMask,0,'f',0).arg(degreeChar);
+    }
+    GraphR->DrawText(c,p1,label,CColor[2],0,0,90);
+    
     if (!BtnSol1->isChecked()) return;
-
-    x = new double[NObs];
-    y = new double[NObs];
-    dop = new double[NObs * 4];
-    ns = new int   [NObs];
-
-    for (i = 0; i < NObs; i++) {
-        ns[n] = 0;
-        for (j = IndexObs[i]; j < Obs.n && j < IndexObs[i + 1]; j++) {
-            if (SatMask[Obs.data[j].sat - 1] || !SatSel[Obs.data[j].sat - 1]) continue;
-            if (El[j] < ElMask * D2R) continue;
-            if (ElMaskP && El[j] < ElMaskData[static_cast<int>(Az[j] * R2D + 0.5)]) continue;
-            azel[ns[n] * 2] = Az[j];
-            azel[1 + ns[n] * 2] = El[j];
+    
+    x  =new double[NObs];
+    y  =new double[NObs];
+    dop=new double[NObs*4];
+    ns =new int   [NObs];
+    
+    for (i=0;i<NObs;i++) {
+        ns[n]=0;
+        for (j=IndexObs[i];j<Obs.n&&j<IndexObs[i+1];j++) {
+            if (SatMask[Obs.data[j].sat-1]||!SatSel[Obs.data[j].sat-1]) continue;
+            if (El[j]<ElMask*D2R) continue;
+            if (ElMaskP&&El[j]<ElMaskData[static_cast<int>(Az[j]*R2D+0.5)]) continue;
+            azel[  ns[n]*2]=Az[j];
+            azel[1+ns[n]*2]=El[j];
             ns[n]++;
         }
-        dops(ns[n], azel, ElMask * D2R, dop + n * 4);
-        x[n++] = TimePos(Obs.data[IndexObs[i]].time);
+        dops(ns[n],azel,ElMask*D2R,dop+n*4);
+        x[n++]=TimePos(Obs.data[IndexObs[i]].time);
     }
-    for (i = 0; i < 4; i++) {
-        if (doptype != 0 && doptype != i + 2) continue;
-
-        for (j = 0; j < n; j++) y[j] = dop[i + j * 4];
-
-        if (!(PlotStyle % 2))
-            DrawPolyS(GraphR, c, x, y, n, CColor[3], 0);
-        if (level && PlotStyle < 2) {
-            for (j = 0; j < n; j++) {
-                if (y[j] == 0.0) continue;
-                GraphR->DrawMark(c, x[j], y[j], 0, MColor[0][i + 2], MarkSize, 0);
+    for (i=0;i<4;i++) {
+        if (doptype!=0&&doptype!=i+2) continue;
+        
+        for (j=0;j<n;j++) y[j]=dop[i+j*4];
+        
+        if (!(PlotStyle%2)) {
+            DrawPolyS(GraphR,c,x,y,n,CColor[3],0);
+        }
+        if (level&&PlotStyle<2) {
+            for (j=0;j<n;j++) {
+                if (y[j]==0.0) continue;
+                GraphR->DrawMark(c,x[j],y[j],0,MColor[0][i+2],MarkSize,0);
             }
         }
     }
-    if (doptype == 0 || doptype == 1) {
-        for (i = 0; i < n; i++) y[i] = ns[i];
-
-        if (!(PlotStyle % 2))
-            DrawPolyS(GraphR, c, x, y, n, CColor[3], 1);
-        if (level && PlotStyle < 2) {
-            for (i = 0; i < n; i++)
-                GraphR->DrawMark(c, x[i], y[i], 0, MColor[0][1], MarkSize, 0);
+    if (doptype==0||doptype==1) {
+        for (i=0;i<n;i++) y[i]=ns[i];
+        
+        if (!(PlotStyle%2)) {
+            DrawPolyS(GraphR,c,x,y,n,CColor[3],1);
+        }
+        if (level&&PlotStyle<2) {
+            for (i=0;i<n;i++) {
+                GraphR->DrawMark(c,x[i],y[i],0,MColor[0][1],MarkSize,0);
+            }
         }
     }
-
-    if (BtnShowTrack->isChecked() && 0 <= ind && ind < NObs) {
-        GraphR->GetLim(xl, yl);
-        xl[0] = xl[1] = TimePos(Obs.data[IndexObs[ind]].time);
-
-        GraphR->DrawPoly(c, xl, yl, 2, CColor[2], 0);
-
-        ns[0] = 0;
-        for (i = IndexObs[ind]; i < Obs.n && i < IndexObs[ind + 1]; i++) {
-            if (SatMask[Obs.data[i].sat - 1] || !SatSel[Obs.data[i].sat - 1]) continue;
-            if (El[i] < ElMask * D2R) continue;
-            if (ElMaskP && El[i] < ElMaskData[static_cast<int>(Az[i] * R2D + 0.5)]) continue;
-            azel[ns[0] * 2] = Az[i];
-            azel[1 + ns[0] * 2] = El[i];
+    if (BtnShowTrack->isChecked()&&0<=ind&&ind<NObs) {
+        GraphR->GetLim(xl,yl);
+        xl[0]=xl[1]=TimePos(Obs.data[IndexObs[ind]].time);
+        
+        GraphR->DrawPoly(c,xl,yl,2,CColor[2],0);
+        
+        ns[0]=0;
+        for (i=IndexObs[ind];i<Obs.n&&i<IndexObs[ind+1];i++) {
+            if (SatMask[Obs.data[i].sat-1]||!SatSel[Obs.data[i].sat-1]) continue;
+            if (El[i]<ElMask*D2R) continue;
+            if (ElMaskP&&El[i]<ElMaskData[static_cast<int>(Az[i]*R2D+0.5)]) continue;
+            azel[  ns[0]*2]=Az[i];
+            azel[1+ns[0]*2]=El[i];
             ns[0]++;
         }
-        dops(ns[0], azel, ElMask * D2R, dop);
-
-        for (i = 0; i < 4; i++) {
-            if ((doptype != 0 && doptype != i + 2) || dop[i] <= 0.0) continue;
-            GraphR->DrawMark(c, xl[0], dop[i], 0, MColor[0][i + 2], MarkSize * 2 + 2, 0);
+        dops(ns[0],azel,ElMask*D2R,dop);
+        
+        for (i=0;i<4;i++) {
+            if ((doptype!=0&&doptype!=i+2)||dop[i]<=0.0) continue;
+            GraphR->DrawMark(c,xl[0],dop[i],0,MColor[0][i+2],MarkSize*2+2,0);
+        }
+        if (doptype==0||doptype==1) {
+            GraphR->DrawMark(c,xl[0],ns[0],0,MColor[0][1],MarkSize*2+2,0);
+        }
+        GraphR->DrawMark(c,xl[0],yl[1]-1E-6,0,CColor[2],5,0);
+        if (!BtnFixHoriz->isChecked()) {
+            GraphR->DrawMark(c,xl[0],yl[1]-1E-6,1,CColor[2],9,0);
         }
-        if (doptype == 0 || doptype == 1)
-            GraphR->DrawMark(c, xl[0], ns[0], 0, MColor[0][1], MarkSize * 2 + 2, 0);
-        GraphR->DrawMark(c, xl[0], yl[1] - 1E-6, 0, CColor[2], 5, 0);
-        if (!BtnFixHoriz->isChecked())
-            GraphR->DrawMark(c, xl[0], yl[1] - 1E-6, 1, CColor[2], 9, 0);
-    } else {
-        DrawDopStat(c, dop, ns, n);
     }
-
-    if (Nav.n <= 0 && Nav.ng <= 0 && (doptype == 0 || doptype >= 2) && !SimObs) {
-        GraphR->GetPos(p1, p2);
-        p2.rx() -= 10;
-        p2.ry() -= 3;
-        DrawLabel(GraphR, c, p2, tr("No Navigation Data"), 2, 1);
+    else {
+        DrawDopStat(c,dop,ns,n);
+    }
+    if (Nav.n<=0&&Nav.ng<=0&&(doptype==0||doptype>=2)&&!SimObs) {
+        GraphR->GetPos(p1,p2);
+        p2.rx()-=10;
+        p2.ry()-=3;
+        DrawLabel(GraphR,c,p2,tr("No Navigation Data"),2,1);
     }
-
     delete [] x;
     delete [] y;
     delete [] dop;
     delete [] ns;
 }
 // draw statistics on dop and number-of-satellite plot ----------------------
-void Plot::DrawDopStat(QPainter &c, double *dop, int *ns, int n)
+void Plot::DrawDopStat(QPainter &c,double *dop, int *ns, int n)
 {
-    QString s0[MAXOBS + 2], s1[MAXOBS + 2], s2[MAXOBS + 2];
-    QPoint p1, p2, p3;
-    double ave[4] = { 0 };
-    int i, j, m = 0;
-    int ndop[4] = { 0 }, nsat[MAXOBS] = { 0 }, fonth = static_cast<int>(Disp->font().pointSize() * 1.5);
-
-    trace(3, "DrawDopStat: n=%d\n", n);
-
+    QString s0[MAXOBS+2],s1[MAXOBS+2],s2[MAXOBS+2];
+    QPoint p1,p2,p3;
+    double ave[4]={0};
+    int i,j,m=0;
+    int ndop[4]={0},nsat[MAXOBS]={0},fonth=static_cast<int>(Disp->font().pointSize()*1.5);
+    
+    trace(3,"DrawDopStat: n=%d\n",n);
+    
     if (!ShowStats) return;
-
-    for (i = 0; i < n; i++) nsat[ns[i]]++;
-
-    for (i = 0; i < 4; i++) {
-        for (j = 0; j < n; j++) {
-            if (dop[i + j * 4] <= 0.0 || dop[i + j * 4] > MaxDop) continue;
-            ave[i] += dop[i + j * 4];
+    
+    for (i=0;i<n;i++) nsat[ns[i]]++;
+    
+    for (i=0;i<4;i++) {
+        for (j=0;j<n;j++) {
+            if (dop[i+j*4]<=0.0||dop[i+j*4]>MaxDop) continue;
+            ave[i]+=dop[i+j*4];
             ndop[i]++;
         }
-        if (ndop[i] > 0) ave[i] /= ndop[i];
+        if (ndop[i]>0) ave[i]/=ndop[i];
     }
-    if (DopType->currentIndex() == 0 || DopType->currentIndex() >= 2) {
-        s2[m++] = QString("AVE= GDOP:%1 PDOP:%2 HDOP:%3 VDOP:%4")
-              .arg(ave[0], 4, 'f', 1).arg(ave[1], 4, 'f', 1).arg(ave[2], 4, 'f', 1).arg(ave[3], 4, 'f', 1);
-        s2[m++] = QString("NDOP=%1(%2%%) %3(%4%%) %5(%6%%) %7(%8f%%)")
-              .arg(ndop[0]).arg(n > 0 ? ndop[0] * 100.0 / n : 0.0, 4, 'f', 1)
-              .arg(ndop[1]).arg(n > 0 ? ndop[1] * 100.0 / n : 0.0, 4, 'f', 1)
-              .arg(ndop[2]).arg(n > 0 ? ndop[2] * 100.0 / n : 0.0, 4, 'f', 1)
-              .arg(ndop[3]).arg(n > 0 ? ndop[3] * 100.0 / n : 0.0, 4, 'f', 1);
+    if (DopType->currentIndex()==0||DopType->currentIndex()>=2) {
+        s2[m++]=QString("AVE= GDOP:%1 PDOP:%2 HDOP:%3 VDOP:%4")
+                        .arg(ave[0],4,'f',1).arg(ave[1],4,'f',1).arg(ave[2],4,'f',1).arg(ave[3],4,'f',1);
+        s2[m++]=QString("NDOP=%1(%2%%) %3(%4%%) %5(%6%%) %7(%8f%%)")
+                        .arg(ndop[0]).arg(n>0?ndop[0]*100.0/n:0.0,4,'f',1)
+                        .arg(ndop[1]).arg(n>0?ndop[1]*100.0/n:0.0,4,'f',1)
+                        .arg(ndop[2]).arg(n>0?ndop[2]*100.0/n:0.0,4,'f',1)
+                        .arg(ndop[3]).arg(n>0?ndop[3]*100.0/n:0.0,4,'f',1);
     }
-    if (DopType->currentIndex() <= 1) {
-        for (i = 0, j = 0; i < MAXOBS; i++) {
-            if (nsat[i] <= 0) continue;
-            s0[m] = QString("%1%2:").arg(j++ == 0 ? "NSAT= " : "").arg(i, 2);
-            s1[m] = QString("%1").arg(nsat[i], 7);
-            s2[m++] = QString("(%1%%)").arg(nsat[i] * 100.0 / n, 4, 'f', 1);
+    if (DopType->currentIndex()<=1) {
+        
+        for (i=0,j=0;i<MAXOBS;i++) {
+            if (nsat[i]<=0) continue;
+            s0[m]=QString("%1%2:").arg(j++==0?"NSAT= ":"").arg(i,2);
+            s1[m]=QString("%1").arg(nsat[i],7);
+            s2[m++]=QString("(%1%%)").arg(nsat[i]*100.0/n,4,'f',1);
         }
     }
-    GraphR->GetPos(p1, p2);
-    p1.setX(p2.x() - 10);
-    p1.ry() += 8;
-    p2 = p1; p2.rx() -= fonth * 4;
-    p3 = p2; p3.rx() -= fonth * 8;
-
-    for (i = 0; i < m; i++, p1.ry() += fonth, p2.ry() += fonth, p3.ry() += fonth) {
-        DrawLabel(GraphR, c, p3, s0[i], 2, 2);
-        DrawLabel(GraphR, c, p2, s1[i], 2, 2);
-        DrawLabel(GraphR, c, p1, s2[i], 2, 2);
+    GraphR->GetPos(p1,p2);
+    p1.setX(p2.x()-10);
+    p1.ry()+=8;
+    p2=p1; p2.rx()-=fonth*4;
+    p3=p2; p3.rx()-=fonth*8;
+    
+    for (i=0;i<m;i++,p1.ry()+=fonth,p2.ry()+=fonth,p3.ry()+=fonth) {
+        DrawLabel(GraphR,c,p3,s0[i],2,2);
+        DrawLabel(GraphR,c,p2,s1[i],2,2);
+        DrawLabel(GraphR,c,p1,s2[i],2,2);
     }
 }
 // draw snr, mp and elevation-plot ---------------------------------------------
-void Plot::DrawSnr(QPainter &c, int level)
+void Plot::DrawSnr(QPainter &c,int level)
 {
-    QPushButton *btn[] = { BtnOn1, BtnOn2, BtnOn3 };
-    QString ObsTypeText = ObsType2->currentText();
-    QString label[] = { tr("SNR"), tr("Multipath"), tr("Elevation") };
-    QString unit[] = { "dBHz", "m", degreeChar };
-    QPoint p1, p2;
-    QColor *col, colp[MAXSAT];
-    gtime_t time = { 0, 0 };
-    double *x, *y, xl[2], yl[2], off, xc, yc, xp, yp[MAXSAT], ave[3] = { 0 }, rms[3] = { 0 };
+    QPushButton *btn[]={BtnOn1,BtnOn2,BtnOn3};
+    QString ObsTypeText=ObsType2->currentText();
+    QString label[]={tr("SNR"),tr("Multipath"),tr("Elevation")};
+    QString unit[]={"dBHz","m",degreeChar};
+    QPoint p1,p2;
+    QColor *col,colp[MAXSAT];
+    gtime_t time={0,0};
+    double *x,*y,xl[2],yl[2],off,xc,yc,xp,yp[MAXSAT],ave[3]={0},rms[3]={0};
     char code[32];
-    int i, j, k, l, n, np, sat, ind = ObsIndex, nrms[3] = { 0 };
-
-    strncpy(code, qPrintable(ObsTypeText.mid(1)), 32);
-
-    trace(3, "DrawSnr: level=%d\n", level);
+    int i,j,k,l,n,np,sat,ind=ObsIndex,nrms[3]={0};
+    
+    strncpy(code,qPrintable(ObsTypeText.mid(1)),32);
 
-    if (0 <= ind && ind < NObs && BtnShowTrack->isChecked())
-        time = Obs.data[IndexObs[ind]].time;
-    if (0 <= ind && ind < NObs && BtnShowTrack->isChecked() && BtnFixHoriz->isChecked()) {
-        GraphG[0]->GetLim(xl, yl);
-        off = Xcent * (xl[1] - xl[0]) / 2.0;
-        xp = TimePos(time);
-        for (j = 0; j < 3; j++) {
-            GraphG[j]->GetCent(xc, yc);
-            GraphG[j]->SetCent(xp - off, yc);
+    trace(3,"DrawSnr: level=%d\n",level);
+    
+    if (0<=ind&&ind<NObs&&BtnShowTrack->isChecked()) {
+        time=Obs.data[IndexObs[ind]].time;
+    }
+    if (0<=ind&&ind<NObs&&BtnShowTrack->isChecked()&&BtnFixHoriz->isChecked()) {
+        GraphG[0]->GetLim(xl,yl);
+        off=Xcent*(xl[1]-xl[0])/2.0;
+        xp=TimePos(time);
+        for (j=0;j<3;j++) {
+            GraphG[j]->GetCent(xc,yc);
+            GraphG[j]->SetCent(xp-off,yc);
         }
     }
-    j = 0;
-
-    for (i = 0; i < 3; i++) if (btn[i]->isChecked()) j = i;
-
-    for (i = 0; i < 3; i++) {
+    j=0;
+    for (i=0;i<3;i++) if (btn[i]->isChecked()) j=i;
+    for (i=0;i<3;i++) {
         if (!btn[i]->isChecked()) continue;
-        GraphG[i]->XLPos = TimeLabel ? (i == j ? 6 : 5) : (i == j ? 1 : 0);
-        GraphG[i]->Week = Week;
-        GraphG[i]->DrawAxis(c, ShowLabel, ShowLabel);
+        GraphG[i]->XLPos=TimeLabel?(i==j?6:5):(i==j?1:0);
+        GraphG[i]->Week=Week;
+        GraphG[i]->DrawAxis(c,ShowLabel,ShowLabel);
     }
-
-    if (NObs > 0 && BtnSol1->isChecked()) {
-        x = new double[NObs],
-        y = new double[NObs];
-        col = new QColor[NObs];
-
-        for (i = l = 0; i < 3; i++) {
+    if (NObs>0&&BtnSol1->isChecked()) {
+        x=new double[NObs],
+        y=new double[NObs];
+        col=new QColor[NObs];
+        
+        for (i=l=0;i<3;i++) {
             if (!btn[i]->isChecked()) continue;
-
-            for (sat = 1, np = 0; sat <= MAXSAT; sat++) {
-                if (SatMask[sat - 1] || !SatSel[sat - 1]) continue;
-
-                for (j = n = 0; j < Obs.n; j++) {
-                    if (Obs.data[j].sat != sat) continue;
-
-                    for (k = 0; k < NFREQ + NEXOBS; k++)
-                        if (strstr(code2obs(Obs.data[j].code[k], NULL), code)) break;
-                    if (k >= NFREQ + NEXOBS) continue;
-
-                    x[n] = TimePos(Obs.data[j].time);
-                    if (i == 0) {
-                        y[n] = Obs.data[j].SNR[k] * 0.25;
-                        col[n] = MColor[0][4];
-                    } else if (i == 1) {
-                        if (!Mp[k] || Mp[k][j] == 0.0) continue;
-                        y[n] = Mp[k][j];
-                        col[n] = MColor[0][4];
-                    } else {
-                        y[n] = El[j] * R2D;
-                        if (SimObs) col[n] = SysColor(Obs.data[j].sat);
-                        else col[n] = SnrColor(Obs.data[j].SNR[k] * 0.25);
-                        if (El[j] > 0.0 && El[j] < ElMask * D2R) col[n] = MColor[0][0];
+            
+            for (sat=1,np=0;sat<=MAXSAT;sat++) {
+                if (SatMask[sat-1]||!SatSel[sat-1]) continue;
+                
+                for (j=n=0;j<Obs.n;j++) {
+                    if (Obs.data[j].sat!=sat) continue;
+                    
+                    for (k=0;k<NFREQ+NEXOBS;k++) {
+                        if (strstr(code2obs(Obs.data[j].code[k],NULL),code)) break;
                     }
-                    if (timediff(time, Obs.data[j].time) == 0.0 && np < MAXSAT) {
-                        yp[np] = y[n];
-                        colp[np++] = col[n];
+                    if (k>=NFREQ+NEXOBS) continue;
+                    
+                    x[n]=TimePos(Obs.data[j].time);
+                    if (i==0) {
+                        y[n]=Obs.data[j].SNR[k]*0.25;
+                        col[n]=MColor[0][4];
                     }
-                    if (n < NObs) n++;
+                    else if (i==1) {
+                        if (!Mp[k]||Mp[k][j]==0.0) continue;
+                        y[n]=Mp[k][j];
+                        col[n]=MColor[0][4];
+                    }
+                    else {
+                        y[n]=El[j]*R2D;
+                        if (SimObs) col[n]=SysColor(Obs.data[j].sat);
+                        else col[n]=SnrColor(Obs.data[j].SNR[k]*0.25);
+                        if (El[j]>0.0&&El[j]<ElMask*D2R) col[n]=MColor[0][0];
+                    }
+                    if (timediff(time,Obs.data[j].time)==0.0&&np<MAXSAT) {
+                        yp[np]=y[n];
+                        colp[np++]=col[n];
+                    }
+                    if (n<NObs) n++;
                 }
-                if (!level || !(PlotStyle % 2)) {
-                    for (j = 0; j < n; j = k) {
-                        for (k = j + 1; k < n; k++) if (fabs(y[k - 1] - y[k]) > 30.0) break;
-                        DrawPolyS(GraphG[i], c, x + j, y + j, k - j, CColor[3], 0);
+                if (!level||!(PlotStyle%2)) {
+                    for (j=0;j<n;j=k) {
+                        for (k=j+1;k<n;k++) if (fabs(y[k-1]-y[k])>30.0) break;
+                        DrawPolyS(GraphG[i],c,x+j,y+j,k-j,CColor[3],0);
                     }
                 }
-                if (level && PlotStyle < 2) {
-                    for (j = 0; j < n; j++) {
-                        if (i != 1 && y[j] <= 0.0) continue;
-                        GraphG[i]->DrawMark(c, x[j], y[j], 0, col[j], MarkSize, 0);
+                if (level&&PlotStyle<2) {
+                    for (j=0;j<n;j++) {
+                        if (i!=1&&y[j]<=0.0) continue;
+                        GraphG[i]->DrawMark(c,x[j],y[j],0,col[j],MarkSize,0);
                     }
                 }
-                for (j = 0; j < n; j++) {
-                    if (y[j] == 0.0) continue;
-                    ave[i] += y[j];
-                    rms[i] += SQR(y[j]);
+                for (j=0;j<n;j++) {
+                    if (y[j]==0.0) continue;
+                    ave[i]+=y[j];
+                    rms[i]+=SQR(y[j]);
                     nrms[i]++;
                 }
             }
-            if (level && i == 1 && nrms[i] > 0 && ShowStats && !BtnShowTrack->isChecked()) {
-                ave[i] = ave[i] / nrms[i];
-                rms[i] = SQRT(rms[i] / nrms[i]);
-                GraphG[i]->GetPos(p1, p2);
-                p1.rx() = p2.x() - 8; p1.ry() += 3;
-                DrawLabel(GraphG[i], c, p1, QString("AVE=%1m RMS=%2m").arg(ave[i], 0, 'f', 4)
-                      .arg(rms[i], 0, 'f', 4), 2, 2);
+            if (level&&i==1&&nrms[i]>0&&ShowStats&&!BtnShowTrack->isChecked()) {
+                ave[i]=ave[i]/nrms[i];
+                rms[i]=sqrt(rms[i]/nrms[i]);
+                GraphG[i]->GetPos(p1,p2);
+                p1.rx()=p2.x()-8; p1.ry()+=3;
+                DrawLabel(GraphG[i],c,p1,QString("AVE=%1m RMS=%2m").arg(ave[i],0,'f',4)
+                          .arg(rms[i],0,'f',4),2,2);
             }
-            if (BtnShowTrack->isChecked() && 0 <= ind && ind < NObs && BtnSol1->isChecked()) {
+            if (BtnShowTrack->isChecked()&&0<=ind&&ind<NObs&&BtnSol1->isChecked()) {
                 if (!btn[i]->isChecked()) continue;
-                GraphG[i]->GetLim(xl, yl);
-                xl[0] = xl[1] = TimePos(time);
-                GraphG[i]->DrawPoly(c, xl, yl, 2, CColor[2], 0);
-
-                if (l++ == 0) {
-                    GraphG[i]->DrawMark(c, xl[0], yl[1] - 1E-6, 0, CColor[2], 5, 0);
-
-                    if (!BtnFixHoriz->isChecked())
-                        GraphG[i]->DrawMark(c, xl[0], yl[1] - 1E-6, 1, CColor[2], 9, 0);
+                GraphG[i]->GetLim(xl,yl);
+                xl[0]=xl[1]=TimePos(time);
+                GraphG[i]->DrawPoly(c,xl,yl,2,CColor[2],0);
+                
+                if (l++==0) {
+                    GraphG[i]->DrawMark(c,xl[0],yl[1]-1E-6,0,CColor[2],5,0);
+                    
+                    if (!BtnFixHoriz->isChecked()) {
+                        GraphG[i]->DrawMark(c,xl[0],yl[1]-1E-6,1,CColor[2],9,0);
+                    }
                 }
-                for (k = 0; k < np; k++) {
-                    if (i != 1 && yp[k] <= 0.0) continue;
-                    GraphG[i]->DrawMark(c, xl[0], yp[k], 0, CColor[0], MarkSize * 2 + 4, 0);
-                    GraphG[i]->DrawMark(c, xl[0], yp[k], 0, colp[k], MarkSize * 2 + 2, 0);
+                for (k=0;k<np;k++) {
+                    if (i!=1&&yp[k]<=0.0) continue;
+                    GraphG[i]->DrawMark(c,xl[0],yp[k],0,CColor[0],MarkSize*2+4,0);
+                    GraphG[i]->DrawMark(c,xl[0],yp[k],0,colp[k],MarkSize*2+2,0);
                 }
-                if (np <= 0 || np > 1 || (i != 1 && yp[0] <= 0.0)) continue;
-
-                GraphG[i]->GetPos(p1, p2);
-                p1.rx() = p2.x() - 8; p1.ry() += 3;
-                DrawLabel(GraphG[i], c, p1, QString("%1 %2").arg(yp[0], 0, 'f', i == 1 ? 4 : 1).arg(unit[i]), 2, 2);
+                if (np<=0||np>1||(i!=1&&yp[0]<=0.0)) continue;
+                
+                GraphG[i]->GetPos(p1,p2);
+                p1.rx()=p2.x()-8; p1.ry()+=3;
+                DrawLabel(GraphG[i],c,p1,QString("%1 %2").arg(yp[0],0,'f',i==1?4:1).arg(unit[i]),2,2);
             }
         }
         delete [] x;
         delete [] y;
         delete [] col;
     }
-    for (i = 0; i < 3; i++) {
+    for (i=0;i<3;i++) {
         if (!btn[i]->isChecked()) continue;
-        GraphG[i]->GetPos(p1, p2);
-        p1.rx() += 5; p1.ry() += 3;
-        DrawLabel(GraphG[i], c, p1, QString("%1 (%2)").arg(label[i]).arg(unit[i]), 1, 2);
+        GraphG[i]->GetPos(p1,p2);
+        p1.rx()+=5; p1.ry()+=3;
+        DrawLabel(GraphG[i],c,p1,QString("%1 (%2)").arg(label[i]).arg(unit[i]),1,2);
     }
 }
 // draw snr, mp-elevation-plot ----------------------------------------------
-void Plot::DrawSnrE(QPainter &c, int level)
+void Plot::DrawSnrE(QPainter &c,int level)
 {
-    QPushButton *btn[] = { BtnOn1, BtnOn2, BtnOn3 };
-    QString s, ObsTypeText = ObsType2->currentText();
-    QString label[] = { tr("SNR (dBHz)"), tr("Multipath (m)") };
-    QPoint p1, p2;
-    QColor *col[2], colp[2][MAXSAT];
-    gtime_t time = { 0, 0 };
-    double *x[2], *y[2], xl[2] = { -0.001, 90.0 }, yl[2][2] = { { 10.0, 65.0 }, { -10.0, 10.0 } };
-    double xp[2][MAXSAT], yp[2][MAXSAT], ave = 0.0, rms = 0.0;
+    QPushButton *btn[]={BtnOn1,BtnOn2,BtnOn3};
+    QString s,ObsTypeText=ObsType2->currentText();
+    QString label[]={tr("SNR (dBHz)"),tr("Multipath (m)")};
+    QPoint p1,p2;
+    QColor *col[2],colp[2][MAXSAT];
+    gtime_t time={0,0};
+    double *x[2],*y[2],xl[2]={-0.001,90.0},yl[2][2]={{10.0,65.0},{-10.0,10.0}};
+    double xp[2][MAXSAT],yp[2][MAXSAT],ave=0.0,rms=0.0;
     char code[32];
-    int i, j, k, n[2], np[2] = { 0 }, sat, ind = ObsIndex, hh = static_cast<int>(Disp->font().pointSize() * 1.5);
-    int nrms = 0;
-
-    strncpy(code, qPrintable(ObsTypeText.mid(1)), 32);
-
-    trace(3, "DrawSnrE: level=%d\n", level);
+    int i,j,k,n[2],np[2]={0},sat,ind=ObsIndex,hh=static_cast<int>(Disp->font().pointSize()*1.5);
+    int nrms=0;
 
-    yl[1][0] = -MaxMP; yl[1][1] = MaxMP;
+    strncpy(code,qPrintable(ObsTypeText.mid(1)),32);
 
-    j = 0;
-    for (i = 0; i < 2; i++) if (btn[i]->isChecked()) j = i;
-    for (i = 0; i < 2; i++) {
+    trace(3,"DrawSnrE: level=%d\n",level);
+    
+    yl[1][0]=-MaxMP; yl[1][1]=MaxMP;
+    
+    j=0;
+    for (i=0;i<2;i++) if (btn[i]->isChecked()) j=i;
+    for (i=0;i<2;i++) {
         if (!btn[i]->isChecked()) continue;
-        GraphE[i]->XLPos = i == j ? 1 : 0;
-        GraphE[i]->YLPos = 1;
-        GraphE[i]->SetLim(xl, yl[i]);
-        GraphE[i]->SetTick(0.0, 0.0);
-        GraphE[i]->DrawAxis(c, 1, 1);
-
-        GraphE[i]->GetPos(p1, p2);
+        GraphE[i]->XLPos=i==j?1:0;
+        GraphE[i]->YLPos=1;
+        GraphE[i]->SetLim(xl,yl[i]);
+        GraphE[i]->SetTick(0.0,0.0);
+        GraphE[i]->DrawAxis(c,1,1);
+        
+        GraphE[i]->GetPos(p1,p2);
         p1.setX(Disp->font().pointSize());
-        p1.setY((p1.y() + p2.y()) / 2);
-        GraphE[i]->DrawText(c, p1, label[i], CColor[2], 0, 0, 90);
-        if (i == j) {
-            p2.rx() -= 8; p2.ry() -= 6;
-            GraphE[i]->DrawText(c, p2, tr("Elevation ( %1 )").arg(degreeChar), CColor[2], 2, 1, 0);
+        p1.setY((p1.y()+p2.y())/2);
+        GraphE[i]->DrawText(c,p1,label[i],CColor[2],0,0,90);
+        if (i==j) {
+            p2.rx()-=8; p2.ry()-=6;
+            GraphE[i]->DrawText(c,p2,tr("Elevation ( %1 )").arg(degreeChar),CColor[2],2,1,0);
         }
     }
-
-    if (0 <= ind && ind < NObs && BtnShowTrack->isChecked())
-        time = Obs.data[IndexObs[ind]].time;
-
-    if (NObs > 0 && BtnSol1->isChecked()) {
-        for (i = 0; i < 2; i++) {
-            x[i] = new double[NObs],
-            y[i] = new double[NObs];
-            col[i] = new QColor[NObs];
+    if (0<=ind&&ind<NObs&&BtnShowTrack->isChecked()) {
+        time=Obs.data[IndexObs[ind]].time;
+    }
+    if (NObs>0&&BtnSol1->isChecked()) {
+        for (i=0;i<2;i++) {
+            x[i]=new double[NObs],
+            y[i]=new double[NObs];
+            col[i]=new QColor[NObs];
         }
-        for (sat = 1; sat <= MAXSAT; sat++) {
-            if (SatMask[sat - 1] || !SatSel[sat - 1]) continue;
-
-            for (j = n[0] = n[1] = 0; j < Obs.n; j++) {
-                if (Obs.data[j].sat != sat) continue;
-
-                for (k = 0; k < NFREQ + NEXOBS; k++)
-                    if (strstr(code2obs(Obs.data[j].code[k], NULL), code)) break;
-                if (k >= NFREQ + NEXOBS) continue;
-                if (El[j] <= 0.0) continue;
-
-                x[0][n[0]] = x[1][n[1]] = El[j] * R2D;
-
-                y[0][n[0]] = Obs.data[j].SNR[k] * 0.25;
-                y[1][n[1]] = !Mp[k] ? 0.0 : Mp[k][j];
-
-                col[0][n[0]] = col[1][n[1]] =
-                               El[j] > 0.0 && El[j] < ElMask * D2R ? MColor[0][0] : MColor[0][4];
-
-                if (y[0][n[0]] > 0.0) {
-                    if (timediff(time, Obs.data[j].time) == 0.0) {
-                        xp[0][np[0]] = x[0][n[0]];
-                        yp[0][np[0]] = y[0][n[0]];
-                        colp[0][np[0]] = ObsColor(Obs.data + j, Az[j], El[j]);
-                        if (np[0] < MAXSAT && colp[0][np[0]] != Qt::black) np[0]++;
+        for (sat=1;sat<=MAXSAT;sat++) {
+            if (SatMask[sat-1]||!SatSel[sat-1]) continue;
+            
+            for (j=n[0]=n[1]=0;j<Obs.n;j++) {
+                if (Obs.data[j].sat!=sat) continue;
+                
+                for (k=0;k<NFREQ+NEXOBS;k++) {
+                    if (strstr(code2obs(Obs.data[j].code[k],NULL),code)) break;
+                }
+                if (k>=NFREQ+NEXOBS) continue;
+                if (El[j]<=0.0) continue;
+                
+                x[0][n[0]]=x[1][n[1]]=El[j]*R2D;
+                
+                y[0][n[0]]=Obs.data[j].SNR[k]*0.25;
+                y[1][n[1]]=!Mp[k]?0.0:Mp[k][j];
+                
+                col[0][n[0]]=col[1][n[1]]=
+                    El[j]>0.0&&El[j]<ElMask*D2R?MColor[0][0]:MColor[0][4];
+                
+                if (y[0][n[0]]>0.0) {
+                    if (timediff(time,Obs.data[j].time)==0.0) {
+                        xp[0][np[0]]=x[0][n[0]];
+                        yp[0][np[0]]=y[0][n[0]];
+                        colp[0][np[0]]=ObsColor(Obs.data+j,Az[j],El[j]);
+                        if (np[0]<MAXSAT&&colp[0][np[0]]!=Qt::black) np[0]++;
                     }
-                    if (n[0] < NObs) n[0]++;
+                    if (n[0]<NObs) n[0]++;
                 }
-                if (y[1][n[1]] != 0.0) {
-                    if (El[j] >= ElMask * D2R) {
-                        ave += y[1][n[1]];
-                        rms += SQR(y[1][n[1]]);
+                if (y[1][n[1]]!=0.0) {
+                    if (El[j]>=ElMask*D2R) {
+                        ave+=y[1][n[1]];
+                        rms+=SQR(y[1][n[1]]);
                         nrms++;
                     }
-                    if (timediff(time, Obs.data[j].time) == 0.0) {
-                        xp[1][np[1]] = x[1][n[1]];
-                        yp[1][np[1]] = y[1][n[1]];
-                        colp[1][np[1]] = ObsColor(Obs.data + j, Az[j], El[j]);
-                        if (np[1] < MAXSAT && colp[1][np[1]] != Qt::black) np[1]++;
+                    if (timediff(time,Obs.data[j].time)==0.0) {
+                        xp[1][np[1]]=x[1][n[1]];
+                        yp[1][np[1]]=y[1][n[1]];
+                        colp[1][np[1]]=ObsColor(Obs.data+j,Az[j],El[j]);
+                        if (np[1]<MAXSAT&&colp[1][np[1]]!=Qt::black) np[1]++;
                     }
-                    if (n[1] < NObs) n[1]++;
+                    if (n[1]<NObs) n[1]++;
                 }
             }
-            if (!level || !(PlotStyle % 2)) {
-                for (i = 0; i < 2; i++) {
+            if (!level||!(PlotStyle%2)) {
+                for (i=0;i<2;i++) {
                     if (!btn[i]->isChecked()) continue;
-                    DrawPolyS(GraphE[i], c, x[i], y[i], n[i], CColor[3], 0);
+                    DrawPolyS(GraphE[i],c,x[i],y[i],n[i],CColor[3],0);
                 }
             }
-            if (level && PlotStyle < 2) {
-                for (i = 0; i < 2; i++) {
+            if (level&&PlotStyle<2) {
+                for (i=0;i<2;i++) {
                     if (!btn[i]->isChecked()) continue;
-                    for (j = 0; j < n[i]; j++)
-                        GraphE[i]->DrawMark(c, x[i][j], y[i][j], 0, col[i][j], MarkSize, 0);
+                    for (j=0;j<n[i];j++) {
+                        GraphE[i]->DrawMark(c,x[i][j],y[i][j],0,col[i][j],MarkSize,0);
+                    }
                 }
             }
         }
-        for (i = 0; i < 2; i++) {
+        for (i=0;i<2;i++) {
             delete [] x[i];
             delete [] y[i];
             delete [] col[i];
         }
-        if (BtnShowTrack->isChecked() && 0 <= ind && ind < NObs && BtnSol1->isChecked()) {
-            for (i = 0; i < 2; i++) {
+        if (BtnShowTrack->isChecked()&&0<=ind&&ind<NObs&&BtnSol1->isChecked()) {
+            
+            for (i=0;i<2;i++) {
                 if (!btn[i]->isChecked()) continue;
-                for (j = 0; j < np[i]; j++) {
-                    GraphE[i]->DrawMark(c, xp[i][j], yp[i][j], 0, CColor[0], MarkSize * 2 + 8, 0);
-                    GraphE[i]->DrawMark(c, xp[i][j], yp[i][j], 1, CColor[2], MarkSize * 2 + 6, 0);
-                    GraphE[i]->DrawMark(c, xp[i][j], yp[i][j], 0, colp[i][j], MarkSize * 2 + 2, 0);
+                for (j=0;j<np[i];j++) {
+                    GraphE[i]->DrawMark(c,xp[i][j],yp[i][j],0,CColor[0],MarkSize*2+8,0);
+                    GraphE[i]->DrawMark(c,xp[i][j],yp[i][j],1,CColor[2],MarkSize*2+6,0);
+                    GraphE[i]->DrawMark(c,xp[i][j],yp[i][j],0,colp[i][j],MarkSize*2+2,0);
                 }
             }
         }
     }
-
     if (ShowStats) {
-        for (i = 0; i < 2; i++) if (btn[i]->isChecked()) break;
-        if (i < 2) {
-            GraphE[i]->GetPos(p1, p2);
-            p1.rx() += 8; p1.ry() += 6;
-            s = QString("MARKER: %1 %2").arg(Sta.name).arg(Sta.marker);
-            DrawLabel(GraphE[i], c, p1, s, 1, 2); p1.ry() += hh;
-            s = QString("REC: %1 %2 %3").arg(Sta.rectype).arg(Sta.recver).arg(Sta.recsno);
-            DrawLabel(GraphE[i], c, p1, s, 1, 2); p1.ry() += hh;
-            s = QString("ANT: %1 %2").arg(Sta.antdes).arg(Sta.antsno);
-            DrawLabel(GraphE[i], c, p1, s, 1, 2); p1.ry() += hh;
+        for (i=0;i<2;i++) if (btn[i]->isChecked()) break;
+        if (i<2) {
+            GraphE[i]->GetPos(p1,p2);
+            p1.rx()+=8; p1.ry()+=6;
+            s=QString("MARKER: %1 %2").arg(Sta.name).arg(Sta.marker);
+            DrawLabel(GraphE[i],c,p1,s,1,2); p1.ry()+=hh;
+            s=QString("REC: %1 %2 %3").arg(Sta.rectype).arg(Sta.recver).arg(Sta.recsno);
+            DrawLabel(GraphE[i],c,p1,s,1,2); p1.ry()+=hh;
+            s=QString("ANT: %1 %2").arg(Sta.antdes).arg(Sta.antsno);
+            DrawLabel(GraphE[i],c,p1,s,1,2); p1.ry()+=hh;
         }
-        if (btn[1]->isChecked() && nrms > 0 && !BtnShowTrack->isChecked()) {
-            ave = ave / nrms;
-            rms = SQRT(rms / nrms);
-            GraphE[1]->GetPos(p1, p2);
-            p1.setX(p2.x() - 8); p1.ry() += 6;
-            DrawLabel(GraphE[1], c, p1, QString("AVE=%1m RMS=%2m").arg(ave, 0, 'f', 4).arg(rms, 0, 'f', 4), 2, 2);
+        if (btn[1]->isChecked()&&nrms>0&&!BtnShowTrack->isChecked()) {
+            ave=ave/nrms;
+            rms=sqrt(rms/nrms);
+            GraphE[1]->GetPos(p1,p2);
+            p1.setX(p2.x()-8); p1.ry()+=6;
+            DrawLabel(GraphE[1],c,p1,QString("AVE=%1m RMS=%2m").arg(ave,0,'f',4).arg(rms,0,'f',4),2,2);
         }
     }
 }
 // draw mp-skyplot ----------------------------------------------------------
-void Plot::DrawMpS(QPainter &c, int level)
+void Plot::DrawMpS(QPainter &c,int level)
 {
-    QString ObsTypeText = ObsType2->currentText(), s;
+    QString ObsTypeText=ObsType2->currentText(),s;
     QColor col;
     obsd_t *obs;
-    double x, y, xp, yp, xs, ys, xl[2], yl[2], p[MAXSAT][2] = { { 0 } }, r;
-    int i, j, sat, ind = ObsIndex;
+    double x,y,xp,yp,xs,ys,xl[2],yl[2],p[MAXSAT][2]={{0}},r;
+    int i,j,sat,ind=ObsIndex;
     char code[32];
     char id[32];
+    
+    strncpy(code,qPrintable(ObsTypeText.mid(1)),32);
 
-    strncpy(code, qPrintable(ObsTypeText.mid(1)), 32);
-
-    trace(3, "DrawSnrS: level=%d\n", level);
-
-    GraphS->GetLim(xl, yl);
-    r = (xl[1] - xl[0] < yl[1] - yl[0] ? xl[1] - xl[0] : yl[1] - yl[0]) * 0.45;
-
-    if (BtnShowImg->isChecked())
-        DrawSkyImage(c, level);
-
-    if (BtnShowSkyplot->isChecked())
-        GraphS->DrawSkyPlot(c, 0.0, 0.0, CColor[1], CColor[2], CColor[0], r * 2.0);
-
-    if (!BtnSol1->isChecked() || NObs <= 0 || SimObs) return;
-
-    GraphS->GetScale(xs, ys);
-
-    for (sat = 1; sat <= MAXSAT; sat++) {
-        if (SatMask[sat - 1] || !SatSel[sat - 1]) continue;
-
-        for (i = 0; i < Obs.n; i++) {
-            if (Obs.data[i].sat != sat) continue;
-
-            for (j = 0; j < NFREQ + NEXOBS; j++)
-                if (strstr(code2obs(Obs.data[i].code[j], NULL), code)) break;
-            if (j >= NFREQ + NEXOBS) continue;
-            if (El[i] <= 0.0) continue;
-
-            x = r * sin(Az[i]) * (1.0 - 2.0 * El[i] / PI);
-            y = r * cos(Az[i]) * (1.0 - 2.0 * El[i] / PI);
-            xp = p[sat - 1][0];
-            yp = p[sat - 1][1];
-            col = MpColor(!Mp[j] ? 0.0 : Mp[j][i]);
-
-            if ((x - xp) * (x - xp) + (y - yp) * (y - yp) >= xs * xs) {
-                int siz = PlotStyle < 2 ? MarkSize : 1;
-                GraphS->DrawMark(c, x, y, 0, col, siz, 0);
-                GraphS->DrawMark(c, x, y, 0, PlotStyle < 2 ? col : CColor[3], siz, 0);
-                p[sat - 1][0] = x;
-                p[sat - 1][1] = y;
+    trace(3,"DrawSnrS: level=%d\n",level);
+    
+    GraphS->GetLim(xl,yl);
+    r=(xl[1]-xl[0]<yl[1]-yl[0]?xl[1]-xl[0]:yl[1]-yl[0])*0.45;
+    
+    if (BtnShowImg->isChecked()) {
+        DrawSkyImage(c,level);
+    }
+    if (BtnShowSkyplot->isChecked()) {
+        GraphS->DrawSkyPlot(c,0.0,0.0,CColor[1],CColor[2],CColor[0],r*2.0);
+    }
+    if (!BtnSol1->isChecked()||NObs<=0||SimObs) return;
+    
+    GraphS->GetScale(xs,ys);
+    
+    for (sat=1;sat<=MAXSAT;sat++) {
+        if (SatMask[sat-1]||!SatSel[sat-1]) continue;
+        
+        for (i=0;i<Obs.n;i++) {
+            if (Obs.data[i].sat!=sat) continue;
+            
+            for (j=0;j<NFREQ+NEXOBS;j++) {
+                if (strstr(code2obs(Obs.data[i].code[j],NULL),code)) break;
+            }
+            if (j>=NFREQ+NEXOBS) continue;
+            if (El[i]<=0.0) continue;
+            
+            x=r*sin(Az[i])*(1.0-2.0*El[i]/PI);
+            y=r*cos(Az[i])*(1.0-2.0*El[i]/PI);
+            xp=p[sat-1][0];
+            yp=p[sat-1][1];
+            col=MpColor(!Mp[j]?0.0:Mp[j][i]);
+            
+            if ((x-xp)*(x-xp)+(y-yp)*(y-yp)>=xs*xs) {
+                int siz=PlotStyle<2?MarkSize:1;
+                GraphS->DrawMark(c,x,y,0,col,siz,0);
+                GraphS->DrawMark(c,x,y,0,PlotStyle<2?col:CColor[3],siz,0);
+                p[sat-1][0]=x;
+                p[sat-1][1]=y;
             }
         }
     }
-
-    if (BtnShowTrack->isChecked() && 0 <= ind && ind < NObs) {
-        for (i = IndexObs[ind]; i < Obs.n && i < IndexObs[ind + 1]; i++) {
-            obs = &Obs.data[i];
-            if (SatMask[obs->sat - 1] || !SatSel[obs->sat - 1] || El[i] <= 0.0) continue;
-            for (j = 0; j < NFREQ + NEXOBS; j++)
-                if (strstr(code2obs(obs->code[j], NULL), code)) break;
-            if (j >= NFREQ + NEXOBS) continue;
-            col = MpColor(!Mp[j] ? 0.0 : Mp[j][i]);
-
-            x = r * sin(Az[i]) * (1.0 - 2.0 * El[i] / PI);
-            y = r * cos(Az[i]) * (1.0 - 2.0 * El[i] / PI);
-
-            satno2id(obs->sat, id);
-            GraphS->DrawMark(c, x, y, 0, col, Disp->font().pointSize() * 2 + 5, 0);
-            GraphS->DrawMark(c, x, y, 1, CColor[2], Disp->font().pointSize() * 2 + 5, 0);
-            GraphS->DrawText(c, x, y, s = id, CColor[0], 0, 0, 0);
+    if (BtnShowTrack->isChecked()&&0<=ind&&ind<NObs) {
+        
+        for (i=IndexObs[ind];i<Obs.n&&i<IndexObs[ind+1];i++) {
+            obs=&Obs.data[i];
+            if (SatMask[obs->sat-1]||!SatSel[obs->sat-1]||El[i]<=0.0) continue;
+            for (j=0;j<NFREQ+NEXOBS;j++) {
+                if (strstr(code2obs(obs->code[j],NULL),code)) break;
+            }
+            if (j>=NFREQ+NEXOBS) continue;
+            col=MpColor(!Mp[j]?0.0:Mp[j][i]);
+            
+            x=r*sin(Az[i])*(1.0-2.0*El[i]/PI);
+            y=r*cos(Az[i])*(1.0-2.0*El[i]/PI);
+            
+            satno2id(obs->sat,id);
+            GraphS->DrawMark(c,x,y,0,col,Disp->font().pointSize()*2+5,0);
+            GraphS->DrawMark(c,x,y,1,CColor[2],Disp->font().pointSize()*2+5,0);
+            GraphS->DrawText(c,x,y,s=id,CColor[0],0,0,0);
         }
     }
 }
 // draw residuals and snr/elevation plot ------------------------------------
-void Plot::DrawRes(QPainter &c, int level)
+void Plot::DrawRes(QPainter &c,int level)
 {
-    QString label[] = {
+    QString label[]={
         tr("Pseudorange Residuals (m)"),
         tr("Carrier-Phase Residuals (m)"),
         tr("Elevation Angle (deg) / Signal Strength (dBHz)")
     };
     QString str;
-    QPushButton *btn[] = { BtnOn1, BtnOn2, BtnOn3 };
-    QPoint p1, p2;
-    double xc, yc, xl[2], yl[2], sum[2] = { 0 }, sum2[2] = { 0 };
-    int i, j, sel = !BtnSol1->isChecked() && BtnSol2->isChecked() ? 1 : 0, ind = SolIndex[sel];
-    int frq = FrqType->currentIndex() + 1;
-
-    trace(3, "DrawRes: level=%d\n", level);
-
-    if (0 <= ind && ind < SolData[sel].n && BtnShowTrack->isChecked() && BtnFixHoriz->isChecked()) {
-        gtime_t t = SolData[sel].data[ind].time;
-
-        for (i = 0; i < 3; i++) {
+    QPushButton *btn[]={BtnOn1,BtnOn2,BtnOn3};
+    QPoint p1,p2;
+    double xc,yc,xl[2],yl[2],sum[2]={0},sum2[2]={0};
+    int i,j,sel=!BtnSol1->isChecked()&&BtnSol2->isChecked()?1:0,ind=SolIndex[sel];
+    int frq=FrqType->currentIndex()+1;
+    
+    trace(3,"DrawRes: level=%d\n",level);
+    
+    if (0<=ind&&ind<SolData[sel].n&&BtnShowTrack->isChecked()&&BtnFixHoriz->isChecked()) {
+        
+        gtime_t t=SolData[sel].data[ind].time;
+        
+        for (i=0;i<3;i++) {
             if (BtnFixHoriz->isChecked()) {
                 double off;
-                GraphG[i]->GetLim(xl, yl);
-                off = Xcent * (xl[1] - xl[0]) / 2.0;
-                GraphG[i]->GetCent(xc, yc);
-                GraphG[i]->GetCent(xc, yc);
-                GraphG[i]->SetCent(TimePos(t) - off, yc);
-            } else {
-                GraphG[i]->GetRight(xc, yc);
-                GraphG[i]->SetRight(TimePos(t), yc);
+                GraphG[i]->GetLim(xl,yl);
+                off=Xcent*(xl[1]-xl[0])/2.0;
+                GraphG[i]->GetCent(xc,yc);
+                GraphG[i]->GetCent(xc,yc);
+                GraphG[i]->SetCent(TimePos(t)-off,yc);
+            }
+            else {
+                GraphG[i]->GetRight(xc,yc);
+                GraphG[i]->SetRight(TimePos(t),yc);
             }
         }
     }
-    j = -1;
-    for (i = 0; i < 3; i++) if (btn[i]->isChecked()) j = i;
-
-    for (i = 0; i < 3; i++) {
+    j=-1;
+    for (i=0;i<3;i++) if (btn[i]->isChecked()) j=i;
+    for (i=0;i<3;i++) {
         if (!btn[i]->isChecked()) continue;
-        GraphG[i]->XLPos = TimeLabel ? (i == j ? 6 : 5) : (i == j ? 1 : 0);
-        GraphG[i]->Week = Week;
-        GraphG[i]->DrawAxis(c, ShowLabel, ShowLabel);
+        GraphG[i]->XLPos=TimeLabel?(i==j?6:5):(i==j?1:0);
+        GraphG[i]->Week=Week;
+        GraphG[i]->DrawAxis(c,ShowLabel,ShowLabel);
     }
-
-    double *x, *y[4];
-    int n = SolStat[sel].n;
-    int m, ns[2] = { 0 }, *q, *s;
-
-    if (n > 0 && ((sel == 0 && BtnSol1->isChecked()) || (sel == 1 && BtnSol2->isChecked()))) {
-        q = new int[n];
-        s = new int[n];
-        x = new double[n],
-        y[0] = new double[n];
-        y[1] = new double[n];
-        y[2] = new double[n];
-        y[3] = new double[n];
-
-        for (int sat = 1; sat <= MAXSAT; sat++) {
+    double *x,*y[4];
+    int n=SolStat[sel].n;
+    int m,ns[2]={0},*q,*s;
+    
+    if (n>0&&((sel==0&&BtnSol1->isChecked())||(sel==1&&BtnSol2->isChecked()))) {
+        
+        q   =new int[n];
+        s   =new int[n];
+        x   =new double[n],
+        y[0]=new double[n];
+        y[1]=new double[n];
+        y[2]=new double[n];
+        y[3]=new double[n];
+        
+        for (int sat=1;sat<=MAXSAT;sat++) {
             char id[32];
-            satno2id(sat, id);
-            if (SatMask[sat - 1] || !SatSel[sat - 1]) continue;
-            m = 0;
-            for (int i = 0; i < n; i++) {
-                solstat_t *p = SolStat[sel].data + i;
-                if (p->sat != sat || p->frq != frq) continue;
-                if (p->resp == 0.0 && p->resc == 0.0) continue;
-                x[m] = TimePos(p->time);
-                y[0][m] = p->resp;
-                y[1][m] = p->resc;
-                y[2][m] = p->el * R2D;
-                y[3][m] = p->snr * 0.25;
-
-                if (!(p->flag >> 5)) q[m] = 0;          // invalid
-                else if ((p->flag & 7) <= 1) q[m] = 2;  // float
-                else if ((p->flag & 7) <= 3) q[m] = 1;  // fixed
-                else q[m] = 6;                          // ppp
-
-                s[m++] = (p->flag >> 3) & 0x3;          // slip
-
-                if (p->resp != 0.0) {
-                    sum [0] += p->resp;
-                    sum2[0] += p->resp * p->resp;
+            satno2id(sat,id);
+            if (SatMask[sat-1]||!SatSel[sat-1]) continue;
+            m=0;
+            for (int i=0;i<n;i++) {
+                solstat_t *p=SolStat[sel].data+i;
+                if (p->sat!=sat||p->frq!=frq) continue;
+                if (p->resp==0.0&&p->resc==0.0) continue;
+                x[m]=TimePos(p->time);
+                y[0][m]=p->resp;
+                y[1][m]=p->resc;
+                y[2][m]=p->el*R2D;
+                y[3][m]=p->snr*0.25;
+                if      (!(p->flag>>5))  q[m]=0; // invalid
+                else if ((p->flag&7)<=1) q[m]=2; // float
+                else if ((p->flag&7)<=3) q[m]=1; // fixed
+                else                     q[m]=6; // ppp
+                s[m++]=(p->flag>>3)&0x3;         // slip
+                
+                if (p->resp!=0.0) {
+                    sum [0]+=p->resp;
+                    sum2[0]+=p->resp*p->resp;
                     ns[0]++;
                 }
-                if (p->resc != 0.0) {
-                    sum [1] += p->resc;
-                    sum2[1] += p->resc * p->resc;
+                if (p->resc!=0.0) {
+                    sum [1]+=p->resc;
+                    sum2[1]+=p->resc*p->resc;
                     ns[1]++;
                 }
             }
-            for (int i = 0; i < 3; i++) {
+            for (int i=0;i<3;i++) {
                 if (!btn[i]->isChecked()) continue;
-                if (!level || !(PlotStyle % 2)) {
-                    DrawPolyS(GraphG[i], c, x, y[i], m, CColor[3], 0);
-                    if (i == 2) DrawPolyS(GraphG[i], c, x, y[3], m, CColor[3], 0);
+                if (!level||!(PlotStyle%2)) {
+                    DrawPolyS(GraphG[i],c,x,y[i],m,CColor[3],0);
+                    if (i==2) DrawPolyS(GraphG[i],c,x,y[3],m,CColor[3],0);
                 }
-                if (level && PlotStyle < 2) {
+                if (level&&PlotStyle<2) {
                     QColor color;
-                    for (int j = 0; j < m; j++) {
-                        color = i < 2 ? MColor[0][q[j]] : MColor[0][1];
-                        GraphG[i]->DrawMark(c, x[j], y[i][j], 0, color, MarkSize, 0);
-                        if (i == 2) GraphG[i]->DrawMark(c, x[j], y[3][j], 0, MColor[0][4], MarkSize, 0);
+                    for (int j=0;j<m;j++) {
+                        color=i<2?MColor[0][q[j]]:MColor[0][1];
+                        GraphG[i]->DrawMark(c,x[j],y[i][j],0,color,MarkSize,0);
+                        if (i==2) GraphG[i]->DrawMark(c,x[j],y[3][j],0,MColor[0][4],MarkSize,0);
                     }
                 }
-                if (level && i == 1) { /* slip */
-                    for (int j = 0; j < m; j++) {
+                if (level&&i==1) { /* slip */
+                    for (int j=0;j<m;j++) {
                         if (!s[j]) continue;
-                        QColor color = (s[j] & 1) ? MColor[0][5] : MColor[0][0];
-                        GraphG[i]->DrawMark(c, x[j], y[i][j], 4, color, MarkSize * 3, 90);
+                        QColor color=(s[j]&1)?MColor[0][5]:MColor[0][0];
+                        GraphG[i]->DrawMark(c,x[j],y[i][j],4,color,MarkSize*3,90);
                     }
                 }
             }
@@ -1987,150 +1932,157 @@
         delete [] y[1];
         delete [] y[2];
         delete [] y[3];
-
+        
         if (ShowStats) {
-            for (int i = 0; i < 2; i++) {
+            for (int i=0;i<2;i++) {
                 if (!btn[i]->isChecked()) continue;
-                double ave, std, rms;
-                ave = ns[i] <= 0 ? 0.0 : sum[i] / ns[i];
-                std = ns[i] <= 1 ? 0.0 : SQRT((sum2[i] - 2.0 * sum[i] * ave + ns[i] * ave * ave) / (ns[i] - 1));
-                rms = ns[i] <= 0 ? 0.0 : SQRT(sum2[i] / ns[i]);
-                GraphG[i]->GetPos(p1, p2);
-                p1.setX(p2.x() - 5);
-                p1.ry() += 3;
-                str = tr("AVE=%1m STD=%2m RMS=%3m").arg(ave, 0, 'f', 3).arg(std, 0, 'f', 3).arg(rms, 0, 'f', 3);
-                DrawLabel(GraphG[i], c, p1, str, 2, 2);
+                double ave,std,rms;
+                ave=ns[i]<=0?0.0:sum[i]/ns[i];
+                std=ns[i]<=1?0.0:SQRT((sum2[i]-2.0*sum[i]*ave+ns[i]*ave*ave)/(ns[i]-1));
+                rms=ns[i]<=0?0.0:SQRT(sum2[i]/ns[i]);
+                GraphG[i]->GetPos(p1,p2);
+                p1.setX(p2.x()-5);
+                p1.ry()+=3;
+                str=QString("AVE=%1m STD=%2m RMS=%3m").arg(ave,0,'f',3).arg(std,0,'f',3).arg(rms,0,'f',3);
+                DrawLabel(GraphG[i],c,p1,str,2,2);
             }
         }
-        if (BtnShowTrack->isChecked() && 0 <= ind && ind < SolData[sel].n && (BtnSol1->isChecked() || BtnSol2->isChecked())) {
-            for (int i = 0, j = 0; i < 3; i++) {
+        if (BtnShowTrack->isChecked()&&0<=ind&&ind<SolData[sel].n&&(BtnSol1->isChecked()||BtnSol2->isChecked())) {
+            for (int i=0,j=0;i<3;i++) {
                 if (!btn[i]->isChecked()) continue;
-                gtime_t t = SolData[sel].data[ind].time;
-                GraphG[i]->GetLim(xl, yl);
-                xl[0] = xl[1] = TimePos(t);
-                GraphG[i]->DrawPoly(c, xl, yl, 2, ind == 0 ? CColor[1] : CColor[2], 0);
-                if (j++ == 0) {
-                    GraphG[i]->DrawMark(c, xl[0], yl[1] - 1E-6, 0, CColor[2], 5, 0);
-                    GraphG[i]->DrawMark(c, xl[0], yl[1] - 1E-6, 1, CColor[2], 9, 0);
+                gtime_t t=SolData[sel].data[ind].time;
+                GraphG[i]->GetLim(xl,yl);
+                xl[0]=xl[1]=TimePos(t);
+                GraphG[i]->DrawPoly(c,xl,yl,2,ind==0?CColor[1]:CColor[2],0);
+                if (j++==0) {
+                    GraphG[i]->DrawMark(c,xl[0],yl[1]-1E-6,0,CColor[2],5,0);
+                    GraphG[i]->DrawMark(c,xl[0],yl[1]-1E-6,1,CColor[2],9,0);
                 }
             }
         }
     }
-    for (i = 0; i < 3; i++) {
+    for (i=0;i<3;i++) {
         if (!btn[i]->isChecked()) continue;
-        GraphG[i]->GetPos(p1, p2);
-        p1.rx() += 5; p1.ry() += 3;
-        DrawLabel(GraphG[i], c, p1, label[i], 1, 2);
+        GraphG[i]->GetPos(p1,p2);
+        p1.rx()+=5; p1.ry()+=3;
+        DrawLabel(GraphG[i],c,p1,label[i],1,2);
     }
 }
 // draw polyline without time-gaps ------------------------------------------
-void Plot::DrawPolyS(Graph *graph, QPainter &c, double *x, double *y, int n,
-             const QColor &color, int style)
+void Plot::DrawPolyS(Graph *graph,QPainter &c, double *x, double *y, int n,
+    const QColor &color, int style)
 {
-    int i, j;
-
-    for (i = 0; i < n; i = j) {
-        for (j = i + 1; j < n; j++) if (fabs(x[j] - x[j - 1]) > TBRK) break;
-        graph->DrawPoly(c, x + i, y + i, j - i, color, style);
+    int i,j;
+    
+    for (i=0;i<n;i=j) {
+        for (j=i+1;j<n;j++) if (fabs(x[j]-x[j-1])>TBRK) break;
+        graph->DrawPoly(c,x+i,y+i,j-i,color,style);
     }
 }
 // draw label with hemming --------------------------------------------------
-void Plot::DrawLabel(Graph *g, QPainter &c, const QPoint &p, const QString &label, int ha, int va)
+void Plot::DrawLabel(Graph *g,QPainter &c, const QPoint &p, const QString &label, int ha, int va)
 {
-    g->DrawText(c, p, label, CColor[2], CColor[0], ha, va, 0);
+    g->DrawText(c,p,label,CColor[2],CColor[0],ha,va,0);
 }
 // draw mark with hemming ---------------------------------------------------
-void Plot::DrawMark(Graph *g, QPainter &c, const QPoint &p, int mark, const QColor &color,
-            int size, int rot)
+void Plot::DrawMark(Graph *g,QPainter &c, const QPoint &p, int mark, const QColor &color,
+    int size, int rot)
 {
-    g->DrawMark(c, p, mark, color, CColor[0], size, rot);
+    g->DrawMark(c,p,mark,color,CColor[0],size,rot);
 }
 // refresh google earth/map view --------------------------------------------------
 void Plot::Refresh_GEView(void)
 {
     TIMEPOS *vel;
     sol_t *sol;
-    double pos[3] = { 0 }, heading, ddeg;
-    int opts[12], sel = !BtnSol1->isChecked() && BtnSol2->isChecked() ? 1 : 0;
-
+    double pos[3]={0},heading,ddeg;
+    int opts[12],sel=!BtnSol1->isChecked()&&BtnSol2->isChecked()?1:0;
+    
     // get ge options
     googleEarthView->GetOpts(opts);
-
+    
     if (BtnShowTrack->isChecked()) {
+        
         // update mark
-        if (BtnSol2->isChecked() && SolData[1].n > 0) {
-            sol = getsol(SolData + 1, SolIndex[1]);
-            ecef2pos(sol->rr, pos);
-            pos[2] -= geoidh(pos);
-            googleEarthView->SetMark(2, pos);
+        if (BtnSol2->isChecked()&&SolData[1].n>0) {
+            sol=getsol(SolData+1,SolIndex[1]);
+            ecef2pos(sol->rr,pos);
+            pos[2]-=geoidh(pos);
+            googleEarthView->SetMark(2,pos);
             googleEarthView->ShowMark(2);
-            googleMapView->SetMark(2, pos);
+            googleMapView->SetMark(2,pos);
             googleMapView->ShowMark(2);
-        } else {
+        }
+        else {
             googleEarthView->HideMark(2);
             googleMapView->HideMark(2);
         }
-        if (BtnSol1->isChecked() && SolData[0].n > 0) {
-            sol = getsol(SolData, SolIndex[0]);
-            ecef2pos(sol->rr, pos);
-            pos[2] -= geoidh(pos);
-            googleEarthView->SetMark(1, pos);
+        if (BtnSol1->isChecked()&&SolData[0].n>0) {
+            sol=getsol(SolData,SolIndex[0]);
+            ecef2pos(sol->rr,pos);
+            pos[2]-=geoidh(pos);
+            googleEarthView->SetMark(1,pos);
             googleEarthView->ShowMark(1);
-            googleMapView->SetMark(1, pos);
+            googleMapView->SetMark(1,pos);
             googleMapView->ShowMark(1);
-        } else {
+        }
+        else {
             googleEarthView->HideMark(1);
             googleMapView->HideMark(1);
         }
         // update heading
-        if (opts[10] && norm(pos, 3) > 0.0) {
-            vel = SolToPos(SolData + sel, SolIndex[sel], 0, 1);
-            heading = ATAN2(vel->x[0], vel->y[0]) * R2D;
-
+        if (opts[10]&&norm(pos,3)>0.0) {
+            vel=SolToPos(SolData+sel,SolIndex[sel],0,1);
+            heading=ATAN2(vel->x[0],vel->y[0])*R2D;
+            
             // filter
-            if (vel->x[0] * vel->x[0] + vel->y[0] * vel->y[0] > 0.5) {
-                ddeg = heading - GEHeading;
-                if (ddeg < -180.0) ddeg += 360.0;
-                else if (ddeg > 180.0) ddeg -= 360.0;
-                GEHeading += 0.5 * ddeg;
-                if (GEHeading < -180.0) GEHeading += 360.0;
-                else if (GEHeading > 180.0) GEHeading -= 360.0;
+            if (vel->x[0]*vel->x[0]+vel->y[0]*vel->y[0]>0.5) {
+                ddeg=heading-GEHeading;
+                if      (ddeg<-180.0) ddeg+=360.0;
+                else if (ddeg> 180.0) ddeg-=360.0;
+                GEHeading+=0.5*ddeg;
+                if      (GEHeading<-180.0) GEHeading+=360.0;
+                else if (GEHeading> 180.0) GEHeading-=360.0;
             }
             googleEarthView->SetHeading(GEHeading);
-
+            
             delete vel;
         }
-    } else {
+    }
+    else {
         googleEarthView->HideMark(1);
         googleEarthView->HideMark(2);
         googleMapView->HideMark(1);
         googleMapView->HideMark(2);
     }
     // update track
-    if (BtnSol1->isChecked() && !BtnConnect->isChecked()) {
+    if (BtnSol1->isChecked()&&!BtnConnect->isChecked()) {
         if (!GEDataState[0]) {
             googleEarthView->HideTrack(1);
-            GEDataState[0] = googleEarthView->UpdateTrack(1, SolData);
+            GEDataState[0]=googleEarthView->UpdateTrack(1,SolData);
         }
         googleEarthView->ShowTrack(1);
-    } else {
+    }
+    else {
         googleEarthView->HideTrack(1);
     }
-    if (BtnSol2->isChecked() && !BtnConnect->isChecked()) {
+    if (BtnSol2->isChecked()&&!BtnConnect->isChecked()) {
         if (!GEDataState[1]) {
             googleEarthView->HideTrack(2);
-            GEDataState[1] = googleEarthView->UpdateTrack(2, SolData + 1);
+            GEDataState[1]=googleEarthView->UpdateTrack(2,SolData+1);
         }
         googleEarthView->ShowTrack(2);
-    } else {
+    }
+    else {
         googleEarthView->HideTrack(2);
     }
-
     // update points
-    if (BtnShowMap->isChecked())
+    if (BtnShowMap->isChecked()) {
         googleEarthView->ShowPoint();
-    else
+    }
+    else {
         googleEarthView->HidePoint();
+    }
 }
 // refresh google map view -----------------------------------------------------
 void Plot::Refresh_GMView(void)
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotinfo.cpp RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotinfo.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotinfo.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotinfo.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -5,68 +5,73 @@
 
 #include "rtklib.h"
 
-#define ATAN2(x, y)  ((x) * (x) + (y) * (y) > 1E-12 ? atan2(x, y) : 0.0)
+#define ATAN2(x,y)  ((x)*(x)+(y)*(y)>1E-12?atan2(x,y):0.0)
 
 // update information on status-bar -----------------------------------------
 void Plot::UpdateInfo(void)
 {
-    int showobs = (PLOT_OBS <= PlotType && PlotType <= PLOT_DOP) ||
-              PlotType == PLOT_SNR || PlotType == PLOT_SNRE || PlotType == PLOT_MPS;
-
-    trace(3, "UpdateInfo:\n");
-
+    int showobs=(PLOT_OBS<=PlotType&&PlotType<=PLOT_DOP)||
+                PlotType==PLOT_SNR||PlotType==PLOT_SNRE||PlotType==PLOT_MPS;
+    
+    trace(3,"UpdateInfo:\n");
+    
     if (BtnShowTrack->isChecked()) {
         if (showobs) UpdateTimeObs(); else UpdateTimeSol();
-    } else {
+    }
+    else {
         if (showobs) UpdateInfoObs(); else UpdateInfoSol();
     }
 }
 // update time-information for observation-data plot ------------------------
 void Plot::UpdateTimeObs(void)
 {
-    QString msgs1[] = { " OBS=L1/2 ", " L1 ", " L2 ", " L1/2/5 ", " L1/5 ", "", " L5 " };
-    QString msgs2[] = { " SNR=...45.", "..40.", "..35.", "..30.", "..25 ", "", " <25 " };
-    QString msgs3[] = { " SYS=GPS ", "GLO ", "GAL ", "QZS ", "BDS ", "SBS ", "" };
-    QString msgs4[] = { " MP=..0.6", "..0.3", "..0.0..", "-0.3..", "-0.6..", "", "" };
+    QString msgs1[]={" OBS=L1/2 "," L1 "," L2 "," L1/2/5 "," L1/5 ",""," L5 "};
+    QString msgs2[]={" SNR=...45.","..40.","..35.","..30.","..25 ",""," <25 "};
+    QString msgs3[]={" SYS=GPS ","GLO ","GAL ","QZS ","BDS ","SBS ",""};
+    QString msgs4[]={" MP=..0.6","..0.3","..0.0..","-0.3..","-0.6..","",""};
     QString msgs[8];
     QString msg;
-    double azel[MAXOBS * 2], dop[4] = { 0 };
-    int i, ns = 0, no = 0, ind = ObsIndex;
+    double azel[MAXOBS*2],dop[4]={0};
+    int i,ns=0,no=0,ind=ObsIndex;
     QString tstr;
-
-    trace(3, "UpdateTimeObs\n");
-
-    if (BtnSol1->isChecked() && 0 <= ind && ind < NObs) {
-        for (i = IndexObs[ind]; i < Obs.n && i < IndexObs[ind + 1]; i++, no++) {
-            if (SatMask[Obs.data[i].sat - 1] || !SatSel[Obs.data[i].sat - 1]) continue;
-            if (El[i] < ElMask * D2R) continue;
-            if (ElMaskP && El[i] < ElMaskData[static_cast<int>(Az[i] * R2D + 0.5)]) continue;
-            azel[ns * 2] = Az[i];
-            azel[1 + ns * 2] = El[i];
+    
+    trace(3,"UpdateTimeObs\n");
+    
+    if (BtnSol1->isChecked()&&0<=ind&&ind<NObs) {
+        
+        for (i=IndexObs[ind];i<Obs.n&&i<IndexObs[ind+1];i++,no++) {
+            if (SatMask[Obs.data[i].sat-1]||!SatSel[Obs.data[i].sat-1]) continue;
+            if (El[i]<ElMask*D2R) continue;
+            if (ElMaskP&&El[i]<ElMaskData[static_cast<int>(Az[i]*R2D+0.5)]) continue;
+            azel[  ns*2]=Az[i];
+            azel[1+ns*2]=El[i];
             ns++;
         }
     }
-    if (ns >= 0) {
-        dops(ns, azel, ElMask * D2R, dop);
-
-        TimeStr(Obs.data[IndexObs[ind]].time, 3, 1, tstr);
-        msg = QString("[1]%1 : N=%2 ").arg(tstr).arg(no);
-
-        if (PlotType == PLOT_DOP) {
-            msgs[0] = (QString("NSAT=%1").arg(ns));
-            msgs[1] = (QString(" GDOP=%1").arg(dop[0], 0, 'f', 1));
-            msgs[2] = (QString(" PDOP=%1").arg(dop[1], 0, 'f', 1));
-            msgs[3] = (QString(" HDOP=%1").arg(dop[2], 0, 'f', 1));
-            msgs[4] = (QString(" VDOP=%1").arg(dop[3], 0, 'f', 1));
-        } else if (PlotType <= PLOT_SKY && ObsType->currentIndex() == 0) {
-            msg += QString("NSAT=%1 ").arg(ns);
-            for (i = 0; i < 7; i++) msgs[i] = SimObs ? msgs3[i] : msgs1[i];
-        } else if (PlotType == PLOT_MPS) {
-            msg += QString("NSAT=%1 ").arg(ns);
-            for (i = 0; i < 7; i++) msgs[i] = msgs4[i];
-        } else {
-            msg += QString("NSAT=%1 ").arg(ns);
-            for (i = 0; i < 7; i++) msgs[i] = SimObs ? msgs3[i] : msgs2[i];
+    if (ns>=0) {
+        dops(ns,azel,ElMask*D2R,dop);
+        
+        TimeStr(Obs.data[IndexObs[ind]].time,3,1,tstr);
+        msg=QString("[1]%1 : N=%2 ").arg(tstr).arg(no);
+        
+        if (PlotType==PLOT_DOP) {
+            msgs[0]=(QString("NSAT=%1").arg(ns));
+            msgs[1]=(QString(" GDOP=%1").arg(dop[0],0,'f',1));
+            msgs[2]=(QString(" PDOP=%1").arg(dop[1],0,'f',1));
+            msgs[3]=(QString(" HDOP=%1").arg(dop[2],0,'f',1));
+            msgs[4]=(QString(" VDOP=%1").arg(dop[3],0,'f',1));
+        }
+        else if (PlotType<=PLOT_SKY&&ObsType->currentIndex()==0) {
+            msg+=QString("NSAT=%1 ").arg(ns);
+            for (i=0;i<7;i++) msgs[i]=SimObs?msgs3[i]:msgs1[i];
+        }
+        else if (PlotType==PLOT_MPS) {
+            msg+=QString("NSAT=%1 ").arg(ns);
+            for (i=0;i<7;i++) msgs[i]=msgs4[i];
+        }
+        else {
+            msg+=QString("NSAT=%1 ").arg(ns);
+            for (i=0;i<7;i++) msgs[i]=SimObs?msgs3[i]:msgs2[i];
         }
     }
     ShowMsg(msg);
@@ -75,45 +80,50 @@
 // update time-information for solution plot --------------------------------
 void Plot::UpdateTimeSol(void)
 {
-    const char *unit[] = { "m", "m/s", "m/s2" }, *u;
-    const QString sol[] = { tr(""), tr("FIX"), tr("FLOAT"), tr("SBAS"), tr("DGPS"), tr("Single"), tr("PPP") };
+    const char *unit[]={"m","m/s","m/s2"},*u;
+    const QString sol[]={tr(""),tr("FIX"),tr("FLOAT"),tr("SBAS"),tr("DGPS"),tr("Single"),tr("PPP")};
     QString msg;
     QString msgs[8];
     sol_t *data;
-    double xyz[3], pos[3], r, az, el;
-    int sel = BtnSol1->isChecked() || !BtnSol2->isChecked() ? 0 : 1, ind = SolIndex[sel];
+    double xyz[3],pos[3],r,az,el;
+    int sel=BtnSol1->isChecked()||!BtnSol2->isChecked()?0:1,ind=SolIndex[sel];
     QString tstr;
-
-    trace(3, "UpdateTimeSol\n");
-
-    if ((BtnSol1->isChecked() || BtnSol2->isChecked() || BtnSol12->isChecked()) &&
-        (data = getsol(SolData + sel, ind))) {
-        if (!ConnectState) msg = QString("[%1]").arg(sel + 1); else msg = "[R]";
-
-        TimeStr(data->time, 2, 1, tstr);
-        msg += tstr;
-        msg += " : ";
-
-        if (PLOT_SOLP <= PlotType && PlotType <= PLOT_SOLA) {
-            PosToXyz(data->time, data->rr, data->type, xyz);
-            u = unit[PlotType - PLOT_SOLP];
-            msg += QString("E=%1%2 N=%3%2 U=%4%2 Q=")
-                   .arg(xyz[0], 7, 'f', 4).arg(u).arg(xyz[1], 7, 'f', 4).arg(xyz[2], 7, 'f', 4);
-        } else if (PlotType == PLOT_NSAT) {
-            msg += QString("NS=%1 AGE=%2 RATIO=%3 Q=").arg(data->ns).arg(data->age, 0, 'f', 1)
-                   .arg(data->ratio, 0, 'f', 1);
-        } else if (!data->type) {
-            ecef2pos(data->rr, pos);
-            msg += LatLonStr(pos, 9) + QString(" %1m  Q=").arg(pos[2], 9, 'f', 4);
-        } else {
-            r = norm(data->rr, 3);
-            az = norm(data->rr, 2) <= 1E-12 ? 0.0 : atan2(data->rr[0], data->rr[1]) * R2D;
-            el = r <= 1E-12 ? 0.0 : asin(data->rr[2] / r) * R2D;
-            msg += QString("B=%1m D=%2%3 %4%5  Q=")
-                   .arg(r, 0, 'f', 3).arg(az < 0.0 ? az + 360.0 : az, 6, 'f', 2).arg(degreeChar).arg(el, 5, 'f', 2).arg(degreeChar);
+    
+    trace(3,"UpdateTimeSol\n");
+    
+    if ((BtnSol1->isChecked()||BtnSol2->isChecked()||BtnSol12->isChecked())&&
+        (data=getsol(SolData+sel,ind))) {
+        
+        if (!ConnectState) msg=QString("[%1]").arg(sel+1); else msg="[R]";
+        
+        TimeStr(data->time,2,1,tstr);
+        msg+=tstr;
+        msg+=" : ";
+        
+        if (PLOT_SOLP<=PlotType&&PlotType<=PLOT_SOLA) {
+            PosToXyz(data->time,data->rr,data->type,xyz);
+            u=unit[PlotType-PLOT_SOLP];
+            msg+=QString("E=%1%2 N=%3%2 U=%4%2 Q=")
+                           .arg(xyz[0],7,'f',4).arg(u).arg(xyz[1],7,'f',4).arg(xyz[2],7,'f',4);
+        }
+        else if (PlotType==PLOT_NSAT) {
+            msg+=QString("NS=%1 AGE=%2 RATIO=%3 Q=").arg(data->ns).arg(data->age,0,'f',1)
+                           .arg(data->ratio,0,'f',1);
+        }
+        else if (!data->type) {
+            ecef2pos(data->rr,pos);
+            msg+=LatLonStr(pos,9)+QString(" %1m  Q=").arg(pos[2],9,'f',4);
+        }
+        else {
+            r=norm(data->rr,3);
+            az=norm(data->rr,2)<=1E-12?0.0:atan2(data->rr[0],data->rr[1])*R2D;
+            el=r<=1E-12?0.0:asin(data->rr[2]/r)*R2D;
+            msg+=QString("B=%1m D=%2%3 %4%5  Q=")
+                           .arg(r,0,'f',3).arg(az<0.0?az+360.0:az,6,'f',2).arg(degreeChar).arg(el,5,'f',2).arg(degreeChar);
+        }
+        if (1<=data->stat&&data->stat<=6) {
+            msgs[data->stat-1]=QString("%1:%2").arg(data->stat).arg(sol[data->stat]);
         }
-        if (1 <= data->stat && data->stat <= 6)
-            msgs[data->stat - 1] = QString("%1:%2").arg(data->stat).arg(sol[data->stat]);
     }
     ShowMsg(msg);
     ShowLegend(msgs);
@@ -121,42 +131,46 @@
 // update statistics-information for observation-data plot ------------------
 void Plot::UpdateInfoObs(void)
 {
-    QString msgs0[] = { " NSAT", " GDOP", " PDOP", " HDOP", " VDOP", "", "" };
-    QString msgs1[] = { " OBS=L1/2 ", " L1 ", " L2 ", " L1/2/5 ", " L1/5 ", "", " L5 " };
-    QString msgs2[] = { " SNR=...45.", "..40.", "..35.", "..30.", "..25 ", "", " <25 " };
-    QString msgs3[] = { " SYS=GPS ", "GLO ", "GAL ", "QZS ", "BDS ", "SBS ", "" };
-    QString msgs4[] = { " MP=..0.6", "..0.3", "..0.0..", "-0.3..", "-0.6..", "", "" };
+    QString msgs0[]={"  NSAT"," GDOP"," PDOP"," HDOP"," VDOP","",""};
+    QString msgs1[]={" OBS=L1/2 "," L1 "," L2 "," L1/2/5 "," L1/5 ",""," L5 "};
+    QString msgs2[]={" SNR=...45.","..40.","..35.","..30.","..25 ",""," <25 "};
+    QString msgs3[]={" SYS=GPS ","GLO ","GAL ","QZS ","BDS ","SBS ",""};
+    QString msgs4[]={" MP=..0.6","..0.3","..0.0..","-0.3..","-0.6..","",""};
     QString msg;
     QString msgs[8];
-    gtime_t ts = { 0, 0 }, te = { 0, 0 }, t, tp = { 0, 0 };
-    int i, n = 0, ne = 0;
-    QString s1, s2;
-
-    trace(3, "UpdateInfoObs:\n");
-
+    gtime_t ts={0,0},te={0,0},t,tp={0,0};
+    int i,n=0,ne=0;
+    QString s1,s2;
+    
+    trace(3,"UpdateInfoObs:\n");
+    
     if (BtnSol1->isChecked()) {
-        for (i = 0; i < Obs.n; i++) {
-            t = Obs.data[i].time;
-            if (ts.time == 0) ts = t;
-            te = t;
-            if (tp.time == 0 || timediff(t, tp) > TTOL) ne++;
-            n++; tp = t;
+        for (i=0;i<Obs.n;i++) {
+            t=Obs.data[i].time;
+            if (ts.time==0) ts=t;
+            te=t;
+            if (tp.time==0||timediff(t,tp)>TTOL) ne++; 
+            n++; tp=t; 
         }
     }
-    if (n > 0) {
-        TimeStr(ts, 0, 0, s1);
-        TimeStr(te, 0, 1, s2);
-        msg = QString("[1]%1-%2 : EP=%3 N=%4").arg(s1).arg(s2.mid(TimeLabel ? 5 : 0)).arg(ne).arg(n);
-
-        for (i = 0; i < 7; i++) {
-            if (PlotType == PLOT_DOP)
-                msgs[i] = msgs0[i];
-            else if (PlotType <= PLOT_SKY && ObsType->currentIndex() == 0)
-                msgs[i] = SimObs ? msgs3[i] : msgs1[i];
-            else if (PlotType == PLOT_MPS)
-                msgs[i] = msgs4[i];
-            else
-                msgs[i] = SimObs ? msgs3[i] : msgs2[i];
+    if (n>0) {
+        TimeStr(ts,0,0,s1);
+        TimeStr(te,0,1,s2);
+        msg=QString("[1]%1-%2 : EP=%3 N=%4").arg(s1).arg(s2.mid(TimeLabel?5:0)).arg(ne).arg(n);
+        
+        for (i=0;i<7;i++) {
+            if (PlotType==PLOT_DOP) {
+                msgs[i]=msgs0[i];
+            }
+            else if (PlotType<=PLOT_SKY&&ObsType->currentIndex()==0) {
+                msgs[i]=SimObs?msgs3[i]:msgs1[i];
+            }
+            else if (PlotType==PLOT_MPS) {
+                msgs[i]=msgs4[i];
+            }
+            else {
+                msgs[i]=SimObs?msgs3[i]:msgs2[i];
+            }
         }
     }
     ShowMsg(msg);
@@ -165,62 +179,65 @@
 // update statistics-information for solution plot --------------------------
 void Plot::UpdateInfoSol(void)
 {
-    QString msg, msgs[8], s;
-    TIMEPOS *pos = NULL, *pos1, *pos2;
+    QString msg,msgs[8],s;
+    TIMEPOS *pos=NULL,*pos1,*pos2;
     sol_t *data;
-    gtime_t ts = { 0, 0 }, te = { 0, 0 };
-    double r[3], b, bl[2] = { 1E9, 0.0 };
-    int i, j, n = 0, nq[8] = { 0 }, sel = BtnSol1->isChecked() || !BtnSol2->isChecked() ? 0 : 1;
-    QString s1, s2;
-
-    trace(3, "UpdateInfoSol:\n");
-
-    if (BtnSol1->isChecked() || BtnSol2->isChecked()) {
-        pos = SolToPos(SolData + sel, -1, 0, 0);
-    } else if (BtnSol12->isChecked()) {
-        pos1 = SolToPos(SolData, -1, 0, 0);
-        pos2 = SolToPos(SolData + 1, -1, 0, 0);
-        pos = pos1->diff(pos2, 0);
+    gtime_t ts={0,0},te={0,0};
+    double r[3],b,bl[2]={1E9,0.0};
+    int i,j,n=0,nq[8]={0},sel=BtnSol1->isChecked()||!BtnSol2->isChecked()?0:1;
+    QString s1,s2;
+    
+    trace(3,"UpdateInfoSol:\n");
+    
+    if (BtnSol1->isChecked()||BtnSol2->isChecked()) {
+        pos=SolToPos(SolData+sel,-1,0,0);
+    }
+    else if (BtnSol12->isChecked()) {
+        pos1=SolToPos(SolData  ,-1,0,0);
+        pos2=SolToPos(SolData+1,-1,0,0);
+        pos=pos1->diff(pos2,0);
         delete pos1;
         delete pos2;
     }
     if (pos) {
-        for (i = 0; i < pos->n; i++) {
-            if (ts.time == 0) ts = pos->t[i];
-            te = pos->t[i];
+        for (i=0;i<pos->n;i++) {
+            if (ts.time==0) ts=pos->t[i];
+            te=pos->t[i];
             nq[pos->q[i]]++;
-            n++;
+            n++; 
         }
         delete pos;
     }
-    for (i = 0; (data = getsol(SolData + sel, i)) != NULL; i++) {
+    for (i=0;(data=getsol(SolData+sel,i))!=NULL;i++) {
         if (data->type) {
-            b = norm(data->rr, 3);
-        } else if (norm(SolData[sel].rb, 3) > 0.0) {
-            for (j = 0; j < 3; j++) r[j] = data->rr[j] - SolData[sel].rb[j];
-            b = norm(r, 3);
-        } else {
-            b = 0.0;
+            b=norm(data->rr,3);
         }
-        if (b < bl[0]) bl[0] = b;
-        if (b > bl[1]) bl[1] = b;
+        else if (norm(SolData[sel].rb,3)>0.0) {
+            for (j=0;j<3;j++) r[j]=data->rr[j]-SolData[sel].rb[j];
+            b=norm(r,3);
+        }
+        else b=0.0;
+        if (b<bl[0]) bl[0]=b;
+        if (b>bl[1]) bl[1]=b;
     }
-    if (n > 0) {
-        if (!ConnectState) msg = QString("[%1]").arg(sel + 1); else msg = "[R]";
-
-        TimeStr(ts, 0, 0, s1);
-        TimeStr(te, 0, 1, s2);
-        msg += QString("%1-%2 : N=%3").arg(s1).arg(s2.mid(TimeLabel ? 5 : 0)).arg(n);
-
-        if (bl[0] + 100.0 < bl[1])
-            msg += QString(" B=%1-%2km").arg(bl[0] / 1E3, 0, 'f', 1).arg(bl[1] / 1E3, 0, 'f', 1);
-        else
-            msg += QString(" B=%1km").arg(bl[0] / 1E3, 0, 'f', 1);
-        msg += " Q=";
-
-        for (i = 1; i <= 6; i++) {
-            if (nq[i] <= 0) continue;
-            msgs[i - 1] = QString("%1:%2(%3%) ").arg(i).arg(nq[i]).arg(static_cast<double>(nq[i]) / n * 100.0, 0, 'f', 1);
+    if (n>0) {
+        if (!ConnectState) msg=QString("[%1]").arg(sel+1); else msg="[R]";
+        
+        TimeStr(ts,0,0,s1);
+        TimeStr(te,0,1,s2);
+        msg+=QString("%1-%2 : N=%3").arg(s1).arg(s2.mid(TimeLabel?5:0)).arg(n);
+        
+        if (bl[0]+100.0<bl[1]) {
+            msg+=QString(" B=%1-%2km").arg(bl[0]/1E3,0,'f',1).arg(bl[1]/1E3,0,'f',1);
+        }
+        else {
+            msg+=QString(" B=%1km").arg(bl[0]/1E3,0,'f',1);
+        }
+        msg+=" Q=";
+        
+        for (i=1;i<=6;i++) {
+            if (nq[i]<=0) continue;
+            msgs[i-1]=QString("%1:%2(%3%) ").arg(i).arg(nq[i]).arg(static_cast<double>(nq[i])/n*100.0,0,'f',1);
         }
     }
     ShowMsg(msg);
@@ -230,33 +247,34 @@
 void Plot::UpdatePlotType(void)
 {
     int i;
-
-    trace(3, "UpdatePlotType\n");
-
+    
+    trace(3,"UpdatePlotType\n");
+    
     PlotTypeS->blockSignals(true);
     PlotTypeS->clear();
-    if (SolData[0].n > 0 || SolData[1].n > 0 ||
-        (NObs <= 0 && SolStat[0].n <= 0 && SolStat[1].n <= 0)) {
-        PlotTypeS->addItem(PTypes[PLOT_TRK]);
+    if (SolData[0].n>0||SolData[1].n>0||
+        (NObs<=0&&SolStat[0].n<=0&&SolStat[1].n<=0)) {
+        PlotTypeS->addItem(PTypes[PLOT_TRK ]);
         PlotTypeS->addItem(PTypes[PLOT_SOLP]);
         PlotTypeS->addItem(PTypes[PLOT_SOLV]);
         PlotTypeS->addItem(PTypes[PLOT_SOLA]);
         PlotTypeS->addItem(PTypes[PLOT_NSAT]);
     }
-    if (NObs > 0) {
-        PlotTypeS->addItem(PTypes[PLOT_OBS]);
-        PlotTypeS->addItem(PTypes[PLOT_SKY]);
-        PlotTypeS->addItem(PTypes[PLOT_DOP]);
+    if (NObs>0) {
+        PlotTypeS->addItem(PTypes[PLOT_OBS ]);
+        PlotTypeS->addItem(PTypes[PLOT_SKY ]);
+        PlotTypeS->addItem(PTypes[PLOT_DOP ]);
     }
-    if (SolStat[0].n > 0 || SolStat[1].n > 0)
-        PlotTypeS->addItem(PTypes[PLOT_RES]);
-    if (NObs > 0) {
-        PlotTypeS->addItem(PTypes[PLOT_SNR]);
+    if (SolStat[0].n>0||SolStat[1].n>0) {
+        PlotTypeS->addItem(PTypes[PLOT_RES ]);
+    }
+    if (NObs>0) {
+        PlotTypeS->addItem(PTypes[PLOT_SNR ]);
         PlotTypeS->addItem(PTypes[PLOT_SNRE]);
-        PlotTypeS->addItem(PTypes[PLOT_MPS]);
+        PlotTypeS->addItem(PTypes[PLOT_MPS ]);
     }
-    for (i = 0; i < PlotTypeS->count(); i++) {
-        if (PlotTypeS->itemText(i) != PTypes[PlotType]) continue;
+    for (i=0;i<PlotTypeS->count();i++) {
+        if (PlotTypeS->itemText(i)!=PTypes[PlotType]) continue;
         PlotTypeS->setCurrentIndex(i);
         PlotTypeS->blockSignals(false);
         return;
@@ -268,38 +286,38 @@
 // update satellite-list pull-down menu -------------------------------------
 void Plot::UpdateSatList(void)
 {
-    int i, j, sys, sysp = 0, sat, smask[MAXSAT] = { 0 };
+    int i,j,sys,sysp=0,sat,smask[MAXSAT]={0};
     char s[8];
-
-    trace(3, "UpdateSatList\n");
-
-    for (i = 0; i < 2; i++) for (j = 0; j < SolStat[i].n; j++) {
-            sat = SolStat[i].data[j].sat;
-            if (1 <= sat && sat <= MAXSAT) smask[sat - 1] = 1;
-        }
-    for (j = 0; j < Obs.n; j++) {
-        sat = Obs.data[j].sat;
-        if (1 <= sat && sat <= MAXSAT) smask[sat - 1] = 1;
+    
+    trace(3,"UpdateSatList\n");
+    
+    for (i=0;i<2;i++) for (j=0;j<SolStat[i].n;j++) {
+        sat=SolStat[i].data[j].sat;
+        if (1<=sat&&sat<=MAXSAT) smask[sat-1]=1;
+    }
+    for (j=0;j<Obs.n;j++) {
+        sat=Obs.data[j].sat;
+        if (1<=sat&&sat<=MAXSAT) smask[sat-1]=1;
     }
     SatList->clear();
     SatList->addItem("ALL");
-
-    for (sat = 1; sat <= MAXSAT; sat++) {
-        if (SatMask[sat - 1] || !smask[sat - 1]) continue;
-        if ((sys = satsys(sat, NULL)) == sysp) continue;
-        switch ((sysp = sys)) {
-        case SYS_GPS: strcpy(s, "G"); break;
-        case SYS_GLO: strcpy(s, "R"); break;
-        case SYS_GAL: strcpy(s, "E"); break;
-        case SYS_QZS: strcpy(s, "J"); break;
-        case SYS_CMP: strcpy(s, "C"); break;
-        case SYS_SBS: strcpy(s, "S"); break;
+    
+    for (sat=1;sat<=MAXSAT;sat++) {
+        if (SatMask[sat-1]||!smask[sat-1]) continue;
+        if ((sys=satsys(sat,NULL))==sysp) continue;
+        switch ((sysp=sys)) {
+            case SYS_GPS: strcpy(s,"G"); break;
+            case SYS_GLO: strcpy(s,"R"); break;
+            case SYS_GAL: strcpy(s,"E"); break;
+            case SYS_QZS: strcpy(s,"J"); break;
+            case SYS_CMP: strcpy(s,"C"); break;
+            case SYS_SBS: strcpy(s,"S"); break;
         }
         SatList->addItem(s);
     }
-    for (sat = 1; sat <= MAXSAT; sat++) {
-        if (SatMask[sat - 1] || !smask[sat - 1]) continue;
-        satno2id(sat, s);
+    for (sat=1;sat<=MAXSAT;sat++) {
+        if (SatMask[sat-1]||!smask[sat-1]) continue;
+        satno2id(sat,s);
         SatList->addItem(s);
     }
     SatList->setCurrentIndex(0);
@@ -309,84 +327,91 @@
 // update observation type pull-down menu --------------------------------------
 void Plot::UpdateObsType(void)
 {
-    char *codes[MAXCODE + 1], freqs[] = "125678";
-    int i, j, n = 0, cmask[MAXCODE + 1] = { 0 }, fmask[6] = { 0 };
-
-    trace(3, "UpdateObsType\n");
-
-    for (i = 0; i < Obs.n; i++) for (j = 0; j < NFREQ + NEXOBS; j++)
-            cmask[Obs.data[i].code[j]] = 1;
-
-    for (unsigned char c = 1; c <= MAXCODE; c++) {
+    char *codes[MAXCODE+1],freqs[]="125678";
+    int i,j,n=0,cmask[MAXCODE+1]={0},fmask[6]={0};
+    
+    trace(3,"UpdateObsType\n");
+    
+    for (i=0;i<Obs.n;i++) for (j=0;j<NFREQ+NEXOBS;j++) {
+        cmask[Obs.data[i].code[j]]=1;
+    }
+    for (unsigned char c=1;c<=MAXCODE;c++) {
         if (!cmask[c]) continue;
-        codes[n++] = code2obs(c, &j);
-        fmask[j - 1] = 1;
+        codes[n++]=code2obs(c,&j);
+        fmask[j-1]=1;
     }
-    ObsType->clear();
+    ObsType ->clear();
     ObsType2->clear();
-    ObsType->addItem(tr("ALL"));
-
-    for (i = 0; i < 6; i++) {
+    ObsType ->addItem(tr("ALL"));
+    
+    for (i=0;i<6;i++) {
         if (!fmask[i]) continue;
-        ObsType->addItem(QString("L%1").arg(freqs[i]));
+        ObsType ->addItem(QString("L%1").arg(freqs[i]));
         ObsType2->addItem(QString("L%1").arg(freqs[i]));
     }
-    for (i = 0; i < n; i++) {
-        ObsType->addItem(QString("L%1").arg(codes[i]));
+    for (i=0;i<n;i++) {
+        ObsType ->addItem(QString("L%1").arg(codes[i]));
         ObsType2->addItem(QString("L%1").arg(codes[i]));
     }
-    ObsType->setCurrentIndex(0);
+    ObsType ->setCurrentIndex(0);
     ObsType2->setCurrentIndex(0);
 }
 // update information for current-cursor position ---------------------------
 void Plot::UpdatePoint(int x, int y)
 {
     gtime_t time;
-    QPoint p(x, y);
-    double enu[3] = { 0 }, rr[3], pos[3], xx, yy, r, xl[2], yl[2], q[2], az, el;
+    QPoint p(x,y);
+    double enu[3]={0},rr[3],pos[3],xx,yy,r,xl[2],yl[2],q[2],az,el;
     int i;
     QString tstr;
     QString msg;
+    
+    trace(4,"UpdatePoint: x=%d y=%d\n",x,y);
+    
+    if (PlotType==PLOT_TRK) { // track-plot
+        
+        GraphT->ToPos(p,enu[0],enu[1]);
 
-    trace(4, "UpdatePoint: x=%d y=%d\n", x, y);
-
-    if (PlotType == PLOT_TRK) { // track-plot
-        GraphT->ToPos(p, enu[0], enu[1]);
-
-        if (PointType == 1 || norm(OPos, 3) <= 0.0) {
-            msg = QString("E:%1 m N:%2 m").arg(enu[0], 0, 'f', 4).arg(enu[1], 0, 'f', 4);
-        } else if (PointType == 2) {
-            r = norm(enu, 2);
-            az = r <= 0.0 ? 0.0 : ATAN2(enu[0], enu[1]) * R2D;
-            if (az < 0.0) az += 360.0;
-            msg = QString("R:%1 m D:%2%3").arg(r, 0, 'f', 4).arg(az, 5, 'f', 5).arg(degreeChar);
-        } else {
-            ecef2pos(OPos, pos);
-            enu2ecef(pos, enu, rr);
-            for (i = 0; i < 3; i++) rr[i] += OPos[i];
-            ecef2pos(rr, pos);
-            msg = LatLonStr(pos, 8);
+        if (PointType==1||norm(OPos,3)<=0.0) {
+            msg=QString("E:%1 m N:%2 m").arg(enu[0],0,'f',3).arg(enu[1],0,'f',3);
         }
-    } else if (PlotType == PLOT_SKY || PlotType == PLOT_MPS) { // sky-plot
-        GraphS->GetLim(xl, yl);
-        GraphS->ToPos(p, q[0], q[1]);
-        r = (xl[1] - xl[0] < yl[1] - yl[0] ? xl[1] - xl[0] : yl[1] - yl[0]) * 0.45;
-
-        if ((el = 90.0 - 90.0 * norm(q, 2) / r) > 0.0) {
-            az = el >= 90.0 ? 0.0 : ATAN2(q[0], q[1]) * R2D;
-            if (az < 0.0) az += 360.0;
-            msg = QString("AZ=%1%2 EL=%3%4").arg(az, 5, 'f', 1).arg(degreeChar).arg(el, 4, 'f', 1).arg(degreeChar);
+        else if (PointType==2) {
+            r=norm(enu,2);
+            az=r<=0.0?0.0:ATAN2(enu[0],enu[1])*R2D;
+            if (az<0.0) az+=360.0;
+            msg=QString("R:%1 m D:%2%3").arg(r,0,'f',3).arg(az,5,'f',5).arg(degreeChar);
         }
-    } else if (PlotType == PLOT_SNRE) { // snr-el-plot
-        GraphE[0]->ToPos(p, q[0], q[1]);
-        msg = QString("EL=%1%2").arg(q[0], 4, 'f', 1).arg(degreeChar);
-    } else {
-        GraphG[0]->ToPos(p, xx, yy);
-        time = gpst2time(Week, xx);
-        if (TimeLabel == 2) time = utc2gpst(time);                              // UTC
-        else if (TimeLabel == 3) time = timeadd(gpst2utc(time), -9 * 3600.0);   // JST
-        TimeStr(time, 0, 1, tstr);
-        msg = tstr;
+        else {
+            ecef2pos(OPos,pos);
+            enu2ecef(pos,enu,rr);
+            for (i=0;i<3;i++) rr[i]+=OPos[i];
+            ecef2pos(rr,pos);
+            msg=LatLonStr(pos,8);
+        }
+    }
+    else if (PlotType==PLOT_SKY||PlotType==PLOT_MPS) { // sky-plot
+        
+        GraphS->GetLim(xl,yl);
+        GraphS->ToPos(p,q[0],q[1]);
+        r=(xl[1]-xl[0]<yl[1]-yl[0]?xl[1]-xl[0]:yl[1]-yl[0])*0.45;
+        
+        if ((el=90.0-90.0*norm(q,2)/r)>0.0) {
+            az=el>=90.0?0.0:ATAN2(q[0],q[1])*R2D;
+            if (az<0.0) az+=360.0;
+            msg=QString("AZ=%1%2 EL=%3%4").arg(az,5,'f',1).arg(degreeChar).arg(el,4,'f',1).arg(degreeChar);
+        }
+    }
+    else if (PlotType==PLOT_SNRE) { // snr-el-plot
+        GraphE[0]->ToPos(p,q[0],q[1]);
+        msg=QString("EL=%1%2").arg(q[0],4,'f',1).arg(degreeChar);
+    }
+    else {
+        GraphG[0]->ToPos(p,xx,yy);
+        time=gpst2time(Week,xx);
+        if      (TimeLabel==2) time=utc2gpst(time); // UTC
+        else if (TimeLabel==3) time=timeadd(gpst2utc(time),-9*3600.0); // JST
+        TimeStr(time,0,1,tstr);
+        msg=tstr;
     }
     Message2->setVisible(true);
     Message2->setText(msg);
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotmain.cpp RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotmain.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotmain.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotmain.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -15,8 +15,8 @@
 //                       tcpcli://addr[:port]
 //                       ntrip://[user[:passwd]@]addr[:port][/mntpnt]
 //                       file://path
-//           -p1 path  connect port 1 to path
-//           -p2 path  connect port 2 to path
+//           -p1 path  connect port 1 to path 
+//           -p2 path  connect port 2 to path 
 //           -x level  debug trace level (0:off)
 //           file      solution files or rinex obs/nav file
 //
@@ -28,7 +28,6 @@
 //           2010/06/19  1.4 rtklib 2.4.1 p1
 //           2012/11/21  1.5 rtklib 2.4.2
 //---------------------------------------------------------------------------
-#include <clocale>
 
 #include <QShowEvent>
 #include <QCloseEvent>
@@ -70,151 +69,145 @@
 #include "vmapdlg.h"
 #include "fileseldlg.h"
 
-#define YLIM_AGE    10.0        // ylimit of age of differential
-#define YLIM_RATIO  20.0        // ylimit of raito factor
+#define YLIM_AGE    10.0            // ylimit of age of differential
+#define YLIM_RATIO  20.0            // ylimit of raito factor
 
-static int RefreshTime = 100;    // update only every 100ms
+static int RefreshTime=10; // update only every 200ms
 
 extern QString color2String(const QColor &c);
 
-extern "C" {
-extern void settime(gtime_t) {}
-extern void settspan(gtime_t, gtime_t) {}
-}
-
 // instance of Plot --------------------------------------------------------
-Plot *plot = NULL;
+Plot *plot=NULL;
 
 // constructor --------------------------------------------------------------
 Plot::Plot(QWidget *parent) : QMainWindow(parent)
 {
     setupUi(this);
 
-    plot = this;
+    plot=this;
 
     setWindowIcon(QIcon(":/icons/rtk2.bmp"));
 
-    setlocale(LC_NUMERIC, "C"); // use point as decimal separator in formatted output
+    setlocale(LC_NUMERIC,"C"); // use point as decimal separator in formated output
 
-    gtime_t t0 = { 0, 0 };
+    gtime_t t0={0,0};
     nav_t nav0;
-    obs_t obs0 = { 0, 0, NULL };
+    obs_t obs0={0,0,NULL};
     sta_t sta0;
-    gis_t gis0 = {};
-    solstatbuf_t solstat0 = { 0, 0, 0 };
-    double ep[] = { 2000, 1, 1, 0, 0, 0 }, xl[2], yl[2];
-    double xs[] = { -DEFTSPAN / 2, DEFTSPAN / 2 };
-    int i, nfreq = NFREQ;
+    gis_t gis0={0};
+    solstatbuf_t solstat0={0,0,0};
+    double ep[]={2000,1,1,0,0,0},xl[2],yl[2];
+    double xs[]={-DEFTSPAN/2,DEFTSPAN/2};
+    int i,nfreq=NFREQ;
 
-    memset(&nav0, 0, sizeof(nav_t));
-    memset(&sta0, 0, sizeof(sta_t));
+    memset(&nav0,0,sizeof(nav_t));
+    memset(&sta0,0,sizeof(sta_t));
 
-    QString file = QApplication::applicationFilePath();
+    QString file=QApplication::applicationFilePath();
     QFileInfo fi(file);
-    IniFile = fi.absolutePath() + "/" + fi.baseName() + ".ini";
+    IniFile=fi.absolutePath()+"/"+fi.baseName()+".ini";
 
     toolBar->addWidget(Panel1);
 
-    FormWidth = FormHeight = 0;
-    Drag = 0; Xn = Yn = -1; NObs = 0;
-    IndexObs = NULL;
-    Az = NULL; El = NULL;
-    Week = Flush = PlotType = 0;
-    AnimCycle = 1;
-    for (i = 0; i < 2; i++) {
-        initsolbuf(SolData + i, 0, 0);
-        SolStat[i] = solstat0;
-        SolIndex[i] = 0;
+    FormWidth=FormHeight=0;
+    Drag=0; Xn=Yn=-1; NObs=0;
+    IndexObs=NULL;
+    Az=NULL;El=NULL;
+    Week=Flush=PlotType=0;
+    AnimCycle=1;
+    for (i=0;i<2;i++) {
+        initsolbuf(SolData+i,0,0);
+        SolStat[i]=solstat0;
+        SolIndex[i]=0;
     }
-    ObsIndex = 0;
-    Obs = obs0;
-    Nav = nav0;
-    Sta = sta0;
-    Gis = gis0;
-    SimObs = 0;
-
-    X0 = Y0 = Xc = Yc = Xs = Ys = Xcent = 0.0;
-    MouseDownTick = 0;
-    GEState = GEDataState[0] = GEDataState[1] = 0;
-    GEHeading = 0.0;
-    OEpoch = t0;
-    for (i = 0; i < 3; i++) OPos[i] = OVel[i] = 0.0;
-    Az = El = NULL;
-    for (i = 0; i < NFREQ + NEXOBS; i++) Mp[i] = NULL;
-
-    GraphT = new Graph(Disp);
-    GraphT->Fit = 0;
+    ObsIndex=0;
+    Obs=obs0;
+    Nav=nav0;
+    Sta=sta0;
+    Gis=gis0;
+    SimObs=0;
+    
+    X0=Y0=Xc=Yc=Xs=Ys=Xcent=0.0;
+    MouseDownTick=0;
+    GEState=GEDataState[0]=GEDataState[1]=0;
+    GEHeading=0.0;
+    OEpoch=t0;
+    for (i=0;i<3;i++) OPos[i]=OVel[i]=0.0;
+    Az=El=NULL;
+    for (i=0;i<NFREQ+NEXOBS;i++) Mp[i]=NULL;
 
-    for (i = 0; i < 3; i++) {
-        GraphG[i] = new Graph(Disp);
-        GraphG[i]->XLPos = 0;
-        GraphG[i]->GetLim(xl, yl);
-        GraphG[i]->SetLim(xs, yl);
+    GraphT =new Graph(Disp);
+    GraphT->Fit=0;
+    
+    for (i=0;i<3;i++) {
+        GraphG[i]=new Graph(Disp);
+        GraphG[i]->XLPos=0;
+        GraphG[i]->GetLim(xl,yl);
+        GraphG[i]->SetLim(xs,yl);
     }
-    GraphR = new Graph(Disp);
-    for (i = 0; i < 2; i++)
-        GraphE[i] = new Graph(Disp);
-    GraphS = new Graph(Disp);
-
-    GraphR->GetLim(xl, yl);
-    GraphR->SetLim(xs, yl);
-
-    MapSize[0] = MapSize[1] = 0;
-    MapScaleX = MapScaleY = 0.1;
-    MapScaleEq = 0;
-    MapLat = MapLon = 0.0;
-    PointType = 0;
-
-    NWayPnt = 0;
-    SelWayPnt = -1;
-
-    SkySize[0] = SkySize[1] = 0;
-    SkyCent[0] = SkyCent[1] = 0;
-    SkyScale = SkyScaleR = 240.0;
-    SkyFov[0] = SkyFov[1] = SkyFov[2] = 0.0;
-    SkyElMask = 1;
-    SkyDestCorr = SkyRes = SkyFlip = 0;
-
-    for (i = 0; i < 10; i++) SkyDest[i] = 0.0;
+    GraphR=new Graph(Disp);
+    for (i=0;i<2;i++) {
+        GraphE[i]=new Graph(Disp);
+    }
+    GraphS=new Graph(Disp);
 
-    SkyBinarize = 0;
-    SkyBinThres1 = 0.3;
-    SkyBinThres2 = 0.1;
+    GraphR->GetLim(xl,yl);
+    GraphR->SetLim(xs,yl);
+    
+    MapSize[0]=MapSize[1]=0;
+    MapScaleX=MapScaleY=0.1;
+    MapScaleEq=0;
+    MapLat=MapLon=0.0;
+    PointType=0;
 
-    for (i = 0; i < 3; i++) TimeEna[i] = 0;
-    TimeLabel = AutoScale = ShowStats = 0;
-    ShowLabel = ShowGLabel = 1;
-    ShowArrow = ShowSlip = ShowHalfC = ShowErr = ShowEph = 0;
-    PlotStyle = MarkSize = Origin = RcvPos = 0;
-    TimeInt = ElMask = YRange = 0.0;
-    MaxDop = 30.0;
-    MaxMP = 10.0;
-    TimeStart = TimeEnd = epoch2time(ep);
-    Console1 = new Console(this);
-    Console2 = new Console(this);
+    NWayPnt=0;
+    SelWayPnt=-1;
+    
+    SkySize[0]=SkySize[1]=0;
+    SkyCent[0]=SkyCent[1]=0;
+    SkyScale=SkyScaleR=240.0;
+    SkyFov[0]=SkyFov[1]=SkyFov[2]=0.0;
+    SkyElMask=1;
+    SkyDestCorr=SkyRes=SkyFlip=0;
+    for (i=0;i<10;i++) SkyDest[i]=0.0;
+    SkyBinarize=0;
+    SkyBinThres1=0.3;
+    SkyBinThres2=0.1;
+    
+    for (i=0;i<3;i++) TimeEna[i]=0;
+    TimeLabel=AutoScale=ShowStats=0;
+    ShowLabel=ShowGLabel=1;
+    ShowArrow=ShowSlip=ShowHalfC=ShowErr=ShowEph=0;
+    PlotStyle=MarkSize=Origin=RcvPos=0;
+    TimeInt=ElMask=YRange=0.0;
+    MaxDop=30.0;
+    MaxMP=10.0;
+    TimeStart=TimeEnd=epoch2time(ep);
+    Console1=new Console(this);
+    Console2=new Console(this);
     RangeList->setParent(0);
-    RangeList->setWindowFlags(Qt::Window | Qt::WindowStaysOnTopHint | Qt::X11BypassWindowManagerHint | Qt::FramelessWindowHint);
-
-    for (i = 0; i < 361; i++) ElMaskData[i] = 0.0;
-
-    Trace = 0;
-    ConnectState = OpenRaw = 0;
-    RtConnType = 0;
+    RangeList->setWindowFlags(Qt::Window|Qt::WindowStaysOnTopHint|Qt::X11BypassWindowManagerHint|Qt::FramelessWindowHint);
+    
+    for (i=0;i<361;i++) ElMaskData[i]=0.0;
+    
+    Trace=0;
+    ConnectState=OpenRaw=0;
+    RtConnType=0;
     strinitcom();
-    strinit(Stream);
-    strinit(Stream + 1);
-
+    strinit(Stream  );
+    strinit(Stream+1);
+    
     FrqType->clear();
     FrqType->addItem("L1/LC");
-    if (nfreq >= 2) FrqType->addItem("L2");
-    if (nfreq >= 3) FrqType->addItem("L5");
-    if (nfreq >= 4) FrqType->addItem("L6");
-    if (nfreq >= 5) FrqType->addItem("L7");
-    if (nfreq >= 6) FrqType->addItem("L8");
+    if (nfreq>=2) FrqType->addItem("L2");
+    if (nfreq>=3) FrqType->addItem("L5");
+    if (nfreq>=4) FrqType->addItem("L6");
+    if (nfreq>=5) FrqType->addItem("L7");
+    if (nfreq>=6) FrqType->addItem("L8");
     FrqType->setCurrentIndex(0);
-
-    TLEData.n = TLEData.nmax = 0;
-    TLEData.data = NULL;
+    
+    TLEData.n=TLEData.nmax=0;
+    TLEData.data=NULL;
 
     googleEarthView = new GoogleEarthView(this);
     googleMapView = new GoogleMapView(this);
@@ -226,7 +219,7 @@
     aboutDialog = new AboutDialog(this);
     pntDialog = new PntDialog(this);
     fileSelDialog = new FileSelDialog(this);
-    viewer = new TextViewer(this);
+    viewer=new TextViewer(this);
 
     BtnConnect->setDefaultAction(MenuConnect);
     BtnReload->setDefaultAction(MenuReload);
@@ -242,114 +235,90 @@
     BtnFixHoriz->setDefaultAction(MenuFixHoriz);
     BtnFixVert->setDefaultAction(MenuFixVert);
     BtnShowMap->setDefaultAction(MenuShowMap);
-    BtnShowGrid->setDefaultAction(MenuShowGrid);
     BtnShowImg->setDefaultAction(MenuShowImg);
     BtnShowSkyplot->setDefaultAction(MenuShowSkyplot);
     MenuShowSkyplot->setChecked(true);
-    MenuShowGrid->setChecked(true);
-
-    dirModel = new QFileSystemModel(this);
-    dirModel->setFilter(QDir::Dirs | QDir::NoDotAndDotDot);
-
-    DirSelector = new QTreeView(this);
-    Panel2->layout()->addWidget(DirSelector);
-    DirSelector->setModel(dirModel);
-    DirSelector->hideColumn(1); DirSelector->hideColumn(2); DirSelector->hideColumn(3); //only show names
-
-    fileModel = new QFileSystemModel(this);
-    fileModel->setFilter((fileModel->filter() & ~QDir::Dirs & ~QDir::AllDirs));
-    fileModel->setNameFilterDisables(false);
-    FileList->setModel(fileModel);
-
-
-    connect(BtnOn1, SIGNAL(clicked(bool)), this, SLOT(BtnOn1Click()));
-    connect(BtnOn2, SIGNAL(clicked(bool)), this, SLOT(BtnOn2Click()));
-    connect(BtnOn3, SIGNAL(clicked(bool)), this, SLOT(BtnOn3Click()));
-    connect(BtnSol1, SIGNAL(clicked(bool)), this, SLOT(BtnSol1Click()));//FIXME Double Click
-    connect(BtnSol2, SIGNAL(clicked(bool)), this, SLOT(BtnSol2Click()));
-    connect(BtnSol12, SIGNAL(clicked(bool)), this, SLOT(BtnSol12Click()));
-    connect(BtnRangeList, SIGNAL(clicked(bool)), this, SLOT(BtnRangeListClick()));
-    connect(BtnAnimate, SIGNAL(clicked(bool)), this, SLOT(BtnAnimateClick()));
-    connect(MenuAbout, SIGNAL(triggered(bool)), this, SLOT(MenuAboutClick()));
-    connect(MenuAnimStart, SIGNAL(triggered(bool)), this, SLOT(MenuAnimStartClick()));
-    connect(MenuAnimStop, SIGNAL(triggered(bool)), this, SLOT(MenuAnimStopClick()));
-    connect(MenuBrowse, SIGNAL(triggered(bool)), this, SLOT(MenuBrowseClick()));
-    connect(MenuCenterOri, SIGNAL(triggered(bool)), this, SLOT(MenuCenterOriClick()));
-    connect(MenuClear, SIGNAL(triggered(bool)), this, SLOT(MenuClearClick()));
-    connect(MenuConnect, SIGNAL(triggered(bool)), this, SLOT(MenuConnectClick()));
-    connect(MenuDisconnect, SIGNAL(triggered(bool)), this, SLOT(MenuDisconnectClick()));
-    connect(MenuFitHoriz, SIGNAL(triggered(bool)), this, SLOT(MenuFitHorizClick()));
-    connect(MenuFitVert, SIGNAL(triggered(bool)), this, SLOT(MenuFitVertClick()));
-    connect(MenuFixCent, SIGNAL(triggered(bool)), this, SLOT(MenuFixCentClick()));
-    connect(MenuFixHoriz, SIGNAL(triggered(bool)), this, SLOT(MenuFixHorizClick()));
-    connect(MenuFixVert, SIGNAL(triggered(bool)), this, SLOT(MenuFixVertClick()));
-    connect(MenuGE, SIGNAL(triggered(bool)), this, SLOT(MenuGEClick()));
-    connect(MenuGM, SIGNAL(triggered(bool)), this, SLOT(MenuGMClick()));
-    connect(MenuMapImg, SIGNAL(triggered(bool)), this, SLOT(MenuMapImgClick()));
-    connect(MenuMax, SIGNAL(triggered(bool)), this, SLOT(MenuMaxClick()));
-    connect(MenuMonitor1, SIGNAL(triggered(bool)), this, SLOT(MenuMonitor1Click()));
-    connect(MenuMonitor2, SIGNAL(triggered(bool)), this, SLOT(MenuMonitor2Click()));
-    connect(MenuOpenElevMask, SIGNAL(triggered(bool)), this, SLOT(MenuOpenElevMaskClick()));
-    connect(MenuOpenMapImage, SIGNAL(triggered(bool)), this, SLOT(MenuOpenMapImageClick()));
-    connect(MenuOpenShape, SIGNAL(triggered(bool)), this, SLOT(MenuOpenShapeClick()));
-    connect(MenuOpenNav, SIGNAL(triggered(bool)), this, SLOT(MenuOpenNavClick()));
-    connect(MenuOpenObs, SIGNAL(triggered(bool)), this, SLOT(MenuOpenObsClick()));
-    connect(MenuOpenSkyImage, SIGNAL(triggered(bool)), this, SLOT(MenuOpenSkyImageClick()));
-    connect(MenuOpenSol1, SIGNAL(triggered(bool)), this, SLOT(MenuOpenSol1Click()));
-    connect(MenuOpenSol2, SIGNAL(triggered(bool)), this, SLOT(MenuOpenSol2Click()));
-    connect(MenuOptions, SIGNAL(triggered(bool)), this, SLOT(MenuOptionsClick()));
-    connect(MenuPlotGE, SIGNAL(triggered(bool)), this, SLOT(MenuPlotGEClick()));
-    connect(MenuPlotGEGM, SIGNAL(triggered(bool)), this, SLOT(MenuPlotGEGMClick()));
-    connect(MenuPlotGM, SIGNAL(triggered(bool)), this, SLOT(MenuPlotGMClick()));
-    connect(MenuPort, SIGNAL(triggered(bool)), this, SLOT(MenuPortClick()));
-    connect(MenuQcObs, SIGNAL(triggered(bool)), this, SLOT(MenuQcObsClick()));
-    connect(MenuQuit, SIGNAL(triggered(bool)), this, SLOT(MenuQuitClick()));
-    connect(MenuReload, SIGNAL(triggered(bool)), this, SLOT(MenuReloadClick()));
-    connect(MenuSaveDop, SIGNAL(triggered(bool)), this, SLOT(MenuSaveDopClick()));
-    connect(MenuSaveElMask, SIGNAL(triggered(bool)), this, SLOT(MenuSaveElMaskClick()));
-    connect(MenuSaveImage, SIGNAL(triggered(bool)), this, SLOT(MenuSaveImageClick()));
-    connect(MenuSaveSnrMp, SIGNAL(triggered(bool)), this, SLOT(MenuSaveSnrMpClick()));
-    connect(MenuShowMap, SIGNAL(triggered(bool)), this, SLOT(MenuShowMapClick()));
-    connect(MenuShowImg, SIGNAL(triggered(bool)), this, SLOT(MenuShowImgClick()));
-    connect(MenuShowGrid, SIGNAL(triggered(bool)), this, SLOT(MenuShowGridClick()));
-    connect(MenuShowSkyplot, SIGNAL(triggered(bool)), this, SLOT(MenuShowSkyplotClick()));
-    connect(MenuShowTrack, SIGNAL(triggered(bool)), this, SLOT(MenuShowTrackClick()));
-    connect(MenuSkyImg, SIGNAL(triggered(bool)), this, SLOT(MenuSkyImgClick()));
-    connect(MenuSrcObs, SIGNAL(triggered(bool)), this, SLOT(MenuSrcObsClick()));
-    connect(MenuSrcSol, SIGNAL(triggered(bool)), this, SLOT(MenuSrcSolClick()));
-    connect(MenuStatusBar, SIGNAL(triggered(bool)), this, SLOT(MenuStatusBarClick()));
-    connect(MenuTime, SIGNAL(triggered(bool)), this, SLOT(MenuTimeClick()));
-    connect(MenuToolBar, SIGNAL(triggered(bool)), this, SLOT(MenuToolBarClick()));
-    connect(MenuVisAna, SIGNAL(triggered(bool)), this, SLOT(MenuVisAnaClick()));
-    connect(MenuWaypnt, SIGNAL(triggered(bool)), this, SLOT(MenuWaypointClick()));
-    connect(MenuMapLayer, SIGNAL(triggered(bool)), this, SLOT(MenuMapLayerClick()));
-    connect(MenuOpenWaypoint, SIGNAL(triggered(bool)), this, SLOT(MenuOpenWaypointClick()));
-    connect(MenuSaveWaypoint, SIGNAL(triggered(bool)), this, SLOT(MenuSaveWaypointClick()));
-    connect(BtnMessage2, SIGNAL(clicked(bool)), this, SLOT(BtnMessage2Click()));
-    connect(RangeList, SIGNAL(clicked(QModelIndex)), this, SLOT(RangeListClick()));
-    connect(&Timer, SIGNAL(timeout()), this, SLOT(TimerTimer()));
-    connect(PlotTypeS, SIGNAL(currentIndexChanged(int)), this, SLOT(PlotTypeSChange()));
-    connect(QFlag, SIGNAL(currentIndexChanged(int)), this, SLOT(QFlagChange()));
-    connect(TimeScroll, SIGNAL(valueChanged(int)), this, SLOT(TimeScrollChange()));
-    connect(SatList, SIGNAL(currentIndexChanged(int)), this, SLOT(SatListChange()));
-    connect(DopType, SIGNAL(currentIndexChanged(int)), this, SLOT(DopTypeChange()));
-    connect(ObsType, SIGNAL(currentIndexChanged(int)), this, SLOT(ObsTypeChange()));
-    connect(ObsType2, SIGNAL(currentIndexChanged(int)), this, SLOT(ObsTypeChange()));
-    connect(FrqType, SIGNAL(currentIndexChanged(int)), this, SLOT(ObsTypeChange()));
-    connect(DriveSel, SIGNAL(currentIndexChanged(QString)), this, SLOT(DriveSelChanged()));
-    connect(DirSelector, SIGNAL(clicked(QModelIndex)), this, SLOT(DirSelChange(QModelIndex)));
-    connect(DirSelector, SIGNAL(doubleClicked(QModelIndex)), this, SLOT(DirSelSelected(QModelIndex)));
-    connect(BtnDirSel, SIGNAL(clicked(bool)), this, SLOT(BtnDirSelClick()));
-    connect(FileList, SIGNAL(clicked(QModelIndex)), this, SLOT(FileListClick(QModelIndex)));
-    connect(Filter, SIGNAL(currentIndexChanged(QString)), this, SLOT(FilterClick()));
 
+    connect(BtnOn1,SIGNAL(clicked(bool)),this,SLOT(BtnOn1Click()));
+    connect(BtnOn2,SIGNAL(clicked(bool)),this,SLOT(BtnOn2Click()));
+    connect(BtnOn3,SIGNAL(clicked(bool)),this,SLOT(BtnOn3Click()));
+    connect(BtnSol1,SIGNAL(clicked(bool)),this,SLOT(BtnSol1Click()));//FIXME Double Click
+    connect(BtnSol2,SIGNAL(clicked(bool)),this,SLOT(BtnSol2Click()));
+    connect(BtnSol12,SIGNAL(clicked(bool)),this,SLOT(BtnSol12Click()));
+    connect(BtnRangeList,SIGNAL(clicked(bool)),this,SLOT(BtnRangeListClick()));
+    connect(BtnAnimate,SIGNAL(clicked(bool)),this,SLOT(BtnAnimateClick()));
+    connect(MenuAbout,SIGNAL(triggered(bool)),this,SLOT(MenuAboutClick()));
+    connect(MenuAnimStart,SIGNAL(triggered(bool)),this,SLOT(MenuAnimStartClick()));
+    connect(MenuAnimStop,SIGNAL(triggered(bool)),this,SLOT(MenuAnimStopClick()));
+    connect(MenuCenterOri,SIGNAL(triggered(bool)),this,SLOT(MenuCenterOriClick()));
+    connect(MenuClear,SIGNAL(triggered(bool)),this,SLOT(MenuClearClick()));
+    connect(MenuConnect,SIGNAL(triggered(bool)),this,SLOT(MenuConnectClick()));
+    connect(MenuDisconnect,SIGNAL(triggered(bool)),this,SLOT(MenuDisconnectClick()));
+    connect(MenuFileSel,SIGNAL(triggered(bool)),this,SLOT(MenuFileSelClick()));
+    connect(MenuFitHoriz,SIGNAL(triggered(bool)),this,SLOT(MenuFitHorizClick()));
+    connect(MenuFitVert,SIGNAL(triggered(bool)),this,SLOT(MenuFitVertClick()));
+    connect(MenuFixCent,SIGNAL(triggered(bool)),this,SLOT(MenuFixCentClick()));
+    connect(MenuFixHoriz,SIGNAL(triggered(bool)),this,SLOT(MenuFixHorizClick()));
+    connect(MenuFixVert,SIGNAL(triggered(bool)),this,SLOT(MenuFixVertClick()));
+    connect(MenuGE,SIGNAL(triggered(bool)),this,SLOT(MenuGEClick()));
+    connect(MenuGM,SIGNAL(triggered(bool)),this,SLOT(MenuGMClick()));
+    connect(MenuMapImg,SIGNAL(triggered(bool)),this,SLOT(MenuMapImgClick()));
+    connect(MenuMax,SIGNAL(triggered(bool)),this,SLOT(MenuMaxClick()));
+    connect(MenuMonitor1,SIGNAL(triggered(bool)),this,SLOT(MenuMonitor1Click()));
+    connect(MenuMonitor2,SIGNAL(triggered(bool)),this,SLOT(MenuMonitor2Click()));
+    connect(MenuOpenElevMask,SIGNAL(triggered(bool)),this,SLOT(MenuOpenElevMaskClick()));
+    connect(MenuOpenMapImage,SIGNAL(triggered(bool)),this,SLOT(MenuOpenMapImageClick()));
+    connect(MenuOpenShape,SIGNAL(triggered(bool)),this,SLOT(MenuOpenShapeClick()));
+    connect(MenuOpenNav,SIGNAL(triggered(bool)),this,SLOT(MenuOpenNavClick()));
+    connect(MenuOpenObs,SIGNAL(triggered(bool)),this,SLOT(MenuOpenObsClick()));
+    connect(MenuOpenSkyImage,SIGNAL(triggered(bool)),this,SLOT(MenuOpenSkyImageClick()));
+    connect(MenuOpenSol1,SIGNAL(triggered(bool)),this,SLOT(MenuOpenSol1Click()));
+    connect(MenuOpenSol2,SIGNAL(triggered(bool)),this,SLOT(MenuOpenSol2Click()));
+    connect(MenuOptions,SIGNAL(triggered(bool)),this,SLOT(MenuOptionsClick()));
+    connect(MenuPlotGE,SIGNAL(triggered(bool)),this,SLOT(MenuPlotGEClick()));
+    connect(MenuPlotGEGM,SIGNAL(triggered(bool)),this,SLOT(MenuPlotGEGMClick()));
+    connect(MenuPlotGM,SIGNAL(triggered(bool)),this,SLOT(MenuPlotGMClick()));
+    connect(MenuPort,SIGNAL(triggered(bool)),this,SLOT(MenuPortClick()));
+    connect(MenuQcObs,SIGNAL(triggered(bool)),this,SLOT(MenuQcObsClick()));
+    connect(MenuQuit,SIGNAL(triggered(bool)),this,SLOT(MenuQuitClick()));
+    connect(MenuReload,SIGNAL(triggered(bool)),this,SLOT(MenuReloadClick()));
+    connect(MenuSaveDop,SIGNAL(triggered(bool)),this,SLOT(MenuSaveDopClick()));
+    connect(MenuSaveElMask,SIGNAL(triggered(bool)),this,SLOT(MenuSaveElMaskClick()));
+    connect(MenuSaveImage,SIGNAL(triggered(bool)),this,SLOT(MenuSaveImageClick()));
+    connect(MenuSaveSnrMp,SIGNAL(triggered(bool)),this,SLOT(MenuSaveSnrMpClick()));
+    connect(MenuShowMap,SIGNAL(triggered(bool)),this,SLOT(MenuShowMapClick()));
+    connect(MenuShowImg,SIGNAL(triggered(bool)),this,SLOT(MenuShowImgClick()));
+    connect(MenuShowSkyplot,SIGNAL(triggered(bool)),this,SLOT(MenuShowSkyplotClick()));
+    connect(MenuShowTrack,SIGNAL(triggered(bool)),this,SLOT(MenuShowTrackClick()));
+    connect(MenuSkyImg,SIGNAL(triggered(bool)),this,SLOT(MenuSkyImgClick()));
+    connect(MenuSrcObs,SIGNAL(triggered(bool)),this,SLOT(MenuSrcObsClick()));
+    connect(MenuSrcSol,SIGNAL(triggered(bool)),this,SLOT(MenuSrcSolClick()));
+    connect(MenuStatusBar,SIGNAL(triggered(bool)),this,SLOT(MenuStatusBarClick()));
+    connect(MenuTime,SIGNAL(triggered(bool)),this,SLOT(MenuTimeClick()));
+    connect(MenuToolBar,SIGNAL(triggered(bool)),this,SLOT(MenuToolBarClick()));
+    connect(MenuVisAna,SIGNAL(triggered(bool)),this,SLOT(MenuVisAnaClick()));
+    connect(MenuWaypnt,SIGNAL(triggered(bool)),this,SLOT(MenuWaypointClick()));
+    connect(MenuMapLayer,SIGNAL(triggered(bool)),this,SLOT(MenuMapLayerClick()));
+    connect(MenuOpenWaypoint,SIGNAL(triggered(bool)),this,SLOT(MenuOpenWaypointClick()));
+    connect(MenuSaveWaypoint,SIGNAL(triggered(bool)),this,SLOT(MenuSaveWaypointClick()));
+    connect(BtnMessage2,SIGNAL(clicked(bool)),this,SLOT(BtnMessage2Click()));
+    connect(RangeList,SIGNAL(clicked(QModelIndex)),this,SLOT(RangeListClick()));
+    connect(&Timer,SIGNAL(timeout()),this,SLOT(TimerTimer()));
+    connect(PlotTypeS,SIGNAL(currentIndexChanged(int)),this,SLOT(PlotTypeSChange()));
+    connect(QFlag,SIGNAL(currentIndexChanged(int)),this,SLOT(QFlagChange()));
+    connect(TimeScroll,SIGNAL(valueChanged(int)),this,SLOT(TimeScrollChange()));
+    connect(SatList,SIGNAL(currentIndexChanged(int)),this,SLOT(SatListChange()));
+    connect(DopType,SIGNAL(currentIndexChanged(int)),this,SLOT(DopTypeChange()));
+    connect(ObsType,SIGNAL(currentIndexChanged(int)),this,SLOT(ObsTypeChange()));
+    connect(ObsType2,SIGNAL(currentIndexChanged(int)),this,SLOT(ObsTypeChange()));
+    connect(FrqType,SIGNAL(currentIndexChanged(int)),this,SLOT(ObsTypeChange()));
 
-    bool state = false;
+    bool state=false;
 #ifdef QWEBKIT
-    state = true;
+    state=true;
 #endif
 #ifdef QWEBENGINE
-    state = true;
+    state=true;
 #endif
     MenuGE->setEnabled(state);
     MenuGM->setEnabled(state);
@@ -357,13 +326,15 @@
     MenuPlotGEGM->setEnabled(state);
     MenuPlotGM->setEnabled(state);
 
+    Disp->setAttribute(Qt::WA_TransparentForMouseEvents);
     Disp->setAttribute(Qt::WA_OpaquePaintEvent);
+    widget->setAttribute(Qt::WA_TransparentForMouseEvents);
+    centralwidget->setAttribute(Qt::WA_TransparentForMouseEvents);
     setMouseTracking(true);
 
     LoadOpt();
 
     updateTime.start();
-    qApp->installEventFilter(this);
 }
 // destructor ---------------------------------------------------------------
 Plot::~Plot()
@@ -372,80 +343,60 @@
     delete [] Az;
     delete [] El;
 
-    for (int i = 0; i < NFREQ + NEXOBS; i++) delete Mp[i];
+    for (int i=0;i<NFREQ+NEXOBS;i++) delete Mp[i];
 
     delete GraphT;
     delete GraphR;
     delete GraphS;
-    for (int i = 0; i < 2; i++)
+    for (int i=0;i<2;i++) {
         delete GraphE[i];
-    for (int i = 0; i < 3; i++)
-        delete GraphG[i];
-    delete RangeList;
-
-    delete DirSelector;
-}
-// callback on all events ----------------------------------------------------
-bool Plot::eventFilter(QObject *obj, QEvent *event)
-{
-    if ((obj == Disp) && (event->type() == QEvent::MouseMove))
-    {
-        QMouseEvent *mouseEvent = static_cast<QMouseEvent*>(event);
-        if (childAt(mouseEvent->pos()) == Disp)
-            mouseMove(mouseEvent);
     }
-    if ((obj == Disp) && (event->type() == QEvent::Resize))
-    {
-        UpdateSize();
-        Refresh();
+    for (int i=0;i<3;i++) {
+         delete GraphG[i];
     }
-
-    return false;
+    delete RangeList;
 }
 // callback on form-show ----------------------------------------------------
-void Plot::showEvent(QShowEvent *event)
+void Plot::showEvent (QShowEvent *event)
 {
-    if (event->spontaneous()) {
-        Refresh();
-        return;
-    }
-    QString path1 = "", path2 = "";
-    char str_path[256];
+    if (event->spontaneous()) return;
+    QString path1="",path2="";
 
-    trace(3, "FormShow\n");
+    trace(3,"FormShow\n");
 
+#ifdef QT5
     QCommandLineParser parser;
     parser.setApplicationDescription("RTK plot");
     parser.addHelpOption();
     parser.addVersionOption();
 
-    QCommandLineOption rawOption(QStringList() << "r",
-                     QCoreApplication::translate("main", "open raw"));
+    QCommandLineOption rawOption(QStringList() << "r" ,
+            QCoreApplication::translate("main", "open raw"));
     parser.addOption(rawOption);
 
     QCommandLineOption titleOption(QStringList() << "t" << "title",
-                       QCoreApplication::translate("main", "use window tile <title>."),
-                       QCoreApplication::translate("main", "title"));
+            QCoreApplication::translate("main", "use window tile <title>."),
+            QCoreApplication::translate("main", "title"));
     parser.addOption(titleOption);
 
     QCommandLineOption pathOption(QStringList() << "p" << "path",
-                      QCoreApplication::translate("main", "open <path>."),
-                      QCoreApplication::translate("main", "path"));
+            QCoreApplication::translate("main", "open <path>."),
+            QCoreApplication::translate("main", "path"));
     parser.addOption(pathOption);
 
     QCommandLineOption path1Option(QStringList() << "1",
-                       QCoreApplication::translate("main", "open <path> as solution 1."),
-                       QCoreApplication::translate("main", "path"));
+            QCoreApplication::translate("main", "open <path> as solution 1."),
+            QCoreApplication::translate("main", "path"));
     parser.addOption(path1Option);
 
     QCommandLineOption path2Option(QStringList() << "2",
-                       QCoreApplication::translate("main", "open <path> as solution 2."),
-                       QCoreApplication::translate("main", "path"));
+            QCoreApplication::translate("main", "open <path> as solution 2."),
+            QCoreApplication::translate("main", "path"));
     parser.addOption(path2Option);
 
     QCommandLineOption traceOption(QStringList() << "t" << "tracelevel",
-                       QCoreApplication::translate("main", "set trace lavel to <tracelavel>."),
-                       QCoreApplication::translate("main", "tracelevel"));
+            QCoreApplication::translate("main", "set trace lavel to <tracelavel>."),
+            QCoreApplication::translate("main", "tracelevel"));
     parser.addOption(traceOption);
 
     parser.addPositionalArgument("file", QCoreApplication::translate("main", "Read files."));
@@ -453,103 +404,68 @@
     parser.process(*QApplication::instance());
 
     if (parser.isSet(rawOption))
-        OpenRaw = 1;
+        OpenRaw=1;
     if (parser.isSet(titleOption))
-        Title = parser.value(titleOption);
+        Title=parser.value(titleOption);
     if (parser.isSet(pathOption))
-        path1 = parser.value(pathOption);
+        path1=parser.value(pathOption);
     if (parser.isSet(path1Option))
-        path1 = parser.value(path1Option);
+        path1=parser.value(path1Option);
     if (parser.isSet(path2Option))
-        path2 = parser.value(path2Option);
+        path2=parser.value(path2Option);
     if (parser.isSet(traceOption))
-        Trace = parser.value(traceOption).toInt();
+        Trace=parser.value(traceOption).toInt();
 
     const QStringList args = parser.positionalArguments();
     QString file;
-    foreach(file, args)
-    OpenFiles.append(file);
-
-    UpdateType(PlotType >= PLOT_OBS ? PLOT_TRK : PlotType);
+    foreach(file,args)
+        OpenFiles.append(file);
+#endif /*TODO: alternative for QT4 */
 
+    UpdateType(PlotType>=PLOT_OBS?PLOT_TRK:PlotType);
+    
     UpdateColor();
     UpdateSatMask();
     UpdateOrigin();
     UpdateSize();
-
-    if (path1 != "" || path2 != "") {
-        ConnectPath(path1, 0);
-        ConnectPath(path2, 1);
+    
+    if (path1!=""||path2!="") {
+        ConnectPath(path1,0);
+        ConnectPath(path2,1);
         Connect();
-    } else if (OpenFiles.count() <= 0) {
-        setWindowTitle(Title != "" ? Title : QString(tr("%1 ver. %2 %3")).arg(PRGNAME).arg(VER_RTKLIB).arg(PATCH_LEVEL));
     }
-    if (Trace > 0) {
+    else if (OpenFiles.count()<=0) {
+        setWindowTitle(Title!=""?Title:QString(tr("%1 ver. %2 %3")).arg(PRGNAME).arg(VER_RTKLIB).arg(PATCH_LEVEL));
+    }
+    if (Trace>0) {
         traceopen(TRACEFILE);
         tracelevel(Trace);
     }
-    if (TLEFile != "")
-        tle_read(qPrintable(TLEFile), &TLEData);
-    if (TLESatFile != "")
-        tle_name_read(qPrintable(TLESatFile), &TLEData);
-
-    QFileInfoList drives = QDir::drives();
-    if (drives.size() > 1 && drives.at(0).filePath() != "/") {
-        Panel1->setVisible(true);
-        DriveSel->clear();
-
-        foreach(const QFileInfo &drive, drives) {
-            DriveSel->addItem(drive.filePath());
-        }
-    } else {
-        Panel1->setVisible(false); // do not show drive selection on unix
-    }
-    if (Dir == "") Dir = drives.at(0).filePath();
-
-    DriveSel->setCurrentText(Dir.mid(0, Dir.indexOf(":") + 2));
-    dirModel->setRootPath(Dir);
-    DirSelector->setVisible(false);
-    DirSelected->setText(Dir);
-    fileModel->setRootPath(Dir);
-    FileList->setRootIndex(fileModel->index(Dir));
-    FilterClick();
-
-    if (MenuBrowse->isChecked()) {
-        PanelBrowse->setVisible(true);
-    }
-    else {
-        PanelBrowse->setVisible(false);
+    if (TLEFile!="") {
+        tle_read(qPrintable(TLEFile),&TLEData);
     }
-
-    strinit(&StrTimeSync);
-    NStrBuff=0;
-
-    if (TimeSyncOut) {
-        sprintf(str_path,":%d",TimeSyncPort);
-        stropen(&StrTimeSync,STR_TCPSVR,STR_MODE_RW,str_path);
+    if (TLESatFile!="") {
+        tle_name_read(qPrintable(TLESatFile),&TLEData);
     }
-
     Timer.start(RefCycle);
     UpdatePlot();
     UpdateEnable();
 
-    if (OpenFiles.count() > 0) {
-        if (CheckObs(OpenFiles.at(0)) || OpenRaw) ReadObs(OpenFiles);
-        else ReadSol(OpenFiles, 0);
+    if (OpenFiles.count()>0) {
+        if (CheckObs(OpenFiles.at(0))||OpenRaw) ReadObs(OpenFiles);
+        else ReadSol(OpenFiles,0);
     }
-
-    googleMapView->setApiKey(ApiKey);
 }
 // callback on form-close ---------------------------------------------------
 void Plot::closeEvent(QCloseEvent *)
 {
-    trace(3, "FormClose\n");
-
+    trace(3,"FormClose\n");
+    
     RangeList->setVisible(false);
 
     SaveOpt();
-
-    if (Trace > 0) traceclose();
+    
+    if (Trace>0) traceclose();
 }
 
 // callback for painting   --------------------------------------------------
@@ -560,24 +476,22 @@
 // callback on form-resize --------------------------------------------------
 void Plot::resizeEvent(QResizeEvent *)
 {
-    trace(3, "FormResize\n");
-
+    trace(3,"FormResize\n");
+    
     // suppress repeated resize callback
-    if (FormWidth == width() && FormHeight == height()) return;
-
+    if (FormWidth==width()&&FormHeight==height()) return;
+    
     UpdateSize();
     Refresh();
-
-    FormWidth = width();
-    FormHeight = height();
+    
+    FormWidth =width();
+    FormHeight=height();
 }
 // callback on drag-and-drop files ------------------------------------------
 void Plot::dragEnterEvent(QDragEnterEvent *event)
 {
-    trace(3, "dragEnterEvent\n");
-
     if (event->mimeData()->hasFormat("text/uri-list"))
-        event->acceptProposedAction();
+            event->acceptProposedAction();
 }
 
 // callback on drag-and-drop files ------------------------------------------
@@ -585,331 +499,346 @@
 {
     QStringList files;
     int n;
-
-    trace(3, "dropEvent\n");
-
-    if (ConnectState || !event->mimeData()->hasUrls())
+    
+    trace(3,"DropFiles\n");
+    
+    if (ConnectState||!event->mimeData()->hasUrls()){
         return;
-    ;
-    foreach(QUrl url, event->mimeData()->urls()) {
-        files.append(QDir::toNativeSeparators(url.toString()));
+    };
+    foreach (QUrl url, event->mimeData()->urls()) {
+        files.append(url.toString());
     }
-
-    if (files.size() == 1 && (n = files.at(0).lastIndexOf('.')) != -1) {
-        QString ext = files.at(0).mid(n).toLower();
-        if ((ext == "jpg") || (ext == "jpeg")) {
-            if (PlotType == PLOT_TRK)
+    
+    if (files.size()==1&&(n=files.at(0).lastIndexOf('.'))!=-1) {
+        QString ext=files.at(0).mid(n).toLower();
+        if ((ext=="jpg")||(ext=="jpeg")){
+            if (PlotType==PLOT_TRK) {
                 ReadMapData(files.at(0));
-            else if (PlotType == PLOT_SKY || PlotType == PLOT_MPS)
+            }
+            else if (PlotType==PLOT_SKY||PlotType==PLOT_MPS) {
                 ReadSkyData(files.at(0));
-        }
-        ;
-    } else if (CheckObs(files.at(0))) {
+            }
+        };
+    }
+    else if (CheckObs(files.at(0))) {
         ReadObs(files);
-    } else if (!BtnSol1->isChecked() && BtnSol2->isChecked()) {
-        ReadSol(files, 1);
-    } else {
-        ReadSol(files, 0);
+    }
+    else if (!BtnSol1->isChecked()&&BtnSol2->isChecked()) {
+        ReadSol(files,1);
+    }
+    else {
+        ReadSol(files,0);
     }
 }
 // callback on menu-open-solution-1 -----------------------------------------
 void Plot::MenuOpenSol1Click()
 {
-    trace(3, "MenuOpenSol1Click\n");
-
-    ReadSol(QStringList(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Open Solution 1"), QString(), tr("Solution File (*.pos *.stat *.nmea *.txt *.ubx);;All (*.*)")))), 0);
+    trace(3,"MenuOpenSol1Click\n");
+    
+    ReadSol(QStringList(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Open Solution 1"),QString(),tr("Solution File (*.pos *.stat *.nmea *.txt *.ubx);;All (*.*)")))),0);
 }
 // callback on menu-open-solution-2 -----------------------------------------
 void Plot::MenuOpenSol2Click()
 {
-    trace(3, "MenuOpenSol2Click\n");
-
-    ReadSol(QStringList(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Open Solution 2"), QString(), tr("Solution File (*.pos *.stat *.nmea *.txt *.ubx);;All (*.*)")))), 1);
+    trace(3,"MenuOpenSol2Click\n");
+    
+    ReadSol(QStringList(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Open Solution 2"),QString(),tr("Solution File (*.pos *.stat *.nmea *.txt *.ubx);;All (*.*)")))),1);
 }
 // callback on menu-open-map-image ------------------------------------------
 void Plot::MenuOpenMapImageClick()
 {
-    trace(3, "MenuOpenMapImage\n");
-
-    ReadMapData(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Open Map Image"), MapImageFile, tr("JPEG File (*.jpg *.jpeg);;All (*.*)"))));
+    trace(3,"MenuOpenMapImage\n");
+    
+    ReadMapData(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Open Map Image"),MapImageFile,tr("JPEG File (*.jpg *.jpeg);;All (*.*)"))));
 }
 // callback on menu-open-track-points ---------------------------------------
 void Plot::MenuOpenShapeClick()
 {
-    trace(3, "MenuOpenShapePath\n");
-
-    QStringList files = QFileDialog::getOpenFileNames(this, tr("Open Shape File"), QString(), tr("Shape File (*.shp);;All (*.*)"));
-    for (int i = 0; i < files.size(); i++)
-        files[i] = QDir::toNativeSeparators(files.at(i));
+    trace(3,"MenuOpenShapePath\n");
+    
+    QStringList files=QFileDialog::getOpenFileNames(this,tr("Open Shape File"),QString(),tr("Shape File (*.shp);;All (*.*)"));
+    for (int i=0;i<files.size();i++)
+        files[i]=QDir::toNativeSeparators(files.at(i));
 
     ReadShapeFile(files);
 }
 // callback on menu-open-sky-image ------------------------------------------
 void Plot::MenuOpenSkyImageClick()
 {
-    trace(3, "MenuOpenSkyImage\n");
-
-    ReadSkyData(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Open Sky Image"), SkyImageFile, tr("JPEG File (*.jpg *.jpeg);;All (*.*)"))));
+    trace(3,"MenuOpenSkyImage\n");
+    
+    ReadSkyData(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Open Sky Image"),SkyImageFile,tr("JPEG File (*.jpg *.jpeg);;All (*.*)"))));
 }
 // callback on menu-oepn-waypoint -------------------------------------------
 void Plot::MenuOpenWaypointClick()
 {
-    trace(3, "MenuOpenWaypointClick\n");
+    trace(3,"MenuOpenWaypointClick\n");
 
-    ReadWaypoint(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Open Waypoint"), SkyImageFile, tr("GPX File (*.gpx);;All (*.*)"))));
+    ReadWaypoint(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Open Waypoint"),SkyImageFile,tr("GPX File (*.gpx);;All (*.*)"))));
 }
 // callback on menu-open-obs-data -------------------------------------------
 void Plot::MenuOpenObsClick()
 {
-    trace(3, "MenuOpenObsClick\n");
-
-    ReadObs(QFileDialog::getOpenFileNames(this, tr("Open Obs/Nav Data"), QString(), tr("RINEX OBS (*.obs *.*o *.*d *.*o.gz *.*o.Z *.d.gz *.d.Z);;All (*.*)")));
+    trace(3,"MenuOpenObsClick\n");
+    
+    ReadObs(QFileDialog::getOpenFileNames(this,tr("Open Obs/Nav Data"),QString(),tr("RINEX OBS (*.obs *.*o *.*d *.*o.gz *.*o.Z *.d.gz *.d.Z);;All (*.*)")));
 }
 // callback on menu-open-nav-data -------------------------------------------
 void Plot::MenuOpenNavClick()
 {
-    trace(3, "MenuOpenNavClick\n");
-
-    ReadNav(QFileDialog::getOpenFileNames(this, tr("Open Raw Obs/Nav Messages"), QString(), tr("RINEX NAV (*.nav *.gnav *.hnav *.qnav *.*n *.*g *.*h *.*q *.*p);;All (*.*)")));
+    trace(3,"MenuOpenNavClick\n");
+    
+    ReadNav(QFileDialog::getOpenFileNames(this,tr("Open Raw Obs/Nav Messages"),QString(),tr("RINEX NAV (*.nav *.gnav *.hnav *.qnav *.*n *.*g *.*h *.*q *.*p);;All (*.*)")));
 }
 // callback on menu-open-elev-mask ------------------------------------------
 void Plot::MenuOpenElevMaskClick()
 {
-    trace(3, "MenuOpenElevMaskClick\n");
-
-    ReadElMaskData(QDir::toNativeSeparators(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Opene Elevation Mask"), QString(), tr("Text File (*.txt);;All (*.*)")))));
+    trace(3,"MenuOpenElevMaskClick\n");
+    
+    ReadElMaskData(QDir::toNativeSeparators(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Opene Elevation Mask"),QString(),tr("Text File (*.txt);;All (*.*)")))));
 }
 // callback on menu-vis-analysis --------------------------------------------
 void Plot::MenuVisAnaClick()
 {
-    if (RcvPos != 1) { // lat/lon/height
+    if (RcvPos!=1) { // lat/lon/height
         ShowMsg(tr("specify Receiver Position as Lat/Lon/Hgt"));
         return;
     }
-    if (spanDialog->TimeStart.time == 0) {
+    if (spanDialog->TimeStart.time==0) {
         int week;
-        double tow = time2gpst(utc2gpst(timeget()), &week);
-        spanDialog->TimeStart = gpst2time(week, floor(tow / 3600.0) * 3600.0);
-        spanDialog->TimeEnd = timeadd(spanDialog->TimeStart, 86400.0);
-        spanDialog->TimeInt = 30.0;
+        double tow=time2gpst(utc2gpst(timeget()),&week);
+        spanDialog->TimeStart=gpst2time(week,floor(tow/3600.0)*3600.0);
+        spanDialog->TimeEnd=timeadd(spanDialog->TimeStart,86400.0);
+        spanDialog->TimeInt=30.0;
     }
-    spanDialog->TimeEna[0] = spanDialog->TimeEna[1] = spanDialog->TimeEna[2] = 1;
-    spanDialog->TimeVal[0] = spanDialog->TimeVal[1] = spanDialog->TimeVal[2] = 2;
-
+    spanDialog->TimeEna[0]=spanDialog->TimeEna[1]=spanDialog->TimeEna[2]=1;
+    spanDialog->TimeVal[0]=spanDialog->TimeVal[1]=spanDialog->TimeVal[2]=2;
+    
     spanDialog->exec();
 
-    if (spanDialog->result() == QDialog::Accepted) {
-        TimeStart = spanDialog->TimeStart;
-        TimeEnd = spanDialog->TimeEnd;
-        TimeInt = spanDialog->TimeInt;
+    if (spanDialog->result()==QDialog::Accepted) {
+        TimeStart=spanDialog->TimeStart;
+        TimeEnd=spanDialog->TimeEnd;
+        TimeInt=spanDialog->TimeInt;
         GenVisData();
     }
-    spanDialog->TimeVal[0] = spanDialog->TimeVal[1] = spanDialog->TimeVal[2] = 1;
+    spanDialog->TimeVal[0]=spanDialog->TimeVal[1]=spanDialog->TimeVal[2]=1;
+}
+// callback on menu-sol-browse ----------------------------------------------
+void Plot::MenuFileSelClick()
+{
+    trace(3,"MenuFileSelClick\n");
+    
+    fileSelDialog->show();
 }
 // callback on menu-save image ----------------------------------------------
 void Plot::MenuSaveImageClick()
 {
-    Buff.save(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, tr("Save Image"), QString(), tr("JPEG  (*.jpg);;Windows Bitmap (*.bmp)"))));
+    Buff.save(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this,tr("Save Image"),QString(),tr("JPEG  (*.jpg);;Windows Bitmap (*.bmp)"))));
 }
 // callback on menu-save-waypoint -------------------------------------------
 void Plot::MenuSaveWaypointClick()
 {
-    trace(3, "MenuSaveWaypointClick\n");
+    trace(3,"MenuSaveWaypointClick\n");
 
-    SaveWaypoint(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, tr("Save Waypoint"), QString(), tr("GPX File (*.gpx);;All (*.*)"))));
+    SaveWaypoint(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this,tr("Save Waypoint"),QString(),tr("GPX File (*.gpx);;All (*.*)"))));
 }
 // callback on menu-save-# of sats/dop --------------------------------------
 void Plot::MenuSaveDopClick()
 {
-    trace(3, "MenuSaveDopClick\n");
-
-    SaveDop(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, tr("Save Data"), QString(), tr("All (*.*);;Text File (*.txt)"))));
+    trace(3,"MenuSaveDopClick\n");
+    
+    SaveDop(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this,tr("Save Data"),QString(),tr("All (*.*);;Text File (*.txt)"))));
 }
 // callback on menu-save-snr,azel -------------------------------------------
 void Plot::MenuSaveSnrMpClick()
 {
-    trace(3, "MenuSaveSnrMpClick\n");
-
-    SaveSnrMp(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, tr("Save Data"), QString(), tr("All (*.*);;Text File (*.txt)"))));
+    trace(3,"MenuSaveSnrMpClick\n");
+    
+    SaveSnrMp(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this,tr("Save Data"),QString(),tr("All (*.*);;Text File (*.txt)"))));
 }
 // callback on menu-save-elmask ---------------------------------------------
 void Plot::MenuSaveElMaskClick()
 {
-    trace(3, "MenuSaveElMaskClick\n");
-
-    SaveElMask(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, tr("Save Data"), QString(), tr("All (*.*);;Text File (*.txt)"))));
+    trace(3,"MenuSaveElMaskClick\n");
+    
+    SaveElMask(QDir::toNativeSeparators(QFileDialog::getSaveFileName(this,tr("Save Data"),QString(),tr("All (*.*);;Text File (*.txt)"))));
 }
 // callback on menu-connect -------------------------------------------------
 void Plot::MenuConnectClick()
 {
-    trace(3, "MenuConnectClick\n");
-
+    trace(3,"MenuConnectClick\n");
+    
     Connect();
 }
 // callback on menu-disconnect ----------------------------------------------
 void Plot::MenuDisconnectClick()
 {
-    trace(3, "MenuDisconnectClick\n");
-
+    trace(3,"MenuDisconnectClick\n");
+    
     Disconnect();
 }
 // callback on menu-connection-settings -------------------------------------
 void Plot::MenuPortClick()
 {
     int i;
-
-    trace(3, "MenuPortClick\n");
-
-    connectDialog->Stream1 = RtStream[0];
-    connectDialog->Stream2 = RtStream[1];
-    connectDialog->Format1 = RtFormat[0];
-    connectDialog->Format2 = RtFormat[1];
-    connectDialog->TimeForm = RtTimeForm;
-    connectDialog->DegForm = RtDegForm;
-    connectDialog->FieldSep = RtFieldSep;
-    connectDialog->TimeOutTime = RtTimeOutTime;
-    connectDialog->ReConnTime = RtReConnTime;
-    for (i = 0; i < 3; i++) {
-        connectDialog->Paths1[i] = StrPaths[0][i];
-        connectDialog->Paths2[i] = StrPaths[1][i];
+    
+    trace(3,"MenuPortClick\n");
+    
+    connectDialog->Stream1 =RtStream[0];
+    connectDialog->Stream2 =RtStream[1];
+    connectDialog->Format1 =RtFormat[0];
+    connectDialog->Format2 =RtFormat[1];
+    connectDialog->TimeForm=RtTimeForm;
+    connectDialog->DegForm =RtDegForm;
+    connectDialog->FieldSep=RtFieldSep;
+    connectDialog->TimeOutTime=RtTimeOutTime;
+    connectDialog->ReConnTime =RtReConnTime;
+    for (i=0;i< 3;i++) {
+        connectDialog->Paths1[i]=StrPaths[0][i];
+        connectDialog->Paths2[i]=StrPaths[1][i];
     }
-    for (i = 0; i < 2; i++) {
-        connectDialog->Cmds1  [i] = StrCmds[0][i];
-        connectDialog->Cmds2  [i] = StrCmds[1][i];
-        connectDialog->CmdEna1[i] = StrCmdEna[0][i];
-        connectDialog->CmdEna2[i] = StrCmdEna[1][i];
+    for (i=0;i< 2;i++) {
+        connectDialog->Cmds1  [i]=StrCmds[0][i];
+        connectDialog->Cmds2  [i]=StrCmds[1][i];
+        connectDialog->CmdEna1[i]=StrCmdEna[0][i];
+        connectDialog->CmdEna2[i]=StrCmdEna[1][i];
     }
-    for (i = 0; i < 10; i++) connectDialog->TcpHistory [i] = StrHistory [i];
-    for (i = 0; i < 10; i++) connectDialog->TcpMntpHist[i] = StrMntpHist[i];
-
+    for (i=0;i<10;i++) connectDialog->TcpHistory [i]=StrHistory [i];
+    for (i=0;i<10;i++) connectDialog->TcpMntpHist[i]=StrMntpHist[i];
+    
     connectDialog->exec();
 
-    if (connectDialog->result() != QDialog::Accepted) return;
-
-    RtStream[0] = connectDialog->Stream1;
-    RtStream[1] = connectDialog->Stream2;
-    RtFormat[0] = connectDialog->Format1;
-    RtFormat[1] = connectDialog->Format2;
-    RtTimeForm = connectDialog->TimeForm;
-    RtDegForm = connectDialog->DegForm;
-    RtFieldSep = connectDialog->FieldSep;
-    RtTimeOutTime = connectDialog->TimeOutTime;
-    RtReConnTime = connectDialog->ReConnTime;
-    for (i = 0; i < 3; i++) {
-        StrPaths[0][i] = connectDialog->Paths1[i];
-        StrPaths[1][i] = connectDialog->Paths2[i];
+    if (connectDialog->result()!=QDialog::Accepted) return;
+    
+    RtStream[0]=connectDialog->Stream1;
+    RtStream[1]=connectDialog->Stream2;
+    RtFormat[0]=connectDialog->Format1;
+    RtFormat[1]=connectDialog->Format2;
+    RtTimeForm=connectDialog->TimeForm;
+    RtDegForm =connectDialog->DegForm;
+    RtFieldSep=connectDialog->FieldSep;
+    RtTimeOutTime=connectDialog->TimeOutTime;
+    RtReConnTime =connectDialog->ReConnTime;
+    for (i=0;i< 3;i++) {
+        StrPaths[0][i]=connectDialog->Paths1[i];
+        StrPaths[1][i]=connectDialog->Paths2[i];
     }
-    for (i = 0; i < 2; i++) {
-        StrCmds  [0][i] = connectDialog->Cmds1  [i];
-        StrCmds  [1][i] = connectDialog->Cmds2  [i];
-        StrCmdEna[0][i] = connectDialog->CmdEna1[i];
-        StrCmdEna[1][i] = connectDialog->CmdEna2[i];
+    for (i=0;i< 2;i++) {
+        StrCmds  [0][i]=connectDialog->Cmds1  [i];
+        StrCmds  [1][i]=connectDialog->Cmds2  [i];
+        StrCmdEna[0][i]=connectDialog->CmdEna1[i];
+        StrCmdEna[1][i]=connectDialog->CmdEna2[i];
     }
-    for (i = 0; i < 10; i++) StrHistory [i] = connectDialog->TcpHistory [i];
-    for (i = 0; i < 10; i++) StrMntpHist[i] = connectDialog->TcpMntpHist[i];
+    for (i=0;i<10;i++) StrHistory [i]=connectDialog->TcpHistory [i];
+    for (i=0;i<10;i++) StrMntpHist[i]=connectDialog->TcpMntpHist[i];
 }
 // callback on menu-reload --------------------------------------------------
 void Plot::MenuReloadClick()
 {
-    trace(3, "MenuReloadClick\n");
-
+    trace(3,"MenuReloadClick\n");
+    
     Reload();
 }
 // callback on menu-clear ---------------------------------------------------
 void Plot::MenuClearClick()
 {
-    trace(3, "MenuClearClick\n");
-
+    trace(3,"MenuClearClick\n");
+    
     Clear();
 }
 // callback on menu-exit-----------------------------------------------------
 void Plot::MenuQuitClick()
 {
-    trace(3, "MenuQuitClick\n");
-
+    trace(3,"MenuQuitClick\n");
+    
     close();
 }
 // callback on menu-time-span/interval --------------------------------------
 void Plot::MenuTimeClick()
 {
-    sol_t *sols, *sole;
+    sol_t *sols,*sole;
     int i;
-
-    trace(3, "MenuTimeClick\n");
-
+    
+    trace(3,"MenuTimeClick\n");
+    
     if (!TimeEna[0]) {
-        if (Obs.n > 0) {
-            TimeStart = Obs.data[0].time;
-        } else if (BtnSol2->isChecked() && SolData[1].n > 0) {
-            sols = getsol(SolData + 1, 0);
-            TimeStart = sols->time;
-        } else if (SolData[0].n > 0) {
-            sols = getsol(SolData, 0);
-            TimeStart = sols->time;
+        if (Obs.n>0) {
+            TimeStart=Obs.data[0].time;
+        }
+        else if (BtnSol2->isChecked()&&SolData[1].n>0) {
+            sols=getsol(SolData+1,0);
+            TimeStart=sols->time;
+        }
+        else if (SolData[0].n>0) {
+            sols=getsol(SolData,0);
+            TimeStart=sols->time;
         }
     }
     if (!TimeEna[1]) {
-        if (Obs.n > 0) {
-            TimeEnd = Obs.data[Obs.n - 1].time;
-        } else if (BtnSol2->isChecked() && SolData[1].n > 0) {
-            sole = getsol(SolData + 1, SolData[1].n - 1);
-            TimeEnd = sole->time;
-        } else if (SolData[0].n > 0) {
-            sole = getsol(SolData, SolData[0].n - 1);
-            TimeEnd = sole->time;
+        if (Obs.n>0) {
+            TimeEnd=Obs.data[Obs.n-1].time;
+        }
+        else if (BtnSol2->isChecked()&&SolData[1].n>0) {
+            sole=getsol(SolData+1,SolData[1].n-1);
+            TimeEnd=sole->time;
+        }
+        else if (SolData[0].n>0) {
+            sole=getsol(SolData,SolData[0].n-1);
+            TimeEnd=sole->time;
         }
     }
-    for (i = 0; i < 3; i++)
-        spanDialog->TimeEna[i] = TimeEna[i];
-
-    spanDialog->TimeStart = TimeStart;
-    spanDialog->TimeEnd = TimeEnd;
-    spanDialog->TimeInt = TimeInt;
-    spanDialog->TimeVal[0] = !ConnectState;
-    spanDialog->TimeVal[1] = !ConnectState;
-
+    for (i=0;i<3;i++) {
+        spanDialog->TimeEna[i]=TimeEna[i];
+    }
+    spanDialog->TimeStart=TimeStart;
+    spanDialog->TimeEnd  =TimeEnd;
+    spanDialog->TimeInt  =TimeInt;
+    spanDialog->TimeVal[0]=!ConnectState;
+    spanDialog->TimeVal[1]=!ConnectState;
+    
     spanDialog->exec();
 
-    if (spanDialog->result() != QDialog::Accepted) return;
-
-    if (TimeEna[0] != spanDialog->TimeEna[0] ||
-        TimeEna[1] != spanDialog->TimeEna[1] ||
-        TimeEna[2] != spanDialog->TimeEna[2] ||
-        timediff(TimeStart, spanDialog->TimeStart) != 0.0 ||
-        timediff(TimeEnd, spanDialog->TimeEnd) != 0.0 ||
-        !qFuzzyCompare(TimeInt, spanDialog->TimeInt)) {
-        for (i = 0; i < 3; i++) TimeEna[i] = spanDialog->TimeEna[i];
-
-        TimeStart = spanDialog->TimeStart;
-        TimeEnd = spanDialog->TimeEnd;
-        TimeInt = spanDialog->TimeInt;
-
+    if (spanDialog->result()!=QDialog::Accepted) return;
+    
+    if (TimeEna[0]!=spanDialog->TimeEna[0]||
+        TimeEna[1]!=spanDialog->TimeEna[1]||
+        TimeEna[2]!=spanDialog->TimeEna[2]||
+        timediff(TimeStart,spanDialog->TimeStart)!=0.0||
+        timediff(TimeEnd,spanDialog->TimeEnd)!=0.0||
+        !qFuzzyCompare(TimeInt,spanDialog->TimeInt)) {
+        
+        for (i=0;i<3;i++) TimeEna[i]=spanDialog->TimeEna[i];
+        
+        TimeStart=spanDialog->TimeStart;
+        TimeEnd  =spanDialog->TimeEnd;
+        TimeInt  =spanDialog->TimeInt;
+        
         Reload();
     }
 }
 // callback on menu-map-image -----------------------------------------------
 void Plot::MenuMapImgClick()
 {
-    trace(3, "MenuMapImgClick\n");
-
+    trace(3,"MenuMapImgClick\n");
+    
     mapAreaDialog->show();
 }
 // callback on menu-sky image -----------------------------------------------
 void Plot::MenuSkyImgClick()
 {
-    trace(3, "MenuSkyImgClick\n");
-
+    trace(3,"MenuSkyImgClick\n");
+    
     skyImgDialog->show();
 }
 // callback on menu-vec map -------------------------------------------------
 void Plot::MenuMapLayerClick()
 {
-    trace(3, "MenuMapLayerClick\n");
-
-    vecMapDialog = new VecMapDialog(this);
+    trace(3,"MenuMapLayerClick\n");
 
+    vecMapDialog= new VecMapDialog(this);
     vecMapDialog->exec();
-    if (vecMapDialog->result() != QDialog::Accepted) return;
+    if (vecMapDialog->result()!=QDialog::Accepted) return;
 
     delete vecMapDialog;
 
@@ -919,14 +848,13 @@
 // callback on menu-solution-source -----------------------------------------
 void Plot::MenuSrcSolClick()
 {
-    int sel = !BtnSol1->isChecked() && BtnSol2->isChecked();
-
-    trace(3, "MenuSrcSolClick\n");
-
-    if (SolFiles[sel].count() <= 0) return;
-
+    int sel=!BtnSol1->isChecked()&&BtnSol2->isChecked();
+    
+    trace(3,"MenuSrcSolClick\n");
+    
+    if (SolFiles[sel].count()<=0) return;
     viewer->setWindowTitle(SolFiles[sel].at(0));
-    viewer->Option = 0;
+    viewer->Option=0;
     viewer->show();
     viewer->Read(SolFiles[sel].at(0));
 }
@@ -934,54 +862,53 @@
 void Plot::MenuSrcObsClick()
 {
     TextViewer *viewer;
-    char file[1024], tmpfile[1024];
+    char file[1024],tmpfile[1024];
     int cstat;
-
-    trace(3, "MenuSrcObsClick\n");
-
-    if (ObsFiles.count() <= 0) return;
-
-    strcpy(file, qPrintable(ObsFiles.at(0)));
-    cstat = rtk_uncompress(file, tmpfile);
-
-    viewer = new TextViewer(this);
+    
+    trace(3,"MenuSrcObsClick\n");
+    
+    if (ObsFiles.count()<=0) return;
+    
+    strcpy(file,qPrintable(ObsFiles.at(0)));
+    cstat=rtk_uncompress(file,tmpfile);
+    viewer=new TextViewer(this);
     viewer->setWindowTitle(ObsFiles.at(0));
-    viewer->Option = 0;
+    viewer->Option=0;
     viewer->show();
-    viewer->Read(!cstat ? file : tmpfile);
+    viewer->Read(!cstat?file:tmpfile);
     if (cstat) remove(tmpfile);
 }
 // callback on menu-data-qc -------------------------------------------------
 void Plot::MenuQcObsClick()
 {
     TextViewer *viewer;
-    QString cmd = QcCmd, cmdexec, tmpfile = QCTMPFILE, errfile = QCERRFILE;
-    int i, stat;
-
-    trace(3, "MenuQcObsClick\n");
-
-    if (ObsFiles.count() <= 0 || cmd == "") return;
-
-    for (i = 0; i < ObsFiles.count(); i++) cmd += " \"" + ObsFiles.at(i) + "\"";
-    for (i = 0; i < NavFiles.count(); i++) cmd += " \"" + NavFiles.at(i) + "\"";
-
-    cmdexec = cmd + " > " + tmpfile;
-    cmdexec += " 2> " + errfile;
-    stat = execcmd(qPrintable(cmdexec));
-
-    viewer = new TextViewer(this);
-    viewer->Option = 0;
+    QString cmd=QcCmd,cmdexec,tmpfile=QCTMPFILE,errfile=QCERRFILE;
+    int i,stat;
+    
+    trace(3,"MenuQcObsClick\n");
+    
+    if (ObsFiles.count()<=0||cmd=="") return;
+    
+    for (i=0;i<ObsFiles.count();i++) cmd+=" \""+ObsFiles.at(i)+"\"";
+    for (i=0;i<NavFiles.count();i++) cmd+=" \""+NavFiles.at(i)+"\"";
+    
+    cmdexec=cmd+" > "+tmpfile;
+    cmdexec+=" 2> "+errfile;
+    stat=execcmd(qPrintable(cmdexec));
+    
+    viewer=new TextViewer(this);
+    viewer->Option=0;
     viewer->show();
-    viewer->Read(stat ? errfile : tmpfile);
-    viewer->setWindowTitle((stat ? "QC Error: " : "") + cmd);
+    viewer->Read(stat?errfile:tmpfile);
+    viewer->setWindowTitle((stat?"QC Error: ":"")+cmd);
     remove(qPrintable(tmpfile));
     remove(qPrintable(errfile));
 }
 // callback on menu-copy-to-clipboard ---------------------------------------
 void Plot::MenuCopyClick()
 {
-    trace(3, "MenuCopyClick\n");
-
+    trace(3,"MenuCopyClick\n");
+    
     QClipboard *clipboard = QApplication::clipboard();
 
     clipboard->setPixmap(Buff);
@@ -989,37 +916,36 @@
 // callback on menu-options -------------------------------------------------
 void Plot::MenuOptionsClick()
 {
-    QString tlefile = TLEFile, tlesatfile = TLESatFile;
-    double oopos[3], range;
-    char str_path[256];
-    int timesyncout=TimeSyncOut;
-
-    trace(3, "MenuOptionsClick\n");
-
-    int i, rcvpos = RcvPos;
-    for (i = 0; i < 3; i++) oopos[i] = OOPos[i];
-
-    plotOptDialog->move(pos().x() + width() / 2 - plotOptDialog->width() / 2,
-                pos().y() + height() / 2 - plotOptDialog->height() / 2);
-    plotOptDialog->plot = this;
-
+    QString tlefile=TLEFile,tlesatfile=TLESatFile;
+    double oopos[3],range;
+    
+    trace(3,"MenuOptionsClick\n");
+    
+    int i,rcvpos=RcvPos;
+    for (i=0;i<3;i++) oopos[i]=OOPos[i];
+    
+    plotOptDialog->move(pos().x()+width()/2-plotOptDialog->width()/2,
+                    pos().y()+height()/2-plotOptDialog->height()/2);
+    plotOptDialog->plot=this;
+    
     plotOptDialog->exec();
 
-    if (plotOptDialog->result() != QDialog::Accepted) return;
-
+    if (plotOptDialog->result()!=QDialog::Accepted) return;
+    
     SaveOpt();
-
-    for (i = 0; i < 3; i++) oopos[i] -= OOPos[i];
-
-    if (TLEFile != tlefile) {
+    
+    for (i=0;i<3;i++) oopos[i]-=OOPos[i];
+    
+    if (TLEFile!=tlefile) {
         free(TLEData.data);
-        TLEData.data = NULL;
-        TLEData.n = TLEData.nmax = 0;
-        tle_read(qPrintable(TLEFile), &TLEData);
+        TLEData.data=NULL;
+        TLEData.n=TLEData.nmax=0;
+        tle_read(qPrintable(TLEFile),&TLEData);
     }
-    if (TLEFile != tlefile || TLESatFile != tlesatfile)
-        tle_name_read(qPrintable(TLESatFile), &TLEData);
-    if (rcvpos != RcvPos || norm(oopos, 3) > 1E-3 || TLEFile != tlefile) {
+    if (TLEFile!=tlefile||TLESatFile!=tlesatfile) {
+        tle_name_read(qPrintable(TLESatFile),&TLEData);
+    }
+    if (rcvpos!=RcvPos||norm(oopos,3)>1E-3||TLEFile!=tlefile) {
         if (SimObs) GenVisData(); else UpdateObs(NObs);
     }
     UpdateColor();
@@ -1031,27 +957,21 @@
     UpdateEnable();
     Refresh();
     Timer.start(RefCycle);
-
-    for (i = 0; i < RangeList->count(); i++) {
+    
+    for (i=0;i<RangeList->count();i++) {
         bool okay;
-        range = RangeList->item(i)->text().toDouble(&okay);
-
-        if (okay && (qFuzzyCompare(range, YRange)))
+        range=RangeList->item(i)->text().toDouble(&okay);
+        
+        if (okay&&(qFuzzyCompare(range,YRange))) {
             RangeList->item(i)->setSelected(true);
-    }
-    if (!timesyncout && TimeSyncOut) {
-        sprintf(str_path,":%d",TimeSyncPort);
-        stropen(&StrTimeSync,STR_TCPSVR,STR_MODE_RW,str_path);
-    }
-    else if (timesyncout && !TimeSyncOut) {
-        strclose(&StrTimeSync);
+        }
     }
 }
 // callback on menu-show-tool-bar -------------------------------------------
 void Plot::MenuToolBarClick()
 {
-    trace(3, "MenuToolBarClick\n");
-
+    trace(3,"MenuToolBarClick\n");
+    
     toolBar->setVisible(MenuToolBar->isChecked());
 
     UpdateSize();
@@ -1060,57 +980,40 @@
 // callback on menu-show-status-bar -----------------------------------------
 void Plot::MenuStatusBarClick()
 {
-    trace(3, "MenuStatusBarClick\n");
-
+    trace(3,"MenuStatusBarClick\n");
+    
     statusbar->setVisible(MenuStatusBar->isChecked());
     UpdateSize();
     Refresh();
 }
-// callback on menu-show-browse-panel ---------------------------------------
-void Plot::MenuBrowseClick()
-{
-    trace(3,"MenuBrowseClick\n");
-
-    if (MenuBrowse->isChecked()) {
-        PanelBrowse->setVisible(true);
-    }
-    else {
-        PanelBrowse->setVisible(false);
-    }
-
-    Disp->updateGeometry();
-
-    UpdateSize();
-    Refresh();
-}
 // callback on menu-waypoints -----------------------------------------------
 void Plot::MenuWaypointClick()
 {
-    trace(3, "MenuWaypointClick\n");
-
+    trace(3,"MenuWaypointClick\n");
+    
     pntDialog->show();
 }
 // callback on menu-input-monitor-1 -----------------------------------------
 void Plot::MenuMonitor1Click()
 {
-    trace(3, "MenuMonitor1Click\n");
-
+    trace(3,"MenuMonitor1Click\n");
+    
     Console1->setWindowTitle(tr("Monitor RT Input 1"));
     Console1->show();
 }
 // callback on menu-input-monitor-2 -----------------------------------------
 void Plot::MenuMonitor2Click()
 {
-    trace(3, "MenuMonitor2Click\n");
-
+    trace(3,"MenuMonitor2Click\n");
+    
     Console2->setWindowTitle(tr("Monitor RT Input 2"));
     Console2->show();
 }
 // callback on menu-google-earth-view ---------------------------------------
 void Plot::MenuGEClick()
 {
-    trace(3, "MenuGEClick\n");
-
+    trace(3,"MenuGEClick\n");
+    
     googleEarthView->setWindowTitle(
         QString(tr("%1 ver.%2 %3: Google Earth View")).arg(PRGNAME).arg(VER_RTKLIB).arg(PATCH_LEVEL));
     googleEarthView->show();
@@ -1125,60 +1028,51 @@
 // callback on menu-center-origin -------------------------------------------
 void Plot::MenuCenterOriClick()
 {
-    trace(3, "MenuCenterOriClick\n");
-
-    SetRange(0, YRange);
+    trace(3,"MenuCenterOriClick\n");
+    
+    SetRange(0,YRange);
     Refresh();
 }
 // callback on menu-fit-horizontal ------------------------------------------
 void Plot::MenuFitHorizClick()
 {
-    trace(3, "MenuFitHorizClick\n");
-
-    if (PlotType == PLOT_TRK) FitRange(0); else FitTime();
+    trace(3,"MenuFitHorizClick\n");
+    
+    if (PlotType==PLOT_TRK) FitRange(0); else FitTime();
     Refresh();
 }
 // callback on menu-fit-vertical --------------------------------------------
 void Plot::MenuFitVertClick()
 {
-    trace(3, "MenuFitVertClick\n");
-
+    trace(3,"MenuFitVertClick\n");
+    
     FitRange(0);
     Refresh();
 }
 // callback on menu-show-skyplot --------------------------------------------
 void Plot::MenuShowSkyplotClick()
 {
-    trace(3, "MenuShowSkyplotClick\n");
-
+    trace(3,"MenuShowSkyplotClick\n");
+    
     UpdatePlot();
     UpdateEnable();
 }
 // callback on menu-show-map-image ------------------------------------------
 void Plot::MenuShowImgClick()
 {
-    trace(3, "MenuShowMapClick\n");
-
-    UpdatePlot();
-    UpdateEnable();
-}
-// callback on menu-show-grid -----------------------------------------------
-void Plot::MenuShowGridClick()
-{
-    trace(3,"MenuShowGrid\n");
-
+    trace(3,"MenuShowMapClick\n");
+    
     UpdatePlot();
     UpdateEnable();
-    Refresh();
 }
 // callback on menu-show-track-points ---------------------------------------
 void Plot::MenuShowTrackClick()
 {
-    trace(3, "MenuShowTrackClick\n");
-
+    trace(3,"MenuShowTrackClick\n");
+    
     if (!MenuShowTrack->isChecked()) {
         MenuFixHoriz->setChecked(false);
-        MenuFixVert->setChecked(false);
+        MenuFixVert ->setChecked(false);
     }
     UpdatePlot();
     UpdateEnable();
@@ -1186,32 +1080,32 @@
 // callback on menu-fix-center ----------------------------------------------
 void Plot::MenuFixCentClick()
 {
-    trace(3, "MenuFixCentClick\n");
-
+    trace(3,"MenuFixCentClick\n");
+    
     UpdatePlot();
     UpdateEnable();
 }
 // callback on menu-fix-horizontal ------------------------------------------
 void Plot::MenuFixHorizClick()
 {
-    trace(3, "MenuFixHorizClick\n");
-
-    Xcent = 0.0;
+    trace(3,"MenuFixHorizClick\n");
+    
+    Xcent=0.0;
     UpdatePlot();
     UpdateEnable();
 }
 // callback on menu-fix-vertical --------------------------------------------
 void Plot::MenuFixVertClick()
 {
-    trace(3, "MenuFixVertClick\n");
-
+    trace(3,"MenuFixVertClick\n");
+    
     UpdatePlot();
     UpdateEnable();
 }
 // callback on menu-show-map -------------------------------------------------
 void Plot::MenuShowMapClick()
 {
-    trace(3, "MenuShowMapClick\n");
+    trace(3,"MenuShowMapClick\n");
 
 #if 0
     if (BtnShowMap->isChecked()) UpdatePntsGE();
@@ -1222,128 +1116,126 @@
 // callback on menu-windows-maximize ----------------------------------------
 void Plot::MenuMaxClick()
 {
-    QScreen *scr = QApplication::screens().at(0);
+    QScreen *scr=QApplication::screens().at(0);
     QRect rect = scr->availableGeometry();
-    QSize thisDecoration = this->frameSize() - this->size();
-
-    this->move(rect.x(), rect.y());
-    this->resize(rect.width() - thisDecoration.width(), rect.height() - thisDecoration.height());
+    QSize thisDecoration=this->frameSize()-this->size();
+    this->move(rect.x(),rect.y());
+    this->resize(rect.width()-thisDecoration.width(),rect.height()-thisDecoration.height());
 }
 // callback on menu-windows-plot-ge -----------------------------------------
 void Plot::MenuPlotGEClick()
 {
-    QScreen *scr = QApplication::screens().at(0);
+    QScreen *scr=QApplication::screens().at(0);
     QRect rect = scr->availableGeometry();
-    QSize thisDecoration = this->frameSize() - this->size();
-
-    this->move(rect.x(), rect.y());
-    this->resize(rect.width() / 2 - thisDecoration.width(), rect.height() - thisDecoration.height());
-
-    QSize GEDecoration = googleEarthView->frameSize() - googleEarthView->size();
-    googleEarthView->resize(rect.width()/2 - GEDecoration.width(), rect.height() - GEDecoration.height());
-    googleEarthView->move(rect.x() + rect.width() / 2, rect.y());
+    QSize thisDecoration=this->frameSize()-this->size();
+    this->move(rect.x(),rect.y());
+    this->resize(rect.width()/2-thisDecoration.width(),rect.height()-thisDecoration.height());
 
+    QSize GEDecoration=googleEarthView->frameSize()-googleEarthView->size();
+    googleEarthView->move(rect.x(),rect.y());
+    googleEarthView->resize(rect.width()-GEDecoration.width(),rect.height()-GEDecoration.height());
     googleEarthView->setVisible(true);
     googleMapView->setVisible(false);
 }
 // callback on menu-windows-plot-gm -----------------------------------------
 void Plot::MenuPlotGMClick()
 {
-    QScreen *scr = QApplication::screens().at(0);
+    QScreen *scr=QApplication::screens().at(0);
     QRect rect = scr->availableGeometry();
-    QSize thisDecoration = this->frameSize() - this->size();
-
-    this->move(rect.x(), rect.y());
-    this->resize(rect.width() / 2 - thisDecoration.width(), rect.height() - thisDecoration.height());
-
-    QSize GMDecoration = googleMapView->frameSize() - googleMapView->size();
-    googleMapView->resize(rect.width() / 2 - GMDecoration.width(), rect.height() - GMDecoration.height());
-    googleMapView->move(rect.x() + rect.width() / 2, rect.y());
+    QSize thisDecoration=this->frameSize()-this->size();
+    this->move(rect.x(),rect.y());
+    this->resize(rect.width()/2-thisDecoration.width(),rect.height()-thisDecoration.height());
 
+    QSize GMDecoration=googleMapView->frameSize()-googleMapView->size();
+    googleMapView->move(rect.x()+rect.width()/2,rect.y());
+    googleMapView->resize(rect.width()/2-GMDecoration.width(),rect.height()-GMDecoration.height());
     googleEarthView->setVisible(false);;
     googleMapView->setVisible(true);
 }
 // callback on menu-windows-plot-ge/gm --------------------------------------
 void Plot::MenuPlotGEGMClick()
 {
-    QScreen *scr = QApplication::screens().at(0);
+    QScreen *scr=QApplication::screens().at(0);
     QRect rect = scr->availableGeometry();
-    QSize thisDecoration = this->frameSize() - this->size();
-
-    this->move(rect.x(), rect.y());
-    this->resize(rect.width() / 2 - thisDecoration.width(), rect.height() - thisDecoration.height());
-
-    QSize GMDecoration = googleMapView->frameSize() - googleMapView->size();
-    googleMapView->resize(rect.width() / 2 - GMDecoration.width(), rect.height() / 2 - GMDecoration.height());
-    googleMapView->move(rect.x() + rect.width() / 2, rect.y());
-
-    QSize GEDecoration = googleEarthView->frameSize() - googleEarthView->size();
-    googleEarthView->resize(rect.width() / 2 - GEDecoration.width(), rect.height() / 2 - GEDecoration.height());
-    googleEarthView->move(rect.x() + rect.width() / 2, rect.y() + rect.height() / 2);
+    QSize thisDecoration=this->frameSize()-this->size();
+    this->move(rect.x(),rect.y());
+    this->resize(rect.width()/2-thisDecoration.width(),rect.height()-thisDecoration.height());
 
+    QSize GMDecoration=googleMapView->frameSize()-googleMapView->size();
+    googleMapView->move(rect.x()+rect.width()/2,rect.y());
+    googleMapView->resize(rect.width()/2-GMDecoration.width(),rect.height()-GMDecoration.height());
     googleEarthView->setVisible(true);
     googleMapView->setVisible(true);
+
+    QSize GEDecoration=googleEarthView->frameSize()-googleEarthView->size();
+    googleEarthView->move(rect.x()+rect.width()/2,rect.y());
+    googleEarthView->resize(rect.width()/2-GEDecoration.width(),rect.height()/2-GEDecoration.height());
+    googleMapView->move(rect.x()+rect.width()/2,rect.y()+rect.height()/2);
+    googleMapView->resize(rect.width()/2-GMDecoration.width(),rect.height()/2-GMDecoration.height());
+
 }
 //---------------------------------------------------------------------------
 #if 0
 void Plot::DispGesture()
 {
     AnsiString s;
-    int b, e;
+    int b,e;
 
-    b = EventInfo.Flags.Contains(gfBegin);
-    e = EventInfo.Flags.Contains(gfEnd);
+    b=EventInfo.Flags.Contains(gfBegin);
+    e=EventInfo.Flags.Contains(gfEnd);
 
-    if (EventInfo.GestureID == Controls::igiZoom) {
+    if (EventInfo.GestureID==Controls::igiZoom) {
         s.sprintf("zoom: Location=%d,%d,Flag=%d,%d,Angle=%.1f,Disnance=%d",
-              EventInfo.Location.X, EventInfo.Location.Y, b, e,
-              EventInfo.Angle, EventInfo.Distance);
-        Message1->Caption = s;
-    } else if (EventInfo.GestureID == Controls::igiPan) {
+                  EventInfo.Location.X,EventInfo.Location.Y,b,e,
+                  EventInfo.Angle,EventInfo.Distance);
+        Message1->Caption=s;
+    }
+    else if (EventInfo.GestureID==Controls::igiPan) {
         s.sprintf("pan: Location=%d,%d,Flag=%d,%d,Angle=%.1f,Disnance=%d",
-              EventInfo.Location.X, EventInfo.Location.Y, b, e,
-              EventInfo.Angle, EventInfo.Distance);
-        Message1->Caption = s;
-    } else if (EventInfo.GestureID == Controls::igiRotate) {
+                  EventInfo.Location.X,EventInfo.Location.Y,b,e,
+                  EventInfo.Angle,EventInfo.Distance);
+        Message1->Caption=s;
+    }
+    else if (EventInfo.GestureID==Controls::igiRotate) {
         s.sprintf("rotate: Location=%d,%d,Flag=%d,%d,Angle=%.1f,Disnance=%d",
-              EventInfo.Location.X, EventInfo.Location.Y, b, e,
-              EventInfo.Angle, EventInfo.Distance);
-        Message1->Caption = s;
+                  EventInfo.Location.X,EventInfo.Location.Y,b,e,
+                  EventInfo.Angle,EventInfo.Distance);
+        Message1->Caption=s;
     }
 }
 #endif
 // callback on menu-animation-start -----------------------------------------
 void Plot::MenuAnimStartClick()
 {
-    trace(3, "MenuAnimStartClick\n");
+    trace(3,"MenuAnimStartClick\n");
 }
 // callback on menu-animation-stop ------------------------------------------
 void Plot::MenuAnimStopClick()
 {
-    trace(3, "MenuAnimStopClick\n");
+    trace(3,"MenuAnimStopClick\n");
 }
 // callback on menu-about ---------------------------------------------------
 void Plot::MenuAboutClick()
 {
-    trace(3, "MenuAboutClick\n");
-
-    aboutDialog->About = PRGNAME;
-    aboutDialog->IconIndex = 2;
+    trace(3,"MenuAboutClick\n");
+    
+    aboutDialog->About=PRGNAME;
+    aboutDialog->IconIndex=2;
     aboutDialog->exec();
 }
 // callback on button-connect/disconnect ------------------------------------
 void Plot::BtnConnectClick()
 {
-    trace(3, "BtnConnectClick\n");
-
+    trace(3,"BtnConnectClick\n");
+    
     if (!ConnectState) MenuConnectClick();
     else MenuDisconnectClick();
 }
 // callback on button-solution-1 --------------------------------------------
 void Plot::BtnSol1Click()
 {
-    trace(3, "BtnSol1Click\n");
-
+    trace(3,"BtnSol1Click\n");
+    
     BtnSol12->setChecked(false);
     UpdateTime();
     UpdatePlot();
@@ -1352,8 +1244,8 @@
 // callback on button-solution-2 --------------------------------------------
 void Plot::BtnSol2Click()
 {
-    trace(3, "BtnSol2Click\n");
-
+    trace(3,"BtnSol2Click\n");
+    
     BtnSol12->setChecked(false);
     UpdateTime();
     UpdatePlot();
@@ -1362,61 +1254,61 @@
 // callback on button-solution-1-2 ------------------------------------------
 void Plot::BtnSol12Click()
 {
-    trace(3, "BtnSol12Click\n");
-
+    trace(3,"BtnSol12Click\n");
+    
     BtnSol1->setChecked(false);
     BtnSol2->setChecked(false);
     UpdateTime();
-    UpdatePlot();
+    UpdatePlot(); 
     UpdateEnable();
 }
 // callback on button-solution-1 double-click -------------------------------
 void Plot::BtnSol1DblClick()
 {
-    trace(3, "BtnSol1DblClick\n");
-
+    trace(3,"BtnSol1DblClick\n");
+    
     MenuOpenSol1Click();
 }
 // callback on button-solution-2 double-click -------------------------------
 void Plot::BtnSol2DblClick()
 {
-    trace(3, "BtnSol2DblClick\n");
-
+    trace(3,"BtnSol2DblClick\n");
+    
     MenuOpenSol2Click();
 }
 
 // callback on button-plot-1-onoff ------------------------------------------
 void Plot::BtnOn1Click()
 {
-    trace(3, "BtnOn1Click\n");
-
+    trace(3,"BtnOn1Click\n");
+    
     UpdateSize();
     Refresh();
 }
 // callback on button-plot-2-onoff-------------------------------------------
 void Plot::BtnOn2Click()
 {
-    trace(3, "BtnOn2Click\n");
-
+    trace(3,"BtnOn2Click\n");
+    
     UpdateSize();
     Refresh();
 }
 // callback on button-plot-3-onoff ------------------------------------------
 void Plot::BtnOn3Click()
 {
-    trace(3, "BtnOn3Click\n");
-
+    trace(3,"BtnOn3Click\n");
+    
     UpdateSize();
     Refresh();
 }
 // callback on button-range-list --------------------------------------------
 void Plot::BtnRangeListClick()
 {
-    trace(3, "BtnRangeListClick\n");
-
-    QPoint pos = BtnRangeList->mapToGlobal(BtnRangeList->pos());
-    pos.rx() -= BtnRangeList->width();
-    pos.ry() += BtnRangeList->height();
+    trace(3,"BtnRangeListClick\n");
+    
+    QPoint pos=BtnRangeList->mapToGlobal(BtnRangeList->pos());
+    pos.rx()-=BtnRangeList->width();
+    pos.ry()+=BtnRangeList->height();
 
     RangeList->move(pos);
     RangeList->setVisible(!RangeList->isVisible());
@@ -1427,17 +1319,17 @@
     double range;
     bool okay;
     QListWidgetItem *i;
-
-    trace(3, "RangeListClick\n");
-
+    
+    trace(3,"RangeListClick\n");
+    
     RangeList->setVisible(false);
-    if ((i = RangeList->currentItem()) == NULL) return;
-
-    range = i->text().toDouble(&okay);
+    if ((i=RangeList->currentItem())==NULL) return;
+        
+    range=i->text().toDouble(&okay);
     if (!okay) return;
-
-    YRange = range;
-    SetRange(0, YRange);
+    
+    YRange=range;
+    SetRange(0,YRange);
     UpdatePlot();
     UpdateEnable();
 }
@@ -1445,25 +1337,25 @@
 // callback on button-animation ---------------------------------------------
 void Plot::BtnAnimateClick()
 {
-    trace(3, "BtnAnimateClick\n");
-
+    trace(3,"BtnAnimateClick\n");
+    
     UpdateEnable();
 }
 // callback on button-message 2 ---------------------------------------------
 void Plot::BtnMessage2Click()
 {
-    if (++PointType > 2) PointType = 0;
+    if (++PointType>2) PointType=0;
 }
 // callback on plot-type selection change -----------------------------------
 void Plot::PlotTypeSChange()
 {
     int i;
-
-    trace(3, "PlotTypeSChnage\n");
-
-    for (i = 0; PTypes[i] != NULL; i++)
-        if (PlotTypeS->currentText() == PTypes[i]) UpdateType(i);
-
+    
+    trace(3,"PlotTypeSChnage\n");
+    
+    for (i=0;PTypes[i]!=NULL;i++) {
+        if (PlotTypeS->currentText()==PTypes[i]) UpdateType(i);
+    }
     UpdateTime();
     UpdatePlot();
     UpdateEnable();
@@ -1471,32 +1363,32 @@
 // callback on quality-flag selection change --------------------------------
 void Plot::QFlagChange()
 {
-    trace(3, "QFlagChange\n");
-
+    trace(3,"QFlagChange\n");
+    
     UpdatePlot();
     UpdateEnable();
 }
 // callback on obs-type selection change ------------------------------------
 void Plot::ObsTypeChange()
 {
-    trace(3, "ObsTypeChange\n");
-
+    trace(3,"ObsTypeChange\n");
+    
     UpdatePlot();
     UpdateEnable();
 }
 // callback on dop-type selection change ------------------------------------
 void Plot::DopTypeChange()
 {
-    trace(3, "DopTypeChange\n");
-
+    trace(3,"DopTypeChange\n");
+    
     UpdatePlot();
     UpdateEnable();
 }
 // callback on satellite-list selection change ------------------------------
 void Plot::SatListChange()
 {
-    trace(3, "SatListChange\n");
-
+    trace(3,"SatListChange\n");
+    
     UpdateSatSel();
     UpdatePlot();
     UpdateEnable();
@@ -1504,339 +1396,361 @@
 // callback on time scroll-bar change ---------------------------------------
 void Plot::TimeScrollChange()
 {
-    int sel = !BtnSol1->isChecked() && BtnSol2->isChecked() ? 1 : 0;
-
-    trace(3, "TimeScrollChange\n");
-
-    if (PlotType <= PLOT_NSAT || PlotType == PLOT_RES)
-        SolIndex[sel] = TimeScroll->value();
-    else
-        ObsIndex = TimeScroll->value();
+    int sel=!BtnSol1->isChecked()&&BtnSol2->isChecked()?1:0;
+    
+    trace(3,"TimeScrollChange\n");
+    
+    if (PlotType<=PLOT_NSAT||PlotType==PLOT_RES) {
+        SolIndex[sel]=TimeScroll->value();
+    }
+    else {
+        ObsIndex=TimeScroll->value();
+    }
     UpdatePlot();
 }
 // callback on mouse-down event ---------------------------------------------
 void Plot::mousePressEvent(QMouseEvent *event)
 {
-    X0 = Disp->mapFromGlobal(event->globalPos()).x();
-    Y0 = Disp->mapFromGlobal(event->globalPos()).y();
-    Xcent0 = Xcent;
-
-    trace(3, "DispMouseDown: X=%d Y=%d\n", X0, Y0);
-
-    Drag = event->buttons().testFlag(Qt::LeftButton) ? 1 : (event->buttons().testFlag(Qt::RightButton) ? 11 : 0);
-
-    if (PlotType == PLOT_TRK)
-        MouseDownTrk(X0, Y0);
-    else if (PlotType <= PLOT_NSAT || PlotType == PLOT_RES || PlotType == PLOT_SNR)
-        MouseDownSol(X0, Y0);
-    else if (PlotType == PLOT_OBS || PlotType == PLOT_DOP)
-        MouseDownObs(X0, Y0);
-    else Drag = 0;
+    X0=event->globalX(); Y0=event->globalY(); Xcent0=Xcent;
 
+    trace(3,"DispMouseDown: X=%d Y=%d\n",event->globalX(),event->globalY());
+    
+    Drag=event->buttons().testFlag(Qt::LeftButton)?1:(event->buttons().testFlag(Qt::RightButton)?11:0);
+    
+    if (PlotType==PLOT_TRK) {
+        MouseDownTrk(event->globalX(),event->globalY());
+    }
+    else if (PlotType<=PLOT_NSAT||PlotType==PLOT_RES||PlotType==PLOT_SNR) {
+        MouseDownSol(event->globalX(),event->globalY());
+    }
+    else if (PlotType==PLOT_OBS||PlotType==PLOT_DOP) {
+        MouseDownObs(event->globalX(),event->globalY());
+    }
+    else Drag=0;
+    
     RangeList->setVisible(false);
 }
 // callback on mouse-move event ---------------------------------------------
-void Plot::mouseMove(QMouseEvent *event)
+void Plot::mouseMoveEvent(QMouseEvent *event)
 {
-    double dx, dy, dxs, dys;
-
-    if ((abs(Disp->mapFromGlobal(event->globalPos()).x() - Xn) < 1) &&
-        (abs(Disp->mapFromGlobal(event->globalPos()).y() - Yn) < 1)) return;
-
-    Xn = Disp->mapFromGlobal(event->globalPos()).x();
-    Yn = Disp->mapFromGlobal(event->globalPos()).y();
-
-    trace(4, "DispMouseMove: X=%d Y=%d\n", Xn, Yn);
+    double dx,dy,dxs,dys;
+    
+    if ((abs(event->globalX()-Xn)<1)&&(abs(event->globalY()-Yn)<1)) return;
+    
+    trace(4,"DispMouseMove: X=%d Y=%d\n",event->globalX(),event->globalY());
 
-    if (Drag == 0) {
-        UpdatePoint(Xn, Yn);
+    if (Drag==0) {
+        UpdatePoint(event->globalX(),event->globalY());
         return;
     }
-
-    dx = (X0 - Xn) * Xs;
-    dy = (Yn - Y0) * Ys;
-    dxs = pow(2.0, (X0 - Xn) / 100.0);
-    dys = pow(2.0, (Yn - Y0) / 100.0);
-
-    if (PlotType == PLOT_TRK)
-        MouseMoveTrk(Xn, Yn, dx, dy, dxs, dys);
-    else if (PlotType <= PLOT_NSAT || PlotType == PLOT_RES || PlotType == PLOT_SNR)
-        MouseMoveSol(Xn, Yn, dx, dy, dxs, dys);
-    else if (PlotType == PLOT_OBS || PlotType == PLOT_DOP)
-        MouseMoveObs(Xn, Yn, dx, dy, dxs, dys);
+    
+    Xn=event->globalX(); Yn=event->globalY();
+    dx=(X0-event->globalX())*Xs;
+    dy=(event->globalY()-Y0)*Ys;
+    dxs=pow(2.0,(X0-event->globalX())/100.0);
+    dys=pow(2.0,(event->globalY()-Y0)/100.0);
+    
+    if (PlotType==PLOT_TRK) {
+        MouseMoveTrk(event->globalX(),event->globalY(),dx,dy,dxs,dys);
+    }
+    else if (PlotType<=PLOT_NSAT||PlotType==PLOT_RES||PlotType==PLOT_SNR) {
+        MouseMoveSol(event->globalX(),event->globalY(),dx,dy,dxs,dys);
+    }
+    else if (PlotType==PLOT_OBS||PlotType==PLOT_DOP) {
+        MouseMoveObs(event->globalX(),event->globalY(),dx,dy,dxs,dys);
+    }
 }
 // callback on mouse-up event -----------------------------------------------
 void Plot::mouseReleaseEvent(QMouseEvent *event)
 {
-    trace(3, "DispMouseUp: X=%d Y=%d\n", Disp->mapFromGlobal(event->globalPos()).x(), Disp->mapFromGlobal(event->globalPos()).y());
-
-    Drag = 0;
+    trace(3,"DispMouseUp: X=%d Y=%d\n",event->globalX(),event->globalY());
+    
+    Drag=0;
     setCursor(Qt::ArrowCursor);
     Refresh();
     Refresh_GEView();
-}
-// callback on mouse-double-click -------------------------------------------
-void Plot::mouseDoubleClickEvent(QMouseEvent *event)
-{
-    QPoint p(static_cast<int>(X0), static_cast<int>(Y0));
-    double x, y;
+ }
+ // callback on mouse-double-click -------------------------------------------
+ void Plot::mouseDoubleClickEvent(QMouseEvent *event)
+ {
+     QPoint p(static_cast<int>(X0),static_cast<int>(Y0));
+     double x,y;
 
-    if (event->button() != Qt::LeftButton) return;
+     if (event->button() != Qt::LeftButton) return;
 
-    trace(3, "DispDblClick X=%d Y=%d\n", p.x(), p.y());
+     trace(3,"DispDblClick X=%d Y=%d\n",p.x(),p.y());
 
-    if (BtnFixHoriz->isChecked()) return;
+     if (BtnFixHoriz->isChecked()) return;
 
-    if (PlotType == PLOT_TRK) {
-        GraphT->ToPos(p, x, y);
-        GraphT->SetCent(x, y);
-        Refresh();
-        Refresh_GEView();
-    } else if (PlotType <= PLOT_NSAT || PlotType == PLOT_RES || PlotType == PLOT_SNR) {
-        GraphG[0]->ToPos(p, x, y);
-        SetCentX(x);
-        Refresh();
-    } else if (PlotType == PLOT_OBS || PlotType == PLOT_DOP) {
-        GraphR->ToPos(p, x, y);
-        SetCentX(x);
-        Refresh();
-    }
+     if (PlotType==PLOT_TRK) {
+         GraphT->ToPos(p,x,y);
+         GraphT->SetCent(x,y);
+         Refresh();
+         Refresh_GEView();
+     }
+     else if (PlotType<=PLOT_NSAT||PlotType==PLOT_RES||PlotType==PLOT_SNR) {
+         GraphG[0]->ToPos(p,x,y);
+         SetCentX(x);
+         Refresh();
+     }
+     else if (PlotType==PLOT_OBS||PlotType==PLOT_DOP) {
+         GraphR->ToPos(p,x,y);
+         SetCentX(x);
+         Refresh();
+     }
 }
 // callback on mouse-leave event --------------------------------------------
-void Plot::leaveEvent(QEvent *)
+void Plot::leaveEvent(QEvent*)
 {
-    trace(3, "DispMouseLeave\n");
-
-    Xn = Yn = -1;
+    trace(3,"DispMouseLeave\n");
+    
+    Xn=Yn=-1;
     Message2->setVisible(false);
     Message2->setText("");
 }
 // callback on mouse-down event on track-plot -------------------------------
 void Plot::MouseDownTrk(int X, int Y)
 {
-    int i, sel = !BtnSol1->isChecked() && BtnSol2->isChecked() ? 1 : 0;
-
-    trace(3, "MouseDownTrk: X=%d Y=%d\n", X, Y);
-
-    if (Drag == 1 && (i = SearchPos(X, Y)) >= 0) {
-        SolIndex[sel] = i;
+    int i,sel=!BtnSol1->isChecked()&&BtnSol2->isChecked()?1:0;
+    
+    trace(3,"MouseDownTrk: X=%d Y=%d\n",X,Y);
+    
+    if (Drag==1&&(i=SearchPos(X,Y))>=0) {
+        SolIndex[sel]=i;
         UpdateTime();
         UpdateInfo();
-        Drag = 0;
+        Drag=0;
         Refresh();
-    } else {
-        GraphT->GetCent(Xc, Yc);
-        GraphT->GetScale(Xs, Ys);
-        setCursor(Drag == 1 ? Qt::SizeAllCursor : Qt::SplitVCursor);
+    }
+    else {
+        GraphT->GetCent(Xc,Yc);
+        GraphT->GetScale(Xs,Ys);
+        setCursor(Drag==1?Qt::SizeAllCursor:Qt::SplitVCursor);
     }
 }
 // callback on mouse-down event on solution-plot ----------------------------
 void Plot::MouseDownSol(int X, int Y)
 {
-    QPushButton *btn[] = { BtnOn1, BtnOn2, BtnOn3 };
-    QPoint pnt, p(X, Y);
-    gtime_t time = { 0, 0 };
+    QPushButton *btn[]={BtnOn1,BtnOn2,BtnOn3};
+    QPoint pnt,p(X,Y);
+    gtime_t time={0,0};
     sol_t *data;
-    double x, xl[2], yl[2];
-    int i, area = -1, sel = !BtnSol1->isChecked() && BtnSol2->isChecked() ? 1 : 0;
-
-    trace(3, "MouseDownSol: X=%d Y=%d\n", X, Y);
-
-    if (PlotType == PLOT_SNR) {
-        if (0 <= ObsIndex && ObsIndex < NObs) time = Obs.data[IndexObs[ObsIndex]].time;
-    } else {
-        if ((data = getsol(SolData + sel, SolIndex[sel]))) time = data->time;
+    double x,xl[2],yl[2];
+    int i,area=-1,sel=!BtnSol1->isChecked()&&BtnSol2->isChecked()?1:0;
+    
+    trace(3,"MouseDownSol: X=%d Y=%d\n",X,Y);
+    
+    if (PlotType==PLOT_SNR) {
+        if (0<=ObsIndex&&ObsIndex<NObs) time=Obs.data[IndexObs[ObsIndex]].time;
     }
-    if (time.time && !MenuFixHoriz->isChecked()) {
-        x = TimePos(time);
-
-        GraphG[0]->GetLim(xl, yl);
-        GraphG[0]->ToPoint(x, yl[1], pnt);
-
-        if ((X - pnt.x()) * (X - pnt.x()) + (Y - pnt.y()) * (Y - pnt.y()) < 25) {
+    else {
+        if ((data=getsol(SolData+sel,SolIndex[sel]))) time=data->time;
+    }
+    if (time.time&&!MenuFixHoriz->isChecked()) {
+        
+        x=TimePos(time);
+        
+        GraphG[0]->GetLim(xl,yl);
+        GraphG[0]->ToPoint(x,yl[1],pnt);
+        
+        if ((X-pnt.x())*(X-pnt.x())+(Y-pnt.y())*(Y-pnt.y())<25) {
             setCursor(Qt::SizeHorCursor);
-            Drag = 20;
+            Drag=20;
             Refresh();
             return;
         }
     }
-    for (i = 0; i < 3; i++) {
-        if (!btn[i]->isChecked() || (i != 1 && PlotType == PLOT_SNR)) continue;
-
-        GraphG[i]->GetCent(Xc, Yc);
-        GraphG[i]->GetScale(Xs, Ys);
-        area = GraphG[i]->OnAxis(Disp->mapFromGlobal(p));
-
-        if (Drag == 1 && area == 0) {
+    for (i=0;i<3;i++) {
+        if (!btn[i]->isChecked()||(i!=1&&PlotType==PLOT_SNR)) continue;
+        
+        GraphG[i]->GetCent(Xc,Yc);
+        GraphG[i]->GetScale(Xs,Ys);
+        area=GraphG[i]->OnAxis(Disp->mapFromGlobal(p));
+        
+        if (Drag==1&&area==0) {
             setCursor(Qt::SizeAllCursor);
-            Drag += i;
+            Drag+=i;
             return;
-        } else if (area == 1) {
-            setCursor(Drag == 1 ? Qt::SizeVerCursor : Qt::SplitVCursor);
-            Drag += i + 4;
+        }
+        else if (area==1) {
+            setCursor(Drag==1?Qt::SizeVerCursor:Qt::SplitVCursor);
+            Drag+=i+4;
             return;
-        } else if (area == 0) {
-            break;
         }
+        else if (area==0) break;
     }
-    if (area == 0 || area == 8) {
-        setCursor(Drag == 1 ? Qt::SizeHorCursor : Qt::SplitHCursor);
-        Drag += 3;
-    } else {
-        Drag = 0;
+    if (area==0||area==8) {
+        setCursor(Drag==1?Qt::SizeHorCursor:Qt::SplitHCursor);
+        Drag+=3;
     }
+    else Drag=0;
 }
 // callback on mouse-down event on observation-data-plot --------------------
 void Plot::MouseDownObs(int X, int Y)
 {
-    QPoint pnt, p(X, Y);
-    double x, xl[2], yl[2];
+    QPoint pnt,p(X,Y);
+    double x,xl[2],yl[2];
     int area;
-
-    trace(3, "MouseDownObs: X=%d Y=%d\n", X, Y);
-
-    if (0 <= ObsIndex && ObsIndex < NObs && !MenuFixHoriz->isChecked()) {
-        x = TimePos(Obs.data[IndexObs[ObsIndex]].time);
-
-        GraphR->GetLim(xl, yl);
-        GraphR->ToPoint(x, yl[1], pnt);
-
-        if ((X - pnt.x()) * (X - pnt.x()) + (Y - pnt.y()) * (Y - pnt.y()) < 25) {
+    
+    trace(3,"MouseDownObs: X=%d Y=%d\n",X,Y);
+    
+    if (0<=ObsIndex&&ObsIndex<NObs&&!MenuFixHoriz->isChecked()) {
+        
+        x=TimePos(Obs.data[IndexObs[ObsIndex]].time);
+        
+        GraphR->GetLim(xl,yl);
+        GraphR->ToPoint(x,yl[1],pnt);
+        
+        if ((X-pnt.x())*(X-pnt.x())+(Y-pnt.y())*(Y-pnt.y())<25) {
             setCursor(Qt::SizeHorCursor);
-            Drag = 20;
+            Drag=20;
             Refresh();
             return;
         }
     }
-    GraphR->GetCent(Xc, Yc);
-    GraphR->GetScale(Xs, Ys);
-    area = GraphR->OnAxis(Disp->mapFromGlobal(p));
-
-    if (area == 0 || area == 8) {
-        setCursor(Drag == 1 ? Qt::SizeHorCursor : Qt::SplitHCursor);
-        Drag += 3;
-    } else {
-        Drag = 0;
+    GraphR->GetCent(Xc,Yc);
+    GraphR->GetScale(Xs,Ys);
+    area=GraphR->OnAxis(Disp->mapFromGlobal(p));
+    
+    if (area==0||area==8) {
+        setCursor(Drag==1?Qt::SizeHorCursor:Qt::SplitHCursor);
+        Drag+=3;
     }
+    else Drag=0;
 }
 // callback on mouse-move event on track-plot -------------------------------
 void Plot::MouseMoveTrk(int X, int Y, double dx, double dy,
-            double dxs, double dys)
+    double dxs, double dys)
 {
-    trace(4, "MouseMoveTrk: X=%d Y=%d\n", X, Y);
-
+    trace(4,"MouseMoveTrk: X=%d Y=%d\n",X,Y);
+    
     Q_UNUSED(dxs);
 
-    if (Drag == 1 && !MenuFixHoriz->isChecked())
-        GraphT->SetCent(Xc + dx, Yc + dy);
-    else if (Drag > 1)
-        GraphT->SetScale(Xs * dys, Ys * dys);
+    if (Drag==1&&!MenuFixHoriz->isChecked()) {
+        GraphT->SetCent(Xc+dx,Yc+dy);
+    }
+    else if (Drag>1) {
+        GraphT->SetScale(Xs*dys,Ys*dys);
+    }
     MenuCenterOri->setChecked(false);
 
-    if (updateTime.elapsed() < RefreshTime) return;
+    if (updateTime.elapsed()<RefreshTime) return;
     updateTime.restart();
 
     Refresh();
 }
 // callback on mouse-move event on solution-plot ----------------------------
 void Plot::MouseMoveSol(int X, int Y, double dx, double dy,
-            double dxs, double dys)
+    double dxs, double dys)
 {
-    QPoint p1, p2, p(X, Y);
-    double x, y, xs, ys;
-    int i, sel = !BtnSol1->isChecked() && BtnSol2->isChecked() ? 1 : 0;
-
-    trace(4, "MouseMoveSol: X=%d Y=%d\n", X, Y);
-
-    if (Drag <= 4) {
-        for (i = 0; i < 3; i++) {
-            GraphG[i]->GetCent(x, y);
-            if (!MenuFixHoriz->isChecked())
-                x = Xc + dx;
-            if (!MenuFixVert->isChecked() || !MenuFixVert->isEnabled())
-                y = i == Drag - 1 ? Yc + dy : y;
-            GraphG[i]->SetCent(x, y);
+    QPoint p1,p2,p(X,Y);
+    double x,y,xs,ys;
+    int i,sel=!BtnSol1->isChecked()&&BtnSol2->isChecked()?1:0;
+    
+    trace(4,"MouseMoveSol: X=%d Y=%d\n",X,Y);
+    
+    if (Drag<=4) {
+        for (i=0;i<3;i++) {
+            GraphG[i]->GetCent(x,y);
+            if (!MenuFixHoriz->isChecked()) {
+                x=Xc+dx;
+            }
+            if (!MenuFixVert->isChecked()||!MenuFixVert->isEnabled()) {
+                y=i==Drag-1?Yc+dy:y;
+            }
+            GraphG[i]->SetCent(x,y);
             SetCentX(x);
         }
         if (MenuFixHoriz->isChecked()) {
-            GraphG[0]->GetPos(p1, p2);
-            Xcent = Xcent0 + 2.0 * (X - X0) / (p2.x() - p1.x());
-            if (Xcent > 1.0) Xcent = 1.0;
-            if (Xcent < -1.0) Xcent = -1.0;
+            GraphG[0]->GetPos(p1,p2);
+            Xcent=Xcent0+2.0*(X-X0)/(p2.x()-p1.x());
+            if (Xcent> 1.0) Xcent= 1.0;
+            if (Xcent<-1.0) Xcent=-1.0;
         }
-    } else if (Drag <= 7) {
-        GraphG[Drag - 5]->GetCent(x, y);
-        if (!MenuFixVert->isChecked() || !MenuFixVert->isEnabled())
-            y = Yc + dy;
-        GraphG[Drag - 5]->SetCent(x, y);
-    } else if (Drag <= 14) {
-        for (i = 0; i < 3; i++) {
-            GraphG[i]->GetScale(xs, ys);
-            GraphG[i]->SetScale(Xs * dxs, ys);
+    }
+    else if (Drag<=7) {
+        GraphG[Drag-5]->GetCent(x,y);
+        if (!MenuFixVert->isChecked()||!MenuFixVert->isEnabled()) {
+            y=Yc+dy;
         }
-        SetScaleX(Xs * dxs);
-    } else if (Drag <= 17) {
-        GraphG[Drag - 15]->GetScale(xs, ys);
-        GraphG[Drag - 15]->SetScale(xs, Ys * dys);
-    } else if (Drag == 20) {
-        GraphG[0]->ToPos(p, x, y);
-        if (PlotType == PLOT_SNR) {
-            for (i = 0; i < NObs; i++)
-                if (TimePos(Obs.data[IndexObs[i]].time) >= x) break;
-            ObsIndex = i < NObs ? i : NObs - 1;
-        } else {
-            for (i = 0; i < SolData[sel].n; i++)
-                if (TimePos(SolData[sel].data[i].time) >= x) break;
-            SolIndex[sel] = i < SolData[sel].n ? i : SolData[sel].n - 1;
+        GraphG[Drag-5]->SetCent(x,y);
+    }
+    else if (Drag<=14) {
+        for (i=0;i<3;i++) {
+            GraphG[i]->GetScale(xs,ys);
+            GraphG[i]->SetScale(Xs*dxs,ys);
+        }
+        SetScaleX(Xs*dxs);
+    }
+    else if (Drag<=17) {
+        GraphG[Drag-15]->GetScale(xs,ys);
+        GraphG[Drag-15]->SetScale(xs,Ys*dys);
+    }
+    else if (Drag==20) {
+        GraphG[0]->ToPos(p,x,y);
+        if (PlotType==PLOT_SNR) {
+            for (i=0;i<NObs;i++) {
+                if (TimePos(Obs.data[IndexObs[i]].time)>=x) break;
+            }
+            ObsIndex=i<NObs?i:NObs-1;
+        }
+        else {
+            for (i=0;i<SolData[sel].n;i++) {
+                if (TimePos(SolData[sel].data[i].time)>=x) break;
+            }
+            SolIndex[sel]=i<SolData[sel].n?i:SolData[sel].n-1;
         }
         UpdateTime();
     }
     MenuCenterOri->setChecked(false);
 
-    if (updateTime.elapsed() < RefreshTime) return;
+    if (updateTime.elapsed()<RefreshTime) return;
     updateTime.restart();
 
     Refresh();
 }
 // callback on mouse-move events on observataion-data-plot ------------------
 void Plot::MouseMoveObs(int X, int Y, double dx, double dy,
-            double dxs, double dys)
+    double dxs, double dys)
 {
-    QPoint p1, p2, p(X, Y);
-    double x, y, xs, ys;
+    QPoint p1,p2,p(X,Y);
+    double x,y,xs,ys;
     int i;
-
+    
     Q_UNUSED(dys);
 
-    trace(4, "MouseMoveObs: X=%d Y=%d\n", X, Y);
-
-    if (Drag <= 4) {
-        GraphR->GetCent(x, y);
-        if (!MenuFixHoriz->isChecked()) x = Xc + dx;
-        if (!MenuFixVert->isChecked()) y = Yc + dy;
-        GraphR->SetCent(x, y);
+    trace(4,"MouseMoveObs: X=%d Y=%d\n",X,Y);
+    
+    if (Drag<=4) {
+        GraphR->GetCent(x,y);
+        if (!MenuFixHoriz->isChecked()) x=Xc+dx;
+        if (!MenuFixVert ->isChecked()) y=Yc+dy;
+        GraphR->SetCent(x,y);
         SetCentX(x);
-
+        
         if (MenuFixHoriz->isChecked()) {
-            GraphR->GetPos(p1, p2);
-            Xcent = Xcent0 + 2.0 * (X - X0) / (p2.x() - p1.x());
-            if (Xcent > 1.0) Xcent = 1.0;
-            if (Xcent < -1.0) Xcent = -1.0;
+            GraphR->GetPos(p1,p2);
+            Xcent=Xcent0+2.0*(X-X0)/(p2.x()-p1.x());
+            if (Xcent> 1.0) Xcent= 1.0;
+            if (Xcent<-1.0) Xcent=-1.0;
         }
-    } else if (Drag <= 14) {
-        GraphR->GetScale(xs, ys);
-        GraphR->SetScale(Xs * dxs, ys);
-        SetScaleX(Xs * dxs);
-    } else if (Drag == 20) {
-        GraphR->ToPos(p, x, y);
-        for (i = 0; i < NObs; i++)
-            if (TimePos(Obs.data[IndexObs[i]].time) >= x) break;
-        ObsIndex = i < NObs ? i : NObs - 1;
+    }
+    else if (Drag<=14) {
+        GraphR->GetScale(xs,ys);
+        GraphR->SetScale(Xs*dxs,ys);
+        SetScaleX(Xs*dxs);
+    }
+    else if (Drag==20) {
+        GraphR->ToPos(p,x,y);
+        for (i=0;i<NObs;i++) {
+            if (TimePos(Obs.data[IndexObs[i]].time)>=x) break;
+        }
+        ObsIndex=i<NObs?i:NObs-1;
         UpdateTime();
     }
     MenuCenterOri->setChecked(false);
 
-    if (updateTime.elapsed() < RefreshTime) return;
+    if (updateTime.elapsed()<RefreshTime) return;
     updateTime.restart();
 
     Refresh();
@@ -1844,391 +1758,316 @@
 // callback on mouse-wheel events -------------------------------------------
 void Plot::wheelEvent(QWheelEvent *event)
 {
-    QPoint p(Xn, Yn);
-    double xs, ys, ds = pow(2.0, -event->angleDelta().y() / 1200.0);
-    int i, area = -1;
-
+    QPoint p(Xn,Yn);
+    double xs,ys,ds=pow(2.0,-event->angleDelta().y()/1200.0);
+    int i,area=-1;
+    
     event->accept();
-
-    trace(4, "MouseWheel: WheelDelta=%d\n", event->angleDelta().y());
-
-    if (Xn < 0 || Yn < 0) return;
-
-    if (PlotType == PLOT_TRK) { // track-plot
-        GraphT->GetScale(xs, ys);
-        GraphT->SetScale(xs * ds, ys * ds);
-    } else if (PlotType <= PLOT_NSAT || PlotType == PLOT_RES || PlotType == PLOT_SNR) {
-        for (i = 0; i < 3; i++) {
-            if (PlotType == PLOT_SNR && i != 1) continue;
-            area = GraphG[i]->OnAxis(p);
-            if (area == 0 || area == 1 || area == 2) {
-                GraphG[i]->GetScale(xs, ys);
-                GraphG[i]->SetScale(xs, ys * ds);
-            } else if (area == 0) {
-                break;
+    
+    trace(4,"MouseWheel: WheelDelta=%d\n",event->angleDelta().y());
+    
+    if (Xn<0||Yn<0) return;
+    
+    if (PlotType==PLOT_TRK) { // track-plot
+        GraphT->GetScale(xs,ys);
+        GraphT->SetScale(xs*ds,ys*ds);
+    }
+    else if (PlotType<=PLOT_NSAT||PlotType==PLOT_RES||PlotType==PLOT_SNR) {
+        
+        for (i=0;i<3;i++) {
+            if (PlotType==PLOT_SNR&&i!=1) continue;
+            area=GraphG[i]->OnAxis(p);
+            if (area==0||area==1||area==2) {
+                GraphG[i]->GetScale(xs,ys);
+                GraphG[i]->SetScale(xs,ys*ds);
             }
+            else if (area==0) break;
         }
-        if (area == 8) {
-            for (i = 0; i < 3; i++) {
-                GraphG[i]->GetScale(xs, ys);
-                GraphG[i]->SetScale(xs * ds, ys);
-                SetScaleX(xs * ds);
+        if (area==8) {
+            for (i=0;i<3;i++) {
+                GraphG[i]->GetScale(xs,ys);
+                GraphG[i]->SetScale(xs*ds,ys);
+                SetScaleX(xs*ds);
             }
         }
-    } else if (PlotType == PLOT_OBS || PlotType == PLOT_DOP) {
-        area = GraphR->OnAxis(p);
-        if (area == 0 || area == 8) {
-            GraphR->GetScale(xs, ys);
-            GraphR->SetScale(xs * ds, ys);
-            SetScaleX(xs * ds);
+    }
+    else if (PlotType==PLOT_OBS||PlotType==PLOT_DOP) {
+        area=GraphR->OnAxis(p);
+        if (area==0||area==8) {
+            GraphR->GetScale(xs,ys);
+            GraphR->SetScale(xs*ds,ys);
+            SetScaleX(xs*ds);
         }
-    } else {
-        return;
     }
-
+    else return;
+    
     Refresh();
 }
 // callback on key-down events ----------------------------------------------
-void Plot::keyPressEvent(QKeyEvent *event)
+void Plot::keyPressEvent(QKeyEvent* event)
 {
-    double sfact = 1.05, fact = event->modifiers().testFlag(Qt::ShiftModifier) ? 1.0 : 10.0;
-    double xc, yc, yc1, yc2, yc3, xs, ys, ys1, ys2, ys3;
-    int key = event->modifiers().testFlag(Qt::ControlModifier) ? 10 : 0;
-
-    trace(3, "FormKeyDown:\n");
-
+    double sfact=1.05,fact=event->modifiers().testFlag(Qt::ShiftModifier)?1.0:10.0;
+    double xc,yc,yc1,yc2,yc3,xs,ys,ys1,ys2,ys3;
+    int key=event->modifiers().testFlag(Qt::ControlModifier)?10:0;
+    
+    trace(3,"FormKeyDown:\n");
+    
     switch (event->key()) {
-    case Qt::Key_Up: key += 1; break;
-    case Qt::Key_Down: key += 2; break;
-    case Qt::Key_Left: key += 3; break;
-    case Qt::Key_Right: key += 4; break;
-    default: return;
+        case Qt::Key_Up   : key+=1; break;
+        case Qt::Key_Down : key+=2; break;
+        case Qt::Key_Left : key+=3; break;
+        case Qt::Key_Right: key+=4; break;
+        default: return;
     }
     if (event->modifiers().testFlag(Qt::AltModifier)) return;
-
-    if (PlotType == PLOT_TRK) {
-        GraphT->GetCent(xc, yc);
-        GraphT->GetScale(xs, ys);
-        if (key == 1) {
-            if (!MenuFixHoriz->isChecked()) yc += fact * ys;
-        }
-        if (key == 2) {
-            if (!MenuFixHoriz->isChecked()) yc -= fact * ys;
-        }
-        if (key == 3) {
-            if (!MenuFixHoriz->isChecked()) xc -= fact * xs;
-        }
-        if (key == 4) {
-            if (!MenuFixHoriz->isChecked()) xc += fact * xs;
-        }
-        if (key == 11) {
-            xs /= sfact; ys /= sfact;
-        }
-        if (key == 12) {
-            xs *= sfact; ys *= sfact;
-        }
-        GraphT->SetCent(xc, yc);
-        GraphT->SetScale(xs, ys);
-    } else if (PlotType <= PLOT_NSAT || PlotType == PLOT_RES) {
-        GraphG[0]->GetCent(xc, yc1);
-        GraphG[1]->GetCent(xc, yc2);
-        GraphG[2]->GetCent(xc, yc3);
-        GraphG[0]->GetScale(xs, ys1);
-        GraphG[1]->GetScale(xs, ys2);
-        GraphG[2]->GetScale(xs, ys3);
-        if (key == 1) {
-            if (!MenuFixVert->isChecked()) yc1 += fact * ys1;
-            yc2 += fact * ys2;
-            yc3 += fact * ys3;
-        }
-        if (key == 2) {
-            if (!MenuFixVert->isChecked()) yc1 -= fact * ys1;
-            yc2 -= fact * ys2;
-            yc3 -= fact * ys3;
-        }
-        if (key == 3) {
-            if (!MenuFixHoriz->isChecked()) xc -= fact * xs;
-        }
-        if (key == 4) {
-            if (!MenuFixHoriz->isChecked()) xc += fact * xs;
-        }
-        if (key == 11) {
-            ys1 /= sfact;
-            ys2 /= sfact;
-            ys3 /= sfact;
-        }
-        if (key == 12) {
-            ys1 *= sfact;
-            ys2 *= sfact;
-            ys3 *= sfact;
-        }
-        if (key == 13) xs *= sfact;
-        if (key == 14) xs /= sfact;
-        GraphG[0]->SetCent(xc, yc1);
-        GraphG[1]->SetCent(xc, yc2);
-        GraphG[2]->SetCent(xc, yc3);
-        GraphG[0]->SetScale(xs, ys1);
-        GraphG[1]->SetScale(xs, ys2);
-        GraphG[2]->SetScale(xs, ys3);
-    } else if (PlotType == PLOT_OBS || PlotType == PLOT_DOP || PlotType == PLOT_SNR) {
-        GraphR->GetCent(xc, yc);
-        GraphR->GetScale(xs, ys);
-        if (key == 1) {
-            if (!MenuFixVert->isChecked()) yc += fact * ys;
-        }
-        if (key == 2) {
-            if (!MenuFixVert->isChecked()) yc -= fact * ys;
-        }
-        if (key == 3) {
-            if (!MenuFixHoriz->isChecked()) xc -= fact * xs;
-        }
-        if (key == 4) {
-            if (!MenuFixHoriz->isChecked()) xc += fact * xs;
-        }
-        if (key == 11) ys /= sfact;
-        if (key == 12) xs *= sfact;
-        if (key == 13) xs *= sfact;
-        if (key == 14) xs /= sfact;
-        GraphR->SetCent(xc, yc);
-        GraphR->SetScale(xs, ys);
+    
+    if (PlotType==PLOT_TRK) {
+        GraphT->GetCent(xc,yc);
+        GraphT->GetScale(xs,ys);
+        if (key== 1) {if (!MenuFixHoriz->isChecked()) yc+=fact*ys;}
+        if (key== 2) {if (!MenuFixHoriz->isChecked()) yc-=fact*ys;}
+        if (key== 3) {if (!MenuFixHoriz->isChecked()) xc-=fact*xs;}
+        if (key== 4) {if (!MenuFixHoriz->isChecked()) xc+=fact*xs;}
+        if (key==11) {xs/=sfact; ys/=sfact;}
+        if (key==12) {xs*=sfact; ys*=sfact;}
+        GraphT->SetCent(xc,yc);
+        GraphT->SetScale(xs,ys);
+    }
+    else if (PlotType<=PLOT_NSAT||PlotType==PLOT_RES) {
+        GraphG[0]->GetCent(xc,yc1);
+        GraphG[1]->GetCent(xc,yc2);
+        GraphG[2]->GetCent(xc,yc3);
+        GraphG[0]->GetScale(xs,ys1);
+        GraphG[1]->GetScale(xs,ys2);
+        GraphG[2]->GetScale(xs,ys3);
+        if (key== 1) {if (!MenuFixVert ->isChecked()) yc1+=fact*ys1; yc2+=fact*ys2; yc3+=fact*ys3;}
+        if (key== 2) {if (!MenuFixVert ->isChecked()) yc1-=fact*ys1; yc2-=fact*ys2; yc3-=fact*ys3;}
+        if (key== 3) {if (!MenuFixHoriz->isChecked()) xc-=fact*xs;}
+        if (key== 4) {if (!MenuFixHoriz->isChecked()) xc+=fact*xs;}
+        if (key==11) {ys1/=sfact; ys2/=sfact; ys3/=sfact;}
+        if (key==12) {ys1*=sfact; ys2*=sfact; ys3*=sfact;}
+        if (key==13) xs*=sfact;
+        if (key==14) xs/=sfact;
+        GraphG[0]->SetCent(xc,yc1);
+        GraphG[1]->SetCent(xc,yc2);
+        GraphG[2]->SetCent(xc,yc3);
+        GraphG[0]->SetScale(xs,ys1);
+        GraphG[1]->SetScale(xs,ys2);
+        GraphG[2]->SetScale(xs,ys3);
+    }
+    else if (PlotType==PLOT_OBS||PlotType==PLOT_DOP||PlotType==PLOT_SNR) {
+        GraphR->GetCent(xc,yc);
+        GraphR->GetScale(xs,ys);
+        if (key== 1) {if (!MenuFixVert ->isChecked()) yc+=fact*ys;}
+        if (key== 2) {if (!MenuFixVert ->isChecked()) yc-=fact*ys;}
+        if (key== 3) {if (!MenuFixHoriz->isChecked()) xc-=fact*xs;}
+        if (key== 4) {if (!MenuFixHoriz->isChecked()) xc+=fact*xs;}
+        if (key==11) ys/=sfact;
+        if (key==12) xs*=sfact;
+        if (key==13) xs*=sfact;
+        if (key==14) xs/=sfact;
+        GraphR->SetCent(xc,yc);
+        GraphR->SetScale(xs,ys);
     }
     Refresh();
 }
 // callback on interval-timer -----------------------------------------------
 void Plot::TimerTimer()
 {
-    const QColor color[] = { Qt::red, Qt::gray, QColor(0x00, 0xAA, 0xFF), Qt::green, QColor(0x00, 0xff, 0x00) };
-    QLabel *strstatus[] = { StrStatus1, StrStatus2 };
-    Console *console[] = { Console1, Console2 };
-    QString connectmsg = "";
+    const QColor color[]={Qt::red,Qt::gray,QColor(0x00,0xAA,0xFF),Qt::green,QColor(0x00,0xff,0x00)};
+    QLabel *strstatus[]={StrStatus1,StrStatus2};
+    Console *console[]={Console1,Console2};
+    QString connectmsg="";
     static unsigned char buff[16384];
-    solopt_t opt = solopt_default;
-    sol_t *sol;
-    const gtime_t ts = { 0, 0 };
-    gtime_t time = {0, 0};
-    double tint = TimeEna[2]?TimeInt:0.0, pos[3], ep[6];
-    int i, j, n, inb, inr, cycle, nmsg[2] = { 0 }, stat, istat;
-    int sel = !BtnSol1->isChecked() && BtnSol2->isChecked() ? 1 : 0;
-    char msg[MAXSTRMSG] = "";
-
-    trace(4, "TimeTimer\n");
-
+    solopt_t opt=solopt_default;
+    const gtime_t ts={0,0};
+    double tint=TimeEna[2]?TimeInt:0.0,pos[3];
+    int i,j,n,inb,inr,cycle,nmsg[2]={0},stat,istat;
+    int sel=!BtnSol1->isChecked()&&BtnSol2->isChecked()?1:0;
+    char msg[MAXSTRMSG]="";
+    
+    trace(4,"TimeTimer\n");
+    
     if (ConnectState) { // real-time input mode
-        for (i = 0; i < 2; i++) {
-            opt.posf = RtFormat[i];
-            opt.times = RtTimeForm == 0 ? 0 : RtTimeForm - 1;
-            opt.timef = RtTimeForm >= 1;
-            opt.degf = RtDegForm;
-            strcpy(opt.sep, qPrintable(RtFieldSep));
-            strsum(Stream + i, &inb, &inr, NULL, NULL);
-            stat = strstat(Stream + i, msg);
-            strstatus[i]->setStyleSheet(QStringLiteral("QLabel {color %1;}").arg(color2String(color[stat < 3 ? stat + 1 : 3])));
-            if (*msg && strcmp(msg, "localhost"))
-                connectmsg += QStringLiteral("(%1) %2 ").arg(i + 1).arg(msg);
-            while ((n = strread(Stream + i, buff, sizeof(buff))) > 0) {
-                for (j = 0; j < n; j++) {
-                    istat = inputsol(buff[j], ts, ts, tint, 0, &opt, SolData + i);
-                    if (istat == 0) continue;
-                    if (istat < 0) { // disconnect received
+        for (i=0;i<2;i++) {
+            opt.posf =RtFormat[i];
+            opt.times=RtTimeForm==0?0:RtTimeForm-1;
+            opt.timef=RtTimeForm>=1;
+            opt.degf =RtDegForm;
+            strcpy(opt.sep,qPrintable(RtFieldSep));
+            strsum(Stream+i,&inb,&inr,NULL,NULL);
+            stat=strstat(Stream+i,msg);
+            strstatus[i]->setStyleSheet(QStringLiteral("QLabel {color %1;}").arg(color2String(color[stat<3?stat+1:3])));
+            if (*msg&&strcmp(msg,"localhost")) {
+                connectmsg+=QStringLiteral("(%1) %2 ").arg(i+1).arg(msg);
+            }
+            while ((n=strread(Stream+i,buff,sizeof(buff)))>0) {
+                
+                for (j=0;j<n;j++) {
+                    istat=inputsol(buff[j],ts,ts,tint,0,&opt,SolData+i);
+                    if (istat==0) continue;
+                    if (istat<0) { // disconnect received
                         Disconnect();
                         return;
                     }
-                    if (Week == 0 && SolData[i].n == 1) { // first data
-                        if (PlotType > PLOT_NSAT)
+                    if (Week==0&&SolData[i].n==1) { // first data
+                        if (PlotType>PLOT_NSAT) {
                             UpdateType(PLOT_TRK);
-                        time2gpst(SolData[i].time, &Week);
+                        }
+                        time2gpst(SolData[i].time,&Week);
                         UpdateOrigin();
-                        ecef2pos(SolData[i].data[0].rr, pos);
+                        ecef2pos(SolData[i].data[0].rr,pos);
 //                        googleEarthView->SetView(pos[0]*R2D,pos[1]*R2D,0.0,0.0);
 //                        googleMapView->SetView(pos[0]*R2D,pos[1]*R2D,13);
                     }
                     nmsg[i]++;
                 }
-                console[i]->AddMsg(buff, n);
+                console[i]->AddMsg(buff,n);
             }
-            if (nmsg[i] > 0) {
+            if (nmsg[i]>0) {
                 strstatus[i]->setStyleSheet(QStringLiteral("QLabel {color %1;}").arg(color2String(color[4])));
-                SolIndex[i] = SolData[i].n - 1;
+                SolIndex[i]=SolData[i].n-1;
             }
         }
         ConnectMsg->setText(connectmsg);
-
-        if (nmsg[0] <= 0 && nmsg[1] <= 0) return;
-    } else if (BtnAnimate->isEnabled() && BtnAnimate->isChecked()) { // animation mode
-        cycle = AnimCycle <= 0 ? 1 : AnimCycle;
-
-        if (PlotType <= PLOT_NSAT || PlotType == PLOT_RES) {
-            SolIndex[sel] += cycle;
-            if (SolIndex[sel] >= SolData[sel].n - 1) {
-                SolIndex[sel] = SolData[sel].n - 1;
-                BtnAnimate->setChecked(false);
-            }
-        } else {
-            ObsIndex += cycle;
-            if (ObsIndex >= NObs - 1) {
-                ObsIndex = NObs - 1;
+        
+        if (nmsg[0]<=0&&nmsg[1]<=0) return;
+    }
+    else if (BtnAnimate->isEnabled()&&BtnAnimate->isChecked()) { // animation mode
+        cycle=AnimCycle<=0?1:AnimCycle;
+        
+        if (PlotType<=PLOT_NSAT||PlotType==PLOT_RES) {
+            SolIndex[sel]+=cycle;
+            if (SolIndex[sel]>=SolData[sel].n-1) {
+                SolIndex[sel]=SolData[sel].n-1;
                 BtnAnimate->setChecked(false);
             }
         }
-    } else if (TimeSyncOut) { // time sync
-        time.time = 0;
-        while (strread(&StrTimeSync, (unsigned char *)StrBuff + NStrBuff, 1)) {
-            if (++NStrBuff >= 1023) {
-                NStrBuff = 0;
-                continue;
-            }
-            if (StrBuff[NStrBuff-1] == '\n') {
-                StrBuff[NStrBuff-1] = '\0';
-                if (sscanf(StrBuff,"%lf/%lf/%lf %lf:%lf:%lf",ep,ep+1,ep+2,
-                           ep+3,ep+4,ep+5)>=6) {
-                    time=epoch2time(ep);
-                }
-                NStrBuff = 0;
+        else {
+            ObsIndex+=cycle;
+            if (ObsIndex>=NObs-1) {
+                ObsIndex=NObs-1;
+                BtnAnimate->setChecked(false);
             }
         }
-        if (time.time && (PlotType <= PLOT_NSAT || PlotType <= PLOT_RES)) {
-           i = SolIndex[sel];
-           if (!(sol = getsol(SolData + sel, i))) return;
-           double tt = timediff(sol->time, time);
-           if (tt < -DTTOL) {
-               for (;i < SolData[sel].n; i++) {
-                   if (!(sol = getsol(SolData + sel,i))) continue;
-                   if (timediff(sol->time, time) >= -DTTOL) {
-                       i--;
-                       break;
-                   }
-               }
-           } else if (tt > DTTOL) {
-               for (;i >= 0; i--) {
-                   if (!(sol = getsol(SolData + sel,i))) continue;
-                   if (timediff(sol->time, time) <= DTTOL) break;
-               }
-           }
-           SolIndex[sel] = MAX(0, MIN(SolData[sel].n - 1, i));
-        }
-        else return;
-    }
-    else {
-        return;
     }
-
+    else return;
+    
     UpdateTime();
-
-    if (updateTime.elapsed() < RefreshTime) return;
-    updateTime.restart();
-
     UpdatePlot();
 }
 // set center of x-axis -----------------------------------------------------
 void Plot::SetCentX(double c)
 {
-    double x, y;
+    double x,y;
     int i;
-
-    trace(3, "SetCentX: c=%.3f:\n", c);
-
-    GraphR->GetCent(x, y);
-    GraphR->SetCent(c, y);
-    for (i = 0; i < 3; i++) {
-        GraphG[i]->GetCent(x, y);
-        GraphG[i]->SetCent(c, y);
+    
+    trace(3,"SetCentX: c=%.3f:\n",c);
+    
+    GraphR->GetCent(x,y);
+    GraphR->SetCent(c,y);
+    for (i=0;i<3;i++) {
+        GraphG[i]->GetCent(x,y);
+        GraphG[i]->SetCent(c,y);
     }
 }
 // set scale of x-axis ------------------------------------------------------
 void Plot::SetScaleX(double s)
 {
-    double xs, ys;
+    double xs,ys;
     int i;
-
-    trace(3, "SetScaleX: s=%.3f:\n", s);
-
-    GraphR->GetScale(xs, ys);
-    GraphR->SetScale(s, ys);
-    for (i = 0; i < 3; i++) {
-        GraphG[i]->GetScale(xs, ys);
+    
+    trace(3,"SetScaleX: s=%.3f:\n",s);
+    
+    GraphR->GetScale(xs,ys);
+    GraphR->SetScale(s ,ys);
+    for (i=0;i<3;i++) {
+        GraphG[i]->GetScale(xs,ys);
         GraphG[i]->SetScale(s, ys);
     }
 }
 // update plot-type with fit-range ------------------------------------------
 void Plot::UpdateType(int type)
 {
-    trace(3, "UpdateType: type=%d\n", type);
-
-    PlotType = type;
-
-    if (AutoScale && PlotType <= PLOT_SOLA && (SolData[0].n > 0 || SolData[1].n > 0))
+    trace(3,"UpdateType: type=%d\n",type);
+    
+    PlotType=type;
+    
+    if (AutoScale&&PlotType<=PLOT_SOLA&&(SolData[0].n>0||SolData[1].n>0)) {
         FitRange(0);
-    else
-        SetRange(0, YRange);
+    }
+    else {
+        SetRange(0,YRange);
+    }
     UpdatePlotType();
 }
 // update size of plot ------------------------------------------------------
 void Plot::UpdateSize(void)
 {
-    QPushButton *btn[] = { BtnOn1, BtnOn2, BtnOn3 };
-    QPoint p1(0, 0), p2(Disp->width(), Disp->height());
-    double xs, ys;
-    int i, n, h, tmargin, bmargin, rmargin, lmargin;
-
-    trace(3, "UpdateSize\n");
-
-    tmargin = 5;                                                    // top margin
-    bmargin = static_cast<int>(Disp->font().pointSize() * 1.5) + 3; // bottom
-    rmargin = 8;                                                    // right
-    lmargin = Disp->font().pointSize() * 3 + 15;                    // left
-
+    QPushButton *btn[]={BtnOn1,BtnOn2,BtnOn3};
+    QPoint p1(0,0),p2(Disp->width(),Disp->height());
+    double xs,ys;
+    int i,n,h,tmargin,bmargin,rmargin,lmargin;
+    
+    trace(3,"UpdateSize\n");
+    
+    tmargin=5;                                     // top margin
+    bmargin=static_cast<int>(Disp->font().pointSize()*1.5)+3; // bottom
+    rmargin=8;                                     // right
+    lmargin=Disp->font().pointSize()*3+15;         // left
+    
     GraphT->resize();
     GraphS->resize();
     GraphR->resize();
-    for (int i = 0; i < 3; i++)
+    for (int i=0;i<3;i++)
         GraphG[i]->resize();
-    for (int i = 0; i < 2; i++)
+    for (int i=0;i<2;i++)
         GraphE[i]->resize();
 
-    GraphT->SetPos(p1, p2);
-    GraphS->SetPos(p1, p2);
-    GraphS->GetScale(xs, ys);
-    xs = MAX(xs, ys);
-    GraphS->SetScale(xs, xs);
-    p1.rx() += lmargin; p1.ry() += tmargin;
-    p2.rx() -= rmargin; p2.setY(p2.y() - bmargin);
-    GraphR->SetPos(p1, p2);
-
+    GraphT->SetPos(p1,p2);
+    GraphS->SetPos(p1,p2);
+    GraphS->GetScale(xs,ys);
+    xs=MAX(xs,ys);
+    GraphS->SetScale(xs,xs);
+    p1.rx()+=lmargin; p1.ry()+=tmargin;
+    p2.rx()-=rmargin; p2.setY(p2.y()-bmargin);
+    GraphR->SetPos(p1,p2);
+    
     p1.setY(tmargin); p2.setY(p1.y());
-    for (i = n = 0; i < 3; i++) if (btn[i]->isChecked()) n++;
-    for (i = 0; i < 3; i++) {
-        if (!btn[i]->isChecked() || (n <= 0)) continue;
-        if (n == 0) break;
-        h = (Disp->height() - tmargin - bmargin) / n;
-        p2.ry() += h;
-        GraphG[i]->SetPos(p1, p2);
-        p1.ry() += h;
+    for (i=n=0;i<3;i++) if (btn[i]->isChecked()) n++;
+    for (i=0;i<3;i++) {
+        if (!btn[i]->isChecked()) continue;
+        if (n==0) break;
+        h=(Disp->height()-tmargin-bmargin)/n;
+        p2.ry()+=h;
+        GraphG[i]->SetPos(p1,p2);
+        p1.ry()+=h;
     }
     p1.setY(tmargin); p2.setY(p1.y());
-    for (i = n = 0; i < 2; i++) if (btn[i]->isChecked()) n++;
-    for (i = 0; i < 2; i++) {
-        if (!btn[i]->isChecked() || (n <= 0)) continue;
-        if (n == 0) break;
-        h = (Disp->height() - tmargin - bmargin) / n;
-        p2.ry() += h;
-        GraphE[i]->SetPos(p1, p2);
-        p1.ry() += h;
+    for (i=n=0;i<2;i++) if (btn[i]->isChecked()) n++;
+    for (i=0;i<2;i++) {
+        if (!btn[i]->isChecked()) continue;
+        if (n==0) break;
+        h=(Disp->height()-tmargin-bmargin)/n;
+        p2.ry()+=h;
+        GraphE[i]->SetPos(p1,p2);
+        p1.ry()+=h;
     }
 }
 // update colors on plot ----------------------------------------------------
 void Plot::UpdateColor(void)
 {
     int i;
-
-    trace(3, "UpdateColor\n");
-
-    for (i = 0; i < 3; i++) {
-        GraphT->Color[i] = CColor[i];
-        GraphR->Color[i] = CColor[i];
-        GraphS->Color[i] = CColor[i];
-        GraphG[0]->Color[i] = CColor[i];
-        GraphG[1]->Color[i] = CColor[i];
-        GraphG[2]->Color[i] = CColor[i];
+    
+    trace(3,"UpdateColor\n");
+    
+    for (i=0;i<3;i++) {
+        GraphT   ->Color[i]=CColor[i];
+        GraphR   ->Color[i]=CColor[i];
+        GraphS   ->Color[i]=CColor[i];
+        GraphG[0]->Color[i]=CColor[i];
+        GraphG[1]->Color[i]=CColor[i];
+        GraphG[2]->Color[i]=CColor[i];
     }
     Disp->setFont(Font);
 }
@@ -2238,833 +2077,835 @@
     gtime_t time;
     sol_t *sol;
     double tt;
-    int i, sel = !BtnSol1->isChecked() && BtnSol2->isChecked() ? 1 : 0;
-
-    trace(3, "UpdateTime\n");
-
+    int i,sel=!BtnSol1->isChecked()&&BtnSol2->isChecked()?1:0;
+    
+    trace(3,"UpdateTime\n");
+    
     // time-cursor change on solution-plot
-    if (PlotType <= PLOT_NSAT || PlotType <= PLOT_RES) {
-        TimeScroll->setMaximum(MAX(1, SolData[sel].n - 1));
+    if (PlotType<=PLOT_NSAT||PlotType<=PLOT_RES) {
+        TimeScroll->setMaximum(MAX(1,SolData[sel].n-1));
         TimeScroll->setValue(SolIndex[sel]);
-        if (!(sol = getsol(SolData + sel, SolIndex[sel]))) return;
-        time = sol->time;
-    } else if (NObs > 0) { // time-cursor change on observation-data-plot
-        TimeScroll->setMaximum(MAX(1, NObs - 1));
+        if (!(sol=getsol(SolData+sel,SolIndex[sel]))) return;
+        time=sol->time;
+    }
+    else if (NObs>0) { // time-cursor change on observation-data-plot
+        TimeScroll->setMaximum(MAX(1,NObs-1));
         TimeScroll->setValue(ObsIndex);
-        time = Obs.data[IndexObs[ObsIndex]].time;
-    } else {
-        return;
+        time=Obs.data[IndexObs[ObsIndex]].time;
     }
-
+    else return;
+    
     // time-synchronization between solutions and observation-data
-    for (sel = 0; sel < 2; sel++) {
-        i = SolIndex[sel];
-        if (!(sol = getsol(SolData + sel, i))) continue;
-        tt = timediff(sol->time, time);
-        if (tt < -DTTOL) {
-            for (; i < SolData[sel].n; i++) {
-                if (!(sol = getsol(SolData + sel, i))) continue;
-                if (timediff(sol->time, time) >= -DTTOL) break;
-            }
-        } else if (tt > DTTOL) {
-            for (; i >= 0; i--) {
-                if (!(sol = getsol(SolData + sel, i))) continue;
-                if (timediff(sol->time, time) <= DTTOL) break;
+    for (sel=0;sel<2;sel++) {
+       i=SolIndex[sel];
+       if (!(sol=getsol(SolData+sel,i))) continue;
+       tt=timediff(sol->time,time);
+       if (tt<-DTTOL) {
+           for (;i<SolData[sel].n;i++) {
+               if (!(sol=getsol(SolData+sel,i))) continue;
+               if (timediff(sol->time,time)>=-DTTOL) break;
+           }
+       }
+       else if (tt>DTTOL) {
+           for (;i>=0;i--) {
+               if (!(sol=getsol(SolData+sel,i))) continue;
+               if (timediff(sol->time,time)<=DTTOL) break;
+           }
+       }
+       SolIndex[sel]=MAX(0,MIN(SolData[sel].n-1,i));
+    }
+    i=ObsIndex;
+    if (i<=NObs-1) {
+        tt=timediff(Obs.data[IndexObs[i]].time,time);
+        if (tt<-DTTOL) {
+            for (;i<NObs;i++) {
+                if (timediff(Obs.data[IndexObs[i]].time,time)>=-DTTOL) break;
             }
         }
-        SolIndex[sel] = MAX(0, MIN(SolData[sel].n - 1, i));
-    }
-    i = ObsIndex;
-    if (i <= NObs - 1) {
-        tt = timediff(Obs.data[IndexObs[i]].time, time);
-        if (tt < -DTTOL) {
-            for (; i < NObs; i++)
-                if (timediff(Obs.data[IndexObs[i]].time, time) >= -DTTOL) break;
-        } else if (tt > DTTOL) {
-            for (; i >= 0; i--)
-                if (timediff(Obs.data[IndexObs[i]].time, time) <= DTTOL) break;
+        else if (tt>DTTOL) {
+            for (;i>=0;i--) {
+                if (timediff(Obs.data[IndexObs[i]].time,time)<=DTTOL) break;
+            }
         }
-        ObsIndex = MAX(0, MIN(NObs - 1, i));
+        ObsIndex=MAX(0,MIN(NObs-1,i));
     }
 }
 // update origin of plot ----------------------------------------------------
 void Plot::UpdateOrigin(void)
 {
-    gtime_t time = { 0, 0 };
+    gtime_t time={0,0};
     sol_t *sol;
-    double opos[3] = { 0 }, pos[3], ovel[3] = { 0 };
-    int i, j, n = 0, sel = !BtnSol1->isChecked() && BtnSol2->isChecked() ? 1 : 0;
+    double opos[3]={0},pos[3],ovel[3]={0};
+    int i,j,n=0,sel=!BtnSol1->isChecked()&&BtnSol2->isChecked()?1:0;
     QString sta;
-
-    trace(3, "UpdateOrigin\n");
-
-    if (Origin == ORG_STARTPOS) {
-        if (!(sol = getsol(SolData, 0)) || sol->type != 0) return;
-        for (i = 0; i < 3; i++) opos[i] = sol->rr[i];
-    } else if (Origin == ORG_ENDPOS) {
-        if (!(sol = getsol(SolData, SolData[0].n - 1)) || sol->type != 0) return;
-        for (i = 0; i < 3; i++) opos[i] = sol->rr[i];
-    } else if (Origin == ORG_AVEPOS) {
-        for (i = 0; (sol = getsol(SolData, i)) != NULL; i++) {
-            if (sol->type != 0) continue;
-            for (j = 0; j < 3; j++) opos[j] += sol->rr[j];
+    
+    trace(3,"UpdateOrigin\n");
+    
+    if (Origin==ORG_STARTPOS) {
+        if (!(sol=getsol(SolData,0))||sol->type!=0) return;
+        for (i=0;i<3;i++) opos[i]=sol->rr[i];
+    }
+    else if (Origin==ORG_ENDPOS) {
+        if (!(sol=getsol(SolData,SolData[0].n-1))||sol->type!=0) return;
+        for (i=0;i<3;i++) opos[i]=sol->rr[i];
+    }
+    else if (Origin==ORG_AVEPOS) {
+        for (i=0;(sol=getsol(SolData,i))!=NULL;i++) {
+            if (sol->type!=0) continue;
+            for (j=0;j<3;j++) opos[j]+=sol->rr[j];
             n++;
         }
-        if (n > 0) for (i = 0; i < 3; i++) opos[i] /= n;
-    } else if (Origin == ORG_FITPOS) {
-        if (!FitPos(&time, opos, ovel)) return;
-    } else if (Origin == ORG_REFPOS) {
-        if (norm(SolData[0].rb, 3) > 0.0) {
-            for (i = 0; i < 3; i++) opos[i] = SolData[0].rb[i];
-        } else {
-            if (!(sol = getsol(SolData, 0)) || sol->type != 0) return;
-            for (i = 0; i < 3; i++) opos[i] = sol->rr[i];
+        if (n>0) for (i=0;i<3;i++) opos[i]/=n;
+    }
+    else if (Origin==ORG_FITPOS) {
+        if (!FitPos(&time,opos,ovel)) return;
+    }
+    else if (Origin==ORG_REFPOS) {
+        if (norm(SolData[0].rb,3)>0.0) {
+            for (i=0;i<3;i++) opos[i]=SolData[0].rb[i];
         }
-    } else if (Origin == ORG_LLHPOS) {
-        pos2ecef(OOPos, opos);
-    } else if (Origin == ORG_AUTOPOS) {
-        if (SolFiles[sel].count() > 0) {
+        else {
+            if (!(sol=getsol(SolData,0))||sol->type!=0) return;
+            for (i=0;i<3;i++) opos[i]=sol->rr[i];
+        }
+    }
+    else if (Origin==ORG_LLHPOS) {
+        pos2ecef(OOPos,opos);
+    }
+    else if (Origin==ORG_AUTOPOS) {
+        if (SolFiles[sel].count()>0) {
+            
             QFileInfo fi(SolFiles[sel].at(0));
-
-            ReadStaPos(fi.baseName().left(4).toUpper(), sta, opos);
+            
+            ReadStaPos(fi.baseName().left(4).toUpper(),sta,opos);
         }
-    } else if (Origin == ORG_IMGPOS) {
-        pos[0] = MapLat * D2R;
-        pos[1] = MapLon * D2R;
-        pos[2] = 0.0;
-        pos2ecef(pos, opos);
-    } else if (Origin == ORG_MAPPOS) {
-        pos[0] = (Gis.bound[0] + Gis.bound[1]) / 2.0;
-        pos[1] = (Gis.bound[2] + Gis.bound[3]) / 2.0;
-        pos[2] = 0.0;
-        pos2ecef(pos, opos);
-    } else if (Origin - ORG_PNTPOS < MAXWAYPNT) {
-        for (i = 0; i < 3; i++) opos[i] = PntPos[Origin - ORG_PNTPOS][i];
     }
-    if (norm(opos, 3) <= 0.0) {
+    else if (Origin==ORG_IMGPOS) {
+        pos[0]=MapLat*D2R;
+        pos[1]=MapLon*D2R;
+        pos[2]=0.0;
+        pos2ecef(pos,opos);
+    }
+    else if (Origin==ORG_MAPPOS) {
+        pos[0]=(Gis.bound[0]+Gis.bound[1])/2.0;
+        pos[1]=(Gis.bound[2]+Gis.bound[3])/2.0;
+        pos[2]=0.0;
+        pos2ecef(pos,opos);
+    }
+    else if (Origin-ORG_PNTPOS<MAXWAYPNT) {
+        for (i=0;i<3;i++) opos[i]=PntPos[Origin-ORG_PNTPOS][i];
+    }
+    if (norm(opos,3)<=0.0) {
         // default start position
-        if (!(sol = getsol(SolData, 0)) || sol->type != 0) return;
-        for (i = 0; i < 3; i++) opos[i] = sol->rr[i];
+        if (!(sol=getsol(SolData,0))||sol->type!=0) return;
+        for (i=0;i<3;i++) opos[i]=sol->rr[i];
     }
-    OEpoch = time;
-    for (i = 0; i < 3; i++) {
-        OPos[i] = opos[i];
-        OVel[i] = ovel[i];
+    OEpoch=time;
+    for (i=0;i<3;i++) {
+        OPos[i]=opos[i];
+        OVel[i]=ovel[i];
     }
-    Refresh_GEView();
+    ecef2pos(OPos,pos);
+    googleEarthView->SetView(pos[0]*R2D,pos[1]*R2D,0.0,0.0);
+    googleMapView->SetView(pos[0]*R2D,pos[1]*R2D,13);
 }
 // update satellite mask ----------------------------------------------------
 void Plot::UpdateSatMask(void)
 {
-    int sat, prn;
-    char buff[256], *p;
-
-    trace(3, "UpdateSatMask\n");
-
-    for (sat = 1; sat <= MAXSAT; sat++) SatMask[sat - 1] = 0;
-    for (sat = 1; sat <= MAXSAT; sat++)
-        if (!(satsys(sat, &prn) & NavSys)) SatMask[sat - 1] = 1;
-    if (ExSats != "") {
-        strcpy(buff, qPrintable(ExSats));
-
-        for (p = strtok(buff, " "); p; p = strtok(NULL, " ")) {
-            if (*p == '+' && (sat = satid2no(p + 1))) SatMask[sat - 1] = 0; // included
-            else if ((sat = satid2no(p))) SatMask[sat - 1] = 1;             // excluded
+    int sat,prn;
+    char buff[256],*p;
+    
+    trace(3,"UpdateSatMask\n");
+    
+    for (sat=1;sat<=MAXSAT;sat++) SatMask[sat-1]=0;
+    for (sat=1;sat<=MAXSAT;sat++) {
+        if (!(satsys(sat,&prn)&NavSys)) SatMask[sat-1]=1;
+    }
+    if (ExSats!="") {
+        strcpy(buff,qPrintable(ExSats));
+        
+        for (p=strtok(buff," ");p;p=strtok(NULL," ")) {
+            if (*p=='+'&&(sat=satid2no(p+1))) SatMask[sat-1]=0; // included
+            else if ((sat=satid2no(p)))       SatMask[sat-1]=1; // excluded
         }
     }
 }
 // update satellite select ---------------------------------------------------
 void Plot::UpdateSatSel(void)
 {
-    QString SatListText = SatList->currentText();
+    QString SatListText=SatList->currentText();
     char id[16];
-    int i, sys = 0;
-
-    if (SatListText == "G") sys = SYS_GPS;
-    else if (SatListText == "R") sys = SYS_GLO;
-    else if (SatListText == "E") sys = SYS_GAL;
-    else if (SatListText == "J") sys = SYS_QZS;
-    else if (SatListText == "C") sys = SYS_CMP;
-    else if (SatListText == "S") sys = SYS_SBS;
-
-    for (i = 0; i < MAXSAT; i++) {
-        satno2id(i + 1, id);
-        SatSel[i] = SatListText == "ALL" || SatListText == id || satsys(i + 1, NULL) == sys;
+    int i,sys=0;
+    
+    if      (SatListText=="G") sys=SYS_GPS;
+    else if (SatListText=="R") sys=SYS_GLO;
+    else if (SatListText=="E") sys=SYS_GAL;
+    else if (SatListText=="J") sys=SYS_QZS;
+    else if (SatListText=="C") sys=SYS_CMP;
+    else if (SatListText=="S") sys=SYS_SBS;
+    for (i=0;i<MAXSAT;i++) {
+        satno2id(i+1,id);
+        SatSel[i]=SatListText=="ALL"||SatListText==id||satsys(i+1,NULL)==sys;
     }
 }
 // update enable/disable of widgets -----------------------------------------
 void Plot::UpdateEnable(void)
 {
-    bool data = BtnSol1->isChecked() || BtnSol2->isChecked() || BtnSol12->isChecked();
-    bool plot = (PLOT_SOLP <= PlotType) && (PlotType <= PLOT_NSAT);
-    bool sel = (!BtnSol1->isChecked()) && (BtnSol2->isChecked()) ? 1 : 0;
-
-    trace(3, "UpdateEnable\n");
-
-    Panel1->setVisible(MenuToolBar->isChecked());
-    Panel21->setVisible(MenuStatusBar->isChecked());
-
-    MenuConnect->setChecked(ConnectState);
-    BtnSol2->setEnabled(PlotType <= PLOT_NSAT || PlotType == PLOT_RES);
-    BtnSol12->setEnabled(!ConnectState && PlotType <= PLOT_SOLA && SolData[0].n > 0 && SolData[1].n > 0);
-
-    QFlag->setVisible(PlotType == PLOT_TRK || PlotType == PLOT_SOLP ||
-              PlotType == PLOT_SOLV || PlotType == PLOT_SOLA ||
-              PlotType == PLOT_NSAT);
-    ObsType->setVisible(PlotType == PLOT_OBS || PlotType <= PLOT_SKY);
-    ObsType2->setVisible(PlotType == PLOT_SNR || PlotType == PLOT_SNRE || PlotType == PLOT_MPS);
-
-    FrqType->setVisible(PlotType == PLOT_RES);
-    DopType->setVisible(PlotType == PLOT_DOP);
-    SatList->setVisible(PlotType == PLOT_RES || PlotType >= PLOT_OBS ||
-                PlotType == PLOT_SKY || PlotType == PLOT_DOP ||
-                PlotType == PLOT_SNR || PlotType == PLOT_SNRE ||
-                PlotType == PLOT_MPS);
-    QFlag->setEnabled(data);
-    ObsType->setEnabled(data && !SimObs);
-    ObsType2->setEnabled(data && !SimObs);
-
-    BtnOn1->setEnabled(plot || PlotType == PLOT_SNR || PlotType == PLOT_RES || PlotType == PLOT_SNRE);
-    BtnOn2->setEnabled(plot || PlotType == PLOT_SNR || PlotType == PLOT_RES || PlotType == PLOT_SNRE);
-    BtnOn3->setEnabled(plot || PlotType == PLOT_SNR || PlotType == PLOT_RES);
-
-    BtnCenterOri->setVisible(PlotType == PLOT_TRK || PlotType == PLOT_SOLP ||
-                 PlotType == PLOT_SOLV || PlotType == PLOT_SOLA ||
-                 PlotType == PLOT_NSAT);
-    BtnRangeList->setVisible(PlotType == PLOT_TRK || PlotType == PLOT_SOLP ||
-                 PlotType == PLOT_SOLV || PlotType == PLOT_SOLA ||
-                 PlotType == PLOT_NSAT);
-    BtnCenterOri->setEnabled(PlotType != PLOT_NSAT);
-    BtnRangeList->setEnabled(PlotType != PLOT_NSAT);
+    bool data=BtnSol1->isChecked()||BtnSol2->isChecked()||BtnSol12->isChecked();
+    bool plot=(PLOT_SOLP<=PlotType)&&(PlotType<=PLOT_NSAT);
+    bool sel=(!BtnSol1->isChecked())&&(BtnSol2->isChecked())?1:0;
+    
+    trace(3,"UpdateEnable\n");
+    
+    Panel1         ->setVisible(MenuToolBar  ->isChecked());
+    Panel21        ->setVisible(MenuStatusBar->isChecked());
+    
+    MenuConnect     ->setChecked(ConnectState);
+    BtnSol2        ->setEnabled(PlotType<=PLOT_NSAT||PlotType==PLOT_RES);
+    BtnSol12       ->setEnabled(!ConnectState&&PlotType<=PLOT_SOLA&&SolData[0].n>0&&SolData[1].n>0);
+    
+    QFlag          ->setVisible(PlotType==PLOT_TRK ||PlotType==PLOT_SOLP||
+                                PlotType==PLOT_SOLV||PlotType==PLOT_SOLA||
+                                PlotType==PLOT_NSAT);
+    ObsType        ->setVisible(PlotType==PLOT_OBS||PlotType<=PLOT_SKY);
+    ObsType2       ->setVisible(PlotType==PLOT_SNR||PlotType==PLOT_SNRE||PlotType==PLOT_MPS);
 
+    FrqType        ->setVisible(PlotType==PLOT_RES);
+    DopType        ->setVisible(PlotType==PLOT_DOP);
+    SatList        ->setVisible(PlotType==PLOT_RES||PlotType>=PLOT_OBS||
+                                PlotType==PLOT_SKY||PlotType==PLOT_DOP||
+                                PlotType==PLOT_SNR||PlotType==PLOT_SNRE||
+                                PlotType==PLOT_MPS);
+    QFlag          ->setEnabled(data);
+    ObsType        ->setEnabled(data&&!SimObs);
+    ObsType2       ->setEnabled(data&&!SimObs);
+    
+    BtnOn1         ->setEnabled(plot||PlotType==PLOT_SNR||PlotType==PLOT_RES||PlotType==PLOT_SNRE);
+    BtnOn2         ->setEnabled(plot||PlotType==PLOT_SNR||PlotType==PLOT_RES||PlotType==PLOT_SNRE);
+    BtnOn3         ->setEnabled(plot||PlotType==PLOT_SNR||PlotType==PLOT_RES);
+    
+    BtnCenterOri   ->setVisible(PlotType==PLOT_TRK ||PlotType==PLOT_SOLP||
+                                PlotType==PLOT_SOLV||PlotType==PLOT_SOLA||
+                                PlotType==PLOT_NSAT);
+    BtnRangeList   ->setVisible(PlotType==PLOT_TRK ||PlotType==PLOT_SOLP||
+                                PlotType==PLOT_SOLV||PlotType==PLOT_SOLA||
+                                PlotType==PLOT_NSAT);
+    BtnCenterOri   ->setEnabled(PlotType!=PLOT_NSAT);
+    BtnRangeList   ->setEnabled(PlotType!=PLOT_NSAT);
 
-    Panel102->setVisible(PlotType == PLOT_SOLP || PlotType == PLOT_SOLV ||
-                 PlotType == PLOT_SOLA || PlotType == PLOT_NSAT ||
-                 PlotType == PLOT_RES ||
-                 PlotType == PLOT_SNR || PlotType == PLOT_SNRE);
-    BtnFitHoriz->setVisible(PlotType == PLOT_SOLP || PlotType == PLOT_SOLV ||
-                PlotType == PLOT_SOLA || PlotType == PLOT_NSAT ||
-                PlotType == PLOT_RES || PlotType == PLOT_OBS ||
-                PlotType == PLOT_DOP || PlotType == PLOT_SNR ||
-                PlotType == PLOT_SNRE);
-    BtnFitVert->setVisible(PlotType == PLOT_TRK || PlotType == PLOT_SOLP ||
-                   PlotType == PLOT_SOLV || PlotType == PLOT_SOLA);
-    BtnFitHoriz->setEnabled(data);
-    BtnFitVert->setEnabled(data);
 
-    MenuShowTrack->setEnabled(data);
-    BtnFixCent->setVisible(PlotType == PLOT_TRK);
-    BtnFixHoriz->setVisible(PlotType == PLOT_SOLP || PlotType == PLOT_SOLV ||
-                PlotType == PLOT_SOLA || PlotType == PLOT_NSAT ||
-                PlotType == PLOT_RES || PlotType == PLOT_OBS ||
-                PlotType == PLOT_DOP || PlotType == PLOT_RES ||
-                PlotType == PLOT_SNR);
-    BtnFixVert->setVisible(PlotType == PLOT_SOLP || PlotType == PLOT_SOLV ||
-                   PlotType == PLOT_SOLA);
-    BtnFixCent->setEnabled(data);
-    BtnFixHoriz->setEnabled(data);
-    BtnFixVert->setEnabled(data);
-    BtnShowMap->setVisible(PlotType == PLOT_TRK);
-    BtnShowMap->setEnabled(!BtnSol12->isChecked());
-    BtnAnimate->setVisible(data && MenuShowTrack->isChecked());
-    TimeScroll->setVisible(data && MenuShowTrack->isChecked());
+    Panel102       ->setVisible(PlotType==PLOT_SOLP||PlotType==PLOT_SOLV||
+                                PlotType==PLOT_SOLA||PlotType==PLOT_NSAT||
+                                PlotType==PLOT_RES ||
+                                PlotType==PLOT_SNR ||PlotType==PLOT_SNRE);
+    BtnFitHoriz    ->setVisible(PlotType==PLOT_SOLP||PlotType==PLOT_SOLV||
+                                PlotType==PLOT_SOLA||PlotType==PLOT_NSAT||
+                                PlotType==PLOT_RES ||PlotType==PLOT_OBS ||
+                                PlotType==PLOT_DOP ||PlotType==PLOT_SNR ||
+                                PlotType==PLOT_SNRE);
+    BtnFitVert     ->setVisible(PlotType==PLOT_TRK ||PlotType==PLOT_SOLP||
+                                PlotType==PLOT_SOLV||PlotType==PLOT_SOLA);
+    BtnFitHoriz    ->setEnabled(data);
+    BtnFitVert     ->setEnabled(data);
+    
+    MenuShowTrack   ->setEnabled(data);
+    BtnFixCent     ->setVisible(PlotType==PLOT_TRK);
+    BtnFixHoriz    ->setVisible(PlotType==PLOT_SOLP||PlotType==PLOT_SOLV||
+                                PlotType==PLOT_SOLA||PlotType==PLOT_NSAT||
+                                PlotType==PLOT_RES ||PlotType==PLOT_OBS ||
+                                PlotType==PLOT_DOP ||PlotType==PLOT_RES ||
+                                PlotType==PLOT_SNR);
+    BtnFixVert     ->setVisible(PlotType==PLOT_SOLP||PlotType==PLOT_SOLV||
+                                PlotType==PLOT_SOLA);
+    BtnFixCent     ->setEnabled(data);
+    BtnFixHoriz    ->setEnabled(data);
+    BtnFixVert     ->setEnabled(data);
+    BtnShowMap     ->setVisible(PlotType==PLOT_TRK);
+    BtnShowMap     ->setEnabled(!BtnSol12->isChecked());
+    BtnAnimate     ->setVisible(data&&MenuShowTrack->isChecked());
+    TimeScroll     ->setVisible(data&&MenuShowTrack->isChecked());
 
 #if defined(QWEBKIT) || defined(QWEBENGINE)
-    MenuGE->setVisible(PlotType == PLOT_TRK);
-    MenuGM->setVisible(PlotType == PLOT_TRK);
+    MenuGE          ->setVisible(PlotType==PLOT_TRK);
+    MenuGM          ->setVisible(PlotType==PLOT_TRK);
 #endif
-
+    
     if (!MenuShowTrack->isChecked()) {
         MenuFixHoriz->setEnabled(false);
-        MenuFixVert->setEnabled(false);
-        MenuFixCent->setEnabled(false);
-        BtnAnimate->setChecked(false);
+        MenuFixVert ->setEnabled(false);
+        MenuFixCent ->setEnabled(false);
+        BtnAnimate ->setChecked(false);
     }
-    MenuMapImg->setEnabled(MapImage.height() > 0);
-    MenuSkyImg->setEnabled(SkyImageI.height() > 0);
-    MenuSrcSol->setEnabled(SolFiles[sel].count() > 0);
-    MenuSrcObs->setEnabled(ObsFiles.count() > 0);
-    MenuQcObs->setEnabled(ObsFiles.count() > 0);
-    int n = 0;
-    for (int i = 0; i < MAXMAPLAYER; i++)
+    MenuMapImg     ->setEnabled(MapImage.height()>0);
+    MenuSkyImg     ->setEnabled(SkyImageI.height()>0);
+    MenuSrcSol     ->setEnabled(SolFiles[sel].count()>0);
+    MenuSrcObs     ->setEnabled(ObsFiles.count()>0);
+    MenuQcObs      ->setEnabled(ObsFiles.count()>0);
+    int n=0;
+    for (int i=0;i<MAXMAPLAYER;i++) {
         if (Gis.data[i]) n++;
-    MenuMapLayer->setEnabled(n > 0);
+    }
+    MenuMapLayer   ->setEnabled(n>0);
 
     MenuShowSkyplot->setEnabled(MenuShowSkyplot->isVisible());
-
-    BtnShowImg->setVisible(PlotType == PLOT_TRK || PlotType == PLOT_SKY ||
-                   PlotType == PLOT_MPS);
-    BtnShowGrid->setVisible(PlotType==PLOT_TRK);
-    MenuAnimStart->setEnabled(!ConnectState && BtnAnimate->isEnabled() && !BtnAnimate->isChecked());
-    MenuAnimStop->setEnabled(!ConnectState && BtnAnimate->isEnabled() && BtnAnimate->isChecked());
-    TimeScroll->setEnabled(data && MenuShowTrack->isChecked());
-
-    MenuOpenSol1->setEnabled(!ConnectState);
-    MenuOpenSol2->setEnabled(!ConnectState);
-    MenuConnect->setEnabled(!ConnectState);
-    MenuDisconnect->setEnabled(ConnectState);
-    MenuPort->setEnabled(!ConnectState);
-    MenuOpenObs->setEnabled(!ConnectState);
-    MenuOpenNav->setEnabled(!ConnectState);
+    
+    BtnShowImg     ->setVisible(PlotType==PLOT_TRK||PlotType==PLOT_SKY||
+                                PlotType==PLOT_MPS);
+    MenuAnimStart  ->setEnabled(!ConnectState&&BtnAnimate->isEnabled()&&!BtnAnimate->isChecked());
+    MenuAnimStop   ->setEnabled(!ConnectState&&BtnAnimate->isEnabled()&& BtnAnimate->isChecked());
+    TimeScroll     ->setEnabled(data&&MenuShowTrack->isChecked());
+    
+    MenuOpenSol1   ->setEnabled(!ConnectState);
+    MenuOpenSol2   ->setEnabled(!ConnectState);
+    MenuConnect    ->setEnabled(!ConnectState);
+    MenuDisconnect ->setEnabled( ConnectState);
+    MenuPort       ->setEnabled(!ConnectState);
+    MenuOpenObs    ->setEnabled(!ConnectState);
+    MenuOpenNav    ->setEnabled(!ConnectState);
     MenuOpenElevMask->setEnabled(!ConnectState);
-    MenuReload->setEnabled(!ConnectState);
-
-    MenuReload->setVisible(!ConnectState);
-    StrStatus1->setVisible(ConnectState);
-    StrStatus2->setVisible(ConnectState);
-    Panel12->setVisible(!ConnectState);
+    MenuReload     ->setEnabled(!ConnectState);
+    
+    MenuReload     ->setVisible(!ConnectState);
+    StrStatus1     ->setVisible( ConnectState);
+    StrStatus2     ->setVisible( ConnectState);
+    Panel12        ->setVisible(!ConnectState);
 }
 // linear-fitting of positions ----------------------------------------------
 int Plot::FitPos(gtime_t *time, double *opos, double *ovel)
 {
     sol_t *sol;
-    int i, j;
-    double t, x[2], Ay[3][2] = { { 0 } }, AA[3][4] = { { 0 } };
-
-    trace(3, "FitPos\n");
-
-    if (SolData[0].n <= 0) return 0;
-
-    for (i = 0; (sol = getsol(SolData, i)) != NULL; i++) {
-        if (sol->type != 0) continue;
-        if (time->time == 0) *time = sol->time;
-        t = timediff(sol->time, *time);
-
-        for (j = 0; j < 3; j++) {
-            Ay[j][0] += sol->rr[j];
-            Ay[j][1] += sol->rr[j] * t;
-            AA[j][0] += 1.0;
-            AA[j][1] += t;
-            AA[j][2] += t;
-            AA[j][3] += t * t;
+    int i,j;
+    double t,x[2],Ay[3][2]={{0}},AA[3][4]={{0}};
+    
+    trace(3,"FitPos\n");
+    
+    if (SolData[0].n<=0) return 0;
+    
+    for (i=0;(sol=getsol(SolData,i))!=NULL;i++) {
+        if (sol->type!=0) continue;
+        if (time->time==0) *time=sol->time;
+        t=timediff(sol->time,*time);
+        
+        for (j=0;j<3;j++) {
+            Ay[j][0]+=sol->rr[j];
+            Ay[j][1]+=sol->rr[j]*t;
+            AA[j][0]+=1.0;
+            AA[j][1]+=t;
+            AA[j][2]+=t;
+            AA[j][3]+=t*t;
         }
     }
-    for (i = 0; i < 3; i++) {
-        if (solve("N", AA[i], Ay[i], 2, 1, x)) return 0;
-        opos[i] = x[0];
-        ovel[i] = x[1];
+    for (i=0;i<3;i++) {
+        if (solve("N",AA[i],Ay[i],2,1,x)) return 0;
+        opos[i]=x[0];
+        ovel[i]=x[1];
     }
     return 1;
 }
 // fit time-range of plot ---------------------------------------------------
 void Plot::FitTime(void)
 {
-    sol_t *sols, *sole;
-    double tl[2] = { 86400.0 * 7, 0.0 }, tp[2], xl[2], yl[2], zl[2];
-    int sel = !BtnSol1->isChecked() && BtnSol2->isChecked() ? 1 : 0;
-
-    trace(3, "FitTime\n");
-
-    sols = getsol(SolData + sel, 0);
-    sole = getsol(SolData + sel, SolData[sel].n - 1);
-    if (sols && sole) {
-        tl[0] = MIN(tl[0], TimePos(sols->time));
-        tl[1] = MAX(tl[1], TimePos(sole->time));
+    sol_t *sols,*sole;
+    double tl[2]={86400.0*7,0.0},tp[2],xl[2],yl[2],zl[2];
+    int sel=!BtnSol1->isChecked()&&BtnSol2->isChecked()?1:0;
+    
+    trace(3,"FitTime\n");
+    
+    sols=getsol(SolData+sel,0);
+    sole=getsol(SolData+sel,SolData[sel].n-1);
+    if (sols&&sole) {
+        tl[0]=MIN(tl[0],TimePos(sols->time));
+        tl[1]=MAX(tl[1],TimePos(sole->time));
     }
-    if (Obs.n > 0) {
-        tl[0] = MIN(tl[0], TimePos(Obs.data[0].time));
-        tl[1] = MAX(tl[1], TimePos(Obs.data[Obs.n - 1].time));
+    if (Obs.n>0) {
+        tl[0]=MIN(tl[0],TimePos(Obs.data[0].time));
+        tl[1]=MAX(tl[1],TimePos(Obs.data[Obs.n-1].time));
     }
-    if (TimeEna[0]) tl[0] = TimePos(TimeStart);
-    if (TimeEna[1]) tl[1] = TimePos(TimeEnd);
-
-    if (qFuzzyCompare(tl[0], tl[1])) {
-        tl[0] = tl[0] - DEFTSPAN / 2.0;
-        tl[1] = tl[0] + DEFTSPAN / 2.0;
-    } else if (tl[0] > tl[1]) {
-        tl[0] = -DEFTSPAN / 2.0;
-        tl[1] = DEFTSPAN / 2.0;
+    if (TimeEna[0]) tl[0]=TimePos(TimeStart);
+    if (TimeEna[1]) tl[1]=TimePos(TimeEnd  );
+    
+    if (qFuzzyCompare(tl[0],tl[1])) {
+        tl[0]=tl[0]-DEFTSPAN/2.0;
+        tl[1]=tl[0]+DEFTSPAN/2.0;
     }
-    GraphG[0]->GetLim(tp, xl);
-    GraphG[1]->GetLim(tp, yl);
-    GraphG[2]->GetLim(tp, zl);
-    GraphG[0]->SetLim(tl, xl);
-    GraphG[1]->SetLim(tl, yl);
-    GraphG[2]->SetLim(tl, zl);
-    GraphR->GetLim(tp, xl);
-    GraphR->SetLim(tl, xl);
+    else if (tl[0]>tl[1]) {
+        tl[0]=-DEFTSPAN/2.0;
+        tl[1]= DEFTSPAN/2.0;
+    }
+    GraphG[0]->GetLim(tp,xl);
+    GraphG[1]->GetLim(tp,yl);
+    GraphG[2]->GetLim(tp,zl);
+    GraphG[0]->SetLim(tl,xl);
+    GraphG[1]->SetLim(tl,yl);
+    GraphG[2]->SetLim(tl,zl);
+    GraphR   ->GetLim(tp,xl);
+    GraphR   ->SetLim(tl,xl);
 }
 // set x/y-range of plot ----------------------------------------------------
 void Plot::SetRange(int all, double range)
 {
-    double xl[] = { -range, range };
-    double yl[] = { -range, range };
-    double zl[] = { -range, range };
-    double xs, ys, tl[2], xp[2], pos[3];
-
-    trace(3, "SetRange: all=%d range=%.3f\n", all, range);
-
-    if (all || PlotType == PLOT_TRK) {
-        GraphT->SetLim(xl, yl);
-        GraphT->GetScale(xs, ys);
-        GraphT->SetScale(MAX(xs, ys), MAX(xs, ys));
-        if (norm(OPos, 3) > 0.0) {
-            ecef2pos(OPos, pos);
-            googleEarthView->SetView(pos[0] * R2D, pos[1] * R2D, 0.0, 0.0);
-            googleMapView->SetView(pos[0] * R2D, pos[1] * R2D, 13);
+    double xl[]={-range,range};
+    double yl[]={-range,range};
+    double zl[]={-range,range};
+    double xs,ys,tl[2],xp[2],pos[3];
+    
+    trace(3,"SetRange: all=%d range=%.3f\n",all,range);
+    
+    if (all||PlotType==PLOT_TRK) {
+        GraphT->SetLim(xl,yl);
+        GraphT->GetScale(xs,ys);
+        GraphT->SetScale(MAX(xs,ys),MAX(xs,ys));
+        if (norm(OPos,3)>0.0) {
+            ecef2pos(OPos,pos);
+            googleEarthView->SetView(pos[0]*R2D,pos[1]*R2D,0.0,0.0);
+            googleMapView->SetView(pos[0]*R2D,pos[1]*R2D,13);
         }
     }
-    if (PLOT_SOLP <= PlotType && PlotType <= PLOT_SOLA) {
-        GraphG[0]->GetLim(tl, xp);
-        GraphG[0]->SetLim(tl, xl);
-        GraphG[1]->SetLim(tl, yl);
-        GraphG[2]->SetLim(tl, zl);
-    } else if (PlotType == PLOT_NSAT) {
-        GraphG[0]->GetLim(tl, xp);
-        xl[0] = yl[0] = zl[0] = 0.0;
-        xl[1] = MaxDop;
-        yl[1] = YLIM_AGE;
-        zl[1] = YLIM_RATIO;
-        GraphG[0]->SetLim(tl, xl);
-        GraphG[1]->SetLim(tl, yl);
-        GraphG[2]->SetLim(tl, zl);
-    } else if (PlotType < PLOT_SNR) {
-        GraphG[0]->GetLim(tl, xp);
-        xl[0] = -10.0; xl[1] = 10.0;
-        yl[0] = -0.1; yl[1] = 0.1;
-        zl[0] = 0.0; zl[1] = 90.0;
-        GraphG[0]->SetLim(tl, xl);
-        GraphG[1]->SetLim(tl, yl);
-        GraphG[2]->SetLim(tl, zl);
-    } else {
-        GraphG[0]->GetLim(tl, xp);
-        xl[0] = 10.0; xl[1] = 60.0;
-        yl[0] = -MaxMP; yl[1] = MaxMP;
-        zl[0] = 0.0; zl[1] = 90.0;
-        GraphG[0]->SetLim(tl, xl);
-        GraphG[1]->SetLim(tl, yl);
-        GraphG[2]->SetLim(tl, zl);
+    if (PLOT_SOLP<=PlotType&&PlotType<=PLOT_SOLA) {
+        GraphG[0]->GetLim(tl,xp);
+        GraphG[0]->SetLim(tl,xl);
+        GraphG[1]->SetLim(tl,yl);
+        GraphG[2]->SetLim(tl,zl);
+    }
+    else if (PlotType==PLOT_NSAT) {
+        GraphG[0]->GetLim(tl,xp);
+        xl[0]=yl[0]=zl[0]=0.0;
+        xl[1]=MaxDop;
+        yl[1]=YLIM_AGE;
+        zl[1]=YLIM_RATIO;
+        GraphG[0]->SetLim(tl,xl);
+        GraphG[1]->SetLim(tl,yl);
+        GraphG[2]->SetLim(tl,zl);
+    }
+    else if (PlotType<PLOT_SNR) {
+        GraphG[0]->GetLim(tl,xp);
+        xl[0]=-10.0; xl[1]=10.0;
+        yl[0]= -0.1; yl[1]= 0.1;
+        zl[0]=  0.0; zl[1]=90.0;
+        GraphG[0]->SetLim(tl,xl);
+        GraphG[1]->SetLim(tl,yl);
+        GraphG[2]->SetLim(tl,zl);
+    }
+    else {
+        GraphG[0]->GetLim(tl,xp);
+        xl[0]=10.0; xl[1]= 60.0;
+        yl[0]=-MaxMP; yl[1]=MaxMP;
+        zl[0]= 0.0; zl[1]= 90.0;
+        GraphG[0]->SetLim(tl,xl);
+        GraphG[1]->SetLim(tl,yl);
+        GraphG[2]->SetLim(tl,zl);
     }
 }
 // fit x/y-range of plot ----------------------------------------------------
 void Plot::FitRange(int all)
 {
-    TIMEPOS *pos, *pos1, *pos2;
+    TIMEPOS *pos,*pos1,*pos2;
     sol_t *data;
-    double xs, ys, xp[2], tl[2], xl[] = { 1E8, -1E8 }, yl[2] = { 1E8, -1E8 }, zl[2] = { 1E8, -1E8 };
-    double lat, lon, lats[2] = { 90, -90 }, lons[2] = { 180, -180 }, llh[3];
-    int i, type = PlotType - PLOT_SOLP;
-
-    trace(3, "FitRange: all=%d\n", all);
-
+    double xs,ys,xp[2],tl[2],xl[]={1E8,-1E8},yl[2]={1E8,-1E8},zl[2]={1E8,-1E8};
+    double lat,lon,lats[2]={90,-90},lons[2]={180,-180},llh[3];
+    int i,type=PlotType-PLOT_SOLP;
+    
+    trace(3,"FitRange: all=%d\n",all);
+    
     MenuFixHoriz->setChecked(false);
-
+    
     if (BtnSol1->isChecked()) {
-        pos = SolToPos(SolData, -1, QFlag->currentIndex(), type);
-
-        for (i = 0; i < pos->n; i++) {
-            xl[0] = MIN(xl[0], pos->x[i]);
-            yl[0] = MIN(yl[0], pos->y[i]);
-            zl[0] = MIN(zl[0], pos->z[i]);
-            xl[1] = MAX(xl[1], pos->x[i]);
-            yl[1] = MAX(yl[1], pos->y[i]);
-            zl[1] = MAX(zl[1], pos->z[i]);
+        
+        pos=SolToPos(SolData,-1,QFlag->currentIndex(),type);
+        
+        for (i=0;i<pos->n;i++) {
+            xl[0]=MIN(xl[0],pos->x[i]);
+            yl[0]=MIN(yl[0],pos->y[i]);
+            zl[0]=MIN(zl[0],pos->z[i]);
+            xl[1]=MAX(xl[1],pos->x[i]);
+            yl[1]=MAX(yl[1],pos->y[i]);
+            zl[1]=MAX(zl[1],pos->z[i]);
         }
         delete pos;
     }
     if (BtnSol2->isChecked()) {
-        pos = SolToPos(SolData + 1, -1, QFlag->currentIndex(), type);
-
-        for (i = 0; i < pos->n; i++) {
-            xl[0] = MIN(xl[0], pos->x[i]);
-            yl[0] = MIN(yl[0], pos->y[i]);
-            zl[0] = MIN(zl[0], pos->z[i]);
-            xl[1] = MAX(xl[1], pos->x[i]);
-            yl[1] = MAX(yl[1], pos->y[i]);
-            zl[1] = MAX(zl[1], pos->z[i]);
+        
+        pos=SolToPos(SolData+1,-1,QFlag->currentIndex(),type);
+        
+        for (i=0;i<pos->n;i++) {
+            xl[0]=MIN(xl[0],pos->x[i]);
+            yl[0]=MIN(yl[0],pos->y[i]);
+            zl[0]=MIN(zl[0],pos->z[i]);
+            xl[1]=MAX(xl[1],pos->x[i]);
+            yl[1]=MAX(yl[1],pos->y[i]);
+            zl[1]=MAX(zl[1],pos->z[i]);
         }
         delete pos;
     }
     if (BtnSol12->isChecked()) {
-        pos1 = SolToPos(SolData, -1, 0, type);
-        pos2 = SolToPos(SolData + 1, -1, 0, type);
-        pos = pos1->diff(pos2, QFlag->currentIndex());
-
-        for (i = 0; i < pos->n; i++) {
-            xl[0] = MIN(xl[0], pos->x[i]);
-            yl[0] = MIN(yl[0], pos->y[i]);
-            zl[0] = MIN(zl[0], pos->z[i]);
-            xl[1] = MAX(xl[1], pos->x[i]);
-            yl[1] = MAX(yl[1], pos->y[i]);
-            zl[1] = MAX(zl[1], pos->z[i]);
+        
+        pos1=SolToPos(SolData  ,-1,0,type);
+        pos2=SolToPos(SolData+1,-1,0,type);
+        pos=pos1->diff(pos2,QFlag->currentIndex());
+        
+        for (i=0;i<pos->n;i++) {
+            xl[0]=MIN(xl[0],pos->x[i]);
+            yl[0]=MIN(yl[0],pos->y[i]);
+            zl[0]=MIN(zl[0],pos->z[i]);
+            xl[1]=MAX(xl[1],pos->x[i]);
+            yl[1]=MAX(yl[1],pos->y[i]);
+            zl[1]=MAX(zl[1],pos->z[i]);
         }
         delete pos1;
         delete pos2;
         delete pos;
     }
-    xl[0] -= 0.05;
-    xl[1] += 0.05;
-    yl[0] -= 0.05;
-    yl[1] += 0.05;
-    zl[0] -= 0.05;
-    zl[1] += 0.05;
-
-    if (all || PlotType == PLOT_TRK) {
-        GraphT->SetLim(xl, yl);
-        GraphT->GetScale(xs, ys);
-        GraphT->SetScale(MAX(xs, ys), MAX(xs, ys));
+    xl[0]-=0.05;
+    xl[1]+=0.05;
+    yl[0]-=0.05;
+    yl[1]+=0.05;
+    zl[0]-=0.05;
+    zl[1]+=0.05;
+    
+    if (all||PlotType==PLOT_TRK) {
+        GraphT->SetLim(xl,yl);
+        GraphT->GetScale(xs,ys);
+        GraphT->SetScale(MAX(xs,ys),MAX(xs,ys));
     }
-    if (all || PlotType <= PLOT_SOLA || PlotType == PLOT_RES) {
-        GraphG[0]->GetLim(tl, xp);
-        GraphG[0]->SetLim(tl, xl);
-        GraphG[1]->SetLim(tl, yl);
-        GraphG[2]->SetLim(tl, zl);
+    if (all||PlotType<=PLOT_SOLA||PlotType==PLOT_RES) {
+        GraphG[0]->GetLim(tl,xp);
+        GraphG[0]->SetLim(tl,xl);
+        GraphG[1]->SetLim(tl,yl);
+        GraphG[2]->SetLim(tl,zl);
     }
     if (all) {
         if (BtnSol1->isChecked()) {
-            for (i = 0; (data = getsol(SolData, i)) != NULL; i++) {
-                ecef2pos(data->rr, llh);
-                lats[0] = MIN(lats[0], llh[0] * R2D);
-                lons[0] = MIN(lons[0], llh[1] * R2D);
-                lats[1] = MAX(lats[1], llh[0] * R2D);
-                lons[1] = MAX(lons[1], llh[1] * R2D);
+            for (i=0;(data=getsol(SolData,i))!=NULL;i++) {
+                ecef2pos(data->rr,llh); 
+                lats[0]=MIN(lats[0],llh[0]*R2D);
+                lons[0]=MIN(lons[0],llh[1]*R2D);
+                lats[1]=MAX(lats[1],llh[0]*R2D);
+                lons[1]=MAX(lons[1],llh[1]*R2D);
             }
         }
         if (BtnSol2->isChecked()) {
-            for (i = 0; (data = getsol(SolData + 1, i)) != NULL; i++) {
-                ecef2pos(data->rr, llh);
-                lats[0] = MIN(lats[0], llh[0] * R2D);
-                lons[0] = MIN(lons[0], llh[1] * R2D);
-                lats[1] = MAX(lats[1], llh[0] * R2D);
-                lons[1] = MAX(lons[1], llh[1] * R2D);
+            for (i=0;(data=getsol(SolData+1,i))!=NULL;i++) {
+                ecef2pos(data->rr,llh); 
+                lats[0]=MIN(lats[0],llh[0]*R2D);
+                lons[0]=MIN(lons[0],llh[1]*R2D);
+                lats[1]=MAX(lats[1],llh[0]*R2D);
+                lons[1]=MAX(lons[1],llh[1]*R2D);
             }
         }
-        if (lats[0] <= lats[1] && lons[0] <= lons[1]) {
-            lat = (lats[0] + lats[1]) / 2.0;
-            lon = (lons[0] + lons[1]) / 2.0;
-            googleEarthView->SetView(lat, lon, 0.0, 0.0);
+        if (lats[0]<=lats[1]&&lons[0]<=lons[1]) {
+            lat=(lats[0]+lats[1])/2.0;
+            lon=(lons[0]+lons[1])/2.0;
+            googleEarthView->SetView(lat,lon,0.0,0.0);
         }
     }
 }
 // set center of track plot -------------------------------------------------
 void Plot::SetTrkCent(double lat, double lon)
 {
-    gtime_t time = { 0, 0 };
-    double pos[3] = { 0 }, rr[3], xyz[3];
+    gtime_t time={0,0};
+    double pos[3]={0},rr[3],xyz[3];
 
-    if (PlotType != PLOT_TRK) return;
-    pos[0] = lat * D2R;
-    pos[1] = lon * D2R;
-    pos2ecef(pos, rr);
-    PosToXyz(time, rr, 0, xyz);
-    GraphT->SetCent(xyz[0], xyz[1]);
+    if (PlotType!=PLOT_TRK) return;
+    pos[0]=lat*D2R;
+    pos[1]=lon*D2R;
+    pos2ecef(pos,rr);
+    PosToXyz(time,rr,0,xyz);
+    GraphT->SetCent(xyz[0],xyz[1]);
     UpdatePlot();
 }
 // load options from ini-file -----------------------------------------------
 void Plot::LoadOpt(void)
 {
-    QSettings settings(IniFile, QSettings::IniFormat);
+    QSettings settings(IniFile,QSettings::IniFormat);
     double range;
-    int i, geopts[12];
-
-    trace(3, "LoadOpt\n");
-
-    PlotType = settings.value("plot/plottype", 0).toInt();
-    TimeLabel = settings.value("plot/timelabel", 1).toInt();
-    LatLonFmt = settings.value("plot/latlonfmt", 0).toInt();
-    AutoScale = settings.value("plot/autoscale", 1).toInt();
-    ShowStats = settings.value("plot/showstats", 0).toInt();
-    ShowLabel = settings.value("plot/showlabel", 1).toInt();
-    ShowGLabel = settings.value("plot/showglabel", 1).toInt();
-    ShowCompass = settings.value("plot/showcompass", 0).toInt();
-    ShowScale = settings.value("plot/showscale", 1).toInt();
-    ShowArrow = settings.value("plot/showarrow", 0).toInt();
-    ShowSlip = settings.value("plot/showslip", 0).toInt();
-    ShowHalfC = settings.value("plot/showhalfc", 0).toInt();
-    ShowErr = settings.value("plot/showerr", 0).toInt();
-    ShowEph = settings.value("plot/showeph", 0).toInt();
-    PlotStyle = settings.value("plot/plotstyle", 0).toInt();
-    MarkSize = settings.value("plot/marksize", 2).toInt();
-    NavSys = settings.value("plot/navsys", SYS_GPS).toInt();
-    AnimCycle = settings.value("plot/animcycle", 10).toInt();
-    RefCycle = settings.value("plot/refcycle", 100).toInt();
-    HideLowSat = settings.value("plot/hidelowsat", 0).toInt();
-    ElMaskP = settings.value("plot/elmaskp", 0).toInt();
-    ExSats = settings.value("plot/exsats", "").toString();
-    RtBuffSize = settings.value("plot/rtbuffsize", 10800).toInt();
-    TimeSyncOut = settings.value("plot/timesyncout", 0).toInt();
-    TimeSyncPort = settings.value("plot/timesyncport", 10071).toInt();
-    RtStream[0] = settings.value("plot/rtstream1", 0).toInt();
-    RtStream[1] = settings.value("plot/rtstream2", 0).toInt();
-    RtFormat[0] = settings.value("plot/rtformat1", 0).toInt();
-    RtFormat[1] = settings.value("plot/rtformat2", 0).toInt();
-    RtTimeForm = settings.value("plot/rttimeform", 0).toInt();
-    RtDegForm = settings.value("plot/rtdegform", 0).toInt();
-    RtFieldSep = settings.value("plot/rtfieldsep", "").toString();
-    RtTimeOutTime = settings.value("plot/rttimeouttime", 0).toInt();
-    RtReConnTime = settings.value("plot/rtreconntime", 10000).toInt();
-
-    MColor[0][0] = settings.value("plot/mcolor0", QColor(0xc0, 0xc0, 0xc0)).value<QColor>();
-    MColor[0][1] = settings.value("plot/mcolor1", QColor(Qt::green)).value<QColor>();
-    MColor[0][2] = settings.value("plot/mcolor2", QColor(0x00, 0xAA, 0xFF)).value<QColor>();
-    MColor[0][3] = settings.value("plot/mcolor3", QColor(0xff, 0x00, 0xff)).value<QColor>();
-    MColor[0][4] = settings.value("plot/mcolor4", QColor(Qt::blue)).value<QColor>();
-    MColor[0][5] = settings.value("plot/mcolor5", QColor(Qt::red)).value<QColor>();
-    MColor[0][6] = settings.value("plot/mcolor6", QColor(0x80, 0x80, 0x00)).value<QColor>();
-    MColor[0][7] = settings.value("plot/mcolor7", QColor(Qt::gray)).value<QColor>();
-    MColor[1][0] = settings.value("plot/mcolor8", QColor(0xc0, 0xc0, 0xc0)).value<QColor>();
-    MColor[1][1] = settings.value("plot/mcolor9", QColor(0x80, 0x40, 0x00)).value<QColor>();
-    MColor[1][2] = settings.value("plot/mcolor10", QColor(0x00, 0x80, 0x80)).value<QColor>();
-    MColor[1][3] = settings.value("plot/mcolor11", QColor(0xFF, 0x00, 0x80)).value<QColor>();
-    MColor[1][4] = settings.value("plot/mcolor12", QColor(0xFF, 0x80, 0x00)).value<QColor>();
-    MColor[1][5] = settings.value("plot/mcolor13", QColor(0x80, 0x80, 0xFF)).value<QColor>();
-    MColor[1][6] = settings.value("plot/mcolor14", QColor(0xFF, 0x80, 0x80)).value<QColor>();
-    MColor[1][7] = settings.value("plot/mcolor15", QColor(Qt::gray)).value<QColor>();
-    MapColor[0] = settings.value("plot/mapcolor1", QColor(0xc0, 0xc0, 0xc0)).value<QColor>();
-    MapColor[1] = settings.value("plot/mapcolor2", QColor(0xc0, 0xc0, 0xc0)).value<QColor>();
-    MapColor[2] = settings.value("plot/mapcolor3", QColor(0xf0, 0xd0, 0xd0)).value<QColor>();
-    MapColor[3] = settings.value("plot/mapcolor4", QColor(0xd0, 0xf0, 0xd0)).value<QColor>();
-    MapColor[4] = settings.value("plot/mapcolor5", QColor(0xd0, 0xd0, 0xf0)).value<QColor>();
-    MapColor[5] = settings.value("plot/mapcolor6", QColor(0xd0, 0xf0, 0xf0)).value<QColor>();
-    MapColor[6] = settings.value("plot/mapcolor7", QColor(0xf8, 0xf8, 0xd0)).value<QColor>();
-    MapColor[7] = settings.value("plot/mapcolor8", QColor(0xf0, 0xf0, 0xf0)).value<QColor>();
-    MapColor[8] = settings.value("plot/mapcolor9", QColor(0xf0, 0xf0, 0xf0)).value<QColor>();
-    MapColor[9] = settings.value("plot/mapcolor10", QColor(0xf0, 0xf0, 0xf0)).value<QColor>();
-    MapColor[10] = settings.value("plot/mapcolor11", QColor(0xf0, 0xf0, 0xf0)).value<QColor>();
-    MapColor[11] = settings.value("plot/mapcolor12", QColor(0xf0, 0xf0, 0xf0)).value<QColor>();
-    CColor[0] = settings.value("plot/color1", QColor(Qt::white)).value<QColor>();
-    CColor[1] = settings.value("plot/color2", QColor(0xc0, 0xc0, 0xc0)).value<QColor>();
-    CColor[2] = settings.value("plot/color3", QColor(Qt::black)).value<QColor>();
-    CColor[3] = settings.value("plot/color4", QColor(0xc0, 0xc0, 0xc0)).value<QColor>();
-
-    plotOptDialog->refDialog->StaPosFile = settings.value("plot/staposfile", "").toString();
-    plotOptDialog->refDialog->Format = settings.value("plot/staposformat", 0).toInt();
-
-    ElMask = settings.value("plot/elmask", 0.0).toDouble();
-    MaxDop = settings.value("plot/maxdop", 30.0).toDouble();
-    MaxMP = settings.value("plot/maxmp", 10.0).toDouble();
-    YRange = settings.value("plot/yrange", 5.0).toDouble();
-    Origin = settings.value("plot/orgin", 2).toInt();
-    RcvPos = settings.value("plot/rcvpos", 0).toInt();
-    OOPos[0] = settings.value("plot/oopos1", 0).toDouble();
-    OOPos[1] = settings.value("plot/oopos2", 0).toDouble();
-    OOPos[2] = settings.value("plot/oopos3", 0).toDouble();
-    QcCmd = settings.value("plot/qccmd", "teqc +qc +sym +l -rep -plot").toString();
-    TLEFile = settings.value("plot/tlefile", "").toString();
-    TLESatFile = settings.value("plot/tlesatfile", "").toString();
-
-    Font.setFamily(settings.value("plot/fontname", "Tahoma").toString());
-    Font.setPointSize(settings.value("plot/fontsize", 8).toInt());
-
-    RnxOpts = settings.value("plot/rnxopts", "").toString();
-    ApiKey  = settings.value ("plot/apikey" ,"").toString();
-
-    for (i = 0; i < 11; i++)
-        geopts[i] = settings.value(QString("ge/geopts_%1").arg(i), 0).toInt();
+    int i,geopts[12];
+    
+    trace(3,"LoadOpt\n");
+    
+    PlotType     =settings.value("plot/plottype",      0).toInt();
+    TimeLabel    =settings.value("plot/timelabel",     1).toInt();
+    LatLonFmt    =settings.value("plot/latlonfmt",     0).toInt();
+    AutoScale    =settings.value("plot/autoscale",     1).toInt();
+    ShowStats    =settings.value("plot/showstats",     0).toInt();
+    ShowLabel    =settings.value("plot/showlabel",     1).toInt();
+    ShowGLabel   =settings.value("plot/showglabel",    1).toInt();
+    ShowCompass  =settings.value("plot/showcompass",   0).toInt();
+    ShowScale    =settings.value("plot/showscale",     1).toInt();
+    ShowArrow    =settings.value("plot/showarrow",     0).toInt();
+    ShowSlip     =settings.value("plot/showslip",      0).toInt();
+    ShowHalfC    =settings.value("plot/showhalfc",     0).toInt();
+    ShowErr      =settings.value("plot/showerr",       0).toInt();
+    ShowEph      =settings.value("plot/showeph",       0).toInt();
+    PlotStyle    =settings.value("plot/plotstyle",     0).toInt();
+    MarkSize     =settings.value("plot/marksize",      2).toInt();
+    NavSys       =settings.value("plot/navsys",  SYS_GPS).toInt();
+    AnimCycle    =settings.value("plot/animcycle",    10).toInt();
+    RefCycle     =settings.value("plot/refcycle",    100).toInt();
+    HideLowSat   =settings.value("plot/hidelowsat",    0).toInt();
+    ElMaskP      =settings.value("plot/elmaskp",       0).toInt();
+    ExSats       =settings.value ("plot/exsats",       "").toString();
+    RtBuffSize   =settings.value("plot/rtbuffsize",10800).toInt();
+    RtStream[0]  =settings.value("plot/rtstream1",     0).toInt();
+    RtStream[1]  =settings.value("plot/rtstream2",     0).toInt();
+    RtFormat[0]  =settings.value("plot/rtformat1",     0).toInt();
+    RtFormat[1]  =settings.value("plot/rtformat2",     0).toInt();
+    RtTimeForm   =settings.value("plot/rttimeform",    0).toInt();
+    RtDegForm    =settings.value("plot/rtdegform",     0).toInt();
+    RtFieldSep   =settings.value ("plot/rtfieldsep",   "").toString();
+    RtTimeOutTime=settings.value("plot/rttimeouttime", 0).toInt();
+    RtReConnTime =settings.value("plot/rtreconntime",10000).toInt();
+    
+    MColor[0][0]=settings.value("plot/mcolor0", QColor(0xc0,0xc0,0xc0) ).value<QColor>();
+    MColor[0][1]=settings.value("plot/mcolor1", QColor(Qt::green)  ).value<QColor>();
+    MColor[0][2]=settings.value("plot/mcolor2", QColor(0x00,0xAA,0xFF)).value<QColor>();
+    MColor[0][3]=settings.value("plot/mcolor3", QColor(0xff,0x00,0xff)).value<QColor>();
+    MColor[0][4]=settings.value("plot/mcolor4", QColor(Qt::blue)   ).value<QColor>();
+    MColor[0][5]=settings.value("plot/mcolor5", QColor(Qt::red)    ).value<QColor>();
+    MColor[0][6]=settings.value("plot/mcolor6", QColor(0x80,0x80,0x00)   ).value<QColor>();
+    MColor[0][7]=settings.value("plot/mcolor7", QColor(Qt::gray)   ).value<QColor>();
+    MColor[1][0]=settings.value("plot/mcolor8", QColor(0xc0,0xc0,0xc0) ).value<QColor>();
+    MColor[1][1]=settings.value("plot/mcolor9", QColor(0x80,0x40,0x00) ).value<QColor>();
+    MColor[1][2]=settings.value("plot/mcolor10",QColor(0x00,0x80,0x80) ).value<QColor>();
+    MColor[1][3]=settings.value("plot/mcolor11",QColor(0xFF,0x00,0x80) ).value<QColor>();
+    MColor[1][4]=settings.value("plot/mcolor12",QColor(0xFF,0x80,0x00) ).value<QColor>();
+    MColor[1][5]=settings.value("plot/mcolor13",QColor(0x80,0x80,0xFF) ).value<QColor>();
+    MColor[1][6]=settings.value("plot/mcolor14",QColor(0xFF,0x80,0x80) ).value<QColor>();
+    MColor[1][7]=settings.value("plot/mcolor15",QColor(Qt::gray)   ).value<QColor>();
+    MapColor[0]=settings.value("plot/mapcolor1",QColor(0xc0,0xc0,0xc0)).value<QColor>();
+    MapColor[1]=settings.value("plot/mapcolor2",QColor(0xc0,0xc0,0xc0)).value<QColor>();
+    MapColor[2]=settings.value("plot/mapcolor3",QColor(0xf0,0xd0,0xd0)).value<QColor>();
+    MapColor[3]=settings.value("plot/mapcolor4",QColor(0xd0,0xf0,0xd0)).value<QColor>();
+    MapColor[4]=settings.value("plot/mapcolor5",QColor(0xd0,0xd0,0xf0)).value<QColor>();
+    MapColor[5]=settings.value("plot/mapcolor6",QColor(0xd0,0xf0,0xf0)).value<QColor>();
+    MapColor[6]=settings.value("plot/mapcolor7",QColor(0xf8,0xf8,0xd0)).value<QColor>();
+    MapColor[7]=settings.value("plot/mapcolor8",QColor(0xf0,0xf0,0xf0)).value<QColor>();
+    MapColor[8]=settings.value("plot/mapcolor9",QColor(0xf0,0xf0,0xf0)).value<QColor>();
+    MapColor[9]=settings.value("plot/mapcolor10",QColor(0xf0,0xf0,0xf0)).value<QColor>();
+    MapColor[10]=settings.value("plot/mapcolor11",QColor(0xf0,0xf0,0xf0)).value<QColor>();
+    MapColor[11]=settings.value("plot/mapcolor12",QColor(0xf0,0xf0,0xf0)).value<QColor>();
+    CColor[0]=settings.value("plot/color1", QColor(Qt::white)  ).value<QColor>();
+    CColor[1]=settings.value("plot/color2", QColor(0xc0,0xc0,0xc0) ).value<QColor>();
+    CColor[2]=settings.value("plot/color3", QColor(Qt::black)  ).value<QColor>();
+    CColor[3]=settings.value("plot/color4", QColor(0xc0,0xc0,0xc0) ).value<QColor>();
+    
+    plotOptDialog->refDialog->StaPosFile=settings.value ("plot/staposfile","").toString();
+    plotOptDialog->refDialog->Format    =settings.value("plot/staposformat",0).toInt();
+    
+    ElMask    =settings.value  ("plot/elmask", 0.0).toDouble();
+    MaxDop    =settings.value  ("plot/maxdop",30.0).toDouble();
+    MaxMP     =settings.value  ("plot/maxmp" ,10.0).toDouble();
+    YRange    =settings.value  ("plot/yrange", 5.0).toDouble();
+    Origin    =settings.value("plot/orgin",    2).toInt();
+    RcvPos    =settings.value("plot/rcvpos",   0).toInt();
+    OOPos[0]  =settings.value  ("plot/oopos1",   0).toDouble();
+    OOPos[1]  =settings.value  ("plot/oopos2",   0).toDouble();
+    OOPos[2]  =settings.value  ("plot/oopos3",   0).toDouble();
+    QcCmd     =settings.value ("plot/qccmd","teqc +qc +sym +l -rep -plot").toString();
+    TLEFile   =settings.value ("plot/tlefile", "").toString();
+    TLESatFile=settings.value ("plot/tlesatfile","").toString();
+        
+    Font.setFamily(settings.value ("plot/fontname","Tahoma").toString());
+    Font.setPointSize(settings.value("plot/fontsize",8).toInt());
+    
+    RnxOpts   =settings.value ("plot/rnxopts","").toString();
+    
+    for (i=0;i<11;i++) {
+        geopts[i]=settings.value(QString("ge/geopts_%1").arg(i),0).toInt();
+    }
     googleEarthView->SetOpts(geopts);
-
-    for (i = 0; i < 2; i++) {
-        StrCmds  [0][i] = settings.value(QString("str/strcmd1_%1").arg(i), "").toString();
-        StrCmds  [1][i] = settings.value(QString("str/strcmd2_%1").arg(i), "").toString();
-        StrCmdEna[0][i] = settings.value(QString("str/strcmdena1_%1").arg(i), 0).toInt();
-        StrCmdEna[1][i] = settings.value(QString("str/strcmdena2_%1").arg(i), 0).toInt();
+    
+    for (i=0;i<2;i++) {
+        StrCmds  [0][i]=settings.value (QString("str/strcmd1_%1").arg(i),"").toString();
+        StrCmds  [1][i]=settings.value (QString("str/strcmd2_%1").arg(i),"").toString();
+        StrCmdEna[0][i]=settings.value(QString("str/strcmdena1_%1").arg(i), 0).toInt();
+        StrCmdEna[1][i]=settings.value(QString("str/strcmdena2_%1").arg(i), 0).toInt();
     }
-    for (i = 0; i < 3; i++) {
-        StrPaths[0][i] = settings.value(QString("str/strpath1_%1").arg(i), "").toString();
-        StrPaths[1][i] = settings.value(QString("str/strpath2_%1").arg(i), "").toString();
+    for (i=0;i<3;i++) {
+        StrPaths[0][i]=settings.value (QString("str/strpath1_%1").arg(i),"").toString();
+        StrPaths[1][i]=settings.value (QString("str/strpath2_%1").arg(i),"").toString();
     }
-    for (i = 0; i < 10; i++) {
-        StrHistory [i] = settings.value(QString("str/strhistry_%1").arg(i), "").toString();
-        StrMntpHist[i] = settings.value(QString("str/strmntphist_%1").arg(i), "").toString();
+    for (i=0;i<10;i++) {
+        StrHistory [i]=settings.value (QString("str/strhistry_%1").arg(i),"").toString();
+        StrMntpHist[i]=settings.value (QString("str/strmntphist_%1").arg(i),"").toString();
     }
 
-    TextViewer::Color1 = settings.value("viewer/color1", QColor(Qt::black)).value<QColor>();
-    TextViewer::Color2 = settings.value("viewer/color2", QColor(Qt::white)).value<QColor>();
-    TextViewer::FontD.setFamily(settings.value("viewer/fontname", "Courier New").toString());
-    TextViewer::FontD.setPointSize(settings.value("viewer/fontsize", 9).toInt());
-
-    MenuBrowse->setChecked(settings.value("solbrows/show",       0).toBool());
-    BrowseSplitter->restoreState(settings.value("solbrows/split1",   100).toByteArray());
-    Dir  =settings.value("solbrows/dir",  "C:\\").toString();
-
-    for (i = 0; i < RangeList->count(); i++) {
+    TextViewer::Color1=settings.value("viewer/color1",QColor(Qt::black)).value<QColor>();
+    TextViewer::Color2=settings.value("viewer/color2",QColor(Qt::white)).value<QColor>();
+    TextViewer::FontD.setFamily(settings.value ("viewer/fontname","Courier New").toString());
+    TextViewer::FontD.setPointSize(settings.value("viewer/fontsize",9).toInt());
+    
+    fileSelDialog->Dir=settings.value("solbrows/dir","").toString();
+    
+    for (i=0;i<RangeList->count();i++)
+    {
         bool okay;
-        range = RangeList->item(i)->text().toDouble(&okay);
-
-        if (okay && qFuzzyCompare(range, YRange))
+        range=RangeList->item(i)->text().toDouble(&okay);
+        
+        if (okay&&qFuzzyCompare(range,YRange)) {
             RangeList->item(i)->setSelected(true);
+        }
     }
 }
 // save options to ini-file -------------------------------------------------
 void Plot::SaveOpt(void)
 {
-    QSettings settings(IniFile, QSettings::IniFormat);
-    int i, geopts[12];
-
-    trace(3, "SaveOpt\n");
-
-    settings.setValue("plot/plottype", PlotType);
-    settings.setValue("plot/timelabel", TimeLabel);
-    settings.setValue("plot/latlonfmt", LatLonFmt);
-    settings.setValue("plot/autoscale", AutoScale);
-    settings.setValue("plot/showstats", ShowStats);
-    settings.setValue("plot/showlabel", ShowLabel);
-    settings.setValue("plot/showglabel", ShowGLabel);
-    settings.setValue("plot/showcompass", ShowCompass);
-    settings.setValue("plot/showscale", ShowScale);
-    settings.setValue("plot/showarrow", ShowArrow);
-    settings.setValue("plot/showslip", ShowSlip);
-    settings.setValue("plot/showhalfc", ShowHalfC);
-    settings.setValue("plot/showerr", ShowErr);
-    settings.setValue("plot/showeph", ShowEph);
-    settings.setValue("plot/plotstyle", PlotStyle);
-    settings.setValue("plot/marksize", MarkSize);
-    settings.setValue("plot/navsys", NavSys);
-    settings.setValue("plot/animcycle", AnimCycle);
-    settings.setValue("plot/refcycle", RefCycle);
-    settings.setValue("plot/hidelowsat", HideLowSat);
-    settings.setValue("plot/elmaskp", ElMaskP);
-    settings.setValue("plot/exsats", ExSats);
-    settings.setValue("plot/rtbuffsize", RtBuffSize);
-    settings.setValue("plot/timesyncout", TimeSyncOut);
-    settings.setValue("plot/timesyncport", TimeSyncPort);
-    settings.setValue("plot/rtstream1", RtStream[0]);
-    settings.setValue("plot/rtstream2", RtStream[1]);
-    settings.setValue("plot/rtformat1", RtFormat[0]);
-    settings.setValue("plot/rtformat2", RtFormat[1]);
-    settings.setValue("plot/rttimeform", RtTimeForm);
-    settings.setValue("plot/rtdegform", RtDegForm);
-    settings.setValue("plot/rtfieldsep", RtFieldSep);
-    settings.setValue("plot/rttimeouttime", RtTimeOutTime);
-    settings.setValue("plot/rtreconntime", RtReConnTime);
-
-    settings.setValue("plot/mcolor0", MColor[0][0]);
-    settings.setValue("plot/mcolor1", MColor[0][1]);
-    settings.setValue("plot/mcolor2", MColor[0][2]);
-    settings.setValue("plot/mcolor3", MColor[0][3]);
-    settings.setValue("plot/mcolor4", MColor[0][4]);
-    settings.setValue("plot/mcolor5", MColor[0][5]);
-    settings.setValue("plot/mcolor6", MColor[0][6]);
-    settings.setValue("plot/mcolor7", MColor[0][7]);
-    settings.setValue("plot/mcolor8", MColor[0][0]);
-    settings.setValue("plot/mcolor9", MColor[1][1]);
-    settings.setValue("plot/mcolor10", MColor[1][2]);
-    settings.setValue("plot/mcolor11", MColor[1][3]);
-    settings.setValue("plot/mcolor12", MColor[1][4]);
-    settings.setValue("plot/mcolor13", MColor[1][5]);
-    settings.setValue("plot/mcolor14", MColor[1][6]);
-    settings.setValue("plot/mcolor15", MColor[1][7]);
-    settings.setValue("plot/mapcolor1", MapColor[0]);
-    settings.setValue("plot/mapcolor2", MapColor[1]);
-    settings.setValue("plot/mapcolor3", MapColor[2]);
-    settings.setValue("plot/mapcolor4", MapColor[3]);
-    settings.setValue("plot/mapcolor5", MapColor[4]);
-    settings.setValue("plot/mapcolor6", MapColor[5]);
-    settings.setValue("plot/mapcolor7", MapColor[6]);
-    settings.setValue("plot/mapcolor8", MapColor[7]);
-    settings.setValue("plot/mapcolor9", MapColor[8]);
-    settings.setValue("plot/mapcolor10", MapColor[9]);
-    settings.setValue("plot/mapcolor11", MapColor[10]);
-    settings.setValue("plot/mapcolor12", MapColor[11]);
-    settings.setValue("plot/color1", CColor[0]);
-    settings.setValue("plot/color2", CColor[1]);
-    settings.setValue("plot/color3", CColor[2]);
-    settings.setValue("plot/color4", CColor[3]);
-
-    settings.setValue("plot/staposfile", plotOptDialog->refDialog->StaPosFile);
+    QSettings settings(IniFile,QSettings::IniFormat);
+    int i,geopts[12];
+    
+    trace(3,"SaveOpt\n");
+    
+    settings.setValue("plot/plottype",     PlotType     );
+    settings.setValue("plot/timelabel",    TimeLabel    );
+    settings.setValue("plot/latlonfmt",    LatLonFmt    );
+    settings.setValue("plot/autoscale",    AutoScale    );
+    settings.setValue("plot/showstats",    ShowStats    );
+    settings.setValue("plot/showlabel",    ShowLabel    );
+    settings.setValue("plot/showglabel",   ShowGLabel   );
+    settings.setValue("plot/showcompass",  ShowCompass  );
+    settings.setValue("plot/showscale",    ShowScale    );
+    settings.setValue("plot/showarrow",    ShowArrow    );
+    settings.setValue("plot/showslip",     ShowSlip     );
+    settings.setValue("plot/showhalfc",    ShowHalfC    );
+    settings.setValue("plot/showerr",      ShowErr      );
+    settings.setValue("plot/showeph",      ShowEph      );
+    settings.setValue("plot/plotstyle",    PlotStyle    );
+    settings.setValue("plot/marksize",     MarkSize     );
+    settings.setValue("plot/navsys",       NavSys       );
+    settings.setValue("plot/animcycle",    AnimCycle    );
+    settings.setValue("plot/refcycle",     RefCycle     );
+    settings.setValue("plot/hidelowsat",   HideLowSat   );
+    settings.setValue("plot/elmaskp",      ElMaskP      );
+    settings.setValue ("plot/exsats",       ExSats       );
+    settings.setValue("plot/rtbuffsize",   RtBuffSize   );
+    settings.setValue("plot/rtstream1",    RtStream[0]  );
+    settings.setValue("plot/rtstream2",    RtStream[1]  );
+    settings.setValue("plot/rtformat1",    RtFormat[0]  );
+    settings.setValue("plot/rtformat2",    RtFormat[1]  );
+    settings.setValue("plot/rttimeform",   RtTimeForm   );
+    settings.setValue("plot/rtdegform",    RtDegForm    );
+    settings.setValue ("plot/rtfieldsep",   RtFieldSep   );
+    settings.setValue("plot/rttimeouttime",RtTimeOutTime);
+    settings.setValue("plot/rtreconntime", RtReConnTime );
+    
+    settings.setValue("plot/mcolor0",     MColor[0][0]);
+    settings.setValue("plot/mcolor1",     MColor[0][1]);
+    settings.setValue("plot/mcolor2",     MColor[0][2]);
+    settings.setValue("plot/mcolor3",     MColor[0][3]);
+    settings.setValue("plot/mcolor4",     MColor[0][4]);
+    settings.setValue("plot/mcolor5",     MColor[0][5]);
+    settings.setValue("plot/mcolor6",     MColor[0][6]);
+    settings.setValue("plot/mcolor7",     MColor[0][7]);
+    settings.setValue("plot/mcolor8",     MColor[0][0]);
+    settings.setValue("plot/mcolor9",     MColor[1][1]);
+    settings.setValue("plot/mcolor10",    MColor[1][2]);
+    settings.setValue("plot/mcolor11",    MColor[1][3]);
+    settings.setValue("plot/mcolor12",    MColor[1][4]);
+    settings.setValue("plot/mcolor13",    MColor[1][5]);
+    settings.setValue("plot/mcolor14",    MColor[1][6]);
+    settings.setValue("plot/mcolor15",    MColor[1][7]);
+    settings.setValue("plot/mapcolor1",   MapColor[0]);
+    settings.setValue("plot/mapcolor2",   MapColor[1]);
+    settings.setValue("plot/mapcolor3",   MapColor[2]);
+    settings.setValue("plot/mapcolor4",   MapColor[3]);
+    settings.setValue("plot/mapcolor5",   MapColor[4]);
+    settings.setValue("plot/mapcolor6",   MapColor[5]);
+    settings.setValue("plot/mapcolor7",   MapColor[6]);
+    settings.setValue("plot/mapcolor8",   MapColor[7]);
+    settings.setValue("plot/mapcolor9",   MapColor[8]);
+    settings.setValue("plot/mapcolor10",  MapColor[9]);
+    settings.setValue("plot/mapcolor11",  MapColor[10]);
+    settings.setValue("plot/mapcolor12",  MapColor[11]);
+    settings.setValue("plot/color1",      CColor[0]);
+    settings.setValue("plot/color2",      CColor[1]);
+    settings.setValue("plot/color3",      CColor[2]);
+    settings.setValue("plot/color4",      CColor[3]);
+    
+    settings.setValue ("plot/staposfile",   plotOptDialog->refDialog->StaPosFile);
     settings.setValue("plot/staposformat", plotOptDialog->refDialog->Format);
-
-    settings.setValue("plot/elmask", ElMask);
-    settings.setValue("plot/maxdop", MaxDop);
-    settings.setValue("plot/maxmp", MaxMP);
-    settings.setValue("plot/yrange", YRange);
-    settings.setValue("plot/orgin", Origin);
-    settings.setValue("plot/rcvpos", RcvPos);
-    settings.setValue("plot/oopos1", OOPos[0]);
-    settings.setValue("plot/oopos2", OOPos[1]);
-    settings.setValue("plot/oopos3", OOPos[2]);
-    settings.setValue("plot/qccmd", QcCmd);
-    settings.setValue("plot/tlefile", TLEFile);
-    settings.setValue("plot/tlesatfile", TLESatFile);
-
-    settings.setValue("plot/fontname", Font.family());
-    settings.setValue("plot/fontsize", Font.pointSize());
-
-    settings.setValue("plot/rnxopts", RnxOpts);
-    settings.setValue("plot/apikey", ApiKey);
-
+    
+    settings.setValue  ("plot/elmask",       ElMask        );
+    settings.setValue  ("plot/maxdop",       MaxDop        );
+    settings.setValue  ("plot/maxmp",        MaxMP         );
+    settings.setValue  ("plot/yrange",       YRange        );
+    settings.setValue("plot/orgin",        Origin        );
+    settings.setValue("plot/rcvpos",       RcvPos        );
+    settings.setValue  ("plot/oopos1",       OOPos[0]      );
+    settings.setValue  ("plot/oopos2",       OOPos[1]      );
+    settings.setValue  ("plot/oopos3",       OOPos[2]      );
+    settings.setValue ("plot/qccmd",        QcCmd         );
+    settings.setValue ("plot/tlefile",      TLEFile       );
+    settings.setValue ("plot/tlesatfile",   TLESatFile    );
+    
+    settings.setValue ("plot/fontname",     Font.family()    );
+    settings.setValue("plot/fontsize",     Font.pointSize()    );
+    
+    settings.setValue ("plot/rnxopts",      RnxOpts       );
+    
     googleEarthView->GetOpts(geopts);
-    for (i = 0; i < 11; i++)
-        settings.setValue(QString("gr/geopts_%1").arg(i), geopts[i]);
-    for (i = 0; i < 2; i++) {
-        settings.setValue(QString("str/strcmd1_%1").arg(i), StrCmds  [0][i]);
-        settings.setValue(QString("str/strcmd2_%1").arg(i), StrCmds  [1][i]);
-        settings.setValue(QString("str/strcmdena1_%1").arg(i), StrCmdEna[0][i]);
-        settings.setValue(QString("str/strcmdena2_%1").arg(i), StrCmdEna[1][i]);
+    for (i=0;i<11;i++) {
+        settings.setValue(QString("gr/geopts_%1").arg(i),geopts[i]);
     }
-    for (i = 0; i < 3; i++) {
-        settings.setValue(QString("str/strpath1_%1").arg(i), StrPaths[0][i]);
-        settings.setValue(QString("str/strpath2_%1").arg(i), StrPaths[1][i]);
+    for (i=0;i<2;i++) {
+        settings.setValue (QString("str/strcmd1_%1").arg(i),StrCmds  [0][i]);
+        settings.setValue (QString("str/strcmd2_%1").arg(i),StrCmds  [1][i]);
+        settings.setValue(QString("str/strcmdena1_%1").arg(i),StrCmdEna[0][i]);
+        settings.setValue(QString("str/strcmdena2_%1").arg(i),StrCmdEna[1][i]);
     }
-    for (i = 0; i < 10; i++) {
-        settings.setValue(QString("str/strhistry_%1").arg(i), StrHistory [i]);
-        settings.setValue(QString("str/strmntphist_%1").arg(i), StrMntpHist[i]);
+    for (i=0;i<3;i++) {
+        settings.setValue (QString("str/strpath1_%1").arg(i),StrPaths[0][i]);
+        settings.setValue (QString("str/strpath2_%1").arg(i),StrPaths[1][i]);
+    }
+    for (i=0;i<10;i++) {
+        settings.setValue (QString("str/strhistry_%1").arg(i),StrHistory [i]);
+        settings.setValue (QString("str/strmntphist_%1").arg(i),StrMntpHist[i]);
     }
 
-    settings.setValue("viewer/color1", TextViewer::Color1);
-    settings.setValue("viewer/color2", TextViewer::Color2);
-    settings.setValue("viewer/fontname", TextViewer::FontD.family());
-    settings.setValue("viewer/fontsize", TextViewer::FontD.pointSize());
-
-    settings.setValue("solbrows/dir", fileSelDialog->Dir);
-    settings.setValue("solbrows/split1", BrowseSplitter->saveState());
-}
-
-//---------------------------------------------------------------------------
-void Plot::DriveSelChanged()
-{
-    DirSelector->setVisible(false);
-
-    DirSelector->setRootIndex(dirModel->index(DriveSel->currentText()));
-    DirSelected->setText(DriveSel->currentText());
+    settings.setValue("viewer/color1",TextViewer::Color1  );
+    settings.setValue("viewer/color2",TextViewer::Color2  );
+    settings.setValue("viewer/fontname",TextViewer::FontD.family());
+    settings.setValue("viewer/fontsize",TextViewer::FontD.pointSize());
+    
+    settings.setValue ("solbrows/dir",fileSelDialog->Dir);
+    
 }
-//---------------------------------------------------------------------------
-void Plot::BtnDirSelClick()
-{
-#ifdef FLOATING_DIRSELECTOR
-    QPoint pos = Panel5->mapToGlobal(BtnDirSel->pos());
-    pos.rx() += BtnDirSel->width() - DirSelector->width();
-    pos.ry() += BtnDirSel->height();
+#if 0
+QScreen *scr=QApplication::screens().at(0);
+    QRect rect = scr->availableGeometry();
+    QSize thisDecoration=this->frameSize()-this->size();
+    this->move(rect.x(),rect.y());
+    this->resize(rect.width()/2-thisDecoration.width(),rect.height()-thisDecoration.height());
 
-    DirSelector->move(pos);
-#endif
-    DirSelector->setVisible(!DirSelector->isVisible());
-}
-//---------------------------------------------------------------------------
-void Plot::DirSelChange(QModelIndex index)
-{
-    DirSelector->expand(index);
+    QSize GEDecoration=googleEarthView->frameSize()-googleEarthView->size();
+    googleEarthView->move(rect.x()+rect.width()/2,rect.y());
+    googleEarthView->resize(rect.width()/2-GEDecoration.width(),rect.height()-GEDecoration.height());
+    googleMapView->setVisible(false);
+    googleEarthView->setVisible(true);
 
-    Dir = dirModel->filePath(index);
-    DirSelected->setText(Dir);
-    fileModel->setRootPath(Dir);
-    FileList->setRootIndex(fileModel->index(Dir));
-}
-//---------------------------------------------------------------------------
-void Plot::DirSelSelected(QModelIndex)
-{
-    DirSelector->setVisible(false);
-}
-//---------------------------------------------------------------------------
-void Plot::FileListClick(QModelIndex index)
-{
-    QStringList file;
+    QScreen *scr=QApplication::screens().at(0);
+    QRect rect = scr->availableGeometry();
+    QSize thisDecoration=this->frameSize()-this->size();
+    this->move(rect.x(),rect.y());
+    this->resize(rect.width()/2-thisDecoration.width(),rect.height()-thisDecoration.height());
 
-    file.append(fileModel->filePath(index));
-    plot->ReadSol(file, 0);
+    QSize GMDecoration=googleMapView->frameSize()-googleMapView->size();
+    googleMapView->move(rect.x()+rect.width()/2,rect.y());
+    googleMapView->resize(rect.width()/2-GMDecoration.width(),rect.height()-GMDecoration.height());
+    googleEarthView->setVisible(false);;
+    googleMapView->setVisible(true);
 
-    DirSelector->setVisible(false);
-}
-//---------------------------------------------------------------------------
-void Plot::FilterClick()
-{
-    QString filter = Filter->currentText();
+    QScreen *scr=QApplication::screens().at(0);
+    QRect rect = scr->availableGeometry();
+    QSize thisDecoration=this->frameSize()-this->size();
+    this->move(rect.x(),rect.y());
+    this->resize(rect.width()/2-thisDecoration.width(),rect.height()-thisDecoration.height());
 
-    // only keep data between brackets
-    filter = filter.mid(filter.indexOf("(") + 1);
-    filter.remove(")");
+    QSize GMDecoration=googleMapView->frameSize()-googleMapView->size();
+    QSize GEDecoration=googleEarthView->frameSize()-googleEarthView->size();
+    googleEarthView->move(rect.x()+rect.width()/2,rect.y());
+    googleEarthView->resize(rect.width()/2-GEDecoration.width(),rect.height()/2-GEDecoration.height());
+    googleMapView->move(rect.x()+rect.width()/2,rect.y()+rect.height()/2);
+    googleMapView->resize(rect.width()/2-GMDecoration.width(),rect.height()/2-GMDecoration.height());
+    googleEarthView->setVisible(true);
+    googleMapView->setVisible(true);
 
-    fileModel->setNameFilters(filter.split(" "));
-    DirSelector->setVisible(false);
-}
-//---------------------------------------------------------------------------
+#endif
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotmain.h RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotmain.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotmain.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotmain.h	2019-08-19 02:04:50.000000000 +0300
@@ -5,8 +5,6 @@
 #include <QTimer>
 #include <QTime>
 #include <QMainWindow>
-#include <QFileSystemModel>
-#include <QTreeView>
 
 #include "graph.h"
 #include "console.h"
@@ -99,11 +97,10 @@
 private:
     int nmax_;
     TIMEPOS(TIMEPOS &){}
-
 public:
     int n;
     gtime_t *t;
-    double *x, *y, *z, *xs, *ys, *zs, *xys;
+    double *x,*y,*z,*xs,*ys,*zs,*xys;
     int *q;
     TIMEPOS(int nmax, int sflg);
     ~TIMEPOS();
@@ -117,117 +114,104 @@
     Q_OBJECT
 
 protected:
-    void mousePressEvent(QMouseEvent*);
-    void mouseReleaseEvent(QMouseEvent*);
-    void mouseDoubleClickEvent(QMouseEvent*);
-    void wheelEvent(QWheelEvent*);
-    void closeEvent(QCloseEvent*);
-    void keyPressEvent(QKeyEvent *);
-    void showEvent(QShowEvent*);
-    void resizeEvent(QResizeEvent *);
-    void leaveEvent(QEvent*);
-    void dragEnterEvent(QDragEnterEvent *event);
-    void dropEvent(QDropEvent *event);
-    void paintEvent(QPaintEvent *event);
+        void  mouseMoveEvent		(QMouseEvent*);
+        void  mousePressEvent		(QMouseEvent*);
+        void  mouseReleaseEvent		(QMouseEvent*);
+        void  mouseDoubleClickEvent (QMouseEvent*);
+        void  wheelEvent			(QWheelEvent*);
+        void  closeEvent            (QCloseEvent*);
+        void  keyPressEvent			(QKeyEvent *);
+        void  showEvent			    (QShowEvent*);
+        void  resizeEvent			(QResizeEvent *);
+        void  leaveEvent    		(QEvent*);
+        void  dragEnterEvent        (QDragEnterEvent *event);
+        void  dropEvent             (QDropEvent *event);
+        void  paintEvent            (QPaintEvent *event);
 
-    void mouseMove(QMouseEvent*);
 public slots:
-    void MenuOpenSol1Click();
-    void MenuOpenSol2Click();
-    void MenuOpenMapImageClick();
-    void MenuOpenShapeClick();
-    void MenuOpenObsClick();
-    void MenuOpenNavClick();
-    void MenuOpenElevMaskClick();
-    void MenuConnectClick();
-    void MenuDisconnectClick();
-    void MenuPortClick();
-    void MenuReloadClick();
-    void MenuClearClick();
-    void MenuQuitClick();
-
-    void MenuTimeClick();
-    void MenuMapImgClick();
-    void MenuWaypointClick();
-    void MenuSrcSolClick();
-    void MenuSrcObsClick();
-    void MenuQcObsClick();
-    void MenuCopyClick();
-    void MenuOptionsClick();
-
-    void MenuToolBarClick();
-    void MenuStatusBarClick();
-    void MenuMonitor1Click();
-    void MenuMonitor2Click();
-    void MenuCenterOriClick();
-    void MenuFitHorizClick();
-    void MenuFitVertClick();
-    void MenuShowTrackClick();
-    void MenuFixHorizClick();
-    void MenuFixVertClick();
-    void MenuShowMapClick();
-    void MenuShowImgClick();
-    void MenuShowGridClick();
-    void MenuAnimStartClick();
-    void MenuAnimStopClick();
-    void MenuAboutClick();
-
-    void BtnConnectClick();
-    void BtnSol1Click();
-    void BtnSol2Click();
-    void BtnSol12Click();
-    void BtnSol1DblClick();
-    void BtnSol2DblClick();
-    void BtnOn1Click();
-    void BtnOn2Click();
-    void BtnOn3Click();
-    void BtnRangeListClick();
-    void BtnAnimateClick();
-
-    void PlotTypeSChange();
-    void QFlagChange();
-    void ObsTypeChange();
-    void DopTypeChange();
-    void SatListChange();
-    void TimeScrollChange();
-    void RangeListClick();
-
-    void TimerTimer();
+        void  MenuOpenSol1Click	();
+        void  MenuOpenSol2Click	();
+        void  MenuOpenMapImageClick();
+        void  MenuOpenShapeClick ();
+        void  MenuOpenObsClick	();
+        void  MenuOpenNavClick	();
+        void  MenuOpenElevMaskClick();
+        void  MenuConnectClick	();
+        void  MenuDisconnectClick ();
+        void  MenuPortClick		();
+        void  MenuReloadClick		();
+        void  MenuClearClick		();
+        void  MenuQuitClick		();
+	
+        void  MenuTimeClick		();
+        void  MenuMapImgClick		();
+        void  MenuWaypointClick	();
+        void  MenuSrcSolClick		();
+        void  MenuSrcObsClick		();
+        void  MenuQcObsClick		();
+        void  MenuCopyClick		();
+        void  MenuOptionsClick	();
+	
+        void  MenuToolBarClick	();
+        void  MenuStatusBarClick	();
+        void  MenuMonitor1Click	();
+        void  MenuMonitor2Click	();
+        void  MenuCenterOriClick	();
+        void  MenuFitHorizClick	();
+        void  MenuFitVertClick	();
+        void  MenuShowTrackClick	();
+        void  MenuFixHorizClick	();
+        void  MenuFixVertClick	();
+        void  MenuShowMapClick	();
+        void  MenuShowImgClick	();
+        void  MenuAnimStartClick	();
+        void  MenuAnimStopClick	();
+        void  MenuAboutClick		();
+	
+        void  BtnConnectClick		();
+        void  BtnSol1Click		();
+        void  BtnSol2Click		();
+        void  BtnSol12Click		();
+        void  BtnSol1DblClick		();
+        void  BtnSol2DblClick		();
+        void  BtnOn1Click			();
+        void  BtnOn2Click			();
+        void  BtnOn3Click			();
+        void  BtnRangeListClick	();
+        void  BtnAnimateClick		();
 
-    void MenuSaveDopClick();
-    void MenuSaveImageClick();
-    void MenuGEClick();
-    void MenuVisAnaClick();
-    void MenuFixCentClick();
-    void MenuGMClick();
-    void MenuSaveSnrMpClick();
-    void MenuOpenSkyImageClick();
-    void MenuSkyImgClick();
-    void MenuShowSkyplotClick();
-    void MenuPlotGEClick();
-    void MenuPlotGMClick();
-    void MenuPlotGEGMClick();
-    void MenuMaxClick();
-    void MenuSaveElMaskClick();
-    void MenuMapLayerClick();
-    void BtnMessage2Click();
-    void MenuOpenWaypointClick();
-    void MenuSaveWaypointClick();
-    void MenuBrowseClick();
+        void  PlotTypeSChange		();
+        void  QFlagChange			();
+        void  ObsTypeChange		();
+        void  DopTypeChange		();
+        void  SatListChange		();
+        void  TimeScrollChange	();
+        void  RangeListClick		();
 
-    void FileListClick(QModelIndex);
-    void DirSelChange(QModelIndex);
-    void DirSelSelected(QModelIndex);
-    void DriveSelChanged();
-    void FilterClick();
-    void BtnDirSelClick();
+        void  TimerTimer			();
+	
+        void  MenuFileSelClick();
+        void  MenuSaveDopClick();
+        void  MenuSaveImageClick();
+        void  MenuGEClick();
+        void  MenuVisAnaClick();
+        void  MenuFixCentClick();
+        void  MenuGMClick();
+        void  MenuSaveSnrMpClick();
+        void  MenuOpenSkyImageClick();
+        void  MenuSkyImgClick();
+        void  MenuShowSkyplotClick();
+        void  MenuPlotGEClick();
+        void  MenuPlotGMClick();
+        void  MenuPlotGEGMClick();
+        void  MenuMaxClick();
+        void  MenuSaveElMaskClick();
+        void  MenuMapLayerClick();
+        void  BtnMessage2Click();
+        void  MenuOpenWaypointClick();
+        void  MenuSaveWaypointClick();
 
 private:
-    bool eventFilter(QObject *obj, QEvent *event);
-    QTreeView *DirSelector;
-    QFileSystemModel *fileModel, *dirModel;
-    QString Dir;
-
     QPixmap Buff;
     QImage MapImage;
     QImage SkyImageI;
@@ -236,152 +220,149 @@
     Graph *GraphR;
     Graph *GraphS;
     Graph *GraphE[2];
-    Console *Console1, *Console2;
+    Console *Console1,*Console2;
     QStringList OpenFiles;
     QStringList SolFiles[2];
     QStringList ObsFiles;
     QStringList NavFiles;
 
     stream_t Stream[2];
-    stream_t StrTimeSync;
     solbuf_t SolData[2];
     solstatbuf_t SolStat[2];
     int SolIndex[2];
     obs_t Obs;
     nav_t Nav;
     sta_t Sta;
-    double *Az, *El, *Mp[NFREQ+NEXOBS];
-    char StrBuff[1024];
-    int NStrBuff;
+    double *Az,*El,*Mp[NFREQ+NEXOBS];
     QTimer Timer;
     QTime updateTime;
     
     gtime_t OEpoch;
-    int FormWidth, FormHeight;
-    int ConnectState, OpenRaw;
-    int NObs, *IndexObs, ObsIndex;
+    int FormWidth,FormHeight;
+    int ConnectState,OpenRaw;
+    int NObs,*IndexObs,ObsIndex;
     int Week;
-    int Flush, PlotType;
-    int NSolF1, NSolF2, NObsF, NNavF;
-    int SatMask[MAXSAT], SatSel[MAXSAT];
+    int Flush,PlotType;
+    int NSolF1,NSolF2,NObsF,NNavF;
+    int SatMask[MAXSAT],SatSel[MAXSAT];
     int SimObs;
     
-    int Drag, Xn, Yn;
-    double X0, Y0, Xc, Yc, Xs, Ys, Xcent, Xcent0;
+    int Drag,Xn,Yn;
+    double X0,Y0,Xc,Yc,Xs,Ys,Xcent,Xcent0;
     unsigned int MouseDownTick;
     
-    int GEState, GEDataState[2];
+    int GEState,GEDataState[2];
     double GEHeading;
     
-    void ReadSolStat(const QStringList &files, int sel);
-    int ReadObsRnx(const QStringList &files, obs_t *obs, nav_t *nav, sta_t *sta);
-    void ReadMapTag(const QString &file);
-    void ReadShapeFile(const QStringList &file);
-    void GenVisData(void);
-    void SaveDop(const QString &file);
-    void SaveSnrMp(const QString &file);
-    void SaveElMask(const QString &file);
-    void Connect(void);
-    void Disconnect(void);
-    void ConnectPath(const QString &path, int ch);
-    int CheckObs(const QString &file);
-    void UpdateObs(int nobs);
-    void UpdateMp(void);
-    void ClearObs(void);
-    void ClearSol(void);
-    void Clear(void);
-    void Refresh(void);
-    void Reload(void);
-    void ReadWaitStart(void);
-    void ReadWaitEnd(void);
+    void  ReadSolStat  (const QStringList &files, int sel);
+    int   ReadObsRnx   (const QStringList &files, obs_t *obs, nav_t *nav, sta_t *sta);
+    void  ReadMapTag   (const QString &file);
+    void  ReadShapeFile(const QStringList &file);
+    void  GenVisData   (void);
+    void  SaveDop      (const QString &file);
+    void  SaveSnrMp    (const QString &file);
+    void  SaveElMask   (const QString &file);
+    void  Connect      (void);
+    void  Disconnect   (void);
+    void  ConnectPath  (const QString &path, int ch);
+    int   CheckObs     (const QString &file);
+    void  UpdateObs    (int nobs);
+    void  UpdateMp     (void);
+    void  ClearObs     (void);
+    void  ClearSol     (void);
+    void  Clear        (void);
+    void  Refresh      (void);
+    void  Reload       (void);
+    void  ReadWaitStart(void);
+    void  ReadWaitEnd  (void);
     
-    void UpdateDisp(void);
-    void UpdateType(int type);
-    void UpdatePlotType(void);
-    void UpdateSatList(void);
-    void UpdateObsType(void);
-    void UpdateSize(void);
-    void UpdateColor(void);
-    void UpdateTime(void);
-    void UpdateOrigin(void);
-    void UpdateSatMask(void);
-    void UpdateSatSel(void);
-    void UpdateInfo(void);
-    void UpdateTimeSol(void);
-    void UpdateTimeObs(void);
-    void UpdateInfoSol(void);
-    void UpdateInfoObs(void);
-    void UpdatePoint(int x, int y);
-    void UpdateEnable(void);
-    void FitTime(void);
-    void SetRange(int all, double range);
-    void FitRange(int all);
+    void  UpdateDisp   (void);
+    void  UpdateType   (int type);
+    void  UpdatePlotType(void);
+    void  UpdateSatList(void);
+    void  UpdateObsType(void);
+    void  UpdateSize   (void);
+    void  UpdateColor  (void);
+    void  UpdateTime   (void);
+    void  UpdateOrigin (void);
+    void  UpdateSatMask(void);
+    void  UpdateSatSel (void);
+    void  UpdateInfo   (void);
+    void  UpdateTimeSol(void);
+    void  UpdateTimeObs(void);
+    void  UpdateInfoSol(void);
+    void  UpdateInfoObs(void);
+    void  UpdatePoint  (int x, int y);
+    void  UpdateEnable (void);
+    void  FitTime      (void);
+    void  SetRange     (int all, double range);
+    void  FitRange     (int all);
     
-    void SetCentX(double c);
-    void SetScaleX(double s);
-    void MouseDownTrk(int X, int Y);
-    void MouseDownSol(int X, int Y);
-    void MouseDownObs(int X, int Y);
-    void MouseMoveTrk(int X, int Y, double dx, double dy, double dxs, double dys);
-    void MouseMoveSol(int X, int Y, double dx, double dy, double dxs, double dys);
-    void MouseMoveObs(int X, int Y, double dx, double dy, double dxs, double dys);
+    void  SetCentX     (double c);
+    void  SetScaleX    (double s);
+    void  MouseDownTrk (int X, int Y);
+    void  MouseDownSol (int X, int Y);
+    void  MouseDownObs (int X, int Y);
+    void  MouseMoveTrk (int X, int Y, double dx, double dy, double dxs, double dys);
+    void  MouseMoveSol (int X, int Y, double dx, double dy, double dxs, double dys);
+    void  MouseMoveObs (int X, int Y, double dx, double dy, double dxs, double dys);
 
-    void DrawTrk(QPainter &g,int level);
-    void DrawTrkImage(QPainter &g,int level);
-    void DrawTrkMap(QPainter &g,int level);
-    void DrawTrkPath(QPainter &g,int level);
-    void DrawTrkPnt(QPainter &g,const TIMEPOS *pos, int level, int style);
-    void DrawTrkPos(QPainter &g,const double *rr, int type, int siz, QColor color, const QString &label);
-    void DrawTrkStat(QPainter &g,const TIMEPOS *pos, const QString &header, int p);
-    void DrawTrkError(QPainter &g,const TIMEPOS *pos, int style);
-    void DrawTrkArrow(QPainter &g,const TIMEPOS *pos);
-    void DrawTrkVel(QPainter &g,const TIMEPOS *vel);
-    void DrawLabel(Graph *,QPainter &g, const QPoint &p, const QString &label, int ha, int va);
-    void DrawMark(Graph *,QPainter &g, const QPoint &p, int mark, const QColor &color, int size, int rot);
-    void DrawSol(QPainter &g,int level, int type);
-    void DrawSolPnt(QPainter &g,const TIMEPOS *pos, int level, int style);
-    void DrawSolStat(QPainter &g,const TIMEPOS *pos, const QString &unit, int p);
-    void DrawNsat(QPainter &g,int level);
-    void DrawRes(QPainter &g,int level);
-    void DrawPolyS(Graph *,QPainter &c, double *x, double *y, int n,
-                           const QColor &color, int style);
+    void  DrawTrk      (QPainter &g,int level);
+    void  DrawTrkImage (QPainter &g,int level);
+    void  DrawTrkMap   (QPainter &g,int level);
+    void  DrawTrkPath  (QPainter &g,int level);
+    void  DrawTrkPnt   (QPainter &g,const TIMEPOS *pos, int level, int style);
+    void  DrawTrkPos   (QPainter &g,const double *rr, int type, int siz, QColor color, const QString &label);
+    void  DrawTrkStat  (QPainter &g,const TIMEPOS *pos, const QString &header, int p);
+    void  DrawTrkError (QPainter &g,const TIMEPOS *pos, int style);
+    void  DrawTrkArrow (QPainter &g,const TIMEPOS *pos);
+    void  DrawTrkVel   (QPainter &g,const TIMEPOS *vel);
+    void  DrawLabel    (Graph *,QPainter &g, const QPoint &p, const QString &label, int ha, int va);
+    void  DrawMark     (Graph *,QPainter &g, const QPoint &p, int mark, const QColor &color, int size, int rot);
+    void  DrawSol      (QPainter &g,int level, int type);
+    void  DrawSolPnt   (QPainter &g,const TIMEPOS *pos, int level, int style);
+    void  DrawSolStat  (QPainter &g,const TIMEPOS *pos, const QString &unit, int p);
+    void  DrawNsat     (QPainter &g,int level);
+    void  DrawRes      (QPainter &g,int level);
+    void  DrawPolyS    (Graph *,QPainter &c, double *x, double *y, int n,
+                                  const QColor &color, int style);
     
-    void DrawObs(QPainter &g,int level);
-    void DrawObsSlip(QPainter &g,double *yp);
-    void DrawObsEphem(QPainter &g,double *yp);
-    void DrawSkyImage(QPainter &g,int level);
-    void DrawSky(QPainter &g,int level);
-    void DrawDop(QPainter &g,int level);
-    void DrawDopStat(QPainter &g,double *dop, int *ns, int n);
-    void DrawSnr(QPainter &g,int level);
-    void DrawSnrE(QPainter &g,int level);
-    void DrawMpS(QPainter &g,int level);
+    void  DrawObs      (QPainter &g,int level);
+    void  DrawObsSlip  (QPainter &g,double *yp);
+    void  DrawObsEphem (QPainter &g,double *yp);
+    void  DrawSkyImage (QPainter &g,int level);
+    void  DrawSky      (QPainter &g,int level);
+    void  DrawDop      (QPainter &g,int level);
+    void  DrawDopStat  (QPainter &g,double *dop, int *ns, int n);
+    void  DrawSnr      (QPainter &g,int level);
+    void  DrawSnrE     (QPainter &g,int level);
+    void  DrawMpS      (QPainter &g,int level);
     
-    TIMEPOS *SolToPos(solbuf_t *sol, int index, int qflag, int type);
-    TIMEPOS *SolToNsat(solbuf_t *sol, int index, int qflag);
+    TIMEPOS *  SolToPos (solbuf_t *sol, int index, int qflag, int type);
+    TIMEPOS *  SolToNsat(solbuf_t *sol, int index, int qflag);
     
-    void PosToXyz(gtime_t time, const double *rr, int type, double *xyz);
-    void CovToXyz(const double *rr, const float *qr, int type,
-                                    double *xyzs);
-    void CalcStats(const double *x, int n, double ref, double &ave,
-                                    double &std, double &rms);
-    int FitPos(gtime_t *time, double *opos, double *ovel);
+    void  PosToXyz     (gtime_t time, const double *rr, int type, double *xyz);
+    void  CovToXyz     (const double *rr, const float *qr, int type,
+                                  double *xyzs);
+    void  CalcStats    (const double *x, int n, double ref, double &ave,
+                                  double &std, double &rms);
+    int   FitPos       (gtime_t *time, double *opos, double *ovel);
     
-    QString LatLonStr(const double *pos, int ndec);
-    QColor ObsColor(const obsd_t *obs, double az, double el);
-    QColor SysColor(int sat);
-    QColor SnrColor(double snr);
-    QColor MpColor(double mp);
-    void ReadStaPos(const QString &file, const QString &sta, double *rr);
-    int SearchPos(int x, int y);
-    void TimeSpan(gtime_t *ts, gtime_t *te, double *tint);
-    double TimePos(gtime_t time);
-    void TimeStr(gtime_t time, int n, int tsys, QString &str);
-    int ExecCmd(const QString &cmd);
-    void ShowMsg(const QString &msg);
-    void ShowLegend (QString *msgs);
-    void LoadOpt();
-    void SaveOpt();
+    QString  LatLonStr(const double *pos, int ndec);
+    QColor  ObsColor   (const obsd_t *obs, double az, double el);
+    QColor  SysColor   (int sat);
+    QColor  SnrColor   (double snr);
+    QColor  MpColor    (double mp);
+    void  ReadStaPos   (const QString &file, const QString &sta, double *rr);
+    int   SearchPos    (int x, int y);
+    void  TimeSpan     (gtime_t *ts, gtime_t *te, double *tint);
+    double  TimePos    (gtime_t time);
+    void  TimeStr(gtime_t time, int n, int tsys, QString &str);
+    int   ExecCmd      (const QString &cmd);
+    void  ShowMsg      (const QString &msg);
+    void  ShowLegend   (QString *msgs);
+    void  LoadOpt      (void);
+    void  SaveOpt      (void);
     
     MapAreaDialog *mapAreaDialog;
     GoogleEarthView *googleEarthView;
@@ -395,21 +376,19 @@
     FileSelDialog *fileSelDialog;
     TextViewer *viewer;
     VecMapDialog *vecMapDialog;
-
 public:
     QImage SkyImageR;
     QString IniFile;
     QString MapImageFile;
     QString SkyImageFile;
     QString RnxOpts;
-    QString ApiKey;
     tle_t TLEData;
     QFont Font;
     gis_t Gis;
 
     // connection settings
     int RtStream[2];
-    QString RtPath1, RtPath2;
+    QString RtPath1,RtPath2;
     QString StrPaths[2][3];
     QString StrCmds[2][2];
     int StrCmdEna[2][2];
@@ -429,15 +408,15 @@
     double TimeInt;
     
     // map options 
-    int MapSize[2], MapScaleEq;
-    double MapScaleX, MapScaleY;
-    double MapLat, MapLon;
+    int MapSize[2],MapScaleEq;
+    double MapScaleX,MapScaleY;
+    double MapLat,MapLon;
     int PointType;
     
     // sky image options 
-    int SkySize[2], SkyDestCorr, SkyElMask, SkyRes, SkyFlip, SkyBinarize;
-    double SkyCent[2], SkyScale, SkyScaleR, SkyFov[3], SkyDest[10];
-    double SkyBinThres1, SkyBinThres2;
+    int SkySize[2],SkyDestCorr,SkyElMask,SkyRes,SkyFlip,SkyBinarize;
+    double SkyCent[2],SkyScale,SkyScaleR,SkyFov[3],SkyDest[10];
+    double SkyBinThres1,SkyBinThres2;
     
     // plot options 
     int TimeLabel;
@@ -449,7 +428,7 @@
     double ElMask;
     int ElMaskP;
     int HideLowSat;
-    double MaxDop, MaxMP;
+    double MaxDop,MaxMP;
     int NavSys;
     QString ExSats;
     int ShowErr;
@@ -461,8 +440,6 @@
     int AutoScale;
     double YRange;
     int RtBuffSize;
-    int TimeSyncOut;
-    int TimeSyncPort;
     int Origin;
     int RcvPos;
     double OOPos[3];
@@ -481,29 +458,29 @@
     QString Title;
     QString PntName[MAXWAYPNT];
     double PntPos[MAXWAYPNT][3];
-    int NWayPnt, SelWayPnt;
+    int NWayPnt,SelWayPnt;
     int OPosType;
-    double OPos[3], OVel[3];
+    double OPos[3],OVel[3];
     
     QString StrHistory [10];
     QString StrMntpHist[10];
     
-    void ReadSol(const QStringList &files, int sel);
-    void ReadObs(const QStringList &files);
-    void ReadNav(const QStringList &files);
-    void ReadMapData(const QString &file);
-    void ReadSkyData(const QString &file);
-    void ReadWaypoint(const QString &file);
-    void SaveWaypoint(const QString &file);
-    void ReadSkyTag(const QString &file);
-    void UpdateSky(void);
-    void ReadElMaskData(const QString &file);
-    int GetCurrentPos(double *rr);
-    int GetCenterPos(double *rr);
+    void  ReadSol     (const QStringList &files, int sel);
+    void  ReadObs     (const QStringList &files);
+    void  ReadNav     (const QStringList &files);
+    void  ReadMapData (const QString &file);
+    void  ReadSkyData(const QString &file);
+    void  ReadWaypoint(const QString &file);
+    void  SaveWaypoint(const QString &file);
+    void  ReadSkyTag  (const QString &file);
+    void  UpdateSky   (void);
+    void  ReadElMaskData(const QString &file);
+    int  GetCurrentPos(double *rr);
+    int  GetCenterPos(double *rr);
     void SetTrkCent(double lat, double lon);
-    void UpdatePlot(void);
-    void Refresh_GEView(void);
-    void Refresh_GMView(void);
+    void  UpdatePlot(void);
+    void  Refresh_GEView(void);
+    void  Refresh_GMView(void);
 
     explicit Plot(QWidget* parent=NULL);
     ~Plot();
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotmain.ui RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotmain.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotmain.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotmain.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,1553 +6,1336 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>1596</width>
-    <height>664</height>
+    <width>1124</width>
+    <height>662</height>
    </rect>
   </property>
   <property name="windowTitle">
    <string>Plot</string>
   </property>
   <widget class="QWidget" name="centralwidget">
-   <layout class="QGridLayout" name="gridLayout">
-    <item row="0" column="0">
-     <widget class="QWidget" name="widget_2" native="true">
-      <layout class="QHBoxLayout" name="horizontalLayout_10">
+   <layout class="QVBoxLayout" name="verticalLayout_2">
+    <item>
+     <widget class="QWidget" name="widget" native="true">
+      <property name="sizePolicy">
+       <sizepolicy hsizetype="MinimumExpanding" vsizetype="MinimumExpanding">
+        <horstretch>0</horstretch>
+        <verstretch>0</verstretch>
+       </sizepolicy>
+      </property>
+      <layout class="QVBoxLayout" name="verticalLayout_3">
+       <property name="spacing">
+        <number>0</number>
+       </property>
+       <property name="leftMargin">
+        <number>0</number>
+       </property>
+       <property name="topMargin">
+        <number>0</number>
+       </property>
+       <property name="rightMargin">
+        <number>0</number>
+       </property>
+       <property name="bottomMargin">
+        <number>0</number>
+       </property>
        <item>
-        <widget class="QSplitter" name="BrowseSplitter">
-         <property name="orientation">
-          <enum>Qt::Horizontal</enum>
+        <widget class="QWidget" name="Panel1" native="true">
+         <property name="enabled">
+          <bool>true</bool>
          </property>
-         <widget class="QWidget" name="mainWidget" native="true">
-          <property name="sizePolicy">
-           <sizepolicy hsizetype="MinimumExpanding" vsizetype="MinimumExpanding">
-            <horstretch>0</horstretch>
-            <verstretch>0</verstretch>
-           </sizepolicy>
+         <property name="sizePolicy">
+          <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
+           <horstretch>0</horstretch>
+           <verstretch>0</verstretch>
+          </sizepolicy>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text" stdset="0">
+          <string/>
+         </property>
+         <layout class="QHBoxLayout" name="horizontalLayout_8">
+          <property name="spacing">
+           <number>0</number>
           </property>
-          <layout class="QVBoxLayout" name="verticalLayout_3">
-           <property name="spacing">
-            <number>0</number>
-           </property>
-           <property name="leftMargin">
-            <number>0</number>
-           </property>
-           <property name="topMargin">
-            <number>0</number>
-           </property>
-           <property name="rightMargin">
-            <number>0</number>
-           </property>
-           <property name="bottomMargin">
-            <number>0</number>
-           </property>
-           <item>
-            <widget class="QWidget" name="Panel1" native="true">
-             <property name="enabled">
-              <bool>true</bool>
+          <property name="leftMargin">
+           <number>0</number>
+          </property>
+          <property name="topMargin">
+           <number>0</number>
+          </property>
+          <property name="rightMargin">
+           <number>0</number>
+          </property>
+          <property name="bottomMargin">
+           <number>0</number>
+          </property>
+          <item>
+           <widget class="QWidget" name="Panel10" native="true">
+            <property name="enabled">
+             <bool>true</bool>
+            </property>
+            <property name="sizePolicy">
+             <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
+              <horstretch>0</horstretch>
+              <verstretch>0</verstretch>
+             </sizepolicy>
+            </property>
+            <property name="toolTip">
+             <string/>
+            </property>
+            <property name="text" stdset="0">
+             <string/>
+            </property>
+            <layout class="QHBoxLayout" name="horizontalLayout">
+             <property name="spacing">
+              <number>0</number>
              </property>
-             <property name="sizePolicy">
-              <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-               <horstretch>0</horstretch>
-               <verstretch>0</verstretch>
-              </sizepolicy>
+             <property name="leftMargin">
+              <number>0</number>
              </property>
-             <property name="toolTip">
-              <string/>
+             <property name="topMargin">
+              <number>0</number>
              </property>
-             <property name="text" stdset="0">
-              <string/>
+             <property name="rightMargin">
+              <number>0</number>
              </property>
-             <layout class="QHBoxLayout" name="horizontalLayout_8">
-              <property name="spacing">
-               <number>0</number>
-              </property>
-              <property name="leftMargin">
-               <number>0</number>
-              </property>
-              <property name="topMargin">
-               <number>0</number>
-              </property>
-              <property name="rightMargin">
-               <number>0</number>
-              </property>
-              <property name="bottomMargin">
-               <number>0</number>
-              </property>
-              <item>
-               <widget class="QWidget" name="Panel10" native="true">
-                <property name="enabled">
-                 <bool>true</bool>
+             <property name="bottomMargin">
+              <number>0</number>
+             </property>
+             <item>
+              <widget class="QToolButton" name="BtnConnect">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="maximumSize">
+                <size>
+                 <width>25</width>
+                 <height>25</height>
+                </size>
+               </property>
+               <property name="toolTip">
+                <string>Connect/Disconnect</string>
+               </property>
+               <property name="text">
+                <string/>
+               </property>
+               <property name="icon">
+                <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                 <normaloff>:/buttons/connect1.bmp</normaloff>
+                 <normalon>:/buttons/connect2.bmp</normalon>:/buttons/connect1.bmp</iconset>
+               </property>
+               <property name="checkable">
+                <bool>true</bool>
+               </property>
+              </widget>
+             </item>
+             <item>
+              <widget class="QToolButton" name="BtnSol1">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="maximumSize">
+                <size>
+                 <width>25</width>
+                 <height>25</height>
+                </size>
+               </property>
+               <property name="toolTip">
+                <string>Data 1</string>
+               </property>
+               <property name="text">
+                <string/>
+               </property>
+               <property name="icon">
+                <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                 <normaloff>:/buttons/data1.bmp</normaloff>:/buttons/data1.bmp</iconset>
+               </property>
+               <property name="checkable">
+                <bool>true</bool>
+               </property>
+              </widget>
+             </item>
+             <item>
+              <widget class="QToolButton" name="BtnSol2">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="maximumSize">
+                <size>
+                 <width>25</width>
+                 <height>25</height>
+                </size>
+               </property>
+               <property name="toolTip">
+                <string>Data 2</string>
+               </property>
+               <property name="text">
+                <string/>
+               </property>
+               <property name="icon">
+                <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                 <normaloff>:/buttons/data2.bmp</normaloff>:/buttons/data2.bmp</iconset>
+               </property>
+               <property name="checkable">
+                <bool>true</bool>
+               </property>
+              </widget>
+             </item>
+             <item>
+              <widget class="QToolButton" name="BtnSol12">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="maximumSize">
+                <size>
+                 <width>25</width>
+                 <height>25</height>
+                </size>
+               </property>
+               <property name="toolTip">
+                <string>Data 1-2</string>
+               </property>
+               <property name="text">
+                <string/>
+               </property>
+               <property name="icon">
+                <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                 <normaloff>:/buttons/data12.bmp</normaloff>:/buttons/data12.bmp</iconset>
+               </property>
+               <property name="checkable">
+                <bool>true</bool>
+               </property>
+              </widget>
+             </item>
+             <item>
+              <widget class="QWidget" name="Panel101" native="true">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="toolTip">
+                <string/>
+               </property>
+               <property name="text" stdset="0">
+                <string/>
+               </property>
+               <layout class="QHBoxLayout" name="horizontalLayout_2">
+                <property name="spacing">
+                 <number>0</number>
                 </property>
-                <property name="sizePolicy">
-                 <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-                  <horstretch>0</horstretch>
-                  <verstretch>0</verstretch>
-                 </sizepolicy>
+                <property name="leftMargin">
+                 <number>0</number>
                 </property>
-                <property name="toolTip">
-                 <string/>
+                <property name="topMargin">
+                 <number>0</number>
                 </property>
-                <property name="text" stdset="0">
-                 <string/>
+                <property name="rightMargin">
+                 <number>0</number>
                 </property>
-                <layout class="QHBoxLayout" name="horizontalLayout">
-                 <property name="leftMargin">
-                  <number>0</number>
-                 </property>
-                 <property name="topMargin">
-                  <number>0</number>
-                 </property>
-                 <property name="rightMargin">
-                  <number>0</number>
-                 </property>
-                 <property name="bottomMargin">
-                  <number>0</number>
-                 </property>
-                 <item>
-                  <widget class="QToolButton" name="BtnConnect">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="maximumSize">
-                    <size>
-                     <width>25</width>
-                     <height>25</height>
-                    </size>
-                   </property>
-                   <property name="toolTip">
-                    <string>Connect/Disconnect</string>
-                   </property>
+                <property name="bottomMargin">
+                 <number>0</number>
+                </property>
+                <item>
+                 <widget class="QComboBox" name="PlotTypeS">
+                  <property name="enabled">
+                   <bool>true</bool>
+                  </property>
+                  <property name="sizePolicy">
+                   <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                    <horstretch>0</horstretch>
+                    <verstretch>0</verstretch>
+                   </sizepolicy>
+                  </property>
+                  <property name="toolTip">
+                   <string/>
+                  </property>
+                 </widget>
+                </item>
+               </layout>
+              </widget>
+             </item>
+             <item>
+              <widget class="QWidget" name="Panel102" native="true">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="sizePolicy">
+                <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
+                 <horstretch>0</horstretch>
+                 <verstretch>0</verstretch>
+                </sizepolicy>
+               </property>
+               <property name="maximumSize">
+                <size>
+                 <width>30</width>
+                 <height>30</height>
+                </size>
+               </property>
+               <property name="toolTip">
+                <string/>
+               </property>
+               <property name="text" stdset="0">
+                <string/>
+               </property>
+               <layout class="QVBoxLayout" name="verticalLayout">
+                <property name="spacing">
+                 <number>0</number>
+                </property>
+                <property name="leftMargin">
+                 <number>0</number>
+                </property>
+                <property name="topMargin">
+                 <number>0</number>
+                </property>
+                <property name="rightMargin">
+                 <number>0</number>
+                </property>
+                <property name="bottomMargin">
+                 <number>0</number>
+                </property>
+                <item>
+                 <widget class="QPushButton" name="BtnOn1">
+                  <property name="enabled">
+                   <bool>true</bool>
+                  </property>
+                  <property name="toolTip">
+                   <string>Plot1</string>
+                  </property>
+                  <property name="text">
+                   <string/>
+                  </property>
+                  <property name="checkable">
+                   <bool>true</bool>
+                  </property>
+                  <property name="checked">
+                   <bool>true</bool>
+                  </property>
+                 </widget>
+                </item>
+                <item>
+                 <widget class="QPushButton" name="BtnOn2">
+                  <property name="enabled">
+                   <bool>true</bool>
+                  </property>
+                  <property name="toolTip">
+                   <string>Plot2</string>
+                  </property>
+                  <property name="text">
+                   <string/>
+                  </property>
+                  <property name="checkable">
+                   <bool>true</bool>
+                  </property>
+                  <property name="checked">
+                   <bool>true</bool>
+                  </property>
+                 </widget>
+                </item>
+                <item>
+                 <widget class="QPushButton" name="BtnOn3">
+                  <property name="enabled">
+                   <bool>true</bool>
+                  </property>
+                  <property name="sizePolicy">
+                   <sizepolicy hsizetype="Fixed" vsizetype="Preferred">
+                    <horstretch>0</horstretch>
+                    <verstretch>0</verstretch>
+                   </sizepolicy>
+                  </property>
+                  <property name="toolTip">
+                   <string>Plot3</string>
+                  </property>
+                  <property name="text">
+                   <string/>
+                  </property>
+                  <property name="checkable">
+                   <bool>true</bool>
+                  </property>
+                  <property name="checked">
+                   <bool>true</bool>
+                  </property>
+                 </widget>
+                </item>
+               </layout>
+              </widget>
+             </item>
+             <item>
+              <widget class="QWidget" name="Panel103" native="true">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="toolTip">
+                <string/>
+               </property>
+               <property name="text" stdset="0">
+                <string/>
+               </property>
+               <layout class="QHBoxLayout" name="horizontalLayout_3">
+                <property name="spacing">
+                 <number>0</number>
+                </property>
+                <property name="leftMargin">
+                 <number>0</number>
+                </property>
+                <property name="topMargin">
+                 <number>0</number>
+                </property>
+                <property name="rightMargin">
+                 <number>0</number>
+                </property>
+                <property name="bottomMargin">
+                 <number>0</number>
+                </property>
+                <item>
+                 <widget class="QComboBox" name="QFlag">
+                  <property name="enabled">
+                   <bool>true</bool>
+                  </property>
+                  <property name="sizePolicy">
+                   <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                    <horstretch>0</horstretch>
+                    <verstretch>0</verstretch>
+                   </sizepolicy>
+                  </property>
+                  <property name="toolTip">
+                   <string>Quality Flag</string>
+                  </property>
+                  <item>
                    <property name="text">
-                    <string/>
-                   </property>
-                   <property name="icon">
-                    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                     <normaloff>:/buttons/connect1.bmp</normaloff>
-                     <normalon>:/buttons/connect2.bmp</normalon>:/buttons/connect1.bmp</iconset>
-                   </property>
-                   <property name="checkable">
-                    <bool>true</bool>
-                   </property>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QToolButton" name="BtnSol1">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="maximumSize">
-                    <size>
-                     <width>25</width>
-                     <height>25</height>
-                    </size>
-                   </property>
-                   <property name="toolTip">
-                    <string>Data 1</string>
+                    <string>ALL</string>
                    </property>
+                  </item>
+                  <item>
                    <property name="text">
-                    <string/>
-                   </property>
-                   <property name="icon">
-                    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                     <normaloff>:/buttons/data1.bmp</normaloff>:/buttons/data1.bmp</iconset>
-                   </property>
-                   <property name="checkable">
-                    <bool>true</bool>
-                   </property>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QToolButton" name="BtnSol2">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="maximumSize">
-                    <size>
-                     <width>25</width>
-                     <height>25</height>
-                    </size>
-                   </property>
-                   <property name="toolTip">
-                    <string>Data 2</string>
+                    <string>Q=1</string>
                    </property>
+                  </item>
+                  <item>
                    <property name="text">
-                    <string/>
-                   </property>
-                   <property name="icon">
-                    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                     <normaloff>:/buttons/data2.bmp</normaloff>:/buttons/data2.bmp</iconset>
-                   </property>
-                   <property name="checkable">
-                    <bool>true</bool>
-                   </property>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QToolButton" name="BtnSol12">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="maximumSize">
-                    <size>
-                     <width>25</width>
-                     <height>25</height>
-                    </size>
-                   </property>
-                   <property name="toolTip">
-                    <string>Data 1-2</string>
+                    <string>Q=2</string>
                    </property>
+                  </item>
+                  <item>
                    <property name="text">
-                    <string/>
-                   </property>
-                   <property name="icon">
-                    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                     <normaloff>:/buttons/data12.bmp</normaloff>:/buttons/data12.bmp</iconset>
-                   </property>
-                   <property name="checkable">
-                    <bool>true</bool>
-                   </property>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QWidget" name="Panel101" native="true">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="toolTip">
-                    <string/>
-                   </property>
-                   <property name="text" stdset="0">
-                    <string/>
-                   </property>
-                   <layout class="QHBoxLayout" name="horizontalLayout_2">
-                    <property name="leftMargin">
-                     <number>0</number>
-                    </property>
-                    <property name="topMargin">
-                     <number>0</number>
-                    </property>
-                    <property name="rightMargin">
-                     <number>0</number>
-                    </property>
-                    <property name="bottomMargin">
-                     <number>0</number>
-                    </property>
-                    <item>
-                     <widget class="QComboBox" name="PlotTypeS">
-                      <property name="enabled">
-                       <bool>true</bool>
-                      </property>
-                      <property name="sizePolicy">
-                       <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                        <horstretch>0</horstretch>
-                        <verstretch>0</verstretch>
-                       </sizepolicy>
-                      </property>
-                      <property name="toolTip">
-                       <string/>
-                      </property>
-                     </widget>
-                    </item>
-                   </layout>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QWidget" name="Panel102" native="true">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="sizePolicy">
-                    <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-                     <horstretch>0</horstretch>
-                     <verstretch>0</verstretch>
-                    </sizepolicy>
-                   </property>
-                   <property name="maximumSize">
-                    <size>
-                     <width>30</width>
-                     <height>30</height>
-                    </size>
-                   </property>
-                   <property name="toolTip">
-                    <string/>
-                   </property>
-                   <property name="text" stdset="0">
-                    <string/>
-                   </property>
-                   <layout class="QVBoxLayout" name="verticalLayout">
-                    <property name="spacing">
-                     <number>0</number>
-                    </property>
-                    <property name="leftMargin">
-                     <number>0</number>
-                    </property>
-                    <property name="topMargin">
-                     <number>0</number>
-                    </property>
-                    <property name="rightMargin">
-                     <number>0</number>
-                    </property>
-                    <property name="bottomMargin">
-                     <number>0</number>
-                    </property>
-                    <item>
-                     <widget class="QPushButton" name="BtnOn1">
-                      <property name="enabled">
-                       <bool>true</bool>
-                      </property>
-                      <property name="toolTip">
-                       <string>Plot1</string>
-                      </property>
-                      <property name="text">
-                       <string/>
-                      </property>
-                      <property name="checkable">
-                       <bool>true</bool>
-                      </property>
-                      <property name="checked">
-                       <bool>true</bool>
-                      </property>
-                     </widget>
-                    </item>
-                    <item>
-                     <widget class="QPushButton" name="BtnOn2">
-                      <property name="enabled">
-                       <bool>true</bool>
-                      </property>
-                      <property name="toolTip">
-                       <string>Plot2</string>
-                      </property>
-                      <property name="text">
-                       <string/>
-                      </property>
-                      <property name="checkable">
-                       <bool>true</bool>
-                      </property>
-                      <property name="checked">
-                       <bool>true</bool>
-                      </property>
-                     </widget>
-                    </item>
-                    <item>
-                     <widget class="QPushButton" name="BtnOn3">
-                      <property name="enabled">
-                       <bool>true</bool>
-                      </property>
-                      <property name="sizePolicy">
-                       <sizepolicy hsizetype="Fixed" vsizetype="Preferred">
-                        <horstretch>0</horstretch>
-                        <verstretch>0</verstretch>
-                       </sizepolicy>
-                      </property>
-                      <property name="toolTip">
-                       <string>Plot3</string>
-                      </property>
-                      <property name="text">
-                       <string/>
-                      </property>
-                      <property name="checkable">
-                       <bool>true</bool>
-                      </property>
-                      <property name="checked">
-                       <bool>true</bool>
-                      </property>
-                     </widget>
-                    </item>
-                   </layout>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QWidget" name="Panel103" native="true">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="toolTip">
-                    <string/>
-                   </property>
-                   <property name="text" stdset="0">
-                    <string/>
-                   </property>
-                   <layout class="QHBoxLayout" name="horizontalLayout_3">
-                    <property name="leftMargin">
-                     <number>0</number>
-                    </property>
-                    <property name="topMargin">
-                     <number>0</number>
-                    </property>
-                    <property name="rightMargin">
-                     <number>0</number>
-                    </property>
-                    <property name="bottomMargin">
-                     <number>0</number>
-                    </property>
-                    <item>
-                     <widget class="QComboBox" name="QFlag">
-                      <property name="enabled">
-                       <bool>true</bool>
-                      </property>
-                      <property name="sizePolicy">
-                       <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                        <horstretch>0</horstretch>
-                        <verstretch>0</verstretch>
-                       </sizepolicy>
-                      </property>
-                      <property name="toolTip">
-                       <string>Quality Flag</string>
-                      </property>
-                      <item>
-                       <property name="text">
-                        <string>ALL</string>
-                       </property>
-                      </item>
-                      <item>
-                       <property name="text">
-                        <string>Q=1</string>
-                       </property>
-                      </item>
-                      <item>
-                       <property name="text">
-                        <string>Q=2</string>
-                       </property>
-                      </item>
-                      <item>
-                       <property name="text">
-                        <string>Q=3</string>
-                       </property>
-                      </item>
-                      <item>
-                       <property name="text">
-                        <string>Q=4</string>
-                       </property>
-                      </item>
-                      <item>
-                       <property name="text">
-                        <string>Q=5</string>
-                       </property>
-                      </item>
-                      <item>
-                       <property name="text">
-                        <string>Q=6</string>
-                       </property>
-                      </item>
-                     </widget>
-                    </item>
-                    <item>
-                     <widget class="QComboBox" name="ObsType2">
-                      <property name="enabled">
-                       <bool>true</bool>
-                      </property>
-                      <property name="sizePolicy">
-                       <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                        <horstretch>0</horstretch>
-                        <verstretch>0</verstretch>
-                       </sizepolicy>
-                      </property>
-                      <property name="toolTip">
-                       <string>Freq Type</string>
-                      </property>
-                      <item>
-                       <property name="text">
-                        <string>L1</string>
-                       </property>
-                      </item>
-                      <item>
-                       <property name="text">
-                        <string>L2</string>
-                       </property>
-                      </item>
-                     </widget>
-                    </item>
-                    <item>
-                     <widget class="QComboBox" name="ObsType">
-                      <property name="enabled">
-                       <bool>true</bool>
-                      </property>
-                      <property name="sizePolicy">
-                       <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                        <horstretch>0</horstretch>
-                        <verstretch>0</verstretch>
-                       </sizepolicy>
-                      </property>
-                      <property name="toolTip">
-                       <string>Obs Type</string>
-                      </property>
-                     </widget>
-                    </item>
-                    <item>
-                     <widget class="QComboBox" name="FrqType">
-                      <property name="enabled">
-                       <bool>true</bool>
-                      </property>
-                      <property name="sizePolicy">
-                       <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                        <horstretch>0</horstretch>
-                        <verstretch>0</verstretch>
-                       </sizepolicy>
-                      </property>
-                      <property name="toolTip">
-                       <string>Freq Type</string>
-                      </property>
-                      <item>
-                       <property name="text">
-                        <string>L1</string>
-                       </property>
-                      </item>
-                      <item>
-                       <property name="text">
-                        <string>L2</string>
-                       </property>
-                      </item>
-                     </widget>
-                    </item>
-                    <item>
-                     <widget class="QComboBox" name="DopType">
-                      <property name="enabled">
-                       <bool>true</bool>
-                      </property>
-                      <property name="sizePolicy">
-                       <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
-                        <horstretch>0</horstretch>
-                        <verstretch>0</verstretch>
-                       </sizepolicy>
-                      </property>
-                      <property name="toolTip">
-                       <string>Dop Type</string>
-                      </property>
-                      <item>
-                       <property name="text">
-                        <string>ALL</string>
-                       </property>
-                      </item>
-                      <item>
-                       <property name="text">
-                        <string>NSAT</string>
-                       </property>
-                      </item>
-                      <item>
-                       <property name="text">
-                        <string>GDOP</string>
-                       </property>
-                      </item>
-                      <item>
-                       <property name="text">
-                        <string>PDOP</string>
-                       </property>
-                      </item>
-                      <item>
-                       <property name="text">
-                        <string>HDOP</string>
-                       </property>
-                      </item>
-                      <item>
-                       <property name="text">
-                        <string>VDOP</string>
-                       </property>
-                      </item>
-                     </widget>
-                    </item>
-                   </layout>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QWidget" name="Panel104" native="true">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="toolTip">
-                    <string/>
-                   </property>
-                   <property name="text" stdset="0">
-                    <string/>
-                   </property>
-                   <layout class="QHBoxLayout" name="horizontalLayout_4">
-                    <property name="leftMargin">
-                     <number>0</number>
-                    </property>
-                    <property name="topMargin">
-                     <number>0</number>
-                    </property>
-                    <property name="rightMargin">
-                     <number>0</number>
-                    </property>
-                    <property name="bottomMargin">
-                     <number>0</number>
-                    </property>
-                    <item>
-                     <widget class="QToolButton" name="BtnCenterOri">
-                      <property name="enabled">
-                       <bool>true</bool>
-                      </property>
-                      <property name="maximumSize">
-                       <size>
-                        <width>25</width>
-                        <height>25</height>
-                       </size>
-                      </property>
-                      <property name="toolTip">
-                       <string>Center Origin</string>
-                      </property>
-                      <property name="text">
-                       <string/>
-                      </property>
-                      <property name="icon">
-                       <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                        <normaloff>:/buttons/trackc.bmp</normaloff>:/buttons/trackc.bmp</iconset>
-                      </property>
-                     </widget>
-                    </item>
-                    <item>
-                     <widget class="QToolButton" name="BtnRangeList">
-                      <property name="enabled">
-                       <bool>true</bool>
-                      </property>
-                      <property name="maximumSize">
-                       <size>
-                        <width>25</width>
-                        <height>25</height>
-                       </size>
-                      </property>
-                      <property name="toolTip">
-                       <string/>
-                      </property>
-                      <property name="text">
-                       <string/>
-                      </property>
-                      <property name="icon">
-                       <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                        <normaloff>:/buttons/down.bmp</normaloff>:/buttons/down.bmp</iconset>
-                      </property>
-                     </widget>
-                    </item>
-                    <item>
-                     <widget class="QComboBox" name="SatList">
-                      <property name="enabled">
-                       <bool>true</bool>
-                      </property>
-                      <property name="sizePolicy">
-                       <sizepolicy hsizetype="MinimumExpanding" vsizetype="Fixed">
-                        <horstretch>0</horstretch>
-                        <verstretch>0</verstretch>
-                       </sizepolicy>
-                      </property>
-                      <property name="toolTip">
-                       <string>Satllite List</string>
-                      </property>
-                      <item>
-                       <property name="text">
-                        <string>ALL</string>
-                       </property>
-                      </item>
-                     </widget>
-                    </item>
-                   </layout>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QToolButton" name="BtnFitHoriz">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="maximumSize">
-                    <size>
-                     <width>25</width>
-                     <height>25</height>
-                    </size>
-                   </property>
-                   <property name="toolTip">
-                    <string>Fit Horizontal</string>
+                    <string>Q=3</string>
                    </property>
+                  </item>
+                  <item>
                    <property name="text">
-                    <string/>
-                   </property>
-                   <property name="icon">
-                    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                     <normaloff>:/buttons/fith.bmp</normaloff>:/buttons/fith.bmp</iconset>
-                   </property>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QToolButton" name="BtnFitVert">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="maximumSize">
-                    <size>
-                     <width>25</width>
-                     <height>25</height>
-                    </size>
-                   </property>
-                   <property name="toolTip">
-                    <string>Fit Vertical</string>
+                    <string>Q=4</string>
                    </property>
+                  </item>
+                  <item>
                    <property name="text">
-                    <string/>
-                   </property>
-                   <property name="icon">
-                    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                     <normaloff>:/buttons/fitv.bmp</normaloff>:/buttons/fitv.bmp</iconset>
-                   </property>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QToolButton" name="BtnShowTrack">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="maximumSize">
-                    <size>
-                     <width>25</width>
-                     <height>25</height>
-                    </size>
-                   </property>
-                   <property name="toolTip">
-                    <string>Show Track Point</string>
+                    <string>Q=5</string>
                    </property>
+                  </item>
+                  <item>
                    <property name="text">
-                    <string/>
-                   </property>
-                   <property name="icon">
-                    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                     <normaloff>:/buttons/point.bmp</normaloff>:/buttons/point.bmp</iconset>
-                   </property>
-                   <property name="checkable">
-                    <bool>true</bool>
-                   </property>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QToolButton" name="BtnShowSkyplot">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="maximumSize">
-                    <size>
-                     <width>25</width>
-                     <height>25</height>
-                    </size>
-                   </property>
-                   <property name="toolTip">
-                    <string>Show Skyplot</string>
+                    <string>Q=6</string>
                    </property>
+                  </item>
+                 </widget>
+                </item>
+                <item>
+                 <widget class="QComboBox" name="ObsType2">
+                  <property name="enabled">
+                   <bool>true</bool>
+                  </property>
+                  <property name="sizePolicy">
+                   <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                    <horstretch>0</horstretch>
+                    <verstretch>0</verstretch>
+                   </sizepolicy>
+                  </property>
+                  <property name="toolTip">
+                   <string>Freq Type</string>
+                  </property>
+                  <item>
                    <property name="text">
-                    <string/>
-                   </property>
-                   <property name="icon">
-                    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                     <normaloff>:/buttons/trackc.bmp</normaloff>:/buttons/trackc.bmp</iconset>
-                   </property>
-                   <property name="checkable">
-                    <bool>true</bool>
-                   </property>
-                   <property name="checked">
-                    <bool>true</bool>
-                   </property>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QToolButton" name="BtnShowGrid">
-                   <property name="minimumSize">
-                    <size>
-                     <width>25</width>
-                     <height>25</height>
-                    </size>
-                   </property>
-                   <property name="toolTip">
-                    <string>Show Grid</string>
+                    <string>L1</string>
                    </property>
+                  </item>
+                  <item>
                    <property name="text">
-                    <string>...</string>
-                   </property>
-                   <property name="icon">
-                    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                     <normaloff>:/buttons/grid.bmp</normaloff>:/buttons/grid.bmp</iconset>
-                   </property>
-                   <property name="checkable">
-                    <bool>true</bool>
-                   </property>
-                   <property name="checked">
-                    <bool>true</bool>
-                   </property>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QToolButton" name="BtnShowImg">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="maximumSize">
-                    <size>
-                     <width>25</width>
-                     <height>25</height>
-                    </size>
-                   </property>
-                   <property name="toolTip">
-                    <string>Map/Sky Image</string>
+                    <string>L2</string>
                    </property>
+                  </item>
+                 </widget>
+                </item>
+                <item>
+                 <widget class="QComboBox" name="ObsType">
+                  <property name="enabled">
+                   <bool>true</bool>
+                  </property>
+                  <property name="sizePolicy">
+                   <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                    <horstretch>0</horstretch>
+                    <verstretch>0</verstretch>
+                   </sizepolicy>
+                  </property>
+                  <property name="toolTip">
+                   <string>Obs Type</string>
+                  </property>
+                 </widget>
+                </item>
+                <item>
+                 <widget class="QComboBox" name="FrqType">
+                  <property name="enabled">
+                   <bool>true</bool>
+                  </property>
+                  <property name="sizePolicy">
+                   <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                    <horstretch>0</horstretch>
+                    <verstretch>0</verstretch>
+                   </sizepolicy>
+                  </property>
+                  <property name="toolTip">
+                   <string>Freq Type</string>
+                  </property>
+                  <item>
                    <property name="text">
-                    <string/>
-                   </property>
-                   <property name="icon">
-                    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                     <normaloff>:/buttons/map.bmp</normaloff>:/buttons/map.bmp</iconset>
-                   </property>
-                   <property name="checkable">
-                    <bool>true</bool>
-                   </property>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QToolButton" name="BtnFixCent">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="maximumSize">
-                    <size>
-                     <width>25</width>
-                     <height>25</height>
-                    </size>
-                   </property>
-                   <property name="toolTip">
-                    <string>Fix Track Center</string>
+                    <string>L1</string>
                    </property>
+                  </item>
+                  <item>
                    <property name="text">
-                    <string/>
-                   </property>
-                   <property name="icon">
-                    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                     <normaloff>:/buttons/trackc.bmp</normaloff>:/buttons/trackc.bmp</iconset>
-                   </property>
-                   <property name="checkable">
-                    <bool>true</bool>
-                   </property>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QToolButton" name="BtnFixHoriz">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="maximumSize">
-                    <size>
-                     <width>25</width>
-                     <height>25</height>
-                    </size>
-                   </property>
-                   <property name="toolTip">
-                    <string>Fix Track Horizotal</string>
+                    <string>L2</string>
                    </property>
+                  </item>
+                 </widget>
+                </item>
+                <item>
+                 <widget class="QComboBox" name="DopType">
+                  <property name="enabled">
+                   <bool>true</bool>
+                  </property>
+                  <property name="sizePolicy">
+                   <sizepolicy hsizetype="Minimum" vsizetype="Fixed">
+                    <horstretch>0</horstretch>
+                    <verstretch>0</verstretch>
+                   </sizepolicy>
+                  </property>
+                  <property name="toolTip">
+                   <string>Dop Type</string>
+                  </property>
+                  <item>
                    <property name="text">
-                    <string/>
-                   </property>
-                   <property name="icon">
-                    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                     <normaloff>:/buttons/track.bmp</normaloff>:/buttons/track.bmp</iconset>
-                   </property>
-                   <property name="checkable">
-                    <bool>true</bool>
-                   </property>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QToolButton" name="BtnFixVert">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="maximumSize">
-                    <size>
-                     <width>25</width>
-                     <height>25</height>
-                    </size>
-                   </property>
-                   <property name="toolTip">
-                    <string>Fix Track Vertical</string>
+                    <string>ALL</string>
                    </property>
+                  </item>
+                  <item>
                    <property name="text">
-                    <string/>
-                   </property>
-                   <property name="icon">
-                    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                     <normaloff>:/buttons/track.bmp</normaloff>:/buttons/track.bmp</iconset>
-                   </property>
-                   <property name="checkable">
-                    <bool>true</bool>
-                   </property>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QToolButton" name="BtnShowMap">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="maximumSize">
-                    <size>
-                     <width>25</width>
-                     <height>25</height>
-                    </size>
-                   </property>
-                   <property name="toolTip">
-                    <string>Show Map/Waypoint</string>
+                    <string>NSAT</string>
                    </property>
+                  </item>
+                  <item>
                    <property name="text">
-                    <string/>
-                   </property>
-                   <property name="icon">
-                    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                     <normaloff>:/buttons/showp.bmp</normaloff>:/buttons/showp.bmp</iconset>
-                   </property>
-                   <property name="checkable">
-                    <bool>true</bool>
-                   </property>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QToolButton" name="BtnGE">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="maximumSize">
-                    <size>
-                     <width>25</width>
-                     <height>25</height>
-                    </size>
-                   </property>
-                   <property name="toolTip">
-                    <string>Google Earth View</string>
+                    <string>GDOP</string>
                    </property>
+                  </item>
+                  <item>
                    <property name="text">
-                    <string/>
-                   </property>
-                   <property name="icon">
-                    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                     <normaloff>:/buttons/ge.bmp</normaloff>:/buttons/ge.bmp</iconset>
-                   </property>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QToolButton" name="BtnGM">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="maximumSize">
-                    <size>
-                     <width>25</width>
-                     <height>25</height>
-                    </size>
-                   </property>
-                   <property name="toolTip">
-                    <string>Google Map View</string>
+                    <string>PDOP</string>
                    </property>
+                  </item>
+                  <item>
                    <property name="text">
-                    <string/>
+                    <string>HDOP</string>
                    </property>
-                   <property name="icon">
-                    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                     <normaloff>:/buttons/gm.bmp</normaloff>:/buttons/gm.bmp</iconset>
+                  </item>
+                  <item>
+                   <property name="text">
+                    <string>VDOP</string>
                    </property>
-                  </widget>
-                 </item>
-                </layout>
-               </widget>
-              </item>
-              <item>
-               <widget class="QWidget" name="Panel12" native="true">
-                <property name="enabled">
-                 <bool>true</bool>
+                  </item>
+                 </widget>
+                </item>
+               </layout>
+              </widget>
+             </item>
+             <item>
+              <widget class="QWidget" name="Panel104" native="true">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="toolTip">
+                <string/>
+               </property>
+               <property name="text" stdset="0">
+                <string/>
+               </property>
+               <layout class="QHBoxLayout" name="horizontalLayout_4">
+                <property name="spacing">
+                 <number>0</number>
                 </property>
-                <property name="sizePolicy">
-                 <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-                  <horstretch>0</horstretch>
-                  <verstretch>0</verstretch>
-                 </sizepolicy>
+                <property name="leftMargin">
+                 <number>0</number>
                 </property>
-                <property name="toolTip">
-                 <string/>
+                <property name="topMargin">
+                 <number>0</number>
                 </property>
-                <property name="text" stdset="0">
-                 <string/>
+                <property name="rightMargin">
+                 <number>0</number>
                 </property>
-                <layout class="QHBoxLayout" name="horizontalLayout_7">
-                 <property name="leftMargin">
-                  <number>0</number>
-                 </property>
-                 <property name="topMargin">
-                  <number>0</number>
-                 </property>
-                 <property name="rightMargin">
-                  <number>0</number>
-                 </property>
-                 <property name="bottomMargin">
-                  <number>0</number>
-                 </property>
-                 <item>
-                  <widget class="QToolButton" name="BtnAnimate">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="maximumSize">
-                    <size>
-                     <width>25</width>
-                     <height>25</height>
-                    </size>
-                   </property>
-                   <property name="toolTip">
-                    <string>Animation</string>
-                   </property>
+                <property name="bottomMargin">
+                 <number>0</number>
+                </property>
+                <item>
+                 <widget class="QToolButton" name="BtnCenterOri">
+                  <property name="enabled">
+                   <bool>true</bool>
+                  </property>
+                  <property name="maximumSize">
+                   <size>
+                    <width>25</width>
+                    <height>25</height>
+                   </size>
+                  </property>
+                  <property name="toolTip">
+                   <string>Center Origin</string>
+                  </property>
+                  <property name="text">
+                   <string/>
+                  </property>
+                  <property name="icon">
+                   <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                    <normaloff>:/buttons/trackc.bmp</normaloff>:/buttons/trackc.bmp</iconset>
+                  </property>
+                 </widget>
+                </item>
+                <item>
+                 <widget class="QToolButton" name="BtnRangeList">
+                  <property name="enabled">
+                   <bool>true</bool>
+                  </property>
+                  <property name="maximumSize">
+                   <size>
+                    <width>25</width>
+                    <height>25</height>
+                   </size>
+                  </property>
+                  <property name="toolTip">
+                   <string/>
+                  </property>
+                  <property name="text">
+                   <string/>
+                  </property>
+                  <property name="icon">
+                   <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                    <normaloff>:/buttons/down.bmp</normaloff>:/buttons/down.bmp</iconset>
+                  </property>
+                 </widget>
+                </item>
+                <item>
+                 <widget class="QComboBox" name="SatList">
+                  <property name="enabled">
+                   <bool>true</bool>
+                  </property>
+                  <property name="sizePolicy">
+                   <sizepolicy hsizetype="MinimumExpanding" vsizetype="Fixed">
+                    <horstretch>0</horstretch>
+                    <verstretch>0</verstretch>
+                   </sizepolicy>
+                  </property>
+                  <property name="toolTip">
+                   <string>Satllite List</string>
+                  </property>
+                  <item>
                    <property name="text">
-                    <string/>
-                   </property>
-                   <property name="icon">
-                    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                     <normaloff>:/buttons/anim1.bmp</normaloff>
-                     <normalon>:/buttons/anim2.bmp</normalon>:/buttons/anim1.bmp</iconset>
-                   </property>
-                   <property name="checkable">
-                    <bool>true</bool>
-                   </property>
-                   <property name="flat" stdset="0">
-                    <bool>true</bool>
-                   </property>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QScrollBar" name="TimeScroll">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="sizePolicy">
-                    <sizepolicy hsizetype="MinimumExpanding" vsizetype="Fixed">
-                     <horstretch>0</horstretch>
-                     <verstretch>0</verstretch>
-                    </sizepolicy>
-                   </property>
-                   <property name="toolTip">
-                    <string>Time Scroll</string>
-                   </property>
-                   <property name="minimum">
-                    <number>0</number>
-                   </property>
-                   <property name="maximum">
-                    <number>0</number>
-                   </property>
-                   <property name="singleStep">
-                    <number>1</number>
-                   </property>
-                   <property name="value">
-                    <number>0</number>
-                   </property>
-                   <property name="orientation">
-                    <enum>Qt::Horizontal</enum>
-                   </property>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QWidget" name="Panel11" native="true">
-                   <property name="enabled">
-                    <bool>true</bool>
-                   </property>
-                   <property name="sizePolicy">
-                    <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-                     <horstretch>0</horstretch>
-                     <verstretch>0</verstretch>
-                    </sizepolicy>
-                   </property>
-                   <property name="toolTip">
-                    <string/>
-                   </property>
-                   <property name="text" stdset="0">
-                    <string/>
+                    <string>ALL</string>
                    </property>
-                   <layout class="QHBoxLayout" name="horizontalLayout_6">
-                    <property name="leftMargin">
-                     <number>0</number>
-                    </property>
-                    <property name="topMargin">
-                     <number>0</number>
-                    </property>
-                    <property name="rightMargin">
-                     <number>0</number>
-                    </property>
-                    <property name="bottomMargin">
-                     <number>0</number>
-                    </property>
-                    <item>
-                     <spacer name="horizontalSpacer_2">
-                      <property name="orientation">
-                       <enum>Qt::Horizontal</enum>
-                      </property>
-                      <property name="sizeHint" stdset="0">
-                       <size>
-                        <width>40</width>
-                        <height>20</height>
-                       </size>
-                      </property>
-                     </spacer>
-                    </item>
-                    <item>
-                     <widget class="QLabel" name="ConnectMsg">
-                      <property name="enabled">
-                       <bool>true</bool>
-                      </property>
-                      <property name="toolTip">
-                       <string/>
-                      </property>
-                      <property name="text">
-                       <string/>
-                      </property>
-                     </widget>
-                    </item>
-                    <item>
-                     <widget class="QToolButton" name="BtnClear">
-                      <property name="enabled">
-                       <bool>true</bool>
-                      </property>
-                      <property name="maximumSize">
-                       <size>
-                        <width>25</width>
-                        <height>25</height>
-                       </size>
-                      </property>
-                      <property name="toolTip">
-                       <string>Clear</string>
-                      </property>
-                      <property name="text">
-                       <string/>
-                      </property>
-                      <property name="icon">
-                       <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                        <normaloff>:/buttons/del.bmp</normaloff>:/buttons/del.bmp</iconset>
-                      </property>
-                     </widget>
-                    </item>
-                    <item>
-                     <widget class="QToolButton" name="BtnReload">
-                      <property name="enabled">
-                       <bool>true</bool>
-                      </property>
-                      <property name="maximumSize">
-                       <size>
-                        <width>25</width>
-                        <height>25</height>
-                       </size>
-                      </property>
-                      <property name="toolTip">
-                       <string>Reload</string>
-                      </property>
-                      <property name="text">
-                       <string/>
-                      </property>
-                      <property name="icon">
-                       <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                        <normaloff>:/buttons/reload.bmp</normaloff>:/buttons/reload.bmp</iconset>
-                      </property>
-                     </widget>
-                    </item>
-                    <item>
-                     <widget class="QWidget" name="StrStatus" native="true">
-                      <layout class="QHBoxLayout" name="horizontalLayout_5">
-                       <item>
-                        <widget class="QLabel" name="StrStatus1">
-                         <property name="enabled">
-                          <bool>true</bool>
-                         </property>
-                         <property name="maximumSize">
-                          <size>
-                           <width>25</width>
-                           <height>25</height>
-                          </size>
-                         </property>
-                         <property name="toolTip">
-                          <string/>
-                         </property>
-                         <property name="frameShape">
-                          <enum>QFrame::Box</enum>
-                         </property>
-                         <property name="frameShadow">
-                          <enum>QFrame::Sunken</enum>
-                         </property>
-                         <property name="text">
-                          <string/>
-                         </property>
-                        </widget>
-                       </item>
-                       <item>
-                        <widget class="QLabel" name="StrStatus2">
-                         <property name="enabled">
-                          <bool>true</bool>
-                         </property>
-                         <property name="maximumSize">
-                          <size>
-                           <width>25</width>
-                           <height>25</height>
-                          </size>
-                         </property>
-                         <property name="toolTip">
-                          <string/>
-                         </property>
-                         <property name="frameShape">
-                          <enum>QFrame::Box</enum>
-                         </property>
-                         <property name="frameShadow">
-                          <enum>QFrame::Sunken</enum>
-                         </property>
-                         <property name="text">
-                          <string/>
-                         </property>
-                        </widget>
-                       </item>
-                      </layout>
-                     </widget>
-                    </item>
-                    <item>
-                     <widget class="QToolButton" name="BtnOptions">
-                      <property name="enabled">
-                       <bool>true</bool>
-                      </property>
-                      <property name="maximumSize">
-                       <size>
-                        <width>25</width>
-                        <height>25</height>
-                       </size>
-                      </property>
-                      <property name="toolTip">
-                       <string>Options</string>
-                      </property>
-                      <property name="text">
-                       <string/>
-                      </property>
-                      <property name="icon">
-                       <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-                        <normaloff>:/buttons/toolbmp</normaloff>:/buttons/toolbmp</iconset>
-                      </property>
-                     </widget>
-                    </item>
-                   </layout>
-                  </widget>
-                 </item>
-                </layout>
-               </widget>
-              </item>
-             </layout>
-            </widget>
-           </item>
-           <item>
-            <widget class="QLabel" name="Disp">
-             <property name="sizePolicy">
-              <sizepolicy hsizetype="Ignored" vsizetype="Ignored">
-               <horstretch>0</horstretch>
-               <verstretch>0</verstretch>
-              </sizepolicy>
-             </property>
-             <property name="alignment">
-              <set>Qt::AlignCenter</set>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <widget class="QListWidget" name="RangeList">
-             <property name="enabled">
-              <bool>true</bool>
-             </property>
-             <property name="sizePolicy">
-              <sizepolicy hsizetype="Expanding" vsizetype="Fixed">
-               <horstretch>0</horstretch>
-               <verstretch>0</verstretch>
-              </sizepolicy>
-             </property>
-             <property name="toolTip">
-              <string/>
-             </property>
-             <item>
-              <property name="text">
-               <string>0.05</string>
-              </property>
-             </item>
-             <item>
-              <property name="text">
-               <string>0.1</string>
-              </property>
-             </item>
-             <item>
-              <property name="text">
-               <string>0.2</string>
-              </property>
-             </item>
-             <item>
-              <property name="text">
-               <string>0.5</string>
-              </property>
-             </item>
-             <item>
-              <property name="text">
-               <string>1</string>
-              </property>
-             </item>
-             <item>
-              <property name="text">
-               <string>2</string>
-              </property>
-             </item>
-             <item>
-              <property name="text">
-               <string>5</string>
-              </property>
-             </item>
-             <item>
-              <property name="text">
-               <string>10</string>
-              </property>
+                  </item>
+                 </widget>
+                </item>
+               </layout>
+              </widget>
              </item>
              <item>
-              <property name="text">
-               <string>20</string>
-              </property>
+              <widget class="QToolButton" name="BtnFitHoriz">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="maximumSize">
+                <size>
+                 <width>25</width>
+                 <height>25</height>
+                </size>
+               </property>
+               <property name="toolTip">
+                <string>Fit Horizontal</string>
+               </property>
+               <property name="text">
+                <string/>
+               </property>
+               <property name="icon">
+                <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                 <normaloff>:/buttons/fith.bmp</normaloff>:/buttons/fith.bmp</iconset>
+               </property>
+              </widget>
              </item>
              <item>
-              <property name="text">
-               <string>50</string>
-              </property>
+              <widget class="QToolButton" name="BtnFitVert">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="maximumSize">
+                <size>
+                 <width>25</width>
+                 <height>25</height>
+                </size>
+               </property>
+               <property name="toolTip">
+                <string>Fit Vertical</string>
+               </property>
+               <property name="text">
+                <string/>
+               </property>
+               <property name="icon">
+                <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                 <normaloff>:/buttons/fitv.bmp</normaloff>:/buttons/fitv.bmp</iconset>
+               </property>
+              </widget>
              </item>
              <item>
-              <property name="text">
-               <string>100</string>
-              </property>
+              <widget class="QToolButton" name="BtnShowTrack">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="maximumSize">
+                <size>
+                 <width>25</width>
+                 <height>25</height>
+                </size>
+               </property>
+               <property name="toolTip">
+                <string>Show Track Point</string>
+               </property>
+               <property name="text">
+                <string/>
+               </property>
+               <property name="icon">
+                <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                 <normaloff>:/buttons/point.bmp</normaloff>:/buttons/point.bmp</iconset>
+               </property>
+               <property name="checkable">
+                <bool>true</bool>
+               </property>
+              </widget>
              </item>
              <item>
-              <property name="text">
-               <string>200</string>
-              </property>
+              <widget class="QToolButton" name="BtnShowSkyplot">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="maximumSize">
+                <size>
+                 <width>25</width>
+                 <height>25</height>
+                </size>
+               </property>
+               <property name="toolTip">
+                <string>Show Skyplot</string>
+               </property>
+               <property name="text">
+                <string/>
+               </property>
+               <property name="icon">
+                <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                 <normaloff>:/buttons/trackc.bmp</normaloff>:/buttons/trackc.bmp</iconset>
+               </property>
+               <property name="checkable">
+                <bool>true</bool>
+               </property>
+               <property name="checked">
+                <bool>true</bool>
+               </property>
+              </widget>
              </item>
              <item>
-              <property name="text">
-               <string>500</string>
-              </property>
+              <widget class="QToolButton" name="BtnShowImg">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="maximumSize">
+                <size>
+                 <width>25</width>
+                 <height>25</height>
+                </size>
+               </property>
+               <property name="toolTip">
+                <string>Map/Sky Image</string>
+               </property>
+               <property name="text">
+                <string/>
+               </property>
+               <property name="icon">
+                <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                 <normaloff>:/buttons/map.bmp</normaloff>:/buttons/map.bmp</iconset>
+               </property>
+               <property name="checkable">
+                <bool>true</bool>
+               </property>
+              </widget>
              </item>
              <item>
-              <property name="text">
-               <string>1000</string>
-              </property>
+              <widget class="QToolButton" name="BtnFixCent">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="maximumSize">
+                <size>
+                 <width>25</width>
+                 <height>25</height>
+                </size>
+               </property>
+               <property name="toolTip">
+                <string>Fix Track Center</string>
+               </property>
+               <property name="text">
+                <string/>
+               </property>
+               <property name="icon">
+                <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                 <normaloff>:/buttons/trackc.bmp</normaloff>:/buttons/trackc.bmp</iconset>
+               </property>
+               <property name="checkable">
+                <bool>true</bool>
+               </property>
+              </widget>
              </item>
              <item>
-              <property name="text">
-               <string>2000</string>
-              </property>
+              <widget class="QToolButton" name="BtnFixHoriz">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="maximumSize">
+                <size>
+                 <width>25</width>
+                 <height>25</height>
+                </size>
+               </property>
+               <property name="toolTip">
+                <string>Fix Track Horizotal</string>
+               </property>
+               <property name="text">
+                <string/>
+               </property>
+               <property name="icon">
+                <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                 <normaloff>:/buttons/track.bmp</normaloff>:/buttons/track.bmp</iconset>
+               </property>
+               <property name="checkable">
+                <bool>true</bool>
+               </property>
+              </widget>
              </item>
              <item>
-              <property name="text">
-               <string>5000</string>
-              </property>
+              <widget class="QToolButton" name="BtnFixVert">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="maximumSize">
+                <size>
+                 <width>25</width>
+                 <height>25</height>
+                </size>
+               </property>
+               <property name="toolTip">
+                <string>Fix Track Vertical</string>
+               </property>
+               <property name="text">
+                <string/>
+               </property>
+               <property name="icon">
+                <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                 <normaloff>:/buttons/track.bmp</normaloff>:/buttons/track.bmp</iconset>
+               </property>
+               <property name="checkable">
+                <bool>true</bool>
+               </property>
+              </widget>
              </item>
              <item>
-              <property name="text">
-               <string>10000</string>
-              </property>
+              <widget class="QToolButton" name="BtnShowMap">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="maximumSize">
+                <size>
+                 <width>25</width>
+                 <height>25</height>
+                </size>
+               </property>
+               <property name="toolTip">
+                <string>Show Map/Waypoint</string>
+               </property>
+               <property name="text">
+                <string/>
+               </property>
+               <property name="icon">
+                <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                 <normaloff>:/buttons/showp.bmp</normaloff>:/buttons/showp.bmp</iconset>
+               </property>
+               <property name="checkable">
+                <bool>true</bool>
+               </property>
+              </widget>
              </item>
              <item>
-              <property name="text">
-               <string>50000</string>
-              </property>
+              <widget class="QToolButton" name="BtnGE">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="maximumSize">
+                <size>
+                 <width>25</width>
+                 <height>25</height>
+                </size>
+               </property>
+               <property name="toolTip">
+                <string>Google Earth View</string>
+               </property>
+               <property name="text">
+                <string/>
+               </property>
+               <property name="icon">
+                <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                 <normaloff>:/buttons/ge.bmp</normaloff>:/buttons/ge.bmp</iconset>
+               </property>
+              </widget>
              </item>
              <item>
-              <property name="text">
-               <string>100000</string>
-              </property>
+              <widget class="QToolButton" name="BtnGM">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="maximumSize">
+                <size>
+                 <width>25</width>
+                 <height>25</height>
+                </size>
+               </property>
+               <property name="toolTip">
+                <string>Google Map View</string>
+               </property>
+               <property name="text">
+                <string/>
+               </property>
+               <property name="icon">
+                <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                 <normaloff>:/buttons/gm.bmp</normaloff>:/buttons/gm.bmp</iconset>
+               </property>
+              </widget>
              </item>
-            </widget>
-           </item>
-          </layout>
-         </widget>
-         <widget class="QWidget" name="PanelBrowse" native="true">
-          <layout class="QVBoxLayout" name="verticalLayout1">
-           <item>
-            <widget class="QWidget" name="Panel13" native="true">
-             <property name="enabled">
-              <bool>true</bool>
-             </property>
-             <property name="sizePolicy">
-              <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-               <horstretch>0</horstretch>
-               <verstretch>0</verstretch>
-              </sizepolicy>
-             </property>
-             <property name="toolTip">
-              <string/>
-             </property>
-             <property name="layoutDirection">
-              <enum>Qt::LeftToRight</enum>
-             </property>
-             <property name="text" stdset="0">
-              <string/>
-             </property>
-             <layout class="QHBoxLayout" name="horizontalLayout_51">
-              <property name="spacing">
-               <number>0</number>
-              </property>
-              <property name="leftMargin">
-               <number>0</number>
-              </property>
-              <property name="topMargin">
-               <number>0</number>
-              </property>
-              <property name="rightMargin">
-               <number>0</number>
-              </property>
-              <property name="bottomMargin">
-               <number>0</number>
-              </property>
-              <item>
-               <widget class="QComboBox" name="DriveSel"/>
-              </item>
-             </layout>
-            </widget>
-           </item>
-           <item>
-            <widget class="QWidget" name="Panel2" native="true">
-             <property name="enabled">
-              <bool>true</bool>
+            </layout>
+           </widget>
+          </item>
+          <item>
+           <widget class="QWidget" name="Panel12" native="true">
+            <property name="enabled">
+             <bool>true</bool>
+            </property>
+            <property name="sizePolicy">
+             <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
+              <horstretch>0</horstretch>
+              <verstretch>0</verstretch>
+             </sizepolicy>
+            </property>
+            <property name="toolTip">
+             <string/>
+            </property>
+            <property name="text" stdset="0">
+             <string/>
+            </property>
+            <layout class="QHBoxLayout" name="horizontalLayout_7">
+             <property name="spacing">
+              <number>0</number>
              </property>
-             <property name="sizePolicy">
-              <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-               <horstretch>0</horstretch>
-               <verstretch>0</verstretch>
-              </sizepolicy>
+             <property name="leftMargin">
+              <number>0</number>
              </property>
-             <property name="toolTip">
-              <string/>
+             <property name="topMargin">
+              <number>0</number>
              </property>
-             <property name="layoutDirection">
-              <enum>Qt::LeftToRight</enum>
+             <property name="rightMargin">
+              <number>0</number>
              </property>
-             <property name="text" stdset="0">
-              <string/>
+             <property name="bottomMargin">
+              <number>0</number>
              </property>
-             <layout class="QVBoxLayout" name="verticalLayout_21">
-              <property name="spacing">
-               <number>0</number>
-              </property>
-              <property name="leftMargin">
-               <number>0</number>
-              </property>
-              <property name="topMargin">
-               <number>0</number>
-              </property>
-              <property name="rightMargin">
-               <number>0</number>
-              </property>
-              <item>
-               <widget class="QWidget" name="Panel5" native="true">
-                <property name="enabled">
-                 <bool>true</bool>
+             <item>
+              <widget class="QToolButton" name="BtnAnimate">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="maximumSize">
+                <size>
+                 <width>25</width>
+                 <height>25</height>
+                </size>
+               </property>
+               <property name="toolTip">
+                <string>Animation</string>
+               </property>
+               <property name="text">
+                <string/>
+               </property>
+               <property name="icon">
+                <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                 <normaloff>:/buttons/anim1.bmp</normaloff>
+                 <normalon>:/buttons/anim2.bmp</normalon>:/buttons/anim1.bmp</iconset>
+               </property>
+               <property name="checkable">
+                <bool>true</bool>
+               </property>
+               <property name="flat" stdset="0">
+                <bool>true</bool>
+               </property>
+              </widget>
+             </item>
+             <item>
+              <widget class="QScrollBar" name="TimeScroll">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="sizePolicy">
+                <sizepolicy hsizetype="MinimumExpanding" vsizetype="Fixed">
+                 <horstretch>0</horstretch>
+                 <verstretch>0</verstretch>
+                </sizepolicy>
+               </property>
+               <property name="toolTip">
+                <string>Time Scroll</string>
+               </property>
+               <property name="minimum">
+                <number>0</number>
+               </property>
+               <property name="maximum">
+                <number>0</number>
+               </property>
+               <property name="singleStep">
+                <number>1</number>
+               </property>
+               <property name="value">
+                <number>0</number>
+               </property>
+               <property name="orientation">
+                <enum>Qt::Horizontal</enum>
+               </property>
+              </widget>
+             </item>
+             <item>
+              <widget class="QWidget" name="Panel11" native="true">
+               <property name="enabled">
+                <bool>true</bool>
+               </property>
+               <property name="sizePolicy">
+                <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
+                 <horstretch>0</horstretch>
+                 <verstretch>0</verstretch>
+                </sizepolicy>
+               </property>
+               <property name="toolTip">
+                <string/>
+               </property>
+               <property name="text" stdset="0">
+                <string/>
+               </property>
+               <layout class="QHBoxLayout" name="horizontalLayout_6">
+                <property name="spacing">
+                 <number>0</number>
                 </property>
-                <property name="toolTip">
-                 <string/>
+                <property name="leftMargin">
+                 <number>0</number>
                 </property>
-                <property name="layoutDirection">
-                 <enum>Qt::LeftToRight</enum>
+                <property name="topMargin">
+                 <number>0</number>
                 </property>
-                <property name="editable" stdset="0">
-                 <bool>true</bool>
+                <property name="rightMargin">
+                 <number>0</number>
                 </property>
-                <property name="text" stdset="0">
-                 <string/>
+                <property name="bottomMargin">
+                 <number>0</number>
                 </property>
-                <layout class="QHBoxLayout" name="horizontalLayout1">
-                 <property name="spacing">
-                  <number>0</number>
-                 </property>
-                 <property name="leftMargin">
-                  <number>0</number>
-                 </property>
-                 <property name="topMargin">
-                  <number>0</number>
-                 </property>
-                 <property name="rightMargin">
-                  <number>0</number>
-                 </property>
-                 <property name="bottomMargin">
-                  <number>0</number>
-                 </property>
-                 <item>
-                  <widget class="QLabel" name="DirSelected">
-                   <property name="text">
-                    <string>TextLabel</string>
-                   </property>
-                  </widget>
-                 </item>
-                 <item>
-                  <widget class="QToolButton" name="BtnDirSel">
-                   <property name="text">
-                    <string>...</string>
-                   </property>
-                  </widget>
-                 </item>
-                </layout>
-               </widget>
-              </item>
-             </layout>
-            </widget>
-           </item>
-           <item>
-            <widget class="QListView" name="FileList">
-             <property name="frameShape">
-              <enum>QFrame::StyledPanel</enum>
-             </property>
-            </widget>
-           </item>
-           <item>
-            <widget class="QWidget" name="Panel3" native="true">
-             <property name="enabled">
-              <bool>true</bool>
-             </property>
-             <property name="sizePolicy">
-              <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-               <horstretch>0</horstretch>
-               <verstretch>0</verstretch>
-              </sizepolicy>
-             </property>
-             <property name="toolTip">
-              <string/>
-             </property>
-             <property name="layoutDirection">
-              <enum>Qt::LeftToRight</enum>
-             </property>
-             <property name="text" stdset="0">
-              <string>Panel3</string>
-             </property>
-             <layout class="QHBoxLayout" name="horizontalLayout_21">
-              <property name="spacing">
-               <number>0</number>
-              </property>
-              <property name="leftMargin">
-               <number>0</number>
-              </property>
-              <property name="topMargin">
-               <number>0</number>
-              </property>
-              <property name="rightMargin">
-               <number>0</number>
-              </property>
-              <property name="bottomMargin">
-               <number>0</number>
-              </property>
-              <item>
-               <widget class="QComboBox" name="Filter">
                 <item>
-                 <property name="text">
-                  <string>Position File (*.pos *.nmea)</string>
-                 </property>
+                 <spacer name="horizontalSpacer_2">
+                  <property name="orientation">
+                   <enum>Qt::Horizontal</enum>
+                  </property>
+                  <property name="sizeHint" stdset="0">
+                   <size>
+                    <width>40</width>
+                    <height>20</height>
+                   </size>
+                  </property>
+                 </spacer>
                 </item>
                 <item>
-                 <property name="text">
-                  <string>All (*.*)</string>
-                 </property>
+                 <widget class="QLabel" name="ConnectMsg">
+                  <property name="enabled">
+                   <bool>true</bool>
+                  </property>
+                  <property name="toolTip">
+                   <string/>
+                  </property>
+                  <property name="text">
+                   <string/>
+                  </property>
+                 </widget>
                 </item>
-               </widget>
-              </item>
-             </layout>
-            </widget>
-           </item>
-          </layout>
-         </widget>
+                <item>
+                 <widget class="QToolButton" name="BtnClear">
+                  <property name="enabled">
+                   <bool>true</bool>
+                  </property>
+                  <property name="maximumSize">
+                   <size>
+                    <width>25</width>
+                    <height>25</height>
+                   </size>
+                  </property>
+                  <property name="toolTip">
+                   <string>Clear</string>
+                  </property>
+                  <property name="text">
+                   <string/>
+                  </property>
+                  <property name="icon">
+                   <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                    <normaloff>:/buttons/del.bmp</normaloff>:/buttons/del.bmp</iconset>
+                  </property>
+                 </widget>
+                </item>
+                <item>
+                 <widget class="QToolButton" name="BtnReload">
+                  <property name="enabled">
+                   <bool>true</bool>
+                  </property>
+                  <property name="maximumSize">
+                   <size>
+                    <width>25</width>
+                    <height>25</height>
+                   </size>
+                  </property>
+                  <property name="toolTip">
+                   <string>Reload</string>
+                  </property>
+                  <property name="text">
+                   <string/>
+                  </property>
+                  <property name="icon">
+                   <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                    <normaloff>:/buttons/reload.bmp</normaloff>:/buttons/reload.bmp</iconset>
+                  </property>
+                 </widget>
+                </item>
+                <item>
+                 <widget class="QLabel" name="StrStatus1">
+                  <property name="enabled">
+                   <bool>true</bool>
+                  </property>
+                  <property name="maximumSize">
+                   <size>
+                    <width>25</width>
+                    <height>25</height>
+                   </size>
+                  </property>
+                  <property name="toolTip">
+                   <string/>
+                  </property>
+                  <property name="frameShape">
+                   <enum>QFrame::Box</enum>
+                  </property>
+                  <property name="frameShadow">
+                   <enum>QFrame::Sunken</enum>
+                  </property>
+                  <property name="text">
+                   <string/>
+                  </property>
+                 </widget>
+                </item>
+                <item>
+                 <widget class="QLabel" name="StrStatus2">
+                  <property name="enabled">
+                   <bool>true</bool>
+                  </property>
+                  <property name="maximumSize">
+                   <size>
+                    <width>25</width>
+                    <height>25</height>
+                   </size>
+                  </property>
+                  <property name="toolTip">
+                   <string/>
+                  </property>
+                  <property name="frameShape">
+                   <enum>QFrame::Box</enum>
+                  </property>
+                  <property name="frameShadow">
+                   <enum>QFrame::Sunken</enum>
+                  </property>
+                  <property name="text">
+                   <string/>
+                  </property>
+                 </widget>
+                </item>
+                <item>
+                 <widget class="QToolButton" name="BtnOptions">
+                  <property name="enabled">
+                   <bool>true</bool>
+                  </property>
+                  <property name="maximumSize">
+                   <size>
+                    <width>25</width>
+                    <height>25</height>
+                   </size>
+                  </property>
+                  <property name="toolTip">
+                   <string>Options</string>
+                  </property>
+                  <property name="text">
+                   <string/>
+                  </property>
+                  <property name="icon">
+                   <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+                    <normaloff>:/buttons/toolbmp</normaloff>:/buttons/toolbmp</iconset>
+                  </property>
+                 </widget>
+                </item>
+               </layout>
+              </widget>
+             </item>
+            </layout>
+           </widget>
+          </item>
+         </layout>
+        </widget>
+       </item>
+       <item>
+        <widget class="QLabel" name="Disp">
+         <property name="sizePolicy">
+          <sizepolicy hsizetype="MinimumExpanding" vsizetype="MinimumExpanding">
+           <horstretch>0</horstretch>
+           <verstretch>0</verstretch>
+          </sizepolicy>
+         </property>
+         <property name="alignment">
+          <set>Qt::AlignCenter</set>
+         </property>
+        </widget>
+       </item>
+       <item>
+        <widget class="QListWidget" name="RangeList">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="sizePolicy">
+          <sizepolicy hsizetype="Expanding" vsizetype="Fixed">
+           <horstretch>0</horstretch>
+           <verstretch>0</verstretch>
+          </sizepolicy>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <item>
+          <property name="text">
+           <string>0.05</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>0.1</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>0.2</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>0.5</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>1</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>2</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>5</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>10</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>20</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>50</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>100</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>200</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>500</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>1000</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>2000</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>5000</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>10000</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>50000</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>100000</string>
+          </property>
+         </item>
         </widget>
        </item>
       </layout>
@@ -1565,7 +1348,7 @@
     <rect>
      <x>0</x>
      <y>0</y>
-     <width>1596</width>
+     <width>1124</width>
      <height>27</height>
     </rect>
    </property>
@@ -1586,6 +1369,8 @@
     <addaction name="MenuOpenShape"/>
     <addaction name="MenuOpenWaypoint"/>
     <addaction name="separator"/>
+    <addaction name="MenuFileSel"/>
+    <addaction name="separator"/>
     <addaction name="MenuOpenObs"/>
     <addaction name="MenuOpenNav"/>
     <addaction name="MenuOpenElevMask"/>
@@ -1643,7 +1428,6 @@
     </property>
     <addaction name="MenuToolBar"/>
     <addaction name="MenuStatusBar"/>
-    <addaction name="MenuBrowse"/>
     <addaction name="separator"/>
     <addaction name="MenuGE"/>
     <addaction name="MenuGM"/>
@@ -1661,7 +1445,6 @@
     <addaction name="MenuFixVert"/>
     <addaction name="separator"/>
     <addaction name="MenuShowSkyplot"/>
-    <addaction name="MenuShowGrid"/>
     <addaction name="MenuShowImg"/>
     <addaction name="MenuShowMap"/>
     <addaction name="separator"/>
@@ -2416,29 +2199,6 @@
     <string>Ma&amp;p Layer...</string>
    </property>
   </action>
-  <action name="MenuBrowse">
-   <property name="checkable">
-    <bool>true</bool>
-   </property>
-   <property name="text">
-    <string>Show &amp;Browse Panel</string>
-   </property>
-  </action>
-  <action name="MenuShowGrid">
-   <property name="checkable">
-    <bool>true</bool>
-   </property>
-   <property name="icon">
-    <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-     <normaloff>:/buttons/grid.bmp</normaloff>:/buttons/grid.bmp</iconset>
-   </property>
-   <property name="text">
-    <string>Show Gri&amp;d</string>
-   </property>
-   <property name="toolTip">
-    <string>Show Grid</string>
-   </property>
-  </action>
  </widget>
  <resources>
   <include location="../rtkconv_qt/rtkconv_qt.qrc"/>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotopt.cpp RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotopt.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotopt.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotopt.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -20,266 +20,250 @@
 //---------------------------------------------------------------------------
 //---------------------------------------------------------------------------
 PlotOptDialog::PlotOptDialog(QWidget *parent)
-    : QDialog(parent)
+   : QDialog(parent)
 {
     setupUi(this);
 
-    refDialog = new RefDialog(this);
+    refDialog= new RefDialog(this);
 
-    QCompleter *fileCompleter = new QCompleter(this);
-    QFileSystemModel *fileModel = new QFileSystemModel(fileCompleter);
+    QCompleter *fileCompleter=new QCompleter(this);
+    QFileSystemModel *fileModel=new QFileSystemModel(fileCompleter);
     fileModel->setRootPath("");
     fileCompleter->setModel(fileModel);
     TLEFile->setCompleter(fileCompleter);
     TLESatFile->setCompleter(fileCompleter);
 
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(BtnColor1, SIGNAL(clicked(bool)), this, SLOT(BtnColor1Click()));
-    connect(BtnColor2, SIGNAL(clicked(bool)), this, SLOT(BtnColor2Click()));
-    connect(BtnColor3, SIGNAL(clicked(bool)), this, SLOT(BtnColor3Click()));
-    connect(BtnColor4, SIGNAL(clicked(bool)), this, SLOT(BtnColor4Click()));
-    connect(BtnFont, SIGNAL(clicked(bool)), this, SLOT(BtnFontClick()));
-    connect(BtnOK, SIGNAL(clicked(bool)), this, SLOT(BtnOKClick()));
-    connect(BtnRefPos, SIGNAL(clicked(bool)), this, SLOT(BtnRefPosClick()));
-    connect(BtnTLEFile, SIGNAL(clicked(bool)), this, SLOT(BtnTLEFileClick()));
-    connect(BtnTLESatFile, SIGNAL(clicked(bool)), this, SLOT(BtnTLESatFileClick()));
-    connect(BtnTLESatView, SIGNAL(clicked(bool)), this, SLOT(BtnTLESatViewClick()));
-    connect(BtnTLEView, SIGNAL(clicked(bool)), this, SLOT(BtnTLEViewClick()));
-    connect(Origin, SIGNAL(currentIndexChanged(int)), this, SLOT(OriginChange()));
-    connect(AutoScale, SIGNAL(currentIndexChanged(int)), this, SLOT(AutoScaleChange()));
-    connect(RcvPos, SIGNAL(currentIndexChanged(int)), this, SLOT(RcvPosChange()));
-    connect(MColor1, SIGNAL(clicked(bool)), this, SLOT(MColorClick()));
-    connect(MColor2, SIGNAL(clicked(bool)), this, SLOT(MColorClick()));
-    connect(MColor3, SIGNAL(clicked(bool)), this, SLOT(MColorClick()));
-    connect(MColor4, SIGNAL(clicked(bool)), this, SLOT(MColorClick()));
-    connect(MColor5, SIGNAL(clicked(bool)), this, SLOT(MColorClick()));
-    connect(MColor6, SIGNAL(clicked(bool)), this, SLOT(MColorClick()));
-    connect(MColor7, SIGNAL(clicked(bool)), this, SLOT(MColorClick()));
-    connect(MColor8, SIGNAL(clicked(bool)), this, SLOT(MColorClick()));
-    connect(MColor9, SIGNAL(clicked(bool)), this, SLOT(MColorClick()));
-    connect(MColor10, SIGNAL(clicked(bool)), this, SLOT(MColorClick()));
-    connect(MColor11, SIGNAL(clicked(bool)), this, SLOT(MColorClick()));
-    connect(MColor12, SIGNAL(clicked(bool)), this, SLOT(MColorClick()));
-    connect(ChkTimeSync, SIGNAL(clicked(bool)), this, SLOT(ChkTimeSyncClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(BtnColor1,SIGNAL(clicked(bool)),this,SLOT(BtnColor1Click()));
+    connect(BtnColor2,SIGNAL(clicked(bool)),this,SLOT(BtnColor2Click()));
+    connect(BtnColor3,SIGNAL(clicked(bool)),this,SLOT(BtnColor3Click()));
+    connect(BtnColor4,SIGNAL(clicked(bool)),this,SLOT(BtnColor4Click()));
+    connect(BtnFont,SIGNAL(clicked(bool)),this,SLOT(BtnFontClick()));
+    connect(BtnOK,SIGNAL(clicked(bool)),this,SLOT(BtnOKClick()));
+    connect(BtnRefPos,SIGNAL(clicked(bool)),this,SLOT(BtnRefPosClick()));
+    connect(BtnTLEFile,SIGNAL(clicked(bool)),this,SLOT(BtnTLEFileClick()));
+    connect(BtnTLESatFile,SIGNAL(clicked(bool)),this,SLOT(BtnTLESatFileClick()));
+    connect(BtnTLESatView,SIGNAL(clicked(bool)),this,SLOT(BtnTLESatViewClick()));
+    connect(BtnTLEView,SIGNAL(clicked(bool)),this,SLOT(BtnTLEViewClick()));
+    connect(Origin,SIGNAL(currentIndexChanged(int)),this,SLOT(OriginChange()));
+    connect(AutoScale,SIGNAL(currentIndexChanged(int)),this,SLOT(AutoScaleChange()));
+    connect(RcvPos,SIGNAL(currentIndexChanged(int)),this,SLOT(RcvPosChange()));
+    connect(MColor1,SIGNAL(clicked(bool)),this,SLOT(MColorClick()));
+    connect(MColor2,SIGNAL(clicked(bool)),this,SLOT(MColorClick()));
+    connect(MColor3,SIGNAL(clicked(bool)),this,SLOT(MColorClick()));
+    connect(MColor4,SIGNAL(clicked(bool)),this,SLOT(MColorClick()));
+    connect(MColor5,SIGNAL(clicked(bool)),this,SLOT(MColorClick()));
+    connect(MColor6,SIGNAL(clicked(bool)),this,SLOT(MColorClick()));
+    connect(MColor7,SIGNAL(clicked(bool)),this,SLOT(MColorClick()));
+    connect(MColor8,SIGNAL(clicked(bool)),this,SLOT(MColorClick()));
+    connect(MColor9,SIGNAL(clicked(bool)),this,SLOT(MColorClick()));
+    connect(MColor10,SIGNAL(clicked(bool)),this,SLOT(MColorClick()));
+    connect(MColor11,SIGNAL(clicked(bool)),this,SLOT(MColorClick()));
+    connect(MColor12,SIGNAL(clicked(bool)),this,SLOT(MColorClick()));
 }
 //---------------------------------------------------------------------------
 void PlotOptDialog::showEvent(QShowEvent *event)
 {
-    int i, marks[] = { 1, 2, 3, 4, 5, 10, 15, 20 };
-
+    int i,marks[]={1,2,3,4,5,10,15,20};
+    
     if (event->spontaneous()) return;
 
-    TimeLabel->setCurrentIndex(plot->TimeLabel);
-    LatLonFmt->setCurrentIndex(plot->LatLonFmt);
-    AutoScale->setCurrentIndex(plot->AutoScale);
-    ShowStats->setCurrentIndex(plot->ShowStats);
-    ShowArrow->setCurrentIndex(plot->ShowArrow);
-    ShowSlip->setCurrentIndex(plot->ShowSlip);
-    ShowHalfC->setCurrentIndex(plot->ShowHalfC);
-    ShowErr->setCurrentIndex(plot->ShowErr);
-    ShowEph->setCurrentIndex(plot->ShowEph);
-    ShowLabel->setCurrentIndex(plot->ShowLabel);
-    ShowGLabel->setCurrentIndex(plot->ShowGLabel);
-    ShowScale->setCurrentIndex(plot->ShowScale);
+    TimeLabel  ->setCurrentIndex(plot->TimeLabel);
+    LatLonFmt  ->setCurrentIndex(plot->LatLonFmt);
+    AutoScale  ->setCurrentIndex(plot->AutoScale);
+    ShowStats  ->setCurrentIndex(plot->ShowStats);
+    ShowArrow  ->setCurrentIndex(plot->ShowArrow);
+    ShowSlip   ->setCurrentIndex(plot->ShowSlip);
+    ShowHalfC  ->setCurrentIndex(plot->ShowHalfC);
+    ShowErr    ->setCurrentIndex(plot->ShowErr);
+    ShowEph    ->setCurrentIndex(plot->ShowEph);
+    ShowLabel  ->setCurrentIndex(plot->ShowLabel);
+    ShowGLabel ->setCurrentIndex(plot->ShowGLabel);
+    ShowScale  ->setCurrentIndex(plot->ShowScale);
     ShowCompass->setCurrentIndex(plot->ShowCompass);
-    PlotStyle->setCurrentIndex(plot->PlotStyle);
-
-    for (i = 0; i < 8; i++)
-        if (marks[i] == plot->MarkSize) MarkSize->setCurrentIndex(i);
-
-    for (int i = 0; i < 8; i++)
-        for (int j = 0; j < 2; j++)
-            MColor[j][i] = plot->MColor[j][i];
-
-    for (int i = 0; i < 4; i++)
-        CColor[i] = plot->CColor[i];
+    PlotStyle  ->setCurrentIndex(plot->PlotStyle);
+    for (i=0;i<8;i++) {
+        if (marks[i]==plot->MarkSize) MarkSize->setCurrentIndex(i);
+    }
+    for (int i=0;i<8;i++)
+        for (int j=0;j<2;j++)
+            MColor[j][i]=plot->MColor[j][i];
+    for (int i=0;i<4;i++)
+        CColor[i]=plot->CColor[i];
 
-    MColor1->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[0][1])));
-    MColor2->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[0][2])));
-    MColor3->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[0][3])));
-    MColor4->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[0][4])));
-    MColor5->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[0][5])));
-    MColor6->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[0][6])));
-    MColor7->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[1][1])));
-    MColor8->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[1][2])));
-    MColor9->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[1][3])));
+    MColor1 ->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[0][1])));
+    MColor2 ->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[0][2])));
+    MColor3 ->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[0][3])));
+    MColor4 ->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[0][4])));
+    MColor5 ->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[0][5])));
+    MColor6 ->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[0][6])));
+    MColor7 ->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[1][1])));
+    MColor8 ->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[1][2])));
+    MColor9 ->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[1][3])));
     MColor10->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[1][4])));
     MColor11->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[1][5])));
     MColor12->setStyleSheet(QString("background-color: %1;").arg(color2String(plot->MColor[1][6])));
-    Color1->setStyleSheet(QString("QLabel {background-color: %1;}").arg(color2String(plot->CColor[0])));
-    Color2->setStyleSheet(QString("QLabel {background-color: %1;}").arg(color2String(plot->CColor[1])));
-    Color3->setStyleSheet(QString("QLabel {background-color: %1;}").arg(color2String(plot->CColor[2])));
-    Color4->setStyleSheet(QString("QLabel {background-color: %1;}").arg(color2String(plot->CColor[3])));
-
-    FontOpt = plot->Font;
+    Color1 ->setStyleSheet(QString("QLabel {background-color: %1;}").arg(color2String(plot->CColor[0])));
+    Color2 ->setStyleSheet(QString("QLabel {background-color: %1;}").arg(color2String(plot->CColor[1])));
+    Color3 ->setStyleSheet(QString("QLabel {background-color: %1;}").arg(color2String(plot->CColor[2])));
+    Color4 ->setStyleSheet(QString("QLabel {background-color: %1;}").arg(color2String(plot->CColor[3])));
+    
+    FontOpt=plot->Font;
     UpdateFont();
-
-    ElMask->setCurrentText(QString::number(plot->ElMask));
-    MaxDop->setCurrentText(QString::number(plot->MaxDop));
-    MaxMP->setCurrentText(QString::number(plot->MaxMP));
-    YRange->setCurrentText(QString::number(plot->YRange));
-    Origin->setCurrentIndex(plot->Origin);
-    RcvPos->setCurrentIndex(plot->RcvPos);
-    RefPos1->setValue(plot->OOPos[0] * R2D);
-    RefPos2->setValue(plot->OOPos[1] * R2D);
-    RefPos3->setValue(plot->OOPos[2]);
-    NavSys1->setChecked(plot->NavSys & SYS_GPS);
-    NavSys2->setChecked(plot->NavSys & SYS_GLO);
-    NavSys3->setChecked(plot->NavSys & SYS_GAL);
-    NavSys4->setChecked(plot->NavSys & SYS_QZS);
-    NavSys5->setChecked(plot->NavSys & SYS_SBS);
-    NavSys6->setChecked(plot->NavSys & SYS_CMP);
-    NavSys7->setChecked(plot->NavSys & SYS_IRN);
+    
+    ElMask ->setCurrentText(QString::number(plot->ElMask));
+    MaxDop ->setCurrentText(QString::number(plot->MaxDop));
+    MaxMP  ->setCurrentText(QString::number(plot->MaxMP ));
+    YRange ->setCurrentText(QString::number(plot->YRange));
+    Origin ->setCurrentIndex(plot->Origin);
+    RcvPos ->setCurrentIndex(plot->RcvPos);
+    RefPos1->setText(QString::number(plot->OOPos[0]*R2D));
+    RefPos2->setText(QString::number(plot->OOPos[1]*R2D));
+    RefPos3->setText(QString::number(plot->OOPos[2]));
+    NavSys1->setChecked(plot->NavSys&SYS_GPS);
+    NavSys2->setChecked(plot->NavSys&SYS_GLO);
+    NavSys3->setChecked(plot->NavSys&SYS_GAL);
+    NavSys4->setChecked(plot->NavSys&SYS_QZS);
+    NavSys5->setChecked(plot->NavSys&SYS_SBS);
+    NavSys6->setChecked(plot->NavSys&SYS_CMP);
+    NavSys7->setChecked(plot->NavSys&SYS_IRN);
     AnimCycle->setCurrentText(QString::number(plot->AnimCycle));
-    RefCycle->setValue(plot->RefCycle);
+    RefCycle ->setText(QString::number(plot->RefCycle ));
     HideLowSat->setCurrentIndex(plot->HideLowSat);
     ElMaskP->setCurrentIndex(plot->ElMaskP);
     ExSats->setText(plot->ExSats);
-    BuffSize->setValue(plot->RtBuffSize);
-    ChkTimeSync->setChecked(plot->TimeSyncOut);
-    EditTimeSync->setValue(plot->TimeSyncPort);
-    QcCmd->setText(plot->QcCmd);
+    BuffSize->setText(QString::number(plot->RtBuffSize));
+    QcCmd  ->setText(plot->QcCmd);
     RnxOpts->setText(plot->RnxOpts);
-    ApiKey ->setText(plot->ApiKey);
     TLEFile->setText(plot->TLEFile);
     TLESatFile->setText(plot->TLESatFile);
-
+    
     UpdateEnable();
 }
 //---------------------------------------------------------------------------
 void PlotOptDialog::BtnOKClick()
 {
-    int marks[] = { 1, 2, 3, 4, 5, 10, 15, 20 };
-
-    plot->TimeLabel = TimeLabel->currentIndex();
-    plot->LatLonFmt = LatLonFmt->currentIndex();
-    plot->AutoScale = AutoScale->currentIndex();
-    plot->ShowStats = ShowStats->currentIndex();
-    plot->ShowArrow = ShowArrow->currentIndex();
-    plot->ShowSlip = ShowSlip->currentIndex();
-    plot->ShowHalfC = ShowHalfC->currentIndex();
-    plot->ShowErr = ShowErr->currentIndex();
-    plot->ShowEph = ShowEph->currentIndex();
-    plot->ShowLabel = ShowLabel->currentIndex();
-    plot->ShowGLabel = ShowGLabel->currentIndex();
-    plot->ShowScale = ShowScale->currentIndex();
-    plot->ShowCompass = ShowCompass->currentIndex();
-    plot->PlotStyle = PlotStyle->currentIndex();
-    plot->MarkSize = marks[MarkSize->currentIndex()];
-
-    for (int i = 0; i < 8; i++)
-        for (int j = 0; j < 2; j++)
-            plot->MColor[j][i] = MColor[j][i];
-
-    for (int i = 0; i < 4; i++)
-        plot->CColor[i] = CColor[i];
-
-    plot->Font = FontOpt;
+    int marks[]={1,2,3,4,5,10,15,20};
+    
+    plot->TimeLabel  =TimeLabel  ->currentIndex();
+    plot->LatLonFmt  =LatLonFmt  ->currentIndex();
+    plot->AutoScale  =AutoScale  ->currentIndex();
+    plot->ShowStats  =ShowStats  ->currentIndex();
+    plot->ShowArrow  =ShowArrow  ->currentIndex();
+    plot->ShowSlip   =ShowSlip   ->currentIndex();
+    plot->ShowHalfC  =ShowHalfC  ->currentIndex();
+    plot->ShowErr    =ShowErr    ->currentIndex();
+    plot->ShowEph    =ShowEph    ->currentIndex();
+    plot->ShowLabel  =ShowLabel  ->currentIndex();
+    plot->ShowGLabel =ShowGLabel ->currentIndex();
+    plot->ShowScale  =ShowScale  ->currentIndex();
+    plot->ShowCompass=ShowCompass->currentIndex();
+    plot->PlotStyle  =PlotStyle  ->currentIndex();
+    plot->MarkSize=marks[MarkSize->currentIndex()];
+    for (int i=0;i<8;i++)
+        for (int j=0;j<2;j++)
+            plot->MColor[j][i]=MColor[j][i];
+    for (int i=0;i<4;i++)
+        plot->CColor[i]=CColor[i];
 
-    plot->ElMask = ElMask->currentText().toDouble();
-    plot->MaxDop = MaxDop->currentText().toDouble();
-    plot->MaxMP = MaxMP->currentText().toDouble();
-    plot->YRange = YRange->currentText().toDouble();
-    plot->Origin = Origin->currentIndex();
-    plot->RcvPos = RcvPos->currentIndex();
-    plot->OOPos[0] = RefPos1->value() * D2R;
-    plot->OOPos[1] = RefPos2->value() * D2R;
-    plot->OOPos[2] = RefPos3->value();
-    plot->NavSys = (NavSys1->isChecked() ? SYS_GPS : 0) |
-               (NavSys2->isChecked() ? SYS_GLO : 0) |
-               (NavSys3->isChecked() ? SYS_GAL : 0) |
-               (NavSys4->isChecked() ? SYS_QZS : 0) |
-               (NavSys5->isChecked() ? SYS_SBS : 0) |
-               (NavSys6->isChecked() ? SYS_CMP : 0) |
-               (NavSys7->isChecked() ? SYS_IRN : 0);
-    plot->AnimCycle = AnimCycle->currentText().toInt();
-    plot->RefCycle = RefCycle->value();
-    plot->HideLowSat = HideLowSat->currentIndex();
-    plot->ElMaskP = ElMaskP->currentIndex();
-    plot->RtBuffSize = BuffSize->value();
-    plot->TimeSyncOut = ChkTimeSync->isChecked();
-    plot->TimeSyncPort = EditTimeSync->value();
-    plot->ExSats = ExSats->text();
-    plot->QcCmd = QcCmd->text();
-    plot->RnxOpts = RnxOpts->text();
-    plot->ApiKey = ApiKey->text();
-    plot->TLEFile = TLEFile->text();
-    plot->TLESatFile = TLESatFile->text();
+    plot->Font=FontOpt;
+    
+    plot->ElMask=ElMask->currentText().toDouble();
+    plot->MaxDop=MaxDop->currentText().toDouble();
+    plot->MaxMP =MaxMP ->currentText().toDouble();
+    plot->YRange=YRange->currentText().toDouble();
+    plot->Origin=Origin->currentIndex();
+    plot->RcvPos=RcvPos->currentIndex();
+    plot->OOPos[0]=RefPos1->text().toDouble()*D2R;
+    plot->OOPos[1]=RefPos2->text().toDouble()*D2R;
+    plot->OOPos[2]=RefPos3->text().toDouble();
+    plot->NavSys=(NavSys1->isChecked()?SYS_GPS:0)|
+                 (NavSys2->isChecked()?SYS_GLO:0)|
+                 (NavSys3->isChecked()?SYS_GAL:0)|
+                 (NavSys4->isChecked()?SYS_QZS:0)|
+                 (NavSys5->isChecked()?SYS_SBS:0)|
+                 (NavSys6->isChecked()?SYS_CMP:0)|
+                 (NavSys7->isChecked()?SYS_IRN:0);
+    plot->AnimCycle=AnimCycle->currentText().toInt();
+    plot->RefCycle =RefCycle ->text().toInt();
+    plot->HideLowSat=HideLowSat->currentIndex();
+    plot->ElMaskP=ElMaskP->currentIndex();
+    plot->RtBuffSize=BuffSize->text().toDouble();
+    plot->ExSats=ExSats->text();
+    plot->QcCmd =QcCmd->text();
+    plot->RnxOpts=RnxOpts->text();
+    plot->TLEFile=TLEFile->text();
+    plot->TLESatFile=TLESatFile->text();
 
     accept();
 }
 //---------------------------------------------------------------------------
 void PlotOptDialog::MColorClick()
 {
-    QToolButton *button = dynamic_cast<QToolButton *>(QObject::sender());
-
+    QToolButton *button=dynamic_cast<QToolButton *>(QObject::sender());
     if (!button) return;
 
     QColorDialog dialog(this);
-    QColor *current = &MColor[0][1];
+    QColor *current=&MColor[0][1];
 
-    if (button == MColor1) current = &MColor[0][1];
-    if (button == MColor2) current = &MColor[0][2];
-    if (button == MColor3) current = &MColor[0][3];
-    if (button == MColor4) current = &MColor[0][4];
-    if (button == MColor5) current = &MColor[0][5];
-    if (button == MColor6) current = &MColor[0][6];
-    if (button == MColor7) current = &MColor[1][1];
-    if (button == MColor8) current = &MColor[1][2];
-    if (button == MColor9) current = &MColor[1][3];
-    if (button == MColor10) current = &MColor[1][4];
-    if (button == MColor11) current = &MColor[1][5];
-    if (button == MColor12) current = &MColor[1][6];
+    if (button==MColor1)  current=&MColor[0][1];
+    if (button==MColor2)  current=&MColor[0][2];
+    if (button==MColor3)  current=&MColor[0][3];
+    if (button==MColor4)  current=&MColor[0][4];
+    if (button==MColor5)  current=&MColor[0][5];
+    if (button==MColor6)  current=&MColor[0][6];
+    if (button==MColor7)  current=&MColor[1][1];
+    if (button==MColor8)  current=&MColor[1][2];
+    if (button==MColor9)  current=&MColor[1][3];
+    if (button==MColor10) current=&MColor[1][4];
+    if (button==MColor11) current=&MColor[1][5];
+    if (button==MColor12) current=&MColor[1][6];
     dialog.setCurrentColor(*current);
 
     dialog.exec();
-    if (dialog.result() != QDialog::Accepted) return;
+    if (dialog.result()!=QDialog::Accepted) return;
     button->setStyleSheet(QString("background-color: %1").arg(color2String(dialog.currentColor())));
-    *current = dialog.currentColor();
+    *current=dialog.currentColor();
 }
 //---------------------------------------------------------------------------
 void PlotOptDialog::BtnColor1Click()
 {
     QColorDialog dialog(this);
-
     dialog.setCurrentColor(CColor[0]);
     dialog.exec();
-    if (dialog.result() != QDialog::Accepted) return;
+    if (dialog.result()!=QDialog::Accepted) return;
     Color1->setStyleSheet(QString("QLabel {background-color: %1;}").arg(color2String(dialog.currentColor())));
-    CColor[0] = dialog.currentColor();
+    CColor[0]=dialog.currentColor();
 }
 //---------------------------------------------------------------------------
 void PlotOptDialog::BtnColor2Click()
 {
     QColorDialog dialog(this);
-
     dialog.setCurrentColor(CColor[1]);
     dialog.exec();
-    if (dialog.result() != QDialog::Accepted) return;
+    if (dialog.result()!=QDialog::Accepted) return;
     Color2->setStyleSheet(QString("QLabel {background-color: %1;}").arg(color2String(dialog.currentColor())));
-    CColor[1] = dialog.currentColor();
+    CColor[1]=dialog.currentColor();
 }
 //---------------------------------------------------------------------------
 void PlotOptDialog::BtnColor3Click()
 {
     QColorDialog dialog(this);
-
     dialog.setCurrentColor(CColor[2]);
     dialog.exec();
-    if (dialog.result() != QDialog::Accepted) return;
+    if (dialog.result()!=QDialog::Accepted) return;
     Color3->setStyleSheet(QString("QLabel {background-color: %1;}").arg(color2String(dialog.currentColor())));
-    CColor[2] = dialog.currentColor();
+    CColor[2]=dialog.currentColor();
 }
 //---------------------------------------------------------------------------
 void PlotOptDialog::BtnColor4Click()
 {
     QColorDialog dialog(this);
-
     dialog.setCurrentColor(CColor[3]);
     dialog.exec();
-    if (dialog.result() != QDialog::Accepted) return;
+    if (dialog.result()!=QDialog::Accepted) return;
     Color4->setStyleSheet(QString("QLabel {background-color: %1;}").arg(color2String(dialog.currentColor())));
-    CColor[3] = dialog.currentColor();
+    CColor[3]=dialog.currentColor();
 }
 //---------------------------------------------------------------------------
 void PlotOptDialog::BtnFontClick()
@@ -289,40 +273,40 @@
     dialog.setCurrentFont(FontOpt);
     dialog.exec();
 
-    if (dialog.result() != QDialog::Accepted) return;
-    FontOpt = dialog.currentFont();
+    if (dialog.result()!=QDialog::Accepted) return;
+    FontOpt=dialog.currentFont();
     UpdateFont();
 }
 //---------------------------------------------------------------------------
 void PlotOptDialog::BtnQcCmdClick()
 {
-    QcCmd->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Open"))));
+    QcCmd->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Open"))));
 }
 //---------------------------------------------------------------------------
 void PlotOptDialog::BtnTLEFileClick()
 {
-    TLEFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Open"), QString(), tr("Text Files (*.txt);;Position Files (*.pos *.snx);;All (*.*)"))));
+    TLEFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Open"),QString(),tr("Text Files (*.txt);;Position Files (*.pos *.snx);;All (*.*)"))));
 }
 //---------------------------------------------------------------------------
 void PlotOptDialog::BtnTLESatFileClick()
 {
-    TLESatFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Open"), QString(), tr("Text Files (*.txt);;Position Files (*.pos *.snx);;All (*.*)"))));
+    TLESatFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Open"),QString(),tr("Text Files (*.txt);;Position Files (*.pos *.snx);;All (*.*)"))));
 }
 //---------------------------------------------------------------------------
 void PlotOptDialog::BtnRefPosClick()
 {
-    refDialog->RovPos[0] = RefPos1->value();
-    refDialog->RovPos[1] = RefPos2->value();
-    refDialog->RovPos[2] = RefPos3->value();
-    refDialog->move(pos().x() + size().width() / 2 - refDialog->size().width() / 2,
-            pos().y() + size().height() / 2 - refDialog->size().height() / 2);
+    refDialog->RovPos[0]=RefPos1->text().toDouble();
+    refDialog->RovPos[1]=RefPos2->text().toDouble();
+    refDialog->RovPos[2]=RefPos3->text().toDouble();
+    refDialog->move(pos().x()+size().width()/2-refDialog->size().width()/2,
+        pos().y()+size().height()/2-refDialog->size().height()/2);
 
     refDialog->exec();
 
-    if (refDialog->result() != QDialog::Accepted) return;
-    RefPos1->setValue(refDialog->Pos[0]);
-    RefPos2->setValue(refDialog->Pos[1]);
-    RefPos3->setValue(refDialog->Pos[2]);
+    if (refDialog->result()!=QDialog::Accepted) return;
+    RefPos1->setText(QString::number(refDialog->Pos[0]));
+    RefPos2->setText(QString::number(refDialog->Pos[1]));
+    RefPos3->setText(QString::number(refDialog->Pos[2]));
 }
 //---------------------------------------------------------------------------
 void PlotOptDialog::AutoScaleChange()
@@ -338,17 +322,16 @@
 void PlotOptDialog::UpdateFont(void)
 {
     FontLabel->setFont(FontOpt);
-    FontLabel->setText(FontOpt.family() + " " + QString::number(FontOpt.pointSize()) + " pt");
+    FontLabel->setText(FontOpt.family()+" "+QString::number(FontOpt.pointSize())+" pt");
 }
 //---------------------------------------------------------------------------
 void PlotOptDialog::UpdateEnable(void)
 {
-    RefPos1->setEnabled(Origin->currentIndex() == 5 || RcvPos->currentIndex() == 1);
-    RefPos2->setEnabled(Origin->currentIndex() == 5 || RcvPos->currentIndex() == 1);
-    RefPos3->setEnabled(Origin->currentIndex() == 5 || RcvPos->currentIndex() == 1);
-    LabelRefPos->setEnabled(Origin->currentIndex() == 5 || Origin->currentIndex() == 6 || RcvPos->currentIndex() == 1);
-    BtnRefPos->setEnabled(Origin->currentIndex() == 5 || Origin->currentIndex() == 6 || RcvPos->currentIndex() == 1);
-    EditTimeSync->setEnabled(ChkTimeSync->isChecked());
+    RefPos1    ->setEnabled(Origin->currentIndex()==5||RcvPos->currentIndex()==1);
+    RefPos2    ->setEnabled(Origin->currentIndex()==5||RcvPos->currentIndex()==1);
+    RefPos3    ->setEnabled(Origin->currentIndex()==5||RcvPos->currentIndex()==1);
+    LabelRefPos->setEnabled(Origin->currentIndex()==5||Origin->currentIndex()==6||RcvPos->currentIndex()==1);
+    BtnRefPos  ->setEnabled(Origin->currentIndex()==5||Origin->currentIndex()==6||RcvPos->currentIndex()==1);
 }
 //---------------------------------------------------------------------------
 void PlotOptDialog::RcvPosChange()
@@ -359,10 +342,10 @@
 void PlotOptDialog::BtnTLEViewClick()
 {
     TextViewer *viewer;
-    QString file = TLEFile->text();
-
-    if (file == "") return;
-    viewer = new TextViewer(this);
+    QString file=TLEFile->text();
+    
+    if (file=="") return;
+    viewer=new TextViewer(this);
     viewer->setWindowTitle(file);
     viewer->show();
     viewer->Read(file);
@@ -371,17 +354,13 @@
 void PlotOptDialog::BtnTLESatViewClick()
 {
     TextViewer *viewer;
-    QString file = TLESatFile->text();
-
-    if (file == "") return;
-    viewer = new TextViewer(this);
+    QString file=TLESatFile->text();
+    
+    if (file=="") return;
+    viewer=new TextViewer(this);
     viewer->setWindowTitle(file);
     viewer->show();
     viewer->Read(file);
 }
 //---------------------------------------------------------------------------
-void PlotOptDialog::ChkTimeSyncClick()
-{
-    UpdateEnable();
-}
-//---------------------------------------------------------------------------
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotopt.h RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotopt.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotopt.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotopt.h	2019-08-19 02:04:50.000000000 +0300
@@ -34,7 +34,6 @@
     void BtnTLESatFileClick();
     void BtnTLEViewClick();
     void BtnTLESatViewClick();
-    void ChkTimeSyncClick();
 
 private:
     void UpdateFont(void);
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotopt.ui RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotopt.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/plotopt.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/plotopt.ui	2019-08-19 02:04:50.000000000 +0300
@@ -7,7 +7,7 @@
     <x>0</x>
     <y>0</y>
     <width>1015</width>
-    <height>690</height>
+    <height>660</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -32,8 +32,21 @@
       <string/>
      </property>
      <layout class="QGridLayout" name="gridLayout_2">
-      <item row="1" column="7" colspan="3">
-       <widget class="QComboBox" name="ShowErr">
+      <item row="5" column="1">
+       <widget class="QLabel" name="Label16">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>Parity Unknown</string>
+        </property>
+       </widget>
+      </item>
+      <item row="9" column="3">
+       <widget class="QComboBox" name="HideLowSat">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -47,17 +60,12 @@
         </item>
         <item>
          <property name="text">
-          <string>Bar/Circle</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>Dots</string>
+          <string>ON</string>
          </property>
         </item>
        </widget>
       </item>
-      <item row="3" column="12" colspan="2">
+      <item row="3" column="12" colspan="6">
        <widget class="QLabel" name="Color4">
         <property name="enabled">
          <bool>true</bool>
@@ -82,8 +90,8 @@
         </property>
        </widget>
       </item>
-      <item row="10" column="15">
-       <widget class="QPushButton" name="BtnFont">
+      <item row="14" column="19">
+       <widget class="QPushButton" name="BtnRefPos">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -135,8 +143,8 @@
         </property>
        </widget>
       </item>
-      <item row="14" column="10" colspan="2">
-       <widget class="QLabel" name="Label27">
+      <item row="14" column="1" colspan="2">
+       <widget class="QLabel" name="Label31">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -144,12 +152,12 @@
          <string/>
         </property>
         <property name="text">
-         <string>Update Cycle</string>
+         <string>Receiver Position</string>
         </property>
        </widget>
       </item>
-      <item row="20" column="1">
-       <widget class="QLabel" name="LabelExSats">
+      <item row="8" column="4" colspan="3">
+       <widget class="QLabel" name="Label8">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -157,85 +165,78 @@
          <string/>
         </property>
         <property name="text">
-         <string>Excluded Sats</string>
+         <string>Y-Range (+/-)</string>
         </property>
        </widget>
       </item>
-      <item row="12" column="3">
-       <widget class="QComboBox" name="MaxDop">
+      <item row="19" column="1">
+       <widget class="QLabel" name="Label36">
         <property name="enabled">
          <bool>true</bool>
         </property>
         <property name="toolTip">
          <string/>
         </property>
-        <item>
-         <property name="text">
-          <string>10</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>30</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>50</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>100</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>200</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>500</string>
-         </property>
-        </item>
+        <property name="text">
+         <string>(+Sn: Included)</string>
+        </property>
        </widget>
       </item>
-      <item row="7" column="10">
-       <widget class="QLabel" name="Label2">
+      <item row="17" column="19">
+       <widget class="QPushButton" name="BtnTLEFile">
         <property name="enabled">
          <bool>true</bool>
         </property>
+        <property name="palette">
+         <palette>
+          <active>
+           <colorrole role="WindowText">
+            <brush brushstyle="SolidPattern">
+             <color alpha="255">
+              <red>0</red>
+              <green>0</green>
+              <blue>0</blue>
+             </color>
+            </brush>
+           </colorrole>
+          </active>
+          <inactive>
+           <colorrole role="WindowText">
+            <brush brushstyle="SolidPattern">
+             <color alpha="255">
+              <red>0</red>
+              <green>0</green>
+              <blue>0</blue>
+             </color>
+            </brush>
+           </colorrole>
+          </inactive>
+          <disabled>
+           <colorrole role="WindowText">
+            <brush brushstyle="SolidPattern">
+             <color alpha="255">
+              <red>0</red>
+              <green>0</green>
+              <blue>0</blue>
+             </color>
+            </brush>
+           </colorrole>
+          </disabled>
+         </palette>
+        </property>
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string>Plot Style</string>
-        </property>
-       </widget>
-      </item>
-      <item row="3" column="3">
-       <widget class="QComboBox" name="ShowStats">
-        <property name="enabled">
-         <bool>true</bool>
+         <string>...</string>
         </property>
-        <property name="toolTip">
-         <string/>
+        <property name="flat">
+         <bool>false</bool>
         </property>
-        <item>
-         <property name="text">
-          <string>OFF</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>ON</string>
-         </property>
-        </item>
        </widget>
       </item>
-      <item row="3" column="4" colspan="2">
-       <widget class="QLabel" name="Label20">
+      <item row="1" column="4" colspan="3">
+       <widget class="QLabel" name="Label19">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -243,63 +244,45 @@
          <string/>
         </property>
         <property name="text">
-         <string>Graph Label</string>
+         <string>Error Bar/Circle</string>
         </property>
        </widget>
       </item>
-      <item row="2" column="4" colspan="3">
-       <widget class="QLabel" name="Label4">
+      <item row="7" column="7" colspan="3">
+       <widget class="QComboBox" name="AutoScale">
         <property name="enabled">
          <bool>true</bool>
         </property>
         <property name="toolTip">
          <string/>
         </property>
-        <property name="text">
-         <string>Direction Arrow</string>
-        </property>
-       </widget>
-      </item>
-      <item row="14" column="12" colspan="4">
-       <widget class="QSpinBox" name="RefCycle">
-        <property name="suffix">
-         <string> ms</string>
-        </property>
-        <property name="maximum">
-         <number>100000</number>
-        </property>
-        <property name="value">
-         <number>100</number>
-        </property>
+        <item>
+         <property name="text">
+          <string>OFF</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>ON</string>
+         </property>
+        </item>
        </widget>
       </item>
-      <item row="6" column="12" colspan="2">
-       <widget class="QLabel" name="Color1">
+      <item row="8" column="10">
+       <widget class="QLabel" name="Label10">
         <property name="enabled">
          <bool>true</bool>
         </property>
         <property name="toolTip">
          <string/>
         </property>
-        <property name="layoutDirection">
-         <enum>Qt::LeftToRight</enum>
-        </property>
-        <property name="frameShape">
-         <enum>QFrame::Box</enum>
-        </property>
-        <property name="frameShadow">
-         <enum>QFrame::Sunken</enum>
-        </property>
         <property name="text">
-         <string/>
-        </property>
-        <property name="alignment">
-         <set>Qt::AlignCenter</set>
+         <string>Mark Size</string>
         </property>
        </widget>
       </item>
-      <item row="21" column="1">
-       <widget class="QLabel" name="Label36">
+      <item row="9" column="1" colspan="2">
+       <widget class="QLabel" name="Label25">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -307,12 +290,12 @@
          <string/>
         </property>
         <property name="text">
-         <string>(+Sn: Included)</string>
+         <string>Hide Low Satellite</string>
         </property>
        </widget>
       </item>
-      <item row="5" column="7" colspan="3">
-       <widget class="QComboBox" name="ShowCompass">
+      <item row="14" column="3">
+       <widget class="QComboBox" name="RcvPos">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -321,18 +304,23 @@
         </property>
         <item>
          <property name="text">
-          <string>OFF</string>
+          <string>Single Solution</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>ON</string>
+          <string>Lat/Lon/Hgt</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>RINEX Header</string>
          </property>
         </item>
        </widget>
       </item>
-      <item row="4" column="3">
-       <widget class="QComboBox" name="ShowSlip">
+      <item row="6" column="7" colspan="3">
+       <widget class="QComboBox" name="ShowScale">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -346,34 +334,13 @@
         </item>
         <item>
          <property name="text">
-          <string>LG Jump</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>LLI Flag</string>
+          <string>ON</string>
          </property>
         </item>
        </widget>
       </item>
-      <item row="15" column="6" colspan="2">
-       <widget class="QDoubleSpinBox" name="RefPos1">
-        <property name="suffix">
-         <string>°</string>
-        </property>
-        <property name="decimals">
-         <number>9</number>
-        </property>
-        <property name="minimum">
-         <double>-90.000000000000000</double>
-        </property>
-        <property name="maximum">
-         <double>90.000000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="5" column="3">
-       <widget class="QComboBox" name="ShowHalfC">
+      <item row="8" column="7" colspan="3">
+       <widget class="QComboBox" name="YRange">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -382,24 +349,24 @@
         </property>
         <item>
          <property name="text">
-          <string>OFF</string>
+          <string>0.05</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>ON</string>
+          <string>0.1</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>0.2</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>0.5</string>
          </property>
         </item>
-       </widget>
-      </item>
-      <item row="12" column="12" colspan="4">
-       <widget class="QComboBox" name="AnimCycle">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
         <item>
          <property name="text">
           <string>1</string>
@@ -435,10 +402,30 @@
           <string>100</string>
          </property>
         </item>
+        <item>
+         <property name="text">
+          <string>500</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>1000</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>5000</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>10000</string>
+         </property>
+        </item>
        </widget>
       </item>
-      <item row="20" column="3">
-       <widget class="QLineEdit" name="ExSats">
+      <item row="6" column="1">
+       <widget class="QLabel" name="Label24">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -446,25 +433,50 @@
          <string/>
         </property>
         <property name="text">
+         <string>Ephemeris</string>
+        </property>
+       </widget>
+      </item>
+      <item row="14" column="8" colspan="3">
+       <widget class="QLineEdit" name="RefPos2">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
          <string/>
         </property>
+        <property name="text">
+         <string>0</string>
+        </property>
        </widget>
       </item>
-      <item row="17" column="4">
-       <widget class="QLabel" name="Label30">
+      <item row="6" column="12" colspan="6">
+       <widget class="QLabel" name="Color1">
         <property name="enabled">
          <bool>true</bool>
         </property>
         <property name="toolTip">
          <string/>
         </property>
+        <property name="layoutDirection">
+         <enum>Qt::LeftToRight</enum>
+        </property>
+        <property name="frameShape">
+         <enum>QFrame::Box</enum>
+        </property>
+        <property name="frameShadow">
+         <enum>QFrame::Sunken</enum>
+        </property>
         <property name="text">
-         <string>QC Cmd</string>
+         <string/>
+        </property>
+        <property name="alignment">
+         <set>Qt::AlignCenter</set>
         </property>
        </widget>
       </item>
-      <item row="20" column="6" colspan="8">
-       <widget class="QLineEdit" name="TLESatFile">
+      <item row="14" column="11" colspan="7">
+       <widget class="QLineEdit" name="RefPos3">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -472,12 +484,25 @@
          <string/>
         </property>
         <property name="text">
+         <string>0</string>
+        </property>
+       </widget>
+      </item>
+      <item row="18" column="1">
+       <widget class="QLabel" name="LabelExSats">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
          <string/>
         </property>
+        <property name="text">
+         <string>Excluded Sats</string>
+        </property>
        </widget>
       </item>
-      <item row="3" column="15">
-       <widget class="QPushButton" name="BtnColor4">
+      <item row="18" column="19">
+       <widget class="QPushButton" name="BtnTLESatFile">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -529,66 +554,149 @@
         </property>
        </widget>
       </item>
-      <item row="12" column="4">
-       <widget class="QCheckBox" name="ChkTimeSync">
+      <item row="6" column="10" colspan="2">
+       <widget class="QLabel" name="Label1">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
         <property name="text">
-         <string>Time Sync Port</string>
+         <string>Background Color</string>
         </property>
        </widget>
       </item>
-      <item row="4" column="12" colspan="2">
-       <widget class="QLabel" name="Color3">
+      <item row="5" column="19">
+       <widget class="QPushButton" name="BtnColor2">
         <property name="enabled">
          <bool>true</bool>
         </property>
+        <property name="palette">
+         <palette>
+          <active>
+           <colorrole role="WindowText">
+            <brush brushstyle="SolidPattern">
+             <color alpha="255">
+              <red>0</red>
+              <green>0</green>
+              <blue>0</blue>
+             </color>
+            </brush>
+           </colorrole>
+          </active>
+          <inactive>
+           <colorrole role="WindowText">
+            <brush brushstyle="SolidPattern">
+             <color alpha="255">
+              <red>0</red>
+              <green>0</green>
+              <blue>0</blue>
+             </color>
+            </brush>
+           </colorrole>
+          </inactive>
+          <disabled>
+           <colorrole role="WindowText">
+            <brush brushstyle="SolidPattern">
+             <color alpha="255">
+              <red>0</red>
+              <green>0</green>
+              <blue>0</blue>
+             </color>
+            </brush>
+           </colorrole>
+          </disabled>
+         </palette>
+        </property>
         <property name="toolTip">
          <string/>
         </property>
-        <property name="layoutDirection">
-         <enum>Qt::LeftToRight</enum>
+        <property name="text">
+         <string>...</string>
         </property>
-        <property name="frameShape">
-         <enum>QFrame::Box</enum>
+        <property name="flat">
+         <bool>false</bool>
         </property>
-        <property name="frameShadow">
-         <enum>QFrame::Sunken</enum>
+       </widget>
+      </item>
+      <item row="8" column="3">
+       <widget class="QComboBox" name="ElMaskP">
+        <property name="enabled">
+         <bool>true</bool>
         </property>
-        <property name="text">
+        <property name="toolTip">
          <string/>
         </property>
-        <property name="alignment">
-         <set>Qt::AlignCenter</set>
-        </property>
+        <item>
+         <property name="text">
+          <string>OFF</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>ON</string>
+         </property>
+        </item>
        </widget>
       </item>
-      <item row="12" column="1">
-       <widget class="QLabel" name="Label28">
+      <item row="4" column="7" colspan="3">
+       <widget class="QComboBox" name="ShowGLabel">
         <property name="enabled">
          <bool>true</bool>
         </property>
         <property name="toolTip">
          <string/>
         </property>
-        <property name="text">
-         <string>Max NSAT/DOP</string>
-        </property>
+        <item>
+         <property name="text">
+          <string>OFF</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Grid</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Grid/Label</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Circles</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Circles/Label</string>
+         </property>
+        </item>
        </widget>
       </item>
-      <item row="8" column="10">
-       <widget class="QLabel" name="Label10">
+      <item row="3" column="7" colspan="3">
+       <widget class="QComboBox" name="ShowLabel">
         <property name="enabled">
          <bool>true</bool>
         </property>
         <property name="toolTip">
          <string/>
         </property>
-        <property name="text">
-         <string>Mark Size</string>
-        </property>
+        <item>
+         <property name="text">
+          <string>OFF</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>ON</string>
+         </property>
+        </item>
        </widget>
       </item>
-      <item row="6" column="1">
-       <widget class="QLabel" name="Label24">
+      <item row="13" column="10" colspan="2">
+       <widget class="QLabel" name="Label27">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -596,12 +704,12 @@
          <string/>
         </property>
         <property name="text">
-         <string>Ephemeris</string>
+         <string>Update Cycle (ms)</string>
         </property>
        </widget>
       </item>
-      <item row="8" column="3">
-       <widget class="QComboBox" name="ElMaskP">
+      <item row="1" column="3">
+       <widget class="QComboBox" name="TimeLabel">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -610,71 +718,54 @@
         </property>
         <item>
          <property name="text">
-          <string>OFF</string>
+          <string>www/ssss</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>ON</string>
+          <string>h:m:s GPST</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>h:m:s UTC</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>h:m:s LT</string>
          </property>
         </item>
        </widget>
       </item>
-      <item row="20" column="15">
-       <widget class="QPushButton" name="BtnTLESatFile">
+      <item row="4" column="10">
+       <widget class="QLabel" name="Label6">
         <property name="enabled">
          <bool>true</bool>
         </property>
-        <property name="palette">
-         <palette>
-          <active>
-           <colorrole role="WindowText">
-            <brush brushstyle="SolidPattern">
-             <color alpha="255">
-              <red>0</red>
-              <green>0</green>
-              <blue>0</blue>
-             </color>
-            </brush>
-           </colorrole>
-          </active>
-          <inactive>
-           <colorrole role="WindowText">
-            <brush brushstyle="SolidPattern">
-             <color alpha="255">
-              <red>0</red>
-              <green>0</green>
-              <blue>0</blue>
-             </color>
-            </brush>
-           </colorrole>
-          </inactive>
-          <disabled>
-           <colorrole role="WindowText">
-            <brush brushstyle="SolidPattern">
-             <color alpha="255">
-              <red>0</red>
-              <green>0</green>
-              <blue>0</blue>
-             </color>
-            </brush>
-           </colorrole>
-          </disabled>
-         </palette>
-        </property>
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string>...</string>
+         <string>Text Color</string>
         </property>
-        <property name="flat">
-         <bool>false</bool>
+       </widget>
+      </item>
+      <item row="9" column="12" colspan="7">
+       <widget class="QLabel" name="FontLabel">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>Font Name</string>
         </property>
        </widget>
       </item>
-      <item row="10" column="1" colspan="2">
-       <widget class="QLabel" name="Label25">
+      <item row="17" column="4">
+       <widget class="QLabel" name="Label34">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -682,12 +773,12 @@
          <string/>
         </property>
         <property name="text">
-         <string>Hide Low Satellite</string>
+         <string>TLE Data</string>
         </property>
        </widget>
       </item>
-      <item row="8" column="1" colspan="2">
-       <widget class="QLabel" name="Label26">
+      <item row="16" column="4">
+       <widget class="QLabel" name="Label33">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -695,53 +786,51 @@
          <string/>
         </property>
         <property name="text">
-         <string>Elev Mask Pattern</string>
+         <string>RINEX Opt</string>
         </property>
        </widget>
       </item>
-      <item row="15" column="8" colspan="3">
-       <widget class="QDoubleSpinBox" name="RefPos2">
-        <property name="suffix">
-         <string>°</string>
+      <item row="9" column="10">
+       <widget class="QLabel" name="LabelFont">
+        <property name="enabled">
+         <bool>true</bool>
         </property>
-        <property name="decimals">
-         <number>9</number>
+        <property name="toolTip">
+         <string/>
         </property>
-        <property name="minimum">
-         <double>-180.000000000000000</double>
+        <property name="text">
+         <string>Font</string>
         </property>
-        <property name="maximum">
-         <double>180.000000000000000</double>
+       </widget>
+      </item>
+      <item row="5" column="4" colspan="2">
+       <widget class="QLabel" name="Label23">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>Compass</string>
         </property>
        </widget>
       </item>
-      <item row="15" column="3">
-       <widget class="QComboBox" name="RcvPos">
+      <item row="3" column="10">
+       <widget class="QLabel" name="Label7">
         <property name="enabled">
          <bool>true</bool>
         </property>
         <property name="toolTip">
          <string/>
         </property>
-        <item>
-         <property name="text">
-          <string>Single Solution</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>Lat/Lon/Hgt</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>RINEX Header</string>
-         </property>
-        </item>
+        <property name="text">
+         <string>Line Color</string>
+        </property>
        </widget>
       </item>
-      <item row="6" column="7" colspan="3">
-       <widget class="QComboBox" name="ShowScale">
+      <item row="6" column="3">
+       <widget class="QComboBox" name="ShowEph">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -760,18 +849,8 @@
         </item>
        </widget>
       </item>
-      <item row="10" column="7">
-       <widget class="QSpinBox" name="BuffSize">
-        <property name="maximum">
-         <number>1000000</number>
-        </property>
-        <property name="value">
-         <number>10800</number>
-        </property>
-       </widget>
-      </item>
-      <item row="14" column="7">
-       <widget class="QComboBox" name="Origin">
+      <item row="7" column="3">
+       <widget class="QComboBox" name="ElMask">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -780,103 +859,108 @@
         </property>
         <item>
          <property name="text">
-          <string>Start Pos</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>End Pos</string>
+          <string>0</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Average Pos</string>
+          <string>5</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Linear Fit Pos</string>
+          <string>10</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Base Station</string>
+          <string>15</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Lat/Lon/Hgt</string>
+          <string>20</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Auto Input</string>
+          <string>25</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Image Center</string>
+          <string>30</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Map Center</string>
+          <string>35</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Waypnt1</string>
+          <string>40</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Waypnt2</string>
+          <string>45</string>
          </property>
         </item>
+       </widget>
+      </item>
+      <item row="8" column="12" colspan="8">
+       <widget class="QComboBox" name="MarkSize">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
         <item>
          <property name="text">
-          <string>Waypnt3</string>
+          <string>1</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Waypnt4</string>
+          <string>2</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Waypnt5</string>
+          <string>3</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Waypnt6</string>
+          <string>4</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Waypnt7</string>
+          <string>5</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Waypnt8</string>
+          <string>10</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Waypnt9</string>
+          <string>15</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Waypnt10</string>
+          <string>20</string>
          </property>
         </item>
        </widget>
       </item>
-      <item row="1" column="1">
-       <widget class="QLabel" name="Label12">
+      <item row="16" column="6" colspan="15">
+       <widget class="QLineEdit" name="RnxOpts">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -884,74 +968,171 @@
          <string/>
         </property>
         <property name="text">
-         <string>Time Format</string>
+         <string/>
         </property>
        </widget>
       </item>
-      <item row="7" column="7" colspan="3">
-       <widget class="QComboBox" name="AutoScale">
+      <item row="5" column="10">
+       <widget class="QLabel" name="Label5">
         <property name="enabled">
          <bool>true</bool>
         </property>
         <property name="toolTip">
          <string/>
         </property>
-        <item>
-         <property name="text">
-          <string>OFF</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>ON</string>
-         </property>
-        </item>
+        <property name="text">
+         <string>Grid Color</string>
+        </property>
        </widget>
       </item>
-      <item row="15" column="11" colspan="4">
-       <widget class="QDoubleSpinBox" name="RefPos3">
-        <property name="suffix">
-         <string> m</string>
+      <item row="6" column="19">
+       <widget class="QPushButton" name="BtnColor1">
+        <property name="enabled">
+         <bool>true</bool>
         </property>
-        <property name="decimals">
-         <number>4</number>
+        <property name="palette">
+         <palette>
+          <active>
+           <colorrole role="WindowText">
+            <brush brushstyle="SolidPattern">
+             <color alpha="255">
+              <red>0</red>
+              <green>0</green>
+              <blue>0</blue>
+             </color>
+            </brush>
+           </colorrole>
+          </active>
+          <inactive>
+           <colorrole role="WindowText">
+            <brush brushstyle="SolidPattern">
+             <color alpha="255">
+              <red>0</red>
+              <green>0</green>
+              <blue>0</blue>
+             </color>
+            </brush>
+           </colorrole>
+          </inactive>
+          <disabled>
+           <colorrole role="WindowText">
+            <brush brushstyle="SolidPattern">
+             <color alpha="255">
+              <red>0</red>
+              <green>0</green>
+              <blue>0</blue>
+             </color>
+            </brush>
+           </colorrole>
+          </disabled>
+         </palette>
         </property>
-        <property name="minimum">
-         <double>-1000.000000000000000</double>
+        <property name="toolTip">
+         <string/>
         </property>
-        <property name="maximum">
-         <double>10000.000000000000000</double>
+        <property name="text">
+         <string>...</string>
+        </property>
+        <property name="flat">
+         <bool>false</bool>
         </property>
        </widget>
       </item>
-      <item row="5" column="10">
-       <widget class="QLabel" name="Label5">
+      <item row="9" column="19">
+       <widget class="QPushButton" name="BtnFont">
         <property name="enabled">
          <bool>true</bool>
         </property>
+        <property name="palette">
+         <palette>
+          <active>
+           <colorrole role="WindowText">
+            <brush brushstyle="SolidPattern">
+             <color alpha="255">
+              <red>0</red>
+              <green>0</green>
+              <blue>0</blue>
+             </color>
+            </brush>
+           </colorrole>
+          </active>
+          <inactive>
+           <colorrole role="WindowText">
+            <brush brushstyle="SolidPattern">
+             <color alpha="255">
+              <red>0</red>
+              <green>0</green>
+              <blue>0</blue>
+             </color>
+            </brush>
+           </colorrole>
+          </inactive>
+          <disabled>
+           <colorrole role="WindowText">
+            <brush brushstyle="SolidPattern">
+             <color alpha="255">
+              <red>0</red>
+              <green>0</green>
+              <blue>0</blue>
+             </color>
+            </brush>
+           </colorrole>
+          </disabled>
+         </palette>
+        </property>
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string>Grid Color</string>
+         <string>...</string>
+        </property>
+        <property name="flat">
+         <bool>false</bool>
         </property>
        </widget>
       </item>
-      <item row="4" column="4" colspan="3">
-       <widget class="QLabel" name="Label21">
+      <item row="2" column="3">
+       <widget class="QComboBox" name="LatLonFmt">
         <property name="enabled">
          <bool>true</bool>
         </property>
         <property name="toolTip">
          <string/>
         </property>
-        <property name="text">
-         <string>Grid/Grid Label</string>
+        <item>
+         <property name="text">
+          <string>ddd.ddddd</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>ddd mm ss.ss</string>
+         </property>
+        </item>
+       </widget>
+      </item>
+      <item row="2" column="7" colspan="3">
+       <widget class="QComboBox" name="ShowArrow">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
         </property>
+        <item>
+         <property name="text">
+          <string>OFF</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>ON</string>
+         </property>
+        </item>
        </widget>
       </item>
-      <item row="7" column="4">
-       <widget class="QLabel" name="Label13">
+      <item row="2" column="1">
+       <widget class="QLabel" name="Label15">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -959,12 +1140,12 @@
          <string/>
         </property>
         <property name="text">
-         <string>Auto Fit</string>
+         <string>Lat/Lon Format</string>
         </property>
        </widget>
       </item>
-      <item row="10" column="12" colspan="3">
-       <widget class="QLabel" name="FontLabel">
+      <item row="1" column="1">
+       <widget class="QLabel" name="Label12">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -972,45 +1153,50 @@
          <string/>
         </property>
         <property name="text">
-         <string>Font Name</string>
+         <string>Time Format</string>
         </property>
        </widget>
       </item>
-      <item row="3" column="7" colspan="3">
-       <widget class="QComboBox" name="ShowLabel">
+      <item row="14" column="4" colspan="2">
+       <widget class="QLabel" name="LabelRefPos">
         <property name="enabled">
          <bool>true</bool>
         </property>
         <property name="toolTip">
          <string/>
         </property>
-        <item>
-         <property name="text">
-          <string>OFF</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>ON</string>
-         </property>
-        </item>
+        <property name="text">
+         <string>Lat/Lon/Hgt</string>
+        </property>
        </widget>
       </item>
-      <item row="15" column="1" colspan="2">
-       <widget class="QLabel" name="Label31">
+      <item row="4" column="12" colspan="6">
+       <widget class="QLabel" name="Color3">
         <property name="enabled">
          <bool>true</bool>
         </property>
         <property name="toolTip">
          <string/>
         </property>
+        <property name="layoutDirection">
+         <enum>Qt::LeftToRight</enum>
+        </property>
+        <property name="frameShape">
+         <enum>QFrame::Box</enum>
+        </property>
+        <property name="frameShadow">
+         <enum>QFrame::Sunken</enum>
+        </property>
         <property name="text">
-         <string>Receiver Position</string>
+         <string/>
+        </property>
+        <property name="alignment">
+         <set>Qt::AlignCenter</set>
         </property>
        </widget>
       </item>
-      <item row="6" column="4">
-       <widget class="QLabel" name="Label22">
+      <item row="13" column="1">
+       <widget class="QLabel" name="Label37">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -1018,11 +1204,11 @@
          <string/>
         </property>
         <property name="text">
-         <string>Scale</string>
+         <string>Max Multipath</string>
         </property>
        </widget>
       </item>
-      <item row="17" column="0" rowspan="3" colspan="4">
+      <item row="15" column="0" rowspan="3" colspan="4">
        <widget class="QGroupBox" name="GroupBox1">
         <property name="toolTip">
          <string/>
@@ -1119,47 +1305,8 @@
         </layout>
        </widget>
       </item>
-      <item row="6" column="10" colspan="2">
-       <widget class="QLabel" name="Label1">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>Background Color</string>
-        </property>
-       </widget>
-      </item>
-      <item row="2" column="1">
-       <widget class="QLabel" name="Label15">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>Lat/Lon Format</string>
-        </property>
-       </widget>
-      </item>
-      <item row="18" column="6" colspan="11">
-       <widget class="QLineEdit" name="RnxOpts">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string/>
-        </property>
-       </widget>
-      </item>
-      <item row="8" column="12" colspan="4">
-       <widget class="QComboBox" name="MarkSize">
+      <item row="5" column="3">
+       <widget class="QComboBox" name="ShowHalfC">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -1168,74 +1315,87 @@
         </property>
         <item>
          <property name="text">
-          <string>1</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>2</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>3</string>
+          <string>OFF</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>4</string>
+          <string>ON</string>
          </property>
         </item>
+       </widget>
+      </item>
+      <item row="7" column="12" colspan="8">
+       <widget class="QComboBox" name="PlotStyle">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
         <item>
          <property name="text">
-          <string>5</string>
+          <string>Mark/Line</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>10</string>
+          <string>Mark</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>15</string>
+          <string>Line</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>20</string>
+          <string>None</string>
          </property>
         </item>
        </widget>
       </item>
-      <item row="19" column="14">
-       <widget class="QPushButton" name="BtnTLEView">
+      <item row="8" column="1" colspan="2">
+       <widget class="QLabel" name="Label26">
         <property name="enabled">
          <bool>true</bool>
         </property>
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
+         <string>Elev Mask Pattern</string>
+        </property>
+       </widget>
+      </item>
+      <item row="2" column="4" colspan="3">
+       <widget class="QLabel" name="Label4">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
          <string/>
         </property>
-        <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-          <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
+        <property name="text">
+         <string>Direction Arrow</string>
         </property>
-        <property name="flat">
+       </widget>
+      </item>
+      <item row="4" column="1">
+       <widget class="QLabel" name="Label17">
+        <property name="enabled">
          <bool>true</bool>
         </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>Cycle-Slip</string>
+        </property>
        </widget>
       </item>
-      <item row="4" column="7" colspan="3">
-       <widget class="QComboBox" name="ShowGLabel">
+      <item row="13" column="3">
+       <widget class="QComboBox" name="MaxMP">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -1244,33 +1404,43 @@
         </property>
         <item>
          <property name="text">
-          <string>OFF</string>
+          <string>1</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Grid</string>
+          <string>2</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Grid/Label</string>
+          <string>3</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Circles</string>
+          <string>5</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Circles/Label</string>
+          <string>10</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>20</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>30</string>
          </property>
         </item>
        </widget>
       </item>
-      <item row="8" column="4" colspan="3">
-       <widget class="QLabel" name="Label8">
+      <item row="15" column="4">
+       <widget class="QLabel" name="Label30">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -1278,12 +1448,12 @@
          <string/>
         </property>
         <property name="text">
-         <string>Y-Range (+/-)</string>
+         <string>QC Cmd</string>
         </property>
        </widget>
       </item>
-      <item row="10" column="10">
-       <widget class="QLabel" name="LabelFont">
+      <item row="18" column="6" colspan="12">
+       <widget class="QLineEdit" name="TLESatFile">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -1291,25 +1461,12 @@
          <string/>
         </property>
         <property name="text">
-         <string>Font</string>
-        </property>
-       </widget>
-      </item>
-      <item row="3" column="1">
-       <widget class="QLabel" name="Label9">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
          <string/>
         </property>
-        <property name="text">
-         <string>Show Statistics</string>
-        </property>
        </widget>
       </item>
-      <item row="17" column="6" colspan="11">
-       <widget class="QLineEdit" name="QcCmd">
+      <item row="7" column="4">
+       <widget class="QLabel" name="Label13">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -1317,68 +1474,25 @@
          <string/>
         </property>
         <property name="text">
-         <string>teqc</string>
+         <string>Auto Fit</string>
         </property>
        </widget>
       </item>
-      <item row="12" column="7">
-       <widget class="QSpinBox" name="EditTimeSync"/>
-      </item>
-      <item row="4" column="15">
-       <widget class="QPushButton" name="BtnColor3">
+      <item row="9" column="4" colspan="3">
+       <widget class="QLabel" name="Label29">
         <property name="enabled">
          <bool>true</bool>
         </property>
-        <property name="palette">
-         <palette>
-          <active>
-           <colorrole role="WindowText">
-            <brush brushstyle="SolidPattern">
-             <color alpha="255">
-              <red>0</red>
-              <green>0</green>
-              <blue>0</blue>
-             </color>
-            </brush>
-           </colorrole>
-          </active>
-          <inactive>
-           <colorrole role="WindowText">
-            <brush brushstyle="SolidPattern">
-             <color alpha="255">
-              <red>0</red>
-              <green>0</green>
-              <blue>0</blue>
-             </color>
-            </brush>
-           </colorrole>
-          </inactive>
-          <disabled>
-           <colorrole role="WindowText">
-            <brush brushstyle="SolidPattern">
-             <color alpha="255">
-              <red>0</red>
-              <green>0</green>
-              <blue>0</blue>
-             </color>
-            </brush>
-           </colorrole>
-          </disabled>
-         </palette>
-        </property>
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string>...</string>
-        </property>
-        <property name="flat">
-         <bool>false</bool>
+         <string>RT Buffer Size</string>
         </property>
        </widget>
       </item>
-      <item row="14" column="1">
-       <widget class="QLabel" name="Label37">
+      <item row="7" column="10">
+       <widget class="QLabel" name="Label2">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -1386,12 +1500,12 @@
          <string/>
         </property>
         <property name="text">
-         <string>Max Multipath</string>
+         <string>Plot Style</string>
         </property>
        </widget>
       </item>
-      <item row="7" column="3">
-       <widget class="QComboBox" name="ElMask">
+      <item row="4" column="3">
+       <widget class="QComboBox" name="ShowSlip">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -1400,71 +1514,23 @@
         </property>
         <item>
          <property name="text">
-          <string>0</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>5</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>10</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>15</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>20</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>25</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>30</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>35</string>
+          <string>OFF</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>40</string>
+          <string>LG Jump</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>45</string>
+          <string>LLI Flag</string>
          </property>
         </item>
        </widget>
       </item>
-      <item row="4" column="1">
-       <widget class="QLabel" name="Label17">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>Cycle-Slip</string>
-        </property>
-       </widget>
-      </item>
-      <item row="8" column="7" colspan="3">
-       <widget class="QComboBox" name="YRange">
+      <item row="1" column="7" colspan="3">
+       <widget class="QComboBox" name="ShowErr">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -1473,102 +1539,35 @@
         </property>
         <item>
          <property name="text">
-          <string>0.05</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>0.1</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>0.2</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>0.5</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>1</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>2</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>5</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>10</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>20</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>50</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>100</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>500</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>1000</string>
+          <string>OFF</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>5000</string>
+          <string>Bar/Circle</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>10000</string>
+          <string>Dots</string>
          </property>
         </item>
        </widget>
       </item>
-      <item row="10" column="3">
-       <widget class="QComboBox" name="HideLowSat">
+      <item row="7" column="1" colspan="2">
+       <widget class="QLabel" name="Label18">
         <property name="enabled">
          <bool>true</bool>
         </property>
         <property name="toolTip">
          <string/>
         </property>
-        <item>
-         <property name="text">
-          <string>OFF</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>ON</string>
-         </property>
-        </item>
+        <property name="text">
+         <string>Elevation Mask (°)</string>
+        </property>
        </widget>
       </item>
-      <item row="1" column="10" rowspan="2" colspan="6">
+      <item row="1" column="10" rowspan="2" colspan="10">
        <widget class="QWidget" name="widget_2" native="true">
         <layout class="QGridLayout" name="gridLayout_3">
          <property name="leftMargin">
@@ -1810,7 +1809,72 @@
         </layout>
        </widget>
       </item>
-      <item row="5" column="12" colspan="2">
+      <item row="4" column="4" colspan="3">
+       <widget class="QLabel" name="Label21">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>Grid/Grid Label</string>
+        </property>
+       </widget>
+      </item>
+      <item row="18" column="3">
+       <widget class="QLineEdit" name="ExSats">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string/>
+        </property>
+       </widget>
+      </item>
+      <item row="11" column="1">
+       <widget class="QLabel" name="Label28">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>Max NSAT/DOP</string>
+        </property>
+       </widget>
+      </item>
+      <item row="17" column="6" colspan="12">
+       <widget class="QLineEdit" name="TLEFile">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string/>
+        </property>
+       </widget>
+      </item>
+      <item row="9" column="7" colspan="2">
+       <widget class="QLineEdit" name="BuffSize">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>10800</string>
+        </property>
+       </widget>
+      </item>
+      <item row="5" column="12" colspan="6">
        <widget class="QLabel" name="Color2">
         <property name="enabled">
          <bool>true</bool>
@@ -1835,8 +1899,8 @@
         </property>
        </widget>
       </item>
-      <item row="19" column="15">
-       <widget class="QPushButton" name="BtnTLEFile">
+      <item row="4" column="19">
+       <widget class="QPushButton" name="BtnColor3">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -1888,8 +1952,8 @@
         </property>
        </widget>
       </item>
-      <item row="4" column="10">
-       <widget class="QLabel" name="Label6">
+      <item row="6" column="4">
+       <widget class="QLabel" name="Label22">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -1897,25 +1961,64 @@
          <string/>
         </property>
         <property name="text">
-         <string>Text Color</string>
+         <string>Scale</string>
         </property>
        </widget>
       </item>
-      <item row="5" column="1">
-       <widget class="QLabel" name="Label16">
+      <item row="18" column="18">
+       <widget class="QPushButton" name="BtnTLESatView">
         <property name="enabled">
          <bool>true</bool>
         </property>
+        <property name="sizePolicy">
+         <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
+          <horstretch>0</horstretch>
+          <verstretch>0</verstretch>
+         </sizepolicy>
+        </property>
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string>Parity Unknown</string>
+         <string/>
+        </property>
+        <property name="icon">
+         <iconset resource="../rtkget_qt/rtkget_qt.qrc">
+          <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
+        </property>
+        <property name="flat">
+         <bool>true</bool>
         </property>
        </widget>
       </item>
-      <item row="2" column="3">
-       <widget class="QComboBox" name="LatLonFmt">
+      <item row="17" column="18">
+       <widget class="QPushButton" name="BtnTLEView">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="sizePolicy">
+         <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
+          <horstretch>0</horstretch>
+          <verstretch>0</verstretch>
+         </sizepolicy>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string/>
+        </property>
+        <property name="icon">
+         <iconset resource="../rtkget_qt/rtkget_qt.qrc">
+          <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
+        </property>
+        <property name="flat">
+         <bool>true</bool>
+        </property>
+       </widget>
+      </item>
+      <item row="5" column="7" colspan="3">
+       <widget class="QComboBox" name="ShowCompass">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -1924,18 +2027,18 @@
         </property>
         <item>
          <property name="text">
-          <string>ddd.ddddd</string>
+          <string>OFF</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>ddd mm ss.ss</string>
+          <string>ON</string>
          </property>
         </item>
        </widget>
       </item>
-      <item row="14" column="4">
-       <widget class="QLabel" name="Label3">
+      <item row="15" column="6" colspan="15">
+       <widget class="QLineEdit" name="QcCmd">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -1943,25 +2046,32 @@
          <string/>
         </property>
         <property name="text">
-         <string>Coordinate Origin</string>
+         <string>teqc</string>
         </property>
        </widget>
       </item>
-      <item row="7" column="1" colspan="2">
-       <widget class="QLabel" name="Label18">
+      <item row="3" column="3">
+       <widget class="QComboBox" name="ShowStats">
         <property name="enabled">
          <bool>true</bool>
         </property>
         <property name="toolTip">
          <string/>
         </property>
-        <property name="text">
-         <string>Elevation Mask (°)</string>
-        </property>
+        <item>
+         <property name="text">
+          <string>OFF</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>ON</string>
+         </property>
+        </item>
        </widget>
       </item>
-      <item row="3" column="10">
-       <widget class="QLabel" name="Label7">
+      <item row="3" column="4" colspan="2">
+       <widget class="QLabel" name="Label20">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -1969,12 +2079,12 @@
          <string/>
         </property>
         <property name="text">
-         <string>Line Color</string>
+         <string>Graph Label</string>
         </property>
        </widget>
       </item>
-      <item row="15" column="15">
-       <widget class="QPushButton" name="BtnRefPos">
+      <item row="3" column="19">
+       <widget class="QPushButton" name="BtnColor4">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -2026,61 +2136,21 @@
         </property>
        </widget>
       </item>
-      <item row="5" column="15">
-       <widget class="QPushButton" name="BtnColor2">
+      <item row="13" column="12" colspan="9">
+       <widget class="QLineEdit" name="RefCycle">
         <property name="enabled">
          <bool>true</bool>
         </property>
-        <property name="palette">
-         <palette>
-          <active>
-           <colorrole role="WindowText">
-            <brush brushstyle="SolidPattern">
-             <color alpha="255">
-              <red>0</red>
-              <green>0</green>
-              <blue>0</blue>
-             </color>
-            </brush>
-           </colorrole>
-          </active>
-          <inactive>
-           <colorrole role="WindowText">
-            <brush brushstyle="SolidPattern">
-             <color alpha="255">
-              <red>0</red>
-              <green>0</green>
-              <blue>0</blue>
-             </color>
-            </brush>
-           </colorrole>
-          </inactive>
-          <disabled>
-           <colorrole role="WindowText">
-            <brush brushstyle="SolidPattern">
-             <color alpha="255">
-              <red>0</red>
-              <green>0</green>
-              <blue>0</blue>
-             </color>
-            </brush>
-           </colorrole>
-          </disabled>
-         </palette>
-        </property>
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string>...</string>
-        </property>
-        <property name="flat">
-         <bool>false</bool>
+         <string>100</string>
         </property>
        </widget>
       </item>
-      <item row="19" column="4">
-       <widget class="QLabel" name="Label34">
+      <item row="14" column="6" colspan="2">
+       <widget class="QLineEdit" name="RefPos1">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -2088,25 +2158,12 @@
          <string/>
         </property>
         <property name="text">
-         <string>TLE Data</string>
+         <string>0</string>
         </property>
        </widget>
       </item>
       <item row="18" column="4">
-       <widget class="QLabel" name="Label33">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>RINEX Opt</string>
-        </property>
-       </widget>
-      </item>
-      <item row="19" column="6" colspan="8">
-       <widget class="QLineEdit" name="TLEFile">
+       <widget class="QLabel" name="Label35">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -2114,12 +2171,12 @@
          <string/>
         </property>
         <property name="text">
-         <string/>
+         <string>TLE Sat No</string>
         </property>
        </widget>
       </item>
-      <item row="12" column="10">
-       <widget class="QLabel" name="Label11">
+      <item row="3" column="1">
+       <widget class="QLabel" name="Label9">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -2127,12 +2184,12 @@
          <string/>
         </property>
         <property name="text">
-         <string>Animation Interval</string>
+         <string>Show Statistics</string>
         </property>
        </widget>
       </item>
-      <item row="7" column="12" colspan="4">
-       <widget class="QComboBox" name="PlotStyle">
+      <item row="11" column="3">
+       <widget class="QComboBox" name="MaxDop">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -2141,41 +2198,38 @@
         </property>
         <item>
          <property name="text">
-          <string>Mark/Line</string>
+          <string>10</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Mark</string>
+          <string>30</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>Line</string>
+          <string>50</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>None</string>
+          <string>100</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>200</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>500</string>
          </property>
         </item>
        </widget>
       </item>
-      <item row="1" column="4" colspan="3">
-       <widget class="QLabel" name="Label19">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>Error Bar/Circle</string>
-        </property>
-       </widget>
-      </item>
-      <item row="15" column="4" colspan="2">
-       <widget class="QLabel" name="LabelRefPos">
+      <item row="11" column="4">
+       <widget class="QLabel" name="Label3">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -2183,12 +2237,12 @@
          <string/>
         </property>
         <property name="text">
-         <string>Lat/Lon/Hgt</string>
+         <string>Coordinate Origin</string>
         </property>
        </widget>
       </item>
-      <item row="14" column="3">
-       <widget class="QComboBox" name="MaxMP">
+      <item row="11" column="7">
+       <widget class="QComboBox" name="Origin">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -2197,205 +2251,103 @@
         </property>
         <item>
          <property name="text">
-          <string>1</string>
+          <string>Start Pos</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>2</string>
+          <string>End Pos</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>3</string>
+          <string>Average Pos</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>5</string>
+          <string>Linear Fit Pos</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>10</string>
+          <string>Base Station</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>20</string>
+          <string>Lat/Lon/Hgt</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>30</string>
+          <string>Auto Input</string>
          </property>
         </item>
-       </widget>
-      </item>
-      <item row="6" column="15">
-       <widget class="QPushButton" name="BtnColor1">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="palette">
-         <palette>
-          <active>
-           <colorrole role="WindowText">
-            <brush brushstyle="SolidPattern">
-             <color alpha="255">
-              <red>0</red>
-              <green>0</green>
-              <blue>0</blue>
-             </color>
-            </brush>
-           </colorrole>
-          </active>
-          <inactive>
-           <colorrole role="WindowText">
-            <brush brushstyle="SolidPattern">
-             <color alpha="255">
-              <red>0</red>
-              <green>0</green>
-              <blue>0</blue>
-             </color>
-            </brush>
-           </colorrole>
-          </inactive>
-          <disabled>
-           <colorrole role="WindowText">
-            <brush brushstyle="SolidPattern">
-             <color alpha="255">
-              <red>0</red>
-              <green>0</green>
-              <blue>0</blue>
-             </color>
-            </brush>
-           </colorrole>
-          </disabled>
-         </palette>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>...</string>
-        </property>
-        <property name="flat">
-         <bool>false</bool>
-        </property>
-       </widget>
-      </item>
-      <item row="6" column="3">
-       <widget class="QComboBox" name="ShowEph">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
         <item>
          <property name="text">
-          <string>OFF</string>
+          <string>Image Center</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>ON</string>
+          <string>Map Center</string>
          </property>
         </item>
-       </widget>
-      </item>
-      <item row="1" column="3">
-       <widget class="QComboBox" name="TimeLabel">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
         <item>
          <property name="text">
-          <string>www/ssss</string>
+          <string>Waypnt1</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>h:m:s GPST</string>
+          <string>Waypnt2</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>h:m:s UTC</string>
+          <string>Waypnt3</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>h:m:s LT</string>
+          <string>Waypnt4</string>
          </property>
         </item>
-       </widget>
-      </item>
-      <item row="20" column="14">
-       <widget class="QPushButton" name="BtnTLESatView">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string/>
-        </property>
-        <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
-          <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
-        </property>
-        <property name="flat">
-         <bool>true</bool>
-        </property>
-       </widget>
-      </item>
-      <item row="20" column="4">
-       <widget class="QLabel" name="Label35">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>TLE Sat No</string>
-        </property>
-       </widget>
-      </item>
-      <item row="2" column="7" colspan="3">
-       <widget class="QComboBox" name="ShowArrow">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
         <item>
          <property name="text">
-          <string>OFF</string>
+          <string>Waypnt5</string>
          </property>
         </item>
         <item>
          <property name="text">
-          <string>ON</string>
+          <string>Waypnt6</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Waypnt7</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Waypnt8</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Waypnt9</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Waypnt10</string>
          </property>
         </item>
        </widget>
       </item>
-      <item row="5" column="4" colspan="2">
-       <widget class="QLabel" name="Label23">
+      <item row="11" column="10">
+       <widget class="QLabel" name="Label11">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -2403,33 +2355,55 @@
          <string/>
         </property>
         <property name="text">
-         <string>Compass</string>
+         <string>Animation Interval</string>
         </property>
        </widget>
       </item>
-      <item row="10" column="4" colspan="3">
-       <widget class="QLabel" name="Label29">
+      <item row="11" column="12" colspan="8">
+       <widget class="QComboBox" name="AnimCycle">
         <property name="enabled">
          <bool>true</bool>
         </property>
         <property name="toolTip">
          <string/>
         </property>
-        <property name="text">
-         <string>RT Buffer Size</string>
-        </property>
-       </widget>
-      </item>
-      <item row="16" column="1">
-       <widget class="QLabel" name="label">
-        <property name="text">
-         <string>&lt;html&gt;&lt;head/&gt;&lt;body&gt;&lt;p&gt;API Key for GMView&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</string>
-        </property>
+        <item>
+         <property name="text">
+          <string>1</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>2</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>5</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>10</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>20</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>50</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>100</string>
+         </property>
+        </item>
        </widget>
       </item>
-      <item row="16" column="3" colspan="13">
-       <widget class="QLineEdit" name="ApiKey"/>
-      </item>
      </layout>
     </widget>
    </item>
@@ -2519,74 +2493,8 @@
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>BtnOK</tabstop>
-  <tabstop>BtnCancel</tabstop>
-  <tabstop>TimeLabel</tabstop>
-  <tabstop>LatLonFmt</tabstop>
-  <tabstop>ShowStats</tabstop>
-  <tabstop>ShowSlip</tabstop>
-  <tabstop>ShowHalfC</tabstop>
-  <tabstop>ShowEph</tabstop>
-  <tabstop>ElMask</tabstop>
-  <tabstop>ElMaskP</tabstop>
-  <tabstop>HideLowSat</tabstop>
-  <tabstop>MaxDop</tabstop>
-  <tabstop>MaxMP</tabstop>
-  <tabstop>RcvPos</tabstop>
-  <tabstop>NavSys1</tabstop>
-  <tabstop>NavSys2</tabstop>
-  <tabstop>NavSys3</tabstop>
-  <tabstop>NavSys4</tabstop>
-  <tabstop>NavSys5</tabstop>
-  <tabstop>NavSys6</tabstop>
-  <tabstop>NavSys7</tabstop>
-  <tabstop>ExSats</tabstop>
-  <tabstop>ShowErr</tabstop>
-  <tabstop>ShowArrow</tabstop>
-  <tabstop>ShowLabel</tabstop>
-  <tabstop>ShowGLabel</tabstop>
-  <tabstop>ShowCompass</tabstop>
-  <tabstop>ShowScale</tabstop>
-  <tabstop>AutoScale</tabstop>
-  <tabstop>YRange</tabstop>
-  <tabstop>BuffSize</tabstop>
-  <tabstop>MColor1</tabstop>
-  <tabstop>MColor2</tabstop>
-  <tabstop>MColor3</tabstop>
-  <tabstop>MColor4</tabstop>
-  <tabstop>MColor5</tabstop>
-  <tabstop>MColor6</tabstop>
-  <tabstop>MColor7</tabstop>
-  <tabstop>MColor8</tabstop>
-  <tabstop>MColor9</tabstop>
-  <tabstop>MColor10</tabstop>
-  <tabstop>MColor11</tabstop>
-  <tabstop>MColor12</tabstop>
-  <tabstop>BtnColor4</tabstop>
-  <tabstop>BtnColor3</tabstop>
-  <tabstop>BtnColor2</tabstop>
-  <tabstop>BtnColor1</tabstop>
-  <tabstop>PlotStyle</tabstop>
-  <tabstop>MarkSize</tabstop>
-  <tabstop>BtnFont</tabstop>
-  <tabstop>AnimCycle</tabstop>
-  <tabstop>RefCycle</tabstop>
-  <tabstop>RefPos1</tabstop>
-  <tabstop>RefPos2</tabstop>
-  <tabstop>RefPos3</tabstop>
-  <tabstop>BtnRefPos</tabstop>
-  <tabstop>QcCmd</tabstop>
-  <tabstop>RnxOpts</tabstop>
-  <tabstop>TLEFile</tabstop>
-  <tabstop>BtnTLEView</tabstop>
-  <tabstop>BtnTLEFile</tabstop>
-  <tabstop>TLESatFile</tabstop>
-  <tabstop>BtnTLESatView</tabstop>
-  <tabstop>BtnTLESatFile</tabstop>
- </tabstops>
  <resources>
-  <include location="../rtkconv_qt/rtkconv_qt.qrc"/>
+  <include location="../rtkget_qt/rtkget_qt.qrc"/>
  </resources>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/pntdlg.cpp RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/pntdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/pntdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/pntdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -13,73 +13,74 @@
 extern Plot *plot;
 
 //---------------------------------------------------------------------------
-PntDialog::PntDialog(QWidget *parent)
+PntDialog::PntDialog(QWidget* parent)
     : QDialog(parent)
 {
     setupUi(this);
     QStringList labels;
 
-    labels << tr("Latitude (°)") << tr("Longitude (°)") << "Name";
+    labels<<tr("Latitude (°)")<<tr("Longitude (°)")<<"Name";
 
     PntList->setColumnCount(3);
     PntList->setHorizontalHeaderLabels(labels);
 
-    noUpdate = false;
+    noUpdate=false;
+
+    connect(BtnClose,SIGNAL(clicked(bool)),this,SLOT(close()));
+    connect(BtnUpdate,SIGNAL(clicked(bool)),this,SLOT(BtnUpdateClick()));
+    connect(BtnDel,SIGNAL(clicked(bool)),this,SLOT(BtnDelClick()));
+    connect(BtnAdd,SIGNAL(clicked(bool)),this,SLOT(BtnAddClick()));
+    connect(PntList,SIGNAL(itemChanged(QTableWidgetItem*)),this,SLOT(PntListSetEditText()));
+    connect(PntList,SIGNAL(itemSelectionChanged()),this,SLOT(PntListClick()));
+    connect(PntList,SIGNAL(itemDoubleClicked(QTableWidgetItem*)),this,SLOT(PntListDblClick(QTableWidgetItem*)));
 
-    connect(BtnClose, SIGNAL(clicked(bool)), this, SLOT(close()));
-    connect(BtnUpdate, SIGNAL(clicked(bool)), this, SLOT(BtnUpdateClick()));
-    connect(BtnDel, SIGNAL(clicked(bool)), this, SLOT(BtnDelClick()));
-    connect(BtnAdd, SIGNAL(clicked(bool)), this, SLOT(BtnAddClick()));
-    connect(PntList, SIGNAL(itemChanged(QTableWidgetItem *)), this, SLOT(PntListSetEditText()));
-    connect(PntList, SIGNAL(itemSelectionChanged()), this, SLOT(PntListClick()));
-    connect(PntList, SIGNAL(itemDoubleClicked(QTableWidgetItem *)), this, SLOT(PntListDblClick(QTableWidgetItem *)));
 }
 //---------------------------------------------------------------------------
 void PntDialog::showEvent(QShowEvent *event)
 {
     if (event->spontaneous()) return;
 
-    int width[] = { 120, 120, 90 };
-
-    FontScale = this->physicalDpiX();
-    for (int i = 0; i < 3; i++)
-        PntList->setColumnWidth(i, width[i] * FontScale / 96);
+    int width[]={120,120,90};
+	
+    FontScale=this->physicalDpiX();
+    for (int i=0;i<3;i++) {
+        PntList->setColumnWidth(i,width[i]*FontScale/96);
+    }
 }
 //---------------------------------------------------------------------------
 void PntDialog::BtnAddClick()
 {
-    double rr[3], pos[3] = { 0 };
+	double rr[3],pos[3]={0};
 
-    if (PntList->rowCount() >= MAXWAYPNT) return;
+    if (PntList->rowCount()>=MAXWAYPNT) return;
     if (!plot->GetCenterPos(rr)) return;
-    if (norm(rr, 3) <= 0.0) return;
-    ecef2pos(rr, pos);
+	if (norm(rr,3)<=0.0) return;
+	ecef2pos(rr,pos);
 
-    noUpdate = true;
-    PntList->setRowCount(PntList->rowCount() + 1);
-    PntList->setItem(PntList->rowCount() - 1, 0, new QTableWidgetItem(QString("%1").arg(pos[0] * R2D, 0, 'f', 9)));
-    PntList->setItem(PntList->rowCount() - 1, 1, new QTableWidgetItem(QString("%1").arg(pos[1] * R2D, 0, 'f', 9)));
-    PntList->setItem(PntList->rowCount() - 1, 2, new QTableWidgetItem(QString("Point%1").arg(PntList->rowCount(), 2)));
-    noUpdate = false;
+    noUpdate=true;
+    PntList->setRowCount(PntList->rowCount()+1);
+    PntList->setItem(PntList->rowCount()-1,0, new QTableWidgetItem(QString("%1").arg(pos[0]*R2D,0,'f',9)));
+    PntList->setItem(PntList->rowCount()-1,1, new QTableWidgetItem(QString("%1").arg(pos[1]*R2D,0,'f',9)));
+    PntList->setItem(PntList->rowCount()-1,2, new QTableWidgetItem(QString("Point%1").arg(PntList->rowCount(),2)));
+    noUpdate=false;
 
     UpdatePoint();
 }
 //---------------------------------------------------------------------------
 void PntDialog::BtnDelClick()
 {
-    QTableWidgetItem *sel = PntList->selectedItems().first();;
-
+    QTableWidgetItem *sel=PntList->selectedItems().first();;
     if (!sel) return;
-
-    noUpdate = true;
-    for (int i = PntList->column(sel); i < PntList->rowCount(); i++) {
-        for (int j = 0; j < PntList->columnCount(); j++) {
-            if (i + 1 >= PntList->rowCount()) PntList->setItem(i, j, new QTableWidgetItem(""));
-            else PntList->setItem(i, j, new QTableWidgetItem(PntList->item(i + 1, j)->text()));
+	
+    noUpdate=true;
+    for (int i=PntList->column(sel);i<PntList->rowCount();i++) {
+        for (int j=0;j<PntList->columnCount();j++) {
+            if (i+1>=PntList->rowCount()) PntList->setItem(i,j, new QTableWidgetItem(""));
+            else PntList->setItem(i,j, new QTableWidgetItem(PntList->item(i+1,j)->text()));
 		}
 	}
-    PntList->setRowCount(PntList->rowCount() - 1);
-    noUpdate = false;
+    PntList->setRowCount(PntList->rowCount()-1);
+    noUpdate=false;
 
     UpdatePoint();
 }
@@ -97,54 +98,53 @@
 //---------------------------------------------------------------------------
 void PntDialog::UpdatePoint()
 {
-    int n = 0;
+    int n=0;
 
     if (noUpdate) return;
 
-    for (int i = 0; i < PntList->rowCount(); i++) {
-        if (!PntList->item(i, 0)) continue;
-        if (!PntList->item(i, 1)) continue;
-        if (!PntList->item(i, 2)) continue;
-        if (PntList->item(i, 2)->text() == "") continue;
-        plot->PntPos[n][0] = PntList->item(i, 0)->text().toDouble();
-        plot->PntPos[n][1] = PntList->item(i, 1)->text().toDouble();
-        plot->PntPos[n][2] = 0.0;
-        plot->PntName[n++] = PntList->item(i, 2)->text();
+    for (int i=0;i<PntList->rowCount();i++) {
+        if (!PntList->item(i,0)) continue;
+        if (!PntList->item(i,1)) continue;
+        if (!PntList->item(i,2)) continue;
+        if (PntList->item(i,2)->text()=="") continue;
+        plot->PntPos[n][0]=PntList->item(i,0)->text().toDouble();
+        plot->PntPos[n][1]=PntList->item(i,1)->text().toDouble();
+        plot->PntPos[n][2]=0.0;
+        plot->PntName[n++]=PntList->item(i,2)->text();
     }
-    plot->NWayPnt = n;
+    plot->NWayPnt=n;
 
     plot->UpdatePlot();
 }
 //---------------------------------------------------------------------------
 void PntDialog::SetPoint(void)
 {
-    noUpdate = true;
+    noUpdate=true;
     PntList->setRowCount(plot->NWayPnt);
-    for (int i = 0; i < plot->NWayPnt; i++) {
-        PntList->setItem(i, 0, new QTableWidgetItem(QString::number(plot->PntPos[i][0], 'f', 9)));
-        PntList->setItem(i, 1, new QTableWidgetItem(QString::number(plot->PntPos[i][1], 'f', 9)));
-        PntList->setItem(i, 2, new QTableWidgetItem(plot->PntName[i]));
+    for (int i=0;i<plot->NWayPnt;i++) {
+        PntList->setItem(i,0,new QTableWidgetItem(QString::number(plot->PntPos[i][0],'f',9)));
+        PntList->setItem(i,1,new QTableWidgetItem(QString::number(plot->PntPos[i][1],'f',9)));
+        PntList->setItem(i,2,new QTableWidgetItem(plot->PntName[i]));
     }
-    noUpdate = false;
+    noUpdate=false;
 }
 
 //---------------------------------------------------------------------------
 void PntDialog::PntListClick()
 {
-    QList<QTableWidgetItem *> selections = PntList->selectedItems();
+    QList<QTableWidgetItem*> selections= PntList->selectedItems();
     if (selections.isEmpty()) return;
-    QTableWidgetItem *item = selections.first();
+    QTableWidgetItem * item=selections.first();
     if (!item) return;
-    int sel = PntList->row(item);
-    plot->SelWayPnt = sel < plot->NWayPnt ? sel : -1;
+    int sel=PntList->row(item);
+    plot->SelWayPnt=sel<plot->NWayPnt?sel:-1;
     plot->UpdatePlot();
 }
 //---------------------------------------------------------------------------
 void PntDialog::PntListDblClick(QTableWidgetItem *w)
 {
-    int sel = PntList->row(w);
-
-    if (sel >= plot->NWayPnt) return;
-    plot->SetTrkCent(plot->PntPos[sel][0], plot->PntPos[sel][1]);
+    int sel=PntList->row(w);
+    if (sel>=plot->NWayPnt) return;
+    plot->SetTrkCent(plot->PntPos[sel][0],plot->PntPos[sel][1]);
 }
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/pntdlg.h RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/pntdlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/pntdlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/pntdlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -21,15 +21,13 @@
     void PntListSetEditText();
     void PntListClick();
     void PntListDblClick(QTableWidgetItem *w);
-
 private:
     void UpdatePoint(void);
-
 public:
 	double Pos[3];
 	int FontScale;
 
-    explicit PntDialog(QWidget* parent = NULL);
+    explicit PntDialog(QWidget* parent=NULL);
     void SetPoint(void);
 };
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/pntdlg.ui RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/pntdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/pntdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/pntdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -92,6 +92,9 @@
       </sizepolicy>
      </property>
      <layout class="QHBoxLayout" name="horizontalLayout_2">
+      <property name="spacing">
+       <number>0</number>
+      </property>
       <property name="leftMargin">
        <number>0</number>
       </property>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/rtklib_gm.htm RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/rtklib_gm.htm
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/rtklib_gm.htm	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/rtklib_gm.htm	2019-08-19 02:04:50.000000000 +0300
@@ -66,21 +66,6 @@
     marks.push(mark);
 }
 
-function HighlightMark(title) {
-    if (markh) {
-        markh.setIcon(icon1);
-        markh.setZIndex(markz);
-    }
-    for (var i in marks) {
-        if (marks[i].getTitle()==title) {
-            markz = marks[i].getZIndex();
-            marks[i].setIcon(icon0);
-            marks[i].setZIndex(google.maps.Marker.MAX_ZINDEX+1);
-            markh=marks[i];
-        }
-    }
-}
-
 function PosMark(lat,lon,title) {
     for (var i in marks) {
         if (marks[i].title==title) {
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/rtkplot.cpp RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/rtkplot.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/rtkplot.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/rtkplot.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -5,7 +5,6 @@
 {
     QApplication a(argc, argv);
     Plot w;
-
     w.show();
 
     return a.exec();
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/rtkplot_qt.pro RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/rtkplot_qt.pro
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/rtkplot_qt.pro	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/rtkplot_qt.pro	2019-08-19 02:04:50.000000000 +0300
@@ -4,23 +4,49 @@
 #
 #-------------------------------------------------
 
-QT       += widgets core gui xml serialport
+QT       += widgets core gui xml
+
+greaterThan(QT_MAJOR_VERSION, 4) {
+    QT += widgets serialport
+    DEFINES += QT5
+}
+
+lessThan(QT_MAJOR_VERSION, 5) {
+    LIBS += -lqextserialport-1.2
+    DEFINES += QEXTSERIALPORT
+}
 
 qtHaveModule(webenginewidgets) {
-    QT += webenginewidgets
-    DEFINES +=QWEBENGINE
+    QT+= webenginewidgets
+    DEFINES+=QWEBENGINE
 } else {
     qtHaveModule(webkitwidgets) {
-        QT += webkitwidgets
-        DEFINES += QWEBKIT
+        QT+= webkitwidgets
+        DEFINES+= QWEBKIT
     }
 }
-include(../app.pri)
+include(../../RTKLib.pri)
 
 TARGET = rtkplot_qt
 TEMPLATE = app
 
-INCLUDEPATH += ../../src/ ../appcmn_qt
+INCLUDEPATH += ../../src/ ../appcmn_qt ../rtkplot_qt
+
+linux{
+    RTKLIB =../../src/libRTKLib.a
+    LIBS += -lpng $${RTKLIB} -lpthread
+}
+win32 {
+    CONFIG(debug) {
+        RTKLIB = ../../src/debug/libRTKLib.a
+    } else {
+        RTKLIB =../../src/release/libRTKLib.a
+    }
+
+    LIBS+= $${RTKLIB} -lWs2_32 -lwinmm
+}
+
+PRE_TARGETDEPS = $${RTKLIB}
 
 SOURCES += \
     ../appcmn_qt/aboutdlg.cpp \
@@ -75,7 +101,6 @@
     ../appcmn_qt/tspandlg.h \
     fileseldlg.h \
     ../appcmn_qt/gmview.h \
-    ../appcmn_qt/gm_template.h \
     vmapdlg.h
 
 FORMS    += \
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/satdlg.cpp RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/satdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/satdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/satdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -5,71 +5,68 @@
 #include <QShowEvent>
 
 //---------------------------------------------------------------------------
-SatDialog::SatDialog(QWidget *parent)
+ SatDialog::SatDialog(QWidget *parent)
     : QDialog(parent)
 {
     setupUi(this);
 
-    for (int i = 0; i < 36; i++) ValidSat[i] = 1;
+	for (int i=0;i<36;i++) ValidSat[i]=1;
 
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(BtnCancelClick()));
-    connect(BtnChkAll, SIGNAL(clicked(bool)), this, SLOT(BtnChkAllClick()));
-    connect(BtnUnchkAll, SIGNAL(clicked(bool)), this, SLOT(BtnUnchkAllClick()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(BtnCancelClick()));
+    connect(BtnChkAll,SIGNAL(clicked(bool)),this,SLOT(BtnChkAllClick()));
+    connect(BtnUnchkAll,SIGNAL(clicked(bool)),this,SLOT(BtnUnchkAllClick()));
 }
 //---------------------------------------------------------------------------
-void SatDialog::showEvent(QShowEvent *event)
+void  SatDialog::showEvent(QShowEvent *event)
 {
-    QCheckBox *sat[] = {
-        PRN01, PRN02, PRN03, PRN04, PRN05, PRN06, PRN07, PRN08, PRN09, PRN10,
-        PRN11, PRN12, PRN13, PRN14, PRN15, PRN16, PRN17, PRN18, PRN19, PRN20,
-        PRN21, PRN22, PRN23, PRN24, PRN25, PRN26, PRN27, PRN28, PRN29, PRN30,
-        PRN31, PRN32, SBAS,  GLO,   GAL,   PRN33
+    QCheckBox *sat[]={
+		PRN01,PRN02,PRN03,PRN04,PRN05,PRN06,PRN07,PRN08,PRN09,PRN10,
+		PRN11,PRN12,PRN13,PRN14,PRN15,PRN16,PRN17,PRN18,PRN19,PRN20,
+		PRN21,PRN22,PRN23,PRN24,PRN25,PRN26,PRN27,PRN28,PRN29,PRN30,
+		PRN31,PRN32,SBAS,GLO,GAL,PRN33
 	};
 
     if (event->spontaneous()) return;
 
-    for (int i = 0; i < 36; i++) sat[i]->setChecked(ValidSat[i]);
+    for (int i=0;i<36;i++) sat[i]->setChecked(ValidSat[i]);
 }
 //---------------------------------------------------------------------------
-void SatDialog::BtnChkAllClick()
+void  SatDialog::BtnChkAllClick()
 {
-    QCheckBox *sat[] = {
-        PRN01, PRN02, PRN03, PRN04, PRN05, PRN06, PRN07, PRN08, PRN09, PRN10,
-        PRN11, PRN12, PRN13, PRN14, PRN15, PRN16, PRN17, PRN18, PRN19, PRN20,
-        PRN21, PRN22, PRN23, PRN24, PRN25, PRN26, PRN27, PRN28, PRN29, PRN30,
-        PRN31, PRN32, SBAS,  GLO,   GAL,   PRN33
+    QCheckBox *sat[]={
+		PRN01,PRN02,PRN03,PRN04,PRN05,PRN06,PRN07,PRN08,PRN09,PRN10,
+		PRN11,PRN12,PRN13,PRN14,PRN15,PRN16,PRN17,PRN18,PRN19,PRN20,
+		PRN21,PRN22,PRN23,PRN24,PRN25,PRN26,PRN27,PRN28,PRN29,PRN30,
+		PRN31,PRN32,SBAS,GLO,GAL,PRN33
 	};
-
-    for (int i = 0; i < 36; i++) sat[i]->setChecked(true);
+    for (int i=0;i<36;i++) sat[i]->setChecked(true);
 }
 //---------------------------------------------------------------------------
-void SatDialog::BtnUnchkAllClick()
+void  SatDialog::BtnUnchkAllClick()
 {
-    QCheckBox *sat[] = {
-        PRN01, PRN02, PRN03, PRN04, PRN05, PRN06, PRN07, PRN08, PRN09, PRN10,
-        PRN11, PRN12, PRN13, PRN14, PRN15, PRN16, PRN17, PRN18, PRN19, PRN20,
-        PRN21, PRN22, PRN23, PRN24, PRN25, PRN26, PRN27, PRN28, PRN29, PRN30,
-        PRN31, PRN32, SBAS,  GLO,   GAL,   PRN33
+    QCheckBox *sat[]={
+		PRN01,PRN02,PRN03,PRN04,PRN05,PRN06,PRN07,PRN08,PRN09,PRN10,
+		PRN11,PRN12,PRN13,PRN14,PRN15,PRN16,PRN17,PRN18,PRN19,PRN20,
+		PRN21,PRN22,PRN23,PRN24,PRN25,PRN26,PRN27,PRN28,PRN29,PRN30,
+		PRN31,PRN32,SBAS,GLO,GAL,PRN33
 	};
-
-    for (int i = 0; i < 36; i++) sat[i]->setChecked(false);
+    for (int i=0;i<36;i++) sat[i]->setChecked(false);
 }
 //---------------------------------------------------------------------------
-void SatDialog::BtnOkClick()
+void  SatDialog::BtnOkClick()
 {
-    QCheckBox *sat[] = {
-        PRN01, PRN02, PRN03, PRN04, PRN05, PRN06, PRN07, PRN08, PRN09, PRN10,
-        PRN11, PRN12, PRN13, PRN14, PRN15, PRN16, PRN17, PRN18, PRN19, PRN20,
-        PRN21, PRN22, PRN23, PRN24, PRN25, PRN26, PRN27, PRN28, PRN29, PRN30,
-        PRN31, PRN32, SBAS,  GLO,   GAL,   PRN33
+    QCheckBox *sat[]={
+		PRN01,PRN02,PRN03,PRN04,PRN05,PRN06,PRN07,PRN08,PRN09,PRN10,
+		PRN11,PRN12,PRN13,PRN14,PRN15,PRN16,PRN17,PRN18,PRN19,PRN20,
+		PRN21,PRN22,PRN23,PRN24,PRN25,PRN26,PRN27,PRN28,PRN29,PRN30,
+		PRN31,PRN32,SBAS,GLO,GAL,PRN33
 	};
-
-    for (int i = 0; i < 36; i++) ValidSat[i] = sat[i]->isChecked();
+    for (int i=0;i<36;i++) ValidSat[i]=sat[i]->isChecked();
     accept();
 }
 //---------------------------------------------------------------------------
-void SatDialog::BtnCancelClick()
+void  SatDialog::BtnCancelClick()
 {
     reject();
 }
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/satdlg.h RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/satdlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/satdlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/satdlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -24,8 +24,7 @@
 
 public:
 	int ValidSat[36];
-
-    explicit SatDialog(QWidget * parent = NULL);
+    explicit SatDialog(QWidget * parent=NULL);
 };
 //---------------------------------------------------------------------------
 #endif
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/satdlg.ui RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/satdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/satdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/satdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>460</width>
-    <height>266</height>
+    <width>501</width>
+    <height>271</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -659,48 +659,6 @@
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>PRN01</tabstop>
-  <tabstop>PRN02</tabstop>
-  <tabstop>PRN03</tabstop>
-  <tabstop>PRN04</tabstop>
-  <tabstop>PRN05</tabstop>
-  <tabstop>PRN06</tabstop>
-  <tabstop>PRN07</tabstop>
-  <tabstop>PRN08</tabstop>
-  <tabstop>PRN09</tabstop>
-  <tabstop>PRN10</tabstop>
-  <tabstop>PRN11</tabstop>
-  <tabstop>PRN12</tabstop>
-  <tabstop>PRN13</tabstop>
-  <tabstop>PRN14</tabstop>
-  <tabstop>PRN15</tabstop>
-  <tabstop>PRN16</tabstop>
-  <tabstop>PRN17</tabstop>
-  <tabstop>PRN18</tabstop>
-  <tabstop>PRN19</tabstop>
-  <tabstop>PRN20</tabstop>
-  <tabstop>PRN21</tabstop>
-  <tabstop>PRN22</tabstop>
-  <tabstop>PRN23</tabstop>
-  <tabstop>PRN24</tabstop>
-  <tabstop>PRN25</tabstop>
-  <tabstop>PRN26</tabstop>
-  <tabstop>PRN27</tabstop>
-  <tabstop>PRN28</tabstop>
-  <tabstop>PRN29</tabstop>
-  <tabstop>PRN30</tabstop>
-  <tabstop>PRN31</tabstop>
-  <tabstop>PRN32</tabstop>
-  <tabstop>SBAS</tabstop>
-  <tabstop>GLO</tabstop>
-  <tabstop>GAL</tabstop>
-  <tabstop>PRN33</tabstop>
-  <tabstop>BtnChkAll</tabstop>
-  <tabstop>BtnUnchkAll</tabstop>
-  <tabstop>BtnOk</tabstop>
-  <tabstop>BtnCancel</tabstop>
- </tabstops>
  <resources/>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/skydlg.cpp RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/skydlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/skydlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/skydlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -12,24 +12,24 @@
 extern Plot *plot;
 
 //---------------------------------------------------------------------------
-SkyImgDialog::SkyImgDialog(QWidget *parent)
+ SkyImgDialog::SkyImgDialog(QWidget *parent)
     : QDialog(parent)
 {
-    setupUi(this);
+     setupUi(this);
 
-    connect(BtnClose, SIGNAL(clicked(bool)), this, SLOT(BtnCloseClick()));
-    connect(BtnGenMask, SIGNAL(clicked(bool)), this, SLOT(BtnGenMaskClick()));
-    connect(BtnLoad, SIGNAL(clicked(bool)), this, SLOT(BtnLoadClick()));
-    connect(BtnSave, SIGNAL(clicked(bool)), this, SLOT(BtnSaveClick()));
-    connect(BtnUpdate, SIGNAL(clicked(bool)), this, SLOT(BtnUpdateClick()));
-    connect(SkyRes, SIGNAL(currentIndexChanged(int)), this, SLOT(SkyResChange()));
-    connect(SkyElMask, SIGNAL(clicked(bool)), this, SLOT(SkyElMaskClicked()));
-    connect(SkyDestCorr, SIGNAL(clicked(bool)), this, SLOT(SkyDestCorrClicked()));
-    connect(SkyFlip, SIGNAL(clicked(bool)), this, SLOT(SkyFlipClicked()));
-    connect(SkyBinarize, SIGNAL(clicked(bool)), this, SLOT(SkyBinarizeClicked()));
+     connect(BtnClose,SIGNAL(clicked(bool)),this,SLOT(BtnCloseClick()));
+     connect(BtnGenMask,SIGNAL(clicked(bool)),this,SLOT(BtnGenMaskClick()));
+     connect(BtnLoad,SIGNAL(clicked(bool)),this,SLOT(BtnLoadClick()));
+     connect(BtnSave,SIGNAL(clicked(bool)),this,SLOT(BtnSaveClick()));
+     connect(BtnUpdate,SIGNAL(clicked(bool)),this,SLOT(BtnUpdateClick()));
+     connect(SkyRes,SIGNAL(currentIndexChanged(int)),this,SLOT(SkyResChange()));
+     connect(SkyElMask,SIGNAL(clicked(bool)),this,SLOT(SkyElMaskClicked()));
+     connect(SkyDestCorr,SIGNAL(clicked(bool)),this,SLOT(SkyDestCorrClicked()));
+     connect(SkyFlip,SIGNAL(clicked(bool)),this,SLOT(SkyFlipClicked()));
+     connect(SkyBinarize,SIGNAL(clicked(bool)),this,SLOT(SkyBinarizeClicked()));
 }
 //---------------------------------------------------------------------------
-void SkyImgDialog::showEvent(QShowEvent *event)
+void  SkyImgDialog::showEvent(QShowEvent* event)
 {
     if (event->spontaneous()) return;
 
@@ -37,52 +37,52 @@
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void SkyImgDialog::BtnSaveClick()
+void  SkyImgDialog::BtnSaveClick()
 {
     QFile fp;
-    QString file = plot->SkyImageFile;
-
-    if (file == "") return;
+    QString file=plot->SkyImageFile;
+	if (file=="") return;
 	UpdateSky();
-    file = file + ".tag";
+	file=file+".tag";
     fp.setFileName(file);
-    if (QFile::exists(file))
-        if (QMessageBox::question(this, file, tr("File exists. Overwrite it?")) != QMessageBox::Yes) return;
+    if (QFile::exists(file)) {
+        if (QMessageBox::question(this,file,tr("File exists. Overwrite it?"))!=QMessageBox::Yes) return;
+	}
     if (!fp.open(QIODevice::WriteOnly)) return;
 
     QString data;
-    data = QString("%% sky image tag file: rtkplot %1 %2\n\n").arg(VER_RTKLIB).arg(PATCH_LEVEL);
-    data += QString("centx   = %1\n").arg(plot->SkyCent[0], 0, 'g', 6);
-    data += QString("centy   = %1\n").arg(plot->SkyCent[1], 0, 'g', 6);
-    data += QString("scale   = %1\n").arg(plot->SkyScale, 0, 'g', 6);
-    data += QString("roll    = %1\n").arg(plot->SkyFov[0], 0, 'g', 6);
-    data += QString("pitch   = %1\n").arg(plot->SkyFov[1], 0, 'g', 6);
-    data += QString("yaw     = %1\n").arg(plot->SkyFov[2], 0, 'g', 6);
-    data += QString("destcorr= %1\n").arg(plot->SkyDestCorr);
-    data += QString("resample= %1\n").arg(plot->SkyRes);
-    data += QString("flip    = %1\n").arg(plot->SkyFlip);
-    data += QString("dest    = %1 %2 %3 %4 %5 %6 %7 %8 %9s\n")
-        .arg(plot->SkyDest[1], 0, 'g', 6).arg(plot->SkyDest[2], 0, 'g', 6).arg(plot->SkyDest[3], 0, 'g', 6).arg(plot->SkyDest[4], 0, 'g', 6)
-        .arg(plot->SkyDest[5], 0, 'g', 6).arg(plot->SkyDest[6], 0, 'g', 6).arg(plot->SkyDest[7], 0, 'g', 6).arg(plot->SkyDest[8], 0, 'g', 6)
-        .arg(plot->SkyDest[9], 0, 'g', 6);
-    data += QString("elmask  = %1\n").arg(plot->SkyElMask);
-    data += QString("binarize= %1\n").arg(plot->SkyBinarize);
-    data += QString("binthr1 = %1\n").arg(plot->SkyBinThres1, 0, 'f', 2);
-    data += QString("binthr2 = %1f\n").arg(plot->SkyBinThres2, 0, 'f', 2);
+    data=QString("%% sky image tag file: rtkplot %1 %2\n\n").arg(VER_RTKLIB).arg(PATCH_LEVEL);
+    data+=QString("centx   = %1\n").arg(plot->SkyCent[0],0,'g',6);
+    data+=QString("centy   = %1\n").arg(plot->SkyCent[1],0,'g',6);
+    data+=QString("scale   = %1\n").arg(plot->SkyScale,0,'g',6);
+    data+=QString("roll    = %1\n").arg(plot->SkyFov[0],0,'g',6);
+    data+=QString("pitch   = %1\n").arg(plot->SkyFov[1],0,'g',6);
+    data+=QString("yaw     = %1\n").arg(plot->SkyFov[2],0,'g',6);
+    data+=QString("destcorr= %1\n").arg(plot->SkyDestCorr);
+    data+=QString("resample= %1\n").arg(plot->SkyRes);
+    data+=QString("flip    = %1\n").arg(plot->SkyFlip);
+    data+=QString("dest    = %1 %2 %3 %4 %5 %6 %7 %8 %9s\n")
+        .arg(plot->SkyDest[1],0,'g',6).arg(plot->SkyDest[2],0,'g',6).arg(plot->SkyDest[3],0,'g',6).arg(plot->SkyDest[4],0,'g',6)
+        .arg(plot->SkyDest[5],0,'g',6).arg(plot->SkyDest[6],0,'g',6).arg(plot->SkyDest[7],0,'g',6).arg(plot->SkyDest[8],0,'g',6)
+        .arg(plot->SkyDest[9],0,'g',6);
+    data+=QString("elmask  = %1\n").arg(plot->SkyElMask);
+    data+=QString("binarize= %1\n").arg(plot->SkyBinarize);
+    data+=QString("binthr1 = %1\n").arg(plot->SkyBinThres1,0,'f',2);
+    data+=QString("binthr2 = %1f\n").arg(plot->SkyBinThres2,0,'f',2);
     fp.write(data.toLatin1());
 }
 //---------------------------------------------------------------------------
-void SkyImgDialog::BtnUpdateClick()
+void  SkyImgDialog::BtnUpdateClick()
 {
 	UpdateSky();
 }
 //---------------------------------------------------------------------------
-void SkyImgDialog::BtnCloseClick()
+void  SkyImgDialog::BtnCloseClick()
 {
     accept();
 }
 //---------------------------------------------------------------------------
-void SkyImgDialog::UpdateField(void)
+void  SkyImgDialog::UpdateField(void)
 {
     setWindowTitle(plot->SkyImageFile);
 
@@ -91,18 +91,18 @@
     SkyCent1->setValue(plot->SkyCent[0]);
     SkyCent2->setValue(plot->SkyCent[1]);
     SkyScale->setValue(plot->SkyScale);
-    SkyFov1->setValue(plot->SkyFov[0]);
-    SkyFov2->setValue(plot->SkyFov[1]);
-    SkyFov3->setValue(plot->SkyFov[2]);
-    SkyDest1->setValue(plot->SkyDest[1]);
-    SkyDest2->setValue(plot->SkyDest[2]);
-    SkyDest3->setValue(plot->SkyDest[3]);
-    SkyDest4->setValue(plot->SkyDest[4]);
-    SkyDest5->setValue(plot->SkyDest[5]);
-    SkyDest6->setValue(plot->SkyDest[6]);
-    SkyDest7->setValue(plot->SkyDest[7]);
-    SkyDest8->setValue(plot->SkyDest[8]);
-    SkyDest9->setValue(plot->SkyDest[9]);
+    SkyFov1 ->setValue(plot->SkyFov[0]);
+    SkyFov2 ->setValue(plot->SkyFov[1]);
+    SkyFov3 ->setValue(plot->SkyFov[2]);
+    SkyDest1->setText(QString::number(plot->SkyDest[1],'f',1));
+    SkyDest2->setText(QString::number(plot->SkyDest[2],'f',1));
+    SkyDest3->setText(QString::number(plot->SkyDest[3],'f',1));
+    SkyDest4->setText(QString::number(plot->SkyDest[4],'f',1));
+    SkyDest5->setText(QString::number(plot->SkyDest[5],'f',1));
+    SkyDest6->setText(QString::number(plot->SkyDest[6],'f',1));
+    SkyDest7->setText(QString::number(plot->SkyDest[7],'f',1));
+    SkyDest8->setText(QString::number(plot->SkyDest[8],'f',1));
+    SkyDest9->setText(QString::number(plot->SkyDest[9],'f',1));
     SkyElMask->setChecked(plot->SkyElMask);
     SkyDestCorr->setChecked(plot->SkyDestCorr);
     SkyRes->setCurrentIndex(plot->SkyRes);
@@ -112,35 +112,35 @@
     SkyBinThres2->setValue(plot->SkyBinThres2);
 }
 //---------------------------------------------------------------------------
-void SkyImgDialog::UpdateSky(void)
+void  SkyImgDialog::UpdateSky(void)
 {
-    plot->SkyCent[0] = SkyCent1->value();
-    plot->SkyCent[1] = SkyCent2->value();
-    plot->SkyScale = SkyScale->value();
-    plot->SkyFov[0] = SkyFov1->value();
-    plot->SkyFov[1] = SkyFov2->value();
-    plot->SkyFov[2] = SkyFov3->value();
-    plot->SkyDest[1] = SkyDest1->value();
-    plot->SkyDest[2] = SkyDest2->value();
-    plot->SkyDest[3] = SkyDest3->value();
-    plot->SkyDest[4] = SkyDest4->value();
-    plot->SkyDest[5] = SkyDest5->value();
-    plot->SkyDest[6] = SkyDest6->value();
-    plot->SkyDest[7] = SkyDest7->value();
-    plot->SkyDest[8] = SkyDest8->value();
-    plot->SkyDest[9] = SkyDest9->value();
-    plot->SkyElMask = SkyElMask->isChecked();
-    plot->SkyDestCorr = SkyDestCorr->isChecked();
-    plot->SkyRes = SkyRes->currentIndex();
-    plot->SkyFlip = SkyFlip->isChecked();
-    plot->SkyBinarize = SkyBinarize->isChecked();
-    plot->SkyBinThres1 = SkyBinThres1->value();
-    plot->SkyBinThres2 = SkyBinThres2->value();
+    plot->SkyCent[0]=SkyCent1->text().toDouble();
+    plot->SkyCent[1]=SkyCent2->text().toDouble();
+    plot->SkyScale=SkyScale->text().toDouble();
+    plot->SkyFov[0]=SkyFov1->text().toDouble();
+    plot->SkyFov[1]=SkyFov2->text().toDouble();
+    plot->SkyFov[2]=SkyFov3->text().toDouble();
+    plot->SkyDest[1]=SkyDest1->text().toDouble();
+    plot->SkyDest[2]=SkyDest2->text().toDouble();
+    plot->SkyDest[3]=SkyDest3->text().toDouble();
+    plot->SkyDest[4]=SkyDest4->text().toDouble();
+    plot->SkyDest[5]=SkyDest5->text().toDouble();
+    plot->SkyDest[6]=SkyDest6->text().toDouble();
+    plot->SkyDest[7]=SkyDest7->text().toDouble();
+    plot->SkyDest[8]=SkyDest8->text().toDouble();
+    plot->SkyDest[9]=SkyDest9->text().toDouble();
+    plot->SkyElMask=SkyElMask->isChecked();
+    plot->SkyDestCorr=SkyDestCorr->isChecked();
+    plot->SkyRes=SkyRes->currentIndex();
+    plot->SkyFlip=SkyFlip->isChecked();
+    plot->SkyBinarize=SkyBinarize->isChecked();
+    plot->SkyBinThres1=SkyBinThres1->text().toDouble();
+    plot->SkyBinThres2=SkyBinThres2->text().toDouble();
 
     plot->UpdateSky();
 }
 //---------------------------------------------------------------------------
-void SkyImgDialog::UpdateEnable(void)
+void  SkyImgDialog::UpdateEnable(void)
 {
     SkyDest1->setEnabled(SkyDestCorr->isChecked());
     SkyDest2->setEnabled(SkyDestCorr->isChecked());
@@ -156,65 +156,67 @@
     BtnGenMask->setEnabled(SkyBinarize->isChecked());
 }
 //---------------------------------------------------------------------------
-void SkyImgDialog::SkyElMaskClicked()
+void  SkyImgDialog::SkyElMaskClicked()
 {
 	UpdateSky();
 }
 //---------------------------------------------------------------------------
-void SkyImgDialog::SkyDestCorrClicked()
+void  SkyImgDialog::SkyDestCorrClicked()
 {
 	UpdateSky();
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void SkyImgDialog::SkyFlipClicked()
+void  SkyImgDialog::SkyFlipClicked()
 {
 	UpdateSky();
 }
 //---------------------------------------------------------------------------
-void SkyImgDialog::SkyResChange()
+void  SkyImgDialog::SkyResChange()
 {
 	UpdateSky();
 }
 //---------------------------------------------------------------------------
-void SkyImgDialog::BtnLoadClick()
+void  SkyImgDialog::BtnLoadClick()
 {
-    plot->ReadSkyTag(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Open Tag"), QString(), tr("Tag File (*.tag);;All (*.*)"))));
+
+    plot->ReadSkyTag(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Open Tag"),QString(),"Tag File (*.tag);;All (*.*)")));
     UpdateField();
     plot->UpdateSky();
 }
 //---------------------------------------------------------------------------
-void SkyImgDialog::BtnGenMaskClick()
-{
-    QImage &bm = plot->SkyImageR;
-    double r, ca, sa, el, el0;
-    int x, y, w, h, az, n;
 
-    w = bm.width(); h = bm.height();
-    if (w <= 0 || h <= 0) return;
-
-    for (az = 0; az <= 360; az++) {
-        ca = cos(az * D2R);
-        sa = sin(az * D2R);
-        for (el = 90.0, n = 0, el0 = 0.0; el >= 0.0; el -= 0.1) {
-            r = (1.0 - el / 90.0) * plot->SkyScaleR;
-            x = (int)floor(w / 2.0 + sa * r + 0.5);
-            y = (int)floor(h / 2.0 + ca * r + 0.5);
-            if (x < 0 || x >= w || y < 0 || y >= h) continue;
-            QRgb pix = bm.pixel(x, y);
-            if (qRed(pix) < 255 && qGreen(pix) < 255 && qBlue(pix) < 255) {
-                if (++n == 1) el0 = el;
-                if (n >= 5) break;
-            } else {
-                n = 0;
+void  SkyImgDialog::BtnGenMaskClick()
+{
+    QImage &bm=plot->SkyImageR;
+    double r,ca,sa,el,el0;
+    int x,y,w,h,az,n;
+    
+    w=bm.width(); h=bm.height();
+    if (w<=0||h<=0) return;
+    
+    for (az=0;az<=360;az++) {
+        ca=cos(az*D2R);
+        sa=sin(az*D2R);
+        for (el=90.0,n=0,el0=0.0;el>=0.0;el-=0.1) {
+            r=(1.0-el/90.0)*plot->SkyScaleR;
+            x=(int)floor(w/2.0+sa*r+0.5);
+            y=(int)floor(h/2.0+ca*r+0.5);
+            if (x<0||x>=w||y<0||y>=h) continue;
+            QRgb pix=bm.pixel(x,y);
+            if (qRed(pix)<255&&qGreen(pix)<255&&qBlue(pix)<255) {
+                if (++n==1) el0=el;
+                if (n>=5) break;
             }
+            else n=0;
         }
-        plot->ElMaskData[az] = el0 == 90.0 ? 0.0 : el0 * D2R;
+        plot->ElMaskData[az]=el0==90.0?0.0:el0*D2R;
     }
     plot->UpdateSky();
 }
 //---------------------------------------------------------------------------
-void SkyImgDialog::SkyBinarizeClicked()
+
+void  SkyImgDialog::SkyBinarizeClicked()
 {
 	UpdateSky();
 	UpdateEnable();
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/skydlg.h RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/skydlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/skydlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/skydlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -31,7 +31,7 @@
     void UpdateEnable(void);
 	
 public:
-    explicit SkyImgDialog(QWidget *parent = NULL);
+    explicit SkyImgDialog(QWidget *parent=NULL);
     void UpdateField(void);
 };
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/skydlg.ui RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/skydlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/skydlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/skydlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>746</width>
-    <height>295</height>
+    <width>602</width>
+    <height>267</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -22,12 +22,6 @@
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
@@ -52,12 +46,6 @@
         <property name="enabled">
          <bool>true</bool>
         </property>
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
         <property name="toolTip">
          <string/>
         </property>
@@ -235,8 +223,8 @@
            </property>
           </widget>
          </item>
-         <item row="1" column="9">
-          <widget class="QLabel" name="Label19">
+         <item row="2" column="3">
+          <widget class="QLineEdit" name="SkyDest4">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -244,12 +232,12 @@
             <string/>
            </property>
            <property name="text">
-            <string>0</string>
+            <string>0.0</string>
            </property>
           </widget>
          </item>
-         <item row="1" column="5">
-          <widget class="QLabel" name="Label16">
+         <item row="2" column="1">
+          <widget class="QLineEdit" name="SkyDest2">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -257,12 +245,12 @@
             <string/>
            </property>
            <property name="text">
-            <string>30</string>
+            <string>0.0</string>
            </property>
           </widget>
          </item>
-         <item row="1" column="7">
-          <widget class="QLabel" name="Label18">
+         <item row="2" column="6">
+          <widget class="QLineEdit" name="SkyDest7">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -270,12 +258,12 @@
             <string/>
            </property>
            <property name="text">
-            <string>10</string>
+            <string>0.0</string>
            </property>
           </widget>
          </item>
-         <item row="1" column="4">
-          <widget class="QLabel" name="Label15">
+         <item row="2" column="2">
+          <widget class="QLineEdit" name="SkyDest3">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -283,12 +271,12 @@
             <string/>
            </property>
            <property name="text">
-            <string>40</string>
+            <string>0.0</string>
            </property>
           </widget>
          </item>
-         <item row="1" column="3">
-          <widget class="QLabel" name="Label14">
+         <item row="2" column="9">
+          <widget class="QLineEdit" name="SkyDest9">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -296,12 +284,12 @@
             <string/>
            </property>
            <property name="text">
-            <string>50</string>
+            <string>0.0</string>
            </property>
           </widget>
          </item>
-         <item row="1" column="2">
-          <widget class="QLabel" name="Label13">
+         <item row="2" column="7">
+          <widget class="QLineEdit" name="SkyDest8">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -309,12 +297,12 @@
             <string/>
            </property>
            <property name="text">
-            <string>60</string>
+            <string>0.0</string>
            </property>
           </widget>
          </item>
-         <item row="1" column="1">
-          <widget class="QLabel" name="Label12">
+         <item row="2" column="4">
+          <widget class="QLineEdit" name="SkyDest5">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -322,12 +310,12 @@
             <string/>
            </property>
            <property name="text">
-            <string>70</string>
+            <string>0.0</string>
            </property>
           </widget>
          </item>
-         <item row="1" column="0">
-          <widget class="QLabel" name="Label11">
+         <item row="2" column="0">
+          <widget class="QLineEdit" name="SkyDest1">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -335,12 +323,12 @@
             <string/>
            </property>
            <property name="text">
-            <string>80</string>
+            <string>0.0</string>
            </property>
           </widget>
          </item>
-         <item row="0" column="9">
-          <widget class="QLabel" name="Label20">
+         <item row="2" column="5">
+          <widget class="QLineEdit" name="SkyDest6">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -348,70 +336,124 @@
             <string/>
            </property>
            <property name="text">
-            <string>(deg)</string>
+            <string>0.0</string>
            </property>
           </widget>
          </item>
-         <item row="3" column="0">
-          <widget class="QDoubleSpinBox" name="SkyDest1">
-           <property name="decimals">
-            <number>1</number>
+         <item row="1" column="9">
+          <widget class="QLabel" name="Label19">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0</string>
            </property>
           </widget>
          </item>
-         <item row="3" column="1">
-          <widget class="QDoubleSpinBox" name="SkyDest2">
-           <property name="decimals">
-            <number>1</number>
+         <item row="1" column="5">
+          <widget class="QLabel" name="Label16">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>30</string>
            </property>
           </widget>
          </item>
-         <item row="3" column="2">
-          <widget class="QDoubleSpinBox" name="SkyDest3">
-           <property name="decimals">
-            <number>1</number>
+         <item row="1" column="7">
+          <widget class="QLabel" name="Label18">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>10</string>
            </property>
           </widget>
          </item>
-         <item row="3" column="3">
-          <widget class="QDoubleSpinBox" name="SkyDest4">
-           <property name="decimals">
-            <number>1</number>
+         <item row="1" column="4">
+          <widget class="QLabel" name="Label15">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>40</string>
            </property>
           </widget>
          </item>
-         <item row="3" column="4">
-          <widget class="QDoubleSpinBox" name="SkyDest5">
-           <property name="decimals">
-            <number>1</number>
+         <item row="1" column="3">
+          <widget class="QLabel" name="Label14">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>50</string>
            </property>
           </widget>
          </item>
-         <item row="3" column="5">
-          <widget class="QDoubleSpinBox" name="SkyDest6">
-           <property name="decimals">
-            <number>1</number>
+         <item row="1" column="2">
+          <widget class="QLabel" name="Label13">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>60</string>
            </property>
           </widget>
          </item>
-         <item row="3" column="6">
-          <widget class="QDoubleSpinBox" name="SkyDest7">
-           <property name="decimals">
-            <number>1</number>
+         <item row="1" column="1">
+          <widget class="QLabel" name="Label12">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>70</string>
            </property>
           </widget>
          </item>
-         <item row="3" column="7">
-          <widget class="QDoubleSpinBox" name="SkyDest8">
-           <property name="decimals">
-            <number>1</number>
+         <item row="1" column="0">
+          <widget class="QLabel" name="Label11">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>80</string>
            </property>
           </widget>
          </item>
-         <item row="3" column="9">
-          <widget class="QDoubleSpinBox" name="SkyDest9">
-           <property name="decimals">
-            <number>1</number>
+         <item row="0" column="9">
+          <widget class="QLabel" name="Label20">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>(deg)</string>
            </property>
           </widget>
          </item>
@@ -747,37 +789,6 @@
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>SkySize1</tabstop>
-  <tabstop>SkySize2</tabstop>
-  <tabstop>SkyFlip</tabstop>
-  <tabstop>SkyCent1</tabstop>
-  <tabstop>SkyCent2</tabstop>
-  <tabstop>SkyScale</tabstop>
-  <tabstop>SkyFov1</tabstop>
-  <tabstop>SkyFov2</tabstop>
-  <tabstop>SkyFov3</tabstop>
-  <tabstop>SkyDest1</tabstop>
-  <tabstop>SkyDest2</tabstop>
-  <tabstop>SkyDest3</tabstop>
-  <tabstop>SkyDest4</tabstop>
-  <tabstop>SkyDest5</tabstop>
-  <tabstop>SkyDest6</tabstop>
-  <tabstop>SkyDest7</tabstop>
-  <tabstop>SkyDest8</tabstop>
-  <tabstop>SkyDest9</tabstop>
-  <tabstop>SkyDestCorr</tabstop>
-  <tabstop>SkyElMask</tabstop>
-  <tabstop>SkyRes</tabstop>
-  <tabstop>SkyBinarize</tabstop>
-  <tabstop>SkyBinThres1</tabstop>
-  <tabstop>SkyBinThres2</tabstop>
-  <tabstop>BtnSave</tabstop>
-  <tabstop>BtnLoad</tabstop>
-  <tabstop>BtnGenMask</tabstop>
-  <tabstop>BtnUpdate</tabstop>
-  <tabstop>BtnClose</tabstop>
- </tabstops>
  <resources/>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/vmapdlg.cpp RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/vmapdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkplot_qt/vmapdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkplot_qt/vmapdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -17,46 +17,47 @@
 {
     setupUi(this);
 
-    connect(BtnColor1, SIGNAL(clicked(bool)), this, SLOT(BtnColor1Click()));
-    connect(BtnColor2, SIGNAL(clicked(bool)), this, SLOT(BtnColor2Click()));
-    connect(BtnColor3, SIGNAL(clicked(bool)), this, SLOT(BtnColor3Click()));
-    connect(BtnColor4, SIGNAL(clicked(bool)), this, SLOT(BtnColor4Click()));
-    connect(BtnColor5, SIGNAL(clicked(bool)), this, SLOT(BtnColor5Click()));
-    connect(BtnColor6, SIGNAL(clicked(bool)), this, SLOT(BtnColor6Click()));
-    connect(BtnColor7, SIGNAL(clicked(bool)), this, SLOT(BtnColor7Click()));
-    connect(BtnColor8, SIGNAL(clicked(bool)), this, SLOT(BtnColor8Click()));
-    connect(BtnColor9, SIGNAL(clicked(bool)), this, SLOT(BtnColor9Click()));
-    connect(BtnColor10, SIGNAL(clicked(bool)), this, SLOT(BtnColor10Click()));
-    connect(BtnColor11, SIGNAL(clicked(bool)), this, SLOT(BtnColor11Click()));
-    connect(BtnColor12, SIGNAL(clicked(bool)), this, SLOT(BtnColor12Click()));
-    connect(Vis1, SIGNAL(clicked(bool)), this, SLOT(VisClick()));
-    connect(Vis2, SIGNAL(clicked(bool)), this, SLOT(VisClick()));
-    connect(Vis3, SIGNAL(clicked(bool)), this, SLOT(VisClick()));
-    connect(Vis4, SIGNAL(clicked(bool)), this, SLOT(VisClick()));
-    connect(Vis5, SIGNAL(clicked(bool)), this, SLOT(VisClick()));
-    connect(Vis6, SIGNAL(clicked(bool)), this, SLOT(VisClick()));
-    connect(Vis7, SIGNAL(clicked(bool)), this, SLOT(VisClick()));
-    connect(Vis8, SIGNAL(clicked(bool)), this, SLOT(VisClick()));
-    connect(Vis9, SIGNAL(clicked(bool)), this, SLOT(VisClick()));
-    connect(Vis10, SIGNAL(clicked(bool)), this, SLOT(VisClick()));
-    connect(Vis11, SIGNAL(clicked(bool)), this, SLOT(VisClick()));
-    connect(Vis12, SIGNAL(clicked(bool)), this, SLOT(VisClick()));
-    connect(Layer1, SIGNAL(clicked(bool)), this, SLOT(LayerClick()));
-    connect(Layer2, SIGNAL(clicked(bool)), this, SLOT(LayerClick()));
-    connect(Layer3, SIGNAL(clicked(bool)), this, SLOT(LayerClick()));
-    connect(Layer4, SIGNAL(clicked(bool)), this, SLOT(LayerClick()));
-    connect(Layer5, SIGNAL(clicked(bool)), this, SLOT(LayerClick()));
-    connect(Layer6, SIGNAL(clicked(bool)), this, SLOT(LayerClick()));
-    connect(Layer7, SIGNAL(clicked(bool)), this, SLOT(LayerClick()));
-    connect(Layer8, SIGNAL(clicked(bool)), this, SLOT(LayerClick()));
-    connect(Layer9, SIGNAL(clicked(bool)), this, SLOT(LayerClick()));
-    connect(Layer10, SIGNAL(clicked(bool)), this, SLOT(LayerClick()));
-    connect(Layer11, SIGNAL(clicked(bool)), this, SLOT(LayerClick()));
-    connect(Layer12, SIGNAL(clicked(bool)), this, SLOT(LayerClick()));
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnUp, SIGNAL(clicked(bool)), this, SLOT(BtnUpClick()));
-    connect(BtnDown, SIGNAL(clicked(bool)), this, SLOT(BtnDownClick()));
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
+    connect(BtnColor1,SIGNAL(clicked(bool)),this,SLOT(BtnColor1Click()));
+    connect(BtnColor2,SIGNAL(clicked(bool)),this,SLOT(BtnColor2Click()));
+    connect(BtnColor3,SIGNAL(clicked(bool)),this,SLOT(BtnColor3Click()));
+    connect(BtnColor4,SIGNAL(clicked(bool)),this,SLOT(BtnColor4Click()));
+    connect(BtnColor5,SIGNAL(clicked(bool)),this,SLOT(BtnColor5Click()));
+    connect(BtnColor6,SIGNAL(clicked(bool)),this,SLOT(BtnColor6Click()));
+    connect(BtnColor7,SIGNAL(clicked(bool)),this,SLOT(BtnColor7Click()));
+    connect(BtnColor8,SIGNAL(clicked(bool)),this,SLOT(BtnColor8Click()));
+    connect(BtnColor9,SIGNAL(clicked(bool)),this,SLOT(BtnColor9Click()));
+    connect(BtnColor10,SIGNAL(clicked(bool)),this,SLOT(BtnColor10Click()));
+    connect(BtnColor11,SIGNAL(clicked(bool)),this,SLOT(BtnColor11Click()));
+    connect(BtnColor12,SIGNAL(clicked(bool)),this,SLOT(BtnColor12Click()));
+    connect(Vis1,SIGNAL(clicked(bool)),this,SLOT(VisClick()));
+    connect(Vis2,SIGNAL(clicked(bool)),this,SLOT(VisClick()));
+    connect(Vis3,SIGNAL(clicked(bool)),this,SLOT(VisClick()));
+    connect(Vis4,SIGNAL(clicked(bool)),this,SLOT(VisClick()));
+    connect(Vis5,SIGNAL(clicked(bool)),this,SLOT(VisClick()));
+    connect(Vis6,SIGNAL(clicked(bool)),this,SLOT(VisClick()));
+    connect(Vis7,SIGNAL(clicked(bool)),this,SLOT(VisClick()));
+    connect(Vis8,SIGNAL(clicked(bool)),this,SLOT(VisClick()));
+    connect(Vis9,SIGNAL(clicked(bool)),this,SLOT(VisClick()));
+    connect(Vis10,SIGNAL(clicked(bool)),this,SLOT(VisClick()));
+    connect(Vis11,SIGNAL(clicked(bool)),this,SLOT(VisClick()));
+    connect(Vis12,SIGNAL(clicked(bool)),this,SLOT(VisClick()));
+    connect(Layer1,SIGNAL(clicked(bool)),this,SLOT(LayerClick()));
+    connect(Layer2,SIGNAL(clicked(bool)),this,SLOT(LayerClick()));
+    connect(Layer3,SIGNAL(clicked(bool)),this,SLOT(LayerClick()));
+    connect(Layer4,SIGNAL(clicked(bool)),this,SLOT(LayerClick()));
+    connect(Layer5,SIGNAL(clicked(bool)),this,SLOT(LayerClick()));
+    connect(Layer6,SIGNAL(clicked(bool)),this,SLOT(LayerClick()));
+    connect(Layer7,SIGNAL(clicked(bool)),this,SLOT(LayerClick()));
+    connect(Layer8,SIGNAL(clicked(bool)),this,SLOT(LayerClick()));
+    connect(Layer9,SIGNAL(clicked(bool)),this,SLOT(LayerClick()));
+    connect(Layer10,SIGNAL(clicked(bool)),this,SLOT(LayerClick()));
+    connect(Layer11,SIGNAL(clicked(bool)),this,SLOT(LayerClick()));
+    connect(Layer12,SIGNAL(clicked(bool)),this,SLOT(LayerClick()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnUp,SIGNAL(clicked(bool)),this,SLOT(BtnUpClick()));
+    connect(BtnDown,SIGNAL(clicked(bool)),this,SLOT(BtnDownClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+
 }
 //---------------------------------------------------------------------------
 void VecMapDialog::BtnColor1Click()
@@ -65,10 +66,10 @@
 
     dialog.setCurrentColor(Colors[0]);
 
-    if (dialog.exec() != QDialog::Accepted) return;
+    if (dialog.exec()!=QDialog::Accepted) return;
 
     Color1->setStyleSheet(QString("QFrame {background-color: %1;}").arg(color2String(dialog.currentColor())));
-    Colors[0] = dialog.currentColor();
+    Colors[0]=dialog.currentColor();
 }
 //---------------------------------------------------------------------------
 void VecMapDialog::BtnColor2Click()
@@ -77,10 +78,10 @@
 
     dialog.setCurrentColor(Colors[1]);
 
-    if (dialog.exec() != QDialog::Accepted) return;
+    if (dialog.exec()!=QDialog::Accepted) return;
 
     Color2->setStyleSheet(QString("QFrame {background-color: %1;}").arg(color2String(dialog.currentColor())));
-    Colors[1] = dialog.currentColor();
+    Colors[1]=dialog.currentColor();
 }
 //---------------------------------------------------------------------------
 void VecMapDialog::BtnColor3Click()
@@ -89,10 +90,10 @@
 
     dialog.setCurrentColor(Colors[2]);
 
-    if (dialog.exec() != QDialog::Accepted) return;
+    if (dialog.exec()!=QDialog::Accepted) return;
 
     Color3->setStyleSheet(QString("QFrame {background-color: %1;}").arg(color2String(dialog.currentColor())));
-    Colors[2] = dialog.currentColor();
+    Colors[2]=dialog.currentColor();
 }
 //---------------------------------------------------------------------------
 void VecMapDialog::BtnColor4Click()
@@ -101,10 +102,10 @@
 
     dialog.setCurrentColor(Colors[3]);
 
-    if (dialog.exec() != QDialog::Accepted) return;
+    if (dialog.exec()!=QDialog::Accepted) return;
 
     Color4->setStyleSheet(QString("QFrame {background-color: %1;}").arg(color2String(dialog.currentColor())));
-    Colors[3] = dialog.currentColor();
+    Colors[3]=dialog.currentColor();
 }
 //---------------------------------------------------------------------------
 void VecMapDialog::BtnColor5Click()
@@ -113,10 +114,10 @@
 
     dialog.setCurrentColor(Colors[4]);
 
-    if (dialog.exec() != QDialog::Accepted) return;
+    if (dialog.exec()!=QDialog::Accepted) return;
 
     Color5->setStyleSheet(QString("QFrame {background-color: %1;}").arg(color2String(dialog.currentColor())));
-    Colors[4] = dialog.currentColor();
+    Colors[4]=dialog.currentColor();
 }
 //---------------------------------------------------------------------------
 void VecMapDialog::BtnColor6Click()
@@ -125,10 +126,10 @@
 
     dialog.setCurrentColor(Colors[5]);
 
-    if (dialog.exec() != QDialog::Accepted) return;
+    if (dialog.exec()!=QDialog::Accepted) return;
 
     Color6->setStyleSheet(QString("QFrame {background-color: %1;}").arg(color2String(dialog.currentColor())));
-    Colors[5] = dialog.currentColor();
+    Colors[5]=dialog.currentColor();
 }
 //---------------------------------------------------------------------------
 void VecMapDialog::BtnColor7Click()
@@ -137,10 +138,10 @@
 
     dialog.setCurrentColor(Colors[6]);
 
-    if (dialog.exec() != QDialog::Accepted) return;
+    if (dialog.exec()!=QDialog::Accepted) return;
 
     Color7->setStyleSheet(QString("QFrame {background-color: %1;}").arg(color2String(dialog.currentColor())));
-    Colors[6] = dialog.currentColor();
+    Colors[6]=dialog.currentColor();
 }
 //---------------------------------------------------------------------------
 void VecMapDialog::BtnColor8Click()
@@ -149,10 +150,10 @@
 
     dialog.setCurrentColor(Colors[7]);
 
-    if (dialog.exec() != QDialog::Accepted) return;
+    if (dialog.exec()!=QDialog::Accepted) return;
 
     Color8->setStyleSheet(QString("QFrame {background-color: %1;}").arg(color2String(dialog.currentColor())));
-    Colors[7] = dialog.currentColor();
+    Colors[7]=dialog.currentColor();
 }
 //---------------------------------------------------------------------------
 void VecMapDialog::BtnColor9Click()
@@ -161,10 +162,10 @@
 
     dialog.setCurrentColor(Colors[8]);
 
-    if (dialog.exec() != QDialog::Accepted) return;
+    if (dialog.exec()!=QDialog::Accepted) return;
 
     Color9->setStyleSheet(QString("QFrame {background-color: %1;}").arg(color2String(dialog.currentColor())));
-    Colors[8] = dialog.currentColor();
+    Colors[8]=dialog.currentColor();
 }
 //---------------------------------------------------------------------------
 void VecMapDialog::BtnColor10Click()
@@ -173,10 +174,10 @@
 
     dialog.setCurrentColor(Colors[9]);
 
-    if (dialog.exec() != QDialog::Accepted) return;
+    if (dialog.exec()!=QDialog::Accepted) return;
 
     Color10->setStyleSheet(QString("QFrame {background-color: %1;}").arg(color2String(dialog.currentColor())));
-    Colors[9] = dialog.currentColor();
+    Colors[9]=dialog.currentColor();
 }
 //---------------------------------------------------------------------------
 void VecMapDialog::BtnColor11Click()
@@ -185,10 +186,10 @@
 
     dialog.setCurrentColor(Colors[10]);
 
-    if (dialog.exec() != QDialog::Accepted) return;
+    if (dialog.exec()!=QDialog::Accepted) return;
 
     Color11->setStyleSheet(QString("QFrame {background-color: %1;}").arg(color2String(dialog.currentColor())));
-    Colors[10] = dialog.currentColor();
+    Colors[10]=dialog.currentColor();
 }
 //---------------------------------------------------------------------------
 void VecMapDialog::BtnColor12Click()
@@ -197,117 +198,119 @@
 
     dialog.setCurrentColor(Colors[11]);
 
-    if (dialog.exec() != QDialog::Accepted) return;
+    if (dialog.exec()!=QDialog::Accepted) return;
 
     Color12->setStyleSheet(QString("QFrame {background-color: %1;}").arg(color2String(dialog.currentColor())));
-    Colors[11] = dialog.currentColor();
+    Colors[11]=dialog.currentColor();
 }
 //---------------------------------------------------------------------------
 void VecMapDialog::LayerClick()
 {
-    QRadioButton *layer[] = {
-        Layer1,	 Layer2,  Layer3, Layer4, Layer5, Layer6, Layer7, Layer8, Layer9,
-        Layer10, Layer11, Layer12
+    QRadioButton *layer[]={
+		Layer1,Layer2,Layer3,Layer4,Layer5,Layer6,Layer7,Layer8,Layer9,
+		Layer10,Layer11,Layer12
 	};
-
-    for (int i = 0; i < MAXMAPLAYER; i++)
-        layer[i]->setChecked((layer[i] == (QRadioButton *)sender()));
+	for (int i=0;i<MAXMAPLAYER;i++) {
+        layer[i]->setChecked((layer[i]==(QRadioButton *)sender()));
+	}
 }
 //---------------------------------------------------------------------------
 void VecMapDialog::BtnUpClick()
 {
-    QRadioButton *layer[] = {
-        Layer1,	 Layer2,  Layer3, Layer4, Layer5, Layer6, Layer7, Layer8, Layer9,
-        Layer10, Layer11, Layer12
+    QRadioButton *layer[]={
+		Layer1,Layer2,Layer3,Layer4,Layer5,Layer6,Layer7,Layer8,Layer9,
+		Layer10,Layer11,Layer12
 	};
-/*    QFrame *color[]={
- *              Color1,Color2,Color3,Color4,Color5,Color6,Color7,Color8,Color9,
- *              Color10,Color11,Color12
- *      };
- *  QColor col;*/
+    QFrame *color[]={
+		Color1,Color2,Color3,Color4,Color5,Color6,Color7,Color8,Color9,
+		Color10,Color11,Color12
+	};
+    QColor col;
 	gisd_t *data;
 	char name[256];
-    int i, flag;
-
-    for (i = 0; i < MAXMAPLAYER; i++)
+	int i,flag;
+	
+	for (i=0;i<MAXMAPLAYER;i++) {
         if (layer[i]->isChecked()) break;
-    if (i == 0 || i >= MAXMAPLAYER) return;
-    strcpy(name, Gis.name[i - 1]);
-    strcpy(Gis.name[i - 1], Gis.name[i]);
-    strcpy(Gis.name[i], name);
-    flag = Gis.flag[i - 1];
-    Gis.flag[i - 1] = Gis.flag[i];
-    Gis.flag[i] = flag;
-    data = Gis.data[i - 1];
-    Gis.data[i - 1] = Gis.data[i];
-    Gis.data[i] = data;
+	}
+	if (i==0||i>=MAXMAPLAYER) return;
+	strcpy(name,Gis.name[i-1]);
+	strcpy(Gis.name[i-1],Gis.name[i]);
+	strcpy(Gis.name[i],name);
+	flag=Gis.flag[i-1];
+	Gis.flag[i-1]=Gis.flag[i];
+	Gis.flag[i]=flag;
+	data=Gis.data[i-1];
+	Gis.data[i-1]=Gis.data[i];
+	Gis.data[i]=data;
 	//col=color[i-1]->Color;
 	//color[i-1]->Color=color[i]->Color;
 	//color[i]->Color=col;
-    layer[i - 1]->setChecked(true);
+    layer[i-1]->setChecked(true);
     layer[i]->setChecked(false);
 	UpdateLayer();
 }
 //---------------------------------------------------------------------------
 void VecMapDialog::BtnDownClick()
 {
-    QRadioButton *layer[] = {
-        Layer1,	 Layer2,  Layer3, Layer4, Layer5, Layer6, Layer7, Layer8, Layer9,
-        Layer10, Layer11, Layer12
+    QRadioButton *layer[]={
+		Layer1,Layer2,Layer3,Layer4,Layer5,Layer6,Layer7,Layer8,Layer9,
+		Layer10,Layer11,Layer12
 	};
-    /*QFrame *color[]={
-     *          Color1,Color2,Color3,Color4,Color5,Color6,Color7,Color8,Color9,
-     *          Color10,Color11,Color12
-     *  };
-     * QColor col;*/
+    QFrame *color[]={
+		Color1,Color2,Color3,Color4,Color5,Color6,Color7,Color8,Color9,
+		Color10,Color11,Color12
+	};
+    QColor col;
 	gisd_t *data;
 	char name[256];
-    int i, flag;
-
-    for (i = 0; i < MAXMAPLAYER; i++)
+	int i,flag;
+	
+	for (i=0;i<MAXMAPLAYER;i++) {
         if (layer[i]->isChecked()) break;
-    if (i == MAXMAPLAYER - 1 || i >= MAXMAPLAYER) return;
-    strcpy(name, Gis.name[i + 1]);
-    strcpy(Gis.name[i + 1], Gis.name[i]);
-    strcpy(Gis.name[i], name);
-    flag = Gis.flag[i + 1];
-    Gis.flag[i + 1] = Gis.flag[i];
-    Gis.flag[i] = flag;
-    data = Gis.data[i + 1];
-    Gis.data[i + 1] = Gis.data[i];
-    Gis.data[i] = data;
+	}
+	if (i==MAXMAPLAYER-1||i>=MAXMAPLAYER) return;
+	strcpy(name,Gis.name[i+1]);
+	strcpy(Gis.name[i+1],Gis.name[i]);
+	strcpy(Gis.name[i],name);
+	flag=Gis.flag[i+1];
+	Gis.flag[i+1]=Gis.flag[i];
+	Gis.flag[i]=flag;
+	data=Gis.data[i+1];
+	Gis.data[i+1]=Gis.data[i];
+	Gis.data[i]=data;
 	//col=color[i+1]->Color;
 	//color[i+1]->Color=color[i]->Color;
 	//color[i]->Color=col;
-    layer[i + 1]->setChecked(true);
+    layer[i+1]->setChecked(true);
     layer[i]->setChecked(false);
 	UpdateLayer();
 }
 //---------------------------------------------------------------------------
 void VecMapDialog::VisClick()
 {
-    QCheckBox *vis[] = {
-        Vis1, Vis2, Vis3, Vis4, Vis5, Vis6, Vis7, Vis8, Vis9, Vis10, Vis11, Vis12
+    QCheckBox *vis[]={
+		Vis1,Vis2,Vis3,Vis4,Vis5,Vis6,Vis7,Vis8,Vis9,Vis10,Vis11,Vis12
 	};
-
-    for (int i = 0; i < MAXMAPLAYER; i++)
-        if (qobject_cast<QCheckBox *>(sender()) == vis[i]) Gis.flag[i] = vis[i]->isChecked() ? 1 : 0;
+	for (int i=0;i<MAXMAPLAYER;i++) {
+        if ((QCheckBox *)sender()==vis[i]) Gis.flag[i]=vis[i]->isChecked()?1:0;
+	}
 }
 //---------------------------------------------------------------------------
-void VecMapDialog::showEvent(QShowEvent *event)
+void VecMapDialog::showEvent (QShowEvent *event)
 {
     if (event->spontaneous()) return;
 
-    QRadioButton *layer[] = {
-        Layer1,	 Layer2,  Layer3, Layer4, Layer5, Layer6, Layer7, Layer8, Layer9,
-        Layer10, Layer11, Layer12
+    QRadioButton *layer[]={
+		Layer1,Layer2,Layer3,Layer4,Layer5,Layer6,Layer7,Layer8,Layer9,
+		Layer10,Layer11,Layer12
 	};
-    QFrame *color[] = {
-        Color1,	 Color2,  Color3, Color4, Color5, Color6, Color7, Color8, Color9,
-        Color10, Color11, Color12
+    QFrame *color[]={
+		Color1,Color2,Color3,Color4,Color5,Color6,Color7,Color8,Color9,
+		Color10,Color11,Color12
 	};
-    Gis = plot->Gis;
-    for (int i = 0; i < MAXMAPLAYER; i++) {
+    Gis=plot->Gis;
+	for (int i=0;i<MAXMAPLAYER;i++) {
         layer[i]->setChecked(false);
         color[i]->setStyleSheet(QString("QFrame {background-color: %1;}").arg(color2String(plot->MapColor[i])));
 	}
@@ -316,27 +319,28 @@
 //---------------------------------------------------------------------------
 void VecMapDialog::BtnOkClick()
 {
-    for (int i = 0; i < MAXMAPLAYER; i++)
-        plot->MapColor[i] = Colors[i];
+	for (int i=0;i<MAXMAPLAYER;i++) {
+        plot->MapColor[i]=Colors[i];
+	}
 
-    plot->Gis = Gis;
+    plot->Gis=Gis;
 
     accept();
 }
 //---------------------------------------------------------------------------
 void VecMapDialog::UpdateLayer(void)
 {
-    QRadioButton *layer[] = {
-        Layer1,	 Layer2,  Layer3, Layer4, Layer5, Layer6, Layer7, Layer8, Layer9,
-        Layer10, Layer11, Layer12
+    QRadioButton *layer[]={
+		Layer1,Layer2,Layer3,Layer4,Layer5,Layer6,Layer7,Layer8,Layer9,
+		Layer10,Layer11,Layer12
 	};
-    QCheckBox *vis[] = {
-        Vis1, Vis2, Vis3, Vis4, Vis5, Vis6, Vis7, Vis8, Vis9, Vis10, Vis11, Vis12
+    QCheckBox *vis[]={
+		Vis1,Vis2,Vis3,Vis4,Vis5,Vis6,Vis7,Vis8,Vis9,Vis10,Vis11,Vis12
 	};
-
-    for (int i = 0; i < MAXMAPLAYER; i++) {
+	for (int i=0;i<MAXMAPLAYER;i++) {
         layer[i]->setText(Gis.name[i]);
         vis[i]->setChecked(Gis.flag[i]);
 	}
 }
 //---------------------------------------------------------------------------
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkpost/postmain.cpp RTKLIB-rtklib_2.4.3_new/app/rtkpost/postmain.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkpost/postmain.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkpost/postmain.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -66,7 +66,7 @@
 extern "C" {
 
 // show message in message area ---------------------------------------------
-extern int showmsg(const char *format, ...)
+extern int showmsg(char *format, ...)
 {
     va_list arg;
     char buff[1024];
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/extopt.cpp RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/extopt.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/extopt.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/extopt.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -10,15 +10,15 @@
 {
     setupUi(this);
 
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(ExtEna0, SIGNAL(clicked(bool)), this, SLOT(ExtEna0Click()));
-    connect(ExtEna1, SIGNAL(clicked(bool)), this, SLOT(ExtEna1Click()));
-    connect(ExtEna2, SIGNAL(clicked(bool)), this, SLOT(ExtEna2Click()));
-    connect(ExtEna3, SIGNAL(clicked(bool)), this, SLOT(ExtEna3Click()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(ExtEna0,SIGNAL(clicked(bool)),this,SLOT(ExtEna0Click()));
+    connect(ExtEna1,SIGNAL(clicked(bool)),this,SLOT(ExtEna1Click()));
+    connect(ExtEna2,SIGNAL(clicked(bool)),this,SLOT(ExtEna2Click()));
+    connect(ExtEna3,SIGNAL(clicked(bool)),this,SLOT(ExtEna3Click()));
 }
 //---------------------------------------------------------------------------
-void ExtOptDialog::showEvent(QShowEvent *event)
+void ExtOptDialog::showEvent(QShowEvent* event)
 {
     if (event->spontaneous()) return;
 
@@ -54,80 +54,79 @@
 //---------------------------------------------------------------------------
 void ExtOptDialog::GetExtErrOpt(void)
 {
-    QDoubleSpinBox *editc[][6] = {
-        { CodeErr00, CodeErr01, CodeErr02, CodeErr03, CodeErr04, CodeErr05 },
-        { CodeErr10, CodeErr11, CodeErr12, CodeErr13, CodeErr14, CodeErr15 },
-        { CodeErr20, CodeErr21, CodeErr22, CodeErr23, CodeErr24, CodeErr25 }
+    QLineEdit *editc[][6]={
+		{CodeErr00,CodeErr01,CodeErr02,CodeErr03,CodeErr04,CodeErr05},
+		{CodeErr10,CodeErr11,CodeErr12,CodeErr13,CodeErr14,CodeErr15},
+		{CodeErr20,CodeErr21,CodeErr22,CodeErr23,CodeErr24,CodeErr25}
 	};
-    QDoubleSpinBox *editp[][6] = {
-        { PhaseErr00, PhaseErr01, PhaseErr02, PhaseErr03, PhaseErr04, PhaseErr05 },
-        { PhaseErr10, PhaseErr11, PhaseErr12, PhaseErr13, PhaseErr14, PhaseErr15 },
-        { PhaseErr20, PhaseErr21, PhaseErr22, PhaseErr23, PhaseErr24, PhaseErr25 }
+    QLineEdit *editp[][6]={
+		{PhaseErr00,PhaseErr01,PhaseErr02,PhaseErr03,PhaseErr04,PhaseErr05},
+		{PhaseErr10,PhaseErr11,PhaseErr12,PhaseErr13,PhaseErr14,PhaseErr15},
+		{PhaseErr20,PhaseErr21,PhaseErr22,PhaseErr23,PhaseErr24,PhaseErr25}
 	};
-
+	
     ExtEna0->setChecked(optDialog->ExtErr.ena[0]);
     ExtEna1->setChecked(optDialog->ExtErr.ena[1]);
     ExtEna2->setChecked(optDialog->ExtErr.ena[2]);
     ExtEna3->setChecked(optDialog->ExtErr.ena[3]);
-
-    for (int i = 0; i < 3; i++) for (int j = 0; j < 6; j++) {
-            editc[i][j]->setValue(optDialog->ExtErr.cerr[i][j]);
-            editp[i][j]->setValue(optDialog->ExtErr.perr[i][j]);
-        }
-    GpsGloB0->setValue(optDialog->ExtErr.gpsglob[0]);
-    GpsGloB1->setValue(optDialog->ExtErr.gpsglob[1]);
-    GloICB0->setValue(optDialog->ExtErr.gloicb[0]);
-    GloICB1->setValue(optDialog->ExtErr.gloicb[1]);
+	
+	for (int i=0;i<3;i++) for (int j=0;j<6;j++) {
+        editc[i][j]->setText(QString::number(optDialog->ExtErr.cerr[i][j],'f',3));
+        editp[i][j]->setText(QString::number(optDialog->ExtErr.perr[i][j],'f',3));
+	}
+    GpsGloB0->setText(QString::number(optDialog->ExtErr.gpsglob[0],'f',3));
+    GpsGloB1->setText(QString::number(optDialog->ExtErr.gpsglob[1],'f',3));
+    GloICB0->setText(QString::number(optDialog->ExtErr.gloicb[0],'f',3));
+    GloICB1->setText(QString::number(optDialog->ExtErr.gloicb[1],'f',3));
 }
 //---------------------------------------------------------------------------
 void ExtOptDialog::SetExtErrOpt(void)
 {
-    QDoubleSpinBox *editc[][6] = {
-        { CodeErr00, CodeErr01, CodeErr02, CodeErr03, CodeErr04, CodeErr05 },
-        { CodeErr10, CodeErr11, CodeErr12, CodeErr13, CodeErr14, CodeErr15 },
-        { CodeErr20, CodeErr21, CodeErr22, CodeErr23, CodeErr24, CodeErr25 }
+    QLineEdit *editc[][6]={
+		{CodeErr00,CodeErr01,CodeErr02,CodeErr03,CodeErr04,CodeErr05},
+		{CodeErr10,CodeErr11,CodeErr12,CodeErr13,CodeErr14,CodeErr15},
+		{CodeErr20,CodeErr21,CodeErr22,CodeErr23,CodeErr24,CodeErr25}
 	};
-    QDoubleSpinBox *editp[][6] = {
-        { PhaseErr00, PhaseErr01, PhaseErr02, PhaseErr03, PhaseErr04, PhaseErr05 },
-        { PhaseErr10, PhaseErr11, PhaseErr12, PhaseErr13, PhaseErr14, PhaseErr15 },
-        { PhaseErr20, PhaseErr21, PhaseErr22, PhaseErr23, PhaseErr24, PhaseErr25 }
+    QLineEdit *editp[][6]={
+		{PhaseErr00,PhaseErr01,PhaseErr02,PhaseErr03,PhaseErr04,PhaseErr05},
+		{PhaseErr10,PhaseErr11,PhaseErr12,PhaseErr13,PhaseErr14,PhaseErr15},
+		{PhaseErr20,PhaseErr21,PhaseErr22,PhaseErr23,PhaseErr24,PhaseErr25}
 	};
-
-    optDialog->ExtErr.ena[0] = ExtEna0->isChecked();
-    optDialog->ExtErr.ena[1] = ExtEna1->isChecked();
-    optDialog->ExtErr.ena[2] = ExtEna2->isChecked();
-    optDialog->ExtErr.ena[3] = ExtEna3->isChecked();
-
-    for (int i = 0; i < 3; i++) for (int j = 0; j < 6; j++) {
-            optDialog->ExtErr.cerr[i][j] = editc[i][j]->value();
-            optDialog->ExtErr.perr[i][j] = editp[i][j]->value();
-        }
-    optDialog->ExtErr.gloicb[0] = GloICB0->value();
-    optDialog->ExtErr.gloicb[1] = GloICB1->value();
-    optDialog->ExtErr.gpsglob[0] = GpsGloB0->value();
-    optDialog->ExtErr.gpsglob[1] = GpsGloB1->value();
+    optDialog->ExtErr.ena[0]=ExtEna0->isChecked();
+    optDialog->ExtErr.ena[1]=ExtEna1->isChecked();
+    optDialog->ExtErr.ena[2]=ExtEna2->isChecked();
+    optDialog->ExtErr.ena[3]=ExtEna3->isChecked();
+	
+	for (int i=0;i<3;i++) for (int j=0;j<6;j++) {
+        optDialog->ExtErr.cerr[i][j]=editc[i][j]->text().toDouble();
+        optDialog->ExtErr.perr[i][j]=editp[i][j]->text().toDouble();
+	}
+    optDialog->ExtErr.gloicb[0]=GloICB0->text().toDouble();
+    optDialog->ExtErr.gloicb[1]=GloICB1->text().toDouble();
+    optDialog->ExtErr.gpsglob[0]=GpsGloB0->text().toDouble();
+    optDialog->ExtErr.gpsglob[1]=GpsGloB1->text().toDouble();
 }
 //---------------------------------------------------------------------------
 void ExtOptDialog::UpdateEnable(void)
 {
-    QDoubleSpinBox *editc[][6] = {
-        { CodeErr00, CodeErr01, CodeErr02, CodeErr03, CodeErr04, CodeErr05 },
-        { CodeErr10, CodeErr11, CodeErr12, CodeErr13, CodeErr14, CodeErr15 },
-        { CodeErr20, CodeErr21, CodeErr22, CodeErr23, CodeErr24, CodeErr25 }
+    QLineEdit *editc[][6]={
+		{CodeErr00,CodeErr01,CodeErr02,CodeErr03,CodeErr04,CodeErr05},
+		{CodeErr10,CodeErr11,CodeErr12,CodeErr13,CodeErr14,CodeErr15},
+		{CodeErr20,CodeErr21,CodeErr22,CodeErr23,CodeErr24,CodeErr25}
 	};
-    QDoubleSpinBox *editp[][6] = {
-        { PhaseErr00, PhaseErr01, PhaseErr02, PhaseErr03, PhaseErr04, PhaseErr05 },
-        { PhaseErr10, PhaseErr11, PhaseErr12, PhaseErr13, PhaseErr14, PhaseErr15 },
-        { PhaseErr20, PhaseErr21, PhaseErr22, PhaseErr23, PhaseErr24, PhaseErr25 }
+    QLineEdit *editp[][6]={
+		{PhaseErr00,PhaseErr01,PhaseErr02,PhaseErr03,PhaseErr04,PhaseErr05},
+		{PhaseErr10,PhaseErr11,PhaseErr12,PhaseErr13,PhaseErr14,PhaseErr15},
+		{PhaseErr20,PhaseErr21,PhaseErr22,PhaseErr23,PhaseErr24,PhaseErr25}
 	};
-
-    for (int i = 0; i < 3; i++) for (int j = 0; j < 6; j++) {
-            editc[i][j]->setEnabled(ExtEna0->isChecked());
-            editp[i][j]->setEnabled(ExtEna1->isChecked());
-        }
+	for (int i=0;i<3;i++) for (int j=0;j<6;j++) {
+        editc[i][j]->setEnabled(ExtEna0->isChecked());
+        editp[i][j]->setEnabled(ExtEna1->isChecked());
+	}
     GloICB0->setEnabled(ExtEna2->isChecked());
     GloICB1->setEnabled(ExtEna2->isChecked());
     GpsGloB0->setEnabled(ExtEna3->isChecked());
     GpsGloB1->setEnabled(ExtEna3->isChecked());
 }
 //---------------------------------------------------------------------------
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/extopt.ui RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/extopt.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/extopt.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/extopt.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>736</width>
-    <height>396</height>
+    <width>747</width>
+    <height>384</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -71,16 +71,75 @@
          <property name="bottomMargin">
           <number>0</number>
          </property>
-         <item row="2" column="7">
-          <widget class="QLabel" name="Label69">
+         <item row="2" column="0">
+          <widget class="QLabel" name="Label48">
            <property name="enabled">
             <bool>true</bool>
            </property>
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>GLONASS</string>
+           </property>
+          </widget>
+         </item>
+         <item row="2" column="1">
+          <widget class="QLabel" name="Label52">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>L1</string>
+           </property>
+          </widget>
+         </item>
+         <item row="2" column="2">
+          <widget class="QLineEdit" name="CodeErr10">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.300</string>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="3">
+          <widget class="QLineEdit" name="CodeErr01">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.300</string>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="6">
+          <widget class="QLineEdit" name="CodeErr03">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.300</string>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="7">
+          <widget class="QLabel" name="Label69">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
            <property name="toolTip">
             <string/>
@@ -90,7 +149,72 @@
            </property>
           </widget>
          </item>
-         <item row="2" column="0">
+         <item row="1" column="8">
+          <widget class="QLineEdit" name="CodeErr04">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.300</string>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="9">
+          <widget class="QLineEdit" name="CodeErr05">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.300</string>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="4">
+          <widget class="QLabel" name="Label50">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>L2</string>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="5">
+          <widget class="QLineEdit" name="CodeErr02">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.300</string>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="1">
+          <widget class="QLabel" name="Label51">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>L1</string>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="0">
           <widget class="QLabel" name="Label23">
            <property name="enabled">
             <bool>true</bool>
@@ -103,54 +227,88 @@
            </property>
           </widget>
          </item>
-         <item row="2" column="1">
-          <widget class="QLabel" name="Label51">
+         <item row="1" column="2">
+          <widget class="QLineEdit" name="CodeErr00">
            <property name="enabled">
             <bool>true</bool>
            </property>
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.300</string>
+           </property>
+          </widget>
+         </item>
+         <item row="3" column="2">
+          <widget class="QLineEdit" name="CodeErr20">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
            <property name="toolTip">
             <string/>
            </property>
            <property name="text">
-            <string>L1</string>
+            <string>0.300</string>
            </property>
           </widget>
          </item>
-         <item row="3" column="1">
-          <widget class="QLabel" name="Label52">
+         <item row="2" column="5">
+          <widget class="QLineEdit" name="CodeErr12">
            <property name="enabled">
             <bool>true</bool>
            </property>
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.300</string>
+           </property>
+          </widget>
+         </item>
+         <item row="2" column="3">
+          <widget class="QLineEdit" name="CodeErr11">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
            <property name="toolTip">
             <string/>
            </property>
            <property name="text">
-            <string>L1</string>
+            <string>0.300</string>
            </property>
           </widget>
          </item>
-         <item row="3" column="4">
-          <widget class="QLabel" name="Label70">
+         <item row="3" column="9">
+          <widget class="QLineEdit" name="CodeErr25">
            <property name="enabled">
             <bool>true</bool>
            </property>
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.300</string>
+           </property>
+          </widget>
+         </item>
+         <item row="2" column="9">
+          <widget class="QLineEdit" name="CodeErr15">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.300</string>
+           </property>
+          </widget>
+         </item>
+         <item row="2" column="4">
+          <widget class="QLabel" name="Label70">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
            <property name="toolTip">
             <string/>
@@ -160,8 +318,8 @@
            </property>
           </widget>
          </item>
-         <item row="3" column="0">
-          <widget class="QLabel" name="Label48">
+         <item row="2" column="6">
+          <widget class="QLineEdit" name="CodeErr13">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -169,39 +327,53 @@
             <string/>
            </property>
            <property name="text">
-            <string>GLONASS</string>
+            <string>0.300</string>
            </property>
           </widget>
          </item>
-         <item row="2" column="4">
-          <widget class="QLabel" name="Label50">
+         <item row="2" column="8">
+          <widget class="QLineEdit" name="CodeErr14">
            <property name="enabled">
             <bool>true</bool>
            </property>
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.300</string>
+           </property>
+          </widget>
+         </item>
+         <item row="3" column="8">
+          <widget class="QLineEdit" name="CodeErr24">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
            <property name="toolTip">
             <string/>
            </property>
            <property name="text">
-            <string>L2</string>
+            <string>0.300</string>
            </property>
           </widget>
          </item>
-         <item row="4" column="4">
-          <widget class="QLabel" name="Label72">
+         <item row="3" column="0">
+          <widget class="QLabel" name="Label49">
            <property name="enabled">
             <bool>true</bool>
            </property>
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>Galileo</string>
+           </property>
+          </widget>
+         </item>
+         <item row="3" column="4">
+          <widget class="QLabel" name="Label72">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
            <property name="toolTip">
             <string/>
@@ -211,16 +383,62 @@
            </property>
           </widget>
          </item>
-         <item row="4" column="7">
-          <widget class="QLabel" name="Label73">
+         <item row="3" column="3">
+          <widget class="QLineEdit" name="CodeErr21">
            <property name="enabled">
             <bool>true</bool>
            </property>
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.300</string>
+           </property>
+          </widget>
+         </item>
+         <item row="3" column="5">
+          <widget class="QLineEdit" name="CodeErr22">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.300</string>
+           </property>
+          </widget>
+         </item>
+         <item row="3" column="6">
+          <widget class="QLineEdit" name="CodeErr23">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.300</string>
+           </property>
+          </widget>
+         </item>
+         <item row="3" column="1">
+          <widget class="QLabel" name="Label71">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>E1</string>
+           </property>
+          </widget>
+         </item>
+         <item row="3" column="7">
+          <widget class="QLabel" name="Label73">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
            <property name="toolTip">
             <string/>
@@ -321,8 +539,71 @@
            </property>
           </widget>
          </item>
-         <item row="4" column="0">
-          <widget class="QLabel" name="Label49">
+        </layout>
+       </widget>
+      </item>
+     </layout>
+    </widget>
+   </item>
+   <item>
+    <widget class="QWidget" name="Panel7" native="true">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="sizePolicy">
+      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
+       <horstretch>0</horstretch>
+       <verstretch>0</verstretch>
+      </sizepolicy>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="layoutDirection">
+      <enum>Qt::LeftToRight</enum>
+     </property>
+     <property name="text" stdset="0">
+      <string/>
+     </property>
+     <layout class="QGridLayout" name="gridLayout_3">
+      <property name="leftMargin">
+       <number>0</number>
+      </property>
+      <property name="topMargin">
+       <number>0</number>
+      </property>
+      <property name="rightMargin">
+       <number>0</number>
+      </property>
+      <property name="bottomMargin">
+       <number>0</number>
+      </property>
+      <property name="spacing">
+       <number>0</number>
+      </property>
+      <item row="1" column="1">
+       <widget class="QWidget" name="Panel8" native="true">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="sizePolicy">
+         <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
+          <horstretch>0</horstretch>
+          <verstretch>0</verstretch>
+         </sizepolicy>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="layoutDirection">
+         <enum>Qt::LeftToRight</enum>
+        </property>
+        <property name="text" stdset="0">
+         <string/>
+        </property>
+        <layout class="QGridLayout" name="gridLayout_5">
+         <item row="1" column="3">
+          <widget class="QLineEdit" name="PhaseErr01">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -330,206 +611,462 @@
             <string/>
            </property>
            <property name="text">
-            <string>Galileo</string>
+            <string>0.003</string>
            </property>
           </widget>
          </item>
-         <item row="4" column="1">
-          <widget class="QLabel" name="Label71">
+         <item row="1" column="6">
+          <widget class="QLineEdit" name="PhaseErr03">
            <property name="enabled">
             <bool>true</bool>
            </property>
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.003</string>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="4">
+          <widget class="QLabel" name="Label77">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
            <property name="toolTip">
             <string/>
            </property>
            <property name="text">
-            <string>E1</string>
+            <string>L2</string>
+           </property>
+          </widget>
+         </item>
+         <item row="2" column="6">
+          <widget class="QLineEdit" name="PhaseErr14">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.003</string>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="5">
+          <widget class="QLineEdit" name="PhaseErr02">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.003</string>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="7">
+          <widget class="QLabel" name="Label80">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>L5</string>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="8">
+          <widget class="QLineEdit" name="PhaseErr04">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.003</string>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="9">
+          <widget class="QLineEdit" name="PhaseErr05">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.003</string>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="1">
+          <widget class="QLabel" name="Label74">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>L1</string>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="2">
+          <widget class="QLineEdit" name="PhaseErr00">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.003</string>
+           </property>
+          </widget>
+         </item>
+         <item row="2" column="8">
+          <widget class="QLineEdit" name="PhaseErr13">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.003</string>
            </property>
           </widget>
          </item>
          <item row="2" column="2">
-          <widget class="QDoubleSpinBox" name="CodeErr00">
-           <property name="decimals">
-            <number>3</number>
+          <widget class="QLineEdit" name="PhaseErr10">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
-           <property name="value">
-            <double>0.300000000000000</double>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.003</string>
+           </property>
+          </widget>
+         </item>
+         <item row="2" column="4">
+          <widget class="QLabel" name="Label78">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>L2</string>
            </property>
           </widget>
          </item>
          <item row="2" column="3">
-          <widget class="QDoubleSpinBox" name="CodeErr01">
-           <property name="decimals">
-            <number>3</number>
+          <widget class="QLineEdit" name="PhaseErr11">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
-           <property name="value">
-            <double>0.300000000000000</double>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.003</string>
            </property>
           </widget>
          </item>
-         <item row="2" column="5">
-          <widget class="QDoubleSpinBox" name="CodeErr02">
-           <property name="decimals">
-            <number>3</number>
+         <item row="2" column="1">
+          <widget class="QLabel" name="Label75">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
-           <property name="value">
-            <double>0.300000000000000</double>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>L1</string>
            </property>
           </widget>
          </item>
-         <item row="2" column="6">
-          <widget class="QDoubleSpinBox" name="CodeErr03">
-           <property name="decimals">
-            <number>3</number>
+         <item row="1" column="0">
+          <widget class="QLabel" name="Label12">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
-           <property name="value">
-            <double>0.300000000000000</double>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>GPS/QZS</string>
            </property>
           </widget>
          </item>
-         <item row="2" column="8">
-          <widget class="QDoubleSpinBox" name="CodeErr04">
-           <property name="decimals">
-            <number>3</number>
+         <item row="2" column="5">
+          <widget class="QLineEdit" name="PhaseErr12">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
-           <property name="value">
-            <double>0.300000000000000</double>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.003</string>
            </property>
           </widget>
          </item>
-         <item row="2" column="9">
-          <widget class="QDoubleSpinBox" name="CodeErr05">
-           <property name="decimals">
-            <number>3</number>
+         <item row="3" column="3">
+          <widget class="QLineEdit" name="PhaseErr21">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
-           <property name="value">
-            <double>0.300000000000000</double>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.003</string>
+           </property>
+          </widget>
+         </item>
+         <item row="3" column="0">
+          <widget class="QLabel" name="Label58">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>Galileo</string>
            </property>
           </widget>
          </item>
          <item row="3" column="2">
-          <widget class="QDoubleSpinBox" name="CodeErr10">
-           <property name="decimals">
-            <number>3</number>
+          <widget class="QLineEdit" name="PhaseErr20">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
-           <property name="value">
-            <double>0.300000000000000</double>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.003</string>
            </property>
           </widget>
          </item>
-         <item row="3" column="3">
-          <widget class="QDoubleSpinBox" name="CodeErr11">
-           <property name="decimals">
-            <number>3</number>
+         <item row="3" column="1">
+          <widget class="QLabel" name="Label76">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
-           <property name="value">
-            <double>0.300000000000000</double>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>E1</string>
+           </property>
+          </widget>
+         </item>
+         <item row="2" column="0">
+          <widget class="QLabel" name="Label53">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>GLONASS</string>
            </property>
           </widget>
          </item>
          <item row="3" column="5">
-          <widget class="QDoubleSpinBox" name="CodeErr12">
-           <property name="decimals">
-            <number>3</number>
+          <widget class="QLineEdit" name="PhaseErr22">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
-           <property name="value">
-            <double>0.300000000000000</double>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.003</string>
            </property>
           </widget>
          </item>
-         <item row="3" column="6">
-          <widget class="QDoubleSpinBox" name="CodeErr13">
-           <property name="decimals">
-            <number>3</number>
+         <item row="2" column="9">
+          <widget class="QLineEdit" name="PhaseErr15">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
-           <property name="value">
-            <double>0.300000000000000</double>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.003</string>
+           </property>
+          </widget>
+         </item>
+         <item row="3" column="4">
+          <widget class="QLabel" name="Label79">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>E5a</string>
            </property>
           </widget>
          </item>
          <item row="3" column="8">
-          <widget class="QDoubleSpinBox" name="CodeErr14">
-           <property name="decimals">
-            <number>3</number>
+          <widget class="QLineEdit" name="PhaseErr24">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
-           <property name="value">
-            <double>0.300000000000000</double>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.003</string>
+           </property>
+          </widget>
+         </item>
+         <item row="3" column="6">
+          <widget class="QLineEdit" name="PhaseErr23">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.003</string>
+           </property>
+          </widget>
+         </item>
+         <item row="3" column="7">
+          <widget class="QLabel" name="Label81">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>E5b</string>
            </property>
           </widget>
          </item>
          <item row="3" column="9">
-          <widget class="QDoubleSpinBox" name="CodeErr15">
-           <property name="decimals">
-            <number>3</number>
+          <widget class="QLineEdit" name="PhaseErr25">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
-           <property name="value">
-            <double>0.300000000000000</double>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>0.003</string>
            </property>
           </widget>
          </item>
-         <item row="4" column="2">
-          <widget class="QDoubleSpinBox" name="CodeErr20">
-           <property name="decimals">
-            <number>3</number>
+         <item row="0" column="9">
+          <widget class="QLabel" name="Label95">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
-           <property name="value">
-            <double>0.300000000000000</double>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>b</string>
            </property>
           </widget>
          </item>
-         <item row="4" column="3">
-          <widget class="QDoubleSpinBox" name="CodeErr21">
-           <property name="decimals">
-            <number>3</number>
+         <item row="0" column="8">
+          <widget class="QLabel" name="Label94">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
-           <property name="value">
-            <double>0.300000000000000</double>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>a</string>
            </property>
           </widget>
          </item>
-         <item row="4" column="5">
-          <widget class="QDoubleSpinBox" name="CodeErr22">
-           <property name="decimals">
-            <number>3</number>
+         <item row="0" column="6">
+          <widget class="QLabel" name="Label93">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
-           <property name="value">
-            <double>0.300000000000000</double>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>b</string>
            </property>
           </widget>
          </item>
-         <item row="4" column="6">
-          <widget class="QDoubleSpinBox" name="CodeErr23">
-           <property name="decimals">
-            <number>3</number>
+         <item row="0" column="5">
+          <widget class="QLabel" name="Label92">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
-           <property name="value">
-            <double>0.300000000000000</double>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>a</string>
            </property>
           </widget>
          </item>
-         <item row="4" column="8">
-          <widget class="QDoubleSpinBox" name="CodeErr24">
-           <property name="decimals">
-            <number>3</number>
+         <item row="0" column="3">
+          <widget class="QLabel" name="Label91">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
-           <property name="value">
-            <double>0.300000000000000</double>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>b</string>
            </property>
           </widget>
          </item>
-         <item row="4" column="9">
-          <widget class="QDoubleSpinBox" name="CodeErr25">
-           <property name="decimals">
-            <number>3</number>
+         <item row="0" column="2">
+          <widget class="QLabel" name="Label90">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
-           <property name="value">
-            <double>0.300000000000000</double>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>a</string>
+           </property>
+          </widget>
+         </item>
+         <item row="0" column="0">
+          <widget class="QCheckBox" name="ExtEna1">
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>Phase Error</string>
+           </property>
+           <property name="checked">
+            <bool>false</bool>
            </property>
           </widget>
          </item>
@@ -540,7 +1077,7 @@
     </widget>
    </item>
    <item>
-    <widget class="QWidget" name="Panel8" native="true">
+    <widget class="QWidget" name="Panel5" native="true">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -559,92 +1096,53 @@
      <property name="text" stdset="0">
       <string/>
      </property>
-     <layout class="QGridLayout" name="gridLayout_5">
-      <item row="0" column="2">
-       <widget class="QLabel" name="Label90">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>a</string>
-        </property>
-       </widget>
-      </item>
-      <item row="0" column="0">
-       <widget class="QCheckBox" name="ExtEna1">
+     <layout class="QGridLayout" name="gridLayout">
+      <property name="leftMargin">
+       <number>0</number>
+      </property>
+      <property name="topMargin">
+       <number>0</number>
+      </property>
+      <property name="rightMargin">
+       <number>0</number>
+      </property>
+      <property name="bottomMargin">
+       <number>0</number>
+      </property>
+      <property name="spacing">
+       <number>6</number>
+      </property>
+      <item row="0" column="0" colspan="5">
+       <widget class="QCheckBox" name="ExtEna3">
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string>Phase Error</string>
+         <string>GPS-GLO Inter System Bias</string>
         </property>
         <property name="checked">
          <bool>false</bool>
         </property>
        </widget>
       </item>
-      <item row="1" column="1">
-       <widget class="QLabel" name="Label74">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
+      <item row="0" column="5" colspan="5">
+       <widget class="QCheckBox" name="ExtEna2">
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string>L1</string>
-        </property>
-       </widget>
-      </item>
-      <item row="1" column="3">
-       <widget class="QDoubleSpinBox" name="PhaseErr01">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-        <property name="value">
-         <double>0.300000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="1" column="7">
-       <widget class="QLabel" name="Label80">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
-        <property name="toolTip">
-         <string/>
+         <string>GLONASS Inter Freq Bias</string>
         </property>
-        <property name="text">
-         <string>L5</string>
+        <property name="checked">
+         <bool>false</bool>
         </property>
        </widget>
       </item>
-      <item row="3" column="1">
-       <widget class="QLabel" name="Label75">
+      <item row="1" column="0">
+       <widget class="QLabel" name="Label55">
         <property name="enabled">
          <bool>true</bool>
         </property>
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
         <property name="toolTip">
          <string/>
         </property>
@@ -653,8 +1151,8 @@
         </property>
        </widget>
       </item>
-      <item row="1" column="0">
-       <widget class="QLabel" name="Label12">
+      <item row="1" column="1">
+       <widget class="QLineEdit" name="GpsGloB0">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -662,21 +1160,15 @@
          <string/>
         </property>
         <property name="text">
-         <string>GPS/QZS</string>
+         <string>0.000</string>
         </property>
        </widget>
       </item>
-      <item row="3" column="4">
-       <widget class="QLabel" name="Label78">
+      <item row="1" column="2">
+       <widget class="QLabel" name="Label67">
         <property name="enabled">
          <bool>true</bool>
         </property>
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
         <property name="toolTip">
          <string/>
         </property>
@@ -685,8 +1177,8 @@
         </property>
        </widget>
       </item>
-      <item row="4" column="0">
-       <widget class="QLabel" name="Label58">
+      <item row="1" column="3">
+       <widget class="QLineEdit" name="GpsGloB1">
         <property name="enabled">
          <bool>true</bool>
         </property>
@@ -694,423 +1186,28 @@
          <string/>
         </property>
         <property name="text">
-         <string>Galileo</string>
+         <string>0.000</string>
         </property>
        </widget>
       </item>
       <item row="1" column="4">
-       <widget class="QLabel" name="Label77">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>L2</string>
-        </property>
-       </widget>
-      </item>
-      <item row="0" column="6">
-       <widget class="QLabel" name="Label93">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>b</string>
-        </property>
-       </widget>
-      </item>
-      <item row="0" column="9">
-       <widget class="QLabel" name="Label95">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>b</string>
-        </property>
-       </widget>
-      </item>
-      <item row="4" column="7">
-       <widget class="QLabel" name="Label81">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>E5b</string>
-        </property>
-       </widget>
-      </item>
-      <item row="0" column="5">
-       <widget class="QLabel" name="Label92">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>a</string>
-        </property>
-       </widget>
-      </item>
-      <item row="0" column="3">
-       <widget class="QLabel" name="Label91">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>b</string>
-        </property>
-       </widget>
-      </item>
-      <item row="0" column="8">
-       <widget class="QLabel" name="Label94">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>a</string>
-        </property>
-       </widget>
-      </item>
-      <item row="3" column="0">
-       <widget class="QLabel" name="Label53">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>GLONASS</string>
-        </property>
-       </widget>
-      </item>
-      <item row="4" column="1">
-       <widget class="QLabel" name="Label76">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>E1</string>
-        </property>
-       </widget>
-      </item>
-      <item row="4" column="4">
-       <widget class="QLabel" name="Label79">
+       <widget class="QLabel" name="Label68">
         <property name="enabled">
          <bool>true</bool>
         </property>
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string>E5a</string>
-        </property>
-       </widget>
-      </item>
-      <item row="1" column="2">
-       <widget class="QDoubleSpinBox" name="PhaseErr00">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-        <property name="value">
-         <double>0.300000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="1" column="9">
-       <widget class="QDoubleSpinBox" name="PhaseErr05">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-        <property name="value">
-         <double>0.300000000000000</double>
+         <string>m </string>
         </property>
        </widget>
       </item>
       <item row="1" column="5">
-       <widget class="QDoubleSpinBox" name="PhaseErr02">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-        <property name="value">
-         <double>0.300000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="1" column="6">
-       <widget class="QDoubleSpinBox" name="PhaseErr03">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-        <property name="value">
-         <double>0.300000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="1" column="8">
-       <widget class="QDoubleSpinBox" name="PhaseErr04">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-        <property name="value">
-         <double>0.300000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="3" column="2">
-       <widget class="QDoubleSpinBox" name="PhaseErr10">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-        <property name="value">
-         <double>0.300000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="3" column="3">
-       <widget class="QDoubleSpinBox" name="PhaseErr11">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-        <property name="value">
-         <double>0.300000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="3" column="5">
-       <widget class="QDoubleSpinBox" name="PhaseErr12">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-        <property name="value">
-         <double>0.300000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="3" column="6">
-       <widget class="QDoubleSpinBox" name="PhaseErr13">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-        <property name="value">
-         <double>0.300000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="3" column="9">
-       <widget class="QDoubleSpinBox" name="PhaseErr15">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-        <property name="value">
-         <double>0.300000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="3" column="8">
-       <widget class="QDoubleSpinBox" name="PhaseErr14">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-        <property name="value">
-         <double>0.300000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="4" column="2">
-       <widget class="QDoubleSpinBox" name="PhaseErr20">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-        <property name="value">
-         <double>0.300000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="4" column="3">
-       <widget class="QDoubleSpinBox" name="PhaseErr21">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-        <property name="value">
-         <double>0.300000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="4" column="5">
-       <widget class="QDoubleSpinBox" name="PhaseErr22">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-        <property name="value">
-         <double>0.300000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="4" column="6">
-       <widget class="QDoubleSpinBox" name="PhaseErr23">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-        <property name="value">
-         <double>0.300000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="4" column="8">
-       <widget class="QDoubleSpinBox" name="PhaseErr24">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-        <property name="value">
-         <double>0.300000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="4" column="9">
-       <widget class="QDoubleSpinBox" name="PhaseErr25">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-        <property name="value">
-         <double>0.300000000000000</double>
-        </property>
-       </widget>
-      </item>
-     </layout>
-    </widget>
-   </item>
-   <item>
-    <widget class="QWidget" name="Panel7" native="true">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="layoutDirection">
-      <enum>Qt::LeftToRight</enum>
-     </property>
-     <property name="text" stdset="0">
-      <string/>
-     </property>
-     <layout class="QGridLayout" name="gridLayout_3">
-      <property name="leftMargin">
-       <number>0</number>
-      </property>
-      <property name="topMargin">
-       <number>0</number>
-      </property>
-      <property name="rightMargin">
-       <number>0</number>
-      </property>
-      <property name="bottomMargin">
-       <number>0</number>
-      </property>
-      <property name="spacing">
-       <number>0</number>
-      </property>
-     </layout>
-    </widget>
-   </item>
-   <item>
-    <widget class="QWidget" name="Panel5" native="true">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="layoutDirection">
-      <enum>Qt::LeftToRight</enum>
-     </property>
-     <property name="text" stdset="0">
-      <string/>
-     </property>
-     <layout class="QGridLayout" name="gridLayout">
-      <property name="leftMargin">
-       <number>0</number>
-      </property>
-      <property name="topMargin">
-       <number>0</number>
-      </property>
-      <property name="rightMargin">
-       <number>0</number>
-      </property>
-      <property name="bottomMargin">
-       <number>0</number>
-      </property>
-      <property name="spacing">
-       <number>6</number>
-      </property>
-      <item row="3" column="0">
-       <widget class="QLabel" name="Label55">
+       <widget class="QLabel" name="Label54">
         <property name="enabled">
          <bool>true</bool>
         </property>
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
         <property name="toolTip">
          <string/>
         </property>
@@ -1119,36 +1216,24 @@
         </property>
        </widget>
       </item>
-      <item row="3" column="6">
-       <widget class="QLabel" name="Label54">
+      <item row="1" column="6">
+       <widget class="QLineEdit" name="GloICB0">
         <property name="enabled">
          <bool>true</bool>
         </property>
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string>L1</string>
+         <string>0.000</string>
         </property>
        </widget>
       </item>
-      <item row="3" column="8">
+      <item row="1" column="7">
        <widget class="QLabel" name="Label56">
         <property name="enabled">
          <bool>true</bool>
         </property>
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
         <property name="toolTip">
          <string/>
         </property>
@@ -1157,85 +1242,29 @@
         </property>
        </widget>
       </item>
-      <item row="3" column="1">
-       <widget class="QDoubleSpinBox" name="GpsGloB0">
-        <property name="suffix">
-         <string>  m</string>
-        </property>
-        <property name="decimals">
-         <number>3</number>
-        </property>
-       </widget>
-      </item>
-      <item row="3" column="7">
-       <widget class="QDoubleSpinBox" name="GloICB0">
-        <property name="decimals">
-         <number>3</number>
-        </property>
-       </widget>
-      </item>
-      <item row="3" column="9">
-       <widget class="QDoubleSpinBox" name="GloICB1">
-        <property name="suffix">
-         <string> cm/FCN</string>
-        </property>
-        <property name="decimals">
-         <number>3</number>
-        </property>
-       </widget>
-      </item>
-      <item row="0" column="6" colspan="4">
-       <widget class="QCheckBox" name="ExtEna2">
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>GLONASS Inter Freq Bias</string>
-        </property>
-        <property name="checked">
-         <bool>false</bool>
+      <item row="1" column="8">
+       <widget class="QLineEdit" name="GloICB1">
+        <property name="enabled">
+         <bool>true</bool>
         </property>
-       </widget>
-      </item>
-      <item row="0" column="0" colspan="3">
-       <widget class="QCheckBox" name="ExtEna3">
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string>GPS-GLO Inter System Bias</string>
-        </property>
-        <property name="checked">
-         <bool>false</bool>
-        </property>
-       </widget>
-      </item>
-      <item row="3" column="4">
-       <widget class="QDoubleSpinBox" name="GpsGloB1">
-        <property name="suffix">
-         <string> m</string>
-        </property>
-        <property name="decimals">
-         <number>3</number>
+         <string>0.000</string>
         </property>
        </widget>
       </item>
-      <item row="3" column="2">
-       <widget class="QLabel" name="Label67">
+      <item row="1" column="9">
+       <widget class="QLabel" name="Label57">
         <property name="enabled">
          <bool>true</bool>
         </property>
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Maximum" vsizetype="Preferred">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string>L2</string>
+         <string>cm/FCN</string>
         </property>
        </widget>
       </item>
@@ -1303,54 +1332,6 @@
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>BtnOk</tabstop>
-  <tabstop>BtnCancel</tabstop>
-  <tabstop>ExtEna0</tabstop>
-  <tabstop>CodeErr00</tabstop>
-  <tabstop>CodeErr01</tabstop>
-  <tabstop>CodeErr02</tabstop>
-  <tabstop>CodeErr03</tabstop>
-  <tabstop>CodeErr04</tabstop>
-  <tabstop>CodeErr05</tabstop>
-  <tabstop>CodeErr10</tabstop>
-  <tabstop>CodeErr11</tabstop>
-  <tabstop>CodeErr12</tabstop>
-  <tabstop>CodeErr13</tabstop>
-  <tabstop>CodeErr14</tabstop>
-  <tabstop>CodeErr15</tabstop>
-  <tabstop>CodeErr20</tabstop>
-  <tabstop>CodeErr21</tabstop>
-  <tabstop>CodeErr22</tabstop>
-  <tabstop>CodeErr23</tabstop>
-  <tabstop>CodeErr24</tabstop>
-  <tabstop>CodeErr25</tabstop>
-  <tabstop>ExtEna1</tabstop>
-  <tabstop>PhaseErr00</tabstop>
-  <tabstop>PhaseErr01</tabstop>
-  <tabstop>PhaseErr02</tabstop>
-  <tabstop>PhaseErr03</tabstop>
-  <tabstop>PhaseErr04</tabstop>
-  <tabstop>PhaseErr05</tabstop>
-  <tabstop>PhaseErr10</tabstop>
-  <tabstop>PhaseErr11</tabstop>
-  <tabstop>PhaseErr12</tabstop>
-  <tabstop>PhaseErr13</tabstop>
-  <tabstop>PhaseErr14</tabstop>
-  <tabstop>PhaseErr15</tabstop>
-  <tabstop>PhaseErr20</tabstop>
-  <tabstop>PhaseErr21</tabstop>
-  <tabstop>PhaseErr22</tabstop>
-  <tabstop>PhaseErr23</tabstop>
-  <tabstop>PhaseErr24</tabstop>
-  <tabstop>PhaseErr25</tabstop>
-  <tabstop>ExtEna3</tabstop>
-  <tabstop>GpsGloB0</tabstop>
-  <tabstop>GpsGloB1</tabstop>
-  <tabstop>ExtEna2</tabstop>
-  <tabstop>GloICB0</tabstop>
-  <tabstop>GloICB1</tabstop>
- </tabstops>
  <resources/>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/kmzconv.cpp RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/kmzconv.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/kmzconv.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/kmzconv.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -23,34 +23,34 @@
 {
     setupUi(this);
 
-    viewer = new TextViewer(this);
+    viewer=new TextViewer(this);
 
-    QCompleter *fileCompleter = new QCompleter(this);
-    QFileSystemModel *fileModel = new QFileSystemModel(fileCompleter);
+    QCompleter *fileCompleter=new QCompleter(this);
+    QFileSystemModel *fileModel=new QFileSystemModel(fileCompleter);
     fileModel->setRootPath("");
     fileCompleter->setModel(fileModel);
     InputFile->setCompleter(fileCompleter);
     OutputFile->setCompleter(fileCompleter);
     GoogleEarthFile->setCompleter(fileCompleter);
 
-    connect(BtnClose, SIGNAL(clicked(bool)), this, SLOT(BtnCloseClick()));
-    connect(BtnConvert, SIGNAL(clicked(bool)), this, SLOT(BtnConvertClick()));
-    connect(BtnGoogleEarthFile, SIGNAL(clicked(bool)), this, SLOT(BtnGoogleEarthFileClick()));
-    connect(BtnView, SIGNAL(clicked(bool)), this, SLOT(BtnViewClick()));
-    connect(AddOffset, SIGNAL(clicked(bool)), this, SLOT(AddOffsetClick()));
-    connect(TimeSpan, SIGNAL(clicked(bool)), this, SLOT(TimeSpanClick()));
-    connect(TimeIntF, SIGNAL(clicked(bool)), this, SLOT(TimeIntFClick()));
-    connect(InputFile, SIGNAL(editingFinished()), this, SLOT(InputFileChange()));
-    connect(Compress, SIGNAL(clicked(bool)), this, SLOT(CompressClick()));
-    connect(GoogleEarthFile, SIGNAL(editingFinished()), this, SLOT(GoogleEarthFileChange()));
-    connect(BtnInputFile, SIGNAL(clicked(bool)), this, SLOT(BtnInputFileClick()));
-    connect(FormatKML, SIGNAL(clicked(bool)), this, SLOT(FormatKMLClick()));
-    connect(FormatGPX, SIGNAL(clicked(bool)), this, SLOT(FormatGPXClick()));
+    connect(BtnClose,SIGNAL(clicked(bool)),this,SLOT(BtnCloseClick()));
+    connect(BtnConvert,SIGNAL(clicked(bool)),this,SLOT(BtnConvertClick()));
+    connect(BtnGoogleEarthFile,SIGNAL(clicked(bool)),this,SLOT(BtnGoogleEarthFileClick()));
+    connect(BtnView,SIGNAL(clicked(bool)),this,SLOT(BtnViewClick()));
+    connect(AddOffset,SIGNAL(clicked(bool)),this,SLOT(AddOffsetClick()));
+    connect(TimeSpan,SIGNAL(clicked(bool)),this,SLOT(TimeSpanClick()));
+    connect(TimeIntF,SIGNAL(clicked(bool)),this,SLOT(TimeIntFClick()));
+    connect(InputFile,SIGNAL(editingFinished()),this,SLOT(InputFileChange()));
+    connect(Compress,SIGNAL(clicked(bool)),this,SLOT(CompressClick()));
+    connect(GoogleEarthFile,SIGNAL(editingFinished()),this,SLOT(GoogleEarthFileChange()));
+    connect(BtnInputFile,SIGNAL(clicked(bool)),this,SLOT(BtnInputFileClick()));
+    connect(FormatKML,SIGNAL(clicked(bool)),this,SLOT(FormatKMLClick()));
+    connect(FormatGPX,SIGNAL(clicked(bool)),this,SLOT(FormatGPXClick()));
 
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void ConvDialog::showEvent(QShowEvent *event)
+void ConvDialog::showEvent(QShowEvent* event)
 {
     if (event->spontaneous()) return;
 
@@ -66,86 +66,87 @@
 //---------------------------------------------------------------------------
 void ConvDialog::TimeSpanClick()
 {
-    UpdateEnable();
+	UpdateEnable();	
 }
 //---------------------------------------------------------------------------
 void ConvDialog::AddOffsetClick()
 {
-    UpdateEnable();
+	UpdateEnable();	
 }
 //---------------------------------------------------------------------------
 void ConvDialog::TimeIntFClick()
 {
-    UpdateEnable();
+	UpdateEnable();	
 }
 //---------------------------------------------------------------------------
 void ConvDialog::BtnInputFileClick()
 {
-    InputFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Open..."), QString(), tr("All (*.*)"))));
+    InputFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Open..."),QString(),tr("All (*.*)"))));
 }
 //---------------------------------------------------------------------------
 void ConvDialog::BtnConvertClick()
 {
-    QString InputFile_Text = InputFile->text(), OutputFile_Text = OutputFile->text();
+    QString InputFile_Text=InputFile->text(),OutputFile_Text=OutputFile->text();
 	int stat;
     QString cmd;
-    char file[1024], kmlfile[1024], *p;
-    double offset[3] = { 0 }, tint = 0.0;
-    gtime_t ts = { 0, 0 }, te = { 0, 0 };
+    char file[1024],kmlfile[1024],*p;
+    double offset[3]={0},tint=0.0;
+    gtime_t ts={0,0},te={0,0};
 
 	ShowMsg("");
 
-    if (InputFile->text() == "" || OutputFile->text() == "") return;
+    if (InputFile->text()==""||OutputFile->text()=="") return;
 
     ShowMsg(tr("converting ..."));
 
     if (TimeSpan->isChecked()) {
-        QDateTime start(dateTime1->dateTime());
-        QDateTime end(dateTime2->dateTime());
-        ts.time = start.toTime_t(); ts.sec = start.time().msec() / 1000;
-        te.time = end.toTime_t(); te.sec = end.time().msec() / 1000;
+        QDateTime start(TimeY1->date(),TimeH1->time());
+        QDateTime end(TimeY2->date(),TimeH2->time());
+        ts.time=start.toTime_t();ts.sec=start.time().msec()/1000;
+        te.time=end.toTime_t();te.sec=end.time().msec()/1000;
 	}
 
     if (AddOffset->isChecked()) {
-        offset[0] = Offset1->value();
-        offset[1] = Offset2->value();
-        offset[2] = Offset3->value();
+        offset[0]=Offset1->text().toDouble();
+        offset[1]=Offset2->text().toDouble();
+        offset[2]=Offset3->text().toDouble();
 	}
 
-    if (TimeIntF->isChecked()) tint = TimeInt->value();
+    if (TimeIntF->isChecked()) tint=TimeInt->text().toDouble();
 
-    strcpy(file, qPrintable(InputFile_Text));
+    strcpy(file,qPrintable(InputFile_Text));
 
     if (FormatKML->isChecked()) {
         if (Compress->isChecked()) {
-            strcpy(kmlfile, file);
-            if (!(p = strrchr(kmlfile, '.'))) p = kmlfile + strlen(kmlfile);
-            strcpy(p, ".kml");
+            strcpy(kmlfile,file);
+            if (!(p=strrchr(kmlfile,'.'))) p=kmlfile+strlen(kmlfile);
+            strcpy(p,".kml");
         }
-        stat = convkml(file, Compress->isChecked() ? kmlfile : qPrintable(OutputFile_Text),
-                   ts, te, tint, QFlags->currentIndex(), offset,
-                   TrackColor->currentIndex(), PointColor->currentIndex(),
-                   OutputAlt->currentIndex(), OutputTime->currentIndex());
-    } else {
-        stat = convgpx(file, Compress->isChecked() ? kmlfile : qPrintable(OutputFile_Text),
-                   ts, te, tint, QFlags->currentIndex(), offset,
-                   TrackColor->currentIndex(), PointColor->currentIndex(),
-                   OutputAlt->currentIndex(), OutputTime->currentIndex());
+        stat=convkml(file,Compress->isChecked()?kmlfile:qPrintable(OutputFile_Text),
+                     ts,te,tint,QFlags->currentIndex(),offset,
+                     TrackColor->currentIndex(),PointColor->currentIndex(),
+                     OutputAlt->currentIndex(),OutputTime->currentIndex());
+    }
+    else {
+        stat=convgpx(file,Compress->isChecked()?kmlfile:qPrintable(OutputFile_Text),
+                     ts,te,tint,QFlags->currentIndex(),offset,
+                     TrackColor->currentIndex(),PointColor->currentIndex(),
+                     OutputAlt->currentIndex(),OutputTime->currentIndex());
     }
 
-    if (stat < 0) {
-        if (stat == -1) ShowMsg(tr("error : read input file"));
-        else if (stat == -2) ShowMsg(tr("error : input file format"));
-        else if (stat == -3) ShowMsg(tr("error : no data in input file"));
-        else ShowMsg(tr("error : write kml file"));
+    if (stat<0) {
+        if      (stat==-1) ShowMsg(tr("error : read input file"));
+        else if (stat==-2) ShowMsg(tr("error : input file format"));
+        else if (stat==-3) ShowMsg(tr("error : no data in input file"));
+        else               ShowMsg(tr("error : write kml file"));
 		return;
 	}
-    if (FormatKML->isChecked() && Compress->isChecked()) {
+    if (FormatKML->isChecked()&&Compress->isChecked()) {
 #ifdef Q_OS_WIN
-        cmd = QString("zip.exe -j -m %1 %2").arg(OutputFile->text()).arg(kmlfile); //TODO: zip for other platforms
+        cmd=QString("zip.exe -j -m %1 %2").arg(OutputFile->text()).arg(kmlfile); //TODO: zip for other platforms
 #endif
 #ifdef Q_OS_LINUX
-        cmd = QString("gzip -3 %1 %2").arg(OutputFile->text()).arg(kmlfile);
+        cmd=QString("gzip -3 %1 %2").arg(OutputFile->text()).arg(kmlfile);
 #endif
         if (!ExecCmd(cmd)) {
             ShowMsg(tr("error : zip execution"));
@@ -170,8 +171,10 @@
     Offset1->setEnabled(AddOffset->isChecked());
     Offset2->setEnabled(AddOffset->isChecked());
     Offset3->setEnabled(AddOffset->isChecked());
-    dateTime1->setEnabled(TimeSpan->isChecked());
-    dateTime2->setEnabled(TimeSpan->isChecked());
+    TimeY1->setEnabled(TimeSpan->isChecked());
+    TimeH1->setEnabled(TimeSpan->isChecked());
+    TimeY2->setEnabled(TimeSpan->isChecked());
+    TimeH2->setEnabled(TimeSpan->isChecked());
     TimeInt->setEnabled(TimeIntF->isChecked());
 
     Compress->setVisible(FormatKML->isChecked());
@@ -206,24 +209,23 @@
 //---------------------------------------------------------------------------
 void ConvDialog::UpdateOutFile(void)
 {
-    QString InputFile_Text = InputFile->text();
-
-    if (InputFile_Text == "") return;
+    QString InputFile_Text=InputFile->text();
+    if (InputFile_Text=="") return;
     QFileInfo fi(InputFile_Text);
-    if (fi.suffix() == NULL) return;
-    InputFile_Text = QDir::toNativeSeparators(fi.absolutePath() + "/" + fi.baseName());
-    InputFile_Text += FormatGPX->isChecked() ? ".gpx" : (Compress->isChecked() ? ".kmz" : ".kml");
+    if (fi.suffix()==NULL) return;
+    InputFile_Text=QDir::toNativeSeparators(fi.absolutePath()+"/"+fi.baseName());
+    InputFile_Text+=FormatGPX->isChecked()?".gpx":(Compress->isChecked()?".kmz":".kml");
     OutputFile->setText(InputFile_Text);
 }
 //---------------------------------------------------------------------------
 void ConvDialog::GoogleEarthFileChange()
 {
-    mainForm->GoogleEarthFile = GoogleEarthFile->text();
+    mainForm->GoogleEarthFile=GoogleEarthFile->text();
 }
 //---------------------------------------------------------------------------
 void ConvDialog::BtnGoogleEarthFileClick()
 {
-    GoogleEarthFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Google Earth Exe File"))));
+    GoogleEarthFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Google Earth Exe File"))));
 }
 //---------------------------------------------------------------------------
 void ConvDialog::FormatKMLClick()
@@ -240,9 +242,9 @@
 //---------------------------------------------------------------------------
 void ConvDialog::BtnViewClick()
 {
-    QString file = OutputFile->text();
+    QString file=OutputFile->text();
 
-    if (file == "") return;
+    if (file=="") return;
     viewer->setWindowTitle(file);
     viewer->show();
     viewer->Read(file);
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/kmzconv.h RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/kmzconv.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/kmzconv.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/kmzconv.h	2019-08-19 02:04:50.000000000 +0300
@@ -26,7 +26,6 @@
     void BtnGoogleEarthFileClick();
     void FormatKMLClick();
     void FormatGPXClick();
-
 private:
     int ExecCmd(const QString &cmd);
     void UpdateEnable(void);
@@ -35,12 +34,10 @@
 
 protected:
     void showEvent(QShowEvent*);
-
     TextViewer *viewer;
 
 public:
     explicit ConvDialog(QWidget *parent);
-
     void SetInput(const QString &File);
 };
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/kmzconv.ui RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/kmzconv.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/kmzconv.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/kmzconv.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>637</width>
-    <height>414</height>
+    <width>587</width>
+    <height>413</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -44,7 +44,175 @@
       <property name="bottomMargin">
        <number>0</number>
       </property>
-      <item row="11" column="8">
+      <item row="1" column="0">
+       <widget class="QCheckBox" name="TimeSpan">
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>Time Span</string>
+        </property>
+        <property name="checked">
+         <bool>false</bool>
+        </property>
+       </widget>
+      </item>
+      <item row="3" column="2" colspan="2">
+       <widget class="QComboBox" name="TrackColor">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <item>
+         <property name="text">
+          <string>OFF</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>White</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Green</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Orange</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Red</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Yellow</string>
+         </property>
+        </item>
+       </widget>
+      </item>
+      <item row="1" column="5">
+       <widget class="QDateEdit" name="TimeY2">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+       </widget>
+      </item>
+      <item row="2" column="4" colspan="2">
+       <widget class="QLabel" name="Label5">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>Q-Flags</string>
+        </property>
+       </widget>
+      </item>
+      <item row="2" column="2" colspan="2">
+       <widget class="QLineEdit" name="TimeInt">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>1</string>
+        </property>
+       </widget>
+      </item>
+      <item row="4" column="0">
+       <widget class="QLabel" name="Label2">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>Output Waypoint</string>
+        </property>
+       </widget>
+      </item>
+      <item row="3" column="0">
+       <widget class="QLabel" name="Label1">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>Output Track</string>
+        </property>
+       </widget>
+      </item>
+      <item row="4" column="2" colspan="2">
+       <widget class="QComboBox" name="PointColor">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <item>
+         <property name="text">
+          <string>OFF</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>White</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Green</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Orange</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>Red</string>
+         </property>
+        </item>
+        <item>
+         <property name="text">
+          <string>By Q-Flag</string>
+         </property>
+        </item>
+       </widget>
+      </item>
+      <item row="6" column="0" colspan="3">
+       <widget class="QLabel" name="Label7">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>Input/Output/GE Exe File</string>
+        </property>
+       </widget>
+      </item>
+      <item row="9" column="8">
        <widget class="QPushButton" name="BtnGoogleEarthFile">
         <property name="enabled">
          <bool>true</bool>
@@ -97,20 +265,46 @@
         </property>
        </widget>
       </item>
-      <item row="4" column="0" colspan="2">
+      <item row="2" column="0" colspan="2">
        <widget class="QCheckBox" name="TimeIntF">
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string>Interval</string>
+         <string>Interval (s)</string>
         </property>
         <property name="checked">
          <bool>false</bool>
         </property>
        </widget>
       </item>
-      <item row="8" column="7">
+      <item row="5" column="5" colspan="2">
+       <widget class="QLineEdit" name="Offset2">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>0</string>
+        </property>
+       </widget>
+      </item>
+      <item row="5" column="7" colspan="2">
+       <widget class="QLineEdit" name="Offset3">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>0</string>
+        </property>
+       </widget>
+      </item>
+      <item row="6" column="7">
        <widget class="QCheckBox" name="Compress">
         <property name="toolTip">
          <string/>
@@ -123,17 +317,11 @@
         </property>
        </widget>
       </item>
-      <item row="12" column="0" colspan="9">
+      <item row="10" column="0" colspan="9">
        <widget class="QLabel" name="Message">
         <property name="enabled">
          <bool>true</bool>
         </property>
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
         <property name="toolTip">
          <string/>
         </property>
@@ -154,7 +342,7 @@
         </property>
        </widget>
       </item>
-      <item row="10" column="0" colspan="9">
+      <item row="8" column="0" colspan="9">
        <widget class="QLineEdit" name="OutputFile">
         <property name="enabled">
          <bool>true</bool>
@@ -167,7 +355,20 @@
         </property>
        </widget>
       </item>
-      <item row="4" column="6" colspan="3">
+      <item row="5" column="3" colspan="2">
+       <widget class="QLineEdit" name="Offset1">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="text">
+         <string>0</string>
+        </property>
+       </widget>
+      </item>
+      <item row="2" column="6" colspan="3">
        <widget class="QComboBox" name="QFlags">
         <property name="enabled">
          <bool>true</bool>
@@ -212,7 +413,7 @@
         </item>
        </widget>
       </item>
-      <item row="5" column="6" colspan="3">
+      <item row="3" column="6" colspan="3">
        <widget class="QComboBox" name="OutputAlt">
         <property name="enabled">
          <bool>true</bool>
@@ -237,7 +438,44 @@
         </item>
        </widget>
       </item>
-      <item row="6" column="4" colspan="2">
+      <item row="1" column="3" colspan="2">
+       <widget class="QTimeEdit" name="TimeH1">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+       </widget>
+      </item>
+      <item row="1" column="7" colspan="2">
+       <widget class="QTimeEdit" name="TimeH2">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+       </widget>
+      </item>
+      <item row="1" column="1" colspan="2">
+       <widget class="QDateEdit" name="TimeY1">
+        <property name="enabled">
+         <bool>true</bool>
+        </property>
+        <property name="toolTip">
+         <string/>
+        </property>
+        <property name="date">
+         <date>
+          <year>2000</year>
+          <month>1</month>
+          <day>2</day>
+         </date>
+        </property>
+       </widget>
+      </item>
+      <item row="4" column="4" colspan="2">
        <widget class="QLabel" name="Label4">
         <property name="enabled">
          <bool>true</bool>
@@ -250,7 +488,7 @@
         </property>
        </widget>
       </item>
-      <item row="9" column="0" colspan="9">
+      <item row="7" column="0" colspan="9">
        <widget class="QLineEdit" name="InputFile">
         <property name="enabled">
          <bool>true</bool>
@@ -263,7 +501,7 @@
         </property>
        </widget>
       </item>
-      <item row="5" column="4" colspan="2">
+      <item row="3" column="4" colspan="2">
        <widget class="QLabel" name="Label3">
         <property name="enabled">
          <bool>true</bool>
@@ -276,7 +514,7 @@
         </property>
        </widget>
       </item>
-      <item row="11" column="0" colspan="8">
+      <item row="9" column="0" colspan="8">
        <widget class="QLineEdit" name="GoogleEarthFile">
         <property name="enabled">
          <bool>true</bool>
@@ -289,7 +527,7 @@
         </property>
        </widget>
       </item>
-      <item row="6" column="6" colspan="3">
+      <item row="4" column="6" colspan="3">
        <widget class="QComboBox" name="OutputTime">
         <property name="enabled">
          <bool>true</bool>
@@ -319,7 +557,7 @@
         </item>
        </widget>
       </item>
-      <item row="8" column="8">
+      <item row="6" column="8">
        <widget class="QPushButton" name="BtnInputFile">
         <property name="enabled">
          <bool>true</bool>
@@ -372,13 +610,13 @@
         </property>
        </widget>
       </item>
-      <item row="7" column="0" colspan="3">
+      <item row="5" column="0" colspan="3">
        <widget class="QCheckBox" name="AddOffset">
         <property name="toolTip">
          <string/>
         </property>
         <property name="text">
-         <string>Add Offset E/N/U</string>
+         <string>Add Offset E/N/U (m)</string>
         </property>
         <property name="checked">
          <bool>false</bool>
@@ -395,7 +633,7 @@
       <item row="0" column="2" colspan="2">
        <widget class="QRadioButton" name="FormatKML">
         <property name="text">
-         <string>Google &amp;Earth KML</string>
+         <string>Google Earth &amp;KML</string>
         </property>
        </widget>
       </item>
@@ -406,226 +644,6 @@
         </property>
        </widget>
       </item>
-      <item row="2" column="2" colspan="3">
-       <widget class="QDateTimeEdit" name="dateTime1">
-        <property name="calendarPopup">
-         <bool>true</bool>
-        </property>
-        <property name="timeSpec">
-         <enum>Qt::LocalTime</enum>
-        </property>
-       </widget>
-      </item>
-      <item row="2" column="0">
-       <widget class="QCheckBox" name="TimeSpan">
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>Time Span</string>
-        </property>
-        <property name="checked">
-         <bool>false</bool>
-        </property>
-       </widget>
-      </item>
-      <item row="5" column="2" colspan="2">
-       <widget class="QComboBox" name="TrackColor">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <item>
-         <property name="text">
-          <string>OFF</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>White</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>Green</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>Orange</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>Red</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>Yellow</string>
-         </property>
-        </item>
-       </widget>
-      </item>
-      <item row="4" column="4" colspan="2">
-       <widget class="QLabel" name="Label5">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>Q-Flags</string>
-        </property>
-       </widget>
-      </item>
-      <item row="6" column="0">
-       <widget class="QLabel" name="Label2">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>Output Waypoint</string>
-        </property>
-       </widget>
-      </item>
-      <item row="5" column="0">
-       <widget class="QLabel" name="Label1">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>Output Track</string>
-        </property>
-       </widget>
-      </item>
-      <item row="6" column="2" colspan="2">
-       <widget class="QComboBox" name="PointColor">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <item>
-         <property name="text">
-          <string>OFF</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>White</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>Green</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>Orange</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>Red</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>By Q-Flag</string>
-         </property>
-        </item>
-       </widget>
-      </item>
-      <item row="8" column="0" colspan="3">
-       <widget class="QLabel" name="Label7">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>Input/Output/GE Exe File</string>
-        </property>
-       </widget>
-      </item>
-      <item row="2" column="5" colspan="4">
-       <widget class="QDateTimeEdit" name="dateTime2">
-        <property name="calendarPopup">
-         <bool>true</bool>
-        </property>
-        <property name="timeSpec">
-         <enum>Qt::LocalTime</enum>
-        </property>
-       </widget>
-      </item>
-      <item row="4" column="2" colspan="2">
-       <widget class="QDoubleSpinBox" name="TimeInt">
-        <property name="suffix">
-         <string> s</string>
-        </property>
-        <property name="decimals">
-         <number>1</number>
-        </property>
-        <property name="maximum">
-         <double>100000.000000000000000</double>
-        </property>
-        <property name="value">
-         <double>1.000000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="7" column="3" colspan="2">
-       <widget class="QDoubleSpinBox" name="Offset1">
-        <property name="suffix">
-         <string> m</string>
-        </property>
-        <property name="decimals">
-         <number>4</number>
-        </property>
-        <property name="maximum">
-         <double>1000.000000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="7" column="5" colspan="2">
-       <widget class="QDoubleSpinBox" name="Offset2">
-        <property name="suffix">
-         <string> m</string>
-        </property>
-        <property name="decimals">
-         <number>4</number>
-        </property>
-        <property name="maximum">
-         <double>10000.000000000000000</double>
-        </property>
-       </widget>
-      </item>
-      <item row="7" column="7" colspan="2">
-       <widget class="QDoubleSpinBox" name="Offset3">
-        <property name="suffix">
-         <string> m</string>
-        </property>
-        <property name="decimals">
-         <number>4</number>
-        </property>
-        <property name="maximum">
-         <double>10000.000000000000000</double>
-        </property>
-       </widget>
-      </item>
      </layout>
     </widget>
    </item>
@@ -656,7 +674,7 @@
          <string>&amp;View....</string>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="rtkpost_qt.qrc">
           <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
         </property>
        </widget>
@@ -698,35 +716,8 @@
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>BtnConvert</tabstop>
-  <tabstop>BtnClose</tabstop>
-  <tabstop>FormatKML</tabstop>
-  <tabstop>FormatGPX</tabstop>
-  <tabstop>TimeSpan</tabstop>
-  <tabstop>dateTime1</tabstop>
-  <tabstop>dateTime2</tabstop>
-  <tabstop>TimeIntF</tabstop>
-  <tabstop>TimeInt</tabstop>
-  <tabstop>QFlags</tabstop>
-  <tabstop>TrackColor</tabstop>
-  <tabstop>OutputAlt</tabstop>
-  <tabstop>PointColor</tabstop>
-  <tabstop>OutputTime</tabstop>
-  <tabstop>AddOffset</tabstop>
-  <tabstop>Offset1</tabstop>
-  <tabstop>Offset2</tabstop>
-  <tabstop>Offset3</tabstop>
-  <tabstop>Compress</tabstop>
-  <tabstop>BtnInputFile</tabstop>
-  <tabstop>InputFile</tabstop>
-  <tabstop>OutputFile</tabstop>
-  <tabstop>GoogleEarthFile</tabstop>
-  <tabstop>BtnGoogleEarthFile</tabstop>
-  <tabstop>BtnView</tabstop>
- </tabstops>
  <resources>
-  <include location="../rtkconv_qt/rtkconv_qt.qrc"/>
+  <include location="rtkpost_qt.qrc"/>
  </resources>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/postmain.cpp RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/postmain.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/postmain.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/postmain.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -28,7 +28,6 @@
 //           2010/09/07  1.3 rtklib 2.4.1
 //           2011/04/03  1.4 rtklib 2.4.2
 //---------------------------------------------------------------------------
-#include <clocale>
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
@@ -71,6 +70,7 @@
 #ifndef GOOGLE_EARTH
 #define GOOGLE_EARTH ""
 #endif
+static const char version[]="$Revision: 1.1 $ $Date: 2008/07/17 22:14:45 $";
 
 // global variables ---------------------------------------------------------
 static gtime_t tstart_={0,0};         // time start for progress-bar
@@ -81,7 +81,7 @@
 extern "C" {
 
 // show message in message area ---------------------------------------------
-extern int showmsg(const char *format, ...)
+extern int showmsg(char *format, ...)
 {
     va_list arg;
     char buff[1024];
@@ -92,7 +92,7 @@
         QMetaObject::invokeMethod(mainForm, "ShowMsg",Qt::QueuedConnection,
                                   Q_ARG(QString,QString(buff)));
     }    
-    return mainForm->AbortFlag;
+    return !mainForm->AbortFlag;
 }
 // set time span of progress bar --------------------------------------------
 extern void settspan(gtime_t ts, gtime_t te)
@@ -132,9 +132,9 @@
 }
 ProcessingThread::~ProcessingThread()
 {
-    for (int i=0;i<6;i++) delete[] infile[i];
-    if (rov) delete[] rov;
-    if (base) delete[] base;
+    for (int i=0;i<6;i++) delete infile[i];
+    if (rov) delete rov;
+    if (base) delete base;
     rov=base=NULL;
 }
 void ProcessingThread::addInput(const QString & file) {
@@ -218,7 +218,6 @@
     dirCompleter->setModel(dirModel);
     OutDir->setCompleter(dirCompleter);
 
-    BtnAbort->setVisible(false);
 
     connect(BtnPlot,SIGNAL(clicked(bool)),this,SLOT(BtnPlotClick()));
     connect(BtnView,SIGNAL(clicked(bool)),this,SLOT(BtnViewClick()));
@@ -273,6 +272,7 @@
     QComboBox *ifile[]={InputFile3,InputFile4,InputFile5,InputFile6};
     int inputflag=0;
 
+#ifdef QT5
     QCommandLineParser parser;
     parser.setApplicationDescription("RTK post");
     parser.addHelpOption();
@@ -364,11 +364,19 @@
     }
     if (parser.isSet(timeStartOption)) {
         TimeStart->setChecked(true);
-        dateTime1->setDateTime(QDateTime::fromString(parser.value(timeStartOption),"yyyy/MM/dd hh:mm:ss"));
+        QStringList dateTime=parser.value(timeStartOption).split(" ");
+        if (dateTime.size()!=2) {
+            TimeY1->setDate(QDate::fromString(dateTime.at(0),"yyyy/MM/dd"));
+            TimeH1->setTime(QTime::fromString(dateTime.at(0),"hh:mm:ss"));
+        };
     }
     if (parser.isSet(timeEndOption)) {
         TimeEnd->setChecked(true);
-        dateTime2->setDateTime(QDateTime::fromString(parser.value(timeEndOption),"yyyy/MM/dd hh:mm:ss"));
+        QStringList dateTime=parser.value(timeEndOption).split(" ");
+        if (dateTime.size()!=2) {
+            TimeY2->setDate(QDate::fromString(dateTime.at(0),"yyyy/MM/dd"));
+            TimeH2->setTime(QTime::fromString(dateTime.at(0),"hh:mm:ss"));
+        };
     }
     if (parser.isSet(timeIntervalOption)) {
         TimeIntF->setChecked(true);
@@ -378,6 +386,7 @@
         TimeUnitF->setChecked(true);
         TimeUnit->setText(parser.value(timeUnitOption));
     }
+#endif /*TODO: alternative for QT4 */
 
     LoadOpt();
 
@@ -386,8 +395,10 @@
     UpdateEnable();
 }
 // callback on form close ---------------------------------------------------
-void MainForm::closeEvent(QCloseEvent *)
+void MainForm::closeEvent(QCloseEvent *event)
 {
+    if (event->spontaneous()) return;
+
     SaveOpt();
 }
 // callback on drop files ---------------------------------------------------
@@ -403,7 +414,7 @@
     
     if (!event->mimeData()->hasFormat("text/uri-list")) return;
 
-    QString file=QDir::toNativeSeparators(event->mimeData()->text());
+    QString file=event->mimeData()->text();
 
     top=Panel1->pos().y()+Panel4->pos().y();
     if (point.y()<=top+InputFile1->pos().y()+InputFile1->height()) {
@@ -468,8 +479,7 @@
 void MainForm::BtnExecClick()
 {
     QString OutputFile_Text=OutputFile->currentText();
-    AbortFlag=false;
-
+    
     if (InputFile1->currentText()=="") {
         showmsg("error : no rinex obs file (rover)");
         return;
@@ -503,7 +513,7 @@
     BtnPlot  ->setEnabled(false);
     BtnOption->setEnabled(false);
     Panel1   ->setEnabled(false);
-
+    
     ExecProc();
 }
 // callback on prcoessing finished-------------------------------------------
@@ -538,7 +548,7 @@
 // callback on button-abort -------------------------------------------------
 void MainForm::BtnAbortClick()
 {
-    AbortFlag=true;
+    AbortFlag=1;
     showmsg("aborted");
 }
 // callback on button-exit --------------------------------------------------
@@ -913,8 +923,7 @@
     prcopt.posopt[3]=PosOpt[3];
     prcopt.posopt[4]=PosOpt[4];
     prcopt.posopt[5]=PosOpt[5];
-    prcopt.dynamics =PosMode==PMODE_KINEMA||
-                     PosMode==PMODE_PPP_KINEMA;
+    prcopt.dynamics =DynamicModel;
     prcopt.tidecorr =TideCorr;
     prcopt.armaxiter=ARIter;
     prcopt.niter    =NumIter;
@@ -941,7 +950,6 @@
     prcopt.maxtdiff =MaxAgeDiff;
     prcopt.maxgdop  =RejectGdop;
     prcopt.maxinno  =RejectThres;
-    prcopt.outsingle=OutputSingle;
     if (BaseLineConst) {
         prcopt.baseline[0]=BaseLine[0];
         prcopt.baseline[1]=BaseLine[1];
@@ -1001,7 +1009,6 @@
     solopt.degf     =LatLonFormat;
     solopt.outhead  =OutputHead;
     solopt.outopt   =OutputOpt;
-    solopt.maxsolstd=MaxSolStd;
     solopt.datum    =OutputDatum;
     solopt.height   =OutputHeight;
     solopt.geoid    =OutputGeoid;
@@ -1130,7 +1137,7 @@
 // get time from time-1 -----------------------------------------------------
 gtime_t MainForm::GetTime1(void)
 {
-    QDateTime time(dateTime1->dateTime());
+    QDateTime time(TimeY1->date(),TimeH1->time());
 
     gtime_t t;
     t.time=time.toTime_t();t.sec=time.time().msec()/1000;
@@ -1140,7 +1147,7 @@
 // get time from time-2 -----------------------------------------------------
 gtime_t MainForm::GetTime2(void)
 {
-    QDateTime time(dateTime2->dateTime());
+    QDateTime time(TimeY2->date(),TimeH2->time());
 
     gtime_t t;
     t.time=time.toTime_t();t.sec=time.time().msec()/1000;
@@ -1150,14 +1157,16 @@
 // set time to time-1 -------------------------------------------------------
 void MainForm::SetTime1(gtime_t time)
 {
-    QDateTime t=QDateTime::fromTime_t(time.time); t=t.addMSecs(time.sec*1000);
-    dateTime1->setDateTime(t);
+    QDateTime t=QDateTime::fromTime_t(time.time); t=t.addSecs(time.sec);
+    TimeY1->setTime(t.time());
+    TimeH1->setDate(t.date());
 }
 // set time to time-2 -------------------------------------------------------
 void MainForm::SetTime2(gtime_t time)
 {
-    QDateTime t=QDateTime::fromTime_t(time.time); t=t.addMSecs(time.sec*1000);
-    dateTime2->setDateTime(t);
+    QDateTime t=QDateTime::fromTime_t(time.time); t=t.addSecs(time.sec);
+    TimeY2->setTime(t.time());
+    TimeH2->setDate(t.date());
 }
 // update enable/disable of widgets -----------------------------------------
 void MainForm::UpdateEnable(void)
@@ -1172,9 +1181,11 @@
     BtnOutputView1 ->setEnabled(DebugStatus>0);
     BtnOutputView2 ->setEnabled(DebugTrace >0);
     LabelInputFile3->setEnabled(moder);
-    dateTime1      ->setEnabled(TimeStart->isChecked());
+    TimeY1         ->setEnabled(TimeStart->isChecked());
+    TimeH1         ->setEnabled(TimeStart->isChecked());
     BtnTime1       ->setEnabled(TimeStart->isChecked());
-    dateTime2      ->setEnabled(TimeEnd  ->isChecked());
+    TimeY2         ->setEnabled(TimeEnd  ->isChecked());
+    TimeH2         ->setEnabled(TimeEnd  ->isChecked());
     BtnTime2       ->setEnabled(TimeEnd  ->isChecked());
     TimeInt        ->setEnabled(TimeIntF ->isChecked());
     LabelTimeInt   ->setEnabled(TimeIntF ->isChecked());
@@ -1192,10 +1203,10 @@
     
     TimeStart->setChecked(ini.value("set/timestart",   0).toBool());
     TimeEnd->setChecked(ini.value("set/timeend",     0).toBool());
-    dateTime1->setDate(ini.value ("set/timey1",      "2000/01/01").toDate());
-    dateTime1->setTime(ini.value ("set/timeh1",      "00:00:00").toTime());
-    dateTime2->setDate(ini.value ("set/timey2",      "2000/01/01").toDate());
-    dateTime2->setTime(ini.value ("set/timeh2",      "00:00:00").toTime());
+    TimeY1->setDate(ini.value ("set/timey1",      "2000/01/01").toDate());
+    TimeH1->setTime(ini.value ("set/timeh1",      "00:00:00").toTime());
+    TimeY2->setDate(ini.value ("set/timey2",      "2000/01/01").toDate());
+    TimeH2->setTime(ini.value ("set/timeh2",      "00:00:00").toTime());
     TimeIntF ->setChecked(ini.value("set/timeintf",    0).toBool());
     TimeInt->setCurrentText(ini.value ("set/timeint",     "0").toString());
     TimeUnitF->setChecked(ini.value("set/timeunitf",   0).toBool());
@@ -1273,8 +1284,6 @@
     FieldSep           =ini.value ("opt/fieldsep",      "").toString();
     OutputHead         =ini.value("opt/outputhead",     1).toInt();
     OutputOpt          =ini.value("opt/outputopt",      1).toInt();
-    OutputSingle       =ini.value("opt/outputsingle",   0).toInt();
-    MaxSolStd          =ini.value("opt/maxsolstd",    0.0).toInt();
     OutputDatum        =ini.value("opt/outputdatum",    0).toInt();
     OutputHeight       =ini.value("opt/outputheight",   0).toInt();
     OutputGeoid        =ini.value("opt/outputgeoid",    0).toInt();
@@ -1367,19 +1376,19 @@
     
     convDialog->TimeSpan  ->setChecked(ini.value("conv/timespan",  0).toInt());
     convDialog->TimeIntF  ->setChecked(ini.value("conv/timeintf",  0).toInt());
-    convDialog->dateTime1 ->setDate(ini.value ("conv/timey1","2000/01/01").toDate());
-    convDialog->dateTime1 ->setTime(ini.value ("conv/timeh1","00:00:00"  ).toTime());
-    convDialog->dateTime2 ->setDate(ini.value ("conv/timey2","2000/01/01").toDate());
-    convDialog->dateTime2 ->setTime(ini.value ("conv/timeh2","00:00:00"  ).toTime());
-    convDialog->TimeInt   ->setValue(ini.value ("conv/timeint", 0.0).toDouble());
+    convDialog->TimeY1    ->setDate(ini.value ("conv/timey1","2000/01/01").toDate());
+    convDialog->TimeH1    ->setTime(ini.value ("conv/timeh1","00:00:00"  ).toTime());
+    convDialog->TimeY2    ->setDate(ini.value ("conv/timey2","2000/01/01").toDate());
+    convDialog->TimeH2    ->setTime(ini.value ("conv/timeh2","00:00:00"  ).toTime());
+    convDialog->TimeInt   ->setText(ini.value ("conv/timeint", "0").toString());
     convDialog->TrackColor->setCurrentIndex(ini.value("conv/trackcolor",5).toInt());
     convDialog->PointColor->setCurrentIndex(ini.value("conv/pointcolor",5).toInt());
     convDialog->OutputAlt ->setCurrentIndex(ini.value("conv/outputalt", 0).toInt());
     convDialog->OutputTime->setCurrentIndex(ini.value("conv/outputtime",0).toInt());
     convDialog->AddOffset ->setChecked(ini.value("conv/addoffset", 0).toInt());
-    convDialog->Offset1   ->setValue(ini.value ("conv/offset1", "0").toDouble());
-    convDialog->Offset2   ->setValue(ini.value ("conv/offset2", "0").toDouble());
-    convDialog->Offset3   ->setValue(ini.value ("conv/offset3", "0").toDouble());
+    convDialog->Offset1   ->setText(ini.value ("conv/offset1", "0").toString());
+    convDialog->Offset2   ->setText(ini.value ("conv/offset2", "0").toString());
+    convDialog->Offset3   ->setText(ini.value ("conv/offset3", "0").toString());
     convDialog->Compress  ->setChecked(ini.value("conv/compress",  0).toInt());
     convDialog->FormatKML ->setChecked(ini.value("conv/format",    0).toInt());
 
@@ -1393,15 +1402,15 @@
 {
     QSettings ini(IniFile,QSettings::IniFormat);
     
-    ini.setValue ("set/timestart",   TimeStart ->isChecked()?1:0);
-    ini.setValue ("set/timeend",     TimeEnd   ->isChecked()?1:0);
-    ini.setValue ("set/timey1",      dateTime1    ->date());
-    ini.setValue ("set/timeh1",      dateTime1    ->time());
-    ini.setValue ("set/timey2",      dateTime2    ->date());
-    ini.setValue ("set/timeh2",      dateTime2    ->time());
-    ini.setValue ("set/timeintf",    TimeIntF  ->isChecked()?1:0);
+    ini.setValue("set/timestart",   TimeStart ->isChecked()?1:0);
+    ini.setValue("set/timeend",     TimeEnd   ->isChecked()?1:0);
+    ini.setValue ("set/timey1",      TimeY1    ->text());
+    ini.setValue ("set/timeh1",      TimeH1    ->text());
+    ini.setValue ("set/timey2",      TimeY2    ->text());
+    ini.setValue ("set/timeh2",      TimeH2    ->text());
+    ini.setValue("set/timeintf",    TimeIntF  ->isChecked()?1:0);
     ini.setValue ("set/timeint",     TimeInt   ->currentText());
-    ini.setValue ("set/timeunitf",   TimeUnitF ->isChecked()?1:0);
+    ini.setValue("set/timeunitf",   TimeUnitF ->isChecked()?1:0);
     ini.setValue ("set/timeunit",    TimeUnit  ->text());
     ini.setValue ("set/inputfile1",  InputFile1->currentText());
     ini.setValue ("set/inputfile2",  InputFile2->currentText());
@@ -1409,7 +1418,7 @@
     ini.setValue ("set/inputfile4",  InputFile4->currentText());
     ini.setValue ("set/inputfile5",  InputFile5->currentText());
     ini.setValue ("set/inputfile6",  InputFile6->currentText());
-    ini.setValue ("set/outputdirena",OutDirEna ->isChecked());
+    ini.setValue("set/outputdirena",OutDirEna ->isChecked());
     ini.setValue ("set/outputdir",   OutDir    ->text());
     ini.setValue ("set/outputfile",  OutputFile->currentText());
     
@@ -1476,8 +1485,6 @@
     ini.setValue ("opt/fieldsep",    FieldSep    );
     ini.setValue("opt/outputhead",  OutputHead  );
     ini.setValue("opt/outputopt",   OutputOpt   );
-    ini.setValue("opt/outputsingle",OutputSingle);
-    ini.setValue("opt/maxsolstd",   MaxSolStd   );
     ini.setValue("opt/outputdatum", OutputDatum );
     ini.setValue("opt/outputheight",OutputHeight);
     ini.setValue("opt/outputgeoid", OutputGeoid );
@@ -1567,28 +1574,28 @@
     ini.setValue  ("opt/exterr_gpsglob0",ExtErr.gpsglob[0]);
     ini.setValue  ("opt/exterr_gpsglob1",ExtErr.gpsglob[1]);
     
-    ini.setValue ("conv/timespan",   convDialog->TimeSpan  ->isChecked());
-    ini.setValue ("conv/timey1",     convDialog->dateTime1 ->date());
-    ini.setValue ("conv/timeh1",     convDialog->dateTime1 ->time());
-    ini.setValue ("conv/timey2",     convDialog->dateTime2 ->date());
-    ini.setValue ("conv/timeh2",     convDialog->dateTime2 ->time());
-    ini.setValue ("conv/timeintf",   convDialog->TimeIntF  ->isChecked()  );
+    ini.setValue("conv/timespan",   convDialog->TimeSpan  ->isChecked()  );
+    ini.setValue ("conv/timey1",     convDialog->TimeY1    ->text()     );
+    ini.setValue ("conv/timeh1",     convDialog->TimeH1    ->text()     );
+    ini.setValue ("conv/timey2",     convDialog->TimeY2    ->text()     );
+    ini.setValue ("conv/timeh2",     convDialog->TimeH2    ->text()     );
+    ini.setValue("conv/timeintf",   convDialog->TimeIntF  ->isChecked()  );
     ini.setValue ("conv/timeint",    convDialog->TimeInt   ->text()     );
-    ini.setValue ("conv/trackcolor", convDialog->TrackColor->currentIndex());
-    ini.setValue ("conv/pointcolor", convDialog->PointColor->currentIndex());
-    ini.setValue ("conv/outputalt",  convDialog->OutputAlt ->currentIndex());
-    ini.setValue ("conv/outputtime", convDialog->OutputTime->currentIndex());
-    ini.setValue ("conv/addoffset",  convDialog->AddOffset ->isChecked()  );
+    ini.setValue("conv/trackcolor", convDialog->TrackColor->currentIndex());
+    ini.setValue("conv/pointcolor", convDialog->PointColor->currentIndex());
+    ini.setValue("conv/outputalt",  convDialog->OutputAlt ->currentIndex());
+    ini.setValue("conv/outputtime", convDialog->OutputTime->currentIndex());
+    ini.setValue("conv/addoffset",  convDialog->AddOffset ->isChecked()  );
     ini.setValue ("conv/offset1",    convDialog->Offset1   ->text()     );
     ini.setValue ("conv/offset2",    convDialog->Offset2   ->text()     );
     ini.setValue ("conv/offset3",    convDialog->Offset3   ->text()     );
-    ini.setValue ("conv/compress",   convDialog->Compress  ->isChecked()  );
-    ini.setValue ("conv/format",     convDialog->FormatKML ->isChecked()  );
+    ini.setValue("conv/compress",   convDialog->Compress  ->isChecked()  );
+    ini.setValue("conv/format",     convDialog->FormatKML ->isChecked()  );
 
-    ini.setValue ("viewer/color1",textViewer->Color1  );
-    ini.setValue ("viewer/color2",textViewer->Color2  );
-    ini.setValue ("viewer/fontname",textViewer->FontD.family());
-    ini.setValue ("viewer/fontsize",textViewer->FontD.pointSize());
+    ini.setValue("viewer/color1",textViewer->Color1  );
+    ini.setValue("viewer/color2",textViewer->Color2  );
+    ini.setValue("viewer/fontname",textViewer->FontD.family());
+    ini.setValue("viewer/fontsize",textViewer->FontD.pointSize());
 }
 //---------------------------------------------------------------------------
 
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/postmain.h RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/postmain.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/postmain.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/postmain.h	2019-08-19 02:04:50.000000000 +0300
@@ -23,23 +23,20 @@
 class ProcessingThread : public QThread
 {
     Q_OBJECT
-
 public:
     prcopt_t prcopt;
     solopt_t solopt;
     filopt_t filopt;
-    gtime_t ts, te;
-    double ti, tu;
-    int n, stat;
-    char *infile[6], outfile[1024];
-    char *rov, *base;
+    gtime_t ts,te;
+    double ti,tu;
+    int n,stat;
+    char *infile[6],outfile[1024];
+    char *rov,*base;
 
     explicit ProcessingThread(QObject *parent);
     ~ProcessingThread();
-
     void addInput(const QString &);
     void addList(char * &sta, const QString & list);
-
 protected:
     void run();
 
@@ -53,69 +50,69 @@
     Q_OBJECT
 
 public slots:
-    void BtnPlotClick();
-    void BtnViewClick();
-    void BtnToKMLClick();
-    void BtnOptionClick();
-    void BtnExecClick();
-    void BtnAbortClick();
-    void BtnExitClick();
-    void BtnAboutClick();
+    void BtnPlotClick       ();
+    void BtnViewClick       ();
+    void BtnToKMLClick      ();
+    void BtnOptionClick     ();
+    void BtnExecClick       ();
+    void BtnAbortClick       ();
+    void BtnExitClick       ();
+    void BtnAboutClick      ();
 	
-    void BtnTime1Click();
-    void BtnTime2Click();
-    void BtnInputFile1Click();
-    void BtnInputFile3Click();
-    void BtnInputFile2Click();
-    void BtnInputFile4Click();
-    void BtnInputFile5Click();
-    void BtnOutputFileClick();
-    void BtnInputView1Click();
-    void BtnInputView3Click();
-    void BtnInputView2Click();
-    void BtnInputView4Click();
-    void BtnInputView5Click();
+    void BtnTime1Click      ();
+    void BtnTime2Click      ();
+    void BtnInputFile1Click ();
+    void BtnInputFile3Click ();
+    void BtnInputFile2Click ();
+    void BtnInputFile4Click ();
+    void BtnInputFile5Click ();
+    void BtnOutputFileClick ();
+    void BtnInputView1Click ();
+    void BtnInputView3Click ();
+    void BtnInputView2Click ();
+    void BtnInputView4Click ();
+    void BtnInputView5Click ();
     void BtnOutputView1Click();
     void BtnOutputView2Click();
-    void BtnInputPlot1Click();
-    void BtnInputPlot2Click();
-    void BtnKeywordClick();
+    void BtnInputPlot1Click ();
+    void BtnInputPlot2Click ();
+    void BtnKeywordClick    ();
 	
-    void TimeStartClick();
-    void TimeEndClick();
-    void TimeIntFClick();
-    void TimeUnitFClick();
+    void TimeStartClick     ();
+    void TimeEndClick       ();
+    void TimeIntFClick      ();
+    void TimeUnitFClick     ();
 	
-    void InputFile1Change();
+    void InputFile1Change   ();
     void OutDirEnaClick();
     void BtnOutDirClick();
     void OutDirChange();
     void BtnInputFile6Click();
     void BtnInputView6Click();
 
-    void FormCreate();
-    void ProcessingFinished(int);
+    void FormCreate          ();
+    void ProcessingFinished  (int);
     void ShowMsg(const QString  &msg);
-
 protected:
-    void showEvent(QShowEvent*);
-    void closeEvent(QCloseEvent*);
-    void dragEnterEvent(QDragEnterEvent *event);
-    void dropEvent(QDropEvent *event);
+    void showEvent           (QShowEvent*);
+    void closeEvent          (QCloseEvent*);
+    void  dragEnterEvent        (QDragEnterEvent *event);
+    void  dropEvent             (QDropEvent *event);
 
 private:
-    OptDialog  *optDialog;
+
+    OptDialog	 *optDialog;
     ConvDialog *convDialog;
     TextViewer *textViewer;
 
-    void ExecProc (void);
+    void  ExecProc           (void);
     int  GetOption(prcopt_t &prcopt, solopt_t &solopt, filopt_t &filopt);
     int  ObsToNav (const QString &obsfile, QString &navfile);
 	
     QString FilePath(const QString &file);
     void ReadList(QComboBox *, QSettings *ini,  const QString &key);
     void WriteList(QSettings *ini, const QString &key, const QComboBox *combo);
-    void AddHist(QComboBox *combo);
+    void AddHist  (QComboBox *combo);
     int ExecCmd(const QString &cmd, int show);
 	
     gtime_t GetTime1(void);
@@ -129,41 +126,39 @@
 	
 public:
     QString IniFile;
-    bool AbortFlag;
+    int AbortFlag;
 	
 	// options
-    int PosMode, Freq, Solution, DynamicModel, IonoOpt, TropOpt, RcvBiasEst;
-    int ARIter, NumIter, CodeSmooth, TideCorr;
-    int OutCntResetAmb, FixCntHoldAmb, LockCntFixAmb, RovPosType, RefPosType;
-    int SatEphem, NavSys;
-    int RovAntPcv, RefAntPcv, AmbRes, GloAmbRes, BdsAmbRes;
-    int OutputHead, OutputOpt, OutputSingle, OutputDatum;
-    int OutputHeight, OutputGeoid, DebugTrace, DebugStatus, BaseLineConst;
-    int SolFormat, TimeFormat, LatLonFormat, IntpRefObs, NetRSCorr, SatClkCorr;
-    int SbasCorr, SbasCorr1, SbasCorr2, SbasCorr3, SbasCorr4, TimeDecimal;
-    int SolStatic, SbasSat, MapFunc;
+	int PosMode,Freq,Solution,DynamicModel,IonoOpt,TropOpt,RcvBiasEst;
+	int ARIter,NumIter,CodeSmooth,TideCorr;
+	int OutCntResetAmb,FixCntHoldAmb,LockCntFixAmb,RovPosType,RefPosType;
+	int SatEphem,NavSys;
+	int RovAntPcv,RefAntPcv,AmbRes,GloAmbRes,BdsAmbRes;
+	int OutputHead,OutputOpt,OutputDatum;
+	int OutputHeight,OutputGeoid,DebugTrace,DebugStatus,BaseLineConst;
+	int SolFormat,TimeFormat,LatLonFormat,IntpRefObs,NetRSCorr,SatClkCorr;
+	int SbasCorr,SbasCorr1,SbasCorr2,SbasCorr3,SbasCorr4,TimeDecimal;
+	int SolStatic,SbasSat,MapFunc;
 	int PosOpt[6];
-    double ElMask, MaxAgeDiff, RejectThres, RejectGdop;
-    double MeasErrR1, MeasErrR2, MeasErr2, MeasErr3, MeasErr4, MeasErr5;
-    double SatClkStab, RovAntE, RovAntN, RovAntU, RefAntE, RefAntN, RefAntU;
-    double PrNoise1, PrNoise2, PrNoise3, PrNoise4, PrNoise5;
-    double ValidThresAR, ElMaskAR, ElMaskHold, SlipThres;
-    double ThresAR2, ThresAR3;
-    double RovPos[3], RefPos[3], BaseLine[2];
-    double MaxSolStd;
+	double ElMask,MaxAgeDiff,RejectThres,RejectGdop;
+	double MeasErrR1,MeasErrR2,MeasErr2,MeasErr3,MeasErr4,MeasErr5;
+	double SatClkStab,RovAntE,RovAntN,RovAntU,RefAntE,RefAntN,RefAntU;
+	double PrNoise1,PrNoise2,PrNoise3,PrNoise4,PrNoise5;
+	double ValidThresAR,ElMaskAR,ElMaskHold,SlipThres;
+	double ThresAR2,ThresAR3;
+	double RovPos[3],RefPos[3],BaseLine[2];
 	snrmask_t SnrMask;
 	exterr_t ExtErr;
 	
-    QString RnxOpts1, RnxOpts2, PPPOpts;
-    QString FieldSep, RovAnt, RefAnt, AntPcvFile, StaPosFile, PrecEphFile;
-    QString NetRSCorrFile1, NetRSCorrFile2, SatClkCorrFile, GoogleEarthFile;
-    QString GeoidDataFile, IonoFile, DCBFile, EOPFile, BLQFile;
-    QString SbasCorrFile, SatPcvFile, ExSats;
-    QString RovList, BaseList;
+    QString RnxOpts1,RnxOpts2,PPPOpts;
+    QString FieldSep,RovAnt,RefAnt,AntPcvFile,StaPosFile,PrecEphFile;
+    QString NetRSCorrFile1,NetRSCorrFile2,SatClkCorrFile,GoogleEarthFile;
+    QString GeoidDataFile,IonoFile,DCBFile,EOPFile,BLQFile;
+    QString SbasCorrFile,SatPcvFile,ExSats;
+    QString RovList,BaseList;
 	
     void ViewFile(const QString &file);
-
-    explicit MainForm(QWidget *parent = 0);
+    explicit MainForm(QWidget *parent=0);
 };
 
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/postmain.ui RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/postmain.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/postmain.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/postmain.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,7 +6,7 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>697</width>
+    <width>633</width>
     <height>551</height>
    </rect>
   </property>
@@ -155,11 +155,44 @@
            </property>
           </widget>
          </item>
-         <item row="1" column="0" colspan="3">
-          <widget class="QDateTimeEdit" name="dateTime1">
-           <property name="calendarPopup">
+         <item row="1" column="0">
+          <widget class="QDateEdit" name="TimeY1">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="1" colspan="2">
+          <widget class="QTimeEdit" name="TimeH1">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="3">
+          <widget class="QDateEdit" name="TimeY2">
+           <property name="enabled">
             <bool>true</bool>
            </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="4" colspan="2">
+          <widget class="QTimeEdit" name="TimeH2">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
           </widget>
          </item>
          <item row="1" column="6">
@@ -253,8 +286,8 @@
            </property>
           </widget>
          </item>
-         <item row="1" column="9">
-          <widget class="QLabel" name="LabelTimeUnit">
+         <item row="1" column="8">
+          <widget class="QLineEdit" name="TimeUnit">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -262,12 +295,12 @@
             <string/>
            </property>
            <property name="text">
-            <string>H</string>
+            <string>24</string>
            </property>
           </widget>
          </item>
-         <item row="1" column="8">
-          <widget class="QLineEdit" name="TimeUnit">
+         <item row="1" column="9">
+          <widget class="QLabel" name="LabelTimeUnit">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -275,14 +308,7 @@
             <string/>
            </property>
            <property name="text">
-            <string>24</string>
-           </property>
-          </widget>
-         </item>
-         <item row="1" column="3" colspan="3">
-          <widget class="QDateTimeEdit" name="dateTime2">
-           <property name="calendarPopup">
-            <bool>true</bool>
+            <string>H</string>
            </property>
           </widget>
          </item>
@@ -366,7 +392,7 @@
             <string/>
            </property>
            <property name="icon">
-            <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+            <iconset resource="rtkpost_qt.qrc">
              <normaloff>:/buttons/chart.bmp</normaloff>:/buttons/chart.bmp</iconset>
            </property>
            <property name="flat">
@@ -386,7 +412,7 @@
             <string/>
            </property>
            <property name="icon">
-            <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+            <iconset resource="rtkpost_qt.qrc">
              <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
            </property>
            <property name="flat">
@@ -485,7 +511,7 @@
             <string/>
            </property>
            <property name="icon">
-            <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+            <iconset resource="rtkpost_qt.qrc">
              <normaloff>:/buttons/chart.bmp</normaloff>:/buttons/chart.bmp</iconset>
            </property>
            <property name="flat">
@@ -505,7 +531,7 @@
             <string/>
            </property>
            <property name="icon">
-            <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+            <iconset resource="rtkpost_qt.qrc">
              <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
            </property>
            <property name="flat">
@@ -604,7 +630,7 @@
             <string/>
            </property>
            <property name="icon">
-            <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+            <iconset resource="rtkpost_qt.qrc">
              <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
            </property>
            <property name="flat">
@@ -624,7 +650,7 @@
             <string/>
            </property>
            <property name="icon">
-            <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+            <iconset resource="rtkpost_qt.qrc">
              <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
            </property>
            <property name="flat">
@@ -644,7 +670,7 @@
             <string/>
            </property>
            <property name="icon">
-            <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+            <iconset resource="rtkpost_qt.qrc">
              <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
            </property>
            <property name="flat">
@@ -664,7 +690,7 @@
             <string/>
            </property>
            <property name="icon">
-            <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+            <iconset resource="rtkpost_qt.qrc">
              <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
            </property>
            <property name="flat">
@@ -1142,12 +1168,6 @@
       </item>
       <item>
        <widget class="QWidget" name="widget" native="true">
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
         <layout class="QHBoxLayout" name="horizontalLayout_2">
          <property name="leftMargin">
           <number>0</number>
@@ -1179,7 +1199,7 @@
             <string/>
            </property>
            <property name="icon">
-            <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+            <iconset resource="rtkpost_qt.qrc">
              <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
            </property>
            <property name="flat">
@@ -1205,7 +1225,7 @@
             <string/>
            </property>
            <property name="icon">
-            <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+            <iconset resource="rtkpost_qt.qrc">
              <normaloff>:/buttons/sqr.bmp</normaloff>:/buttons/sqr.bmp</iconset>
            </property>
            <property name="flat">
@@ -1374,6 +1394,9 @@
       <string/>
      </property>
      <layout class="QHBoxLayout" name="horizontalLayout">
+      <property name="spacing">
+       <number>0</number>
+      </property>
       <property name="leftMargin">
        <number>0</number>
       </property>
@@ -1395,7 +1418,7 @@
          <string>&amp;Plot...</string>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="rtkpost_qt.qrc">
           <normaloff>:/buttons/chart.bmp</normaloff>:/buttons/chart.bmp</iconset>
         </property>
         <property name="flat">
@@ -1415,7 +1438,7 @@
          <string>&amp;View...</string>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="rtkpost_qt.qrc">
           <normaloff>:/buttons/doc.bmp</normaloff>:/buttons/doc.bmp</iconset>
         </property>
         <property name="flat">
@@ -1451,7 +1474,7 @@
          <string>&amp;Options...</string>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="rtkpost_qt.qrc">
           <normaloff>:/buttons/toolbmp</normaloff>:/buttons/toolbmp</iconset>
         </property>
         <property name="flat">
@@ -1471,7 +1494,7 @@
          <string>E&amp;xecute</string>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="../rtknavi_qt/rtknavi_qt.qrc">
           <normaloff>:/buttons/start.bmp</normaloff>:/buttons/start.bmp</iconset>
         </property>
         <property name="flat">
@@ -1485,7 +1508,7 @@
          <string>Abort</string>
         </property>
         <property name="icon">
-         <iconset resource="../rtkconv_qt/rtkconv_qt.qrc">
+         <iconset resource="../rtknavi_qt/rtknavi_qt.qrc">
           <normaloff>:/buttons/stop2.bmp</normaloff>:/buttons/stop2.bmp</iconset>
         </property>
        </widget>
@@ -1511,56 +1534,9 @@
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>BtnExec</tabstop>
-  <tabstop>BtnAbort</tabstop>
-  <tabstop>BtnExit</tabstop>
-  <tabstop>TimeStart</tabstop>
-  <tabstop>BtnTime1</tabstop>
-  <tabstop>TimeEnd</tabstop>
-  <tabstop>BtnTime2</tabstop>
-  <tabstop>TimeIntF</tabstop>
-  <tabstop>TimeUnitF</tabstop>
-  <tabstop>dateTime1</tabstop>
-  <tabstop>dateTime2</tabstop>
-  <tabstop>TimeInt</tabstop>
-  <tabstop>TimeUnit</tabstop>
-  <tabstop>BtnKeyword</tabstop>
-  <tabstop>BtnInputPlot1</tabstop>
-  <tabstop>BtnInputView1</tabstop>
-  <tabstop>InputFile1</tabstop>
-  <tabstop>BtnInputFile1</tabstop>
-  <tabstop>BtnInputPlot2</tabstop>
-  <tabstop>BtnInputView2</tabstop>
-  <tabstop>InputFile2</tabstop>
-  <tabstop>BtnInputFile2</tabstop>
-  <tabstop>BtnInputView3</tabstop>
-  <tabstop>BtnInputView4</tabstop>
-  <tabstop>BtnInputView5</tabstop>
-  <tabstop>BtnInputView6</tabstop>
-  <tabstop>InputFile3</tabstop>
-  <tabstop>BtnInputFile3</tabstop>
-  <tabstop>InputFile4</tabstop>
-  <tabstop>BtnInputFile4</tabstop>
-  <tabstop>InputFile5</tabstop>
-  <tabstop>BtnInputFile5</tabstop>
-  <tabstop>InputFile6</tabstop>
-  <tabstop>BtnInputFile6</tabstop>
-  <tabstop>OutDirEna</tabstop>
-  <tabstop>OutDir</tabstop>
-  <tabstop>BtnOutDir</tabstop>
-  <tabstop>OutputFile</tabstop>
-  <tabstop>BtnOutputFile</tabstop>
-  <tabstop>BtnOutputView2</tabstop>
-  <tabstop>BtnOutputView1</tabstop>
-  <tabstop>BtnAbout</tabstop>
-  <tabstop>BtnPlot</tabstop>
-  <tabstop>BtnView</tabstop>
-  <tabstop>BtnToKML</tabstop>
-  <tabstop>BtnOption</tabstop>
- </tabstops>
  <resources>
-  <include location="../rtkconv_qt/rtkconv_qt.qrc"/>
+  <include location="rtkpost_qt.qrc"/>
+  <include location="../rtknavi_qt/rtknavi_qt.qrc"/>
  </resources>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/postopt.cpp RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/postopt.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/postopt.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/postopt.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -22,20 +22,20 @@
     setupUi(this);
     widget->setVisible(false);
 
-    int nglo = MAXPRNGLO, ngal = MAXPRNGAL, nqzs = MAXPRNQZS, ncmp = MAXPRNCMP;
-    int nirn = MAXPRNIRN;
-
+    int nglo=MAXPRNGLO,ngal=MAXPRNGAL,nqzs=MAXPRNQZS,ncmp=MAXPRNCMP;
+    int nirn=MAXPRNIRN;
+    
 #if 0
-    QString label, s;
+    QString label,s;
     Freq->Items->Clear();
-    for (int i = 0; i < NFREQ; i++) {
-        label = label + (i > 0 ? "+" : "L") + s.sprintf("%d", freq[i]);
+    for (int i=0;i<NFREQ;i++) {
+        label=label+(i>0?"+":"L")+s.sprintf("%d",freq[i]);
         Freq->Items->Add(label);
     }
 #endif
 
-    QCompleter *fileCompleter = new QCompleter(this);
-    QFileSystemModel *fileModel = new QFileSystemModel(fileCompleter);
+    QCompleter *fileCompleter=new QCompleter(this);
+    QFileSystemModel *fileModel=new QFileSystemModel(fileCompleter);
     fileModel->setRootPath("");
     fileCompleter->setModel(fileModel);
     StaPosFile->setCompleter(fileCompleter);
@@ -47,60 +47,60 @@
     BLQFile->setCompleter(fileCompleter);
     IonoFile->setCompleter(fileCompleter);
 
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(RovAntPcv, SIGNAL(clicked(bool)), this, SLOT(RovAntPcvClick()));
-    connect(RefAntPcv, SIGNAL(clicked(bool)), this, SLOT(RovAntPcvClick()));
-    connect(BtnAntPcvFile, SIGNAL(clicked(bool)), this, SLOT(BtnAntPcvFileClick()));
-    connect(BtnIonoFile, SIGNAL(clicked(bool)), this, SLOT(BtnIonoFileClick()));
-    connect(BtnAntPcvView, SIGNAL(clicked(bool)), this, SLOT(BtnAntPcvViewClick()));
-    connect(PosMode, SIGNAL(currentIndexChanged(int)), this, SLOT(PosModeChange()));
-    connect(SolFormat, SIGNAL(currentIndexChanged(int)), this, SLOT(SolFormatChange()));
-    connect(AmbRes, SIGNAL(currentIndexChanged(int)), this, SLOT(AmbResChange()));
-    connect(BtnLoad, SIGNAL(clicked(bool)), this, SLOT(BtnLoadClick()));
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(BtnSave, SIGNAL(clicked(bool)), this, SLOT(BtnSaveClick()));
-    connect(Freq, SIGNAL(currentIndexChanged(int)), this, SLOT(FreqChange()));
-    connect(BtnRefPos, SIGNAL(clicked(bool)), this, SLOT(BtnRefPosClick()));
-    connect(BtnRovPos, SIGNAL(clicked(bool)), this, SLOT(BtnRovPosClick()));
-    connect(BtnStaPosView, SIGNAL(clicked(bool)), this, SLOT(BtnStaPosViewClick()));
-    connect(BtnStaPosFile, SIGNAL(clicked(bool)), this, SLOT(BtnStaPosFileClick()));
-    connect(OutputHeight, SIGNAL(currentIndexChanged(int)), this, SLOT(OutputHeightClick()));
-    connect(RefPosType, SIGNAL(currentIndexChanged(int)), this, SLOT(RefPosTypeChange()));
-    connect(RovPosType, SIGNAL(currentIndexChanged(int)), this, SLOT(RovPosTypeChange()));
-    connect(BtnSatPcvFile, SIGNAL(clicked(bool)), this, SLOT(BtnSatPcvFileClick()));
-    connect(BtnSatPcvView, SIGNAL(clicked(bool)), this, SLOT(BtnSatPcvViewClick()));
-    connect(SatEphem, SIGNAL(currentIndexChanged(int)), this, SLOT(SatEphemChange()));
-    connect(BtnGeoidDataFile, SIGNAL(clicked(bool)), this, SLOT(BtnGeoidDataFileClick()));
-    connect(BaselineConst, SIGNAL(clicked(bool)), this, SLOT(BaselineConstClick()));
-    connect(NavSys1, SIGNAL(clicked(bool)), this, SLOT(NavSys2Click()));
-    connect(NavSys2, SIGNAL(clicked(bool)), this, SLOT(NavSys2Click()));
-    connect(NavSys3, SIGNAL(clicked(bool)), this, SLOT(NavSys2Click()));
-    connect(NavSys4, SIGNAL(clicked(bool)), this, SLOT(NavSys2Click()));
-    connect(NavSys5, SIGNAL(clicked(bool)), this, SLOT(NavSys2Click()));
-    connect(NavSys6, SIGNAL(clicked(bool)), this, SLOT(NavSys2Click()));
-    connect(IonoOpt, SIGNAL(currentIndexChanged(int)), this, SLOT(IonoOptChange()));
-    connect(TropOpt, SIGNAL(currentIndexChanged(int)), this, SLOT(TropOptChange()));
-    connect(DynamicModel, SIGNAL(currentIndexChanged(int)), this, SLOT(DynamicModelChange()));
-    connect(SatEphem, SIGNAL(currentIndexChanged(int)), this, SLOT(SatEphemChange()));
-    connect(RovAnt, SIGNAL(currentIndexChanged(int)), this, SLOT(RovAntClick()));
-    connect(RefAnt, SIGNAL(currentIndexChanged(int)), this, SLOT(RefAntClick()));
-    connect(BtnDCBFile, SIGNAL(clicked(bool)), this, SLOT(BtnDCBFileClick()));
-    connect(BtnDCBView, SIGNAL(clicked(bool)), this, SLOT(BtnDCBViewClick()));
-    connect(BtnHelp, SIGNAL(clicked(bool)), this, SLOT(BtnHelpClick()));
-    connect(BtnBLQFile, SIGNAL(clicked(bool)), this, SLOT(BtnBLQFileClick()));
-    connect(BtnBLQFileView, SIGNAL(clicked(bool)), this, SLOT(BtnBLQFileViewClick()));
-    connect(BtnEOPFile, SIGNAL(clicked(bool)), this, SLOT(BtnEOPFileClick()));
-    connect(BtnEOPView, SIGNAL(clicked(bool)), this, SLOT(BtnEOPViewClick()));
-    connect(BtnExtOpt, SIGNAL(clicked(bool)), this, SLOT(BtnExtOptClick()));
-    connect(BtnMask, SIGNAL(clicked(bool)), this, SLOT(BtnMaskClick()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(RovAntPcv,SIGNAL(clicked(bool)),this,SLOT(RovAntPcvClick()));
+    connect(RefAntPcv,SIGNAL(clicked(bool)),this,SLOT(RovAntPcvClick()));
+    connect(BtnAntPcvFile,SIGNAL(clicked(bool)),this,SLOT(BtnAntPcvFileClick()));
+    connect(BtnIonoFile,SIGNAL(clicked(bool)),this,SLOT(BtnIonoFileClick()));
+    connect(BtnAntPcvView,SIGNAL(clicked(bool)),this,SLOT(BtnAntPcvViewClick()));
+    connect(PosMode,SIGNAL(currentIndexChanged(int)),this,SLOT(PosModeChange()));
+    connect(SolFormat,SIGNAL(currentIndexChanged(int)),this,SLOT(SolFormatChange()));
+    connect(AmbRes,SIGNAL(currentIndexChanged(int)),this,SLOT(AmbResChange()));
+    connect(BtnLoad,SIGNAL(clicked(bool)),this,SLOT(BtnLoadClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(BtnSave,SIGNAL(clicked(bool)),this,SLOT(BtnSaveClick()));
+    connect(Freq,SIGNAL(currentIndexChanged(int)),this,SLOT(FreqChange()));
+    connect(BtnRefPos,SIGNAL(clicked(bool)),this,SLOT(BtnRefPosClick()));
+    connect(BtnRovPos,SIGNAL(clicked(bool)),this,SLOT(BtnRovPosClick()));
+    connect(BtnStaPosView,SIGNAL(clicked(bool)),this,SLOT(BtnStaPosViewClick()));
+    connect(BtnStaPosFile,SIGNAL(clicked(bool)),this,SLOT(BtnSatPcvFileClick()));
+    connect(OutputHeight,SIGNAL(currentIndexChanged(int)),this,SLOT(OutputHeightClick()));
+    connect(RefPosType,SIGNAL(currentIndexChanged(int)),this,SLOT(RefPosTypeChange()));
+    connect(RovPosType,SIGNAL(currentIndexChanged(int)),this,SLOT(RovPosTypeChange()));
+    connect(BtnSatPcvFile,SIGNAL(clicked(bool)),this,SLOT(BtnSatPcvFileClick()));
+    connect(BtnSatPcvView,SIGNAL(clicked(bool)),this,SLOT(BtnSatPcvViewClick()));
+    connect(SatEphem,SIGNAL(currentIndexChanged(int)),this,SLOT(SatEphemChange()));
+    connect(BtnGeoidDataFile,SIGNAL(clicked(bool)),this,SLOT(BtnGeoidDataFileClick()));
+    connect(BaselineConst,SIGNAL(clicked(bool)),this,SLOT(BaselineConstClick()));
+    connect(NavSys1,SIGNAL(clicked(bool)),this,SLOT(NavSys2Click()));
+    connect(NavSys2,SIGNAL(clicked(bool)),this,SLOT(NavSys2Click()));
+    connect(NavSys3,SIGNAL(clicked(bool)),this,SLOT(NavSys2Click()));
+    connect(NavSys4,SIGNAL(clicked(bool)),this,SLOT(NavSys2Click()));
+    connect(NavSys5,SIGNAL(clicked(bool)),this,SLOT(NavSys2Click()));
+    connect(NavSys6,SIGNAL(clicked(bool)),this,SLOT(NavSys2Click()));
+    connect(IonoOpt,SIGNAL(currentIndexChanged(int)),this,SLOT(IonoOptChange()));
+    connect(TropOpt,SIGNAL(currentIndexChanged(int)),this,SLOT(TropOptChange()));
+    connect(DynamicModel,SIGNAL(currentIndexChanged(int)),this,SLOT(DynamicModelChange()));
+    connect(SatEphem,SIGNAL(currentIndexChanged(int)),this,SLOT(SatEphemChange()));
+    connect(RovAnt,SIGNAL(currentIndexChanged(int)),this,SLOT(RovAntClick()));
+    connect(RefAnt,SIGNAL(currentIndexChanged(int)),this,SLOT(RefAntClick()));
+    connect(BtnDCBFile,SIGNAL(clicked(bool)),this,SLOT(BtnDCBFileClick()));
+    connect(BtnDCBView,SIGNAL(clicked(bool)),this,SLOT(BtnDCBViewClick()));
+    connect(BtnHelp,SIGNAL(clicked(bool)),this,SLOT(BtnHelpClick()));
+    connect(BtnBLQFile,SIGNAL(clicked(bool)),this,SLOT(BtnBLQFileClick()));
+    connect(BtnBLQFileView,SIGNAL(clicked(bool)),this,SLOT(BtnBLQFileViewClick()));
+    connect(BtnEOPFile,SIGNAL(clicked(bool)),this,SLOT(BtnEOPFileClick()));
+    connect(BtnEOPView,SIGNAL(clicked(bool)),this,SLOT(BtnEOPViewClick()));
+    connect(BtnExtOpt,SIGNAL(clicked(bool)),this,SLOT(BtnExtOptClick()));
+    connect(BtnMask,SIGNAL(clicked(bool)),this,SLOT(BtnMaskClick()));
 
-    if (nglo <= 0) NavSys2->setEnabled(false);
-    if (ngal <= 0) NavSys3->setEnabled(false);
-    if (nqzs <= 0) NavSys4->setEnabled(false);
-    if (ncmp <= 0) NavSys6->setEnabled(false);
-    if (nirn <= 0) NavSys7->setEnabled(false);
+    if (nglo<=0) NavSys2->setEnabled(false);
+    if (ngal<=0) NavSys3->setEnabled(false);
+    if (nqzs<=0) NavSys4->setEnabled(false);
+    if (ncmp<=0) NavSys6->setEnabled(false);
+    if (nirn<=0) NavSys7->setEnabled(false);
 
-    UpdateEnable();
+    UpdateEnable();        
 }
 //---------------------------------------------------------------------------
 void OptDialog::showEvent(QShowEvent *event)
@@ -119,199 +119,195 @@
 //---------------------------------------------------------------------------
 void OptDialog::BtnLoadClick()
 {
-    LoadOpt(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Load Options"), QString(), tr("Options File (*.conf);;All (*.*)"))));
+    LoadOpt(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Load Options"),QString(),tr("Options File (*.conf);;All (*.*)"))));
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnSaveClick()
 {
     QString file;
-
-    file = QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, tr("Save Options"), QString(), tr("Options File (*.conf);;All (*.*)")));
+    file=QDir::toNativeSeparators(QFileDialog::getSaveFileName(this,tr("Save Options"),QString(),tr("Options File (*.conf);;All (*.*)")));
     QFileInfo f(file);
-    if (f.suffix() == "") file = file + ".conf";
+    if (f.suffix()=="") file=file+".conf";
 	SaveOpt(file);
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnStaPosViewClick()
 {
-    if (StaPosFile->text() == "") return;
-    TextViewer *viewer = new TextViewer(this);
+    if (StaPosFile->text()=="") return;
+    TextViewer *viewer=new TextViewer(this);
     viewer->show();
     viewer->Read(StaPosFile->text());
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnStaPosFileClick()
 {
-    StaPosFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Station Position File"), QString(), tr("Position File (*.pos);;All (*.*)"))));
+    StaPosFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Station Postion File"),QString(),tr("Position File (*.pos);;All (*.*)"))));
 }
 //---------------------------------------------------------------------------
 void OptDialog::RovPosTypeChange()
 {
-    QLineEdit *edit[] = { RovPos1, RovPos2, RovPos3 };
+    QLineEdit *edit[]={RovPos1,RovPos2,RovPos3};
 	double pos[3];
 
-    GetPos(RovPosTypeP, edit, pos);
-    SetPos(RovPosType->currentIndex(), edit, pos);
-    RovPosTypeP = RovPosType->currentIndex();
+    GetPos(RovPosTypeP,edit,pos);
+    SetPos(RovPosType->currentIndex(),edit,pos);
+    RovPosTypeP=RovPosType->currentIndex();
 
     UpdateEnable();
 }
 //---------------------------------------------------------------------------
 void OptDialog::RefPosTypeChange()
 {
-    QLineEdit *edit[] = { RefPos1, RefPos2, RefPos3 };
+    QLineEdit *edit[]={RefPos1,RefPos2,RefPos3};
 	double pos[3];
 
-    GetPos(RefPosTypeP, edit, pos);
-    SetPos(RefPosType->currentIndex(), edit, pos);
-    RefPosTypeP = RefPosType->currentIndex();
+    GetPos(RefPosTypeP,edit,pos);
+    SetPos(RefPosType->currentIndex(),edit,pos);
+    RefPosTypeP=RefPosType->currentIndex();
 
     UpdateEnable();
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnRovPosClick()
 {
-    QLineEdit *edit[] = { RovPos1, RovPos2, RovPos3 };
-    double p[3], pos[3];
+    QLineEdit *edit[]={RovPos1,RovPos2,RovPos3};
+	double p[3],pos[3];
 
-    GetPos(RovPosType->currentIndex(), edit, p);
-    ecef2pos(p, pos);
+    GetPos(RovPosType->currentIndex(),edit,p);
+	ecef2pos(p,pos);
 
-    RefDialog *refDialog = new RefDialog(this);
-    refDialog->RovPos[0] = pos[0] * R2D;
-    refDialog->RovPos[1] = pos[1] * R2D;
-    refDialog->Pos[2] = pos[2];
-    refDialog->StaPosFile = StaPosFile->text();
-    refDialog->move(this->pos().x() + width() / 2 - refDialog->width() / 2,
-            this->pos().y() + height() / 2 - refDialog->height() / 2);
+    RefDialog *refDialog=new RefDialog(this);
+    refDialog->RovPos[0]=pos[0]*R2D;
+    refDialog->RovPos[1]=pos[1]*R2D;
+    refDialog->Pos[2]=pos[2];
+    refDialog->StaPosFile=StaPosFile->text();
+    refDialog->move(this->pos().x()+width()/2-refDialog->width()/2,
+                this->pos().y()+height()/2-refDialog->height()/2);
 
     refDialog->exec();
-    if (refDialog->result() != QDialog::Accepted) return;
+    if (refDialog->result()!=QDialog::Accepted) return;
 
-    pos[0] = refDialog->Pos[0] * D2R;
-    pos[1] = refDialog->Pos[1] * D2R;
-    pos[2] = refDialog->Pos[2];
+    pos[0]=refDialog->Pos[0]*D2R;
+    pos[1]=refDialog->Pos[1]*D2R;
+    pos[2]=refDialog->Pos[2];
 
-    pos2ecef(pos, p);
-    SetPos(RovPosType->currentIndex(), edit, p);
+    pos2ecef(pos,p);
+    SetPos(RovPosType->currentIndex(),edit,p);
 
     delete refDialog;
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnRefPosClick()
 {
-    QLineEdit *edit[] = { RefPos1, RefPos2, RefPos3 };
-    double p[3], pos[3];
+    QLineEdit *edit[]={RefPos1,RefPos2,RefPos3};
+	double p[3],pos[3];
 
-    GetPos(RefPosType->currentIndex(), edit, p);
-    ecef2pos(p, pos);
+    GetPos(RefPosType->currentIndex(),edit,p);
+	ecef2pos(p,pos);
 
-    RefDialog *refDialog = new RefDialog(this);
-    refDialog->RovPos[0] = pos[0] * R2D;
-    refDialog->RovPos[1] = pos[1] * R2D;
-    refDialog->RovPos[2] = pos[2];
-    refDialog->StaPosFile = StaPosFile->text();
-    refDialog->move(this->pos().x() + width() / 2 - refDialog->width() / 2,
-            this->pos().y() + height() / 2 - refDialog->height() / 2);
+    RefDialog *refDialog=new RefDialog(this);
+    refDialog->RovPos[0]=pos[0]*R2D;
+    refDialog->RovPos[1]=pos[1]*R2D;
+    refDialog->RovPos[2]=pos[2];
+    refDialog->StaPosFile=StaPosFile->text();
+    refDialog->move(this->pos().x()+width()/2-refDialog->width()/2,
+                this->pos().y()+height()/2-refDialog->height()/2);
 
     refDialog->exec();
-    if (refDialog->result() != QDialog::Accepted) return;
+    if (refDialog->result()!=QDialog::Accepted) return;
 
-    pos[0] = refDialog->Pos[0] * D2R;
-    pos[1] = refDialog->Pos[1] * D2R;
-    pos[2] = refDialog->Pos[2];
+    pos[0]=refDialog->Pos[0]*D2R;
+    pos[1]=refDialog->Pos[1]*D2R;
+    pos[2]=refDialog->Pos[2];
 
-    pos2ecef(pos, p);
-    SetPos(RefPosType->currentIndex(), edit, p);
+    pos2ecef(pos,p);
+    SetPos(RefPosType->currentIndex(),edit,p);
 
     delete refDialog;
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnSatPcvViewClick()
 {
-    if (SatPcvFile->text() == "") return;
+    if (SatPcvFile->text()=="") return;
 
-    TextViewer *viewer = new TextViewer(this);
+    TextViewer *viewer=new TextViewer(this);
     viewer->show();
     viewer->Read(SatPcvFile->text());
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnSatPcvFileClick()
 {
-    SatPcvFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Satellite Antenna PCV File"), QString(), tr("PCV File (*.pcv *.atx);;All (*.*)"))));
+    SatPcvFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Satellite Antenna PCV File"),QString(),tr("PCV File (*.pcv *.atx);;All (*.*)"))));
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnAntPcvViewClick()
 {
-    if (AntPcvFile->text() == "") return;
+    if (AntPcvFile->text()=="") return;
 
-    TextViewer *viewer = new TextViewer(this);
+    TextViewer *viewer=new TextViewer(this);
     viewer->show();
     viewer->Read(AntPcvFile->text());
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnAntPcvFileClick()
 {
-    AntPcvFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Receiver Antenna PCV File"), QString(), tr("APCV File (*.pcv *.atx);;All (*.*)"))));
+    AntPcvFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Receiver Antenna PCV File"),QString(),tr("APCV File (*.pcv *.atx);;All (*.*)"))));
     ReadAntList();
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnGeoidDataFileClick()
 {
-    GeoidDataFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Geoid Data File"), QString(), tr("All (*.*)"))));
+    GeoidDataFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Geoid Data File"),QString(),tr("All (*.*)"))));
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnDCBFileClick()
 {
-    DCBFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("DCB Data File"), QString(), tr("DCB Data File (*.dcb *.DCB);;All (*.*)"))));
+    DCBFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("DCB Data File"),QString(),tr("DCB Data File (*.dcb *.DCB);;All (*.*)"))));
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnDCBViewClick()
 {
-    QString DCBFile_Text = DCBFile->text();
-
-    if (DCBFile->text() == "") return;
+    QString DCBFile_Text=DCBFile->text();
+    if (DCBFile->text()=="") return;
 
-    TextViewer *viewer = new TextViewer(this);
+    TextViewer *viewer=new TextViewer(this);
     viewer->show();
 	viewer->Read(DCBFile_Text);
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnEOPFileClick()
 {
-    EOPFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("EOP Date File"), QString(), tr("EOP Data File (*.eop *.erp);;All (*.*)"))));
+    EOPFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("EOP Date File"),QString(),tr("EOP Data File (*.eop *.erp);;All (*.*)"))));
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnEOPViewClick()
 {
-    QString EOPFile_Text = EOPFile->text();
-
-    if (EOPFile->text() == "") return;
+    QString EOPFile_Text=EOPFile->text();
+    if (EOPFile->text()=="") return;
 
-    TextViewer *viewer = new TextViewer(this);
+    TextViewer *viewer=new TextViewer(this);
     viewer->show();
 	viewer->Read(EOPFile_Text);
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnBLQFileClick()
 {
-    BLQFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Ocean Tide Loading BLQ File"), QString(), tr("OTL BLQ File (*.blq);;All (*.*)"))));
+    BLQFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Ocean Tide Loading BLQ File"),QString(),tr("OTL BLQ File (*.blq);;All (*.*)"))));
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnBLQFileViewClick()
 {
-    QString BLQFile_Text = BLQFile->text();
-
-    if (BLQFile->text() == "") return;
+    QString BLQFile_Text=BLQFile->text();
+    if (BLQFile->text()=="") return;
 
-    TextViewer *viewer = new TextViewer(this);
+    TextViewer *viewer=new TextViewer(this);
     viewer->show();
 	viewer->Read(BLQFile_Text);
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnIonoFileClick()
 {
-    IonoFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Ionosphere DataFile"), QString(), tr("Ionosphere Data File (*.*i,*stec);;All (*.*)"))));
+    IonoFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Ionosphere DataFile"),QString(),tr("Ionosphere Data File (*.*i,*stec);;All (*.*)"))));
 }
 //---------------------------------------------------------------------------
 void OptDialog::FreqChange()
@@ -416,696 +412,686 @@
 //---------------------------------------------------------------------------
 void OptDialog::GetOpt(void)
 {
-    QLineEdit *editu[] = { RovPos1, RovPos2, RovPos3 };
-    QLineEdit *editr[] = { RefPos1, RefPos2, RefPos3 };
-
-    PosMode->setCurrentIndex(mainForm->PosMode);
-    Freq->setCurrentIndex(mainForm->Freq);
-    Solution->setCurrentIndex(mainForm->Solution);
-    ElMask->setCurrentText(QString::number(mainForm->ElMask, 'f', 0));
-    SnrMask = mainForm->SnrMask;
-    DynamicModel->setCurrentIndex(mainForm->DynamicModel);
-    TideCorr->setCurrentIndex(mainForm->TideCorr);
-    IonoOpt->setCurrentIndex(mainForm->IonoOpt);
-    TropOpt->setCurrentIndex(mainForm->TropOpt);
-    SatEphem->setCurrentIndex(mainForm->SatEphem);
-    ExSats->setText(mainForm->ExSats);
-    NavSys1->setChecked(mainForm->NavSys & SYS_GPS);
-    NavSys2->setChecked(mainForm->NavSys & SYS_GLO);
-    NavSys3->setChecked(mainForm->NavSys & SYS_GAL);
-    NavSys4->setChecked(mainForm->NavSys & SYS_QZS);
-    NavSys5->setChecked(mainForm->NavSys & SYS_SBS);
-    NavSys6->setChecked(mainForm->NavSys & SYS_CMP);
-    NavSys7->setChecked(mainForm->NavSys & SYS_IRN);
-    PosOpt1->setChecked(mainForm->PosOpt[0]);
-    PosOpt2->setChecked(mainForm->PosOpt[1]);
-    PosOpt3->setChecked(mainForm->PosOpt[2]);
-    PosOpt4->setChecked(mainForm->PosOpt[3]);
-    PosOpt5->setChecked(mainForm->PosOpt[4]);
-    PosOpt6->setChecked(mainForm->PosOpt[5]);
-//	MapFunc->setCurrentIndex(mainForm->MapFunc);
+    QLineEdit *editu[]={RovPos1,RovPos2,RovPos3};
+    QLineEdit *editr[]={RefPos1,RefPos2,RefPos3};
 
-    AmbRes->setCurrentIndex(mainForm->AmbRes);
-    GloAmbRes->setCurrentIndex(mainForm->GloAmbRes);
-    BdsAmbRes->setCurrentIndex(mainForm->BdsAmbRes);
-    ValidThresAR->setValue(mainForm->ValidThresAR);
-    ThresAR2->setValue(mainForm->ThresAR2);
-    ThresAR3->setValue(mainForm->ThresAR3);
-    OutCntResetAmb->setValue(mainForm->OutCntResetAmb);
-    FixCntHoldAmb->setValue(mainForm->FixCntHoldAmb);
-    LockCntFixAmb->setValue(mainForm->LockCntFixAmb);
-    ElMaskAR->setValue(mainForm->ElMaskAR);
-    ElMaskHold->setValue(mainForm->ElMaskHold);
-    MaxAgeDiff->setValue(mainForm->MaxAgeDiff);
-    RejectGdop->setValue(mainForm->RejectGdop);
-    RejectThres->setValue(mainForm->RejectThres);
-    SlipThres->setValue(mainForm->SlipThres);
-    ARIter->setValue(mainForm->ARIter);
-    NumIter->setValue(mainForm->NumIter);
-    BaselineLen->setValue(mainForm->BaseLine[0]);
-    BaselineSig->setValue(mainForm->BaseLine[1]);
+    PosMode		 ->setCurrentIndex(mainForm->PosMode);
+    Freq		 ->setCurrentIndex(mainForm->Freq);
+    Solution	 ->setCurrentIndex(mainForm->Solution);
+    ElMask		 ->setCurrentText(QString::number(mainForm->ElMask,'f',0));
+    SnrMask						=mainForm->SnrMask;
+    DynamicModel ->setCurrentIndex(mainForm->DynamicModel);
+    TideCorr	 ->setCurrentIndex(mainForm->TideCorr);
+    IonoOpt		 ->setCurrentIndex(mainForm->IonoOpt);
+    TropOpt		 ->setCurrentIndex(mainForm->TropOpt);
+    SatEphem	 ->setCurrentIndex(mainForm->SatEphem);
+    ExSats	     ->setText(mainForm->ExSats);
+    NavSys1	     ->setChecked(mainForm->NavSys&SYS_GPS);
+    NavSys2	     ->setChecked(mainForm->NavSys&SYS_GLO);
+    NavSys3	     ->setChecked(mainForm->NavSys&SYS_GAL);
+    NavSys4	     ->setChecked(mainForm->NavSys&SYS_QZS);
+    NavSys5	     ->setChecked(mainForm->NavSys&SYS_SBS);
+    NavSys6	     ->setChecked(mainForm->NavSys&SYS_CMP);
+    NavSys7	     ->setChecked(mainForm->NavSys&SYS_IRN);
+    PosOpt1	     ->setChecked(mainForm->PosOpt[0]);
+    PosOpt2	     ->setChecked(mainForm->PosOpt[1]);
+    PosOpt3	     ->setChecked(mainForm->PosOpt[2]);
+    PosOpt4	     ->setChecked(mainForm->PosOpt[3]);
+    PosOpt5	     ->setChecked(mainForm->PosOpt[4]);
+    PosOpt6	     ->setChecked(mainForm->PosOpt[5]);
+//	MapFunc	     ->setCurrentIndex(mainForm->MapFunc);
+	
+    AmbRes		 ->setCurrentIndex(mainForm->AmbRes);
+    GloAmbRes	 ->setCurrentIndex(mainForm->GloAmbRes);
+    BdsAmbRes	 ->setCurrentIndex(mainForm->BdsAmbRes);
+    ValidThresAR ->setText(QString::number(mainForm->ValidThresAR,'g',3));
+    ThresAR2     ->setText(QString::number(mainForm->ThresAR2,'g',8));
+    ThresAR3     ->setText(QString::number(mainForm->ThresAR3,'g',3));
+    OutCntResetAmb->setText(QString::number(mainForm->OutCntResetAmb));
+    FixCntHoldAmb->setText(QString::number(mainForm->FixCntHoldAmb));
+    LockCntFixAmb->setText(QString::number(mainForm->LockCntFixAmb));
+    ElMaskAR	 ->setText(QString::number(mainForm->ElMaskAR,'f',0));
+    ElMaskHold	 ->setText(QString::number(mainForm->ElMaskHold,'f',0));
+    MaxAgeDiff	 ->setText(QString::number(mainForm->MaxAgeDiff,'f',1));
+    RejectGdop   ->setText(QString::number(mainForm->RejectGdop,'f',1));
+    RejectThres  ->setText(QString::number(mainForm->RejectThres,'f',1));
+    SlipThres	 ->setText(QString::number(mainForm->SlipThres,'f',3));
+    ARIter		 ->setText(QString::number(mainForm->ARIter));
+    NumIter		 ->setText(QString::number(mainForm->NumIter));
+    BaselineLen	 ->setText(QString::number(mainForm->BaseLine[0],'f',3));
+    BaselineSig	 ->setText(QString::number(mainForm->BaseLine[1],'f',3));
     BaselineConst->setChecked(mainForm->BaseLineConst);
-
-    SolFormat->setCurrentIndex(mainForm->SolFormat);
-    TimeFormat->setCurrentIndex(mainForm->TimeFormat);
-    TimeDecimal->setValue(mainForm->TimeDecimal);
-    LatLonFormat->setCurrentIndex(mainForm->LatLonFormat);
-    FieldSep->setText(mainForm->FieldSep);
-    OutputHead->setCurrentIndex(mainForm->OutputHead);
-    OutputOpt->setCurrentIndex(mainForm->OutputOpt);
-    OutputSingle->setCurrentIndex(mainForm->OutputSingle);
-    MaxSolStd->setValue(mainForm->MaxSolStd);
-    OutputDatum->setCurrentIndex(mainForm->OutputDatum);
-    OutputHeight->setCurrentIndex(mainForm->OutputHeight);
-    OutputGeoid->setCurrentIndex(mainForm->OutputGeoid);
-    SolStatic->setCurrentIndex(mainForm->SolStatic);
-    DebugTrace->setCurrentIndex(mainForm->DebugTrace);
-    DebugStatus->setCurrentIndex(mainForm->DebugStatus);
-
-    MeasErrR1->setValue(mainForm->MeasErrR1);
-    MeasErrR2->setValue(mainForm->MeasErrR2);
-    MeasErr2->setValue(mainForm->MeasErr2);
-    MeasErr3->setValue(mainForm->MeasErr3);
-    MeasErr4->setValue(mainForm->MeasErr4);
-    MeasErr5->setValue(mainForm->MeasErr5);
-    SatClkStab->setText(QString::number(mainForm->SatClkStab, 'E', 2));
-    PrNoise1->setText(QString::number(mainForm->PrNoise1, 'E', 2));
-    PrNoise2->setText(QString::number(mainForm->PrNoise2, 'E', 2));
-    PrNoise3->setText(QString::number(mainForm->PrNoise3, 'E', 2));
-    PrNoise4->setText(QString::number(mainForm->PrNoise4, 'E', 2));
-    PrNoise5->setText(QString::number(mainForm->PrNoise5, 'E', 2));
-
-    RovAntPcv->setChecked(mainForm->RovAntPcv);
-    RefAntPcv->setChecked(mainForm->RefAntPcv);
-    RovAntE->setValue(mainForm->RovAntE);
-    RovAntN->setValue(mainForm->RovAntN);
-    RovAntU->setValue(mainForm->RovAntU);
-    RefAntE->setValue(mainForm->RefAntE);
-    RefAntN->setValue(mainForm->RefAntN);
-    RefAntU->setValue(mainForm->RefAntU);
-    AntPcvFile->setText(mainForm->AntPcvFile);
-
-    RnxOpts1->setText(mainForm->RnxOpts1);
-    RnxOpts2->setText(mainForm->RnxOpts2);
-    PPPOpts->setText(mainForm->PPPOpts);
-
-    IntpRefObs->setCurrentIndex(mainForm->IntpRefObs);
-    SbasSat->setText(QString::number(mainForm->SbasSat));
-    SatPcvFile->setText(mainForm->SatPcvFile);
-    StaPosFile->setText(mainForm->StaPosFile);
+	
+    SolFormat	 ->setCurrentIndex(mainForm->SolFormat);
+    TimeFormat	 ->setCurrentIndex(mainForm->TimeFormat);
+    TimeDecimal	 ->setText(QString::number(mainForm->TimeDecimal));
+    LatLonFormat ->setCurrentIndex(mainForm->LatLonFormat);
+    FieldSep	 ->setText(mainForm->FieldSep);
+    OutputHead	 ->setCurrentIndex(mainForm->OutputHead);
+    OutputOpt	 ->setCurrentIndex(mainForm->OutputOpt);
+    OutputDatum  ->setCurrentIndex(mainForm->OutputDatum);
+    OutputHeight ->setCurrentIndex(mainForm->OutputHeight);
+    OutputGeoid  ->setCurrentIndex(mainForm->OutputGeoid);
+    SolStatic    ->setCurrentIndex(mainForm->SolStatic);
+    DebugTrace	 ->setCurrentIndex(mainForm->DebugTrace);
+    DebugStatus	 ->setCurrentIndex(mainForm->DebugStatus);
+	
+    MeasErrR1	 ->setText(QString::number(mainForm->MeasErrR1,'f',1));
+    MeasErrR2	 ->setText(QString::number(mainForm->MeasErrR2,'f',1));
+    MeasErr2	 ->setText(QString::number(mainForm->MeasErr2,'f',3));
+    MeasErr3	 ->setText(QString::number(mainForm->MeasErr3,'f',3));
+    MeasErr4	 ->setText(QString::number(mainForm->MeasErr4,'f',3));
+    MeasErr5	 ->setText(QString::number(mainForm->MeasErr5,'f',3));
+    SatClkStab	 ->setText(QString::number(mainForm->SatClkStab,'E',2));
+    PrNoise1	 ->setText(QString::number(mainForm->PrNoise1,'E',2));
+    PrNoise2	 ->setText(QString::number(mainForm->PrNoise2,'E',2));
+    PrNoise3	 ->setText(QString::number(mainForm->PrNoise3,'E',2));
+    PrNoise4	 ->setText(QString::number(mainForm->PrNoise4,'E',2));
+    PrNoise5	 ->setText(QString::number(mainForm->PrNoise5,'E',2));
+	
+    RovAntPcv	 ->setChecked(mainForm->RovAntPcv);
+    RefAntPcv	 ->setChecked(mainForm->RefAntPcv);
+    RovAntE		 ->setText(QString::number(mainForm->RovAntE,'f',4));
+    RovAntN		 ->setText(QString::number(mainForm->RovAntN,'f',4));
+    RovAntU		 ->setText(QString::number(mainForm->RovAntU,'f',4));
+    RefAntE		 ->setText(QString::number(mainForm->RefAntE,'f',4));
+    RefAntN		 ->setText(QString::number(mainForm->RefAntN,'f',4));
+    RefAntU		 ->setText(QString::number(mainForm->RefAntU,'f',4));
+    AntPcvFile	 ->setText(mainForm->AntPcvFile);
+	
+    RnxOpts1	 ->setText(mainForm->RnxOpts1);
+    RnxOpts2	 ->setText(mainForm->RnxOpts2);
+    PPPOpts		 ->setText(mainForm->PPPOpts);
+	
+    IntpRefObs	 ->setCurrentIndex(mainForm->IntpRefObs);
+    SbasSat		 ->setText(QString::number(mainForm->SbasSat));
+    SatPcvFile   ->setText(mainForm->SatPcvFile);
+    StaPosFile	 ->setText(mainForm->StaPosFile);
     GeoidDataFile->setText(mainForm->GeoidDataFile);
-    EOPFile->setText(mainForm->EOPFile);
-    DCBFile->setText(mainForm->DCBFile);
-    BLQFile->setText(mainForm->BLQFile);
-    IonoFile->setText(mainForm->IonoFile);
-    RovPosType->setCurrentIndex(mainForm->RovPosType);
-    RefPosType->setCurrentIndex(mainForm->RefPosType);
-    RovPosTypeP = RovPosType->currentIndex();
-    RefPosTypeP = RefPosType->currentIndex();
-    SetPos(RovPosType->currentIndex(), editu, mainForm->RovPos);
-    SetPos(RefPosType->currentIndex(), editr, mainForm->RefPos);
+    EOPFile		 ->setText(mainForm->EOPFile);
+    DCBFile		 ->setText(mainForm->DCBFile);
+    BLQFile		 ->setText(mainForm->BLQFile);
+    IonoFile	 ->setText(mainForm->IonoFile);
+    RovPosType	 ->setCurrentIndex(mainForm->RovPosType);
+    RefPosType	 ->setCurrentIndex(mainForm->RefPosType);
+    RovPosTypeP					=RovPosType->currentIndex();
+    RefPosTypeP					=RefPosType->currentIndex();
+    SetPos(RovPosType->currentIndex(),editu,mainForm->RovPos);
+    SetPos(RefPosType->currentIndex(),editr,mainForm->RefPos);
 	ReadAntList();
+	
+    RovAnt		 ->setCurrentText(mainForm->RovAnt);
+    RefAnt		 ->setCurrentText(mainForm->RefAnt);
 
-    RovAnt->setCurrentText(mainForm->RovAnt);
-    RefAnt->setCurrentText(mainForm->RefAnt);
-
-    RovList->setPlainText(mainForm->RovList);
-    BaseList->setPlainText(mainForm->BaseList);
-
-    ExtErr = mainForm->ExtErr;
-
+    RovList		 ->setPlainText(mainForm->RovList);
+    BaseList	 ->setPlainText(mainForm->BaseList);
+	
+    ExtErr						=mainForm->ExtErr;
+	
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
 void OptDialog::SetOpt(void)
 {
-    QLineEdit *editu[] = { RovPos1, RovPos2, RovPos3 };
-    QLineEdit *editr[] = { RefPos1, RefPos2, RefPos3 };
-
-    mainForm->PosMode = PosMode->currentIndex();
-    mainForm->Freq = Freq->currentIndex();
-    mainForm->Solution = Solution->currentIndex();
-    mainForm->ElMask = ElMask->currentText().toDouble();
-    mainForm->SnrMask = SnrMask;
-    mainForm->DynamicModel = DynamicModel->currentIndex();
-    mainForm->TideCorr = TideCorr->currentIndex();
-    mainForm->IonoOpt = IonoOpt->currentIndex();
-    mainForm->TropOpt = TropOpt->currentIndex();
-    mainForm->SatEphem = SatEphem->currentIndex();
-    mainForm->ExSats = ExSats->text();
-    mainForm->NavSys = 0;
-    if (NavSys1->isChecked()) mainForm->NavSys |= SYS_GPS;
-    if (NavSys2->isChecked()) mainForm->NavSys |= SYS_GLO;
-    if (NavSys3->isChecked()) mainForm->NavSys |= SYS_GAL;
-    if (NavSys4->isChecked()) mainForm->NavSys |= SYS_QZS;
-    if (NavSys5->isChecked()) mainForm->NavSys |= SYS_SBS;
-    if (NavSys6->isChecked()) mainForm->NavSys |= SYS_CMP;
-    if (NavSys7->isChecked()) mainForm->NavSys |= SYS_IRN;
-    mainForm->PosOpt[0] = PosOpt1->isChecked();
-    mainForm->PosOpt[1] = PosOpt2->isChecked();
-    mainForm->PosOpt[2] = PosOpt3->isChecked();
-    mainForm->PosOpt[3] = PosOpt4->isChecked();
-    mainForm->PosOpt[4] = PosOpt5->isChecked();
-    mainForm->PosOpt[5] = PosOpt6->isChecked();
-//	mainForm->MapFunc=MapFunc->currentIndex();
-
-    mainForm->AmbRes = AmbRes->currentIndex();
-    mainForm->GloAmbRes = GloAmbRes->currentIndex();
-    mainForm->BdsAmbRes = BdsAmbRes->currentIndex();
-    mainForm->ValidThresAR = ValidThresAR->value();
-    mainForm->ThresAR2 = ThresAR2->value();
-    mainForm->ThresAR3 = ThresAR3->value();
-    mainForm->OutCntResetAmb = OutCntResetAmb->value();
-    mainForm->FixCntHoldAmb = FixCntHoldAmb->value();
-    mainForm->OutCntResetAmb = OutCntResetAmb->value();
-    mainForm->LockCntFixAmb = LockCntFixAmb->value();
-    mainForm->ElMaskAR = ElMaskAR->value();
-    mainForm->ElMaskHold = ElMaskHold->value();
-    mainForm->MaxAgeDiff = MaxAgeDiff->value();
-    mainForm->RejectGdop = RejectGdop->value();
-    mainForm->RejectThres = RejectThres->value();
-    mainForm->SlipThres = SlipThres->value();
-    mainForm->ARIter = ARIter->value();
-    mainForm->NumIter = NumIter->value();
-    mainForm->BaseLine[0] = BaselineLen->value();
-    mainForm->BaseLine[1] = BaselineSig->value();
-    mainForm->BaseLineConst = BaselineConst->isChecked();
-
-    mainForm->SolFormat = SolFormat->currentIndex();
-    mainForm->TimeFormat = TimeFormat->currentIndex();
-    mainForm->TimeDecimal = TimeDecimal->value();
-    mainForm->LatLonFormat = LatLonFormat->currentIndex();
-    mainForm->FieldSep = FieldSep->text();
-    mainForm->OutputHead = OutputHead->currentIndex();
-    mainForm->OutputOpt = OutputOpt->currentIndex();
-    mainForm->OutputSingle = OutputSingle->currentIndex();
-    mainForm->MaxSolStd = MaxSolStd->value();
-    mainForm->OutputDatum = OutputDatum->currentIndex();
-    mainForm->OutputHeight = OutputHeight->currentIndex();
-    mainForm->OutputGeoid = OutputGeoid->currentIndex();
-    mainForm->SolStatic = SolStatic->currentIndex();
-    mainForm->DebugTrace = DebugTrace->currentIndex();
-    mainForm->DebugStatus = DebugStatus->currentIndex();
-
-    mainForm->MeasErrR1 = MeasErrR1->value();
-    mainForm->MeasErrR2 = MeasErrR2->value();
-    mainForm->MeasErr2 = MeasErr2->value();
-    mainForm->MeasErr3 = MeasErr3->value();
-    mainForm->MeasErr4 = MeasErr4->value();
-    mainForm->MeasErr5 = MeasErr5->value();
-    mainForm->SatClkStab = SatClkStab->text().toDouble();
-    mainForm->PrNoise1 = PrNoise1->text().toDouble();
-    mainForm->PrNoise2 = PrNoise2->text().toDouble();
-    mainForm->PrNoise3 = PrNoise3->text().toDouble();
-    mainForm->PrNoise4 = PrNoise4->text().toDouble();
-    mainForm->PrNoise5 = PrNoise5->text().toDouble();
-
-    mainForm->RovAntPcv = RovAntPcv->isChecked();
-    mainForm->RefAntPcv = RefAntPcv->isChecked();
-    mainForm->RovAnt = RovAnt->currentText();
-    mainForm->RefAnt = RefAnt->currentText();
-    mainForm->RovAntE = RovAntE->value();
-    mainForm->RovAntN = RovAntN->value();
-    mainForm->RovAntU = RovAntU->value();
-    mainForm->RefAntE = RefAntE->value();
-    mainForm->RefAntN = RefAntN->value();
-    mainForm->RefAntU = RefAntU->value();
-
-    mainForm->RnxOpts1 = RnxOpts1->text();
-    mainForm->RnxOpts2 = RnxOpts2->text();
-    mainForm->PPPOpts = PPPOpts->text();
-
-    mainForm->IntpRefObs = IntpRefObs->currentIndex();
-    mainForm->SbasSat = SbasSat->text().toInt();
-    mainForm->AntPcvFile = AntPcvFile->text();
-    mainForm->SatPcvFile = SatPcvFile->text();
-    mainForm->StaPosFile = StaPosFile->text();
-    mainForm->GeoidDataFile = GeoidDataFile->text();
-    mainForm->EOPFile = EOPFile->text();
-    mainForm->DCBFile = DCBFile->text();
-    mainForm->BLQFile = BLQFile->text();
-    mainForm->IonoFile = IonoFile->text();
-    mainForm->RovPosType = RovPosType->currentIndex();
-    mainForm->RefPosType = RefPosType->currentIndex();
-    GetPos(RovPosType->currentIndex(), editu, mainForm->RovPos);
-    GetPos(RefPosType->currentIndex(), editr, mainForm->RefPos);
-
-    mainForm->RovList = RovList->toPlainText();
-    mainForm->BaseList = BaseList->toPlainText();
-
-    mainForm->ExtErr = ExtErr;
-
+    QLineEdit *editu[]={RovPos1,RovPos2,RovPos3};
+    QLineEdit *editr[]={RefPos1,RefPos2,RefPos3};
+	
+    mainForm->PosMode		=PosMode	->currentIndex();
+    mainForm->Freq			=Freq		->currentIndex();
+    mainForm->Solution		=Solution   ->currentIndex();
+    mainForm->ElMask		=ElMask	->currentText().toDouble();
+    mainForm->SnrMask		=SnrMask;
+    mainForm->DynamicModel	=DynamicModel->currentIndex();
+    mainForm->TideCorr		=TideCorr	->currentIndex();
+    mainForm->IonoOpt	  	=IonoOpt	->currentIndex();
+    mainForm->TropOpt	  	=TropOpt	->currentIndex();
+    mainForm->SatEphem	  	=SatEphem	->currentIndex();
+    mainForm->ExSats	  	=ExSats		->text();
+    mainForm->NavSys	  	=0;
+    if (NavSys1->isChecked()) mainForm->NavSys|=SYS_GPS;
+    if (NavSys2->isChecked()) mainForm->NavSys|=SYS_GLO;
+    if (NavSys3->isChecked()) mainForm->NavSys|=SYS_GAL;
+    if (NavSys4->isChecked()) mainForm->NavSys|=SYS_QZS;
+    if (NavSys5->isChecked()) mainForm->NavSys|=SYS_SBS;
+    if (NavSys6->isChecked()) mainForm->NavSys|=SYS_CMP;
+    if (NavSys7->isChecked()) mainForm->NavSys|=SYS_IRN;
+    mainForm->PosOpt[0]	  	=PosOpt1	->isChecked();
+    mainForm->PosOpt[1]	  	=PosOpt2	->isChecked();
+    mainForm->PosOpt[2]	  	=PosOpt3	->isChecked();
+    mainForm->PosOpt[3]	  	=PosOpt4	->isChecked();
+    mainForm->PosOpt[4]	  	=PosOpt5	->isChecked();
+    mainForm->PosOpt[5]	  	=PosOpt6	->isChecked();
+//	mainForm->MapFunc		=MapFunc	->ItemIndex;
+	
+    mainForm->AmbRes	  	=AmbRes		->currentIndex();
+    mainForm->GloAmbRes	  	=GloAmbRes	->currentIndex();
+    mainForm->BdsAmbRes	  	=BdsAmbRes	->currentIndex();
+    mainForm->ValidThresAR	=ValidThresAR->text().toDouble();
+    mainForm->ThresAR2		=ThresAR2->text().toDouble();
+    mainForm->ThresAR3		=ThresAR3->text().toDouble();
+    mainForm->OutCntResetAmb=OutCntResetAmb->text().toInt();
+    mainForm->FixCntHoldAmb =FixCntHoldAmb->text().toInt();
+    mainForm->OutCntResetAmb=OutCntResetAmb->text().toInt();
+    mainForm->LockCntFixAmb	=LockCntFixAmb->text().toInt();
+    mainForm->ElMaskAR	  	=ElMaskAR   ->text().toInt();
+    mainForm->ElMaskHold  	=ElMaskHold ->text().toInt();
+    mainForm->MaxAgeDiff  	=MaxAgeDiff ->text().toDouble();
+    mainForm->RejectGdop 	=RejectGdop ->text().toDouble();
+    mainForm->RejectThres 	=RejectThres->text().toDouble();
+    mainForm->SlipThres   	=SlipThres  ->text().toDouble();
+    mainForm->ARIter	  	=ARIter		  ->text().toInt();
+    mainForm->NumIter	  	=NumIter	  ->text().toInt();
+    mainForm->BaseLine[0]  	=BaselineLen->text().toDouble();
+    mainForm->BaseLine[1]  	=BaselineSig->text().toDouble();
+    mainForm->BaseLineConst	=BaselineConst->isChecked();
+	
+    mainForm->SolFormat   	=SolFormat  ->currentIndex();
+    mainForm->TimeFormat  	=TimeFormat ->currentIndex();
+    mainForm->TimeDecimal  	=TimeDecimal->text().toDouble();
+    mainForm->LatLonFormat	=LatLonFormat->currentIndex();
+    mainForm->FieldSep	  	=FieldSep   ->text();
+    mainForm->OutputHead  	=OutputHead ->currentIndex();
+    mainForm->OutputOpt   	=OutputOpt  ->currentIndex();
+    mainForm->OutputDatum 	=OutputDatum->currentIndex();
+    mainForm->OutputHeight	=OutputHeight->currentIndex();
+    mainForm->OutputGeoid 	=OutputGeoid->currentIndex();
+    mainForm->SolStatic	 	=SolStatic  ->currentIndex();
+    mainForm->DebugTrace  	=DebugTrace ->currentIndex();
+    mainForm->DebugStatus  	=DebugStatus->currentIndex();
+	
+    mainForm->MeasErrR1	  =MeasErrR1  ->text().toDouble();
+    mainForm->MeasErrR2	  =MeasErrR2  ->text().toDouble();
+    mainForm->MeasErr2	  =MeasErr2   ->text().toDouble();
+    mainForm->MeasErr3	  =MeasErr3   ->text().toDouble();
+    mainForm->MeasErr4	  =MeasErr4   ->text().toDouble();
+    mainForm->MeasErr5	  =MeasErr5   ->text().toDouble();
+    mainForm->SatClkStab  =SatClkStab ->text().toDouble();
+    mainForm->PrNoise1	  =PrNoise1   ->text().toDouble();
+    mainForm->PrNoise2	  =PrNoise2   ->text().toDouble();
+    mainForm->PrNoise3	  =PrNoise3   ->text().toDouble();
+    mainForm->PrNoise4	  =PrNoise4   ->text().toDouble();
+    mainForm->PrNoise5	  =PrNoise5   ->text().toDouble();
+	
+    mainForm->RovAntPcv   =RovAntPcv	->isChecked();
+    mainForm->RefAntPcv   =RefAntPcv	->isChecked();
+    mainForm->RovAnt	  =RovAnt		->currentText();
+    mainForm->RefAnt	  =RefAnt		->currentText();
+    mainForm->RovAntE	  =RovAntE	->text().toDouble();
+    mainForm->RovAntN	  =RovAntN	->text().toDouble();
+    mainForm->RovAntU	  =RovAntU	->text().toDouble();
+    mainForm->RefAntE	  =RefAntE	->text().toDouble();
+    mainForm->RefAntN	  =RefAntN	->text().toDouble();
+    mainForm->RefAntU	  =RefAntU	->text().toDouble();
+	
+    mainForm->RnxOpts1	  =RnxOpts1		->text();
+    mainForm->RnxOpts2	  =RnxOpts2		->text();
+    mainForm->PPPOpts	  =PPPOpts		->text();
+	
+    mainForm->IntpRefObs  =IntpRefObs	->currentIndex();
+    mainForm->SbasSat     =SbasSat		->text().toInt();
+    mainForm->AntPcvFile  =AntPcvFile	->text();
+    mainForm->SatPcvFile  =SatPcvFile	->text();
+    mainForm->StaPosFile  =StaPosFile	->text();
+    mainForm->GeoidDataFile=GeoidDataFile->text();
+    mainForm->EOPFile     =EOPFile		->text();
+    mainForm->DCBFile     =DCBFile		->text();
+    mainForm->BLQFile     =BLQFile		->text();
+    mainForm->IonoFile    =IonoFile		->text();
+    mainForm->RovPosType  =RovPosType	->currentIndex();
+    mainForm->RefPosType  =RefPosType	->currentIndex();
+    GetPos(RovPosType->currentIndex(),editu,mainForm->RovPos);
+    GetPos(RefPosType->currentIndex(),editr,mainForm->RefPos);
+	
+    mainForm->RovList	  =RovList		->toPlainText();
+    mainForm->BaseList	  =BaseList		->toPlainText();
+	
+    mainForm->ExtErr	  =ExtErr;
+	
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
 void OptDialog::LoadOpt(const QString &file)
 {
-    QLineEdit *editu[] = { RovPos1, RovPos2, RovPos3 };
-    QLineEdit *editr[] = { RefPos1, RefPos2, RefPos3 };
+    QLineEdit *editu[]={RovPos1,RovPos2,RovPos3};
+    QLineEdit *editr[]={RefPos1,RefPos2,RefPos3};
     QString buff;
     char id[32];
 	int sat;
-    prcopt_t prcopt = prcopt_default;
-    solopt_t solopt = solopt_default;
+	prcopt_t prcopt=prcopt_default;
+	solopt_t solopt=solopt_default;
     filopt_t filopt;
-
-    memset(&filopt, 0, sizeof(filopt_t));
+	
+    memset(&filopt,0,sizeof(filopt_t));
 
 	resetsysopts();
-    if (!loadopts(qPrintable(file), sysopts)) return;
-    getsysopts(&prcopt, &solopt, &filopt);
-
-    PosMode->setCurrentIndex(prcopt.mode);
-    Freq->setCurrentIndex(prcopt.nf > NFREQ - 1 ? NFREQ - 1 : prcopt.nf - 1);
-    Solution->setCurrentIndex(prcopt.soltype);
-    ElMask->setCurrentText(QString::number(prcopt.elmin * R2D, 'f', 0));
-    SnrMask = prcopt.snrmask;
-    DynamicModel->setCurrentIndex(prcopt.dynamics);
-    TideCorr->setCurrentIndex(prcopt.tidecorr);
-    IonoOpt->setCurrentIndex(prcopt.ionoopt);
-    TropOpt->setCurrentIndex(prcopt.tropopt);
-    SatEphem->setCurrentIndex(prcopt.sateph);
-    ExSats->setText("");
-    for (sat = 1; sat <= MAXSAT; sat++) {
-        if (!prcopt.exsats[sat - 1]) continue;
-        satno2id(sat, id);
-        buff += QString("%1%2%3").arg(buff.isEmpty() ? "" : " ").arg(prcopt.exsats[sat - 1] == 2 ? "+" : "").arg(id);
+    if (!loadopts(qPrintable(file),sysopts)) return;
+	getsysopts(&prcopt,&solopt,&filopt);
+	
+    PosMode		 ->setCurrentIndex(prcopt.mode);
+    Freq		 ->setCurrentIndex(prcopt.nf>NFREQ-1?NFREQ-1:prcopt.nf-1);
+    Solution	 ->setCurrentIndex(prcopt.soltype);
+    ElMask		 ->setCurrentText(QString::number(prcopt.elmin*R2D,'f',0));
+	SnrMask						=prcopt.snrmask;
+    DynamicModel ->setCurrentIndex(prcopt.dynamics);
+    TideCorr	 ->setCurrentIndex(prcopt.tidecorr);
+    IonoOpt		 ->setCurrentIndex(prcopt.ionoopt);
+    TropOpt		 ->setCurrentIndex(prcopt.tropopt);
+    SatEphem	 ->setCurrentIndex(prcopt.sateph);
+    ExSats	     ->setText("");
+    for (sat=1;sat<=MAXSAT;sat++) {
+		if (!prcopt.exsats[sat-1]) continue;
+		satno2id(sat,id);
+        buff+=QString("%1%2%3").arg(buff.isEmpty()?"":" ").arg(prcopt.exsats[sat-1]==2?"+":"").arg(id);
 	}
-    ExSats->setText(buff);
-    NavSys1->setChecked(prcopt.navsys & SYS_GPS);
-    NavSys2->setChecked(prcopt.navsys & SYS_GLO);
-    NavSys3->setChecked(prcopt.navsys & SYS_GAL);
-    NavSys4->setChecked(prcopt.navsys & SYS_QZS);
-    NavSys5->setChecked(prcopt.navsys & SYS_SBS);
-    NavSys6->setChecked(prcopt.navsys & SYS_CMP);
-    PosOpt1->setChecked(prcopt.posopt[0]);
-    PosOpt2->setChecked(prcopt.posopt[1]);
-    PosOpt3->setChecked(prcopt.posopt[2]);
-    PosOpt4->setChecked(prcopt.posopt[3]);
-    PosOpt5->setChecked(prcopt.posopt[4]);
-    PosOpt6->setChecked(prcopt.posopt[5]);
-//	MapFunc->setCurrentIndex(prcopt.mapfunc);
-
-    AmbRes->setCurrentIndex(prcopt.modear);
-    GloAmbRes->setCurrentIndex(prcopt.glomodear);
-    BdsAmbRes->setCurrentIndex(prcopt.bdsmodear);
-    ValidThresAR->setValue(prcopt.thresar[0]);
-    ThresAR2->setValue(prcopt.thresar[1]);
-    ThresAR3->setValue(prcopt.thresar[2]);
-    OutCntResetAmb->setValue(prcopt.maxout);
-    FixCntHoldAmb->setValue(prcopt.minfix);
-    LockCntFixAmb->setValue(prcopt.minlock);
-    ElMaskAR->setValue(prcopt.elmaskar * R2D);
-    ElMaskHold->setValue(prcopt.elmaskhold * R2D);
-    MaxAgeDiff->setValue(prcopt.maxtdiff);
-    RejectGdop->setValue(prcopt.maxgdop);
-    RejectThres->setValue(prcopt.maxinno);
-    SlipThres->setValue(prcopt.thresslip);
-    ARIter->setValue(prcopt.armaxiter);
-    NumIter->setValue(prcopt.niter);
-    BaselineLen->setValue(prcopt.baseline[0]);
-    BaselineSig->setValue(prcopt.baseline[1]);
-    BaselineConst->setChecked(prcopt.baseline[0] > 0.0);
-
-    SolFormat->setCurrentIndex(solopt.posf);
-    TimeFormat->setCurrentIndex(solopt.timef == 0 ? 0 : solopt.times + 1);
-    TimeDecimal->setValue(solopt.timeu);
-    LatLonFormat->setCurrentIndex(solopt.degf);
-    FieldSep->setText(solopt.sep);
-    OutputHead->setCurrentIndex(solopt.outhead);
-    OutputOpt->setCurrentIndex(solopt.outopt);
-    OutputSingle->setCurrentIndex(prcopt.outsingle);
-    MaxSolStd->setValue(solopt.maxsolstd);
-    OutputDatum->setCurrentIndex(solopt.datum);
-    OutputHeight->setCurrentIndex(solopt.height);
-    OutputGeoid->setCurrentIndex(solopt.geoid);
-    SolStatic->setCurrentIndex(solopt.solstatic);
-    NmeaIntv1->setValue(solopt.nmeaintv[0]);
-    NmeaIntv2->setValue(solopt.nmeaintv[1]);
-    DebugTrace->setCurrentIndex(solopt.trace);
-    DebugStatus->setCurrentIndex(solopt.sstat);
-
-    MeasErrR1->setValue(prcopt.eratio[0]);
-    MeasErrR2->setValue(prcopt.eratio[1]);
-    MeasErr2->setValue(prcopt.err[1]);
-    MeasErr3->setValue(prcopt.err[2]);
-    MeasErr4->setValue(prcopt.err[3]);
-    MeasErr5->setValue(prcopt.err[4]);
-    SatClkStab->setText(QString::number(prcopt.sclkstab, 'E', 2));
-    PrNoise1->setText(QString::number(prcopt.prn[0], 'E', 2));
-    PrNoise2->setText(QString::number(prcopt.prn[1], 'E', 2));
-    PrNoise3->setText(QString::number(prcopt.prn[2], 'E', 2));
-    PrNoise4->setText(QString::number(prcopt.prn[3], 'E', 2));
-    PrNoise5->setText(QString::number(prcopt.prn[4], 'E', 2));
-
-    RovAntPcv->setChecked(*prcopt.anttype[0]);
-    RefAntPcv->setChecked(*prcopt.anttype[1]);
-    RovAnt->setCurrentText(prcopt.anttype[0]);
-    RefAnt->setCurrentText(prcopt.anttype[1]);
-    RovAntE->setValue(prcopt.antdel[0][0]);
-    RovAntN->setValue(prcopt.antdel[0][1]);
-    RovAntU->setValue(prcopt.antdel[0][2]);
-    RefAntE->setValue(prcopt.antdel[1][0]);
-    RefAntN->setValue(prcopt.antdel[1][1]);
-    RefAntU->setValue(prcopt.antdel[1][2]);
-
-    RnxOpts1->setText(prcopt.rnxopt[0]);
-    RnxOpts2->setText(prcopt.rnxopt[1]);
-    PPPOpts->setText(prcopt.pppopt);
-
-    IntpRefObs->setCurrentIndex(prcopt.intpref);
-    SbasSat->setText(QString::number(prcopt.sbassatsel));
-    RovPosType->setCurrentIndex(prcopt.rovpos == 0 ? 0 : prcopt.rovpos + 2);
-    RefPosType->setCurrentIndex(prcopt.refpos == 0 ? 0 : prcopt.refpos + 2);
-    RovPosTypeP = RovPosType->currentIndex();
-    RefPosTypeP = RefPosType->currentIndex();
-    SetPos(RovPosType->currentIndex(), editu, prcopt.ru);
-    SetPos(RefPosType->currentIndex(), editr, prcopt.rb);
-
-    SatPcvFile->setText(filopt.satantp);
-    AntPcvFile->setText(filopt.rcvantp);
-    StaPosFile->setText(filopt.stapos);
+    ExSats		 ->setText(buff);
+    NavSys1	     ->setChecked(prcopt.navsys&SYS_GPS);
+    NavSys2	     ->setChecked(prcopt.navsys&SYS_GLO);
+    NavSys3	     ->setChecked(prcopt.navsys&SYS_GAL);
+    NavSys4	     ->setChecked(prcopt.navsys&SYS_QZS);
+    NavSys5	     ->setChecked(prcopt.navsys&SYS_SBS);
+    NavSys6	     ->setChecked(prcopt.navsys&SYS_CMP);
+    PosOpt1	     ->setChecked(prcopt.posopt[0]);
+    PosOpt2	     ->setChecked(prcopt.posopt[1]);
+    PosOpt3	     ->setChecked(prcopt.posopt[2]);
+    PosOpt4	     ->setChecked(prcopt.posopt[3]);
+    PosOpt5	     ->setChecked(prcopt.posopt[4]);
+    PosOpt6	     ->setChecked(prcopt.posopt[5]);
+//	MapFunc	     ->ItemIndex	=prcopt.mapfunc;
+	
+    AmbRes		 ->setCurrentIndex(prcopt.modear);
+    GloAmbRes	 ->setCurrentIndex(prcopt.glomodear);
+    BdsAmbRes	 ->setCurrentIndex(prcopt.bdsmodear);
+    ValidThresAR ->setText(QString::number(prcopt.thresar[0],'g',3));
+    ThresAR2	 ->setText(QString::number(prcopt.thresar[1],'g',9));
+    ThresAR3	 ->setText(QString::number(prcopt.thresar[2],'g',3));
+    OutCntResetAmb->setText(QString::number(prcopt.maxout));
+    FixCntHoldAmb->setText(QString::number(prcopt.minfix));
+    LockCntFixAmb  ->setText(QString::number(prcopt.minlock));
+    ElMaskAR	 ->setText(QString::number(prcopt.elmaskar*R2D,'f',0));
+    ElMaskHold	 ->setText(QString::number(prcopt.elmaskhold*R2D,'f',0));
+    MaxAgeDiff	 ->setText(QString::number(prcopt.maxtdiff,'f',1));
+    RejectGdop   ->setText(QString::number(prcopt.maxgdop,'f',1));
+    RejectThres  ->setText(QString::number(prcopt.maxinno,'f',1));
+    SlipThres	 ->setText(QString::number(prcopt.thresslip,'f',3));
+    ARIter		 ->setText(QString::number(prcopt.armaxiter));
+    NumIter		 ->setText(QString::number(prcopt.niter));
+    BaselineLen	 ->setText(QString::number(prcopt.baseline[0],'f',3));
+    BaselineSig	 ->setText(QString::number(prcopt.baseline[1],'f',3));
+    BaselineConst->setChecked(prcopt.baseline[0]>0.0);
+	
+    SolFormat	 ->setCurrentIndex(solopt.posf);
+    TimeFormat	 ->setCurrentIndex(solopt.timef==0?0:solopt.times+1);
+    TimeDecimal	 ->setText(QString::number(solopt.timeu));
+    LatLonFormat ->setCurrentIndex(solopt.degf);
+    FieldSep	 ->setText(solopt.sep);
+    OutputHead	 ->setCurrentIndex(solopt.outhead);
+    OutputOpt	 ->setCurrentIndex(solopt.outopt);
+    OutputDatum  ->setCurrentIndex(solopt.datum);
+    OutputHeight ->setCurrentIndex(solopt.height);
+    OutputGeoid  ->setCurrentIndex(solopt.geoid);
+    SolStatic    ->setCurrentIndex(solopt.solstatic);
+    NmeaIntv1	 ->setText(QString::number(solopt.nmeaintv[0],'g',2));
+    NmeaIntv2	 ->setText(QString::number(solopt.nmeaintv[1],'g',2));
+    DebugTrace	 ->setCurrentIndex(solopt.trace);
+    DebugStatus	 ->setCurrentIndex(solopt.sstat);
+	
+    MeasErrR1	 ->setText(QString::number(prcopt.eratio[0],'f',1));
+    MeasErrR2	 ->setText(QString::number(prcopt.eratio[1],'f',1));
+    MeasErr2	 ->setText(QString::number(prcopt.err[1],'f',3));
+    MeasErr3	 ->setText(QString::number(prcopt.err[2],'f',3));
+    MeasErr4	 ->setText(QString::number(prcopt.err[3],'f',3));
+    MeasErr5	 ->setText(QString::number(prcopt.err[4],'f',3));
+    SatClkStab	 ->setText(QString::number(prcopt.sclkstab,'E',2));
+    PrNoise1	 ->setText(QString::number(prcopt.prn[0],'E',2));
+    PrNoise2	 ->setText(QString::number(prcopt.prn[1],'E',2));
+    PrNoise3	 ->setText(QString::number(prcopt.prn[2],'E',2));
+    PrNoise4	 ->setText(QString::number(prcopt.prn[3],'E',2));
+    PrNoise5	 ->setText(QString::number(prcopt.prn[4],'E',2));
+	
+    RovAntPcv	 ->setChecked(*prcopt.anttype[0]);
+    RefAntPcv	 ->setChecked(*prcopt.anttype[1]);
+    RovAnt		 ->setCurrentText(prcopt.anttype[0]);
+    RefAnt		 ->setCurrentText(prcopt.anttype[1]);
+    RovAntE		 ->setText(QString::number(prcopt.antdel[0][0],'f',4));
+    RovAntN		 ->setText(QString::number(prcopt.antdel[0][1],'f',4));
+    RovAntU		 ->setText(QString::number(prcopt.antdel[0][2],'f',4));
+    RefAntE		 ->setText(QString::number(prcopt.antdel[1][0],'f',4));
+    RefAntN		 ->setText(QString::number(prcopt.antdel[1][1],'f',4));
+    RefAntU		 ->setText(QString::number(prcopt.antdel[1][2],'f',4));
+	
+    RnxOpts1	 ->setText(prcopt.rnxopt[0]);
+    RnxOpts2	 ->setText(prcopt.rnxopt[1]);
+    PPPOpts		 ->setText(prcopt.pppopt);
+	
+    IntpRefObs	 ->setCurrentIndex(prcopt.intpref);
+    SbasSat		 ->setText(QString::number(prcopt.sbassatsel));
+    RovPosType	 ->setCurrentIndex(prcopt.rovpos==0?0:prcopt.rovpos+2);
+    RefPosType	 ->setCurrentIndex(prcopt.refpos==0?0:prcopt.refpos+2);
+    RovPosTypeP					=RovPosType->currentIndex();
+    RefPosTypeP					=RefPosType->currentIndex();
+    SetPos(RovPosType->currentIndex(),editu,prcopt.ru);
+    SetPos(RefPosType->currentIndex(),editr,prcopt.rb);
+	
+    SatPcvFile ->setText(filopt.satantp);
+    AntPcvFile ->setText(filopt.rcvantp);
+    StaPosFile ->setText(filopt.stapos);
     GeoidDataFile->setText(filopt.geoid);
-    EOPFile->setText(filopt.eop);
-    DCBFile->setText(filopt.dcb);
-    BLQFile->setText(filopt.blq);
-    IonoFile->setText(filopt.iono);
-
+    EOPFile	   ->setText(filopt.eop);
+    DCBFile	   ->setText(filopt.dcb);
+    BLQFile	   ->setText(filopt.blq);
+    IonoFile   ->setText(filopt.iono);
+	
 	ReadAntList();
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
 void OptDialog::SaveOpt(const QString &file)
 {
-    QString ExSats_Text = ExSats->text(), FieldSep_Text = FieldSep->text();
-    QString RovAnt_Text = RovAnt->currentText(), RefAnt_Text = RefAnt->currentText();
-    QString SatPcvFile_Text = SatPcvFile->text();
-    QString AntPcvFile_Text = AntPcvFile->text();
-    QString StaPosFile_Text = StaPosFile->text();
-    QString GeoidDataFile_Text = GeoidDataFile->text();
-    QString EOPFile_Text = EOPFile->text();
-    QString DCBFile_Text = DCBFile->text();
-    QString BLQFile_Text = BLQFile->text();
-    QString IonoFile_Text = IonoFile->text();
-    QString RnxOpts1_Text = RnxOpts1->text();
-    QString RnxOpts2_Text = RnxOpts2->text();
-    QString PPPOpts_Text = PPPOpts->text();
-    QLineEdit *editu[] = { RovPos1, RovPos2, RovPos3 };
-    QLineEdit *editr[] = { RefPos1, RefPos2, RefPos3 };
-    char buff[1024], *p, comment[256], s[64];
-    int sat, ex;
-    prcopt_t prcopt = prcopt_default;
-    solopt_t solopt = solopt_default;
+    QString ExSats_Text=ExSats->text(),FieldSep_Text=FieldSep->text();
+    QString RovAnt_Text=RovAnt->currentText(),RefAnt_Text=RefAnt->currentText();
+    QString SatPcvFile_Text=SatPcvFile->text();
+    QString AntPcvFile_Text=AntPcvFile->text();
+    QString StaPosFile_Text=StaPosFile->text();
+    QString GeoidDataFile_Text=GeoidDataFile->text();
+    QString EOPFile_Text=EOPFile->text();
+    QString DCBFile_Text=DCBFile->text();
+    QString BLQFile_Text=BLQFile->text();
+    QString IonoFile_Text=IonoFile->text();
+    QString RnxOpts1_Text=RnxOpts1->text();
+    QString RnxOpts2_Text=RnxOpts2->text();
+    QString PPPOpts_Text=PPPOpts->text();
+    QLineEdit *editu[]={RovPos1,RovPos2,RovPos3};
+    QLineEdit *editr[]={RefPos1,RefPos2,RefPos3};
+    char buff[1024],*p,comment[256],s[64];
+	int sat,ex;
+	prcopt_t prcopt=prcopt_default;
+	solopt_t solopt=solopt_default;
     filopt_t filopt;
+	
+    memset(&filopt,0,sizeof(filopt_t));
 
-    memset(&filopt, 0, sizeof(filopt_t));
-
-    prcopt.mode = PosMode->currentIndex();
-    prcopt.nf = Freq->currentIndex() + 1;
-    prcopt.soltype = Solution->currentIndex();
-    prcopt.elmin = ElMask->currentText().toDouble() * D2R;
-    prcopt.snrmask = SnrMask;
-    prcopt.dynamics = DynamicModel->currentIndex();
-    prcopt.tidecorr = TideCorr->currentIndex();
-    prcopt.ionoopt = IonoOpt->currentIndex();
-    prcopt.tropopt = TropOpt->currentIndex();
-    prcopt.sateph = SatEphem->currentIndex();
-    if (ExSats->text() != "") {
-        strcpy(buff, qPrintable(ExSats_Text));
-        for (p = strtok(buff, " "); p; p = strtok(NULL, " ")) {
-            if (*p == '+') {
-                ex = 2; p++;
-            } else {
-                ex = 1;
-            }
-            if (!(sat = satid2no(p))) continue;
-            prcopt.exsats[sat - 1] = ex;
+    prcopt.mode		=PosMode	 ->currentIndex();
+    prcopt.nf		=Freq		 ->currentIndex()+1;
+    prcopt.soltype	=Solution	 ->currentIndex();
+    prcopt.elmin	=ElMask	->currentText().toDouble()*D2R;
+	prcopt.snrmask	=SnrMask;
+    prcopt.dynamics	=DynamicModel->currentIndex();
+    prcopt.tidecorr	=TideCorr	 ->currentIndex();
+    prcopt.ionoopt	=IonoOpt	 ->currentIndex();
+    prcopt.tropopt	=TropOpt	 ->currentIndex();
+    prcopt.sateph	=SatEphem	 ->currentIndex();
+    if (ExSats->text()!="") {
+        strcpy(buff,qPrintable(ExSats_Text));
+		for (p=strtok(buff," ");p;p=strtok(NULL," ")) {
+			if (*p=='+') {ex=2; p++;} else ex=1;
+			if (!(sat=satid2no(p))) continue;
+			prcopt.exsats[sat-1]=ex;
 		}
 	}
-    prcopt.navsys = (NavSys1->isChecked() ? SYS_GPS : 0) |
-            (NavSys2->isChecked() ? SYS_GLO : 0) |
-            (NavSys3->isChecked() ? SYS_GAL : 0) |
-            (NavSys4->isChecked() ? SYS_QZS : 0) |
-            (NavSys5->isChecked() ? SYS_SBS : 0) |
-            (NavSys6->isChecked() ? SYS_CMP : 0);
-    prcopt.posopt[0] = PosOpt1->isChecked();
-    prcopt.posopt[1] = PosOpt2->isChecked();
-    prcopt.posopt[2] = PosOpt3->isChecked();
-    prcopt.posopt[3] = PosOpt4->isChecked();
-    prcopt.posopt[4] = PosOpt5->isChecked();
-    prcopt.posopt[5] = PosOpt6->isChecked();
-//	prcopt.mapfunc=MapFunc->currentIndex();
-
-    prcopt.modear = AmbRes->currentIndex();
-    prcopt.glomodear = GloAmbRes->currentIndex();
-    prcopt.bdsmodear = BdsAmbRes->currentIndex();
-    prcopt.thresar[0] = ValidThresAR->value();
-    prcopt.thresar[1] = ThresAR2->value();
-    prcopt.thresar[2] = ThresAR3->value();
-    prcopt.maxout = OutCntResetAmb->value();
-    prcopt.minfix = FixCntHoldAmb->value();
-    prcopt.minlock = LockCntFixAmb->value();
-    prcopt.elmaskar = ElMaskAR->value() * D2R;
-    prcopt.elmaskhold = ElMaskHold->value() * D2R;
-    prcopt.maxtdiff = MaxAgeDiff->value();
-    prcopt.maxgdop = RejectGdop->value();
-    prcopt.maxinno = RejectThres->value();
-    prcopt.thresslip = SlipThres->value();
-    prcopt.armaxiter = ARIter->value();
-    prcopt.niter = NumIter->value();
-    if (prcopt.mode == PMODE_MOVEB && BaselineConst->isChecked()) {
-        prcopt.baseline[0] = BaselineLen->value();
-        prcopt.baseline[1] = BaselineSig->value();
+    prcopt.navsys	= (NavSys1->isChecked()?SYS_GPS:0)|
+                      (NavSys2->isChecked()?SYS_GLO:0)|
+                      (NavSys3->isChecked()?SYS_GAL:0)|
+                      (NavSys4->isChecked()?SYS_QZS:0)|
+                      (NavSys5->isChecked()?SYS_SBS:0)|
+                      (NavSys6->isChecked()?SYS_CMP:0);
+    prcopt.posopt[0]=PosOpt1	->isChecked();
+    prcopt.posopt[1]=PosOpt2	->isChecked();
+    prcopt.posopt[2]=PosOpt3	->isChecked();
+    prcopt.posopt[3]=PosOpt4	->isChecked();
+    prcopt.posopt[4]=PosOpt5	->isChecked();
+    prcopt.posopt[5]=PosOpt6	->isChecked();
+//	prcopt.mapfunc	=MapFunc	->ItemIndex;
+	
+    prcopt.modear	=AmbRes		->currentIndex();
+    prcopt.glomodear=GloAmbRes	->currentIndex();
+    prcopt.bdsmodear=BdsAmbRes	->currentIndex();
+    prcopt.thresar[0]=ValidThresAR->text().toDouble();
+    prcopt.thresar[1]=ThresAR2->text().toDouble();
+    prcopt.thresar[2]=ThresAR3->text().toDouble();
+    prcopt.maxout	=OutCntResetAmb->text().toDouble();
+    prcopt.minfix	=FixCntHoldAmb->text().toDouble();
+    prcopt.minlock	=LockCntFixAmb->text().toDouble();
+    prcopt.elmaskar	=ElMaskAR	->text().toDouble()*D2R;
+    prcopt.elmaskhold=ElMaskHold->text().toDouble()*D2R;
+    prcopt.maxtdiff	=MaxAgeDiff	->text().toDouble();
+    prcopt.maxgdop	=RejectGdop ->text().toDouble();
+    prcopt.maxinno	=RejectThres->text().toDouble();
+    prcopt.thresslip=SlipThres	->text().toDouble();
+    prcopt.armaxiter=ARIter		->text().toDouble();
+    prcopt.niter	=NumIter	->text().toDouble();
+    if (prcopt.mode==PMODE_MOVEB&&BaselineConst->isChecked()) {
+        prcopt.baseline[0]=BaselineLen->text().toDouble();
+        prcopt.baseline[1]=BaselineSig->text().toDouble();
 	}
-    solopt.posf = SolFormat->currentIndex();
-    solopt.timef = TimeFormat->currentIndex() == 0 ? 0 : 1;
-    solopt.times = TimeFormat->currentIndex() == 0 ? 0 : TimeFormat->currentIndex() - 1;
-    solopt.timeu = TimeDecimal->value();
-    solopt.degf = LatLonFormat->currentIndex();
-    strcpy(solopt.sep, qPrintable(FieldSep_Text));
-    solopt.outhead = OutputHead->currentIndex();
-    solopt.outopt = OutputOpt->currentIndex();
-    prcopt.outsingle = OutputSingle->currentIndex();
-    solopt.maxsolstd = MaxSolStd->value();
-    solopt.datum = OutputDatum->currentIndex();
-    solopt.height = OutputHeight->currentIndex();
-    solopt.geoid = OutputGeoid->currentIndex();
-    solopt.solstatic = SolStatic->currentIndex();
-    solopt.nmeaintv[0] = NmeaIntv1->value();
-    solopt.nmeaintv[1] = NmeaIntv2->value();
-    solopt.trace = DebugTrace->currentIndex();
-    solopt.sstat = DebugStatus->currentIndex();
-
-    prcopt.eratio[0] = MeasErrR1->value();
-    prcopt.eratio[1] = MeasErrR2->value();
-    prcopt.err[1] = MeasErr2->value();
-    prcopt.err[2] = MeasErr3->value();
-    prcopt.err[3] = MeasErr4->value();
-    prcopt.err[4] = MeasErr5->value();
-    prcopt.sclkstab = SatClkStab->text().toDouble();
-    prcopt.prn[0] = PrNoise1->text().toDouble();
-    prcopt.prn[1] = PrNoise2->text().toDouble();
-    prcopt.prn[2] = PrNoise3->text().toDouble();
-    prcopt.prn[3] = PrNoise4->text().toDouble();
-    prcopt.prn[4] = PrNoise5->text().toDouble();
-
-    if (RovAntPcv->isChecked()) strcpy(prcopt.anttype[0], qPrintable(RovAnt_Text));
-    if (RefAntPcv->isChecked()) strcpy(prcopt.anttype[1], qPrintable(RefAnt_Text));
-    prcopt.antdel[0][0] = RovAntE->value();
-    prcopt.antdel[0][1] = RovAntN->value();
-    prcopt.antdel[0][2] = RovAntU->value();
-    prcopt.antdel[1][0] = RefAntE->value();
-    prcopt.antdel[1][1] = RefAntN->value();
-    prcopt.antdel[1][2] = RefAntU->value();
-
-    prcopt.intpref = IntpRefObs->currentIndex();
-    prcopt.sbassatsel = SbasSat->text().toInt();
-    prcopt.rovpos = RovPosType->currentIndex() < 3 ? 0 : RovPosType->currentIndex() - 2;
-    prcopt.refpos = RefPosType->currentIndex() < 3 ? 0 : RefPosType->currentIndex() - 2;
-    if (prcopt.rovpos == 0) GetPos(RovPosType->currentIndex(), editu, prcopt.ru);
-    if (prcopt.refpos == 0) GetPos(RefPosType->currentIndex(), editr, prcopt.rb);
-
-    strcpy(prcopt.rnxopt[0], qPrintable(RnxOpts1_Text));
-    strcpy(prcopt.rnxopt[1], qPrintable(RnxOpts2_Text));
-    strcpy(prcopt.pppopt, qPrintable(PPPOpts_Text));
-
-    strcpy(filopt.satantp, qPrintable(SatPcvFile_Text));
-    strcpy(filopt.rcvantp, qPrintable(AntPcvFile_Text));
+    solopt.posf		=SolFormat	->currentIndex();
+    solopt.timef	=TimeFormat	->currentIndex()==0?0:1;
+    solopt.times	=TimeFormat	->currentIndex()==0?0:TimeFormat->currentIndex()-1;
+    solopt.timeu	=TimeDecimal ->text().toDouble();
+    solopt.degf		=LatLonFormat->currentIndex();
+    strcpy(solopt.sep,qPrintable(FieldSep_Text));
+    solopt.outhead	=OutputHead	 ->currentIndex();
+    solopt.outopt	=OutputOpt	 ->currentIndex();
+    solopt.datum	=OutputDatum ->currentIndex();
+    solopt.height	=OutputHeight->currentIndex();
+    solopt.geoid	=OutputGeoid ->currentIndex();
+    solopt.solstatic=SolStatic   ->currentIndex();
+    solopt.nmeaintv[0]=NmeaIntv1->text().toDouble();
+    solopt.nmeaintv[1]=NmeaIntv2->text().toDouble();
+    solopt.trace	=DebugTrace	 ->currentIndex();
+    solopt.sstat	=DebugStatus ->currentIndex();
+	
+    prcopt.eratio[0]=MeasErrR1->text().toDouble();
+    prcopt.eratio[1]=MeasErrR2->text().toDouble();
+    prcopt.err[1]	=MeasErr2->text().toDouble();
+    prcopt.err[2]	=MeasErr3->text().toDouble();
+    prcopt.err[3]	=MeasErr4->text().toDouble();
+    prcopt.err[4]	=MeasErr5->text().toDouble();
+    prcopt.sclkstab	=SatClkStab->text().toDouble();
+    prcopt.prn[0]	=PrNoise1->text().toDouble();
+    prcopt.prn[1]	=PrNoise2->text().toDouble();
+    prcopt.prn[2]	=PrNoise3->text().toDouble();
+    prcopt.prn[3]	=PrNoise4->text().toDouble();
+    prcopt.prn[4]	=PrNoise5->text().toDouble();
+	
+    if (RovAntPcv->isChecked()) strcpy(prcopt.anttype[0],qPrintable(RovAnt_Text));
+    if (RefAntPcv->isChecked()) strcpy(prcopt.anttype[1],qPrintable(RefAnt_Text));
+    prcopt.antdel[0][0]=RovAntE->text().toDouble();
+    prcopt.antdel[0][1]=RovAntN->text().toDouble();
+    prcopt.antdel[0][2]=RovAntU->text().toDouble();
+    prcopt.antdel[1][0]=RefAntE->text().toDouble();
+    prcopt.antdel[1][1]=RefAntN->text().toDouble();
+    prcopt.antdel[1][2]=RefAntU->text().toDouble();
+	
+    prcopt.intpref	=IntpRefObs->currentIndex();
+    prcopt.sbassatsel=SbasSat->text().toInt();
+    prcopt.rovpos=RovPosType->currentIndex()<3?0:RovPosType->currentIndex()-2;
+    prcopt.refpos=RefPosType->currentIndex()<3?0:RefPosType->currentIndex()-2;
+    if (prcopt.rovpos==0) GetPos(RovPosType->currentIndex(),editu,prcopt.ru);
+    if (prcopt.refpos==0) GetPos(RefPosType->currentIndex(),editr,prcopt.rb);
+	
+    strcpy(prcopt.rnxopt[0],qPrintable(RnxOpts1_Text));
+    strcpy(prcopt.rnxopt[1],qPrintable(RnxOpts2_Text));
+    strcpy(prcopt.pppopt,qPrintable(PPPOpts_Text));
+	
+    strcpy(filopt.satantp,qPrintable(SatPcvFile_Text));
+    strcpy(filopt.rcvantp,qPrintable(AntPcvFile_Text));
     strcpy(filopt.stapos, qPrintable(StaPosFile_Text));
-    strcpy(filopt.geoid, qPrintable(GeoidDataFile_Text));
-    strcpy(filopt.eop, qPrintable(EOPFile_Text));
-    strcpy(filopt.dcb, qPrintable(DCBFile_Text));
-    strcpy(filopt.blq, qPrintable(BLQFile_Text));
-    strcpy(filopt.iono, qPrintable(IonoFile_Text));
-
-    time2str(utc2gpst(timeget()), s, 0);
-    sprintf(comment, "rtkpost_qt options (%s, v.%s %s)", s, VER_RTKLIB, PATCH_LEVEL);
-    setsysopts(&prcopt, &solopt, &filopt);
-    if (!saveopts(qPrintable(file), "w", comment, sysopts)) return;
+    strcpy(filopt.geoid,  qPrintable(GeoidDataFile_Text));
+    strcpy(filopt.eop,    qPrintable(EOPFile_Text));
+    strcpy(filopt.dcb,    qPrintable(DCBFile_Text));
+    strcpy(filopt.blq,    qPrintable(BLQFile_Text));
+    strcpy(filopt.iono,   qPrintable(IonoFile_Text));
+	
+	time2str(utc2gpst(timeget()),s,0);
+    sprintf(comment,"rtkpost_qt options (%s, v.%s %s)",s,VER_RTKLIB,PATCH_LEVEL);
+	setsysopts(&prcopt,&solopt,&filopt);
+    if (!saveopts(qPrintable(file),"w",comment,sysopts)) return;
 }
 //---------------------------------------------------------------------------
 void OptDialog::UpdateEnable(void)
 {
-    bool rel = PMODE_DGPS <= PosMode->currentIndex() && PosMode->currentIndex() <= PMODE_FIXED;
-    bool rtk = PMODE_KINEMA <= PosMode->currentIndex() && PosMode->currentIndex() <= PMODE_FIXED;
-    bool ppp = PosMode->currentIndex() >= PMODE_PPP_KINEMA;
-    bool ar = rtk || ppp;
-
-    Freq->setEnabled(rel || ppp);
-    Solution->setEnabled(rel || ppp);
-    DynamicModel->setEnabled(rel);
-    TideCorr->setEnabled(rel || ppp);
-    //IonoOpt->setEnabled(!ppp);
-    PosOpt1->setEnabled(ppp);
-    PosOpt2->setEnabled(ppp);
-    PosOpt3->setEnabled(ppp);
-    PosOpt4->setEnabled(ppp);
-    PosOpt6->setEnabled(ppp);
-
-    AmbRes->setEnabled(ar);
-    GloAmbRes->setEnabled(ar && AmbRes->currentIndex() > 0 && NavSys2->isChecked());
-    BdsAmbRes->setEnabled(ar && AmbRes->currentIndex() > 0 && NavSys6->isChecked());
-    ValidThresAR->setEnabled(ar && AmbRes->currentIndex() >= 1 && AmbRes->currentIndex() < 4);
-    ThresAR2->setEnabled(ar && AmbRes->currentIndex() >= 4);
-    ThresAR3->setEnabled(ar && AmbRes->currentIndex() >= 4);
-    LockCntFixAmb->setEnabled(ar && AmbRes->currentIndex() >= 1);
-    ElMaskAR->setEnabled(ar && AmbRes->currentIndex() >= 1);
-    OutCntResetAmb->setEnabled(ar || ppp);
-    FixCntHoldAmb->setEnabled(ar && AmbRes->currentIndex() == 3);
-    ElMaskHold->setEnabled(ar && AmbRes->currentIndex() == 3);
-    SlipThres->setEnabled(rtk || ppp);
-    MaxAgeDiff->setEnabled(rel);
-    RejectThres->setEnabled(rel || ppp);
-    ARIter->setEnabled(ppp);
-    NumIter->setEnabled(rel || ppp);
-    BaselineConst->setEnabled(PosMode->currentIndex() == PMODE_MOVEB);
-    BaselineLen->setEnabled(BaselineConst->isChecked() && PosMode->currentIndex() == PMODE_MOVEB);
-    BaselineSig->setEnabled(BaselineConst->isChecked() && PosMode->currentIndex() == PMODE_MOVEB);
-
-    OutputHead->setEnabled(SolFormat->currentIndex() < 3);
-    OutputOpt->setEnabled(SolFormat->currentIndex() < 3);
-    TimeFormat->setEnabled(SolFormat->currentIndex() < 3);
-    TimeDecimal->setEnabled(SolFormat->currentIndex() < 3);
-    LatLonFormat->setEnabled(SolFormat->currentIndex() == 0);
-    FieldSep->setEnabled(SolFormat->currentIndex() < 3);
-    OutputSingle->setEnabled(PosMode->currentIndex() != 0);
-    OutputDatum->setEnabled(SolFormat->currentIndex() == 0);
-    OutputHeight->setEnabled(SolFormat->currentIndex() == 0);
-    OutputGeoid->setEnabled(SolFormat->currentIndex() == 0 && OutputHeight->currentIndex() == 1);
-    SolStatic->setEnabled(PosMode->currentIndex() == PMODE_STATIC ||
-                  PosMode->currentIndex() == PMODE_PPP_STATIC);
-
-    RovAntPcv->setEnabled(rel || ppp);
-    RovAnt->setEnabled((rel || ppp) && RovAntPcv->isChecked());
-    RovAntE->setEnabled((rel || ppp) && RovAntPcv->isChecked());
-    RovAntN->setEnabled((rel || ppp) && RovAntPcv->isChecked());
-    RovAntU->setEnabled((rel || ppp) && RovAntPcv->isChecked());
-    LabelRovAntD->setEnabled((rel || ppp) && RovAntPcv->isChecked());
-    RefAntPcv->setEnabled(rel);
-    RefAnt->setEnabled(rel && RefAntPcv->isChecked());
-    RefAntE->setEnabled(rel && RefAntPcv->isChecked());
-    RefAntN->setEnabled(rel && RefAntPcv->isChecked());
-    RefAntU->setEnabled(rel && RefAntPcv->isChecked());
-    LabelRefAntD->setEnabled(rel && RefAntPcv->isChecked());
-
-    RovPosType->setEnabled(PosMode->currentIndex() == PMODE_FIXED || PosMode->currentIndex() == PMODE_PPP_FIXED);
-    RovPos1->setEnabled(RovPosType->isEnabled() && RovPosType->currentIndex() <= 2);
-    RovPos2->setEnabled(RovPosType->isEnabled() && RovPosType->currentIndex() <= 2);
-    RovPos3->setEnabled(RovPosType->isEnabled() && RovPosType->currentIndex() <= 2);
-    BtnRovPos->setEnabled(RovPosType->isEnabled() && RovPosType->currentIndex() <= 2);
-
-    RefPosType->setEnabled(rel && PosMode->currentIndex() != PMODE_MOVEB);
-    RefPos1->setEnabled(RefPosType->isEnabled() && RefPosType->currentIndex() <= 2);
-    RefPos2->setEnabled(RefPosType->isEnabled() && RefPosType->currentIndex() <= 2);
-    RefPos3->setEnabled(RefPosType->isEnabled() && RefPosType->currentIndex() <= 2);
-    BtnRefPos->setEnabled(RefPosType->isEnabled() && RefPosType->currentIndex() <= 2);
+    bool rel=PMODE_DGPS<=PosMode->currentIndex()&&PosMode->currentIndex()<=PMODE_FIXED;
+    bool rtk=PMODE_KINEMA<=PosMode->currentIndex()&&PosMode->currentIndex()<=PMODE_FIXED;
+    bool ppp=PosMode->currentIndex()>=PMODE_PPP_KINEMA;
+    bool ar=rtk||ppp;
+	
+    Freq           ->setEnabled(rel||ppp);
+    Solution       ->setEnabled(rel||ppp);
+    DynamicModel   ->setEnabled(rel);
+    TideCorr       ->setEnabled(rel||ppp);
+    //IonoOpt        ->setEnabled(!ppp);
+    PosOpt1        ->setEnabled(ppp);
+    PosOpt2        ->setEnabled(ppp);
+    PosOpt3        ->setEnabled(ppp);
+    PosOpt4        ->setEnabled(ppp);
+    PosOpt6        ->setEnabled(ppp);
+	
+    AmbRes         ->setEnabled(ar);
+    GloAmbRes      ->setEnabled(ar&&AmbRes->currentIndex()>0&&NavSys2->isChecked());
+    BdsAmbRes      ->setEnabled(ar&&AmbRes->currentIndex()>0&&NavSys6->isChecked());
+    ValidThresAR   ->setEnabled(ar&&AmbRes->currentIndex()>=1&&AmbRes->currentIndex()<4);
+    ThresAR2	   ->setEnabled(ar&&AmbRes->currentIndex()>=4);
+    ThresAR3	   ->setEnabled(ar&&AmbRes->currentIndex()>=4);
+    LockCntFixAmb  ->setEnabled(ar&&AmbRes->currentIndex()>=1);
+    ElMaskAR       ->setEnabled(ar&&AmbRes->currentIndex()>=1);
+    OutCntResetAmb ->setEnabled(ar||ppp);
+    FixCntHoldAmb  ->setEnabled(ar&&AmbRes->currentIndex()==3);
+    ElMaskHold     ->setEnabled(ar&&AmbRes->currentIndex()==3);
+    SlipThres      ->setEnabled(rtk||ppp);
+    MaxAgeDiff     ->setEnabled(rel);
+    RejectThres    ->setEnabled(rel||ppp);
+    ARIter         ->setEnabled(ppp);
+    NumIter        ->setEnabled(rel||ppp);
+    BaselineConst  ->setEnabled(PosMode->currentIndex()==PMODE_MOVEB);
+    BaselineLen    ->setEnabled(BaselineConst->isChecked()&&PosMode->currentIndex()==PMODE_MOVEB);
+    BaselineSig    ->setEnabled(BaselineConst->isChecked()&&PosMode->currentIndex()==PMODE_MOVEB);
+	
+    OutputHead     ->setEnabled(SolFormat->currentIndex()<3);
+    OutputOpt      ->setEnabled(SolFormat->currentIndex()<3);
+    TimeFormat     ->setEnabled(SolFormat->currentIndex()<3);
+    TimeDecimal    ->setEnabled(SolFormat->currentIndex()<3);
+    LatLonFormat   ->setEnabled(SolFormat->currentIndex()==0);
+    FieldSep       ->setEnabled(SolFormat->currentIndex()<3);
+    OutputDatum    ->setEnabled(SolFormat->currentIndex()==0);
+    OutputHeight   ->setEnabled(SolFormat->currentIndex()==0);
+    OutputGeoid    ->setEnabled(SolFormat->currentIndex()==0&&OutputHeight->currentIndex()==1);
+    SolStatic      ->setEnabled(PosMode->currentIndex()==PMODE_STATIC||
+                             PosMode->currentIndex()==PMODE_PPP_STATIC);
+	
+    RovAntPcv      ->setEnabled(rel||ppp);
+    RovAnt         ->setEnabled((rel||ppp)&&RovAntPcv->isChecked());
+    RovAntE        ->setEnabled((rel||ppp)&&RovAntPcv->isChecked());
+    RovAntN        ->setEnabled((rel||ppp)&&RovAntPcv->isChecked());
+    RovAntU        ->setEnabled((rel||ppp)&&RovAntPcv->isChecked());
+    LabelRovAntD   ->setEnabled((rel||ppp)&&RovAntPcv->isChecked());
+    RefAntPcv      ->setEnabled(rel);
+    RefAnt         ->setEnabled(rel&&RefAntPcv->isChecked());
+    RefAntE        ->setEnabled(rel&&RefAntPcv->isChecked());
+    RefAntN        ->setEnabled(rel&&RefAntPcv->isChecked());
+    RefAntU        ->setEnabled(rel&&RefAntPcv->isChecked());
+    LabelRefAntD   ->setEnabled(rel&&RefAntPcv->isChecked());
+	
+    RovPosType     ->setEnabled(PosMode->currentIndex()==PMODE_FIXED||PosMode->currentIndex()==PMODE_PPP_FIXED);
+    RovPos1        ->setEnabled(RovPosType->isEnabled()&&RovPosType->currentIndex()<=2);
+    RovPos2        ->setEnabled(RovPosType->isEnabled()&&RovPosType->currentIndex()<=2);
+    RovPos3        ->setEnabled(RovPosType->isEnabled()&&RovPosType->currentIndex()<=2);
+    BtnRovPos      ->setEnabled(RovPosType->isEnabled()&&RovPosType->currentIndex()<=2);
+	
+    RefPosType     ->setEnabled(rel&&PosMode->currentIndex()!=PMODE_MOVEB);
+    RefPos1        ->setEnabled(RefPosType->isEnabled()&&RefPosType->currentIndex()<=2);
+    RefPos2        ->setEnabled(RefPosType->isEnabled()&&RefPosType->currentIndex()<=2);
+    RefPos3        ->setEnabled(RefPosType->isEnabled()&&RefPosType->currentIndex()<=2);
+    BtnRefPos      ->setEnabled(RefPosType->isEnabled()&&RefPosType->currentIndex()<=2);
 }
 //---------------------------------------------------------------------------
 void OptDialog::GetPos(int type, QLineEdit **edit, double *pos)
 {
-    QString edit0_Text = edit[0]->text();
-    QString edit1_Text = edit[1]->text();
-    double p[3] = { 0 }, dms1[3] = { 0 }, dms2[3] = { 0 };
-
-    if (type == 1) { /* lat/lon/height dms/m */
-        QStringList tokens = edit0_Text.split(' ');
-        if (tokens.size() == 3)
-            for (int i = 0; i < 3; i++) dms1[i] = tokens.at(i).toDouble();
-        tokens = edit1_Text.split(' ');
-        if (tokens.size() == 3)
-            for (int i = 0; i < 3; i++) dms2[i] = tokens.at(i).toDouble();
-        p[0] = (dms1[0] < 0 ? -1 : 1) * (fabs(dms1[0]) + dms1[1] / 60 + dms1[2] / 3600) * D2R;
-        p[1] = (dms2[0] < 0 ? -1 : 1) * (fabs(dms2[0]) + dms2[1] / 60 + dms2[2] / 3600) * D2R;
-        p[2] = edit[2]->text().toDouble();
-        pos2ecef(p, pos);
-    } else if (type == 2) { /* x/y/z-ecef */
-        pos[0] = edit[0]->text().toDouble();
-        pos[1] = edit[1]->text().toDouble();
-        pos[2] = edit[2]->text().toDouble();
-    } else {
-        p[0] = edit[0]->text().toDouble() * D2R;
-        p[1] = edit[1]->text().toDouble() * D2R;
-        p[2] = edit[2]->text().toDouble();
-        pos2ecef(p, pos);
+    QString edit0_Text=edit[0]->text();
+    QString edit1_Text=edit[1]->text();
+	double p[3]={0},dms1[3]={0},dms2[3]={0};
+	
+	if (type==1) { /* lat/lon/height dms/m */
+        QStringList tokens=edit0_Text.split(' ');
+        if (tokens.size()==3)
+            for (int i=0;i<3;i++) dms1[i]=tokens.at(i).toDouble();
+        tokens=edit1_Text.split(' ');
+        if (tokens.size()==3)
+            for (int i=0;i<3;i++) dms2[i]=tokens.at(i).toDouble();
+		p[0]=(dms1[0]<0?-1:1)*(fabs(dms1[0])+dms1[1]/60+dms1[2]/3600)*D2R;
+		p[1]=(dms2[0]<0?-1:1)*(fabs(dms2[0])+dms2[1]/60+dms2[2]/3600)*D2R;
+        p[2]=edit[2]->text().toDouble();
+		pos2ecef(p,pos);
+	}
+	else if (type==2) { /* x/y/z-ecef */
+        pos[0]=edit[0]->text().toDouble();
+        pos[1]=edit[1]->text().toDouble();
+        pos[2]=edit[2]->text().toDouble();
+	}
+	else {
+        p[0]=edit[0]->text().toDouble()*D2R;
+        p[1]=edit[1]->text().toDouble()*D2R;
+        p[2]=edit[2]->text().toDouble();
+		pos2ecef(p,pos);
 	}
 }
 //---------------------------------------------------------------------------
 void OptDialog::SetPos(int type, QLineEdit **edit, double *pos)
 {
-    double p[3], dms1[3], dms2[3], s1, s2;
-
-    if (type == 1) { /* lat/lon/height dms/m */
-        ecef2pos(pos, p); s1 = p[0] < 0 ? -1 : 1; s2 = p[1] < 0 ? -1 : 1;
-        p[0] = fabs(p[0]) * R2D + 1E-12; p[1] = fabs(p[1]) * R2D + 1E-12;
-        dms1[0] = floor(p[0]); p[0] = (p[0] - dms1[0]) * 60.0;
-        dms1[1] = floor(p[0]); dms1[2] = (p[0] - dms1[1]) * 60.0;
-        dms2[0] = floor(p[1]); p[1] = (p[1] - dms2[0]) * 60.0;
-        dms2[1] = floor(p[1]); dms2[2] = (p[1] - dms2[1]) * 60.0;
-        edit[0]->setText(QString("%1 %2 %3").arg(s1 * dms1[0], 0, 'f', 0).arg(dms1[1], 2, 'f', 0).arg(dms1[2], 9, 'f', 6));
-        edit[1]->setText(QString("%1 %2 %3").arg(s2 * dms2[0], 0, 'f', 0).arg(dms2[1], 2, 'f', 0).arg(dms2[2], 9, 'f', 6));
-        edit[2]->setText(QString("%1").arg(p[2], 0, 'f', 4));
-    } else if (type == 2) { /* x/y/z-ecef */
-        edit[0]->setText(QString::number(pos[0], 'f', 4));
-        edit[1]->setText(QString::number(pos[1], 'f', 4));
-        edit[2]->setText(QString::number(pos[2], 'f', 4));
-    } else {
-        ecef2pos(pos, p);
-        edit[0]->setText(QString::number(p[0] * R2D, 'f', 9));
-        edit[1]->setText(QString::number(p[1] * R2D, 'f', 9));
-        edit[2]->setText(QString::number(p[2], 'f', 4));
+	double p[3],dms1[3],dms2[3],s1,s2;
+	
+	if (type==1) { /* lat/lon/height dms/m */
+		ecef2pos(pos,p); s1=p[0]<0?-1:1; s2=p[1]<0?-1:1;
+		p[0]=fabs(p[0])*R2D+1E-12; p[1]=fabs(p[1])*R2D+1E-12;
+		dms1[0]=floor(p[0]); p[0]=(p[0]-dms1[0])*60.0;
+		dms1[1]=floor(p[0]); dms1[2]=(p[0]-dms1[1])*60.0;
+		dms2[0]=floor(p[1]); p[1]=(p[1]-dms2[0])*60.0;
+		dms2[1]=floor(p[1]); dms2[2]=(p[1]-dms2[1])*60.0;
+        edit[0]->setText(QString("%1 %2 %3").arg(s1*dms1[0],0,'f',0).arg(dms1[1],2,'f',0).arg(dms1[2],9,'f',6));
+        edit[1]->setText(QString("%1 %2 %3").arg(s2*dms2[0],0,'f',0).arg(dms2[1],2,'f',0).arg(dms2[2],9,'f',6));
+        edit[2]->setText(QString("%1").arg(p[2],0,'f',4));
+	}
+	else if (type==2) { /* x/y/z-ecef */
+        edit[0]->setText(QString::number(pos[0],'f',4));
+        edit[1]->setText(QString::number(pos[1],'f',4));
+        edit[2]->setText(QString::number(pos[2],'f',4));
+	}
+	else {
+		ecef2pos(pos,p);
+        edit[0]->setText(QString::number(p[0]*R2D,'f',9));
+        edit[1]->setText(QString::number(p[1]*R2D,'f',9));
+        edit[2]->setText(QString::number(p[2],'f',4));
 	}
 }
 //---------------------------------------------------------------------------
 void OptDialog::ReadAntList(void)
 {
-    QString AntPcvFile_Text = AntPcvFile->text();
-    pcvs_t pcvs = { 0, 0, 0 };
+    QString AntPcvFile_Text=AntPcvFile->text();
+    pcvs_t pcvs={0,0,0};
 	char *p;
-
-    if (!readpcv(qPrintable(AntPcvFile_Text), &pcvs)) return;
-
+	
+    if (!readpcv(qPrintable(AntPcvFile_Text),&pcvs)) return;
+	
     RovAnt->clear();
     RefAnt->clear();
 
-    RovAnt->addItem(""); RefAnt->addItem("");
-    RovAnt->addItem("*"); RefAnt->addItem("*");
+    RovAnt->addItem("");RefAnt->addItem("");
+    RovAnt->addItem("*");RefAnt->addItem("*");
 
-    for (int i = 0; i < pcvs.n; i++) {
+	for (int i=0;i<pcvs.n;i++) {
 		if (pcvs.pcv[i].sat) continue;
-        if ((p = strchr(pcvs.pcv[i].type, ' '))) *p = '\0';
-        if (i > 0 && !strcmp(pcvs.pcv[i].type, pcvs.pcv[i - 1].type)) continue;
+		if ((p=strchr(pcvs.pcv[i].type,' '))) *p='\0';
+		if (i>0&&!strcmp(pcvs.pcv[i].type,pcvs.pcv[i-1].type)) continue;
         RovAnt->addItem(pcvs.pcv[i].type);
         RefAnt->addItem(pcvs.pcv[i].type);
     }
-
+	
 	free(pcvs.pcv);
 }
 //---------------------------------------------------------------------------
 void OptDialog::BtnHelpClick()
 {
-    KeyDialog *keyDialog = new KeyDialog(this);
-
-    keyDialog->Flag = 2;
+    KeyDialog *keyDialog=new KeyDialog(this);
+    keyDialog->Flag=2;
     keyDialog->exec();
 
     delete keyDialog;
@@ -1128,8 +1114,7 @@
 //---------------------------------------------------------------------------
 void OptDialog::BtnExtOptClick()
 {
-    ExtOptDialog *extOptDialog = new ExtOptDialog(this);
-
+    ExtOptDialog *extOptDialog= new ExtOptDialog(this);
     extOptDialog->exec();
 
     delete extOptDialog;
@@ -1137,12 +1122,11 @@
 //---------------------------------------------------------------------------
 void OptDialog::BtnMaskClick()
 {
-    MaskOptDialog *maskOptDialog = new MaskOptDialog(this);
-
-    maskOptDialog->Mask = SnrMask;
+    MaskOptDialog *maskOptDialog= new MaskOptDialog(this);
+    maskOptDialog->Mask=SnrMask;
     maskOptDialog->exec();
-    if (maskOptDialog->result() != QDialog::Accepted) return;
-    SnrMask = maskOptDialog->Mask;
+    if (maskOptDialog->result()!=QDialog::Accepted) return;
+    SnrMask=maskOptDialog->Mask;
 
     delete  maskOptDialog;
 }
@@ -1152,3 +1136,5 @@
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
+
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/postopt.h RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/postopt.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/postopt.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/postopt.h	2019-08-19 02:04:50.000000000 +0300
@@ -75,7 +75,7 @@
 
 private:
 	snrmask_t SnrMask;
-    int RovPosTypeP, RefPosTypeP;
+	int RovPosTypeP,RefPosTypeP;
 
     void GetOpt(void);
     void SetOpt(void);
@@ -84,7 +84,6 @@
     void ReadAntList(void);
     void UpdateEnable(void);
     void UpdateEnableExtErr(void);
-
 public:
 	exterr_t ExtErr;
 	
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/postopt.ui RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/postopt.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/postopt.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/postopt.ui	2019-08-19 02:04:50.000000000 +0300
@@ -916,192 +916,6 @@
        <string>Setting&amp;2</string>
       </attribute>
       <layout class="QGridLayout" name="gridLayout_2">
-       <item row="8" column="3" colspan="2">
-        <widget class="QDoubleSpinBox" name="ElMaskHold">
-         <property name="suffix">
-          <string>°</string>
-         </property>
-         <property name="decimals">
-          <number>0</number>
-         </property>
-         <property name="maximum">
-          <double>90.000000000000000</double>
-         </property>
-        </widget>
-       </item>
-       <item row="11" column="1" colspan="2">
-        <widget class="QSpinBox" name="OutCntResetAmb">
-         <property name="maximum">
-          <number>100</number>
-         </property>
-         <property name="value">
-          <number>5</number>
-         </property>
-        </widget>
-       </item>
-       <item row="11" column="3" colspan="2">
-        <widget class="QDoubleSpinBox" name="SlipThres">
-         <property name="suffix">
-          <string> m</string>
-         </property>
-         <property name="decimals">
-          <number>3</number>
-         </property>
-         <property name="value">
-          <double>0.050000000000000</double>
-         </property>
-        </widget>
-       </item>
-       <item row="13" column="1" colspan="2">
-        <widget class="QDoubleSpinBox" name="MaxAgeDiff">
-         <property name="suffix">
-          <string> s</string>
-         </property>
-         <property name="decimals">
-          <number>1</number>
-         </property>
-         <property name="maximum">
-          <double>10000.000000000000000</double>
-         </property>
-         <property name="value">
-          <double>30.000000000000000</double>
-         </property>
-        </widget>
-       </item>
-       <item row="17" column="1" colspan="2">
-        <widget class="QSpinBox" name="ARIter">
-         <property name="value">
-          <number>1</number>
-         </property>
-        </widget>
-       </item>
-       <item row="14" column="1" colspan="2">
-        <widget class="QDoubleSpinBox" name="RejectGdop">
-         <property name="suffix">
-          <string> m</string>
-         </property>
-         <property name="decimals">
-          <number>1</number>
-         </property>
-         <property name="maximum">
-          <double>1000.000000000000000</double>
-         </property>
-         <property name="value">
-          <double>30.000000000000000</double>
-         </property>
-        </widget>
-       </item>
-       <item row="14" column="3" colspan="2">
-        <widget class="QDoubleSpinBox" name="RejectThres">
-         <property name="decimals">
-          <number>1</number>
-         </property>
-         <property name="maximum">
-          <double>1000.000000000000000</double>
-         </property>
-         <property name="value">
-          <double>30.000000000000000</double>
-         </property>
-        </widget>
-       </item>
-       <item row="17" column="3" colspan="2">
-        <widget class="QSpinBox" name="NumIter">
-         <property name="value">
-          <number>1</number>
-         </property>
-        </widget>
-       </item>
-       <item row="2" column="1" colspan="4">
-        <widget class="QDoubleSpinBox" name="ValidThresAR">
-         <property name="decimals">
-          <number>3</number>
-         </property>
-         <property name="maximum">
-          <double>100.000000000000000</double>
-         </property>
-         <property name="value">
-          <double>3.000000000000000</double>
-         </property>
-        </widget>
-       </item>
-       <item row="6" column="3" colspan="2">
-        <widget class="QDoubleSpinBox" name="ElMaskAR">
-         <property name="suffix">
-          <string>°</string>
-         </property>
-         <property name="decimals">
-          <number>0</number>
-         </property>
-         <property name="maximum">
-          <double>90.000000000000000</double>
-         </property>
-        </widget>
-       </item>
-       <item row="6" column="1" colspan="2">
-        <widget class="QSpinBox" name="LockCntFixAmb">
-         <property name="suffix">
-          <string> s</string>
-         </property>
-         <property name="maximum">
-          <number>3600</number>
-         </property>
-         <property name="value">
-          <number>5</number>
-         </property>
-        </widget>
-       </item>
-       <item row="4" column="1" colspan="2">
-        <widget class="QDoubleSpinBox" name="ThresAR2">
-         <property name="decimals">
-          <number>8</number>
-         </property>
-         <property name="maximum">
-          <double>100.000000000000000</double>
-         </property>
-         <property name="value">
-          <double>0.999950000000000</double>
-         </property>
-        </widget>
-       </item>
-       <item row="4" column="3" colspan="2">
-        <widget class="QDoubleSpinBox" name="ThresAR3">
-         <property name="decimals">
-          <number>3</number>
-         </property>
-         <property name="maximum">
-          <double>1000.000000000000000</double>
-         </property>
-         <property name="value">
-          <double>0.200000000000000</double>
-         </property>
-        </widget>
-       </item>
-       <item row="19" column="0">
-        <widget class="QCheckBox" name="BaselineConst">
-         <property name="toolTip">
-          <string/>
-         </property>
-         <property name="text">
-          <string>Baseline Length Constraint</string>
-         </property>
-         <property name="checked">
-          <bool>false</bool>
-         </property>
-        </widget>
-       </item>
-       <item row="8" column="1" colspan="2">
-        <widget class="QSpinBox" name="FixCntHoldAmb">
-         <property name="suffix">
-          <string> s</string>
-         </property>
-         <property name="maximum">
-          <number>1000</number>
-         </property>
-         <property name="value">
-          <number>10</number>
-         </property>
-        </widget>
-       </item>
        <item row="0" column="0">
         <widget class="QLabel" name="Label25">
          <property name="enabled">
@@ -1195,7 +1009,7 @@
          </item>
         </widget>
        </item>
-       <item row="2" column="0">
+       <item row="1" column="0">
         <widget class="QLabel" name="LabelRatio">
          <property name="enabled">
           <bool>true</bool>
@@ -1208,7 +1022,20 @@
          </property>
         </widget>
        </item>
-       <item row="4" column="0">
+       <item row="1" column="1" colspan="4">
+        <widget class="QLineEdit" name="ValidThresAR">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>3.0</string>
+         </property>
+        </widget>
+       </item>
+       <item row="2" column="0">
         <widget class="QLabel" name="LabelConf">
          <property name="enabled">
           <bool>true</bool>
@@ -1221,7 +1048,33 @@
          </property>
         </widget>
        </item>
-       <item row="6" column="0">
+       <item row="2" column="1" colspan="2">
+        <widget class="QLineEdit" name="ThresAR2">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>0.99995</string>
+         </property>
+        </widget>
+       </item>
+       <item row="2" column="3" colspan="2">
+        <widget class="QLineEdit" name="ThresAR3">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>0.20</string>
+         </property>
+        </widget>
+       </item>
+       <item row="3" column="0">
         <widget class="QLabel" name="Label13">
          <property name="enabled">
           <bool>true</bool>
@@ -1230,11 +1083,37 @@
           <string/>
          </property>
          <property name="text">
-          <string>Min Lock / Elevation to Fix Amb</string>
+          <string>Min Lock / Elevation (°) to Fix Amb</string>
          </property>
         </widget>
        </item>
-       <item row="8" column="0">
+       <item row="3" column="1" colspan="2">
+        <widget class="QLineEdit" name="LockCntFixAmb">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>5</string>
+         </property>
+        </widget>
+       </item>
+       <item row="3" column="3" colspan="2">
+        <widget class="QLineEdit" name="ElMaskAR">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>0</string>
+         </property>
+        </widget>
+       </item>
+       <item row="4" column="0">
         <widget class="QLabel" name="LabelHold">
          <property name="enabled">
           <bool>true</bool>
@@ -1243,11 +1122,37 @@
           <string/>
          </property>
          <property name="text">
-          <string>Min Fix / Elevation to Hold Amb</string>
+          <string>Min Fix / Elevation (°) to Hold Amb</string>
          </property>
         </widget>
        </item>
-       <item row="11" column="0">
+       <item row="4" column="1" colspan="2">
+        <widget class="QLineEdit" name="FixCntHoldAmb">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>10</string>
+         </property>
+        </widget>
+       </item>
+       <item row="4" column="3" colspan="2">
+        <widget class="QLineEdit" name="ElMaskHold">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>0</string>
+         </property>
+        </widget>
+       </item>
+       <item row="5" column="0">
         <widget class="QLabel" name="Label22">
          <property name="enabled">
           <bool>true</bool>
@@ -1256,11 +1161,37 @@
           <string/>
          </property>
          <property name="text">
-          <string>Outage to Reset Amb / Slip Thres</string>
+          <string>Outage to Reset Amb/Slip Thres (m)</string>
          </property>
         </widget>
        </item>
-       <item row="13" column="0">
+       <item row="5" column="1" colspan="2">
+        <widget class="QLineEdit" name="OutCntResetAmb">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>5</string>
+         </property>
+        </widget>
+       </item>
+       <item row="5" column="3" colspan="2">
+        <widget class="QLineEdit" name="SlipThres">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>0.05</string>
+         </property>
+        </widget>
+       </item>
+       <item row="6" column="0">
         <widget class="QLabel" name="Label14">
          <property name="enabled">
           <bool>true</bool>
@@ -1269,11 +1200,24 @@
           <string/>
          </property>
          <property name="text">
-          <string>Max Age of Diff / Sync Solution</string>
+          <string>Max Age of Diff (s) / Sync Solution</string>
          </property>
         </widget>
        </item>
-       <item row="13" column="3" colspan="2">
+       <item row="6" column="1" colspan="2">
+        <widget class="QLineEdit" name="MaxAgeDiff">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>30</string>
+         </property>
+        </widget>
+       </item>
+       <item row="6" column="3" colspan="2">
         <widget class="QComboBox" name="SyncSol">
          <property name="enabled">
           <bool>false</bool>
@@ -1298,7 +1242,7 @@
          </item>
         </widget>
        </item>
-       <item row="14" column="0">
+       <item row="7" column="0">
         <widget class="QLabel" name="Label11">
          <property name="enabled">
           <bool>true</bool>
@@ -1307,11 +1251,37 @@
           <string/>
          </property>
          <property name="text">
-          <string>Reject Threshold of GDOP / Innov</string>
+          <string>Reject Threshold of GDOP/Innov (m)</string>
          </property>
         </widget>
        </item>
-       <item row="17" column="0">
+       <item row="7" column="1" colspan="2">
+        <widget class="QLineEdit" name="RejectGdop">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>30</string>
+         </property>
+        </widget>
+       </item>
+       <item row="7" column="3" colspan="2">
+        <widget class="QLineEdit" name="RejectThres">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>30</string>
+         </property>
+        </widget>
+       </item>
+       <item row="8" column="0">
         <widget class="QLabel" name="Label37">
          <property name="enabled">
           <bool>true</bool>
@@ -1324,29 +1294,68 @@
          </property>
         </widget>
        </item>
-       <item row="19" column="1" colspan="2">
-        <widget class="QDoubleSpinBox" name="BaselineLen">
-         <property name="suffix">
-          <string> m</string>
+       <item row="8" column="1" colspan="2">
+        <widget class="QLineEdit" name="ARIter">
+         <property name="enabled">
+          <bool>true</bool>
          </property>
-         <property name="decimals">
-          <number>3</number>
+         <property name="toolTip">
+          <string/>
          </property>
-         <property name="maximum">
-          <double>10000.000000000000000</double>
+         <property name="text">
+          <string>1</string>
          </property>
         </widget>
        </item>
-       <item row="19" column="3" colspan="2">
-        <widget class="QDoubleSpinBox" name="BaselineSig">
-         <property name="suffix">
-          <string> m</string>
+       <item row="8" column="3" colspan="2">
+        <widget class="QLineEdit" name="NumIter">
+         <property name="enabled">
+          <bool>true</bool>
          </property>
-         <property name="decimals">
-          <number>3</number>
+         <property name="toolTip">
+          <string/>
          </property>
-         <property name="value">
-          <double>0.001000000000000</double>
+         <property name="text">
+          <string>1</string>
+         </property>
+        </widget>
+       </item>
+       <item row="9" column="0">
+        <widget class="QCheckBox" name="BaselineConst">
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>Baseline Length Constraint (m)</string>
+         </property>
+         <property name="checked">
+          <bool>false</bool>
+         </property>
+        </widget>
+       </item>
+       <item row="9" column="1" colspan="2">
+        <widget class="QLineEdit" name="BaselineLen">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>0.0</string>
+         </property>
+        </widget>
+       </item>
+       <item row="9" column="3" colspan="2">
+        <widget class="QLineEdit" name="BaselineSig">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>0.001</string>
          </property>
         </widget>
        </item>
@@ -1360,16 +1369,6 @@
        <string>O&amp;utput</string>
       </attribute>
       <layout class="QGridLayout" name="gridLayout_3">
-       <item row="3" column="3">
-        <widget class="QSpinBox" name="TimeDecimal">
-         <property name="maximum">
-          <number>20</number>
-         </property>
-         <property name="value">
-          <number>3</number>
-         </property>
-        </widget>
-       </item>
        <item row="0" column="0">
         <widget class="QLabel" name="LabelSolFormat">
          <property name="enabled">
@@ -1422,7 +1421,7 @@
           <string/>
          </property>
          <property name="text">
-          <string>Output Header / Output Processing Options</string>
+          <string>Output Header/Processing Options</string>
          </property>
         </widget>
        </item>
@@ -1466,7 +1465,7 @@
          </item>
         </widget>
        </item>
-       <item row="3" column="0">
+       <item row="2" column="0">
         <widget class="QLabel" name="LabelTimeFormat">
          <property name="enabled">
           <bool>true</bool>
@@ -1479,7 +1478,7 @@
          </property>
         </widget>
        </item>
-       <item row="3" column="1" colspan="2">
+       <item row="2" column="1" colspan="2">
         <widget class="QComboBox" name="TimeFormat">
          <property name="enabled">
           <bool>true</bool>
@@ -1509,7 +1508,20 @@
          </item>
         </widget>
        </item>
-       <item row="4" column="0">
+       <item row="2" column="3">
+        <widget class="QLineEdit" name="TimeDecimal">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>3</string>
+         </property>
+        </widget>
+       </item>
+       <item row="3" column="0">
         <widget class="QLabel" name="LabelLatLonFormat">
          <property name="enabled">
           <bool>true</bool>
@@ -1518,11 +1530,31 @@
           <string/>
          </property>
          <property name="text">
-          <string>Latitude Longitude Format / Field Separator</string>
+          <string>Latitude / Longitude Format</string>
          </property>
         </widget>
        </item>
-       <item row="5" column="0">
+       <item row="3" column="1" colspan="3">
+        <widget class="QComboBox" name="LatLonFormat">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <item>
+          <property name="text">
+           <string>ddd.ddddddd</string>
+          </property>
+         </item>
+         <item>
+          <property name="text">
+           <string>ddd mm ss.sss</string>
+          </property>
+         </item>
+        </widget>
+       </item>
+       <item row="4" column="0">
         <widget class="QLabel" name="LabelFieldSep">
          <property name="enabled">
           <bool>true</bool>
@@ -1531,11 +1563,24 @@
           <string/>
          </property>
          <property name="text">
-          <string>Output Single if Sol Outage / Max Sol Std</string>
+          <string>Field Separator</string>
          </property>
         </widget>
        </item>
-       <item row="6" column="0">
+       <item row="4" column="1" colspan="3">
+        <widget class="QLineEdit" name="FieldSep">
+         <property name="enabled">
+          <bool>true</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string/>
+         </property>
+        </widget>
+       </item>
+       <item row="5" column="0">
         <widget class="QLabel" name="Label2">
          <property name="enabled">
           <bool>true</bool>
@@ -1544,11 +1589,11 @@
           <string/>
          </property>
          <property name="text">
-          <string>Datum / Height</string>
+          <string>Datum/Height</string>
          </property>
         </widget>
        </item>
-       <item row="6" column="1" colspan="2">
+       <item row="5" column="1">
         <widget class="QComboBox" name="OutputDatum">
          <property name="enabled">
           <bool>true</bool>
@@ -1563,7 +1608,7 @@
          </item>
         </widget>
        </item>
-       <item row="6" column="3">
+       <item row="5" column="2" colspan="2">
         <widget class="QComboBox" name="OutputHeight">
          <property name="enabled">
           <bool>true</bool>
@@ -1583,7 +1628,7 @@
          </item>
         </widget>
        </item>
-       <item row="7" column="0">
+       <item row="6" column="0">
         <widget class="QLabel" name="Label18">
          <property name="enabled">
           <bool>true</bool>
@@ -1596,7 +1641,7 @@
          </property>
         </widget>
        </item>
-       <item row="7" column="1" colspan="3">
+       <item row="6" column="1" colspan="3">
         <widget class="QComboBox" name="OutputGeoid">
          <property name="enabled">
           <bool>true</bool>
@@ -1631,7 +1676,7 @@
          </item>
         </widget>
        </item>
-       <item row="8" column="0">
+       <item row="7" column="0">
         <widget class="QLabel" name="Label31">
          <property name="enabled">
           <bool>true</bool>
@@ -1644,7 +1689,7 @@
          </property>
         </widget>
        </item>
-       <item row="8" column="1" colspan="3">
+       <item row="7" column="1" colspan="3">
         <widget class="QComboBox" name="SolStatic">
          <property name="enabled">
           <bool>true</bool>
@@ -1664,7 +1709,7 @@
          </item>
         </widget>
        </item>
-       <item row="10" column="0">
+       <item row="8" column="0">
         <widget class="QLabel" name="Label21">
          <property name="enabled">
           <bool>false</bool>
@@ -1677,7 +1722,33 @@
          </property>
         </widget>
        </item>
-       <item row="11" column="0">
+       <item row="8" column="1">
+        <widget class="QLineEdit" name="NmeaIntv1">
+         <property name="enabled">
+          <bool>false</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>0</string>
+         </property>
+        </widget>
+       </item>
+       <item row="8" column="2" colspan="2">
+        <widget class="QLineEdit" name="NmeaIntv2">
+         <property name="enabled">
+          <bool>false</bool>
+         </property>
+         <property name="toolTip">
+          <string/>
+         </property>
+         <property name="text">
+          <string>0</string>
+         </property>
+        </widget>
+       </item>
+       <item row="9" column="0">
         <widget class="QLabel" name="Label36">
          <property name="enabled">
           <bool>true</bool>
@@ -1686,11 +1757,11 @@
           <string/>
          </property>
          <property name="text">
-          <string>Output Solution Status / Output Debug Trace</string>
+          <string>Output Solution Status / Debug Trace</string>
          </property>
         </widget>
        </item>
-       <item row="11" column="1">
+       <item row="9" column="1">
         <widget class="QComboBox" name="DebugStatus">
          <property name="enabled">
           <bool>true</bool>
@@ -1715,7 +1786,7 @@
          </item>
         </widget>
        </item>
-       <item row="11" column="2" colspan="2">
+       <item row="9" column="2" colspan="2">
         <widget class="QComboBox" name="DebugTrace">
          <property name="enabled">
           <bool>true</bool>
@@ -1755,89 +1826,6 @@
          </item>
         </widget>
        </item>
-       <item row="4" column="1" colspan="2">
-        <widget class="QComboBox" name="LatLonFormat">
-         <property name="enabled">
-          <bool>true</bool>
-         </property>
-         <property name="toolTip">
-          <string/>
-         </property>
-         <property name="currentText">
-          <string>ddd.dddddd</string>
-         </property>
-         <item>
-          <property name="text">
-           <string>ddd.dddddd</string>
-          </property>
-         </item>
-         <item>
-          <property name="text">
-           <string>ddd mm ss.ss</string>
-          </property>
-         </item>
-        </widget>
-       </item>
-       <item row="4" column="3">
-        <widget class="QLineEdit" name="FieldSep">
-         <property name="enabled">
-          <bool>true</bool>
-         </property>
-         <property name="toolTip">
-          <string/>
-         </property>
-         <property name="text">
-          <string/>
-         </property>
-        </widget>
-       </item>
-       <item row="5" column="1" colspan="2">
-        <widget class="QComboBox" name="OutputSingle">
-         <item>
-          <property name="text">
-           <string>OFF</string>
-          </property>
-         </item>
-         <item>
-          <property name="text">
-           <string>ON</string>
-          </property>
-         </item>
-        </widget>
-       </item>
-       <item row="5" column="3">
-        <widget class="QDoubleSpinBox" name="MaxSolStd">
-         <property name="suffix">
-          <string> m</string>
-         </property>
-        </widget>
-       </item>
-       <item row="10" column="3">
-        <widget class="QDoubleSpinBox" name="NmeaIntv2">
-         <property name="enabled">
-          <bool>false</bool>
-         </property>
-         <property name="suffix">
-          <string> s</string>
-         </property>
-         <property name="maximum">
-          <double>3600.000000000000000</double>
-         </property>
-        </widget>
-       </item>
-       <item row="10" column="1" colspan="2">
-        <widget class="QDoubleSpinBox" name="NmeaIntv1">
-         <property name="enabled">
-          <bool>false</bool>
-         </property>
-         <property name="suffix">
-          <string> s</string>
-         </property>
-         <property name="maximum">
-          <double>3600.000000000000000</double>
-         </property>
-        </widget>
-       </item>
       </layout>
      </widget>
      <widget class="QWidget" name="TabSheet4">
@@ -1857,73 +1845,73 @@
           <string>Measurement Errors (1-sigma)</string>
          </property>
          <layout class="QGridLayout" name="gridLayout_4">
-          <item row="5" column="1" colspan="2">
-           <widget class="QDoubleSpinBox" name="MeasErr4">
-            <property name="suffix">
-             <string> m/10km</string>
+          <item row="0" column="1">
+           <widget class="QLineEdit" name="MeasErrR1">
+            <property name="enabled">
+             <bool>true</bool>
             </property>
-            <property name="decimals">
-             <number>3</number>
+            <property name="toolTip">
+             <string/>
+            </property>
+            <property name="text">
+             <string>100.0</string>
             </property>
            </widget>
           </item>
-          <item row="1" column="1">
-           <widget class="QDoubleSpinBox" name="MeasErrR1">
-            <property name="decimals">
-             <number>1</number>
+          <item row="0" column="2">
+           <widget class="QLineEdit" name="MeasErrR2">
+            <property name="enabled">
+             <bool>true</bool>
             </property>
-            <property name="maximum">
-             <double>10000.000000000000000</double>
+            <property name="toolTip">
+             <string/>
             </property>
-            <property name="value">
-             <double>100.000000000000000</double>
+            <property name="text">
+             <string>100.0</string>
             </property>
            </widget>
           </item>
-          <item row="1" column="2">
-           <widget class="QDoubleSpinBox" name="MeasErrR2">
-            <property name="decimals">
-             <number>1</number>
+          <item row="1" column="0">
+           <widget class="QLabel" name="Label7">
+            <property name="enabled">
+             <bool>true</bool>
             </property>
-            <property name="maximum">
-             <double>10000.000000000000000</double>
+            <property name="toolTip">
+             <string/>
             </property>
-            <property name="value">
-             <double>100.000000000000000</double>
+            <property name="text">
+             <string>Carrier-Phase Error a+b/sinEl (m)</string>
             </property>
            </widget>
           </item>
-          <item row="3" column="1">
-           <widget class="QDoubleSpinBox" name="MeasErr2">
-            <property name="suffix">
-             <string> m</string>
-            </property>
-            <property name="decimals">
-             <number>3</number>
+          <item row="1" column="1">
+           <widget class="QLineEdit" name="MeasErr2">
+            <property name="enabled">
+             <bool>true</bool>
             </property>
-            <property name="maximum">
-             <double>100.000000000000000</double>
+            <property name="toolTip">
+             <string/>
             </property>
-            <property name="value">
-             <double>0.003000000000000</double>
+            <property name="text">
+             <string>0.003</string>
             </property>
            </widget>
           </item>
-          <item row="3" column="2">
-           <widget class="QDoubleSpinBox" name="MeasErr3">
-            <property name="suffix">
-             <string> m</string>
+          <item row="1" column="2">
+           <widget class="QLineEdit" name="MeasErr3">
+            <property name="enabled">
+             <bool>true</bool>
             </property>
-            <property name="decimals">
-             <number>3</number>
+            <property name="toolTip">
+             <string/>
             </property>
-            <property name="value">
-             <double>0.003000000000000</double>
+            <property name="text">
+             <string>0.003</string>
             </property>
            </widget>
           </item>
-          <item row="3" column="0">
-           <widget class="QLabel" name="Label7">
+          <item row="2" column="0">
+           <widget class="QLabel" name="Label16">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1931,12 +1919,12 @@
              <string/>
             </property>
             <property name="text">
-             <string>Carrier-Phase Error a+b/sinEl</string>
+             <string>Carrier-Phase Error/Baseline (m/10km)</string>
             </property>
            </widget>
           </item>
-          <item row="5" column="0">
-           <widget class="QLabel" name="Label16">
+          <item row="2" column="1" colspan="2">
+           <widget class="QLineEdit" name="MeasErr4">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1944,11 +1932,11 @@
              <string/>
             </property>
             <property name="text">
-             <string>Carrier-Phase Error/Baseline</string>
+             <string>0.000</string>
             </property>
            </widget>
           </item>
-          <item row="7" column="0">
+          <item row="3" column="0">
            <widget class="QLabel" name="Label64">
             <property name="enabled">
              <bool>true</bool>
@@ -1957,12 +1945,12 @@
              <string/>
             </property>
             <property name="text">
-             <string>Doppler Frequency</string>
+             <string>Doppler Frequency (Hz)</string>
             </property>
            </widget>
           </item>
-          <item row="1" column="0">
-           <widget class="QLabel" name="Label6">
+          <item row="3" column="1" colspan="2">
+           <widget class="QLineEdit" name="MeasErr5">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -1970,20 +1958,20 @@
              <string/>
             </property>
             <property name="text">
-             <string>Code/Carrier-Phase Error Ratio L1/L2</string>
+             <string>0.100</string>
             </property>
            </widget>
           </item>
-          <item row="7" column="1" colspan="2">
-           <widget class="QDoubleSpinBox" name="MeasErr5">
-            <property name="suffix">
-             <string> Hz</string>
+          <item row="0" column="0">
+           <widget class="QLabel" name="Label6">
+            <property name="enabled">
+             <bool>true</bool>
             </property>
-            <property name="decimals">
-             <number>3</number>
+            <property name="toolTip">
+             <string/>
             </property>
-            <property name="value">
-             <double>0.100000000000000</double>
+            <property name="text">
+             <string>Code/Carrier-Phase Error Ratio L1/L2</string>
             </property>
            </widget>
           </item>
@@ -2323,7 +2311,7 @@
             </item>
             <item>
              <property name="text">
-              <string>RINEX Header Position</string>
+              <string>RINEX Header Postion</string>
              </property>
             </item>
            </widget>
@@ -2383,17 +2371,7 @@
             </property>
            </widget>
           </item>
-          <item row="3" column="0">
-           <widget class="QComboBox" name="RefAnt">
-            <property name="enabled">
-             <bool>true</bool>
-            </property>
-            <property name="toolTip">
-             <string/>
-            </property>
-           </widget>
-          </item>
-          <item row="2" column="0">
+          <item row="2" column="0" colspan="2">
            <widget class="QCheckBox" name="RefAntPcv">
             <property name="toolTip">
              <string/>
@@ -2406,7 +2384,7 @@
             </property>
            </widget>
           </item>
-          <item row="2" column="1">
+          <item row="2" column="2" colspan="3">
            <widget class="QLabel" name="LabelRefAntD">
             <property name="enabled">
              <bool>true</bool>
@@ -2415,46 +2393,56 @@
              <string/>
             </property>
             <property name="text">
-             <string>Delta-E/N/U</string>
+             <string>Delta-E/N/U (m)</string>
             </property>
            </widget>
           </item>
-          <item row="3" column="1">
-           <widget class="QDoubleSpinBox" name="RefAntE">
-            <property name="suffix">
-             <string> m</string>
-            </property>
-            <property name="decimals">
-             <number>4</number>
+          <item row="3" column="0" colspan="2">
+           <widget class="QComboBox" name="RefAnt">
+            <property name="enabled">
+             <bool>true</bool>
             </property>
-            <property name="maximum">
-             <double>1000.000000000000000</double>
+            <property name="toolTip">
+             <string/>
             </property>
            </widget>
           </item>
           <item row="3" column="2" colspan="2">
-           <widget class="QDoubleSpinBox" name="RefAntN">
-            <property name="suffix">
-             <string> m</string>
+           <widget class="QLineEdit" name="RefAntE">
+            <property name="enabled">
+             <bool>true</bool>
             </property>
-            <property name="decimals">
-             <number>4</number>
+            <property name="toolTip">
+             <string/>
             </property>
-            <property name="maximum">
-             <double>1000.000000000000000</double>
+            <property name="text">
+             <string>0</string>
             </property>
            </widget>
           </item>
-          <item row="3" column="4" colspan="2">
-           <widget class="QDoubleSpinBox" name="RefAntU">
-            <property name="suffix">
-             <string> m</string>
+          <item row="3" column="4">
+           <widget class="QLineEdit" name="RefAntN">
+            <property name="enabled">
+             <bool>true</bool>
             </property>
-            <property name="decimals">
-             <number>4</number>
+            <property name="toolTip">
+             <string/>
             </property>
-            <property name="maximum">
-             <double>1000.000000000000000</double>
+            <property name="text">
+             <string>0</string>
+            </property>
+           </widget>
+          </item>
+          <item row="3" column="5">
+           <widget class="QLineEdit" name="RefAntU">
+            <property name="enabled">
+             <bool>true</bool>
+            </property>
+            <property name="toolTip">
+             <string/>
+            </property>
+            <property name="text">
+             <string>0</string>
             </property>
            </widget>
           </item>
@@ -2571,44 +2559,44 @@
             </property>
            </widget>
           </item>
-          <item row="4" column="0">
-           <widget class="QComboBox" name="RovAnt">
-            <property name="enabled">
-             <bool>true</bool>
-            </property>
+          <item row="2" column="0" colspan="2">
+           <widget class="QCheckBox" name="RovAntPcv">
             <property name="toolTip">
              <string/>
             </property>
-           </widget>
-          </item>
-          <item row="4" column="1">
-           <widget class="QDoubleSpinBox" name="RovAntE">
-            <property name="suffix">
-             <string> m</string>
-            </property>
-            <property name="decimals">
-             <number>4</number>
+            <property name="text">
+             <string>Antenna Type (*: Auto)</string>
             </property>
-            <property name="maximum">
-             <double>1000.000000000000000</double>
+            <property name="checked">
+             <bool>false</bool>
             </property>
            </widget>
           </item>
-          <item row="2" column="0">
-           <widget class="QCheckBox" name="RovAntPcv">
+          <item row="2" column="2" colspan="3">
+           <widget class="QLabel" name="LabelRovAntD">
+            <property name="enabled">
+             <bool>true</bool>
+            </property>
             <property name="toolTip">
              <string/>
             </property>
             <property name="text">
-             <string>Antenna Type (*: Auto)</string>
+             <string>Delta-E/N/U (m)</string>
             </property>
-            <property name="checked">
-             <bool>false</bool>
+           </widget>
+          </item>
+          <item row="3" column="0" colspan="2">
+           <widget class="QComboBox" name="RovAnt">
+            <property name="enabled">
+             <bool>true</bool>
+            </property>
+            <property name="toolTip">
+             <string/>
             </property>
            </widget>
           </item>
-          <item row="2" column="1">
-           <widget class="QLabel" name="LabelRovAntD">
+          <item row="3" column="2" colspan="2">
+           <widget class="QLineEdit" name="RovAntE">
             <property name="enabled">
              <bool>true</bool>
             </property>
@@ -2616,30 +2604,33 @@
              <string/>
             </property>
             <property name="text">
-             <string>Delta-E/N/U</string>
+             <string>0</string>
             </property>
            </widget>
           </item>
-          <item row="4" column="2" colspan="2">
-           <widget class="QDoubleSpinBox" name="RovAntN">
-            <property name="suffix">
-             <string> m</string>
+          <item row="3" column="4">
+           <widget class="QLineEdit" name="RovAntN">
+            <property name="enabled">
+             <bool>true</bool>
             </property>
-            <property name="decimals">
-             <number>4</number>
+            <property name="toolTip">
+             <string/>
             </property>
-            <property name="maximum">
-             <double>1000.000000000000000</double>
+            <property name="text">
+             <string>0</string>
             </property>
            </widget>
           </item>
-          <item row="4" column="4" colspan="2">
-           <widget class="QDoubleSpinBox" name="RovAntU">
-            <property name="decimals">
-             <number>4</number>
+          <item row="3" column="5">
+           <widget class="QLineEdit" name="RovAntU">
+            <property name="enabled">
+             <bool>true</bool>
             </property>
-            <property name="maximum">
-             <double>1000.000000000000000</double>
+            <property name="toolTip">
+             <string/>
+            </property>
+            <property name="text">
+             <string>0</string>
             </property>
            </widget>
           </item>
@@ -3416,139 +3407,6 @@
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>BtnExtOpt</tabstop>
-  <tabstop>BtnLoad</tabstop>
-  <tabstop>BtnSave</tabstop>
-  <tabstop>BtnOk</tabstop>
-  <tabstop>BtnCancel</tabstop>
-  <tabstop>Misc</tabstop>
-  <tabstop>PosMode</tabstop>
-  <tabstop>Freq</tabstop>
-  <tabstop>Solution</tabstop>
-  <tabstop>ElMask</tabstop>
-  <tabstop>BtnMask</tabstop>
-  <tabstop>DynamicModel</tabstop>
-  <tabstop>TideCorr</tabstop>
-  <tabstop>IonoOpt</tabstop>
-  <tabstop>TropOpt</tabstop>
-  <tabstop>SatEphem</tabstop>
-  <tabstop>PosOpt1</tabstop>
-  <tabstop>PosOpt2</tabstop>
-  <tabstop>PosOpt3</tabstop>
-  <tabstop>PosOpt4</tabstop>
-  <tabstop>PosOpt5</tabstop>
-  <tabstop>PosOpt6</tabstop>
-  <tabstop>ExSats</tabstop>
-  <tabstop>NavSys1</tabstop>
-  <tabstop>NavSys2</tabstop>
-  <tabstop>NavSys3</tabstop>
-  <tabstop>NavSys4</tabstop>
-  <tabstop>NavSys5</tabstop>
-  <tabstop>NavSys6</tabstop>
-  <tabstop>NavSys7</tabstop>
-  <tabstop>AmbRes</tabstop>
-  <tabstop>GloAmbRes</tabstop>
-  <tabstop>BdsAmbRes</tabstop>
-  <tabstop>ValidThresAR</tabstop>
-  <tabstop>ThresAR2</tabstop>
-  <tabstop>ThresAR3</tabstop>
-  <tabstop>LockCntFixAmb</tabstop>
-  <tabstop>ElMaskAR</tabstop>
-  <tabstop>FixCntHoldAmb</tabstop>
-  <tabstop>ElMaskHold</tabstop>
-  <tabstop>OutCntResetAmb</tabstop>
-  <tabstop>SlipThres</tabstop>
-  <tabstop>MaxAgeDiff</tabstop>
-  <tabstop>SyncSol</tabstop>
-  <tabstop>RejectGdop</tabstop>
-  <tabstop>RejectThres</tabstop>
-  <tabstop>ARIter</tabstop>
-  <tabstop>NumIter</tabstop>
-  <tabstop>BaselineConst</tabstop>
-  <tabstop>BaselineLen</tabstop>
-  <tabstop>BaselineSig</tabstop>
-  <tabstop>SolFormat</tabstop>
-  <tabstop>OutputHead</tabstop>
-  <tabstop>OutputOpt</tabstop>
-  <tabstop>TimeFormat</tabstop>
-  <tabstop>TimeDecimal</tabstop>
-  <tabstop>LatLonFormat</tabstop>
-  <tabstop>FieldSep</tabstop>
-  <tabstop>OutputSingle</tabstop>
-  <tabstop>MaxSolStd</tabstop>
-  <tabstop>OutputDatum</tabstop>
-  <tabstop>OutputHeight</tabstop>
-  <tabstop>OutputGeoid</tabstop>
-  <tabstop>SolStatic</tabstop>
-  <tabstop>NmeaIntv1</tabstop>
-  <tabstop>NmeaIntv2</tabstop>
-  <tabstop>DebugStatus</tabstop>
-  <tabstop>DebugTrace</tabstop>
-  <tabstop>MeasErrR1</tabstop>
-  <tabstop>MeasErrR2</tabstop>
-  <tabstop>MeasErr2</tabstop>
-  <tabstop>MeasErr3</tabstop>
-  <tabstop>MeasErr4</tabstop>
-  <tabstop>MeasErr5</tabstop>
-  <tabstop>PrNoise4</tabstop>
-  <tabstop>PrNoise5</tabstop>
-  <tabstop>PrNoise1</tabstop>
-  <tabstop>PrNoise2</tabstop>
-  <tabstop>PrNoise3</tabstop>
-  <tabstop>SatClkStab</tabstop>
-  <tabstop>RovPosType</tabstop>
-  <tabstop>BtnRovPos</tabstop>
-  <tabstop>RovPos1</tabstop>
-  <tabstop>RovPos2</tabstop>
-  <tabstop>RovPos3</tabstop>
-  <tabstop>RovAntPcv</tabstop>
-  <tabstop>RovAnt</tabstop>
-  <tabstop>RovAntE</tabstop>
-  <tabstop>RovAntN</tabstop>
-  <tabstop>RovAntU</tabstop>
-  <tabstop>RefPosType</tabstop>
-  <tabstop>BtnRefPos</tabstop>
-  <tabstop>RefPos1</tabstop>
-  <tabstop>RefPos2</tabstop>
-  <tabstop>RefPos3</tabstop>
-  <tabstop>RefAntPcv</tabstop>
-  <tabstop>RefAnt</tabstop>
-  <tabstop>RefAntE</tabstop>
-  <tabstop>RefAntN</tabstop>
-  <tabstop>RefAntU</tabstop>
-  <tabstop>StaPosFile</tabstop>
-  <tabstop>BtnStaPosView</tabstop>
-  <tabstop>BtnStaPosFile</tabstop>
-  <tabstop>BtnSatPcvView</tabstop>
-  <tabstop>BtnAntPcvView</tabstop>
-  <tabstop>SatPcvFile</tabstop>
-  <tabstop>BtnSatPcvFile</tabstop>
-  <tabstop>AntPcvFile</tabstop>
-  <tabstop>BtnAntPcvFile</tabstop>
-  <tabstop>GeoidDataFile</tabstop>
-  <tabstop>BtnGeoidDataFile</tabstop>
-  <tabstop>DCBFile</tabstop>
-  <tabstop>BtnDCBView</tabstop>
-  <tabstop>BtnDCBFile</tabstop>
-  <tabstop>EOPFile</tabstop>
-  <tabstop>BtnEOPView</tabstop>
-  <tabstop>BtnEOPFile</tabstop>
-  <tabstop>BLQFile</tabstop>
-  <tabstop>BtnBLQFileView</tabstop>
-  <tabstop>BtnBLQFile</tabstop>
-  <tabstop>IonoFile</tabstop>
-  <tabstop>BtnIonoFile</tabstop>
-  <tabstop>IntpRefObs</tabstop>
-  <tabstop>ComboBox1</tabstop>
-  <tabstop>SbasSat</tabstop>
-  <tabstop>RnxOpts1</tabstop>
-  <tabstop>RnxOpts2</tabstop>
-  <tabstop>PPPOpts</tabstop>
-  <tabstop>BtnHelp</tabstop>
-  <tabstop>RovList</tabstop>
-  <tabstop>BaseList</tabstop>
- </tabstops>
  <resources>
   <include location="../rtkconv_qt/rtkconv_qt.qrc"/>
  </resources>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/rtkpost.cpp RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/rtkpost.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/rtkpost.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/rtkpost.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -5,7 +5,6 @@
 {
     QApplication a(argc, argv);
     MainForm w;
-
     w.show();
 
     return a.exec();
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/rtkpost_qt.pro RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/rtkpost_qt.pro
--- RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/rtkpost_qt.pro	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/rtkpost_qt.pro	2019-08-19 02:04:50.000000000 +0300
@@ -6,12 +6,33 @@
 
 QT       += widgets core gui
 
-include(../app.pri)
+greaterThan(QT_MAJOR_VERSION, 4) {
+    QT += widgets
+    DEFINES += QT5
+}
+
+include(../../RTKLib.pri)
 
 TARGET = rtkpost_qt
 TEMPLATE = app
 
-INCLUDEPATH += ../../src/ ../appcmn_qt
+INCLUDEPATH += ../../src/ ../appcmn_qt 
+
+linux{
+    RTKLIB =../../src/libRTKLib.a
+    LIBS += -lpng $${RTKLIB}
+}
+win32 {
+    CONFIG(debug) {
+        RTKLIB = ../../src/debug/libRTKLib.a
+    } else {
+        RTKLIB =../../src/release/libRTKLib.a
+    }
+
+    LIBS+= $${RTKLIB} -lWs2_32 -lwinmm
+}
+
+PRE_TARGETDEPS = $${RTKLIB}
 
 SOURCES += \ 
     extopt.cpp \
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/rtkpost_qt.qrc RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/rtkpost_qt.qrc
--- RTKLIB-rtklib_2.4.3_orig/app/rtkpost_qt/rtkpost_qt.qrc	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkpost_qt/rtkpost_qt.qrc	2019-08-19 02:04:50.000000000 +0300
@@ -90,9 +90,5 @@
         <file alias="wait6.bmp">../icon/wait6.bmp</file>
         <file alias="wait7.bmp">../icon/wait7.bmp</file>
         <file alias="wait8.bmp">../icon/wait8.bmp</file>
-        <file alias="start.bmp">../icon/start.bmp</file>
-        <file alias="up2.bmp">../icon/up2.bmp</file>
-        <file alias="stop2.bmp">../icon/stop2.bmp</file>
-        <file alias="anim1_red.bmp">../icon/anim1_red.bmp</file>
     </qresource>
 </RCC>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/cameraframegrabber.cpp RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/cameraframegrabber.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/cameraframegrabber.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/cameraframegrabber.cpp	1970-01-01 03:00:00.000000000 +0300
@@ -1,60 +0,0 @@
-#include "cameraframegrabber.h"
-
-CameraFrameGrabber::CameraFrameGrabber(QObject *parent) :
-    QAbstractVideoSurface(parent)
-{
-}
-
-QList<QVideoFrame::PixelFormat> CameraFrameGrabber::supportedPixelFormats(QAbstractVideoBuffer::HandleType handleType) const
-{
-    Q_UNUSED(handleType);
-    return QList<QVideoFrame::PixelFormat>()
-        << QVideoFrame::Format_ARGB32
-        << QVideoFrame::Format_ARGB32_Premultiplied
-        << QVideoFrame::Format_RGB32
-        << QVideoFrame::Format_RGB24
-        << QVideoFrame::Format_RGB565
-        << QVideoFrame::Format_RGB555
-        << QVideoFrame::Format_ARGB8565_Premultiplied
-        << QVideoFrame::Format_BGRA32
-        << QVideoFrame::Format_BGRA32_Premultiplied
-        << QVideoFrame::Format_BGR32
-        << QVideoFrame::Format_BGR24
-        << QVideoFrame::Format_BGR565
-        << QVideoFrame::Format_BGR555
-        << QVideoFrame::Format_BGRA5658_Premultiplied
-        << QVideoFrame::Format_AYUV444
-        << QVideoFrame::Format_AYUV444_Premultiplied
-        << QVideoFrame::Format_YUV444
-        << QVideoFrame::Format_YUV420P
-        << QVideoFrame::Format_YV12
-        << QVideoFrame::Format_UYVY
-        << QVideoFrame::Format_YUYV
-        << QVideoFrame::Format_NV12
-        << QVideoFrame::Format_NV21
-        << QVideoFrame::Format_IMC1
-        << QVideoFrame::Format_IMC2
-        << QVideoFrame::Format_IMC3
-        << QVideoFrame::Format_IMC4
-        << QVideoFrame::Format_Y8
-        << QVideoFrame::Format_Y16
-        << QVideoFrame::Format_Jpeg
-        << QVideoFrame::Format_CameraRaw
-        << QVideoFrame::Format_AdobeDng;
-}
-
-bool CameraFrameGrabber::present(const QVideoFrame &frame)
-{
-    if (frame.isValid()) {
-        QVideoFrame cloneFrame(frame);
-        cloneFrame.map(QAbstractVideoBuffer::ReadOnly);
-        const QImage image(cloneFrame.bits(),
-                           cloneFrame.width(),
-                           cloneFrame.height(),
-                           QVideoFrame::imageFormatFromPixelFormat(cloneFrame .pixelFormat()));
-        emit frameAvailable(image);
-        cloneFrame.unmap();
-        return true;
-    }
-    return false;
-}
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/cameraframegrabber.h RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/cameraframegrabber.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/cameraframegrabber.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/cameraframegrabber.h	1970-01-01 03:00:00.000000000 +0300
@@ -1,25 +0,0 @@
-#ifndef CAMERAFRAMEGRABBER_H
-#define CAMERAFRAMEGRABBER_H
-
-#include <QAbstractVideoSurface>
-#include <QList>
-
-class CameraFrameGrabber : public QAbstractVideoSurface
-{
-    Q_OBJECT
-public:
-    explicit CameraFrameGrabber(QObject *parent = 0);
-
-    QList<QVideoFrame::PixelFormat> supportedPixelFormats(QAbstractVideoBuffer::HandleType handleType) const;
-
-    bool present(const QVideoFrame &frame);
-
-signals:
-    void frameAvailable(QImage frame);
-
-public slots:
-
-};
-
-#endif // CAMERAFRAMEGRABBER_H
-
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/.gitignore RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/.gitignore
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/.gitignore	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/.gitignore	1970-01-01 03:00:00.000000000 +0300
@@ -1,12 +0,0 @@
-ui_*.h
-moc_*.cpp
-moc_*.h
-qrc*.cpp
-*.pro.user*
-Makefile*
-*.res
-rtknavi_qt
-rtknavi_qt.exe
-object_script*
-debug
-release
\ В конце файла нет новой строки
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/install.bat RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/install.bat
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/install.bat	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/install.bat	1970-01-01 03:00:00.000000000 +0300
@@ -1 +0,0 @@
-copy release\rtkvideo_qt.exe ..\..\..\RTKLIB_bin\bin
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/install.sh RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/install.sh
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/install.sh	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/install.sh	1970-01-01 03:00:00.000000000 +0300
@@ -1 +0,0 @@
-cp rtkvideo_qt ../../../RTKLIB_bin/bin
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/rtkvideo.cpp RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/rtkvideo.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/rtkvideo.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/rtkvideo.cpp	1970-01-01 03:00:00.000000000 +0300
@@ -1,13 +0,0 @@
-//---------------------------------------------------------------------------
-#include "videomain.h"
-#include <QApplication>
-
-int main(int argc, char *argv[])
-{
-    QApplication a(argc, argv);
-    MainForm w;
-
-    w.show();
-
-    return a.exec();
-}
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/rtkvideo_qt.pro RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/rtkvideo_qt.pro
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/rtkvideo_qt.pro	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/rtkvideo_qt.pro	1970-01-01 03:00:00.000000000 +0300
@@ -1,34 +0,0 @@
-#-------------------------------------------------
-#
-# Project created by QtCreator 2016-01-30T18:29:59
-#
-#-------------------------------------------------
-
-QT       += widgets core gui multimedia multimediawidgets
-
-include(../app.pri)
-
-TARGET = rtkvideo_qt
-TEMPLATE = app
-
-INCLUDEPATH += ../../src/ ../appcmn_qt
-
-SOURCES += \
-    videoopt.cpp \
-    videomain.cpp \ 
-    rtkvideo.cpp \
-    cameraframegrabber.cpp
-
-HEADERS  += \
-    videomain.h \
-    videoopt.h \
-    cameraframegrabber.h
-
-FORMS    += \
-    videomain.ui \
-    videoopt.ui
-
-RESOURCES += \
-    rtkvideo_qt.qrc
-
-#RC_FILE = rtkvideo_qt.rc
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/rtkvideo_qt.qrc RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/rtkvideo_qt.qrc
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/rtkvideo_qt.qrc	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/rtkvideo_qt.qrc	1970-01-01 03:00:00.000000000 +0300
@@ -1,96 +0,0 @@
-<RCC>
-    <qresource prefix="/icons">
-        <file alias="rtk1.bmp">../icon/rtk1.bmp</file>
-        <file alias="rtk2.bmp">../icon/rtk2.bmp</file>
-        <file alias="rtk3.bmp">../icon/rtk3.bmp</file>
-        <file alias="rtk4.bmp">../icon/rtk4.bmp</file>
-        <file alias="rtk5.bmp">../icon/rtk5.bmp</file>
-        <file alias="rtk6.bmp">../icon/rtk6.bmp</file>
-        <file alias="rtk7.bmp">../icon/rtk7.bmp</file>
-        <file alias="rtk8.bmp">../icon/rtk8.bmp</file>
-        <file alias="rtk8_tray.bmp">../icon/rtk8_tray.ico</file>
-        <file alias="rtk9.bmp">../icon/rtk9.bmp</file>
-        <file alias="point.bmp">../icon/point.bmp</file>
-        <file alias="tray0.bmp">../icon/tray0.bmp</file>
-        <file alias="tray1.bmp">../icon/tray1.bmp</file>
-        <file alias="tray2.bmp">../icon/tray2.bmp</file>
-    </qresource>
-    <qresource prefix="/buttons">
-        <file alias="arrow.bmp">../icon/arrow.bmp</file>
-        <file alias="arrow_r.bmp">../icon/arrow_r.bmp</file>
-        <file alias="down.bmp">../icon/down.bmp</file>
-        <file alias="map.bmp">../icon/map.bmp</file>
-        <file alias="norm.bmp">../icon/norm.bmp</file>
-        <file alias="pause.bmp">../icon/pause.bmp</file>
-        <file alias="rarrow.bmp">../icon/rarrow.bmp</file>
-        <file alias="reload.bmp">../icon/reload.bmp</file>
-        <file alias="scale.bmp">../icon/scale.bmp</file>
-        <file alias="sqr.bmp">../icon/sqr.bmp</file>
-        <file alias="status.bmp">../icon/status.bmp</file>
-        <file alias="stop.bmp">../icon/stop.bmp</file>
-        <file alias="svrarrow.bmp">../icon/svrarrow.bmp</file>
-        <file alias="toolbmp">../icon/tool.bmp</file>
-        <file alias="ttray.bmp">../icon/ttray.bmp</file>
-        <file alias="doc.bmp">../icon/doc.bmp</file>
-        <file alias="anim.bmp">../icon/anim.bmp</file>
-        <file alias="anim1.bmp">../icon/anim1.bmp</file>
-        <file alias="anim2.bmp">../icon/anim2.bmp</file>
-        <file alias="border.bmp">../icon/border.bmp</file>
-        <file alias="building.bmp">../icon/building.bmp</file>
-        <file alias="chart.bmp">../icon/chart.bmp</file>
-        <file alias="connect.bmp">../icon/connect.bmp</file>
-        <file alias="connect1.bmp">../icon/connect1.bmp</file>
-        <file alias="connect2.bmp">../icon/connect2.bmp</file>
-        <file alias="data1.bmp">../icon/data1.bmp</file>
-        <file alias="data01.bmp">../icon/data01.bmp</file>
-        <file alias="data2.bmp">../icon/data2.bmp</file>
-        <file alias="data02.bmp">../icon/data02.bmp</file>
-        <file alias="data03.bmp">../icon/data03.bmp</file>
-        <file alias="data04.bmp">../icon/data04.bmp</file>
-        <file alias="data12.bmp">../icon/data12.bmp</file>
-        <file alias="del.bmp">../icon/del.bmp</file>
-        <file alias="expand.bmp">../icon/expand.bmp</file>
-        <file alias="fitd.bmp">../icon/fitd.bmp</file>
-        <file alias="fith.bmp">../icon/fith.bmp</file>
-        <file alias="fitv.bmp">../icon/fitv.bmp</file>
-        <file alias="ge.bmp">../icon/ge.bmp</file>
-        <file alias="gm.bmp">../icon/gm.bmp</file>
-        <file alias="graph.bmp">../icon/graph.bmp</file>
-        <file alias="grid.bmp">../icon/grid.bmp</file>
-        <file alias="headup.bmp">../icon/headup.bmp</file>
-        <file alias="home.bmp">../icon/home.bmp</file>
-        <file alias="load.bmp">../icon/load.bmp</file>
-        <file alias="navctr.bmp">../icon/navctr.bmp</file>
-        <file alias="navi.bmp">../icon/navi.bmp</file>
-        <file alias="navi0.bmp">../icon/navi0.bmp</file>
-        <file alias="ori.bmp">../icon/ori.bmp</file>
-        <file alias="point.bmp">../icon/point.bmp</file>
-        <file alias="point.ico">../icon/point.ico</file>
-        <file alias="road.bmp">../icon/road.bmp</file>
-        <file alias="rotl.bmp">../icon/rotl.bmp</file>
-        <file alias="rotr.bmp">../icon/rotr.bmp</file>
-        <file alias="showp.bmp">../icon/showp.bmp</file>
-        <file alias="showt.bmp">../icon/showt.bmp</file>
-        <file alias="shrink.bmp">../icon/shrink.bmp</file>
-        <file alias="tilt.bmp">../icon/tilt.bmp</file>
-        <file alias="track.bmp">../icon/track.bmp</file>
-        <file alias="trackc.bmp">../icon/trackc.bmp</file>
-        <file alias="trackl.bmp">../icon/trackl.bmp</file>
-        <file alias="trackr.bmp">../icon/trackr.bmp</file>
-        <file alias="undu.bmp">../icon/undu.bmp</file>
-        <file alias="up.bmp">../icon/up.bmp</file>
-        <file alias="vmap.bmp">../icon/vmap.bmp</file>
-        <file alias="wait1.bmp">../icon/wait1.bmp</file>
-        <file alias="wait2.bmp">../icon/wait2.bmp</file>
-        <file alias="wait3.bmp">../icon/wait3.bmp</file>
-        <file alias="wait4.bmp">../icon/wait4.bmp</file>
-        <file alias="wait5.bmp">../icon/wait5.bmp</file>
-        <file alias="wait6.bmp">../icon/wait6.bmp</file>
-        <file alias="wait7.bmp">../icon/wait7.bmp</file>
-        <file alias="wait8.bmp">../icon/wait8.bmp</file>
-        <file alias="start.bmp">../icon/start.bmp</file>
-        <file alias="up2.bmp">../icon/up2.bmp</file>
-        <file alias="stop2.bmp">../icon/stop2.bmp</file>
-        <file alias="anim1_red.bmp">../icon/anim1_red.bmp</file>
-    </qresource>
-</RCC>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/rtkvideo_qt.rc RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/rtkvideo_qt.rc
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/rtkvideo_qt.rc	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/rtkvideo_qt.rc	1970-01-01 03:00:00.000000000 +0300
@@ -1 +0,0 @@
-IDI_ICON1               ICON    DISCARDABLE     "rtknavi_Icon.ico"
\ В конце файла нет новой строки
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/videomain.cpp RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/videomain.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/videomain.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/videomain.cpp	1970-01-01 03:00:00.000000000 +0300
@@ -1,301 +0,0 @@
-//---------------------------------------------------------------------------
-// rtkvideo : video capture
-//
-//          Copyright (C) 2016 by T.TAKASU, All rights reserved.
-//          ported to Qt by Jens Reimann
-//
-// version : $Revision:$ $Date:$
-// history : 2016/09/25 1.0 new
-//---------------------------------------------------------------------------
-
-#include <QShowEvent>
-#include <QCloseEvent>
-#include <QCameraInfo>
-#include <QSettings>
-#include <QFileInfo>
-#include <QMessageBox>
-#include <QPainter>
-#include <QBuffer>
-#include <QDebug>
-
-#include "videomain.h"
-#include "videoopt.h"
-#include "cameraframegrabber.h"
-
-#define DEFAULT_TCP_PORT 10033
-#define DEFAULT_CAP_WIDTH 500
-#define DEFAULT_CAP_HEIGHT 500
-
-#define STR_BUF_SIZE 4096000
-
-#define MIN_WINDOW_WIDTH  320
-#define MIN_WINDOW_HEIGHT 240
-
-#define PRGNAME     "RTKVIDEO_QT"
-
-#define MIN(x,y)    ((x)<(y)?(x):(y))
-
-extern "C" {
-extern int showmsg(const char *, ...)  {return 0;}
-extern void settime(gtime_t) {}
-extern void settspan(gtime_t, gtime_t) {}
-}
-
-MainForm *mainForm;
-
-//---------------------------------------------------------------------------
-MainForm::MainForm(QWidget *parent)
-    : QDialog(parent)
-{
-    setupUi(this);
-    mainForm = this;
-
-    QString file = QApplication::applicationFilePath();
-    QFileInfo fi(file);
-    IniFile = fi.absolutePath() + "/" + fi.baseName() + ".ini";
-
-    camera = NULL;
-    StartTime.time = 0;
-    CaptureTime.time = 0;
-    Video_Width = Video_Height = FrameCount = FrameCount0 = FrameRate = 0;
-    DevName = "";
-    OutFile = "";
-    Profile = 0;
-    TcpPortEna = OutFileEna = OutTimeTag = FileSwap = 0;
-    TcpPortNo = DEFAULT_TCP_PORT;
-
-    setWindowTitle(QString("%1 ver. %2 %3").arg(PRGNAME).arg(VER_RTKLIB).arg(PATCH_LEVEL));
-    videoOptDlg = new VideoOptDlg(this);
-
-    connect(BtnStart, SIGNAL(clicked(bool)), this, SLOT(BtnStartClick()));
-    connect(BtnStop, SIGNAL(clicked(bool)), this, SLOT(BtnStopClick()));
-    connect(BtnExit, SIGNAL(clicked(bool)), this, SLOT(BtnExitClick()));
-    connect(BtnOpt, SIGNAL(clicked(bool)), this, SLOT(BtnOptClick()));
-
-    BtnStop->setEnabled(false);
-    Time.start();
-}
-//---------------------------------------------------------------------------
-void MainForm::showEvent(QShowEvent *event)
-{
-    if (event->spontaneous()) return;
-
-    const int str_opt[8] = {0, 0, 0, STR_BUF_SIZE, 0};
-    
-    LoadOptions();
-    
-    DevName = QCameraInfo::defaultCamera().deviceName();
-    camera = new QCamera(DevName.toLatin1(),this);
-    
-    strsetopt(str_opt);
-    
-    for (int i = 0; i < 2; i++) {
-        strinit(OutputStream+i);
-    }
-    initlock(&DeviceLock);
-}
-//---------------------------------------------------------------------------
-void MainForm::closeEvent(QCloseEvent *)
-{
-    if (camera && camera->status()==QCamera::ActiveStatus) {
-        camera->stop();
-    }
-    SaveOptions();
-    
-}
-//---------------------------------------------------------------------------
-void MainForm::BtnStartClick()
-{
-    if (!CaptureStart()) return;
-    
-    BtnStart->setEnabled(false);
-    BtnStop ->setEnabled(true);
-    BtnOpt  ->setEnabled(false);
-    BtnExit ->setEnabled(false);
-}
-//---------------------------------------------------------------------------
-void MainForm::BtnStopClick()
-{
-    CaptureStop();
-    
-    BtnStart->setEnabled(true);
-    BtnStop ->setEnabled(false);
-    BtnOpt  ->setEnabled(true);
-    BtnExit ->setEnabled(true);
-}
-//---------------------------------------------------------------------------
-void MainForm::BtnOptClick()
-{    
-    if (videoOptDlg->exec() != QDialog::Accepted) return;
-}
-//---------------------------------------------------------------------------
-void MainForm::BtnExitClick()
-{
-    close();
-}
-//---------------------------------------------------------------------------
-int MainForm::CaptureStart(void)
-{
-    const char *swap[] = {
-        "", "::S=0.05", "::S=0.1", "::S=0.25", "::S=0.5", "::S=1", "::S=2"
-    };
-    camera = new QCamera(DevName.toLatin1());
-
-    if (!camera->isAvailable()) return -1;
-
-    camera->setViewfinderSettings(videoSettings);
-    camera->setCaptureMode(QCamera::CaptureVideo);
-
-    if (TcpPortEna) {
-        if (!stropen(OutputStream, STR_TCPSVR, STR_MODE_RW, qPrintable(QString::number(TcpPortNo)))) {
-            Message3->setText(tr("tcp port open error"));
-        }
-    }
-    if (OutFileEna && OutFile != "") {
-        QString outfile = OutFile + (OutTimeTag ? "::T" : "") + swap[FileSwap];
-        if (!stropen(OutputStream + 1, STR_FILE, STR_MODE_W, qPrintable(outfile))) {
-            Message3->setText (tr("file open error"));
-        }
-    }
-
-    cameraFrameGrabber = new CameraFrameGrabber();
-    camera->setViewfinder(cameraFrameGrabber);
-
-    connect(cameraFrameGrabber, SIGNAL(frameAvailable(QImage)), this, SLOT(SampleBufferSync(QImage)));
-
-    StartTime = utc2gpst(timeget());
-    StartTick = tickget();
-
-    camera->start();
-    return 1;
-}
-//---------------------------------------------------------------------------
-void MainForm::CaptureStop(void)
-{    
-    camera->stop();
-    
-    for (int i = 0; i < 2; i++) {
-        strclose(OutputStream + i);
-    }
-}
-//---------------------------------------------------------------------------
-void MainForm::SampleBufferSync(QImage videoFrame)
-{
-    static int Timer_Count = 0;
-
-    QColor color[] = {
-        Qt::red, QColor(0xFF,0x40,0x40), QColor(0xFF,0xFF,0xA5), Qt::green, QColor(0xff,0x00,0xff)
-    };
-    QString msg;
-    char str_msg[4096],*p,*q;
-    int outb = 0, outr = 0;
-
-    QString str;
-        
-    CaptureTime = utc2gpst(timeget());
-    CaptureTick = tickget();
-    FrameCount++;
-
-    if (TcpPortEna || OutFileEna) {
-        QImage sentFrame=videoFrame;
-
-        QPainter c(&sentFrame);
-
-        if (CaptionPos)
-        {
-            static const int aligns[] = {
-                    Qt::AlignLeading, Qt::AlignCenter, Qt::AlignTrailing
-            };
-
-            str=QString("%1 T=%2 s TICK=%3 FRM=%4").arg(time_str(CaptureTime,3)).arg((CaptureTick-StartTick)*1e-3,0,'f',3).arg(CaptureTick).arg(FrameCount);
-
-            c.setPen(CaptionColor);
-            c.setFont(QFont(qApp->font().family(),CaptionSize));
-            c.drawText(videoFrame.rect(), aligns[CaptionPos-1]|Qt::AlignTop, str_msg);
-        }
-
-        QBuffer buff;
-
-        sentFrame.save(&buff, "JPEG");
-        
-        
-        for (int i = 0; i < 2; i++) {
-            strwrite(OutputStream + i, (unsigned char *)buff.data().constData(), buff.data().size());
-        }
-    }
-    QPainter c(&videoFrame);
-
-    c.setPen(color[strstat(OutputStream, str_msg)+1]);
-    strsum(OutputStream, NULL, NULL, NULL, &outr);
-    msg = QString("%1Mbps %2").arg(outr / 1e6, 4, 'f', 1).arg(str_msg);
-    QRect rect = videoFrame.rect();
-    rect.setHeight(rect.height() - c.boundingRect(videoFrame.rect(), "T").height() - 5); // decrease size by one line (+spacing)
-    c.drawText(rect, Qt::AlignBottom|Qt::AlignLeft, msg);
-
-    c.setPen(color[strstat(OutputStream + 1, str_msg) + 1]);
-    strsum(OutputStream + 1, NULL, NULL, &outb, NULL);
-    msg = QString("%1MB").arg(outb / 1e6, 4, 'f', 1);
-    strstatx(OutputStream + 1, str_msg);
-    if ((p = strstr(str_msg, "openpath=")) && (q = strchr(p + 9, '\n'))) {
-        *q = '\0';
-        msg += p + 9;
-    }
-    c.drawText(videoFrame.rect(), Qt::AlignBottom|Qt::AlignLeft, msg);
-
-    c.setPen(CaptionColor);
-    if (++Timer_Count * Time.elapsed() >= 1000) {
-        FrameRate = FrameCount - FrameCount0;
-        FrameCount0 = FrameCount;
-        Timer_Count = 0;
-        Time.restart();
-    }
-    msg = QString("%1 x %2 FRM=%3 FPS=%4").arg(videoFrame.width()).arg(videoFrame.height()).arg(FrameCount).arg(FrameRate, 2);
-    c.drawText(videoFrame.rect(), Qt::AlignBottom|Qt::AlignRight, msg);
-    
-    time2str(utc2gpst(timeget()), str_msg, 1);
-    c.drawText(videoFrame.rect(), Qt::AlignTop|Qt::AlignLeft, str_msg);
-    
-    msg = QString("T = %1 s TICK=%2").arg((CaptureTick - StartTick) * 1e-3, 0, 'f', 1).arg(CaptureTick);
-    c.drawText(videoFrame.rect(), Qt::AlignTop|Qt::AlignRight, msg);
-
-    // show image in monitor
-    Disp->setPixmap(QPixmap::fromImage(videoFrame));
-}
-//---------------------------------------------------------------------------
-void MainForm::LoadOptions(void)
-{
-    QSettings settings(IniFile, QSettings::IniFormat);
-
-    CaptionSize = settings.value("videoopt/captionsize", 24).toInt();
-    CaptionColor = settings.value("videoopt/captioncolor", QColor(Qt::red)).value<QColor>();
-    TcpPortEna = settings.value("videoopt/tcpportena", 0).toInt();
-    TcpPortNo = settings.value("videoopt/tcpportno", 10033).toInt();
-    OutFileEna = settings.value("videoopt/outfileena", 0).toInt();
-    OutFile = settings.value("videoopt/outfile", "").toString();
-    OutTimeTag = settings.value("videoopt/outtimetag", 0).toInt();
-    FileSwap = settings.value("videoopt/fileswap", 0).toInt();
-    CaptionPos = settings.value("videoopt/captionpos", 2).toInt();
-    CodecQuality = settings.value("videoopt/codecquality", 90).toInt();
-}
-//---------------------------------------------------------------------------
-void MainForm::SaveOptions(void)
-{
-    QSettings settings(IniFile, QSettings::IniFormat);
-
-    settings.setValue("videoopt/capsize", CaptionSize);
-    settings.setValue("videoopt/captioncolor", CaptionColor);
-    settings.setValue("videoopt/tcpportena", TcpPortEna);
-    settings.setValue("videoopt/tcpportno", TcpPortNo);
-    settings.setValue("videoopt/outfileena", OutFileEna);
-    settings.setValue("videoopt/outfile", OutFile);
-    settings.setValue("videoopt/outtimetag", OutTimeTag);
-    settings.setValue("videoopt/fileswap", FileSwap);
-    settings.setValue("videoopt/captionpos", CaptionPos);
-    settings.setValue("videoopt/codecquality", CodecQuality);
-
-}
-//---------------------------------------------------------------------------
-void MainForm::cameraError(QCamera::Error )
-{
-    QMessageBox::warning(this, "Error", camera->errorString());
-}
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/videomain.h RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/videomain.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/videomain.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/videomain.h	1970-01-01 03:00:00.000000000 +0300
@@ -1,64 +0,0 @@
-//---------------------------------------------------------------------------
-#ifndef vmainH
-#define vmainH
-
-#include <QDialog>
-#include <QCamera>
-#include <QVideoProbe>
-#include <QMediaRecorder>
-#include <QVideoFrame>
-#include <QTime>
-
-#include "ui_videomain.h"
-#include "videoopt.h"
-
-#include "rtklib.h"
-
-class QShowEvent;
-class QCloseEvent;
-class CameraFrameGrabber;
-
-//---------------------------------------------------------------------------
-class MainForm : public QDialog, protected Ui::MainForm
-{
-    Q_OBJECT
-public slots:
-    void BtnStopClick();
-    void BtnOptClick();
-    void BtnExitClick();
-    void BtnStartClick();
-    void cameraError(QCamera::Error value);
-    void SampleBufferSync(QImage);
-protected:
-    void closeEvent(QCloseEvent *);
-    void showEvent(QShowEvent *);
-private:
-    QCamera *camera;
-    CameraFrameGrabber *cameraFrameGrabber;
-    stream_t OutputStream[2];
-    gtime_t StartTime;
-    gtime_t CaptureTime;
-    unsigned int StartTick, CaptureTick;
-    lock_t DeviceLock;
-    int Video_Width, Video_Height, FrameCount, FrameCount0, FrameRate;
-    QString IniFile;
-    QTime Time;
-
-    int  CaptureStart(void);
-    void CaptureStop(void);
-    void LoadOptions(void);
-    void SaveOptions(void);
-    void DrawText(QPainter *c, int x, int y,
-        QString str, int size, QColor color, int ha, int va);
-public:
-    QString DevName, OutFile;
-    VideoOptDlg *videoOptDlg;
-    int Profile, CaptionPos, CaptionSize;
-    int TcpPortEna, TcpPortNo, OutFileEna, OutTimeTag, FileSwap, CodecQuality;
-    QColor CaptionColor;
-    QCameraViewfinderSettings videoSettings;
-
-    MainForm(QWidget *parent = 0);
-};
-//---------------------------------------------------------------------------
-#endif
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/videomain.ui RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/videomain.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/videomain.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/videomain.ui	1970-01-01 03:00:00.000000000 +0300
@@ -1,84 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<ui version="4.0">
- <class>MainForm</class>
- <widget class="QWidget" name="MainForm">
-  <property name="geometry">
-   <rect>
-    <x>0</x>
-    <y>0</y>
-    <width>423</width>
-    <height>290</height>
-   </rect>
-  </property>
-  <property name="windowTitle">
-   <string>Options</string>
-  </property>
-  <property name="toolTip">
-   <string/>
-  </property>
-  <layout class="QGridLayout" name="gridLayout">
-   <item row="2" column="0">
-    <widget class="QWidget" name="Panel1" native="true">
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
-     <layout class="QHBoxLayout" name="horizontalLayout">
-      <item>
-       <widget class="QPushButton" name="BtnStart">
-        <property name="text">
-         <string>&amp;Start</string>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QPushButton" name="BtnStop">
-        <property name="text">
-         <string>S&amp;top</string>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QPushButton" name="BtnOpt">
-        <property name="text">
-         <string>&amp;Option...</string>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QPushButton" name="BtnExit">
-        <property name="text">
-         <string>Exit</string>
-        </property>
-       </widget>
-      </item>
-     </layout>
-    </widget>
-   </item>
-   <item row="1" column="0">
-    <widget class="QLabel" name="Disp">
-     <property name="text">
-      <string/>
-     </property>
-    </widget>
-   </item>
-   <item row="0" column="0">
-    <widget class="QLabel" name="Message3">
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
-     <property name="text">
-      <string/>
-     </property>
-    </widget>
-   </item>
-  </layout>
- </widget>
- <resources/>
- <connections/>
-</ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/videoopt.cpp RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/videoopt.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/videoopt.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/videoopt.cpp	1970-01-01 03:00:00.000000000 +0300
@@ -1,160 +0,0 @@
-//---------------------------------------------------------------------------
-#include "videomain.h"
-#include "videoopt.h"
-
-#include <QShowEvent>
-#include <QCamera>
-#include <QCameraInfo>
-#include <QFileDialog>
-#include <QDir>
-#include <QColorDialog>
-
-extern MainForm *mainForm;
-
-
-QString color2String(const QColor &c)
-{
-    return QString("rgb(%1,%2,%3)").arg(c.red()).arg(c.green()).arg(c.blue());
-}
-
-//---------------------------------------------------------------------------
-VideoOptDlg::VideoOptDlg(QWidget *parent)
-    : QDialog(parent)
-{
-    setupUi(this);
-
-    connect(BtnOk, SIGNAL(clicked(bool)),this, SLOT(BtnOkClick()));
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(BtnFile, SIGNAL(clicked(bool)), this, SLOT(BtnFileClick()));
-    connect(ChkTcpPort, SIGNAL(clicked(bool)), this, SLOT(ChkTcpPortChange()));
-    connect(ChkOutFile, SIGNAL(clicked(bool)), this, SLOT(UpdateEnable()));
-    connect(ChkTimeTag, SIGNAL(clicked(bool)), this, SLOT(UpdateEnable()));
-    connect(SelCapPos, SIGNAL(currentIndexChanged(int)), this, SLOT(SelCapPosChange()));
-    connect(SelDev, SIGNAL(currentIndexChanged(int)), this, SLOT(SelDevChange()));
-    connect(SelCapColor, SIGNAL(clicked(bool)), this, SLOT(SelCapColorClicked()));
-}
-//---------------------------------------------------------------------------
-void VideoOptDlg::showEvent(QShowEvent *event)
-{
-    if (event->spontaneous()) return;
-
-    SelDev->clear();
-
-    int i = 0;
-    foreach (const QCameraInfo &cameraInfo, QCameraInfo::availableCameras()) {
-        SelDev->addItem(cameraInfo.description(), cameraInfo.deviceName());
-        if (i == 0) {
-            SelDev->setCurrentIndex(0);
-        }
-        else if (cameraInfo.deviceName() == mainForm->DevName) {
-            SelDev->setCurrentIndex(i);
-        }
-        i++;
-    }
-    UpdateProf();
-
-    for (int i = 0;i < SelProf->count(); i++)
-        if (SelProf->itemData(i).value<QCameraViewfinderSettings>() == mainForm->videoSettings)
-            SelProf->setCurrentIndex(i);
-
-    ChkTcpPort   ->setChecked(mainForm->TcpPortEna);
-    EditTcpPort  ->setValue(mainForm->TcpPortNo);
-    ChkOutFile   ->setChecked(mainForm->OutFileEna);
-    EditFile     ->setText(mainForm->OutFile);
-    ChkTimeTag   ->setChecked(mainForm->OutTimeTag);
-    SelFileSwap  ->setCurrentIndex(mainForm->FileSwap);
-    SelCapPos    ->setCurrentIndex(mainForm->CaptionPos);
-    EditCapSize  ->setValue(mainForm->CaptionSize);
-    CapColor = mainForm->CaptionColor;
-    SelCapColor->setStyleSheet(QString("background-color: %1;").arg(color2String(CapColor)));
-    EditCodecQuality->setValue(mainForm->CodecQuality);
-
-    UpdateEnable();
-}
-//---------------------------------------------------------------------------
-void VideoOptDlg::BtnOkClick()
-{
-    mainForm->DevName = SelDev->currentData().toString();
-
-    mainForm->TcpPortEna = ChkTcpPort   ->isChecked();
-    mainForm->TcpPortNo  = EditTcpPort  ->value();
-    mainForm->OutFileEna = ChkOutFile   ->isChecked();
-    mainForm->OutFile    = EditFile     ->text();
-    mainForm->OutTimeTag = ChkTimeTag   ->isChecked();
-    mainForm->FileSwap   = SelFileSwap  ->currentIndex();
-    mainForm->CaptionPos = SelCapPos    ->currentIndex();
-    mainForm->CaptionSize= EditCapSize  ->value();
-    mainForm->CaptionColor= CapColor;
-    mainForm->CodecQuality= EditCodecQuality->value();
-    mainForm->videoSettings= SelProf->currentData().value<QCameraViewfinderSettings>();
-
-    accept();
-}
-//---------------------------------------------------------------------------
-void VideoOptDlg::BtnFileClick()
-{
-    EditFile->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Output File"), QString(), tr("MJPEG (*mjpg);;All (*.*)"))));
-}
-//---------------------------------------------------------------------------
-void VideoOptDlg::SelDevChange()
-{
-    UpdateProf();
-}
-//---------------------------------------------------------------------------
-void VideoOptDlg::ChkTcpPortChange()
-{
-    UpdateEnable();
-}
-//---------------------------------------------------------------------------
-void VideoOptDlg::SelCapPosChange()
-{
-    UpdateEnable();
-}
-//---------------------------------------------------------------------------
-void VideoOptDlg::UpdateProf(void)
-{
-    if (SelDev->currentIndex()==-1) {
-        return;
-    }
-    QCamera *camera = new QCamera(SelDev->currentText().toLatin1());
-
-    if (!camera->isAvailable()) return;
-
-    camera->load();
-
-    SelProf->clear();
-
-    QList<QCameraViewfinderSettings> settings=camera->supportedViewfinderSettings();
-    for (int i = 0; i < settings.length(); i++) {
-        QString str;
-        str=QString("%1 x %2 (%3-%4 FPS)").arg(settings.at(i).resolution().width())
-                    .arg(settings.at(i).resolution().height())
-                    .arg(settings.at(i).minimumFrameRate(),0,'f').arg(settings.at(i).maximumFrameRate(),0,'f');
-        SelProf->addItem(str,QVariant::fromValue(settings.at(i)));
-    }
-    if (settings.size() > 0) {
-        SelProf->setCurrentIndex(0);
-    }
-
-}
-
-//---------------------------------------------------------------------------
-void VideoOptDlg::UpdateEnable(void)
-{
-    EditTcpPort  ->setEnabled(ChkTcpPort->isChecked());
-    EditFile     ->setEnabled(ChkOutFile->isChecked());
-    Label8       ->setEnabled(SelCapPos->currentIndex() != 0);
-    EditCapSize  ->setEnabled(SelCapPos->currentIndex() != 0);
-    SelCapColor  ->setEnabled(SelCapPos->currentIndex() != 0);
-    BtnFile      ->setEnabled(ChkOutFile->isChecked());
-    ChkTimeTag   ->setEnabled(ChkOutFile->isChecked());
-    SelFileSwap  ->setEnabled(ChkOutFile->isChecked());
-    Label4       ->setEnabled(ChkOutFile->isChecked());
-    Label5       ->setEnabled(ChkOutFile->isChecked());
-}
-//---------------------------------------------------------------------------
-void VideoOptDlg::SelCapColorClicked()
-{
-    CapColor = QColorDialog::getColor(CapColor, this);
-    SelCapColor->setStyleSheet(QString("background-color: %1;").arg(color2String(CapColor)));
-}
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/videoopt.h RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/videoopt.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/videoopt.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/videoopt.h	1970-01-01 03:00:00.000000000 +0300
@@ -1,35 +0,0 @@
-//---------------------------------------------------------------------------
-#ifndef videooptH
-#define videooptH
-
-#include <QDialog>
-
-#include "ui_videoopt.h"
-
-class QShowEvent;
-
-//---------------------------------------------------------------------------
-class VideoOptDlg : public QDialog, protected Ui::VideoOptDlg
-{
-    Q_OBJECT
-public slots:
-    void BtnOkClick();
-    void ChkTcpPortChange();
-    void BtnFileClick();
-    void UpdateEnable(void);
-    void SelCapPosChange();
-    void SelDevChange();
-    void SelCapColorClicked();
-
-protected:
-    void showEvent(QShowEvent *);
-
-    void UpdateProf(void);
-
-    QColor CapColor;
-
-public:
-    VideoOptDlg(QWidget *parent);
-};
-//---------------------------------------------------------------------------
-#endif
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/videoopt.ui RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/videoopt.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvideo_qt/videoopt.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvideo_qt/videoopt.ui	1970-01-01 03:00:00.000000000 +0300
@@ -1,446 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<ui version="4.0">
- <class>VideoOptDlg</class>
- <widget class="QWidget" name="VideoOptDlg">
-  <property name="geometry">
-   <rect>
-    <x>0</x>
-    <y>0</y>
-    <width>431</width>
-    <height>358</height>
-   </rect>
-  </property>
-  <property name="windowTitle">
-   <string>Options</string>
-  </property>
-  <property name="toolTip">
-   <string/>
-  </property>
-  <layout class="QGridLayout" name="gridLayout">
-   <item row="3" column="1">
-    <widget class="QComboBox" name="SelProf"/>
-   </item>
-   <item row="2" column="0">
-    <widget class="QLabel" name="Label1">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="text">
-      <string>Input Device</string>
-     </property>
-    </widget>
-   </item>
-   <item row="10" column="0">
-    <widget class="QCheckBox" name="ChkOutFile">
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="text">
-      <string>Output File</string>
-     </property>
-     <property name="checked">
-      <bool>false</bool>
-     </property>
-    </widget>
-   </item>
-   <item row="3" column="0">
-    <widget class="QLabel" name="label">
-     <property name="text">
-      <string>Frame Width x Height, Rate</string>
-     </property>
-    </widget>
-   </item>
-   <item row="10" column="1">
-    <widget class="QPushButton" name="BtnFile">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="text">
-      <string>...</string>
-     </property>
-     <property name="flat">
-      <bool>false</bool>
-     </property>
-    </widget>
-   </item>
-   <item row="14" column="0" colspan="2">
-    <widget class="QWidget" name="widget_5" native="true">
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
-     <layout class="QHBoxLayout" name="horizontalLayout_5">
-      <property name="leftMargin">
-       <number>0</number>
-      </property>
-      <property name="topMargin">
-       <number>0</number>
-      </property>
-      <property name="rightMargin">
-       <number>0</number>
-      </property>
-      <property name="bottomMargin">
-       <number>0</number>
-      </property>
-      <item>
-       <widget class="QCheckBox" name="ChkTimeTag">
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>Output Time Tag</string>
-        </property>
-        <property name="checked">
-         <bool>false</bool>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <spacer name="horizontalSpacer">
-        <property name="orientation">
-         <enum>Qt::Horizontal</enum>
-        </property>
-        <property name="sizeHint" stdset="0">
-         <size>
-          <width>40</width>
-          <height>20</height>
-         </size>
-        </property>
-       </spacer>
-      </item>
-      <item>
-       <widget class="QLabel" name="Label4">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>File Swap Interva</string>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QComboBox" name="SelFileSwap">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <item>
-         <property name="text">
-          <string/>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>3</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>6</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>15</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>30</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>60</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>120</string>
-         </property>
-        </item>
-       </widget>
-      </item>
-      <item>
-       <widget class="QLabel" name="Label5">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>Min</string>
-        </property>
-       </widget>
-      </item>
-     </layout>
-    </widget>
-   </item>
-   <item row="2" column="1">
-    <widget class="QComboBox" name="SelDev">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-    </widget>
-   </item>
-   <item row="7" column="0" colspan="2">
-    <widget class="QWidget" name="widget_4" native="true">
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
-     <layout class="QHBoxLayout" name="horizontalLayout_4">
-      <property name="leftMargin">
-       <number>0</number>
-      </property>
-      <property name="topMargin">
-       <number>0</number>
-      </property>
-      <property name="rightMargin">
-       <number>0</number>
-      </property>
-      <property name="bottomMargin">
-       <number>0</number>
-      </property>
-      <item>
-       <widget class="QLabel" name="Label3">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>TCP Server Port</string>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QCheckBox" name="ChkTcpPort">
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>Output Stream</string>
-        </property>
-        <property name="checked">
-         <bool>false</bool>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QSpinBox" name="EditTcpPort">
-        <property name="maximum">
-         <number>65535</number>
-        </property>
-        <property name="value">
-         <number>10033</number>
-        </property>
-       </widget>
-      </item>
-     </layout>
-    </widget>
-   </item>
-   <item row="13" column="0" colspan="2">
-    <widget class="QLineEdit" name="EditFile">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="text">
-      <string/>
-     </property>
-    </widget>
-   </item>
-   <item row="15" column="0" colspan="2">
-    <widget class="QWidget" name="widget_2" native="true">
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
-     <layout class="QHBoxLayout" name="horizontalLayout_2">
-      <property name="leftMargin">
-       <number>0</number>
-      </property>
-      <property name="topMargin">
-       <number>0</number>
-      </property>
-      <property name="rightMargin">
-       <number>0</number>
-      </property>
-      <property name="bottomMargin">
-       <number>0</number>
-      </property>
-      <item>
-       <widget class="QPushButton" name="BtnOk">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>&amp;Ok</string>
-        </property>
-        <property name="flat">
-         <bool>false</bool>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QPushButton" name="BtnCancel">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>&amp;Cancle</string>
-        </property>
-        <property name="flat">
-         <bool>false</bool>
-        </property>
-       </widget>
-      </item>
-     </layout>
-    </widget>
-   </item>
-   <item row="5" column="0" colspan="2">
-    <widget class="QWidget" name="widget_3" native="true">
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
-     <layout class="QHBoxLayout" name="horizontalLayout_3">
-      <property name="leftMargin">
-       <number>0</number>
-      </property>
-      <property name="topMargin">
-       <number>0</number>
-      </property>
-      <property name="rightMargin">
-       <number>0</number>
-      </property>
-      <property name="bottomMargin">
-       <number>0</number>
-      </property>
-      <item>
-       <widget class="QLabel" name="Label7">
-        <property name="text">
-         <string>Frame Caption Position</string>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QComboBox" name="SelCapPos">
-        <item>
-         <property name="text">
-          <string>Off</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>Left</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>Center</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>Right</string>
-         </property>
-        </item>
-       </widget>
-      </item>
-      <item>
-       <widget class="QLabel" name="Label8">
-        <property name="text">
-         <string>Font</string>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QSpinBox" name="EditCapSize">
-        <property name="value">
-         <number>24</number>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QToolButton" name="SelCapColor">
-        <property name="text">
-         <string/>
-        </property>
-       </widget>
-      </item>
-     </layout>
-    </widget>
-   </item>
-   <item row="6" column="0">
-    <widget class="QLabel" name="Label6">
-     <property name="text">
-      <string>Codec Quality</string>
-     </property>
-    </widget>
-   </item>
-   <item row="6" column="1">
-    <widget class="QSpinBox" name="EditCodecQuality">
-     <property name="maximum">
-      <number>100</number>
-     </property>
-     <property name="value">
-      <number>90</number>
-     </property>
-    </widget>
-   </item>
-  </layout>
- </widget>
- <tabstops>
-  <tabstop>BtnOk</tabstop>
-  <tabstop>BtnCancel</tabstop>
-  <tabstop>SelDev</tabstop>
-  <tabstop>SelProf</tabstop>
-  <tabstop>SelCapPos</tabstop>
-  <tabstop>EditCapSize</tabstop>
-  <tabstop>SelCapColor</tabstop>
-  <tabstop>EditCodecQuality</tabstop>
-  <tabstop>ChkTcpPort</tabstop>
-  <tabstop>EditTcpPort</tabstop>
-  <tabstop>ChkOutFile</tabstop>
-  <tabstop>BtnFile</tabstop>
-  <tabstop>EditFile</tabstop>
-  <tabstop>ChkTimeTag</tabstop>
-  <tabstop>SelFileSwap</tabstop>
- </tabstops>
- <resources/>
- <connections/>
-</ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/.gitignore RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/.gitignore
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/.gitignore	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/.gitignore	1970-01-01 03:00:00.000000000 +0300
@@ -1,12 +0,0 @@
-ui_*.h
-moc_*.cpp
-moc_*.h
-qrc*.cpp
-*.pro.user*
-Makefile*
-*.res
-rtknavi_qt
-rtknavi_qt.exe
-object_script*
-debug
-release
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/install.bat RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/install.bat
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/install.bat	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/install.bat	1970-01-01 03:00:00.000000000 +0300
@@ -1 +0,0 @@
-copy release\rtkvplayer_qt.exe ..\..\..\RTKLIB_bin\bin
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/install.sh RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/install.sh
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/install.sh	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/install.sh	1970-01-01 03:00:00.000000000 +0300
@@ -1 +0,0 @@
-cp rtkvplayer_qt ../../../RTKLIB_bin/bin
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/rtkvplayer.cpp RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/rtkvplayer.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/rtkvplayer.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/rtkvplayer.cpp	1970-01-01 03:00:00.000000000 +0300
@@ -1,13 +0,0 @@
-//---------------------------------------------------------------------------
-#include "vplayermain.h"
-#include <QApplication>
-
-int main(int argc, char *argv[])
-{
-    QApplication a(argc, argv);
-    MainForm w;
-
-    w.show();
-
-    return a.exec();
-}
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/rtkvplayer_qt.pro RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/rtkvplayer_qt.pro
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/rtkvplayer_qt.pro	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/rtkvplayer_qt.pro	1970-01-01 03:00:00.000000000 +0300
@@ -1,34 +0,0 @@
-#-------------------------------------------------
-#
-# Project created by QtCreator 2016-01-30T18:29:59
-#
-#-------------------------------------------------
-
-QT       += widgets core gui multimedia multimediawidgets
-
-include(../app.pri)
-
-TARGET = rtkvplayer_qt
-TEMPLATE = app
-
-INCLUDEPATH += ../../src/ ../appcmn_qt
-
-SOURCES += \
-#    mjpgplayer.cpp \
-    vplayermain.cpp \ 
-    rtkvplayer.cpp \
-    vpoptdlg.cpp
-
-HEADERS  += \
-    vplayermain.h \
-    vpoptdlg.h
-    #mjpgplayer.h
-
-FORMS    += \
-    vplayermain.ui \ 
-    vpoptdlg.ui
-
-RESOURCES += \
-    rtkvplayer_qt.qrc
-
-#RC_FILE = rtkvplayer_qt.rc
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/rtkvplayer_qt.qrc RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/rtkvplayer_qt.qrc
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/rtkvplayer_qt.qrc	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/rtkvplayer_qt.qrc	1970-01-01 03:00:00.000000000 +0300
@@ -1,96 +0,0 @@
-<RCC>
-    <qresource prefix="/icons">
-        <file alias="rtk1.bmp">../icon/rtk1.bmp</file>
-        <file alias="rtk2.bmp">../icon/rtk2.bmp</file>
-        <file alias="rtk3.bmp">../icon/rtk3.bmp</file>
-        <file alias="rtk4.bmp">../icon/rtk4.bmp</file>
-        <file alias="rtk5.bmp">../icon/rtk5.bmp</file>
-        <file alias="rtk6.bmp">../icon/rtk6.bmp</file>
-        <file alias="rtk7.bmp">../icon/rtk7.bmp</file>
-        <file alias="rtk8.bmp">../icon/rtk8.bmp</file>
-        <file alias="rtk8_tray.bmp">../icon/rtk8_tray.ico</file>
-        <file alias="rtk9.bmp">../icon/rtk9.bmp</file>
-        <file alias="point.bmp">../icon/point.bmp</file>
-        <file alias="tray0.bmp">../icon/tray0.bmp</file>
-        <file alias="tray1.bmp">../icon/tray1.bmp</file>
-        <file alias="tray2.bmp">../icon/tray2.bmp</file>
-    </qresource>
-    <qresource prefix="/buttons">
-        <file alias="arrow.bmp">../icon/arrow.bmp</file>
-        <file alias="arrow_r.bmp">../icon/arrow_r.bmp</file>
-        <file alias="down.bmp">../icon/down.bmp</file>
-        <file alias="map.bmp">../icon/map.bmp</file>
-        <file alias="norm.bmp">../icon/norm.bmp</file>
-        <file alias="pause.bmp">../icon/pause.bmp</file>
-        <file alias="rarrow.bmp">../icon/rarrow.bmp</file>
-        <file alias="reload.bmp">../icon/reload.bmp</file>
-        <file alias="scale.bmp">../icon/scale.bmp</file>
-        <file alias="sqr.bmp">../icon/sqr.bmp</file>
-        <file alias="status.bmp">../icon/status.bmp</file>
-        <file alias="stop.bmp">../icon/stop.bmp</file>
-        <file alias="svrarrow.bmp">../icon/svrarrow.bmp</file>
-        <file alias="toolbmp">../icon/tool.bmp</file>
-        <file alias="ttray.bmp">../icon/ttray.bmp</file>
-        <file alias="doc.bmp">../icon/doc.bmp</file>
-        <file alias="anim.bmp">../icon/anim.bmp</file>
-        <file alias="anim1.bmp">../icon/anim1.bmp</file>
-        <file alias="anim2.bmp">../icon/anim2.bmp</file>
-        <file alias="border.bmp">../icon/border.bmp</file>
-        <file alias="building.bmp">../icon/building.bmp</file>
-        <file alias="chart.bmp">../icon/chart.bmp</file>
-        <file alias="connect.bmp">../icon/connect.bmp</file>
-        <file alias="connect1.bmp">../icon/connect1.bmp</file>
-        <file alias="connect2.bmp">../icon/connect2.bmp</file>
-        <file alias="data1.bmp">../icon/data1.bmp</file>
-        <file alias="data01.bmp">../icon/data01.bmp</file>
-        <file alias="data2.bmp">../icon/data2.bmp</file>
-        <file alias="data02.bmp">../icon/data02.bmp</file>
-        <file alias="data03.bmp">../icon/data03.bmp</file>
-        <file alias="data04.bmp">../icon/data04.bmp</file>
-        <file alias="data12.bmp">../icon/data12.bmp</file>
-        <file alias="del.bmp">../icon/del.bmp</file>
-        <file alias="expand.bmp">../icon/expand.bmp</file>
-        <file alias="fitd.bmp">../icon/fitd.bmp</file>
-        <file alias="fith.bmp">../icon/fith.bmp</file>
-        <file alias="fitv.bmp">../icon/fitv.bmp</file>
-        <file alias="ge.bmp">../icon/ge.bmp</file>
-        <file alias="gm.bmp">../icon/gm.bmp</file>
-        <file alias="graph.bmp">../icon/graph.bmp</file>
-        <file alias="grid.bmp">../icon/grid.bmp</file>
-        <file alias="headup.bmp">../icon/headup.bmp</file>
-        <file alias="home.bmp">../icon/home.bmp</file>
-        <file alias="load.bmp">../icon/load.bmp</file>
-        <file alias="navctr.bmp">../icon/navctr.bmp</file>
-        <file alias="navi.bmp">../icon/navi.bmp</file>
-        <file alias="navi0.bmp">../icon/navi0.bmp</file>
-        <file alias="ori.bmp">../icon/ori.bmp</file>
-        <file alias="point.bmp">../icon/point.bmp</file>
-        <file alias="point.ico">../icon/point.ico</file>
-        <file alias="road.bmp">../icon/road.bmp</file>
-        <file alias="rotl.bmp">../icon/rotl.bmp</file>
-        <file alias="rotr.bmp">../icon/rotr.bmp</file>
-        <file alias="showp.bmp">../icon/showp.bmp</file>
-        <file alias="showt.bmp">../icon/showt.bmp</file>
-        <file alias="shrink.bmp">../icon/shrink.bmp</file>
-        <file alias="tilt.bmp">../icon/tilt.bmp</file>
-        <file alias="track.bmp">../icon/track.bmp</file>
-        <file alias="trackc.bmp">../icon/trackc.bmp</file>
-        <file alias="trackl.bmp">../icon/trackl.bmp</file>
-        <file alias="trackr.bmp">../icon/trackr.bmp</file>
-        <file alias="undu.bmp">../icon/undu.bmp</file>
-        <file alias="up.bmp">../icon/up.bmp</file>
-        <file alias="vmap.bmp">../icon/vmap.bmp</file>
-        <file alias="wait1.bmp">../icon/wait1.bmp</file>
-        <file alias="wait2.bmp">../icon/wait2.bmp</file>
-        <file alias="wait3.bmp">../icon/wait3.bmp</file>
-        <file alias="wait4.bmp">../icon/wait4.bmp</file>
-        <file alias="wait5.bmp">../icon/wait5.bmp</file>
-        <file alias="wait6.bmp">../icon/wait6.bmp</file>
-        <file alias="wait7.bmp">../icon/wait7.bmp</file>
-        <file alias="wait8.bmp">../icon/wait8.bmp</file>
-        <file alias="start.bmp">../icon/start.bmp</file>
-        <file alias="up2.bmp">../icon/up2.bmp</file>
-        <file alias="stop2.bmp">../icon/stop2.bmp</file>
-        <file alias="anim1_red.bmp">../icon/anim1_red.bmp</file>
-    </qresource>
-</RCC>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/rtkvplayer_qt.rc RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/rtkvplayer_qt.rc
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/rtkvplayer_qt.rc	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/rtkvplayer_qt.rc	1970-01-01 03:00:00.000000000 +0300
@@ -1 +0,0 @@
-IDI_ICON1               ICON    DISCARDABLE     "rtknavi_Icon.ico"
\ В конце файла нет новой строки
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/vplayermain.cpp RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/vplayermain.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/vplayermain.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/vplayermain.cpp	1970-01-01 03:00:00.000000000 +0300
@@ -1,322 +0,0 @@
-//---------------------------------------------------------------------------
-// vplayermain.c : simple video player
-//
-//          Copyright (C) 2016 by T.TAKASU, All rights reserved.
-//          ported to Qt by Jens Reimann
-//
-// version : $Revision:$ $Date:$
-// history : 2016/09/25 1.0 new
-//---------------------------------------------------------------------------
-#include <QShowEvent>
-#include <QCloseEvent>
-#include <QFileDialog>
-#include <QSettings>
-#include <QMediaMetaData>
-#include <QDragEnterEvent>
-#include <QDropEvent>
-#include <QMimeData>
-
-#include "vplayermain.h"
-#include "vpoptdlg.h"
-#include "rtklib.h"
-
-#define VIDEO_TYPE_NONE  0
-#define VIDEO_TYPE_MEDIA 1
-#define VIDEO_TYPE_MJPEG 2
-
-#define MIN_WINDOW_WIDTH  320
-#define MIN_WINDOW_HEIGHT 240
-
-#define PRGNAME     "RTKVPLAYER_QT"
-#define PATH_TIME_SYNC "localhost:10071"
-
-extern "C" {
-extern int showmsg(const char *, ...)  {return 0;}
-extern void settime(gtime_t) {}
-extern void settspan(gtime_t, gtime_t) {}
-}
-
-MainForm *mainForm;
-
-//---------------------------------------------------------------------------
-MainForm::MainForm(QWidget *parent)
-    : QDialog(parent)
-{
-    mainForm=this;
-    setupUi(this);
-    setAcceptDrops(true);
-    double ep[]={2000,1,1,0,0,0};
-    VideoType = VIDEO_TYPE_NONE;
-    FileIndex = -1;
-    Track = NStrBuff = 0;
-    TimeStart = epoch2time(ep);
-    MjpgRate = 10.0;
-    SyncPort = 10071;
-
-    QString file = QApplication::applicationFilePath();
-    QFileInfo fi(file);
-    IniFile = fi.absolutePath() + "/" + fi.baseName() + ".ini";
-
-    MjpgPlayer = new QMediaPlayer();
-    MjpgPlayer->setVideoOutput(VideoWidget);
-
-    Timer1.setInterval(100);
-    Timer1.start();
-
-    connect(BtnOpen, SIGNAL(clicked(bool)), this, SLOT(BtnOpenClick()));
-    connect(BtnPlay, SIGNAL(clicked(bool)), this, SLOT(BtnPlayClick()));
-    connect(BtnStop, SIGNAL(clicked(bool)), this, SLOT(BtnStopClick()));
-    connect(BtnClear, SIGNAL(clicked(bool)), this, SLOT(BtnClearClick()));
-    connect(BtnExit, SIGNAL(clicked(bool)), this, SLOT(BtnExitClick()));
-    connect(BtnPosStart, SIGNAL(clicked(bool)), this, SLOT(BtnPosStartClick()));
-    connect(&Timer1, SIGNAL(timeout()),this ,SLOT(Timer1Timer()));
-    connect(BtnOption, SIGNAL(clicked(bool)), this, SLOT(BtnOptionsClick()));
-    connect(BtnSync, SIGNAL(clicked(bool)),this,SLOT(BtnSyncClick()));
-}
-//---------------------------------------------------------------------------
-void MainForm::showEvent(QShowEvent *event)
-{
-    if (event->spontaneous()) return;
-
-    LoadOptions();
-        
-    setWindowTitle(QString("%1 ver. %2 %3").arg(PRGNAME).arg(VER_RTKLIB).arg(PATCH_LEVEL));
-
-    strinitcom();
-    strinit(&StrTimeSync);
-}
-//---------------------------------------------------------------------------
-void MainForm::closeEvent(QCloseEvent *)
-{
-    StopVideo();
-    ClearVideo();
-    strclose(&StrTimeSync);
-    SaveOptions();
-}
-//---------------------------------------------------------------------------
-void MainForm::BtnOpenClick()
-{
-    OpenVideo(QFileDialog::getOpenFileNames(this, tr("Open Video"), QString(), tr("Video (*.avi *.mp4 *.mjpg);;All (*.*)")));
-
-    SetVideoPos(0.0f);
-}
-//---------------------------------------------------------------------------
-void MainForm::ReadNmea(QString file)
-{
-    double time,date,ep[6];
-
-    QFileInfo info(file);
-    QString strNewName = info.path() + "/" + info.completeBaseName() + ".nmea";
-
-    QFile fp(strNewName);
-
-    if (!fp.open(QIODevice::ReadOnly)) return;
-
-    QByteArray line;
-    while (!fp.atEnd())
-    {
-        line=fp.readLine();
-        if (sscanf(qPrintable(line),"$GPRMC,%lf,A,%*lf,%*c,%*lf,%*c,%*lf,%*lf,%lf",
-                   &time,&date)>=2) { //FIXME: make qt-stylish
-            ep[2]=floor(date/10000.0); date-=ep[2]*10000.0;
-            ep[1]=floor(date/100.0  ); date-=ep[1]*100.0;
-            ep[0]=date+2000.0;
-            ep[3]=floor(time/10000.0); time-=ep[3]*10000.0;
-            ep[4]=floor(time/100.0  ); time-=ep[4]*100.0;
-            ep[5]=time;
-            TimeStart=timeadd(utc2gpst(epoch2time(ep)),-0.5);
-            break;
-        }
-    }
-}
-//---------------------------------------------------------------------------
-void MainForm::BtnPlayClick()
-{
-    if (!PlayVideo()) return;
-    BtnOpen ->setEnabled(false);
-    BtnPlay ->setEnabled(false);
-    BtnStop ->setEnabled(true);
-    BtnClear->setEnabled(false);
-    BtnExit ->setEnabled(false);
-}
-//---------------------------------------------------------------------------
-void MainForm::BtnStopClick()
-{
-    StopVideo();
-    BtnOpen ->setEnabled(true);
-    BtnPlay ->setEnabled(true);
-    BtnStop ->setEnabled(false);
-    BtnClear->setEnabled(true);
-    BtnExit ->setEnabled(true);
-}
-//---------------------------------------------------------------------------
-void MainForm::BtnClearClick()
-{
-    ClearVideo();
-}
-//---------------------------------------------------------------------------
-void MainForm::BtnExitClick()
-{
-    accept();
-}
-//---------------------------------------------------------------------------
-void MainForm::BtnNextClick()
-{
-//    NextVideo();
-}
-//---------------------------------------------------------------------------
-void MainForm::BtnPrevClick()
-{
-//    PrevVideo();
-}
-//---------------------------------------------------------------------------
-void MainForm::BtnPosStartClick()
-{
-    SetVideoPos(0.0f);
-}
-//---------------------------------------------------------------------------
-void MainForm::dragEnterEvent(QDragEnterEvent *event)
-{
-    if (event->mimeData()->hasFormat("text/uri-list"))
-        event->acceptProposedAction();
-}
-//---------------------------------------------------------------------------
-void MainForm::dropEvent(QDropEvent *event)
-{
-    if (!event->mimeData()->hasFormat("text/uri-list")) return;
-
-    QString file = QDir::toNativeSeparators(QUrl(event->mimeData()->text()).toLocalFile());
-
-    OpenVideo(QStringList(file));
-}
-
-//---------------------------------------------------------------------------
-void MainForm::Timer1Timer()
-{
-    QString str;
-    double t, period;
-    int width, height;
-    gtime_t time;
-    char msg[256];
-    
-    GetVideoTime(t, period);
-    GetVideoSize(width, height);
-
-    time = timeadd(TimeStart, t);
-    if (FileIndex >= 0) {
-        str=QString("%1 (%2 x %3)").arg(time_str(time, 2)).arg(width).arg(height);
-    }
-    if (BtnSync->isDown()) {
-        sprintf(msg, "%s\r\n", time_str(time, 2));
-        strwrite(&StrTimeSync, (unsigned char *)msg, (int)strlen(msg));
-    }
-    ProgressBar->setValue(int(GetVideoPos()*1000));
-    Message1->setText(str);
-
-    Message2->setText(FileName);
-    if (ProgressBar->value() >= 1000 && !BtnPlay->isEnabled()) {
-        //NextVideo();
-    }
-}
-//---------------------------------------------------------------------------
-void MainForm::BtnSyncClick()
-{
-    if (BtnSync->isDown()) {
-        stropen(&StrTimeSync, STR_TCPCLI, STR_MODE_RW, PATH_TIME_SYNC);
-    }
-    else {
-        strclose(&StrTimeSync);
-    }
-}
-//---------------------------------------------------------------------------
-void MainForm::OpenVideo(const QStringList &file)
-{
-    MjpgPlayer->setMedia(QUrl::fromLocalFile(file.at(0))); //FIXME: load all media
-    VideoType = VIDEO_TYPE_MJPEG;
-    ReadNmea(file.at(0));
-}
-//---------------------------------------------------------------------------
-void MainForm::ClearVideo(void)
-{
-    MjpgPlayer->setMedia(nullptr);
-    FileName = "";
-}
-//---------------------------------------------------------------------------
-int MainForm::PlayVideo(void)
-{
-    MjpgPlayer->play();
-    return 1;
-}
-//---------------------------------------------------------------------------
-void MainForm::StopVideo(void)
-{
-    MjpgPlayer->stop();
-}
-//---------------------------------------------------------------------------
-void MainForm::NextVideo(void)
-{
-    if (FileIndex >= Files.count()-1) return;
-    OpenVideo(QStringList(Files.at(++FileIndex)));
-    if (!BtnPlay->isEnabled()) PlayVideo();
-}
-//---------------------------------------------------------------------------
-void MainForm::PrevVideo(void)
-{
-    if (FileIndex <= 0) return;
-    OpenVideo(QStringList(Files.at(--FileIndex)));
-    if (!BtnPlay->isEnabled()) PlayVideo();
-}
-//---------------------------------------------------------------------------
-float MainForm::GetVideoPos(void)
-{
-    return MjpgPlayer->duration() == 0 ? 0.0 : ((double)MjpgPlayer->position()) / MjpgPlayer->duration();
-}
-//---------------------------------------------------------------------------
-void MainForm::SetVideoPos(float pos)
-{
-    MjpgPlayer->setPosition(qint64(MjpgPlayer->duration() * pos));
-}
-//---------------------------------------------------------------------------
-void MainForm::GetVideoTime(double &time, double &period)
-{
-    time = MjpgPlayer->position() / 1000.;
-    period = MjpgPlayer->duration() / 1000.;
-}
-//---------------------------------------------------------------------------
-void MainForm::GetVideoSize(int &width, int &height)
-{
-    width=MjpgPlayer->metaData(QMediaMetaData::Resolution).toSize().width();
-    height=MjpgPlayer->metaData(QMediaMetaData::Resolution).toSize().height();
-}
-//---------------------------------------------------------------------------
-void MainForm::LoadOptions(void)
-{
-    QSettings settings(IniFile, QSettings::IniFormat);
-
-    restoreGeometry(settings.value("window/size", 0).toByteArray());
-    SyncAddr = settings.value("option/sync_addr","").toString();
-    SyncPort = settings.value("option/sync_port",0).toInt();
-}
-//---------------------------------------------------------------------------
-void MainForm::SaveOptions(void)
-{
-    QSettings settings(IniFile, QSettings::IniFormat);
-
-    settings.setValue("window/size", saveGeometry());
-    settings.setValue("option/sync_addr", SyncAddr);
-    settings.setValue("option/sync_port", SyncPort);
-
-}
-//---------------------------------------------------------------------------
-void MainForm::BtnOptionsClick()
-{
-    VideoPlayerOptDialog *videoPlayerOptDialog= new VideoPlayerOptDialog(this);
-
-    videoPlayerOptDialog->exec();
-
-    delete videoPlayerOptDialog;
-}
-//---------------------------------------------------------------------------
-
-
-
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/vplayermain.h RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/vplayermain.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/vplayermain.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/vplayermain.h	1970-01-01 03:00:00.000000000 +0300
@@ -1,73 +0,0 @@
-//---------------------------------------------------------------------------
-
-#ifndef vplayerH
-#define vplayerH
-//---------------------------------------------------------------------------
-
-#include <QDialog>
-#include <QMediaPlayer>
-#include <QTimer>
-
-#include "ui_vplayermain.h"
-#include "rtklib.h"
-
-class QShowEvent;
-class QCloseEvent;
-
-//---------------------------------------------------------------------------
-class MainForm : public QDialog, protected Ui::MainForm
-{
-    Q_OBJECT
-public slots:
-    void BtnOpenClick();
-    void BtnPlayClick();
-    void BtnStopClick();
-    void BtnClearClick();
-    void BtnExitClick();
-    void BtnNextClick();
-    void BtnPrevClick();
-    void Timer1Timer();
-    void BtnSyncClick();
-    void BtnPosStartClick();
-    void BtnOptionsClick();
-
-protected:
-    void showEvent(QShowEvent*);
-    void closeEvent(QCloseEvent*);
-
-    void dragEnterEvent(QDragEnterEvent *);
-    void dropEvent(QDropEvent *);
-
-private:
-    gtime_t TimeStart;
-    stream_t StrTimeSync;
-    QMediaPlayer *MjpgPlayer;
-    QStringList Files;
-    int VideoType, Track, NStrBuff, FileIndex;
-    char StrBuff[1024];
-    QString FileName;
-    QString IniFile;
-    QTimer Timer1;
-    void OpenVideo(const QStringList &file);
-    void ClearVideo(void);
-    int  PlayVideo(void);
-    void StopVideo(void);
-    void SetVideoPos(float pos);
-    float GetVideoPos(void);
-    void GetVideoTime(double &time, double &period);
-    void GetVideoSize(int &width, int &height);
-    void LoadOptions(void);
-    void SaveOptions(void);
-    void NextVideo();
-    void PrevVideo();
-    void BtnOptionClick();
-    void ReadNmea(QString file);
-public:
-    MainForm(QWidget *parent = 0);
-
-    double MjpgRate;
-    QString SyncAddr;
-    int SyncPort;
-};
-//---------------------------------------------------------------------------
-#endif
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/vplayermain.ui RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/vplayermain.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/vplayermain.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/vplayermain.ui	1970-01-01 03:00:00.000000000 +0300
@@ -1,204 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<ui version="4.0">
- <class>MainForm</class>
- <widget class="QWidget" name="MainForm">
-  <property name="geometry">
-   <rect>
-    <x>0</x>
-    <y>0</y>
-    <width>456</width>
-    <height>290</height>
-   </rect>
-  </property>
-  <property name="windowTitle">
-   <string>RTK Video Player</string>
-  </property>
-  <property name="toolTip">
-   <string/>
-  </property>
-  <layout class="QGridLayout" name="gridLayout">
-   <item row="3" column="1">
-    <widget class="QWidget" name="Panel3" native="true">
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
-     <layout class="QHBoxLayout" name="horizontalLayout">
-      <property name="leftMargin">
-       <number>0</number>
-      </property>
-      <property name="topMargin">
-       <number>0</number>
-      </property>
-      <property name="rightMargin">
-       <number>0</number>
-      </property>
-      <property name="bottomMargin">
-       <number>0</number>
-      </property>
-      <item>
-       <widget class="QPushButton" name="BtnOpen">
-        <property name="text">
-         <string>&amp;Open...</string>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QPushButton" name="BtnPlay">
-        <property name="text">
-         <string>&amp;Play</string>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QPushButton" name="BtnStop">
-        <property name="text">
-         <string>S&amp;top</string>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QPushButton" name="BtnClear">
-        <property name="text">
-         <string>&amp;Clear</string>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QPushButton" name="BtnOption">
-        <property name="text">
-         <string>Options...</string>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QPushButton" name="BtnExit">
-        <property name="text">
-         <string>E&amp;xit</string>
-        </property>
-       </widget>
-      </item>
-     </layout>
-    </widget>
-   </item>
-   <item row="0" column="1">
-    <widget class="QVideoWidget" name="VideoWidget" native="true"/>
-   </item>
-   <item row="1" column="1">
-    <widget class="QWidget" name="Panel2" native="true">
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
-     <layout class="QHBoxLayout" name="horizontalLayout_2">
-      <property name="leftMargin">
-       <number>0</number>
-      </property>
-      <property name="topMargin">
-       <number>0</number>
-      </property>
-      <property name="rightMargin">
-       <number>0</number>
-      </property>
-      <property name="bottomMargin">
-       <number>0</number>
-      </property>
-      <item>
-       <widget class="QProgressBar" name="ProgressBar">
-        <property name="maximum">
-         <number>1000</number>
-        </property>
-        <property name="value">
-         <number>0</number>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QPushButton" name="BtnPosStart">
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Fixed" vsizetype="Fixed">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
-        <property name="maximumSize">
-         <size>
-          <width>25</width>
-          <height>25</height>
-         </size>
-        </property>
-        <property name="toolTip">
-         <string>Rewind</string>
-        </property>
-        <property name="text">
-         <string>.</string>
-        </property>
-       </widget>
-      </item>
-     </layout>
-    </widget>
-   </item>
-   <item row="2" column="1">
-    <widget class="QWidget" name="Panel4" native="true">
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
-     <layout class="QHBoxLayout" name="horizontalLayout_3">
-      <property name="leftMargin">
-       <number>0</number>
-      </property>
-      <property name="topMargin">
-       <number>0</number>
-      </property>
-      <property name="rightMargin">
-       <number>0</number>
-      </property>
-      <property name="bottomMargin">
-       <number>0</number>
-      </property>
-      <item>
-       <widget class="QLabel" name="Message1">
-        <property name="text">
-         <string/>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QLabel" name="Message2">
-        <property name="text">
-         <string/>
-        </property>
-       </widget>
-      </item>
-     </layout>
-    </widget>
-   </item>
-   <item row="3" column="0">
-    <widget class="QPushButton" name="BtnSync">
-     <property name="text">
-      <string>Sync</string>
-     </property>
-     <property name="checkable">
-      <bool>true</bool>
-     </property>
-    </widget>
-   </item>
-  </layout>
- </widget>
- <customwidgets>
-  <customwidget>
-   <class>QVideoWidget</class>
-   <extends>QWidget</extends>
-   <header>qvideowidget.h</header>
-  </customwidget>
- </customwidgets>
- <resources/>
- <connections/>
-</ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/vpoptdlg.cpp RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/vpoptdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/vpoptdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/vpoptdlg.cpp	1970-01-01 03:00:00.000000000 +0300
@@ -1,29 +0,0 @@
-#include "vpoptdlg.h"
-#include "vplayermain.h"
-
-extern MainForm *mainForm;
-
-
-//---------------------------------------------------------------------------
-
-VideoPlayerOptDialog::VideoPlayerOptDialog(QWidget *parent) : QDialog(parent)
-{
-    setupUi(this);
-
-    connect(buttonBox, SIGNAL(reject(bool)), this, SLOT(reject()));
-    connect(buttonBox, SIGNAL(accept(bool)), this, SLOT(BtnOkClick()));
-}
-
-void VideoPlayerOptDialog::showEvent(QShowEvent*)
-{
-    EditMjpgRate->setValue(mainForm->MjpgRate);
-    EditSyncAddr->setText(mainForm->SyncAddr);
-    EditSyncPort->setValue(mainForm->SyncPort);
-}
-
-void VideoPlayerOptDialog::BtnOkClick()
-{
-    mainForm->MjpgRate = EditMjpgRate->value();
-    mainForm->SyncAddr = EditSyncAddr->text();
-    mainForm->SyncPort = EditSyncPort->value();
-}
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/vpoptdlg.h RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/vpoptdlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/vpoptdlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/vpoptdlg.h	1970-01-01 03:00:00.000000000 +0300
@@ -1,23 +0,0 @@
-#ifndef VPOPTDLG_H
-#define VPOPTDLG_H
-
-#include <QDialog>
-#include "ui_vpoptdlg.h"
-
-class QShowEvent;
-
-class VideoPlayerOptDialog : public QDialog, private Ui::VideoPlayerOptionDialog
-{
-    Q_OBJECT
-public:
-    explicit VideoPlayerOptDialog(QWidget *parent = nullptr);
-
-public slots:
-    void BtnOkClick();
-
-protected:
-    void showEvent(QShowEvent*);
-
-};
-
-#endif // VPOPTDLG_H
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/vpoptdlg.ui RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/vpoptdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/rtkvplayer_qt/vpoptdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/rtkvplayer_qt/vpoptdlg.ui	1970-01-01 03:00:00.000000000 +0300
@@ -1,98 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<ui version="4.0">
- <class>VideoPlayerOptionDialog</class>
- <widget class="QDialog" name="VideoPlayerOptionDialog">
-  <property name="geometry">
-   <rect>
-    <x>0</x>
-    <y>0</y>
-    <width>400</width>
-    <height>267</height>
-   </rect>
-  </property>
-  <property name="windowTitle">
-   <string>Options</string>
-  </property>
-  <layout class="QGridLayout" name="gridLayout">
-   <item row="1" column="0">
-    <widget class="QLabel" name="label_2">
-     <property name="text">
-      <string>Time Sync Address</string>
-     </property>
-    </widget>
-   </item>
-   <item row="0" column="0">
-    <widget class="QLabel" name="label">
-     <property name="text">
-      <string>MJPG Frame Rate:</string>
-     </property>
-    </widget>
-   </item>
-   <item row="2" column="0">
-    <widget class="QLabel" name="label_3">
-     <property name="text">
-      <string>Time Sync Port</string>
-     </property>
-    </widget>
-   </item>
-   <item row="2" column="1">
-    <widget class="QSpinBox" name="EditSyncPort">
-     <property name="maximum">
-      <number>65535</number>
-     </property>
-    </widget>
-   </item>
-   <item row="3" column="0" colspan="2">
-    <widget class="QDialogButtonBox" name="buttonBox">
-     <property name="orientation">
-      <enum>Qt::Horizontal</enum>
-     </property>
-     <property name="standardButtons">
-      <set>QDialogButtonBox::Cancel|QDialogButtonBox::Ok</set>
-     </property>
-    </widget>
-   </item>
-   <item row="1" column="1">
-    <widget class="QLineEdit" name="EditSyncAddr"/>
-   </item>
-   <item row="0" column="1">
-    <widget class="QDoubleSpinBox" name="EditMjpgRate"/>
-   </item>
-  </layout>
- </widget>
- <resources/>
- <connections>
-  <connection>
-   <sender>buttonBox</sender>
-   <signal>accepted()</signal>
-   <receiver>VideoPlayerOptionDialog</receiver>
-   <slot>accept()</slot>
-   <hints>
-    <hint type="sourcelabel">
-     <x>248</x>
-     <y>254</y>
-    </hint>
-    <hint type="destinationlabel">
-     <x>157</x>
-     <y>274</y>
-    </hint>
-   </hints>
-  </connection>
-  <connection>
-   <sender>buttonBox</sender>
-   <signal>rejected()</signal>
-   <receiver>VideoPlayerOptionDialog</receiver>
-   <slot>reject()</slot>
-   <hints>
-    <hint type="sourcelabel">
-     <x>316</x>
-     <y>260</y>
-    </hint>
-    <hint type="destinationlabel">
-     <x>286</x>
-     <y>274</y>
-    </hint>
-   </hints>
-  </connection>
- </connections>
-</ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/srctblbrows_qt/browsmain.cpp RTKLIB-rtklib_2.4.3_new/app/srctblbrows_qt/browsmain.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/srctblbrows_qt/browsmain.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/srctblbrows_qt/browsmain.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -1,6 +1,5 @@
 //---------------------------------------------------------------------------
 // Ported to Qt by Jens Reimann
-#include <clocale>
 
 #include <QCloseEvent>
 #include <QShowEvent>
@@ -19,59 +18,53 @@
 #include "staoptdlg.h"
 //---------------------------------------------------------------------------
 
-#define PRGNAME                 "Ntrip Browser Qt"
-#define NTRIP_HOME              "rtcm-ntrip.org:2101"   // caster list home
-#define NTRIP_TIMEOUT   10000                           // response timeout (ms)
-#define MAXSRCTBL               512000                  // max source table size (bytes)
-#define ENDSRCTBL               "ENDSOURCETABLE"        // end marker of table
+#define PRGNAME			"Ntrip Browser Qt"
+#define NTRIP_HOME		"rtcm-ntrip.org:2101" // caster list home
+#define NTRIP_TIMEOUT	10000				// response timeout (ms)
+#define MAXSRCTBL		512000				// max source table size (bytes)
+#define ENDSRCTBL		"ENDSOURCETABLE"	// end marker of table
 
-static char buff[MAXSRCTBL];                            // source table buffer
+static char buff[MAXSRCTBL];				// source table buffer
 
 MainForm *mainForm;
 
-extern "C" {
-extern int showmsg(const char *, ...)  {return 0;}
-extern void settime(gtime_t) {}
-extern void settspan(gtime_t, gtime_t) {}
-}
-
 /* get source table -------------------------------------------------------*/
-static char *getsrctbl(const QString addr)
+static char * getsrctbl(const QString addr)
 {
-    static int lock = 0;
+    static int lock=0;
 	stream_t str;
-    char *p = buff, msg[MAXSTRMSG];
-    int len = strlen(ENDSRCTBL);
-    unsigned int tick = tickget();
-
-    if (lock) return NULL; else lock = 1;
+	char *p=buff,msg[MAXSTRMSG];
+    int len=strlen(ENDSRCTBL);
+	unsigned int tick=tickget();
 
+	if (lock) return NULL; else lock=1;
+	
     strinit(&str);
 
-    if (!stropen(&str, STR_NTRIPCLI, STR_MODE_R, qPrintable(addr))) {
-        lock = 0;
-        QMetaObject::invokeMethod(mainForm, "ShowMsg", Qt::QueuedConnection, Q_ARG(QString, QT_TR_NOOP("stream open error")));
+    if (!stropen(&str,STR_NTRIPCLI,STR_MODE_R,qPrintable(addr))) {
+		lock=0; 
+        QMetaObject::invokeMethod(mainForm,"ShowMsg",Qt::QueuedConnection,Q_ARG(QString,QT_TR_NOOP("stream open error")));
 		return NULL;
 	}
-    QMetaObject::invokeMethod(mainForm, "ShowMsg", Qt::QueuedConnection, Q_ARG(QString, QT_TR_NOOP("connecting...")));
+    QMetaObject::invokeMethod(mainForm,"ShowMsg",Qt::QueuedConnection,Q_ARG(QString,QT_TR_NOOP("connecting...")));
 
-    while (p < buff + MAXSRCTBL - 1) {
-        int ns = strread(&str, (unsigned char *)p, (buff + MAXSRCTBL - p - 1)); *(p + ns) = '\0';
-        if (p - len - 3 > buff && strstr(p - len - 3, ENDSRCTBL)) break;
-        p += ns;
+	while(p<buff+MAXSRCTBL-1) {
+        int ns=strread(&str,(unsigned char*)p,(buff+MAXSRCTBL-p-1)); *(p+ns)='\0';
+		if (p-len-3>buff&&strstr(p-len-3,ENDSRCTBL)) break;
+		p+=ns;
         qApp->processEvents();
-        int stat = strstat(&str, msg);
+        int stat=strstat(&str,msg);
 
-        QMetaObject::invokeMethod(mainForm, "ShowMsg", Qt::QueuedConnection, Q_ARG(QString, msg));
+        QMetaObject::invokeMethod(mainForm,"ShowMsg",Qt::QueuedConnection,Q_ARG(QString,msg));
 
-        if (stat < 1) break;
-        if ((int)(tickget() - tick) > NTRIP_TIMEOUT) {
-            QMetaObject::invokeMethod(mainForm, "ShowMsg", Qt::QueuedConnection, Q_ARG(QString, QT_TR_NOOP("response timeout")));
+		if (stat<0) break;
+		if ((int)(tickget()-tick)>NTRIP_TIMEOUT) {
+            QMetaObject::invokeMethod(mainForm,"ShowMsg",Qt::QueuedConnection,Q_ARG(QString,QT_TR_NOOP("response timeout")));
 			break;
 		}
 	}
 	strclose(&str);
-    lock = 0;
+	lock=0;
 	return buff;
 }
 //---------------------------------------------------------------------------
@@ -80,17 +73,17 @@
 {
     setupUi(this);
     FiltFmt->setVisible(false);
-    mainForm = this;
+    mainForm=this;
 
     QCoreApplication::setApplicationName(PRGNAME);
     QCoreApplication::setApplicationVersion("1.0");
 
     setWindowIcon(QIcon(":/icons/srctblbrows_Icon"));
 
-    QString file = QApplication::applicationFilePath();
+    QString file=QApplication::applicationFilePath();
     QFileInfo fi(file);
-    IniFile = fi.absolutePath() + "/" + fi.baseName() + ".ini";
-
+    IniFile=fi.absolutePath()+"/"+fi.baseName()+".ini";
+    
     googleMapView = new GoogleMapView(this);
     staListDialog = new StaListDialog(this);
     Timer = new QTimer();
@@ -100,31 +93,33 @@
     TypeSrc->setDefaultAction(MenuViewSrc);
     TypeStr->setDefaultAction(MenuViewStr);
 
-    connect(Address, SIGNAL(currentTextChanged(QString)), this, SLOT(AddressChange()));
-    connect(BtnUpdate, SIGNAL(clicked(bool)), this, SLOT(BtnUpdateClick()));
-    connect(BtnMap, SIGNAL(clicked(bool)), this, SLOT(BtnMapClick()));
-    connect(BtnList, SIGNAL(clicked(bool)), this, SLOT(BtnListClick()));
-    connect(BtnSta, SIGNAL(clicked(bool)), this, SLOT(BtnStaClick()));
-    connect(StaMask, SIGNAL(clicked(bool)), this, SLOT(StaMaskClick()));
-    connect(MenuOpen, SIGNAL(triggered(bool)), this, SLOT(MenuOpenClick()));
-    connect(MenuSave, SIGNAL(triggered(bool)), this, SLOT(MenuSaveClick()));
-    connect(MenuQuit, SIGNAL(triggered(bool)), this, SLOT(MenuQuitClick()));
-    connect(MenuUpdateCaster, SIGNAL(triggered(bool)), this, SLOT(MenuUpdateCasterClick()));
-    connect(MenuUpdateTable, SIGNAL(triggered(bool)), this, SLOT(MenuUpdateTableClick()));
-    connect(MenuViewCas, SIGNAL(triggered(bool)), this, SLOT(MenuViewCasClick()));
-    connect(MenuViewNet, SIGNAL(triggered(bool)), this, SLOT(MenuViewNetClick()));
-    connect(MenuViewSrc, SIGNAL(triggered(bool)), this, SLOT(MenuViewSrcClick()));
-    connect(MenuViewStr, SIGNAL(triggered(bool)), this, SLOT(MenuViewStrClick()));
-    connect(MenuAbout, SIGNAL(triggered(bool)), this, SLOT(MenuAboutClick()));
-    connect(Timer, SIGNAL(timeout()), this, SLOT(TimerTimer()));
-    connect(Table0, SIGNAL(cellClicked(int,int)), this, SLOT(Table0SelectCell(int,int)));
+    connect(Address,SIGNAL(currentTextChanged(QString)),this,SLOT(AddressChange()));
+    connect(BtnUpdate,SIGNAL(clicked(bool)),this,SLOT(BtnUpdateClick()));
+    connect(BtnMap,SIGNAL(clicked(bool)),this,SLOT(BtnMapClick()));
+    connect(BtnList,SIGNAL(clicked(bool)),this,SLOT(BtnListClick()));
+    connect(BtnSta,SIGNAL(clicked(bool)),this,SLOT(BtnStaClick()));
+    connect(StaMask,SIGNAL(clicked(bool)),this,SLOT(StaMaskClick()));
+    connect(MenuOpen,SIGNAL(triggered(bool)),this,SLOT(MenuOpenClick()));
+    connect(MenuSave,SIGNAL(triggered(bool)),this,SLOT(MenuSaveClick()));
+    connect(MenuQuit,SIGNAL(triggered(bool)),this,SLOT(MenuQuitClick()));
+    connect(MenuUpdateCaster,SIGNAL(triggered(bool)),this,SLOT(MenuUpdateCasterClick()));
+    connect(MenuUpdateTable,SIGNAL(triggered(bool)),this,SLOT(MenuUpdateTableClick()));
+    connect(MenuViewCas,SIGNAL(triggered(bool)),this,SLOT(MenuViewCasClick()));
+    connect(MenuViewNet,SIGNAL(triggered(bool)),this,SLOT(MenuViewNetClick()));
+    connect(MenuViewSrc,SIGNAL(triggered(bool)),this,SLOT(MenuViewSrcClick()));
+    connect(MenuViewStr,SIGNAL(triggered(bool)),this,SLOT(MenuViewStrClick()));
+    connect(MenuAbout,SIGNAL(triggered(bool)),this,SLOT(MenuAboutClick()));
+    connect(Timer,SIGNAL(timeout()),this,SLOT(TimerTimer()));
+    connect(Table0,SIGNAL(cellClicked(int,int)),this,SLOT(Table0SelectCell(int,int)));
 
-    BtnMap->setEnabled(false);
 #ifdef QWEBKIT
     BtnMap->setEnabled(true);
-#endif
-#ifdef QWEBENGINE
+#else
+  #ifdef QWEBENGINE
     BtnMap->setEnabled(true);
+  #else
+    BtnMap->setEnabled(false);
+  #endif
 #endif
 
     Table0->setSortingEnabled(true);
@@ -142,14 +137,14 @@
 {
     if (event->spontaneous()) return;
 
-    const QString colw0 = "74,116,56,244,18,52,62,28,50,50,18,18,120,28,18,18,40,600,";
-    const QString colw1 = "112,40,96,126,18,28,50,50,160,40,600,0,0,0,0,0,0,0,";
-    const QString colw2 = "80,126,18,18,300,300,300,600,0,0,0,0,0,0,0,0,0,0,";
-    QSettings setting(IniFile, QSettings::IniFormat);
-    QString list, url = "";
-    QStringList colw, stas;
+    QString colw0="74,116,56,244,18,52,62,28,50,50,18,18,120,28,18,18,40,600,";
+    QString colw1="112,40,96,126,18,28,50,50,160,40,600,0,0,0,0,0,0,0,";
+    QString colw2="80,126,18,18,300,300,300,600,0,0,0,0,0,0,0,0,0,0,";
+    QSettings setting(IniFile,QSettings::IniFormat);
+    QString list,url="";
+    QStringList colw,stas;
     int i;
-
+	
     QCommandLineParser parser;
     parser.setApplicationDescription(PRGNAME);
     parser.addHelpOption();
@@ -160,91 +155,104 @@
 
     const QStringList args = parser.positionalArguments();
 
-    if (args.count() >= 1) url = args.at(0);
-
+    if (args.count()>=1) url=args.at(0);
+	
     setWindowTitle(QString("%1 ver.%2 %3").arg(PRGNAME).arg(VER_RTKLIB).arg(PATCH_LEVEL));
-
-    list = setting.value("srctbl/addrlist", "").toString();
-    QStringList items = list.split("@");
-    foreach(QString item, items){
+	
+    list=setting.value("srctbl/addrlist","").toString();
+    QStringList items=list.split("@");
+    foreach (QString item, items)
+    {
         Address->addItem(item);
     }
 
-    if (url != "") {
+    if (url!="") {
         Address->setCurrentText(url);
         GetTable();
-    } else {
-        Address->setCurrentText(setting.value("srctbl/address", "").toString());
+    }
+	else {
+        Address->setCurrentText(setting.value("srctbl/address","").toString());
 	}
 
-    FontScale = physicalDpiX();
+    FontScale=physicalDpiX();
 
-    colw = setting.value("srctbl/colwidth0", colw0).toString().split(",");
-    i = 0;
-    foreach(QString width, colw){
-        Table0->setColumnWidth(i++, width.toDouble() * FontScale / 96);
+    colw=setting.value("srctbl/colwidth0",colw0).toString().split(",");
+    i=0;
+    foreach (QString width,colw)
+    {
+        Table0->setColumnWidth(i++,width.toDouble()*FontScale/96);
+	}
+    colw=setting.value("srctbl/colwidth1",colw1).toString().split(",");
+    i=0;
+    foreach (QString width,colw)
+    {
+        Table1->setColumnWidth(i++,width.toDouble()*FontScale/96);
     }
-    colw = setting.value("srctbl/colwidth1", colw1).toString().split(",");
-    i = 0;
-    foreach(QString width, colw){
-        Table1->setColumnWidth(i++, width.toDouble() * FontScale / 96);
+    colw=setting.value("srctbl/colwidth2",colw2).toString().split(",");
+    i=0;
+    foreach (QString width,colw)
+    {
+        Table2->setColumnWidth(i++,width.toDouble()*FontScale/96);
     }
-    colw = setting.value("srctbl/colwidth2", colw2).toString().split(",");
-    i = 0;
-    foreach(QString width, colw){
-        Table2->setColumnWidth(i++, width.toDouble() * FontScale / 96);
-	}
 
     StaList.clear();
-    for (int i = 0; i < 10; i++) {
-        stas = setting.value(QString("sta/station%1").arg(i), "").toString().split(",");
-        foreach(QString sta, stas){
+    for (int i=0;i<10;i++) {
+        stas=setting.value(QString("sta/station%1").arg(i),"").toString().split(",");
+        foreach(QString sta, stas)
+        {
             StaList.append(sta);
         }
     }
-
+	
 	ShowTable();
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void MainForm::closeEvent(QCloseEvent *)
+void MainForm::closeEvent(QCloseEvent *event)
 {
-    QSettings setting(IniFile, QSettings::IniFormat);
-    QString list, colw;
-
-    setting.setValue("srctbl/address", Address->currentText());
-    for (int i = 0; i < Address->count(); i++)
-        list = list + Address->itemText(i) + "@";
-    setting.setValue("srctbl/addrlist", list);
-    colw = "";
-    for (int i = 0; i < Table0->columnCount(); i++)
-        colw = colw + QString::number(Table0->columnWidth(i) * 96 / FontScale);
-    setting.setValue("srctbl/colwidth0", colw);
-    colw = "";
-    for (int i = 0; i < Table1->columnCount(); i++)
-        colw = colw + QString::number(Table1->columnWidth(i) * 96 / FontScale);
-    setting.setValue("srctbl/colwidth1", colw);
-    colw = "";
-    for (int i = 0; i < Table2->columnCount(); i++)
-        colw = colw + QString::number(Table2->columnWidth(i) * 96 / FontScale);
-    setting.setValue("srctbl/colwidth2", colw);
+    if (event->spontaneous()) return;
 
-    for (int i = 0; i < 10; i++)
-        setting.setValue(QString("sta/station%1").arg(i), StaList.join(","));
+    QSettings setting(IniFile,QSettings::IniFormat);
+    QString list,colw;
+	
+    setting.setValue("srctbl/address",Address->currentText());
+    for (int i=0;i<Address->count();i++) {
+        list=list+Address->itemText(i)+"@";
+	}
+    setting.setValue("srctbl/addrlist",list);
+	colw="";
+    for (int i=0;i<Table0->columnCount();i++) {
+        colw=colw+QString::number(Table0->columnWidth(i)*96/FontScale);
+	}
+    setting.setValue("srctbl/colwidth0",colw);
+	colw="";
+    for (int i=0;i<Table1->columnCount();i++) {
+        colw=colw+QString::number(Table1->columnWidth(i)*96/FontScale);
+	}
+    setting.setValue("srctbl/colwidth1",colw);
+	colw="";
+    for (int i=0;i<Table2->columnCount();i++) {
+        colw=colw+QString::number(Table2->columnWidth(i)*96/FontScale);
+	}
+    setting.setValue("srctbl/colwidth2",colw);
+    
+    for (int i=0;i<10;i++) {
+        setting.setValue (QString("sta/station%1").arg(i),StaList.join(","));
+    }
 }
 //---------------------------------------------------------------------------
 void MainForm::MenuOpenClick()
 {
-    QString OpenDialog_FileName = QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Open"), QString(), tr("All File (*.*)")));
+    QString OpenDialog_FileName=QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Open"),QString(),tr("All File (*.*)")));
     QFile fp(OpenDialog_FileName);
 
-    SrcTable = "";
+    SrcTable="";
 
     if (!fp.open(QIODevice::ReadOnly)) return;
 
-    SrcTable = fp.readAll();
+    SrcTable=fp.readAll();
 
-    AddrCaster = Address->currentText();
+    AddrCaster=Address->currentText();
 
     ShowTable();
     ShowMsg(tr("source table loaded"));
@@ -252,7 +260,7 @@
 //---------------------------------------------------------------------------
 void MainForm::MenuSaveClick()
 {
-    QString SaveDialog_FileName = QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, tr("Save File"), QString(), tr("All File (*.*)")));
+    QString SaveDialog_FileName=QDir::toNativeSeparators(QFileDialog::getSaveFileName(this,tr("Save File"),QString(),tr("All File (*.*)")));
     QFile fp(SaveDialog_FileName);
 
     if (!fp.open(QIODevice::WriteOnly)) return;
@@ -311,10 +319,9 @@
 //---------------------------------------------------------------------------
 void MainForm::MenuAboutClick()
 {
-    AboutDialog *aboutDialog = new AboutDialog(this);
-
-    aboutDialog->About = PRGNAME;
-    aboutDialog->IconIndex = 7;
+    AboutDialog *aboutDialog=new AboutDialog(this);
+    aboutDialog->About=PRGNAME;
+    aboutDialog->IconIndex=7;
     aboutDialog->exec();
 
     delete aboutDialog;
@@ -326,12 +333,12 @@
     googleMapView->show();
 }
 //---------------------------------------------------------------------------
-void MainForm::Table0SelectCell(int ARow, int ACol)
+void MainForm::Table0SelectCell(int ACol, int ARow)
 {
     Q_UNUSED(ACol);
     QString title;
-    if (0 <= ARow && ARow < Table0->rowCount()) {
-        title = Table0->item(ARow,0)->text();
+    if (0<ARow&&ARow<Table0->rowCount()) {
+        title=Table0->item(ARow,0)->text();
         googleMapView->HighlightMark(title);
         googleMapView->setWindowTitle(QString(tr("NTRIP STR Map: %1/%2")).arg(Address->currentText()).arg(title));
 	}
@@ -362,16 +369,16 @@
 void MainForm::GetCaster(void)
 {
     if (CasterWatcher.isRunning()) return;
-    QString Address_Text = Address->currentText();
-    QString addr = NTRIP_HOME;
+    QString Address_Text=Address->currentText();
+    QString addr=NTRIP_HOME;
 
-    if (Address_Text != "") addr = Address_Text;
+    if (Address_Text!="") addr=Address_Text;
 
     BtnList->setEnabled(false);
     MenuUpdateCaster->setEnabled(false);
 
-    QFuture<char *> tblFuture = QtConcurrent::run(getsrctbl, addr);
-    connect(&CasterWatcher, SIGNAL(finished()), this, SLOT(UpdateCaster()));
+    QFuture<char*> tblFuture= QtConcurrent::run(getsrctbl,addr);
+    connect(&CasterWatcher,SIGNAL(finished()),this,SLOT(UpdateCaster()));
     CasterWatcher.setFuture(tblFuture);
 }
 //---------------------------------------------------------------------------
@@ -383,37 +390,37 @@
     BtnList->setEnabled(true);
     MenuUpdateCaster->setEnabled(true);
 
-    if ((srctbl = CasterWatcher.result()).isEmpty()) return;
+    if ((srctbl=CasterWatcher.result()).isEmpty())  return;
 
-    text = Address->currentText(); Address->clear(); Address->setCurrentText(text);
+    text=Address->currentText(); Address->clear(); Address->setCurrentText(text);
     Address->addItem("");
 
-    QStringList tokens, lines = srctbl.split('\n');
-    foreach(const QString &line, lines) {
+    QStringList tokens,lines=srctbl.split('\n');
+    foreach (const QString & line, lines) {
         if (!line.contains("CAS")) continue;
-        tokens = line.split(";");
-        if (tokens.size() < 3) continue;
-        Address->addItem(tokens.at(1) + ":" + tokens.at(2));
+        tokens=line.split(";");
+        if (tokens.size()<3) continue;
+        Address->addItem(tokens.at(1)+":"+tokens.at(2));
 	}
-    if (Address->count() > 1) Address->setCurrentIndex(0);
-    ShowMsg(tr("update caster list"));
+    if (Address->count()>1) Address->setCurrentIndex(0);
+	ShowMsg("update caster list");
 }
 //---------------------------------------------------------------------------
 void MainForm::GetTable(void)
 {
     if (TableWatcher.isRunning()) return;
 
-    QString Address_Text = Address->currentText();
-    QString addr = NTRIP_HOME;
+    QString Address_Text=Address->currentText();
+    QString addr=NTRIP_HOME;
 
-    if (Address_Text != "") addr = Address_Text;
+    if (Address_Text!="") addr=Address_Text;
 
     BtnUpdate->setEnabled(false);
     Address->setEnabled(false);
     MenuUpdateTable->setEnabled(false);
 
-    QFuture<char *> tblFuture = QtConcurrent::run(getsrctbl, addr);
-    connect(&TableWatcher, SIGNAL(finished()), this, SLOT(UpdateTable()));
+    QFuture<char*> tblFuture= QtConcurrent::run(getsrctbl,addr);
+    connect(&TableWatcher,SIGNAL(finished()),this,SLOT(UpdateTable()));
     TableWatcher.setFuture(tblFuture);
 }
 //---------------------------------------------------------------------------
@@ -425,72 +432,74 @@
     Address->setEnabled(true);
     MenuUpdateTable->setEnabled(true);
 
-    if (!(srctbl = TableWatcher.result()).isEmpty()) {
-        SrcTable = srctbl;
-        AddrCaster = Address->currentText();
+    if (!(srctbl=TableWatcher.result()).isEmpty()) {
+		SrcTable=srctbl;
+        AddrCaster=Address->currentText();
 	}
 	ShowTable();
 }
 //---------------------------------------------------------------------------
 void MainForm::ShowTable(void)
 {
-    const QString ti[3][18] = { { tr("Mountpoint"), tr("ID"),	tr("Format"),	      tr("Format-Details"), tr("Carrier"), tr("Nav-System"),
-                      tr("Network"), tr("Country"), tr("Latitude"), tr("Longitude"), tr("NMEA"), tr("Solution"),
-                      tr("Generator"), "Compr-Encrp", "Authentication", "Fee", "Bitrate", "" },
-                    { tr("Host"),	tr("Port"),	tr("ID"),	      tr("Operator"),	    tr("NMEA"),	   tr("Country"),   tr("Latitude"), tr("Longitude"),
-                      tr("Fallback_Host"), tr("Fallback_Port"), "", "", "", "", "", "", "" },
-                    { tr("ID"),		tr("Operator"), tr("Authentication"), tr("Fee"),	    tr("Web-Net"), tr("Web-Str"),   tr("Web-Reg"),  "",		    "","", "",
-                      "", "", "", "", "", "" } };
+    const QString ti[3][18]={{tr("Mountpoint"),tr("ID"),tr("Format"),tr("Format-Details"),tr("Carrier"),tr("Nav-System"),
+        tr("Network"),tr("Country"),tr("Latitude"),tr("Longitude"),tr("NMEA"),tr("Solution"),
+        tr("Generator"),"Compr-Encrp","Authentication","Fee","Bitrate",""},
+        {tr("Host"),tr("Port"),tr("ID"),tr("Operator"),tr("NMEA"),tr("Country"),tr("Latitude"),tr("Longitude"),
+        tr("Fallback_Host"),tr("Fallback_Port"),"","","","","","",""},
+        {tr("ID"),tr("Operator"),tr("Authentication"),tr("Fee"),tr("Web-Net"),tr("Web-Str"),tr("Web-Reg"),"","","","",
+        "","","","","",""}};
 
 
-    QTableWidget *table[] = { Table0, Table1, Table2 };
-    QAction *action[] = { MenuViewStr, MenuViewCas, MenuViewNet, MenuViewSrc };
-    int i, j, ns, type;
+    QTableWidget *table[]={Table0,Table1,Table2};
+    QAction *action[]={MenuViewStr,MenuViewCas,MenuViewNet,MenuViewSrc};
+    int i,j,ns,type;
 
     Table3->setVisible(false);
-    for (i = 0; i < 3; i++) table[i]->setVisible(false);
-
-    type = MenuViewStr->isChecked() ? 0 : (MenuViewCas->isChecked() ? 1 : (MenuViewNet->isChecked() ? 2 : 3));
-    for (i = 0; i < 4; i++) action[i]->setChecked(i == type);
-
-    if (type == 3) {
+    for (i=0;i<3;i++) table[i]->setVisible(false);
+	
+    type=MenuViewStr->isChecked()?0:(MenuViewCas->isChecked()?1:(MenuViewNet->isChecked()?2:3));
+    for (i=0;i<4;i++) action[i]->setChecked(i==type);
+	
+	if (type==3) {
         Table3->setVisible(true);
         Table3->setPlainText("");
-    } else {
+	}
+	else {
         table[type]->setVisible(true);
         table[type]->setRowCount(1);
         table[type]->setColumnCount(18);
-        for (i = 0; i < 18; i++) {
+		for (i=0;i<18;i++) {
             table[type]->setHorizontalHeaderItem(i, new QTableWidgetItem(ti[type][i]));
-            table[type]->setItem(0, i, new QTableWidgetItem(""));
+            table[type]->setItem(0,i, new QTableWidgetItem(""));
 		}
 	}
-    if (AddrCaster != Address->currentText()) return;
-    if (type == 3) {
+    if (AddrCaster!=Address->currentText()) return;
+	if (type==3) {
         Table3->setPlainText(SrcTable);
 		return;
 	}
-    QStringList lines = SrcTable.split("\n");
-    ns = 0;
-    foreach(QString line, lines) {
+    QStringList lines=SrcTable.split("\n");
+    ns=0;
+    foreach (QString line, lines) {
 		switch (type) {
-        case 0: if (line.contains("STR")) ns++; break;
-        case 1: if (line.contains("CAS")) ns++; break;
-        case 2: if (line.contains("NET")) ns++; break;
+            case 0: if (line.contains("STR")) ns++; break;
+            case 1: if (line.contains("CAS")) ns++; break;
+            case 2: if (line.contains("NET")) ns++; break;
 		}
 	}
-    if (ns <= 0) return;
+	if (ns<=0) return;
     table[type]->setRowCount(ns);
-    j = 0;
-    foreach(QString line, lines) {
+    j=0;
+    foreach (QString line, lines) {
 		switch (type) {
-        case 0: if (line.contains("STR")) break; else continue;
-        case 1: if (line.contains("CAS")) break; else continue;
-        case 2: if (line.contains("NET")) break; else continue;
+            case 0: if (line.contains("STR")) break; else continue;
+            case 1: if (line.contains("CAS")) break; else continue;
+            case 2: if (line.contains("NET")) break; else continue;
+		}
+        QStringList tokens=line.split(";");
+        for (int i=0;i<18&&i<tokens.size();i++) {
+            table[type]->setItem(j,i-1, new QTableWidgetItem(tokens.at(i)));
 		}
-        QStringList tokens = line.split(";");
-        for (int i = 0; i < 18 && i < tokens.size(); i++)
-            table[type]->setItem(j, i - 1, new QTableWidgetItem(tokens.at(i)));
 		j++;
 	}
 	UpdateMap();
@@ -498,37 +507,38 @@
 //---------------------------------------------------------------------------
 void MainForm::ShowMsg(const QString &msg)
 {
-    QString str = msg;
-
+    QString str=msg;
     Message->setText(str);
 }
 //---------------------------------------------------------------------------
 void MainForm::UpdateMap(void)
 {
-    QString title, msg, LatText, LonText;
-    double lat, lon;
+    QString title,msg,LatText,LonText;
+	double lat,lon;
     bool okay;
-
-    if (Address->currentText() == "")
+	
+    if (Address->currentText()=="") {
         googleMapView->setWindowTitle(tr("NTRIP STR Map"));
-    else
+	}
+	else {
         googleMapView->setWindowTitle(QString(tr("NTRIP STR Map: %1")).arg(Address->currentText()));
+	}
     googleMapView->ClearMark();
-
-    for (int i = 0; i < Table0->rowCount(); i++) {
-        if (Table0->item(i, 8)->text() == "") continue;
-        LatText = Table0->item(i, 8)->text();
-        LonText = Table0->item(i, 9)->text();
-        lat = LatText.toDouble(&okay); if (!okay) continue;
-        lon = LonText.toDouble(&okay); if (!okay) continue;
-        title = Table0->item(i, 0)->text();
-        msg = "<b>" + Table0->item(i, 0)->text() + "</b>: " +
-              Table0->item(i, 1)->text() + " (" + Table0->item(i, 7)->text() + "), POS: " +
-              Table0->item(i, 8)->text() + ", " + Table0->item(i, 9)->text() + "<br>" +
-              Table0->item(i, 2)->text() + ": " + Table0->item(i, 3)->text() + "<br>" +
-              Table0->item(i, 5)->text() + ", " + Table0->item(i, 6)->text() + ", " +
-              Table0->item(i, 12)->text();
-        googleMapView->AddMark(lat, lon, title, msg);
+	
+    for (int i=0;i<Table0->rowCount();i++) {
+        if (Table0->item(i,8)->text()=="") continue;
+        LatText=Table0->item(i,8)->text();
+        LonText=Table0->item(i,9)->text();
+        lat=LatText.toDouble(&okay); if (!okay) continue;
+        lon=LonText.toDouble(&okay); if (!okay) continue;
+        title=Table0->item(i,0)->text();
+        msg="<b>"+Table0->item(i,0)->text()+"</b>: "+
+            Table0->item(i,1)->text()+" ("+Table0->item(i,7)->text()+"), POS: "+
+            Table0->item(i,8)->text()+", "+Table0->item(i,9)->text()+"<br>"+
+            Table0->item(i,2)->text()+": "+Table0->item(i,3)->text()+"<br>"+
+            Table0->item(i,5)->text()+", "+Table0->item(i,6)->text()+", "+
+            Table0->item(i,12)->text();
+        googleMapView->AddMark(lat,lon,title,msg);
 	}
 }
 //---------------------------------------------------------------------------
@@ -547,3 +557,4 @@
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
+
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/srctblbrows_qt/browsmain.h RTKLIB-rtklib_2.4.3_new/app/srctblbrows_qt/browsmain.h
--- RTKLIB-rtklib_2.4.3_orig/app/srctblbrows_qt/browsmain.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/srctblbrows_qt/browsmain.h	2019-08-19 02:04:50.000000000 +0300
@@ -18,7 +18,6 @@
 class MainForm : public QMainWindow, private Ui::MainForm
 {
     Q_OBJECT
-
 protected:
     void showEvent(QShowEvent*);
     void closeEvent(QCloseEvent*);
@@ -39,7 +38,7 @@
     void MenuAboutClick();
     void BtnMapClick();
     void TimerTimer();
-    void Table0SelectCell(int ARow, int ACol);
+    void Table0SelectCell(int ACol, int ARow);
     void BtnStaClick();
     void StaMaskClick();
     void UpdateCaster();
@@ -47,7 +46,7 @@
     void ShowMsg(const QString &);
 
 private:
-    QString AddrList, AddrCaster, SrcTable, IniFile;
+    QString AddrList,AddrCaster,SrcTable,IniFile;
 	int FontScale;
     GoogleMapView *googleMapView;
     StaListDialog *staListDialog;
@@ -63,7 +62,7 @@
 public:
     QStringList StaList;
 
-    explicit MainForm(QWidget *parent = NULL);
+    explicit MainForm(QWidget *parent=NULL);
 };
 //---------------------------------------------------------------------------
 #endif
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/srctblbrows_qt/browsmain.ui RTKLIB-rtklib_2.4.3_new/app/srctblbrows_qt/browsmain.ui
--- RTKLIB-rtklib_2.4.3_orig/app/srctblbrows_qt/browsmain.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/srctblbrows_qt/browsmain.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>1098</width>
-    <height>394</height>
+    <width>833</width>
+    <height>422</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -63,6 +63,9 @@
           <string/>
          </property>
          <layout class="QHBoxLayout" name="horizontalLayout_4">
+          <property name="spacing">
+           <number>0</number>
+          </property>
           <property name="leftMargin">
            <number>0</number>
           </property>
@@ -87,7 +90,7 @@
              <string/>
             </property>
             <property name="icon">
-             <iconset resource="../strsvr_qt/strsvr_qt.qrc">
+             <iconset resource="../rtkget_qt/rtkget_qt.qrc">
               <normaloff>:/buttons/reload.bmp</normaloff>:/buttons/reload.bmp</iconset>
             </property>
            </widget>
@@ -123,7 +126,7 @@
              <string/>
             </property>
             <property name="icon">
-             <iconset resource="../strsvr_qt/strsvr_qt.qrc">
+             <iconset resource="../rtkget_qt/rtkget_qt.qrc">
               <normaloff>:/buttons/load.bmp</normaloff>:/buttons/load.bmp</iconset>
             </property>
             <property name="flat">
@@ -445,8 +448,8 @@
     <rect>
      <x>0</x>
      <y>0</y>
-     <width>1098</width>
-     <height>27</height>
+     <width>833</width>
+     <height>21</height>
     </rect>
    </property>
    <widget class="QMenu" name="File1">
@@ -576,7 +579,7 @@
   </action>
  </widget>
  <resources>
-  <include location="../strsvr_qt/strsvr_qt.qrc"/>
+  <include location="../rtkget_qt/rtkget_qt.qrc"/>
  </resources>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/srctblbrows_qt/rtklib_gm.htm RTKLIB-rtklib_2.4.3_new/app/srctblbrows_qt/rtklib_gm.htm
--- RTKLIB-rtklib_2.4.3_orig/app/srctblbrows_qt/rtklib_gm.htm	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/srctblbrows_qt/rtklib_gm.htm	2019-08-19 02:04:50.000000000 +0300
@@ -1,5 +1,5 @@
 <!------------------------------------------------------------------------------
-* rtkplot_gm.htm: rtkplot google map view
+* rtklib_gmap.htm: rtklib google map view
 *
 * history: 2013/01/20 1.0  new
 *------------------------------------------------------------------------------>
@@ -30,20 +30,10 @@
     document.getElementById('state').value='1';
 }
 
-function SetView(lat,lon,zoom) {
-    if (map == null) return;
-    map.setCenter(new google.maps.LatLng(lat,lon));
-    map.setZoom(zoom);
-}
-
-function SetCent(lat,lon) {
-    if (map == null) return;
-    map.setCenter(new google.maps.LatLng(lat,lon));
-}
-
-function SetZoom(zoom) {
+function ShowHome() {
     if (map == null) return;
-    map.setZoom(zoom);
+    map.setCenter(new google.maps.LatLng(0,0));
+    map.setZoom(2);
 }
 
 function ClearMark(lat,lon,title) {
@@ -80,33 +70,6 @@
         }
     }
 }
-
-function PosMark(lat,lon,title) {
-    for (var i in marks) {
-        if (marks[i].title==title) {
-            marks[i].setPosition(new google.maps.LatLng(lat,lon));
-            break;
-        }
-    }
-}
-
-function ShowMark(title) {
-    for (var i in marks) {
-        if (marks[i].title==title) {
-            marks[i].setVisible(true);
-            break;
-        }
-    }
-}
-
-function HideMark(title) {
-    for (var i in marks) {
-        if (marks[i].title==title) {
-            marks[i].setVisible(false);
-            break;
-        }
-    }
-}
 
 </script>
 </head>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/srctblbrows_qt/srctblbrows.cpp RTKLIB-rtklib_2.4.3_new/app/srctblbrows_qt/srctblbrows.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/srctblbrows_qt/srctblbrows.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/srctblbrows_qt/srctblbrows.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -5,7 +5,6 @@
 {
     QApplication a(argc, argv);
     MainForm w(NULL);
-
     w.show();
 
     return a.exec();
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/srctblbrows_qt/srctblbrows_qt.pro RTKLIB-rtklib_2.4.3_new/app/srctblbrows_qt/srctblbrows_qt.pro
--- RTKLIB-rtklib_2.4.3_orig/app/srctblbrows_qt/srctblbrows_qt.pro	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/srctblbrows_qt/srctblbrows_qt.pro	2019-08-19 02:04:50.000000000 +0300
@@ -4,9 +4,13 @@
 #
 #-------------------------------------------------
 
-QT       += core gui widgets
+QT       += core gui
 
-include(../app.pri)
+greaterThan(QT_MAJOR_VERSION, 4): QT += widgets
+
+include(../../RTKLib.pri)
+
+INCLUDEPATH += ../../src/ ../appcmn_qt
 
 qtHaveModule(webenginewidgets) {
     QT+= webenginewidgets
@@ -18,10 +22,28 @@
     }
 }
 
-INCLUDEPATH += ../../src/ ../appcmn_qt
 
+
+linux{
+    RTKLIB =../../src/libRTKLib.a
+    LIBS += -lpng $${RTKLIB}
+}
+win32 {
+    CONFIG(debug) {
+        RTKLIB = ../../src/debug/libRTKLib.a
+    } else {
+        RTKLIB =../../src/release/libRTKLib.a
+    }
+
+    LIBS+= $${RTKLIB} -lWs2_32 -lwinmm
+}
+
+PRE_TARGETDEPS = $${RTKLIB}
+
+TARGET = srctblbrows_qt
 TEMPLATE = app
 
+
 SOURCES += \ 
     browsmain.cpp \
     srctblbrows.cpp \
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/srctblbrows_qt/staoptdlg.cpp RTKLIB-rtklib_2.4.3_new/app/srctblbrows_qt/staoptdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/srctblbrows_qt/staoptdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/srctblbrows_qt/staoptdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -9,32 +9,34 @@
 extern MainForm *mainForm;
 
 //---------------------------------------------------------------------------
-StaListDialog::StaListDialog(QWidget *parent)
+StaListDialog::StaListDialog(QWidget* parent)
     : QDialog(parent)
 {
     setupUi(this);
 
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(BtnLoad, SIGNAL(clicked(bool)), this, SLOT(BtnLoadClick()));
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnSave, SIGNAL(clicked(bool)), this, SLOT(BtnSaveClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(BtnLoad,SIGNAL(clicked(bool)),this,SLOT(BtnLoadClick()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnSave,SIGNAL(clicked(bool)),this,SLOT(BtnSaveClick()));
 }
 //---------------------------------------------------------------------------
 void StaListDialog::showEvent(QShowEvent *event)
 {
     if (event->spontaneous()) return;
     StaList->clear();
-
-    for (int i = 0; i < mainForm->StaList.count(); i++)
+    
+    for (int i=0;i<mainForm->StaList.count();i++) {
         StaList->addItem(mainForm->StaList.at(i));
+    }
 }
 //---------------------------------------------------------------------------
 void StaListDialog::BtnOkClick()
 {
     mainForm->StaList.clear();
-
-    for (int i = 0; i < StaList->count(); i++)
+    
+    for (int i=0;i<StaList->count();i++) {
         mainForm->StaList.append(StaList->item(i)->text());
+    }
 }
 //---------------------------------------------------------------------------
 void StaListDialog::BtnLoadClick()
@@ -42,19 +44,20 @@
     QString file;
     QFile fp;
     QByteArray buff;
-
-
-    file = QDir::toNativeSeparators(QFileDialog::getOpenFileName(this, tr("Open...")));
+    
+    
+    file=QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Open...")));
 
     fp.setFileName(file);
     if (!fp.open(QIODevice::ReadOnly)) return;
-
+        
     StaList->clear();
     StaList->setVisible(false);
-
-    while (!fp.atEnd()) {
-        buff = fp.readLine();
-        buff = buff.mid(buff.indexOf('#'));
+    
+    while (!fp.atEnd())
+    {
+        buff=fp.readLine();
+        buff=buff.mid(buff.indexOf('#'));
         StaList->addItem(buff);
     }
 
@@ -63,13 +66,15 @@
 //---------------------------------------------------------------------------
 void StaListDialog::BtnSaveClick()
 {
-    QString file = QDir::toNativeSeparators(QFileDialog::getSaveFileName(this, tr("Save...")));
+    QString file=QDir::toNativeSeparators(QFileDialog::getSaveFileName(this,tr("Save...")));
     QFile fp;
 
     fp.setFileName(file);
     if (!fp.open(QIODevice::WriteOnly)) return;
 
-    for (int i = 0; i < StaList->count(); i++)
-        fp.write((StaList->item(i)->text() + "\n").toLatin1());
+    for (int i=0;i<StaList->count();i++)
+    {
+        fp.write((StaList->item(i)->text()+"\n").toLatin1());
+    }
 }
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/srctblbrows_qt/staoptdlg.ui RTKLIB-rtklib_2.4.3_new/app/srctblbrows_qt/staoptdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/srctblbrows_qt/staoptdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/srctblbrows_qt/staoptdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,7 +6,7 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>351</width>
+    <width>214</width>
     <height>300</height>
    </rect>
   </property>
@@ -17,6 +17,12 @@
    <string/>
   </property>
   <layout class="QVBoxLayout" name="verticalLayout">
+   <property name="leftMargin">
+    <number>9</number>
+   </property>
+   <property name="topMargin">
+    <number>9</number>
+   </property>
    <item>
     <widget class="QListWidget" name="StaList"/>
    </item>
@@ -35,6 +41,9 @@
       <string/>
      </property>
      <layout class="QHBoxLayout" name="horizontalLayout">
+      <property name="spacing">
+       <number>0</number>
+      </property>
       <property name="leftMargin">
        <number>0</number>
       </property>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/convdlg.cpp RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/convdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/convdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/convdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -11,13 +11,14 @@
     setupUi(this);
 
 	int i;
-    for (i = 0; i <= MAXRCVFMT; i++)
+	for (i=0;i<=MAXRCVFMT;i++) {
         InFormat->addItem(formatstrs[i]);
+	}
     InFormat->setCurrentIndex(0);
 
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(Conversion, SIGNAL(clicked(bool)), this, SLOT(ConversionClick()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(Conversion,SIGNAL(clicked(bool)),this,SLOT(ConversionClick()));
 }
 //---------------------------------------------------------------------------
 void ConvDialog::showEvent(QShowEvent *event)
@@ -25,7 +26,7 @@
     if (event->spontaneous()) return;
 
     Conversion->setChecked(ConvEna);
-    InFormat->setCurrentIndex(ConvInp);
+    InFormat ->setCurrentIndex(ConvInp);
     OutFormat->setCurrentIndex(ConvOut);
     OutMsgs->setText(ConvMsg);
     Options->setText(ConvOpt);
@@ -35,11 +36,11 @@
 //---------------------------------------------------------------------------
 void ConvDialog::BtnOkClick()
 {
-    ConvEna = Conversion->isChecked();
-    ConvInp = InFormat->currentIndex();
-    ConvOut = OutFormat->currentIndex();
-    ConvMsg = OutMsgs->text();
-    ConvOpt = Options->text();
+    ConvEna=Conversion->isChecked();
+    ConvInp=InFormat->currentIndex();
+    ConvOut=OutFormat->currentIndex();
+    ConvMsg=OutMsgs->text();
+    ConvOpt=Options->text();
 
     accept();
 }
@@ -51,9 +52,9 @@
 //---------------------------------------------------------------------------
 void ConvDialog::UpdateEnable(void)
 {
-    InFormat->setEnabled(Conversion->isChecked());
+    InFormat ->setEnabled(Conversion->isChecked());
     OutFormat->setEnabled(Conversion->isChecked());
-    OutMsgs->setEnabled(Conversion->isChecked());
-    Options->setEnabled(Conversion->isChecked());
+    OutMsgs  ->setEnabled(Conversion->isChecked());
+    Options  ->setEnabled(Conversion->isChecked());
 }
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/convdlg.h RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/convdlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/convdlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/convdlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -10,21 +10,18 @@
 class ConvDialog : public QDialog, private Ui::ConvDialog
 {
     Q_OBJECT
-
 public slots:
+
     void BtnOkClick();
     void ConversionClick();
-
 protected:
     void showEvent(QShowEvent*);
-
 private:
     void UpdateEnable(void);
-
 public:
-    QString ConvMsg, ConvOpt, AntType, RcvType;
-    int ConvEna, ConvInp, ConvOut, StaId;
-    double AntPos[3], AntOff[3];
+    QString ConvMsg,ConvOpt,AntType,RcvType;
+	int ConvEna,ConvInp,ConvOut,StaId;
+	double AntPos[3],AntOff[3];
 	
     explicit ConvDialog(QWidget *parent);
 };
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/convdlg.ui RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/convdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/convdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/convdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>357</width>
-    <height>122</height>
+    <width>430</width>
+    <height>112</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -29,157 +29,124 @@
    <property name="bottomMargin">
     <number>0</number>
    </property>
-   <item row="4" column="0" colspan="2">
-    <widget class="QWidget" name="widget_2" native="true">
-     <layout class="QHBoxLayout" name="horizontalLayout_2">
-      <property name="leftMargin">
-       <number>0</number>
-      </property>
-      <property name="topMargin">
-       <number>0</number>
-      </property>
-      <property name="rightMargin">
-       <number>0</number>
-      </property>
-      <property name="bottomMargin">
-       <number>0</number>
-      </property>
-      <item>
-       <widget class="QLabel" name="Label10">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>Options</string>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QLineEdit" name="Options">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string/>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QPushButton" name="BtnOk">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>&amp;OK</string>
-        </property>
-        <property name="autoDefault">
-         <bool>true</bool>
-        </property>
-        <property name="default">
-         <bool>true</bool>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QPushButton" name="BtnCancel">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>&amp;Cancel</string>
-        </property>
-       </widget>
-      </item>
-     </layout>
+   <property name="spacing">
+    <number>0</number>
+   </property>
+   <item row="0" column="1">
+    <widget class="QComboBox" name="InFormat">
+     <property name="enabled">
+      <bool>false</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
     </widget>
    </item>
-   <item row="0" column="0" colspan="2">
-    <widget class="QWidget" name="widget" native="true">
-     <layout class="QHBoxLayout" name="horizontalLayout">
-      <property name="leftMargin">
-       <number>0</number>
-      </property>
-      <property name="topMargin">
-       <number>0</number>
-      </property>
-      <property name="rightMargin">
-       <number>0</number>
+   <item row="7" column="0">
+    <widget class="QLabel" name="Label10">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>Options</string>
+     </property>
+    </widget>
+   </item>
+   <item row="7" column="1">
+    <widget class="QLineEdit" name="Options">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string/>
+     </property>
+    </widget>
+   </item>
+   <item row="7" column="2" colspan="5">
+    <widget class="QPushButton" name="BtnOk">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>&amp;OK</string>
+     </property>
+     <property name="autoDefault">
+      <bool>true</bool>
+     </property>
+     <property name="default">
+      <bool>true</bool>
+     </property>
+    </widget>
+   </item>
+   <item row="7" column="7">
+    <widget class="QPushButton" name="BtnCancel">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>&amp;Cancel</string>
+     </property>
+    </widget>
+   </item>
+   <item row="0" column="3">
+    <widget class="QComboBox" name="OutFormat">
+     <property name="enabled">
+      <bool>false</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <item>
+      <property name="text">
+       <string>RTCM 2</string>
       </property>
-      <property name="bottomMargin">
-       <number>0</number>
+     </item>
+     <item>
+      <property name="text">
+       <string>RTCM 3</string>
       </property>
-      <item>
-       <widget class="QCheckBox" name="Conversion">
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>Conversion From</string>
-        </property>
-        <property name="checked">
-         <bool>false</bool>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QComboBox" name="InFormat">
-        <property name="enabled">
-         <bool>false</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QLabel" name="Label2">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <property name="text">
-         <string>To</string>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QComboBox" name="OutFormat">
-        <property name="enabled">
-         <bool>false</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <item>
-         <property name="text">
-          <string>RTCM 2</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>RTCM 3</string>
-         </property>
-        </item>
-       </widget>
-      </item>
-     </layout>
+     </item>
     </widget>
    </item>
-   <item row="2" column="0" colspan="2">
+   <item row="0" column="0">
+    <widget class="QCheckBox" name="Conversion">
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>Conversion From</string>
+     </property>
+     <property name="checked">
+      <bool>false</bool>
+     </property>
+    </widget>
+   </item>
+   <item row="0" column="2">
+    <widget class="QLabel" name="Label2">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>To</string>
+     </property>
+    </widget>
+   </item>
+   <item row="1" column="0" colspan="4">
     <widget class="QLabel" name="Label4">
      <property name="enabled">
       <bool>true</bool>
@@ -188,11 +155,11 @@
       <string/>
      </property>
      <property name="text">
-      <string>Message Types  (Interval: s) separeted by ,</string>
+      <string>Message Types  (Inteval: s) separeted by ,</string>
      </property>
     </widget>
    </item>
-   <item row="3" column="0" colspan="2">
+   <item row="2" column="0" colspan="4">
     <widget class="QLineEdit" name="OutMsgs">
      <property name="enabled">
       <bool>true</bool>
@@ -207,15 +174,6 @@
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>Conversion</tabstop>
-  <tabstop>InFormat</tabstop>
-  <tabstop>OutFormat</tabstop>
-  <tabstop>OutMsgs</tabstop>
-  <tabstop>Options</tabstop>
-  <tabstop>BtnOk</tabstop>
-  <tabstop>BtnCancel</tabstop>
- </tabstops>
  <resources/>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/mondlg.cpp RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/mondlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/mondlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/mondlg.cpp	1970-01-01 03:00:00.000000000 +0300
@@ -1,157 +0,0 @@
-//---------------------------------------------------------------------------
-#include <ctype.h>
-#include <QScrollBar>
-
-#include <stdio.h>
-
-#include "mondlg.h"
-//---------------------------------------------------------------------------
-
-#define MAXLEN		200
-#define MAXLINE		2048
-#define TOPMARGIN	2
-#define LEFTMARGIN	3
-
-//---------------------------------------------------------------------------
-StrMonDialog::StrMonDialog(QWidget *parent)
-    : QDialog(parent)
-{
-    setupUi(this);
-
-    connect(BtnClose, SIGNAL(clicked(bool)), this, SLOT(BtnCloseClick()));
-    connect(BtnClear, SIGNAL(clicked(bool)), this, SLOT(BtnClearClick()));
-    connect(BtnDown, SIGNAL(clicked(bool)), this, SLOT(BtnDownClick()));
-    connect(SelFmt, SIGNAL(currentIndexChanged(int)), this, SLOT(SelFmtChange()));
-
-    ConBuff.clear();
-    Console->clear();
-    Stop = 0;
-    StrFmt = 0;
-    for (int i = 0; i <= MAXRCVFMT; i++) {
-        SelFmt->addItem(formatstrs[i]);
-    }
-    rtcm.outtype = raw.outtype = 1;
-}
-//---------------------------------------------------------------------------
-void StrMonDialog::BtnCloseClick()
-{
-    accept();
-}
-//---------------------------------------------------------------------------
-void StrMonDialog::SelFmtChange()
-{
-    if ((StrFmt-3 == STRFMT_RTCM2) || (StrFmt-3 == STRFMT_RTCM3)) {
-        free_rtcm(&rtcm);
-    }
-    else if (StrFmt >= 3) {
-        free_raw(&raw);
-    }
-    StrFmt = SelFmt->currentIndex();
-    ConBuff.clear();
-
-    if ((StrFmt - 3 == STRFMT_RTCM2)|| (StrFmt - 3 == STRFMT_RTCM3)) {
-        init_rtcm(&rtcm);
-        rtcm.outtype = 1;
-    }
-    else if (StrFmt >= 3) {
-        init_raw(&raw, StrFmt - 3);
-        raw.outtype = 1;
-    }
-    Console->clear();
-}
-//---------------------------------------------------------------------------
-void StrMonDialog::AddMsg(unsigned char *msg, int len)
-{
-    int i;
-
-    if (len <= 0) return;
-
-    else if (StrFmt - 3 == STRFMT_RTCM2) {
-        for (i = 0; i < len; i++) {
-            input_rtcm2(&rtcm, msg[i]);
-            if (rtcm.msgtype[0]) {
-                QString buff=QString("%1\n").arg(rtcm.msgtype);
-                AddConsole((unsigned char*)qPrintable(buff), buff.size(), 1);
-                rtcm.msgtype[0] = '\0';
-            }
-        }
-    }
-    else if (StrFmt - 3 == STRFMT_RTCM3) {
-        for (i = 0; i < len; i++) {
-            input_rtcm3(&rtcm, msg[i]);
-            if (rtcm.msgtype[0]) {
-                QString buff=QString("%1\n").arg(rtcm.msgtype);
-                AddConsole((unsigned char*)qPrintable(buff), buff.size(), 1);
-                rtcm.msgtype[0] = '\0';
-            }
-        }
-    }
-    else if (StrFmt >= 3) { // raw
-        for (i = 0; i < len; i++) {
-            input_raw(&raw,StrFmt - 3, msg[i]);
-            if (raw.msgtype[0]) {
-                QString buff=QString("%1\n").arg(raw.msgtype);
-                AddConsole((unsigned char*)qPrintable(buff), buff.size(), 1);
-                raw.msgtype[0] = '\0';
-            }
-        }
-    }
-    else if (StrFmt>=1) { // HEX/ASC
-        AddConsole(msg,len,StrFmt-1);
-    }
-    else { // Streams
-        ConBuff.clear();
-        AddConsole(msg,len,1);
-    }
-}
-//---------------------------------------------------------------------------
-void StrMonDialog::AddConsole(unsigned char *msg, int n, int mode)
-{
-    char buff[MAXLEN + 16], *p = buff;
-
-     if (BtnStop->isChecked()) return;
-
-     if (n <= 0) return;
-
-     if (ConBuff.count() == 0) ConBuff.append("");
-     p += sprintf(p, "%s", qPrintable(ConBuff.at(ConBuff.count() - 1)));
-
-     for (int i = 0; i < n; i++) {
-         if (mode) {
-             if (msg[i] == '\r') continue;
-             p += sprintf(p, "%c", msg[i] == '\n' || isprint(msg[i]) ? msg[i] : '.');
-         } else {
-             p += sprintf(p, "%s%02X", (p - buff) % 17 == 16 ? " " : "", msg[i]);
-             if (p - buff >= 67) p += sprintf(p, "\n");
-         }
-         if (p - buff >= MAXLEN) p += sprintf(p, "\n");
-
-         if (*(p - 1) == '\n') {
-             ConBuff[ConBuff.count() - 1] = buff;
-             ConBuff.append("");
-             *(p = buff) = 0;
-             if (ConBuff.count() >= MAXLINE) ConBuff.removeFirst();
-         }
-     }
-     ConBuff[ConBuff.count() - 1] = buff;
-
-     Console->setColumnCount(1);
-     Console->setRowCount(ConBuff.size());
-     for (int i = 0; i < ConBuff.size(); i++)
-         Console->setItem(i, 0, new QTableWidgetItem(ConBuff.at(i)));
-
-     if (BtnDown->isChecked()) Console->verticalScrollBar()->setValue(Console->verticalScrollBar()->maximum());
-}
-//---------------------------------------------------------------------------
-void StrMonDialog::BtnClearClick()
-{
-    ConBuff.clear();
-    Console->clear();
-    Console->setRowCount(0);
-}
-//---------------------------------------------------------------------------
-void StrMonDialog::BtnDownClick()
-{
-    Console->verticalScrollBar()->setValue(Console->verticalScrollBar()->maximum());
-}
-//---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/mondlg.h RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/mondlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/mondlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/mondlg.h	1970-01-01 03:00:00.000000000 +0300
@@ -1,38 +0,0 @@
-//---------------------------------------------------------------------------
-#ifndef mondlgH
-#define mondlgH
-//---------------------------------------------------------------------------
-#include <QDialog>
-#include <QStringList>
-
-#include "rtklib.h"
-
-#include "ui_mondlg.h"
-
-#define MAX_MSG_BUFF	4096
-
-//---------------------------------------------------------------------------
-class StrMonDialog : public QDialog, private Ui::StrMonDialog
-{
-    Q_OBJECT
-public slots:
-    void BtnCloseClick();
-    void BtnClearClick();
-    void BtnDownClick();
-    void SelFmtChange();
-
-private:
-    QStringList ConBuff;
-    int Stop;
-    rtcm_t rtcm;
-    raw_t raw;
-
-    void AddConsole(unsigned char *msg, int len, int mode);
-
-public:
-    int StrFmt;
-    explicit StrMonDialog(QWidget *parent);
-    void AddMsg(unsigned char *buff, int n);
-};
-//---------------------------------------------------------------------------
-#endif
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/mondlg.ui RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/mondlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/mondlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/mondlg.ui	1970-01-01 03:00:00.000000000 +0300
@@ -1,197 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<ui version="4.0">
- <class>StrMonDialog</class>
- <widget class="QWidget" name="StrMonDialog">
-  <property name="geometry">
-   <rect>
-    <x>0</x>
-    <y>0</y>
-    <width>623</width>
-    <height>415</height>
-   </rect>
-  </property>
-  <property name="windowTitle">
-   <string>Input Stream Monitor</string>
-  </property>
-  <property name="toolTip">
-   <string/>
-  </property>
-  <layout class="QVBoxLayout" name="verticalLayout">
-   <item>
-    <widget class="QWidget" name="Panel1" native="true">
-     <property name="enabled">
-      <bool>true</bool>
-     </property>
-     <property name="toolTip">
-      <string/>
-     </property>
-     <property name="text" stdset="0">
-      <string/>
-     </property>
-     <layout class="QHBoxLayout" name="horizontalLayout">
-      <property name="leftMargin">
-       <number>0</number>
-      </property>
-      <property name="topMargin">
-       <number>0</number>
-      </property>
-      <property name="rightMargin">
-       <number>0</number>
-      </property>
-      <property name="bottomMargin">
-       <number>0</number>
-      </property>
-      <item>
-       <widget class="QComboBox" name="SelFmt">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <item>
-         <property name="text">
-          <string>Stream</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>HEX</string>
-         </property>
-        </item>
-        <item>
-         <property name="text">
-          <string>ASCII</string>
-         </property>
-        </item>
-       </widget>
-      </item>
-      <item>
-       <widget class="QPushButton" name="BtnClear">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string>Clear</string>
-        </property>
-        <property name="text">
-         <string/>
-        </property>
-        <property name="icon">
-         <iconset resource="../rtkvplayer_qt/rtkvplayer_qt.qrc">
-          <normaloff>:/buttons/del.bmp</normaloff>:/buttons/del.bmp</iconset>
-        </property>
-        <property name="flat">
-         <bool>true</bool>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QPushButton" name="BtnStop">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string>Pause</string>
-        </property>
-        <property name="text">
-         <string/>
-        </property>
-        <property name="icon">
-         <iconset resource="../rtkvplayer_qt/rtkvplayer_qt.qrc">
-          <normaloff>:/buttons/pause.bmp</normaloff>:/buttons/pause.bmp</iconset>
-        </property>
-        <property name="checkable">
-         <bool>true</bool>
-        </property>
-        <property name="flat">
-         <bool>true</bool>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <widget class="QPushButton" name="BtnDown">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string>Scroll Down</string>
-        </property>
-        <property name="text">
-         <string/>
-        </property>
-        <property name="icon">
-         <iconset resource="../rtkvplayer_qt/rtkvplayer_qt.qrc">
-          <normaloff>:/buttons/fitd.bmp</normaloff>:/buttons/fitd.bmp</iconset>
-        </property>
-        <property name="checkable">
-         <bool>true</bool>
-        </property>
-        <property name="flat">
-         <bool>true</bool>
-        </property>
-       </widget>
-      </item>
-      <item>
-       <spacer name="horizontalSpacer">
-        <property name="orientation">
-         <enum>Qt::Horizontal</enum>
-        </property>
-        <property name="sizeHint" stdset="0">
-         <size>
-          <width>40</width>
-          <height>20</height>
-         </size>
-        </property>
-       </spacer>
-      </item>
-      <item>
-       <widget class="QWidget" name="Panel2" native="true">
-        <property name="enabled">
-         <bool>true</bool>
-        </property>
-        <property name="toolTip">
-         <string/>
-        </property>
-        <layout class="QHBoxLayout" name="horizontalLayout_2">
-         <property name="leftMargin">
-          <number>0</number>
-         </property>
-         <property name="topMargin">
-          <number>0</number>
-         </property>
-         <property name="rightMargin">
-          <number>0</number>
-         </property>
-         <property name="bottomMargin">
-          <number>0</number>
-         </property>
-         <item>
-          <widget class="QPushButton" name="BtnClose">
-           <property name="enabled">
-            <bool>true</bool>
-           </property>
-           <property name="toolTip">
-            <string/>
-           </property>
-           <property name="text">
-            <string>&amp;Close</string>
-           </property>
-          </widget>
-         </item>
-        </layout>
-       </widget>
-      </item>
-     </layout>
-    </widget>
-   </item>
-   <item>
-    <widget class="QTableWidget" name="Console"/>
-   </item>
-  </layout>
- </widget>
- <resources>
-  <include location="../rtkvplayer_qt/rtkvplayer_qt.qrc"/>
- </resources>
- <connections/>
-</ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/strsvr.cpp RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/strsvr.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/strsvr.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/strsvr.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -5,7 +5,6 @@
 {
     QApplication a(argc, argv);
     MainForm w;
-
     w.show();
 
     return a.exec();
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/strsvr_qt.pro RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/strsvr_qt.pro
--- RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/strsvr_qt.pro	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/strsvr_qt.pro	2019-08-19 02:04:50.000000000 +0300
@@ -4,15 +4,40 @@
 #
 #-------------------------------------------------
 
-QT       += core gui widgets serialport
+QT       += core gui
+
+greaterThan(QT_MAJOR_VERSION, 4): QT += widgets serialport
+
+include(../../RTKLib.pri)
+
+lessThan(QT_MAJOR_VERSION, 5) {
+    LIBS += -lqextserialport-1.2
+    DEFINES += QEXTSERIALPORT
+}
 
-include(../app.pri)
 
 INCLUDEPATH += ../../src/ ../appcmn_qt
 
+linux{
+    RTKLIB =../../src/libRTKLib.a
+    LIBS += -lpng $${RTKLIB}
+}
+win32 {
+    CONFIG(debug) {
+        RTKLIB = ../../src/debug/libRTKLib.a
+    } else {
+        RTKLIB =../../src/release/libRTKLib.a
+    }
+
+    LIBS+= $${RTKLIB} -lWs2_32 -lwinmm
+}
+
+PRE_TARGETDEPS = $${RTKLIB}
+
 TARGET = strsvr_qt
 TEMPLATE = app
 
+
 SOURCES += \  
     convdlg.cpp \
     strsvr.cpp \
@@ -26,8 +51,7 @@
     ../appcmn_qt/fileoptdlg.cpp \
     ../appcmn_qt/ftpoptdlg.cpp \
     ../appcmn_qt/refdlg.cpp \
-    ../appcmn_qt/keydlg.cpp \
-    mondlg.cpp
+    ../appcmn_qt/keydlg.cpp
 
 HEADERS  += \ 
     convdlg.h \
@@ -41,8 +65,7 @@
     ../appcmn_qt/fileoptdlg.h \
     ../appcmn_qt/ftpoptdlg.h \
     ../appcmn_qt/refdlg.h \
-    ../appcmn_qt/keydlg.h \
-    mondlg.h
+    ../appcmn_qt/keydlg.h
 
 FORMS    += \ 
     convdlg.ui \
@@ -56,8 +79,7 @@
     ../appcmn_qt/fileoptdlg.ui \
     ../appcmn_qt/ftpoptdlg.ui \
     ../appcmn_qt/refdlg.ui \
-    ../appcmn_qt/keydlg.ui \
-    mondlg.ui
+    ../appcmn_qt/keydlg.ui
 
 RESOURCES +=  \
     strsvr_qt.qrc
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/strsvr_qt.qrc RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/strsvr_qt.qrc
--- RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/strsvr_qt.qrc	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/strsvr_qt.qrc	2019-08-19 02:04:50.000000000 +0300
@@ -90,9 +90,5 @@
         <file alias="wait6.bmp">../icon/wait6.bmp</file>
         <file alias="wait7.bmp">../icon/wait7.bmp</file>
         <file alias="wait8.bmp">../icon/wait8.bmp</file>
-        <file alias="start.bmp">../icon/start.bmp</file>
-        <file alias="up2.bmp">../icon/up2.bmp</file>
-        <file alias="stop2.bmp">../icon/stop2.bmp</file>
-        <file alias="anim1_red.bmp">../icon/anim1_red.bmp</file>
     </qresource>
 </RCC>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/svrmain.cpp RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/svrmain.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/svrmain.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/svrmain.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -19,8 +19,6 @@
 //                       add stream conversion function
 //                       add option -auto and -tray
 //---------------------------------------------------------------------------
-#include <clocale>
-
 #include <QTimer>
 #include <QCommandLineParser>
 #include <QFileInfo>
@@ -28,7 +26,6 @@
 #include <QMessageBox>
 #include <QSettings>
 #include <QMenu>
-#include <QStringList>
 
 #include "rtklib.h"
 #include "svroptdlg.h"
@@ -40,9 +37,8 @@
 #include "convdlg.h"
 #include "aboutdlg.h"
 #include "refdlg.h"
-#include "mondlg.h"
+#include "console.h"
 #include "svrmain.h"
-#include "mondlg.h"
 
 //---------------------------------------------------------------------------
 
@@ -51,15 +47,9 @@
 #define CLORANGE    QColor(0x00,0xAA,0xFF)
 
 #define MIN(x,y)    ((x)<(y)?(x):(y))
-#define MAX(x,y)    ((x)>(y)?(x):(y))
 
 strsvr_t strsvr;
 
-extern "C" {
-extern int showmsg(const char *, ...)  {return 0;}
-extern void settime(gtime_t) {}
-extern void settspan(gtime_t, gtime_t) {}
-}
 
 QString color2String(const QColor &c){
     return QString("rgb(%1,%2,%3)").arg(c.red()).arg(c.green()).arg(c.blue());
@@ -84,19 +74,19 @@
     setupUi(this);
 
     QCoreApplication::setApplicationName(PRGNAME);
-    QCoreApplication::setApplicationVersion(QString(VER_RTKLIB) + " " + PATCH_LEVEL);
+    QCoreApplication::setApplicationVersion(QString(VER_RTKLIB)+ " "+ PATCH_LEVEL);
 
     setWindowIcon(QIcon(":/icons/rtk6.bmp"));
 
-    setlocale(LC_NUMERIC, "C"); // use point as decimal separator in formatted output
+    setlocale(LC_NUMERIC,"C"); // use point as decimal separator in formated output
 
-    QString file = QApplication::applicationFilePath();
+    QString file=QApplication::applicationFilePath();
     QFileInfo fi(file);
-    IniFile = fi.absolutePath() + "/" + fi.baseName() + ".ini";
+    IniFile=fi.absolutePath()+"/"+fi.baseName()+".ini";
 
     TrayIcon = new QSystemTrayIcon(QIcon(":/icons/strsvr_Icon"));
 
-    QMenu *trayMenu = new QMenu(this);
+    QMenu *trayMenu= new QMenu(this);
     trayMenu->addAction(MenuExpand);
     trayMenu->addSeparator();
     trayMenu->addAction(MenuStart);
@@ -107,110 +97,106 @@
     TrayIcon->setContextMenu(trayMenu);
 
     svrOptDialog = new SvrOptDialog(this);
-    tcpOptDialog = new TcpOptDialog(this);
-    serialOptDialog = new SerialOptDialog(this);
-    fileOptDialog = new FileOptDialog(this);
-    ftpOptDialog = new FtpOptDialog(this);
-    strMonDialog = new StrMonDialog(this);
-
-    BtnStop->setVisible(false);
+    console = new Console(this);
+    tcpOptDialog= new TcpOptDialog(this);
+    serialOptDialog= new SerialOptDialog(this);
+    fileOptDialog= new FileOptDialog(this);
+    ftpOptDialog= new FtpOptDialog(this);
 
-    StartTime.sec = StartTime.time = EndTime.sec = EndTime.time = 0;
+    StartTime.sec=StartTime.time=EndTime.sec=EndTime.time=0;
 
-    connect(BtnExit, SIGNAL(clicked(bool)), this, SLOT(BtnExitClick()));
-    connect(BtnInput, SIGNAL(clicked(bool)), this, SLOT(BtnInputClick()));
-    connect(BtnStart, SIGNAL(clicked(bool)), this, SLOT(BtnStartClick()));
-    connect(BtnStop, SIGNAL(clicked(bool)), this, SLOT(BtnStopClick()));
-    connect(BtnOpt, SIGNAL(clicked(bool)), this, SLOT(BtnOptClick()));
-    connect(BtnCmd, SIGNAL(clicked(bool)), this, SLOT(BtnCmdClick()));
-    connect(BtnCmd1, SIGNAL(clicked(bool)), this, SLOT(BtnCmdClick()));
-    connect(BtnCmd2, SIGNAL(clicked(bool)), this, SLOT(BtnCmdClick()));
-    connect(BtnCmd3, SIGNAL(clicked(bool)), this, SLOT(BtnCmdClick()));
-    connect(BtnAbout, SIGNAL(clicked(bool)), this, SLOT(BtnAboutClick()));
-    connect(BtnStrMon, SIGNAL(clicked(bool)), this, SLOT(BtnStrMonClick()));
-    connect(BtnOutput1, SIGNAL(clicked(bool)), this, SLOT(BtnOutput1Click()));
-    connect(BtnOutput2, SIGNAL(clicked(bool)), this, SLOT(BtnOutput2Click()));
-    connect(BtnOutput3, SIGNAL(clicked(bool)), this, SLOT(BtnOutput3Click()));
-    connect(BtnTaskIcon, SIGNAL(clicked(bool)), this, SLOT(BtnTaskIconClick()));
-    connect(MenuStart, SIGNAL(triggered(bool)), this, SLOT(MenuStartClick()));
-    connect(MenuStop, SIGNAL(triggered(bool)), this, SLOT(MenuStopClick()));
-    connect(MenuExit, SIGNAL(triggered(bool)), this, SLOT(MenuExitClick()));
-    connect(MenuExpand, SIGNAL(triggered(bool)), this, SLOT(MenuExpandClick()));
-    connect(Output1, SIGNAL(currentIndexChanged(int)), this, SLOT(Output1Change()));
-    connect(Output2, SIGNAL(currentIndexChanged(int)), this, SLOT(Output2Change()));
-    connect(Output3, SIGNAL(currentIndexChanged(int)), this, SLOT(Output3Change()));
-    connect(BtnConv1, SIGNAL(clicked(bool)), this, SLOT(BtnConv1Click()));
-    connect(BtnConv2, SIGNAL(clicked(bool)), this, SLOT(BtnConv2Click()));
-    connect(BtnConv3, SIGNAL(clicked(bool)), this, SLOT(BtnConv3Click()));
-    connect(&Timer1, SIGNAL(timeout()), this, SLOT(Timer1Timer()));
-    connect(&Timer2, SIGNAL(timeout()), this, SLOT(Timer2Timer()));
-    connect(TrayIcon, SIGNAL(activated(QSystemTrayIcon::ActivationReason)), this, SLOT(TrayIconActivated(QSystemTrayIcon::ActivationReason)));
-    connect(Input, SIGNAL(currentIndexChanged(int)), this, SLOT(InputChange()));
+    connect(BtnExit,SIGNAL(clicked(bool)),this,SLOT(BtnExitClick()));
+    connect(BtnInput,SIGNAL(clicked(bool)),this,SLOT(BtnInputClick()));
+    connect(BtnStart,SIGNAL(clicked(bool)),this,SLOT(BtnStartClick()));
+    connect(BtnStop,SIGNAL(clicked(bool)),this,SLOT(BtnStopClick()));
+    connect(BtnOpt,SIGNAL(clicked(bool)),this,SLOT(BtnOptClick()));
+    connect(BtnCmd,SIGNAL(clicked(bool)),this,SLOT(BtnCmdClick()));
+    connect(BtnAbout,SIGNAL(clicked(bool)),this,SLOT(BtnAboutClick()));
+    connect(BtnStrMon,SIGNAL(clicked(bool)),this,SLOT(BtnStrMonClick()));
+    connect(BtnOutput1,SIGNAL(clicked(bool)),this,SLOT(BtnOutput1Click()));
+    connect(BtnOutput2,SIGNAL(clicked(bool)),this,SLOT(BtnOutput2Click()));
+    connect(BtnOutput3,SIGNAL(clicked(bool)),this,SLOT(BtnOutput3Click()));
+    connect(BtnTaskIcon,SIGNAL(clicked(bool)),this,SLOT(BtnTaskIconClick()));
+    connect(MenuStart,SIGNAL(triggered(bool)),this,SLOT(MenuStartClick()));
+    connect(MenuStop,SIGNAL(triggered(bool)),this,SLOT(MenuStopClick()));
+    connect(MenuExit,SIGNAL(triggered(bool)),this,SLOT(MenuExitClick()));
+    connect(MenuExpand,SIGNAL(triggered(bool)),this,SLOT(MenuExpandClick()));
+    connect(Output1,SIGNAL(currentIndexChanged(int)),this,SLOT(Output1Change()));
+    connect(Output2,SIGNAL(currentIndexChanged(int)),this,SLOT(Output2Change()));
+    connect(Output3,SIGNAL(currentIndexChanged(int)),this,SLOT(Output3Change()));
+    connect(BtnConv1,SIGNAL(clicked(bool)),this,SLOT(BtnConv1Click()));
+    connect(BtnConv2,SIGNAL(clicked(bool)),this,SLOT(BtnConv2Click()));
+    connect(BtnConv3,SIGNAL(clicked(bool)),this,SLOT(BtnConv3Click()));
+    connect(&Timer1,SIGNAL(timeout()),this,SLOT(Timer1Timer()));
+    connect(&Timer2,SIGNAL(timeout()),this,SLOT(Timer2Timer()));
+    connect(TrayIcon,SIGNAL(activated(QSystemTrayIcon::ActivationReason)),this,SLOT(TrayIconActivated(QSystemTrayIcon::ActivationReason)));
+    connect(Input,SIGNAL(currentIndexChanged(int)),this,SLOT(InputChange()));
 
     Timer1.setInterval(50);
     Timer2.setInterval(100);
 
-    QTimer::singleShot(100, this, SLOT(FormCreate()));
+    QTimer::singleShot(100,this,SLOT(FormCreate()));
 }
 // callback on form create --------------------------------------------------
 void MainForm::FormCreate()
 {
-    int autorun = 0, tasktray = 0;
-
-    strsvrinit(&strsvr, 3);
-
+    int autorun=0,tasktray=0;
+    
+    strsvrinit(&strsvr,3);
+    
     setWindowTitle(QString("%1 ver.%2 %3").arg(PRGNAME).arg(VER_RTKLIB).arg(PATCH_LEVEL));
-
+    
 
     QCommandLineParser parser;
-    parser.setApplicationDescription(tr("stream server qt"));
+    parser.setApplicationDescription("stream server");
     parser.addHelpOption();
     parser.addVersionOption();
     parser.addPositionalArgument("source", QCoreApplication::translate("main", "Source file to copy."));
     parser.addPositionalArgument("destination", QCoreApplication::translate("main", "Destination directory."));
 
-    // A boolean option with a single name (-p)
-    QCommandLineOption showProgressOption("p", QCoreApplication::translate("main", "Show progress during copy"));
-    parser.addOption(showProgressOption);
+     // A boolean option with a single name (-p)
+     QCommandLineOption showProgressOption("p", QCoreApplication::translate("main", "Show progress during copy"));
+     parser.addOption(showProgressOption);
 
     QCommandLineOption trayOption(QStringList() << "tray",
-                      QCoreApplication::translate("main", "start as task tray icon."));
+            QCoreApplication::translate("main", "start as task tray icon."));
     parser.addOption(trayOption);
 
     QCommandLineOption autoOption(QStringList() << "auto",
-                      QCoreApplication::translate("main", "auto start."));
+            QCoreApplication::translate("main", "auto start."));
     parser.addOption(autoOption);
 
     QCommandLineOption windowTitleOption(QStringList() << "t",
-                         QCoreApplication::translate("main", "window title."),
-                         QCoreApplication::translate("main", "title"));
+            QCoreApplication::translate("main", "window title."),
+            QCoreApplication::translate("main", "title"));
     parser.addOption(windowTitleOption);
 
     QCommandLineOption iniFileOption(QStringList() << "i",
-                     QCoreApplication::translate("main", "ini file path."),
-                     QCoreApplication::translate("main", "file"));
+            QCoreApplication::translate("main", "ini file path."),
+            QCoreApplication::translate("main", "file"));
     parser.addOption(iniFileOption);
 
     parser.process(*QApplication::instance());
 
     if (parser.isSet(iniFileOption))
-        IniFile = parser.value(iniFileOption);
+        IniFile=parser.value(iniFileOption);
 
     LoadOpt();
-
+    
     if (parser.isSet(windowTitleOption))
         setWindowTitle(parser.value(windowTitleOption));
-    if (parser.isSet(autoOption)) autorun = 1;
-    if (parser.isSet(trayOption)) tasktray = 1;
+    if (parser.isSet(autoOption)) autorun=1;
+    if (parser.isSet(trayOption)) tasktray=1;
 
     SetTrayIcon(0);
-
+    
     if (tasktray) {
         setVisible(false);
         TrayIcon->setVisible(true);
     }
-    if (autorun)
+    if (autorun) {
         SvrStart();
+    }
     Timer1.start();
     Timer2.start();
 }
@@ -237,99 +223,85 @@
 // callback on button-options -----------------------------------------------
 void MainForm::BtnOptClick()
 {
-    for (int i = 0; i < 6; i++) svrOptDialog->SvrOpt[i] = SvrOpt[i];
-    for (int i = 0; i < 3; i++) svrOptDialog->AntPos[i] = AntPos[i];
-    for (int i = 0; i < 3; i++) svrOptDialog->AntOff[i] = AntOff[i];
-    svrOptDialog->TraceLevel = TraceLevel;
-    svrOptDialog->NmeaReq = NmeaReq;
-    svrOptDialog->FileSwapMargin = FileSwapMargin;
-    svrOptDialog->RelayBack = RelayBack;
-    svrOptDialog->ProgBarRange = ProgBarRange;
-    svrOptDialog->StaPosFile = StaPosFile;
-    svrOptDialog->ExeDirectory = ExeDirectory;
-    svrOptDialog->LocalDirectory = LocalDirectory;
-    svrOptDialog->ProxyAddress = ProxyAddress;
-    svrOptDialog->StaId = StaId;
-    svrOptDialog->StaSel = StaSel;
-    svrOptDialog->AntType = AntType;
-    svrOptDialog->RcvType = RcvType;
-    svrOptDialog->SrcTblFile = SrcTblFile;
-    svrOptDialog->LogFile = LogFile;
 
+    for (int i=0;i<6;i++) svrOptDialog->SvrOpt[i]=SvrOpt[i];
+    for (int i=0;i<3;i++) svrOptDialog->AntPos[i]=AntPos[i];
+    for (int i=0;i<3;i++) svrOptDialog->AntOff[i]=AntOff[i];
+    svrOptDialog->TraceLevel=TraceLevel;
+    svrOptDialog->NmeaReq=NmeaReq;
+    svrOptDialog->FileSwapMargin=FileSwapMargin;
+    svrOptDialog->StaPosFile=StaPosFile;
+    svrOptDialog->ExeDirectory=ExeDirectory;
+    svrOptDialog->LocalDirectory=LocalDirectory;
+    svrOptDialog->ProxyAddress=ProxyAddress;
+    svrOptDialog->StaId=StaId;
+    svrOptDialog->StaSel=StaSel;
+    svrOptDialog->AntType=AntType;
+    svrOptDialog->RcvType=RcvType;
+    
     svrOptDialog->exec();
-    if (svrOptDialog->result() != QDialog::Accepted) return;
-
-    for (int i = 0; i < 6; i++) SvrOpt[i] = svrOptDialog->SvrOpt[i];
-    for (int i = 0; i < 3; i++) AntPos[i] = svrOptDialog->AntPos[i];
-    for (int i = 0; i < 3; i++) AntOff[i] = svrOptDialog->AntOff[i];
-    TraceLevel = svrOptDialog->TraceLevel;
-    NmeaReq = svrOptDialog->NmeaReq;
-    FileSwapMargin = svrOptDialog->FileSwapMargin;
-    RelayBack = svrOptDialog->RelayBack;
-    ProgBarRange = svrOptDialog->ProgBarRange;
-    StaPosFile = svrOptDialog->StaPosFile;
-    ExeDirectory = svrOptDialog->ExeDirectory;
-    LocalDirectory = svrOptDialog->LocalDirectory;
-    ProxyAddress = svrOptDialog->ProxyAddress;
-    StaId = svrOptDialog->StaId;
-    StaSel = svrOptDialog->StaSel;
-    AntType = svrOptDialog->AntType;
-    RcvType = svrOptDialog->RcvType;
-    SrcTblFile = svrOptDialog->SrcTblFile;
-    LogFile = svrOptDialog->LogFile;
+    if (svrOptDialog->result()!=QDialog::Accepted) return;
+    
+    for (int i=0;i<6;i++) SvrOpt[i]=svrOptDialog->SvrOpt[i];
+    for (int i=0;i<3;i++) AntPos[i]=svrOptDialog->AntPos[i];
+    for (int i=0;i<3;i++) AntOff[i]=svrOptDialog->AntOff[i];
+    TraceLevel=svrOptDialog->TraceLevel;
+    NmeaReq=svrOptDialog->NmeaReq;
+    FileSwapMargin=svrOptDialog->FileSwapMargin;
+    StaPosFile=svrOptDialog->StaPosFile;
+    ExeDirectory=svrOptDialog->ExeDirectory;
+    LocalDirectory=svrOptDialog->LocalDirectory;
+    ProxyAddress=svrOptDialog->ProxyAddress;
+    StaId=svrOptDialog->StaId;
+    StaSel=svrOptDialog->StaSel;
+    AntType=svrOptDialog->AntType;
+    RcvType=svrOptDialog->RcvType;
 }
 // callback on button-input-opt ---------------------------------------------
 void MainForm::BtnInputClick()
 {
     switch (Input->currentIndex()) {
-        case 0: SerialOpt(0, 0); break;
-        case 1: TcpOpt(0, 1); break; // TCP Client
-        case 2: TcpOpt(0, 0); break; // TCP Server
-        case 3: TcpOpt(0, 3); break; // Ntrip Client
-        case 4: TcpOpt(0, 5); break;  // Ntrip Caster Server
-        case 5: TcpOpt(0, 6); break;  // UDP Server
-        case 6: FileOpt(0, 0); break;
-        case 7: FtpOpt(0, 0); break; // FTP
-        case 8: FtpOpt(0, 1); break; // HTTP
+        case 0: SerialOpt(0,0); break;
+        case 1: TcpOpt(0,1); break;
+        case 2: TcpOpt(0,0); break;
+        case 3: TcpOpt(0,3); break;
+        case 4: FileOpt(0,0); break;
+        case 5: FtpOpt(0,0); break;
+        case 6: FtpOpt(0,1); break;
     }
 }
 // callback on button-input-cmd ---------------------------------------------
 void MainForm::BtnCmdClick()
 {
-    CmdOptDialog *cmdOptDialog = new CmdOptDialog(this);
-
-
-    QPushButton *btn[] = { BtnCmd, BtnCmd1, BtnCmd2, BtnCmd3 };
-    QComboBox *type[] = { Input, Output1, Output2, Output3 };
-    int i, j;
-
-    for (i = 0; i < MAXSTR; i++)
-        if (btn[i] == qobject_cast<QPushButton *>(sender())) break;
-    if (i >= MAXSTR) return;
+    CmdOptDialog *cmdOptDialog= new CmdOptDialog(this);
 
-    for (j = 0; j < 3; j++) {
-        if (type[i]->currentText() == tr("Serial")) {
-            cmdOptDialog->Cmds[j] = Cmds[i][j];
-            cmdOptDialog->CmdEna[j] = CmdEna[i][j];
-        }
-        else {
-            cmdOptDialog->Cmds[j] = CmdsTcp[i][j];
-            cmdOptDialog->CmdEna[j] = CmdEnaTcp[i][j];
-        }
+    if (Input->currentIndex()==0) {
+        cmdOptDialog->Cmds[0]=Cmds[0];
+        cmdOptDialog->Cmds[1]=Cmds[1];
+        cmdOptDialog->CmdEna[0]=CmdEna[0];
+        cmdOptDialog->CmdEna[1]=CmdEna[1];
+    }
+    else {
+        cmdOptDialog->Cmds[0]=CmdsTcp[0];
+        cmdOptDialog->Cmds[1]=CmdsTcp[1];
+        cmdOptDialog->CmdEna[0]=CmdEnaTcp[0];
+        cmdOptDialog->CmdEna[1]=CmdEnaTcp[1];
     }
 
     cmdOptDialog->exec();
-    if (cmdOptDialog->result() != QDialog::Accepted) return;
 
-    for (j=0;j<3;j++) {
-        if (type[i]->currentText() == tr("Serial")) {
-            Cmds[i][j] = cmdOptDialog->Cmds[j];
-            CmdEna[i][j] = cmdOptDialog->CmdEna[j];
-        }
-        else {
-            CmdsTcp[i][j] = cmdOptDialog->Cmds[j];
-            CmdEnaTcp[i][j] = cmdOptDialog->CmdEna[j];
-        }
+    if (cmdOptDialog->result()!=QDialog::Accepted) return;
+    if (Input->currentIndex()==0) {
+        Cmds[0]  =cmdOptDialog->Cmds[0];
+        Cmds[1]  =cmdOptDialog->Cmds[1];
+        CmdEna[0]=cmdOptDialog->CmdEna[0];
+        CmdEna[1]=cmdOptDialog->CmdEna[1];
+    }
+    else {
+        CmdsTcp[0]  =cmdOptDialog->Cmds[0];
+        CmdsTcp[1]  =cmdOptDialog->Cmds[1];
+        CmdEnaTcp[0]=cmdOptDialog->CmdEna[0];
+        CmdEnaTcp[1]=cmdOptDialog->CmdEna[1];
     }
 
     delete cmdOptDialog;
@@ -339,113 +311,107 @@
 {
     switch (Output1->currentIndex()) {
         case 1: SerialOpt(1,0); break;
-        case 2: TcpOpt(1,1); break; // TCP Client
-        case 3: TcpOpt(1,0); break; // TCP Server
-        case 4: TcpOpt(1,2); break; // NTRIP Server
-        case 5: TcpOpt(1,4); break; // NTRIP Caster Client
-        case 6: TcpOpt(1,7); break; // UDP Client
-        case 7: FileOpt(1,1); break;
+        case 2: TcpOpt(1,1); break;
+        case 3: TcpOpt(1,0); break;
+        case 4: TcpOpt(1,2); break;
+        case 5: FileOpt(1,1); break;
     }
 }
 // callback on button-output2-opt -------------------------------------------
 void MainForm::BtnOutput2Click()
 {
     switch (Output2->currentIndex()) {
-        case 1: SerialOpt(1,0); break;
-        case 2: TcpOpt(1,1); break; // TCP Client
-        case 3: TcpOpt(1,0); break; // TCP Server
-        case 4: TcpOpt(1,2); break; // NTRIP Server
-        case 5: TcpOpt(1,4); break; // NTRIP Caster Client
-        case 6: TcpOpt(1,7); break; // UDP Client
-        case 7: FileOpt(1,1); break;
+        case 1: SerialOpt(2,0); break;
+        case 2: TcpOpt(2,1); break;
+        case 3: TcpOpt(2,0); break;
+        case 4: TcpOpt(2,2); break;
+        case 5: FileOpt(2,1); break;
     }
 }
 // callback on button-output3-opt -------------------------------------------
 void MainForm::BtnOutput3Click()
 {
     switch (Output3->currentIndex()) {
-        case 1: SerialOpt(1,0); break;
-        case 2: TcpOpt(1,1); break; // TCP Client
-        case 3: TcpOpt(1,0); break; // TCP Server
-        case 4: TcpOpt(1,2); break; // NTRIP Server
-        case 5: TcpOpt(1,4); break; // NTRIP Caster Client
-        case 6: TcpOpt(1,7); break; // UDP Client
-        case 7: FileOpt(1,1); break;
+        case 1: SerialOpt(3,0); break;
+        case 2: TcpOpt(3,1); break;
+        case 3: TcpOpt(3,0); break;
+        case 4: TcpOpt(3,2); break;
+        case 5: FileOpt(3,1); break; 
     }
 }
 // callback on button-output1-conv ------------------------------------------
 void MainForm::BtnConv1Click()
 {
-    ConvDialog *convDialog = new ConvDialog(this);
+    ConvDialog *convDialog=new ConvDialog(this);
 
-    convDialog->ConvEna = ConvEna[0];
-    convDialog->ConvInp = ConvInp[0];
-    convDialog->ConvOut = ConvOut[0];
-    convDialog->ConvMsg = ConvMsg[0];
-    convDialog->ConvOpt = ConvOpt[0];
+    convDialog->ConvEna=ConvEna[0];
+    convDialog->ConvInp=ConvInp[0];
+    convDialog->ConvOut=ConvOut[0];
+    convDialog->ConvMsg=ConvMsg[0];
+    convDialog->ConvOpt=ConvOpt[0];
 
     convDialog->exec();
-    if (convDialog->result() != QDialog::Accepted) return;
+    if (convDialog->result()!=QDialog::Accepted) return;
 
-    ConvEna[0] = convDialog->ConvEna;
-    ConvInp[0] = convDialog->ConvInp;
-    ConvOut[0] = convDialog->ConvOut;
-    ConvMsg[0] = convDialog->ConvMsg;
-    ConvOpt[0] = convDialog->ConvOpt;
+    ConvEna[0]=convDialog->ConvEna;
+    ConvInp[0]=convDialog->ConvInp;
+    ConvOut[0]=convDialog->ConvOut;
+    ConvMsg[0]=convDialog->ConvMsg;
+    ConvOpt[0]=convDialog->ConvOpt;
 
     delete convDialog;
 }
 // callback on button-output2-conv ------------------------------------------
 void MainForm::BtnConv2Click()
 {
-    ConvDialog *convDialog = new ConvDialog(this);
+    ConvDialog *convDialog=new ConvDialog(this);
 
-    convDialog->ConvEna = ConvEna[1];
-    convDialog->ConvInp = ConvInp[1];
-    convDialog->ConvOut = ConvOut[1];
-    convDialog->ConvMsg = ConvMsg[1];
-    convDialog->ConvOpt = ConvOpt[1];
+    convDialog->ConvEna=ConvEna[1];
+    convDialog->ConvInp=ConvInp[1];
+    convDialog->ConvOut=ConvOut[1];
+    convDialog->ConvMsg=ConvMsg[1];
+    convDialog->ConvOpt=ConvOpt[1];
 
     convDialog->exec();
-    if (convDialog->result() != QDialog::Accepted) return;
+    if (convDialog->result()!=QDialog::Accepted) return;
 
-    ConvEna[1] = convDialog->ConvEna;
-    ConvInp[1] = convDialog->ConvInp;
-    ConvOut[1] = convDialog->ConvOut;
-    ConvMsg[1] = convDialog->ConvMsg;
-    ConvOpt[1] = convDialog->ConvOpt;
+    ConvEna[1]=convDialog->ConvEna;
+    ConvInp[1]=convDialog->ConvInp;
+    ConvOut[1]=convDialog->ConvOut;
+    ConvMsg[1]=convDialog->ConvMsg;
+    ConvOpt[1]=convDialog->ConvOpt;
 
     delete convDialog;
 }
 // callback on button-output3-conv ------------------------------------------
 void MainForm::BtnConv3Click()
 {
-    ConvDialog *convDialog = new ConvDialog(this);
+    ConvDialog *convDialog=new ConvDialog(this);
 
-    convDialog->ConvEna = ConvEna[2];
-    convDialog->ConvInp = ConvInp[2];
-    convDialog->ConvOut = ConvOut[2];
-    convDialog->ConvMsg = ConvMsg[2];
-    convDialog->ConvOpt = ConvOpt[2];
+    convDialog->ConvEna=ConvEna[2];
+    convDialog->ConvInp=ConvInp[2];
+    convDialog->ConvOut=ConvOut[2];
+    convDialog->ConvMsg=ConvMsg[2];
+    convDialog->ConvOpt=ConvOpt[2];
 
     convDialog->exec();
-    if (convDialog->result() != QDialog::Accepted) return;
+    if (convDialog->result()!=QDialog::Accepted) return;
 
-    ConvEna[2] = convDialog->ConvEna;
-    ConvInp[2] = convDialog->ConvInp;
-    ConvOut[2] = convDialog->ConvOut;
-    ConvMsg[2] = convDialog->ConvMsg;
-    ConvOpt[2] = convDialog->ConvOpt;
+    ConvEna[2]=convDialog->ConvEna;
+    ConvInp[2]=convDialog->ConvInp;
+    ConvOut[2]=convDialog->ConvOut;
+    ConvMsg[2]=convDialog->ConvMsg;
+    ConvOpt[2]=convDialog->ConvOpt;
 
     delete convDialog;
 }
 // callback on buttn-about --------------------------------------------------
 void MainForm::BtnAboutClick()
 {
-    AboutDialog *aboutDialog = new AboutDialog(this);
+    AboutDialog *aboutDialog=new AboutDialog(this);
 
-    aboutDialog->About = PRGNAME;
-    aboutDialog->IconIndex = 6;
+    aboutDialog->About=PRGNAME;
+    aboutDialog->IconIndex=6;
     aboutDialog->exec();
 
     delete aboutDialog;
@@ -459,7 +425,7 @@
 // callback on task-icon double-click ---------------------------------------
 void MainForm::TrayIconActivated(QSystemTrayIcon::ActivationReason reason)
 {
-    if (reason != QSystemTrayIcon::DoubleClick) return;
+    if (reason!=QSystemTrayIcon::DoubleClick) return;
 
     setVisible(true);
     TrayIcon->setVisible(false);
@@ -488,7 +454,8 @@
 // callback on stream-monitor -----------------------------------------------
 void MainForm::BtnStrMonClick()
 {
-    strMonDialog->show();
+    console->setWindowTitle("Input Monitor");
+    console->show();
 }
 // callback on input type change --------------------------------------------
 void MainForm::InputChange()
@@ -498,7 +465,7 @@
 // callback on output1 type change ------------------------------------------
 void MainForm::Output1Change()
 {
-    UpdateEnable();
+    UpdateEnable(); 
 }
 // callback on output2 type change ------------------------------------------
 void MainForm::Output2Change()
@@ -513,453 +480,374 @@
 // callback on interval timer -----------------------------------------------
 void MainForm::Timer1Timer()
 {
-    QColor color[] = { Qt::red, Qt::white, CLORANGE, Qt::green, QColor(0x00, 0xff, 0x00), QColor(0xff, 0xff, 0x00) };
-    QLabel *e0[] = { IndInput, IndOutput1, IndOutput2, IndOutput3 };
-    QLabel *e1[] = { InputByte, Output1Byte, Output2Byte, Output3Byte };
-    QLabel *e2[] = { InputBps, Output1Bps, Output2Bps, Output3Bps };
-    gtime_t time = utc2gpst(timeget());
-    int stat[MAXSTR] = { 0 }, byte[MAXSTR] = { 0 }, bps[MAXSTR] = { 0 };
-    char msg[MAXSTRMSG * MAXSTR] = "", s1[256], s2[256];
-    double ctime, t[4], pos;
-
-    strsvrstat(&strsvr, stat, byte, bps, msg);
-    for (int i = 0; i < MAXSTR; i++) {
-        num2cnum(byte[i], s1);
-        num2cnum(bps[i], s2);
-        e0[i]->setStyleSheet(QString("background-color: %1").arg(color2String(color[stat[i] + 1])));
+    QColor color[]={Qt::red,Qt::gray,CLORANGE,Qt::green,QColor(0x00,0xff,0x00)};
+    QLabel *e0[]={IndInput,IndOutput1,IndOutput2,IndOutput3};
+    QLabel *e1[]={InputByte,Output1Byte,Output2Byte,Output3Byte};
+    QLabel *e2[]={InputBps,Output1Bps,Output2Bps,Output3Bps};
+    gtime_t time=utc2gpst(timeget());
+    int stat[4]={0},byte[4]={0},bps[4]={0};
+    char msg[MAXSTRMSG*4]="",s1[256],s2[256];
+    double ctime,t[4];
+    
+    strsvrstat(&strsvr,stat,byte,bps,msg);
+    for (int i=0;i<4;i++) {
+        num2cnum(byte[i],s1);
+        num2cnum(bps[i],s2);
+        e0[i]->setStyleSheet(QString("background-color: %1").arg(color2String(color[stat[i]+1])));
         e1[i]->setText(s1);
         e2[i]->setText(s2);
     }
-    pos = fmod(byte[0] / 1e3 / MAX(ProgBarRange, 1), 1.0) * 110.0;
-    Progress->setValue(!stat[0] ? 0 : MIN((int)pos, 100));
-
-    time2str(time, s1, 0);
+    Progress->setValue(!stat[0]?0:MIN(100,(int)(fmod(byte[0]/500.0,110.0))));
+    
+    time2str(time,s1,0);
     Time->setText(QString(tr("%1 GPST")).arg(s1));
-
-    if (Panel1->isEnabled())
-        ctime = timediff(EndTime, StartTime);
-    else
-        ctime = timediff(time, StartTime);
-    ctime = floor(ctime);
-    t[0] = floor(ctime / 86400.0); ctime -= t[0] * 86400.0;
-    t[1] = floor(ctime / 3600.0); ctime -= t[1] * 3600.0;
-    t[2] = floor(ctime / 60.0); ctime -= t[2] * 60.0;
-    t[3] = ctime;
-    ConTime->setText(QString("%1d %2:%3:%4").arg(t[0], 0, 'f', 0).arg(t[1], 2, 'f', 0, QChar('0')).arg(t[2], 2, 'f', 0, QChar('0')).arg(t[3], 2, 'f', 2, QChar('0')));
-
-    num2cnum(byte[0], s1); num2cnum(bps[0], s2);
+    
+    if (Panel1->isEnabled()) {
+        ctime=timediff(EndTime,StartTime);
+    }
+    else {
+        ctime=timediff(time,StartTime);
+    }
+    ctime=floor(ctime);
+    t[0]=floor(ctime/86400.0); ctime-=t[0]*86400.0;
+    t[1]=floor(ctime/3600.0 ); ctime-=t[1]*3600.0;
+    t[2]=floor(ctime/60.0   ); ctime-=t[2]*60.0;
+    t[3]=ctime;
+    ConTime->setText(QString("%1d %2:%3:%4").arg(t[0],0,'f',0).arg(t[1],2,'f',0,QChar('0')).arg(t[2],2,'f',0,QChar('0')).arg(t[3],2,'f',2,QChar('0')));
+    
+    num2cnum(byte[0],s1); num2cnum(bps[0],s2);
     TrayIcon->setToolTip(QString(tr("%1 bytes %2 bps")).arg(s1).arg(s2));
-    SetTrayIcon(stat[0] <= 0 ? 0 : (stat[0] == 3 ? 2 : 1));
-
+    SetTrayIcon(stat[0]<=0?0:(stat[0]==3?2:1));
+    
     Message->setText(msg);
 }
 // start stream server ------------------------------------------------------
 void MainForm::SvrStart(void)
 {
     strconv_t *conv[3]={0};
-    static char str[MAXSTR][1024];
+    static char str[4][1024];
     int itype[]={
-        STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPCLI,STR_NTRIPC_S,STR_UDPSVR,
-        STR_FILE,STR_FTP,STR_HTTP
+        STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPCLI,STR_FILE,STR_FTP,STR_HTTP
     };
     int otype[]={
-        STR_NONE,STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPSVR,STR_NTRIPC_C,
-        STR_UDPCLI,STR_FILE
+        STR_NONE,STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPSVR,STR_FILE
     };
-    int ip[]={0,1,1,1,1,1,2,3,3},strs[4]={0},opt[8]={0};
-    char *paths[MAXSTR],*cmds[MAXSTR]={0},*cmds_periodic[MAXSTR]={0};
-    char filepath[1024];
-    char *p;
-
+    int ip[]={0,1,1,1,2,3,3},strs[4]={0},opt[7]={0},n;
+    char *paths[4],filepath[1024],buff[1024];
+    char cmd[1024];
+    char *ant[3]={0},*rcv[3]={0},*p;
+    FILE *fp;
+    
     if (TraceLevel>0) {
-        traceopen(!LogFile.isEmpty()?qPrintable(LogFile):TRACEFILE);
+        traceopen(TRACEFILE);
         tracelevel(TraceLevel);
     }
-    for (int i = 0; i < 4; i++) paths[i] = str[i];
-
-    strs[0] = itype[Input->currentIndex()];
-    strs[1] = otype[Output1->currentIndex()];
-    strs[2] = otype[Output2->currentIndex()];
-    strs[3] = otype[Output3->currentIndex()];
-
-    strcpy(paths[0], qPrintable(Paths[0][ip[Input->currentIndex()]]));
-    strcpy(paths[1], !Output1->currentIndex() ? "" : qPrintable(Paths[1][ip[Output1->currentIndex() - 1]]));
-    strcpy(paths[2], !Output2->currentIndex() ? "" : qPrintable(Paths[2][ip[Output2->currentIndex() - 1]]));
-    strcpy(paths[3], !Output3->currentIndex() ? "" : qPrintable(Paths[3][ip[Output3->currentIndex() - 1]]));
-
-    for (int i=0;i<MAXSTR;i++) {
-        cmds[i] = cmds_periodic[i] = NULL;
-        if (strs[i]==STR_SERIAL) {
-            cmds[i] = new char[1024];
-            cmds_periodic[i] = new char[1024];
-            if (CmdEna[i][0]) strncpy(cmds[i],qPrintable(Cmds[i][0]), 1024);
-            if (CmdEna[i][2]) strncpy(cmds_periodic[i], qPrintable(Cmds[i][2]), 1024);
-        }
-        else if (strs[i]==STR_TCPCLI||strs[i]==STR_NTRIPCLI) {
-            cmds[i] = new char[1024];
-            cmds_periodic[i] = new char[1024];
-            if (CmdEnaTcp[i][0]) strncpy(cmds[i], qPrintable(CmdsTcp[i][0]), 1024);
-            if (CmdEnaTcp[i][2]) strncpy(cmds_periodic[i], qPrintable(CmdsTcp[i][2]), 1024);
-        }
+    for (int i=0;i<4;i++) paths[i]=str[i];
+    
+    strs[0]=itype[Input->currentIndex()];
+    strs[1]=otype[Output1->currentIndex()];
+    strs[2]=otype[Output2->currentIndex()];
+    strs[3]=otype[Output3->currentIndex()];
+    
+    strcpy(paths[0],qPrintable(Paths[0][ip[Input->currentIndex()]]));
+    strcpy(paths[1],!Output1->currentIndex()?"":qPrintable(Paths[1][ip[Output1->currentIndex()-1]]));
+    strcpy(paths[2],!Output2->currentIndex()?"":qPrintable(Paths[2][ip[Output2->currentIndex()-1]]));
+    strcpy(paths[3],!Output3->currentIndex()?"":qPrintable(Paths[3][ip[Output3->currentIndex()-1]]));
+    
+    if (Input->currentIndex()==0) {
+        if (CmdEna[0]) strncpy(cmd,qPrintable(Cmds[0]),1024);
+    }
+    else if (Input->currentIndex()==1||Input->currentIndex()==3) {
+        if (CmdEnaTcp[0]) strncpy(cmd,qPrintable(CmdsTcp[0]),1024);
     }
     for (int i=0;i<5;i++) {
         opt[i]=SvrOpt[i];
     }
     opt[5]=NmeaReq?SvrOpt[5]:0;
     opt[6]=FileSwapMargin;
-    opt[7]=RelayBack;
-
-    for (int i=1;i<MAXSTR;i++) { // for each out stream
+    
+    for (int i=1;i<4;i++) {
         if (strs[i]!=STR_FILE) continue;
         strcpy(filepath,paths[i]);
         if (strstr(filepath,"::A")) continue;
         if ((p=strstr(filepath,"::"))) *p='\0';
-        if (!QFile::exists(filepath)) continue;
-        if (QMessageBox::question(this, tr("Overwrite"), tr("File %1 exists. \nDo you want to overwrite?").arg(filepath)) != QMessageBox::Yes) return;
+        if (!(fp=fopen(filepath,"r"))) continue;
+        fclose(fp);
+        if (QMessageBox::question(this,tr("Overwrite"),tr("File %1 exists. \nDo you want to overwrite?").arg(filepath))!=QMessageBox::Yes) return;
     }
     strsetdir(qPrintable(LocalDirectory));
     strsetproxy(qPrintable(ProxyAddress));
-
-    for (int i=0;i<MAXSTR-1;i++) { // for each out stream
-        if (Input->currentIndex() == 2||Input->currentIndex() == 4) continue;
+    
+    for (int i=0;i<3;i++) {
         if (!ConvEna[i]) continue;
-        if (!(conv[i] = strconvnew(ConvInp[i], ConvOut[i], qPrintable(ConvMsg[i]),
-                       StaId, StaSel, qPrintable(ConvOpt[i])))) continue;
-        QStringList tokens = AntType.split(',');
-        if (tokens.size() >= 3)
-        {
-            strcpy(conv[i]->out.sta.antdes, qPrintable(tokens.at(0)));
-            strcpy(conv[i]->out.sta.antsno, qPrintable(tokens.at(1)));
-            conv[i]->out.sta.antsetup = atoi(qPrintable(tokens.at(2)));
-        }
-        tokens = RcvType.split(',');
-        if (tokens.size() >= 3)
-        {
-            strcpy(conv[i]->out.sta.rectype, qPrintable(tokens.at(0)));
-            strcpy(conv[i]->out.sta.recver, qPrintable(tokens.at(1)));
-            strcpy(conv[i]->out.sta.recsno, qPrintable(tokens.at(2)));
-        }
+        if (!(conv[i]=strconvnew(ConvInp[i],ConvOut[i],qPrintable(ConvMsg[i]),
+                                 StaId,StaSel,qPrintable(ConvOpt[i])))) continue;
+        strcpy(buff,qPrintable(AntType));
+        for (p=strtok(buff,","),n=0;p&&n<3;p=strtok(NULL,",")) ant[n++]=p;
+        strcpy(conv[i]->out.sta.antdes,ant[0]);
+        strcpy(conv[i]->out.sta.antsno,ant[1]);
+        conv[i]->out.sta.antsetup=atoi(ant[2]);
+        strcpy(buff,qPrintable(RcvType));
+        for (p=strtok(buff,","),n=0;p&&n<3;p=strtok(NULL,",")) rcv[n++]=p;
+        strcpy(conv[i]->out.sta.rectype,rcv[0]);
+        strcpy(conv[i]->out.sta.recver ,rcv[1]);
+        strcpy(conv[i]->out.sta.recsno ,rcv[2]);
         matcpy(conv[i]->out.sta.pos,AntPos,3,1);
         matcpy(conv[i]->out.sta.del,AntOff,3,1);
     }
     // stream server start
-    if (!strsvrstart(&strsvr, opt, strs, paths, conv, cmds, cmds_periodic, AntPos)) {
-        return;
-    }
-    // set ntrip source table
-    strsvrsetsrctbl(&strsvr, qPrintable(SrcTblFile));
-
-    for (int i = 0; i < 4; i++) {
-        if (cmds[i]) delete[] cmds[i];
-        if (cmds_periodic[i]) delete[] cmds_periodic[i];
-    };
-
-    StartTime = utc2gpst(timeget());
-    Panel1->setEnabled(false);
-    BtnStart->setVisible(false);
-    BtnStop->setVisible(true);
-    BtnOpt->setEnabled(false);
-    BtnExit->setEnabled(false);
-    MenuStart->setEnabled(false);
-    MenuStop->setEnabled(true);
-    MenuExit->setEnabled(false);
+    if (!strsvrstart(&strsvr,opt,strs,paths,conv,cmd,AntPos)) return;
+    
+    StartTime=utc2gpst(timeget());
+    Panel1    ->setEnabled(false);
+    BtnStart  ->setVisible(false);
+    BtnStop   ->setVisible(true);
+    BtnOpt    ->setEnabled(false);
+    BtnExit   ->setEnabled(false);
+    MenuStart ->setEnabled(false);
+    MenuStop  ->setEnabled(true);
+    MenuExit  ->setEnabled(false);
     SetTrayIcon(1);
-
 }
 // stop stream server -------------------------------------------------------
 void MainForm::SvrStop(void)
 {
-    char *cmds[MAXSTR];
-    const int itype[] = {
-        STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPCLI,STR_NTRIPC_S,STR_FILE,
-        STR_FTP,STR_HTTP    };
-    const int otype[] = {
-        STR_NONE,STR_SERIAL,STR_TCPCLI,STR_TCPSVR,STR_NTRIPSVR,STR_NTRIPC_C,
-        STR_FILE
-    };
-    int strs[MAXSTR];
-
-    strs[0] = itype[Input->currentIndex()];
-    strs[1] = otype[Output1->currentIndex()];
-    strs[2] = otype[Output2->currentIndex()];
-    strs[3] = otype[Output3->currentIndex()];
-
-    for (int i = 0; i < MAXSTR; i++) {
-        cmds[i] = NULL;
-        if (strs[i] == STR_SERIAL) {
-            cmds[i] = new char[1024];
-            if (CmdEna[i][1]) strncpy(cmds[i], qPrintable(Cmds[i][1]), 1024);
-        } else if (strs[i] == STR_TCPCLI || strs[i] == STR_NTRIPCLI) {
-            cmds[i] = new char[1024];
-            if (CmdEnaTcp[i][1]) strncpy(cmds[i], qPrintable(CmdsTcp[i][1]), 1024);
-        }
+    char cmd[1024];
+    
+    if (Input->currentIndex()==0) {
+        if (CmdEna[1]) strncpy(cmd,qPrintable(Cmds[1]),1024);
     }
-    strsvrstop(&strsvr, cmds);
-
-    EndTime = utc2gpst(timeget());
-    Panel1->setEnabled(true);
-    BtnStart->setVisible(true);
-    BtnStop->setVisible(false);
-    BtnOpt->setEnabled(true);
-    BtnExit->setEnabled(true);
-    MenuStart->setEnabled(true);
-    MenuStop->setEnabled(false);
-    MenuExit->setEnabled(true);
+    else if (Input->currentIndex()==1||Input->currentIndex()==3) {
+        if (CmdEnaTcp[1]) strncpy(cmd,qPrintable(CmdsTcp[1]),1024);
+    }
+    strsvrstop(&strsvr,cmd);
+    
+    EndTime=utc2gpst(timeget());
+    Panel1    ->setEnabled(true);
+    BtnStart  ->setVisible(true);
+    BtnStop   ->setVisible(false);
+    BtnOpt    ->setEnabled(true);
+    BtnExit   ->setEnabled(true);
+    MenuStart ->setEnabled(true);
+    MenuStop  ->setEnabled(false);
+    MenuExit  ->setEnabled(true);
     SetTrayIcon(0);
-
-    for (int i = 0; i < MAXSTR - 1; i++) {
-        if (cmds[i]) delete[] cmds[i];
+    
+    for (int i=0;i<3;i++) {
         if (ConvEna[i]) strconvfree(strsvr.conv[i]);
     }
-    if (TraceLevel > 0) traceclose();
+    if (TraceLevel>0) traceclose();
 }
 // callback on interval timer for stream monitor ----------------------------
 void MainForm::Timer2Timer()
 {
-    const QString types[]={
-        tr("None"),tr("Serial"),tr("File"),tr("TCP Server"),tr("TCP Client"),tr("UDP"),tr("Ntrip Sever"),
-        tr("Ntrip Client"),tr("FTP"),tr("HTTP"),tr("Ntrip Cast S"),tr("Ntrip Cast C"),tr("UDP Sever"),
-        tr("UDP Client")
-    };
-    const QString modes[]={tr("-"),tr("R"),tr("W"),tr("R/W")};
-    const QString states[]={tr("ERR"),tr("-"),tr("WAIT"),tr("CONN")};
-    unsigned char *msg = 0;
-    char *p;
-    int i,len,inb,inr,outb,outr;
-
-    if (strMonDialog->StrFmt) {
-        lock(&strsvr.lock);
-        len = strsvr.npb;
-        if (len > 0 && (msg = (unsigned char *)malloc(len))) {
-            memcpy(msg, strsvr.pbuf, len);
-            strsvr.npb = 0;
-        }
-        unlock(&strsvr.lock);
-        if (len <= 0 || !msg) return;
-        strMonDialog->AddMsg(msg, len);
-        free(msg);
-    }
-    else {
-        if (!(msg = (unsigned char *)malloc(16000))) return;
-
-        for (i = 0, p = (char*)msg; i < MAXSTR; i++) {
-            p += sprintf(p, "[STREAM %d]\n", i);
-            strsum(strsvr.stream + i, &inb, &inr, &outb, &outr);
-            strstatx(strsvr.stream + i, p);
-            p += strlen(p);
-            if (inb > 0) {
-                p += sprintf(p,"  inb     = %d\n", inb);
-                p += sprintf(p,"  inr     = %d\n", inr);
-            }
-            if (outb > 0) {
-                p += sprintf(p,"  outb    = %d\n", outb);
-                p += sprintf(p,"  outr    = %d\n", outr);
-            }
-        }
-        strMonDialog->AddMsg(msg,strlen((char*)msg));
-
-        free(msg);
+    unsigned char *msg=0;
+    int len;
+    
+    lock(&strsvr.lock);
+    
+    len=strsvr.npb;
+    if (len>0&&(msg=(unsigned char *)malloc(len))) {
+        memcpy(msg,strsvr.pbuf,len);
+        strsvr.npb=0;
     }
+    unlock(&strsvr.lock);
+    
+    if (len<=0||!msg) return;
+    
+    console->AddMsg(msg,len);
+    
+    free(msg);
 }
 // set serial options -------------------------------------------------------
 void MainForm::SerialOpt(int index, int opt)
 {
-    serialOptDialog->Path = Paths[index][0];
-    serialOptDialog->Opt = opt;
+    serialOptDialog->Path=Paths[index][0];
+    serialOptDialog->Opt=opt;
 
     serialOptDialog->exec();
-    if (serialOptDialog->result() != QDialog::Accepted) return;
-    Paths[index][0] = serialOptDialog->Path;
+    if (serialOptDialog->result()!=QDialog::Accepted) return;
+    Paths[index][0]=serialOptDialog->Path;
 }
 // set tcp/ip options -------------------------------------------------------
 void MainForm::TcpOpt(int index, int opt)
 {
-    tcpOptDialog->Path = Paths[index][1];
-    tcpOptDialog->Opt = opt;
-    for (int i = 0; i < MAXHIST; i++) tcpOptDialog->History[i] = TcpHistory[i];
-    for (int i = 0; i < MAXHIST; i++) tcpOptDialog->MntpHist[i] = TcpMntpHist[i];
+    tcpOptDialog->Path=Paths[index][1];
+    tcpOptDialog->Opt=opt;
+    for (int i=0;i<MAXHIST;i++) tcpOptDialog->History[i]=TcpHistory[i];
+    for (int i=0;i<MAXHIST;i++) tcpOptDialog->MntpHist[i]=TcpMntpHist[i];
 
     tcpOptDialog->exec();
-    if (tcpOptDialog->result() != QDialog::Accepted) return;
+    if (tcpOptDialog->result()!=QDialog::Accepted) return;
+
+    Paths[index][1]=tcpOptDialog->Path;
+    for (int i=0;i<MAXHIST;i++) TcpHistory[i]=tcpOptDialog->History[i];
+    for (int i=0;i<MAXHIST;i++) TcpMntpHist[i]=tcpOptDialog->MntpHist[i];
 
-    Paths[index][1] = tcpOptDialog->Path;
-    for (int i = 0; i < MAXHIST; i++) TcpHistory[i] = tcpOptDialog->History[i];
-    for (int i = 0; i < MAXHIST; i++) TcpMntpHist[i] = tcpOptDialog->MntpHist[i];
 }
 // set file options ---------------------------------------------------------
 void MainForm::FileOpt(int index, int opt)
 {
-    fileOptDialog->Path = Paths[index][2];
-    fileOptDialog->Opt = opt;
+    fileOptDialog->Path=Paths[index][2];
+    fileOptDialog->Opt=opt;
 
     fileOptDialog->exec();
-    if (fileOptDialog->result() != QDialog::Accepted) return;
-    Paths[index][2] = fileOptDialog->Path;
+    if (fileOptDialog->result()!=QDialog::Accepted) return;
+    Paths[index][2]=fileOptDialog->Path;
 }
 // set ftp/http options -----------------------------------------------------
 void MainForm::FtpOpt(int index, int opt)
 {
-    ftpOptDialog->Path = Paths[index][3];
-    ftpOptDialog->Opt = opt;
+    ftpOptDialog->Path=Paths[index][3];
+    ftpOptDialog->Opt=opt;
 
     ftpOptDialog->exec();
-    if (ftpOptDialog->result() != QDialog::Accepted) return;
+    if (ftpOptDialog->result()!=QDialog::Accepted) return;
+
+    Paths[index][3]=ftpOptDialog->Path;
 
-    Paths[index][3] = ftpOptDialog->Path;
 }
 // undate enable of widgets -------------------------------------------------
 void MainForm::UpdateEnable(void)
 {
-    BtnCmd->setEnabled(Input->currentIndex() < 2 || Input->currentIndex() == 3);
-    LabelOutput1->setStyleSheet(QString("color :%1").arg(color2String(Output1->currentIndex() > 0 ? Qt::black : Qt::gray)));
-    LabelOutput2->setStyleSheet(QString("color :%1").arg(color2String(Output2->currentIndex() > 0 ? Qt::black : Qt::gray)));
-    LabelOutput3->setStyleSheet(QString("color :%1").arg(color2String(Output3->currentIndex() > 0 ? Qt::black : Qt::gray)));
-    Output1Byte->setStyleSheet(QString("color :%1").arg(color2String(Output1->currentIndex() > 0 ? Qt::black : Qt::gray)));
-    Output2Byte->setStyleSheet(QString("color :%1").arg(color2String(Output2->currentIndex() > 0 ? Qt::black : Qt::gray)));
-    Output3Byte->setStyleSheet(QString("color :%1").arg(color2String(Output3->currentIndex() > 0 ? Qt::black : Qt::gray)));
-    Output1Bps->setStyleSheet(QString("color :%1").arg(color2String(Output1->currentIndex() > 0 ? Qt::black : Qt::gray)));
-    Output2Bps->setStyleSheet(QString("color :%1").arg(color2String(Output2->currentIndex() > 0 ? Qt::black : Qt::gray)));
-    Output3Bps->setStyleSheet(QString("color :%1").arg(color2String(Output3->currentIndex() > 0 ? Qt::black : Qt::gray)));
-    BtnOutput1->setEnabled(Output1->currentIndex() > 0);
-    BtnOutput2->setEnabled(Output2->currentIndex() > 0);
-    BtnOutput3->setEnabled(Output3->currentIndex() > 0);
-    BtnCmd1->setEnabled(BtnOutput1->isEnabled() && (Output1->currentIndex() == 1 || Output1->currentIndex() == 2));
-    BtnCmd2->setEnabled(BtnOutput2->isEnabled() && (Output2->currentIndex() == 1 || Output2->currentIndex() == 2));
-    BtnCmd3->setEnabled(BtnOutput3->isEnabled() && (Output3->currentIndex() == 1 || Output3->currentIndex() == 2));
-    BtnConv1->setEnabled(BtnOutput1->isEnabled() && Input->currentIndex() != 2 && Input->currentIndex() != 4);
-    BtnConv2->setEnabled(BtnOutput2->isEnabled() && Input->currentIndex() != 2 && Input->currentIndex() != 4);
-    BtnConv3->setEnabled(BtnOutput3->isEnabled() && Input->currentIndex() != 2 && Input->currentIndex() != 4);
+    BtnCmd->setEnabled(Input->currentIndex()<2||Input->currentIndex()==3);
+    LabelOutput1->setStyleSheet(QString("color :%1").arg(color2String(Output1->currentIndex()>0?Qt::black:Qt::gray)));
+    LabelOutput2->setStyleSheet(QString("color :%1").arg(color2String(Output2->currentIndex()>0?Qt::black:Qt::gray)));
+    LabelOutput3->setStyleSheet(QString("color :%1").arg(color2String(Output3->currentIndex()>0?Qt::black:Qt::gray)));
+    Output1Byte ->setStyleSheet(QString("color :%1").arg(color2String(Output1->currentIndex()>0?Qt::black:Qt::gray)));
+    Output2Byte ->setStyleSheet(QString("color :%1").arg(color2String(Output2->currentIndex()>0?Qt::black:Qt::gray)));
+    Output3Byte ->setStyleSheet(QString("color :%1").arg(color2String(Output3->currentIndex()>0?Qt::black:Qt::gray)));
+    Output1Bps  ->setStyleSheet(QString("color :%1").arg(color2String(Output1->currentIndex()>0?Qt::black:Qt::gray)));
+    Output2Bps  ->setStyleSheet(QString("color :%1").arg(color2String(Output2->currentIndex()>0?Qt::black:Qt::gray)));
+    Output3Bps  ->setStyleSheet(QString("color :%1").arg(color2String(Output3->currentIndex()>0?Qt::black:Qt::gray)));
+    BtnOutput1->setEnabled(Output1->currentIndex()>0);
+    BtnOutput2->setEnabled(Output2->currentIndex()>0);
+    BtnOutput3->setEnabled(Output3->currentIndex()>0);
+    BtnConv1  ->setEnabled(BtnOutput1->isEnabled());
+    BtnConv2  ->setEnabled(BtnOutput2->isEnabled());
+    BtnConv3  ->setEnabled(BtnOutput3->isEnabled());
 }
 // set task-tray icon -------------------------------------------------------
 void MainForm::SetTrayIcon(int index)
 {
-    QString icon[] = { ":/icons/tray0.bmp", ":/icons/tray1.bmp", ":/icons/tray2.bmp" };
-
+    QString icon[]={":/icons/tray0.bmp",":/icons/tray1.bmp",":/icons/tray2.bmp"};
     TrayIcon->setIcon(QIcon(icon[index]));
 }
 // load options -------------------------------------------------------------
 void MainForm::LoadOpt(void)
 {
-    QSettings settings(IniFile, QSettings::IniFormat);
-    int optdef[] = { 10000, 10000, 1000, 32768, 10, 0 };
-
-    Input->setCurrentIndex(settings.value("set/input", 0).toInt());
-    Output1->setCurrentIndex(settings.value("set/output1", 0).toInt());
-    Output2->setCurrentIndex(settings.value("set/output2", 0).toInt());
-    Output3->setCurrentIndex(settings.value("set/output3", 0).toInt());
-    TraceLevel = settings.value("set/tracelevel", 0).toInt();
-    NmeaReq = settings.value("set/nmeareq", 0).toInt();
-    FileSwapMargin = settings.value("set/fswapmargin", 30).toInt();
-    RelayBack = settings.value("set/relayback", 30).toInt();
-    ProgBarRange = settings.value("set/progbarrange", 30).toInt();
-    StaId = settings.value("set/staid", 0).toInt();
-    StaSel = settings.value("set/stasel", 0).toInt();
-    AntType = settings.value("set/anttype", "").toString();
-    RcvType = settings.value("set/rcvtype", "").toString();
-
-    for (int i = 0; i < 6; i++)
-        SvrOpt[i] = settings.value(QString("set/svropt_%1").arg(i), optdef[i]).toInt();
-    for (int i = 0; i < 3; i++) {
-        AntPos[i] = settings.value(QString("set/antpos_%1").arg(i), 0.0).toDouble();
-        AntOff[i] = settings.value(QString("set/antoff_%1").arg(i), 0.0).toDouble();
+    QSettings settings(IniFile,QSettings::IniFormat);
+    int optdef[]={10000,10000,1000,32768,10,0};
+    
+    Input  ->setCurrentIndex(settings.value("set/input",       0).toInt());
+    Output1->setCurrentIndex(settings.value("set/output1",     0).toInt());
+    Output2->setCurrentIndex(settings.value("set/output2",     0).toInt());
+    Output3->setCurrentIndex(settings.value("set/output3",     0).toInt());
+    TraceLevel        =settings.value("set/tracelevel",  0).toInt();
+    NmeaReq           =settings.value("set/nmeareq",     0).toInt();
+    FileSwapMargin    =settings.value("set/fswapmargin",30).toInt();
+    StaId             =settings.value("set/staid"       ,0).toInt();
+    StaSel            =settings.value("set/stasel"      ,0).toInt();
+    AntType           =settings.value("set/anttype",    "").toString();
+    RcvType           =settings.value("set/rcvtype",    "").toString();
+    
+    for (int i=0;i<6;i++) {
+        SvrOpt[i]=settings.value(QString("set/svropt_%1").arg(i),optdef[i]).toInt();
     }
-    for (int i = 0; i < MAXSTR - 1; i++) {
-        ConvEna[i] = settings.value(QString("conv/ena_%1").arg(i), 0).toInt();
-        ConvInp[i] = settings.value(QString("conv/inp_%1").arg(i), 0).toInt();
-        ConvOut[i] = settings.value(QString("conv/out_%1").arg(i), 0).toInt();
-        ConvMsg[i] = settings.value(QString("conv/msg_%1").arg(i), "").toString();
-        ConvOpt[i] = settings.value(QString("conv/opt_%1").arg(i), "").toString();
+    for (int i=0;i<3;i++) {
+        AntPos[i]=settings.value(QString("set/antpos_%1").arg(i),0.0).toDouble();
+        AntOff[i]=settings.value(QString("set/antoff_%1").arg(i),0.0).toDouble();
     }
-    for (int i = 0; i < MAXSTR; i++)
-        for (int j = 0; j < 2; j++) {
-            CmdEna   [i][j] = settings.value(QString("serial/cmdena_%1_%2").arg(i).arg(j), 1).toInt();
-            CmdEnaTcp[i][j] = settings.value(QString("tcpip/cmdena_%1_%2").arg(i).arg(j), 1).toInt();
-        }
-    for (int i = 0; i < MAXSTR; i++) for (int j = 0; j < 4; j++)
-            Paths[i][j] = settings.value(QString("path/path_%1_%2").arg(i).arg(j), "").toString();
-
-    for (int i = 0; i < MAXSTR; i++)
-        for (int j = 0; j < 2; j++) {
-            Cmds[i][j] = settings.value(QString("serial/cmd_%1_%2").arg(i).arg(j), "").toString();
-            Cmds[i][j] = Cmds[i][j].replace("@@", "\n");
-        }
-    for (int i = 0; i < MAXSTR; i++)
-        for (int j = 0; j < 2; j++) {
-            CmdsTcp[i][j] = settings.value(QString("tcpip/cmd_%1_%2").arg(i).arg(j), "").toString();
-            CmdsTcp[i][j] = CmdsTcp[i][j].replace("@@", "\n");
-        }
-    for (int i = 0; i < MAXHIST; i++)
-        TcpHistory[i] = settings.value(QString("tcpopt/history%1").arg(i), "").toString();
-    for (int i = 0; i < MAXHIST; i++)
-        TcpMntpHist[i] = settings.value(QString("tcpopt/mntphist%1").arg(i), "").toString();
-    StaPosFile = settings.value("stapos/staposfile", "").toString();
-    ExeDirectory = settings.value("dirs/exedirectory", "").toString();
-    LocalDirectory = settings.value("dirs/localdirectory", "").toString();
-    ProxyAddress = settings.value("dirs/proxyaddress", "").toString();
-    SrcTblFile = settings.value("file/srctblfile",    "").toString();
-    LogFile = settings.value("file/logfile",       "").toString();
-
+    for (int i=0;i<3;i++) {
+        ConvEna[i]=settings.value(QString("conv/ena_%1").arg(i), 0).toInt();
+        ConvInp[i]=settings.value(QString("conv/inp_%1").arg(i), 0).toInt();
+        ConvOut[i]=settings.value(QString("conv/out_%1").arg(i), 0).toInt();
+        ConvMsg[i]=settings.value (QString("conv/msg_%1").arg(i),"").toString();
+        ConvOpt[i]=settings.value (QString("conv/opt_%1").arg(i),"").toString();
+    }
+    for (int i=0;i<2;i++) {
+        CmdEna   [i]=settings.value(QString("serial/cmdena_%1").arg(i),1).toInt();
+        CmdEnaTcp[i]=settings.value(QString("tcpip/cmdena_%1").arg(i),1).toInt();
+    }
+    for (int i=0;i<4;i++) for (int j=0;j<4;j++) {
+        Paths[i][j]=settings.value(QString("path/path_%1_%2").arg(i).arg(j),"").toString();
+    }
+    for (int i=0;i<2;i++) {
+        Cmds[i]=settings.value(QString("serial/cmd_%1").arg(i),"").toString();
+        Cmds[i]=Cmds[i].replace("@@","\n");
+    }
+    for (int i=0;i<2;i++) {
+        CmdsTcp[i]=settings.value(QString("tcpip/cmd_%1").arg(i),"").toString();
+        CmdsTcp[i]=CmdsTcp[i].replace("@@","\n");
+    }
+    for (int i=0;i<MAXHIST;i++) {
+        TcpHistory[i]=settings.value(QString("tcpopt/history%1").arg(i),"").toString();
+    }
+    for (int i=0;i<MAXHIST;i++) {
+        TcpMntpHist[i]=settings.value(QString("tcpopt/mntphist%1").arg(i),"").toString();
+    }
+    StaPosFile    =settings.value("stapos/staposfile",    "").toString();
+    ExeDirectory  =settings.value("dirs/exedirectory",  "").toString();
+    LocalDirectory=settings.value("dirs/localdirectory","").toString();
+    ProxyAddress  =settings.value("dirs/proxyaddress",  "").toString();
+    
     UpdateEnable();
 }
 // save options--------------------------------------------------------------
 void MainForm::SaveOpt(void)
 {
-    QSettings settings(IniFile, QSettings::IniFormat);
-
-    settings.setValue("set/input", Input->currentIndex());
-    settings.setValue("set/output1", Output1->currentIndex());
-    settings.setValue("set/output2", Output2->currentIndex());
-    settings.setValue("set/output3", Output3->currentIndex());
+    QSettings settings(IniFile,QSettings::IniFormat);
+    
+    settings.setValue("set/input",      Input  ->currentIndex());
+    settings.setValue("set/output1",    Output1->currentIndex());
+    settings.setValue("set/output2",    Output2->currentIndex());
+    settings.setValue("set/output3",    Output3->currentIndex());
     settings.setValue("set/tracelevel", TraceLevel);
-    settings.setValue("set/nmeareq", NmeaReq);
-    settings.setValue("set/fswapmargin", FileSwapMargin);
-    settings.setValue("set/relayback", RelayBack);
-    settings.setValue("set/progbarrange", ProgBarRange);
-    settings.setValue("set/staid", StaId);
-    settings.setValue("set/stasel", StaSel);
-    settings.setValue("set/anttype", AntType);
-    settings.setValue("set/rcvtype", RcvType);
-
-    for (int i = 0; i < 6; i++)
-        settings.setValue(QString("set/svropt_%1").arg(i), SvrOpt[i]);
-    for (int i = 0; i < 3; i++) {
-        settings.setValue(QString("set/antpos_%1").arg(i), AntPos[i]);
-        settings.setValue(QString("set/antoff_%1").arg(i), AntOff[i]);
+    settings.setValue("set/nmeareq",    NmeaReq);
+    settings.setValue("set/fswapmargin",FileSwapMargin);
+    settings.setValue("set/staid",      StaId);
+    settings.setValue("set/stasel",     StaSel);
+    settings.setValue("set/anttype",    AntType);
+    settings.setValue("set/rcvtype",    RcvType);
+    
+    for (int i=0;i<6;i++) {
+        settings.setValue(QString("set/svropt_%1").arg(i),SvrOpt[i]);
     }
-    for (int i = 0; i < MAXSTR - 1; i++) {
-        settings.setValue(QString("conv/ena_%1").arg(i), ConvEna[i]);
-        settings.setValue(QString("conv/inp_%1").arg(i), ConvInp[i]);
-        settings.setValue(QString("conv/out_%1").arg(i), ConvOut[i]);
-        settings.setValue(QString("conv/msg_%1").arg(i), ConvMsg[i]);
-        settings.setValue(QString("conv/opt_%1").arg(i), ConvOpt[i]);
+    for (int i=0;i<3;i++) {
+        settings.setValue(QString("set/antpos_%1").arg(i),AntPos[i]);
+        settings.setValue(QString("set/antoff_%1").arg(i),AntOff[i]);
     }
-    for (int i = 0; i < MAXSTR; i++)
-        for (int j = 0; j < 2; j++) {
-            settings.setValue(QString("serial/cmdena_%1_%2").arg(i).arg(j), CmdEna  [i][j]);
-            settings.setValue(QString("tcpip/cmdena_%1_%2").arg(i).arg(j), CmdEnaTcp[i][j]);
-        }
-    for (int i = 0; i < MAXSTR; i++) for (int j = 0; j < 4; j++)
-            settings.setValue(QString("path/path_%1_%2").arg(i).arg(j), Paths[i][j]);
-
-    for (int i = 0; i < MAXSTR; i++)
-        for (int j = 0; j < 2; j++) {
-            Cmds[j][i] = Cmds[j][i].replace("\n", "@@");
-            settings.setValue(QString("serial/cmd_%1_%2").arg(i).arg(j), Cmds[i][j]);
-        }
-    for (int i = 0; i < MAXSTR; i++)
-        for (int j = 0; j < 2; j++) {
-            CmdsTcp[j][i] = CmdsTcp[j][i].replace("\n", "@@");
-            settings.setValue(QString("tcpip/cmd_%1_%2").arg(i).arg(j), CmdsTcp[i][j]);
-        }
-    for (int i = 0; i < MAXHIST; i++)
-        settings.setValue(QString("tcpopt/history%1").arg(i), tcpOptDialog->History[i]);
-    for (int i = 0; i < MAXHIST; i++)
-        settings.setValue(QString("tcpopt/mntphist%1").arg(i), tcpOptDialog->MntpHist[i]);
-    settings.setValue("stapos/staposfile", StaPosFile);
-    settings.setValue("dirs/exedirectory", ExeDirectory);
-    settings.setValue("dirs/localdirectory", LocalDirectory);
-    settings.setValue("dirs/proxyaddress", ProxyAddress);
-    settings.setValue("file/srctblfile",SrcTblFile);
-    settings.setValue("file/logfile",LogFile);
+    for (int i=0;i<3;i++) {
+        settings.setValue(QString("conv/ena_%1").arg(i),ConvEna[i]);
+        settings.setValue(QString("conv/inp_%1").arg(i),ConvInp[i]);
+        settings.setValue(QString("conv/out_%1").arg(i),ConvOut[i]);
+        settings.setValue(QString("conv/msg_%1").arg(i),ConvMsg[i]);
+        settings.setValue(QString("conv/opt_%1").arg(i),ConvOpt[i]);
+    }
+    for (int i=0;i<2;i++) {
+        settings.setValue(QString("serial/cmdena_%1").arg(i),CmdEna   [i]);
+        settings.setValue(QString("tcpip/cmdena_%1").arg(i),CmdEnaTcp[i]);
+    }
+    for (int i=0;i<4;i++) for (int j=0;j<4;j++) {
+        settings.setValue(QString("path/path_%1_%2").arg(i).arg(j),Paths[i][j]);
+    }
+    for (int i=0;i<2;i++) {
+        Cmds[i]=Cmds[i].replace("\n","@@");
+        settings.setValue(QString("serial/cmd_%1").arg(i),Cmds[i]);
+    }
+    for (int i=0;i<2;i++) {
+        CmdsTcp[i]=CmdsTcp[i].replace("\n","@@");
+        settings.setValue(QString("tcpip/cmd_%1").arg(i),CmdsTcp[i]);
+    }
+    for (int i=0;i<MAXHIST;i++) {
+        settings.setValue(QString("tcpopt/history%1").arg(i),tcpOptDialog->History[i]);
+    }
+    for (int i=0;i<MAXHIST;i++) {
+        settings.setValue(QString("tcpopt/mntphist%1").arg(i),tcpOptDialog->MntpHist[i]);
+    }
+    settings.setValue("stapos/staposfile"    ,StaPosFile    );
+    settings.setValue("dirs/exedirectory"  ,ExeDirectory  );
+    settings.setValue("dirs/localdirectory",LocalDirectory);
+    settings.setValue("dirs/proxyaddress"  ,ProxyAddress  );
 }
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/svrmain.h RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/svrmain.h
--- RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/svrmain.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/svrmain.h	2019-08-19 02:04:50.000000000 +0300
@@ -13,19 +13,16 @@
 
 class QCloseEvent;
 class SvrOptDialog;
+class Console;
 class SerialOptDialog;
 class TcpOptDialog;
 class FileOptDialog;
 class FtpOptDialog;
-class StrMonDialog;
-
-#define MAXSTR        4    // number of streams
 
 //---------------------------------------------------------------------------
 class MainForm : public QDialog, private Ui::MainForm
 {
     Q_OBJECT
-
 public slots:
     void BtnExitClick();
     void BtnInputClick();
@@ -54,28 +51,27 @@
     void BtnConv1Click();
     void BtnConv2Click();
     void BtnConv3Click();
-
 protected:
     void closeEvent(QCloseEvent*);
 
 private:
     QString IniFile;
-    QString Paths[MAXSTR][4], Cmds[MAXSTR][3], CmdsTcp[MAXSTR][3];
-    QString TcpHistory[MAXHIST], TcpMntpHist[MAXHIST];
-    QString StaPosFile, ExeDirectory, LocalDirectory, SwapInterval;
-    QString ProxyAddress,SrcTblFile,LogFile;
-    QString ConvMsg[MAXSTR - 1], ConvOpt[MAXSTR - 1], AntType, RcvType;
-    int ConvEna[MAXSTR - 1], ConvInp[MAXSTR - 1], ConvOut[3], StaId, StaSel;
-    int TraceLevel, SvrOpt[6], CmdEna[MAXSTR][3], CmdEnaTcp[MAXSTR][3], NmeaReq, FileSwapMargin, RelayBack, ProgBarRange;
-    double AntPos[3], AntOff[3];
-    gtime_t StartTime, EndTime;
+    QString Paths[4][4],Cmds[2],CmdsTcp[2];
+    QString TcpHistory[MAXHIST],TcpMntpHist[MAXHIST];
+    QString StaPosFile,ExeDirectory,LocalDirectory,SwapInterval;
+    QString ProxyAddress;
+    QString ConvMsg[3],ConvOpt[3],AntType,RcvType;
+	int ConvEna[3],ConvInp[3],ConvOut[3],StaId,StaSel;
+	int TraceLevel,SvrOpt[6],CmdEna[2],CmdEnaTcp[2],NmeaReq,FileSwapMargin;
+	double AntPos[3],AntOff[3];
+	gtime_t StartTime,EndTime;
     QSystemTrayIcon *TrayIcon;
     SvrOptDialog *svrOptDialog;
+    Console *console;
     TcpOptDialog *tcpOptDialog;
     SerialOptDialog *serialOptDialog;
     FileOptDialog *fileOptDialog;
     FtpOptDialog * ftpOptDialog;
-    StrMonDialog * strMonDialog;
     QTimer Timer1,Timer2;
 
     void SerialOpt(int index, int opt);
@@ -89,7 +85,6 @@
     void SetTrayIcon(int index);
     void LoadOpt(void);
     void SaveOpt(void);
-
 public:
     explicit MainForm(QWidget *parent=0);
 };
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/svrmain.ui RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/svrmain.ui
--- RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/svrmain.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/svrmain.ui	2019-08-19 02:04:50.000000000 +0300
@@ -6,8 +6,8 @@
    <rect>
     <x>0</x>
     <y>0</y>
-    <width>637</width>
-    <height>297</height>
+    <width>508</width>
+    <height>321</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -17,6 +17,9 @@
    <string/>
   </property>
   <layout class="QVBoxLayout" name="verticalLayout_2">
+   <property name="spacing">
+    <number>0</number>
+   </property>
    <property name="leftMargin">
     <number>0</number>
    </property>
@@ -44,6 +47,9 @@
       <string/>
      </property>
      <layout class="QVBoxLayout" name="verticalLayout">
+      <property name="spacing">
+       <number>0</number>
+      </property>
       <property name="leftMargin">
        <number>0</number>
       </property>
@@ -61,12 +67,6 @@
         <property name="enabled">
          <bool>true</bool>
         </property>
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
         <property name="toolTip">
          <string/>
         </property>
@@ -77,18 +77,6 @@
          <string/>
         </property>
         <layout class="QHBoxLayout" name="horizontalLayout">
-         <property name="leftMargin">
-          <number>0</number>
-         </property>
-         <property name="topMargin">
-          <number>0</number>
-         </property>
-         <property name="rightMargin">
-          <number>0</number>
-         </property>
-         <property name="bottomMargin">
-          <number>0</number>
-         </property>
          <item>
           <widget class="QLabel" name="Time">
            <property name="enabled">
@@ -257,20 +245,8 @@
          <string/>
         </property>
         <layout class="QGridLayout" name="gridLayout">
-         <property name="leftMargin">
-          <number>0</number>
-         </property>
-         <property name="topMargin">
-          <number>0</number>
-         </property>
-         <property name="rightMargin">
-          <number>0</number>
-         </property>
-         <property name="bottomMargin">
-          <number>0</number>
-         </property>
-         <item row="1" column="3" colspan="2">
-          <widget class="QPushButton" name="BtnInput">
+         <item row="0" column="1">
+          <widget class="QLabel" name="Label5">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -278,115 +254,77 @@
             <string/>
            </property>
            <property name="text">
-            <string>...</string>
+            <string>Stream</string>
            </property>
-           <property name="flat">
-            <bool>false</bool>
+          </widget>
+         </item>
+         <item row="0" column="2">
+          <widget class="QLabel" name="Label3">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>Type</string>
            </property>
           </widget>
          </item>
-         <item row="1" column="9">
-          <widget class="QLabel" name="InputByte">
+         <item row="0" column="3">
+          <widget class="QLabel" name="Label4">
            <property name="enabled">
             <bool>true</bool>
            </property>
-           <property name="palette">
-            <palette>
-             <active>
-              <colorrole role="WindowText">
-               <brush brushstyle="SolidPattern">
-                <color alpha="255">
-                 <red>0</red>
-                 <green>0</green>
-                 <blue>0</blue>
-                </color>
-               </brush>
-              </colorrole>
-             </active>
-             <inactive>
-              <colorrole role="WindowText">
-               <brush brushstyle="SolidPattern">
-                <color alpha="255">
-                 <red>0</red>
-                 <green>0</green>
-                 <blue>0</blue>
-                </color>
-               </brush>
-              </colorrole>
-             </inactive>
-             <disabled>
-              <colorrole role="WindowText">
-               <brush brushstyle="SolidPattern">
-                <color alpha="255">
-                 <red>0</red>
-                 <green>0</green>
-                 <blue>0</blue>
-                </color>
-               </brush>
-              </colorrole>
-             </disabled>
-            </palette>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>Opt</string>
+           </property>
+          </widget>
+         </item>
+         <item row="0" column="5">
+          <widget class="QLabel" name="Label1">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
            <property name="toolTip">
             <string/>
            </property>
            <property name="text">
-            <string>0</string>
+            <string>Cmd</string>
            </property>
           </widget>
          </item>
-         <item row="1" column="10">
-          <widget class="QLabel" name="InputBps">
+         <item row="0" column="6">
+          <widget class="QLabel" name="Label6">
            <property name="enabled">
             <bool>true</bool>
            </property>
-           <property name="palette">
-            <palette>
-             <active>
-              <colorrole role="WindowText">
-               <brush brushstyle="SolidPattern">
-                <color alpha="255">
-                 <red>0</red>
-                 <green>0</green>
-                 <blue>0</blue>
-                </color>
-               </brush>
-              </colorrole>
-             </active>
-             <inactive>
-              <colorrole role="WindowText">
-               <brush brushstyle="SolidPattern">
-                <color alpha="255">
-                 <red>0</red>
-                 <green>0</green>
-                 <blue>0</blue>
-                </color>
-               </brush>
-              </colorrole>
-             </inactive>
-             <disabled>
-              <colorrole role="WindowText">
-               <brush brushstyle="SolidPattern">
-                <color alpha="255">
-                 <red>0</red>
-                 <green>0</green>
-                 <blue>0</blue>
-                </color>
-               </brush>
-              </colorrole>
-             </disabled>
-            </palette>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>bytes</string>
+           </property>
+          </widget>
+         </item>
+         <item row="0" column="7">
+          <widget class="QLabel" name="Label7">
+           <property name="enabled">
+            <bool>true</bool>
            </property>
            <property name="toolTip">
             <string/>
            </property>
            <property name="text">
-            <string>0</string>
+            <string>bps</string>
            </property>
           </widget>
          </item>
-         <item row="4" column="0">
-          <widget class="QLabel" name="IndOutput1">
+         <item row="1" column="0">
+          <widget class="QLabel" name="IndInput">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -422,8 +360,8 @@
            </property>
           </widget>
          </item>
-         <item row="4" column="1">
-          <widget class="QLabel" name="LabelOutput1">
+         <item row="1" column="1">
+          <widget class="QLabel" name="LabelInput">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -468,12 +406,12 @@
             <string/>
            </property>
            <property name="text">
-            <string>(1) Output</string>
+            <string>(0) Input</string>
            </property>
           </widget>
          </item>
-         <item row="4" column="2">
-          <widget class="QComboBox" name="Output1">
+         <item row="1" column="2">
+          <widget class="QComboBox" name="Input">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -482,11 +420,6 @@
            </property>
            <item>
             <property name="text">
-             <string/>
-            </property>
-           </item>
-           <item>
-            <property name="text">
              <string>Serial</string>
             </property>
            </item>
@@ -502,28 +435,28 @@
            </item>
            <item>
             <property name="text">
-             <string>NTRIP Server</string>
+             <string>NTRIP Client</string>
             </property>
            </item>
            <item>
             <property name="text">
-             <string>NTRIP Caster</string>
+             <string>File</string>
             </property>
            </item>
            <item>
             <property name="text">
-             <string>UDP Client</string>
+             <string>FTP</string>
             </property>
            </item>
            <item>
             <property name="text">
-             <string>File</string>
+             <string>HTTP</string>
             </property>
            </item>
           </widget>
          </item>
-         <item row="4" column="3" colspan="2">
-          <widget class="QPushButton" name="BtnOutput1">
+         <item row="1" column="3" colspan="2">
+          <widget class="QPushButton" name="BtnInput">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -538,8 +471,24 @@
            </property>
           </widget>
          </item>
-         <item row="4" column="9">
-          <widget class="QLabel" name="Output1Byte">
+         <item row="1" column="5">
+          <widget class="QPushButton" name="BtnCmd">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="flat">
+            <bool>false</bool>
+           </property>
+          </widget>
+         </item>
+         <item row="1" column="6">
+          <widget class="QLabel" name="InputByte">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -588,8 +537,8 @@
            </property>
           </widget>
          </item>
-         <item row="4" column="10">
-          <widget class="QLabel" name="Output1Bps">
+         <item row="1" column="7">
+          <widget class="QLabel" name="InputBps">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -638,8 +587,21 @@
            </property>
           </widget>
          </item>
-         <item row="5" column="0">
-          <widget class="QLabel" name="IndOutput2">
+         <item row="2" column="4" colspan="2">
+          <widget class="QLabel" name="Label2">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>Conv</string>
+           </property>
+          </widget>
+         </item>
+         <item row="3" column="0">
+          <widget class="QLabel" name="IndOutput1">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -675,8 +637,8 @@
            </property>
           </widget>
          </item>
-         <item row="5" column="1">
-          <widget class="QLabel" name="LabelOutput2">
+         <item row="3" column="1">
+          <widget class="QLabel" name="LabelOutput1">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -721,12 +683,12 @@
             <string/>
            </property>
            <property name="text">
-            <string>(2) Output</string>
+            <string>(1) Output</string>
            </property>
           </widget>
          </item>
-         <item row="5" column="2">
-          <widget class="QComboBox" name="Output2">
+         <item row="3" column="2">
+          <widget class="QComboBox" name="Output1">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -760,23 +722,13 @@
            </item>
            <item>
             <property name="text">
-             <string>NTRIP Caster</string>
-            </property>
-           </item>
-           <item>
-            <property name="text">
-             <string>UDP Client</string>
-            </property>
-           </item>
-           <item>
-            <property name="text">
              <string>File</string>
             </property>
            </item>
           </widget>
          </item>
-         <item row="5" column="3" colspan="2">
-          <widget class="QPushButton" name="BtnOutput2">
+         <item row="3" column="3" colspan="2">
+          <widget class="QPushButton" name="BtnOutput1">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -791,8 +743,24 @@
            </property>
           </widget>
          </item>
-         <item row="5" column="9">
-          <widget class="QLabel" name="Output2Byte">
+         <item row="3" column="5">
+          <widget class="QPushButton" name="BtnConv1">
+           <property name="enabled">
+            <bool>false</bool>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>...</string>
+           </property>
+           <property name="flat">
+            <bool>false</bool>
+           </property>
+          </widget>
+         </item>
+         <item row="3" column="6">
+          <widget class="QLabel" name="Output1Byte">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -841,8 +809,8 @@
            </property>
           </widget>
          </item>
-         <item row="5" column="10">
-          <widget class="QLabel" name="Output2Bps">
+         <item row="3" column="7">
+          <widget class="QLabel" name="Output1Bps">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -891,8 +859,8 @@
            </property>
           </widget>
          </item>
-         <item row="6" column="0">
-          <widget class="QLabel" name="IndOutput3">
+         <item row="4" column="0">
+          <widget class="QLabel" name="IndOutput2">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -928,8 +896,58 @@
            </property>
           </widget>
          </item>
-         <item row="6" column="2">
-          <widget class="QComboBox" name="Output3">
+         <item row="4" column="1">
+          <widget class="QLabel" name="LabelOutput2">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="palette">
+            <palette>
+             <active>
+              <colorrole role="WindowText">
+               <brush brushstyle="SolidPattern">
+                <color alpha="255">
+                 <red>0</red>
+                 <green>0</green>
+                 <blue>0</blue>
+                </color>
+               </brush>
+              </colorrole>
+             </active>
+             <inactive>
+              <colorrole role="WindowText">
+               <brush brushstyle="SolidPattern">
+                <color alpha="255">
+                 <red>0</red>
+                 <green>0</green>
+                 <blue>0</blue>
+                </color>
+               </brush>
+              </colorrole>
+             </inactive>
+             <disabled>
+              <colorrole role="WindowText">
+               <brush brushstyle="SolidPattern">
+                <color alpha="255">
+                 <red>0</red>
+                 <green>0</green>
+                 <blue>0</blue>
+                </color>
+               </brush>
+              </colorrole>
+             </disabled>
+            </palette>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
+           <property name="text">
+            <string>(2) Output</string>
+           </property>
+          </widget>
+         </item>
+         <item row="4" column="2">
+          <widget class="QComboBox" name="Output2">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -963,23 +981,13 @@
            </item>
            <item>
             <property name="text">
-             <string>NTRIP Caster</string>
-            </property>
-           </item>
-           <item>
-            <property name="text">
-             <string>UDP Client</string>
-            </property>
-           </item>
-           <item>
-            <property name="text">
              <string>File</string>
             </property>
            </item>
           </widget>
          </item>
-         <item row="6" column="3" colspan="2">
-          <widget class="QPushButton" name="BtnOutput3">
+         <item row="4" column="3" colspan="2">
+          <widget class="QPushButton" name="BtnOutput2">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -994,58 +1002,24 @@
            </property>
           </widget>
          </item>
-         <item row="6" column="9">
-          <widget class="QLabel" name="Output3Byte">
+         <item row="4" column="5">
+          <widget class="QPushButton" name="BtnConv2">
            <property name="enabled">
-            <bool>true</bool>
-           </property>
-           <property name="palette">
-            <palette>
-             <active>
-              <colorrole role="WindowText">
-               <brush brushstyle="SolidPattern">
-                <color alpha="255">
-                 <red>0</red>
-                 <green>0</green>
-                 <blue>0</blue>
-                </color>
-               </brush>
-              </colorrole>
-             </active>
-             <inactive>
-              <colorrole role="WindowText">
-               <brush brushstyle="SolidPattern">
-                <color alpha="255">
-                 <red>0</red>
-                 <green>0</green>
-                 <blue>0</blue>
-                </color>
-               </brush>
-              </colorrole>
-             </inactive>
-             <disabled>
-              <colorrole role="WindowText">
-               <brush brushstyle="SolidPattern">
-                <color alpha="255">
-                 <red>0</red>
-                 <green>0</green>
-                 <blue>0</blue>
-                </color>
-               </brush>
-              </colorrole>
-             </disabled>
-            </palette>
+            <bool>false</bool>
            </property>
            <property name="toolTip">
             <string/>
            </property>
            <property name="text">
-            <string>0</string>
+            <string>...</string>
+           </property>
+           <property name="flat">
+            <bool>false</bool>
            </property>
           </widget>
          </item>
-         <item row="6" column="10">
-          <widget class="QLabel" name="Output3Bps">
+         <item row="4" column="6">
+          <widget class="QLabel" name="Output2Byte">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -1094,75 +1068,8 @@
            </property>
           </widget>
          </item>
-         <item row="5" column="6">
-          <widget class="QPushButton" name="BtnConv2">
-           <property name="enabled">
-            <bool>false</bool>
-           </property>
-           <property name="toolTip">
-            <string/>
-           </property>
-           <property name="text">
-            <string>...</string>
-           </property>
-           <property name="flat">
-            <bool>false</bool>
-           </property>
-          </widget>
-         </item>
-         <item row="6" column="6">
-          <widget class="QPushButton" name="BtnConv3">
-           <property name="enabled">
-            <bool>false</bool>
-           </property>
-           <property name="toolTip">
-            <string/>
-           </property>
-           <property name="text">
-            <string>...</string>
-           </property>
-           <property name="flat">
-            <bool>false</bool>
-           </property>
-          </widget>
-         </item>
-         <item row="4" column="6">
-          <widget class="QPushButton" name="BtnConv1">
-           <property name="enabled">
-            <bool>false</bool>
-           </property>
-           <property name="toolTip">
-            <string/>
-           </property>
-           <property name="text">
-            <string>...</string>
-           </property>
-           <property name="flat">
-            <bool>false</bool>
-           </property>
-          </widget>
-         </item>
-         <item row="0" column="6">
-          <widget class="QLabel" name="Label2">
-           <property name="enabled">
-            <bool>true</bool>
-           </property>
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
-           <property name="toolTip">
-            <string/>
-           </property>
-           <property name="text">
-            <string>Conv</string>
-           </property>
-          </widget>
-         </item>
-         <item row="6" column="1">
-          <widget class="QLabel" name="LabelOutput3">
+         <item row="4" column="7">
+          <widget class="QLabel" name="Output2Bps">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -1207,107 +1114,12 @@
             <string/>
            </property>
            <property name="text">
-            <string>(3) Output</string>
-           </property>
-          </widget>
-         </item>
-         <item row="0" column="1">
-          <widget class="QLabel" name="Label5">
-           <property name="enabled">
-            <bool>true</bool>
-           </property>
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
-           <property name="toolTip">
-            <string/>
-           </property>
-           <property name="text">
-            <string>Stream</string>
-           </property>
-          </widget>
-         </item>
-         <item row="0" column="2">
-          <widget class="QLabel" name="Label3">
-           <property name="enabled">
-            <bool>true</bool>
-           </property>
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
-           <property name="toolTip">
-            <string/>
-           </property>
-           <property name="text">
-            <string>Type</string>
-           </property>
-          </widget>
-         </item>
-         <item row="0" column="3">
-          <widget class="QLabel" name="Label4">
-           <property name="enabled">
-            <bool>true</bool>
-           </property>
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
-           <property name="toolTip">
-            <string/>
-           </property>
-           <property name="text">
-            <string>Opt</string>
-           </property>
-          </widget>
-         </item>
-         <item row="0" column="9">
-          <widget class="QLabel" name="Label6">
-           <property name="enabled">
-            <bool>true</bool>
-           </property>
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
-           <property name="toolTip">
-            <string/>
-           </property>
-           <property name="text">
-            <string>bytes</string>
-           </property>
-          </widget>
-         </item>
-         <item row="0" column="10">
-          <widget class="QLabel" name="Label7">
-           <property name="enabled">
-            <bool>true</bool>
-           </property>
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
-           <property name="toolTip">
-            <string/>
-           </property>
-           <property name="text">
-            <string>bps</string>
+            <string>0</string>
            </property>
           </widget>
          </item>
-         <item row="1" column="0">
-          <widget class="QLabel" name="IndInput">
+         <item row="5" column="0">
+          <widget class="QLabel" name="IndOutput3">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -1343,8 +1155,8 @@
            </property>
           </widget>
          </item>
-         <item row="1" column="1">
-          <widget class="QLabel" name="LabelInput">
+         <item row="5" column="1">
+          <widget class="QLabel" name="LabelOutput3">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -1389,12 +1201,12 @@
             <string/>
            </property>
            <property name="text">
-            <string>(0) Input</string>
+            <string>(3) Output</string>
            </property>
           </widget>
          </item>
-         <item row="1" column="2">
-          <widget class="QComboBox" name="Input">
+         <item row="5" column="2">
+          <widget class="QComboBox" name="Output3">
            <property name="enabled">
             <bool>true</bool>
            </property>
@@ -1403,32 +1215,27 @@
            </property>
            <item>
             <property name="text">
-             <string>Serial</string>
-            </property>
-           </item>
-           <item>
-            <property name="text">
-             <string>TCP Client</string>
+             <string/>
             </property>
            </item>
            <item>
             <property name="text">
-             <string>TCP Server</string>
+             <string>Serial</string>
             </property>
            </item>
            <item>
             <property name="text">
-             <string>NTRIP Client</string>
+             <string>TCP Client</string>
             </property>
            </item>
            <item>
             <property name="text">
-             <string>NTRIP Caster</string>
+             <string>TCP Server</string>
             </property>
            </item>
            <item>
             <property name="text">
-             <string>UDP Server</string>
+             <string>NTRIP Server</string>
             </property>
            </item>
            <item>
@@ -1436,41 +1243,28 @@
              <string>File</string>
             </property>
            </item>
-           <item>
-            <property name="text">
-             <string>FTP</string>
-            </property>
-           </item>
-           <item>
-            <property name="text">
-             <string>HTTP</string>
-            </property>
-           </item>
           </widget>
          </item>
-         <item row="0" column="5">
-          <widget class="QLabel" name="Label1">
+         <item row="5" column="3" colspan="2">
+          <widget class="QPushButton" name="BtnOutput3">
            <property name="enabled">
             <bool>true</bool>
            </property>
-           <property name="sizePolicy">
-            <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-             <horstretch>0</horstretch>
-             <verstretch>0</verstretch>
-            </sizepolicy>
-           </property>
            <property name="toolTip">
             <string/>
            </property>
            <property name="text">
-            <string>Cmd</string>
+            <string>...</string>
+           </property>
+           <property name="flat">
+            <bool>false</bool>
            </property>
           </widget>
          </item>
-         <item row="1" column="5">
-          <widget class="QPushButton" name="BtnCmd">
+         <item row="5" column="5">
+          <widget class="QPushButton" name="BtnConv3">
            <property name="enabled">
-            <bool>true</bool>
+            <bool>false</bool>
            </property>
            <property name="toolTip">
             <string/>
@@ -1483,24 +1277,103 @@
            </property>
           </widget>
          </item>
-         <item row="4" column="5">
-          <widget class="QPushButton" name="BtnCmd1">
-           <property name="text">
-            <string>...</string>
+         <item row="5" column="6">
+          <widget class="QLabel" name="Output3Byte">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="palette">
+            <palette>
+             <active>
+              <colorrole role="WindowText">
+               <brush brushstyle="SolidPattern">
+                <color alpha="255">
+                 <red>0</red>
+                 <green>0</green>
+                 <blue>0</blue>
+                </color>
+               </brush>
+              </colorrole>
+             </active>
+             <inactive>
+              <colorrole role="WindowText">
+               <brush brushstyle="SolidPattern">
+                <color alpha="255">
+                 <red>0</red>
+                 <green>0</green>
+                 <blue>0</blue>
+                </color>
+               </brush>
+              </colorrole>
+             </inactive>
+             <disabled>
+              <colorrole role="WindowText">
+               <brush brushstyle="SolidPattern">
+                <color alpha="255">
+                 <red>0</red>
+                 <green>0</green>
+                 <blue>0</blue>
+                </color>
+               </brush>
+              </colorrole>
+             </disabled>
+            </palette>
+           </property>
+           <property name="toolTip">
+            <string/>
            </property>
-          </widget>
-         </item>
-         <item row="5" column="5">
-          <widget class="QPushButton" name="BtnCmd2">
            <property name="text">
-            <string>...</string>
+            <string>0</string>
            </property>
           </widget>
          </item>
-         <item row="6" column="5">
-          <widget class="QPushButton" name="BtnCmd3">
+         <item row="5" column="7">
+          <widget class="QLabel" name="Output3Bps">
+           <property name="enabled">
+            <bool>true</bool>
+           </property>
+           <property name="palette">
+            <palette>
+             <active>
+              <colorrole role="WindowText">
+               <brush brushstyle="SolidPattern">
+                <color alpha="255">
+                 <red>0</red>
+                 <green>0</green>
+                 <blue>0</blue>
+                </color>
+               </brush>
+              </colorrole>
+             </active>
+             <inactive>
+              <colorrole role="WindowText">
+               <brush brushstyle="SolidPattern">
+                <color alpha="255">
+                 <red>0</red>
+                 <green>0</green>
+                 <blue>0</blue>
+                </color>
+               </brush>
+              </colorrole>
+             </inactive>
+             <disabled>
+              <colorrole role="WindowText">
+               <brush brushstyle="SolidPattern">
+                <color alpha="255">
+                 <red>0</red>
+                 <green>0</green>
+                 <blue>0</blue>
+                </color>
+               </brush>
+              </colorrole>
+             </disabled>
+            </palette>
+           </property>
+           <property name="toolTip">
+            <string/>
+           </property>
            <property name="text">
-            <string>...</string>
+            <string>0</string>
            </property>
           </widget>
          </item>
@@ -1534,12 +1407,6 @@
         <property name="enabled">
          <bool>true</bool>
         </property>
-        <property name="sizePolicy">
-         <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-          <horstretch>0</horstretch>
-          <verstretch>0</verstretch>
-         </sizepolicy>
-        </property>
         <property name="toolTip">
          <string/>
         </property>
@@ -1550,18 +1417,6 @@
          <string/>
         </property>
         <layout class="QHBoxLayout" name="horizontalLayout_2">
-         <property name="leftMargin">
-          <number>0</number>
-         </property>
-         <property name="topMargin">
-          <number>0</number>
-         </property>
-         <property name="rightMargin">
-          <number>0</number>
-         </property>
-         <property name="bottomMargin">
-          <number>0</number>
-         </property>
          <item>
           <widget class="QPushButton" name="BtnStrMon">
            <property name="enabled">
@@ -1768,13 +1623,10 @@
    </item>
    <item>
     <widget class="QWidget" name="widget" native="true">
-     <property name="sizePolicy">
-      <sizepolicy hsizetype="Preferred" vsizetype="Fixed">
-       <horstretch>0</horstretch>
-       <verstretch>0</verstretch>
-      </sizepolicy>
-     </property>
      <layout class="QHBoxLayout" name="horizontalLayout_3">
+      <property name="spacing">
+       <number>0</number>
+      </property>
       <property name="leftMargin">
        <number>0</number>
       </property>
@@ -1799,7 +1651,7 @@
          <string>&amp;Start</string>
         </property>
         <property name="icon">
-         <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
+         <iconset resource="../rtknavi_qt/rtknavi_qt.qrc">
           <normaloff>:/buttons/start.bmp</normaloff>:/buttons/start.bmp</iconset>
         </property>
         <property name="flat">
@@ -1809,6 +1661,9 @@
       </item>
       <item>
        <widget class="QPushButton" name="BtnStop">
+        <property name="enabled">
+         <bool>false</bool>
+        </property>
         <property name="toolTip">
          <string/>
         </property>
@@ -1816,7 +1671,7 @@
          <string>S&amp;top</string>
         </property>
         <property name="icon">
-         <iconset resource="../rtkpost_qt/rtkpost_qt.qrc">
+         <iconset resource="../rtknavi_qt/rtknavi_qt.qrc">
           <normaloff>:/buttons/stop2.bmp</normaloff>:/buttons/stop2.bmp</iconset>
         </property>
         <property name="flat">
@@ -1889,32 +1744,9 @@
   <addaction name="MenuStop"/>
   <addaction name="MenuExit"/>
  </widget>
- <tabstops>
-  <tabstop>BtnStart</tabstop>
-  <tabstop>BtnStop</tabstop>
-  <tabstop>BtnOpt</tabstop>
-  <tabstop>BtnExit</tabstop>
-  <tabstop>Input</tabstop>
-  <tabstop>BtnInput</tabstop>
-  <tabstop>BtnCmd</tabstop>
-  <tabstop>Output1</tabstop>
-  <tabstop>BtnOutput1</tabstop>
-  <tabstop>BtnCmd1</tabstop>
-  <tabstop>BtnConv1</tabstop>
-  <tabstop>Output2</tabstop>
-  <tabstop>BtnOutput2</tabstop>
-  <tabstop>BtnCmd2</tabstop>
-  <tabstop>BtnConv2</tabstop>
-  <tabstop>Output3</tabstop>
-  <tabstop>BtnOutput3</tabstop>
-  <tabstop>BtnCmd3</tabstop>
-  <tabstop>BtnConv3</tabstop>
-  <tabstop>BtnStrMon</tabstop>
-  <tabstop>BtnTaskIcon</tabstop>
-  <tabstop>BtnAbout</tabstop>
- </tabstops>
  <resources>
   <include location="../rtkpost_qt/rtkpost_qt.qrc"/>
+  <include location="../rtknavi_qt/rtknavi_qt.qrc"/>
  </resources>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/svroptdlg.cpp RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/svroptdlg.cpp
--- RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/svroptdlg.cpp	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/svroptdlg.cpp	2019-08-19 02:04:50.000000000 +0300
@@ -1,9 +1,10 @@
 //---------------------------------------------------------------------------
 #include <QShowEvent>
+#include <QIntValidator>
+#include <QDoubleValidator>
 #include <QFileDialog>
 #include <QFileSystemModel>
 #include <QCompleter>
-#include <QFileDialog>
 
 #include "rtklib.h"
 #include "refdlg.h"
@@ -15,132 +16,137 @@
 {
     setupUi(this);
 
-    QCompleter *dirCompleter = new QCompleter(this);
-    QFileSystemModel *dirModel = new QFileSystemModel(dirCompleter);
+    QCompleter *dirCompleter=new QCompleter(this);
+    QFileSystemModel *dirModel=new QFileSystemModel(dirCompleter);
     dirModel->setRootPath("");
-    dirModel->setFilter(QDir::AllDirs | QDir::Drives | QDir::NoDotAndDotDot);
+    dirModel->setFilter(QDir::AllDirs|QDir::Drives|QDir::NoDotAndDotDot);
     dirCompleter->setModel(dirModel);
     LocalDir->setCompleter(dirCompleter);
 
-    connect(BtnOk, SIGNAL(clicked(bool)), this, SLOT(BtnOkClick()));
-    connect(BtnCancel, SIGNAL(clicked(bool)), this, SLOT(reject()));
-    connect(BtnPos, SIGNAL(clicked(bool)), this, SLOT(BtnPosClick()));
-    connect(BtnSrcTblFile, SIGNAL(clicked(bool)), this, SLOT(BtnSrcTblFileClick()));
-    connect(BtnLogFile, SIGNAL(clicked(bool)), this, SLOT(BtnLogFileClick()));
-    connect(NmeaReqT, SIGNAL(clicked(bool)), this, SLOT(NmeaReqTClick()));
-    connect(BtnLocalDir, SIGNAL(clicked(bool)), this, SLOT(BtnLocalDirClick()));
-    connect(StaInfoSel, SIGNAL(clicked(bool)), this, SLOT(StaInfoSelClick()));
+    connect(BtnOk,SIGNAL(clicked(bool)),this,SLOT(BtnOkClick()));
+    connect(BtnCancel,SIGNAL(clicked(bool)),this,SLOT(reject()));
+    connect(BtnPos,SIGNAL(clicked(bool)),this,SLOT(BtnPosClick()));
+    connect(NmeaReqT,SIGNAL(clicked(bool)),this,SLOT(NmeaReqTClick()));
+    connect(BtnLocalDir,SIGNAL(clicked(bool)),this,SLOT(BtnLocalDirClick()));
+    connect(StaInfoSel,SIGNAL(clicked(bool)),this,SLOT(StaInfoSelClick()));
+
+    // set validators to positive integer values
+    SvrBuffSize->setValidator(new QIntValidator(0,0xffffffff));
+    AvePeriodRate->setValidator(new QIntValidator(0,0xffffffff));
+    SvrCycle->setValidator(new QIntValidator(0,0xffffffff));
+    DataTimeout->setValidator(new QIntValidator(0,0xffffffff));
+    ConnectInterval->setValidator(new QIntValidator(0,0xffffffff));
+    NmeaCycle->setValidator(new QIntValidator(0,0xffffffff));
+    StationId->setValidator(new QIntValidator(0,0xffffffff));
+
+    AntPos1->setValidator(new QDoubleValidator(-90,90,9));
+    AntPos2->setValidator(new QDoubleValidator(-180,180,9));
+    AntPos3->setValidator(new QDoubleValidator(0,8000,3));
 
+    AntOff1->setValidator(new QDoubleValidator());
+    AntOff2->setValidator(new QDoubleValidator());
+    AntOff3->setValidator(new QDoubleValidator());
 }
 //---------------------------------------------------------------------------
-void SvrOptDialog::showEvent(QShowEvent *event)
+void SvrOptDialog::showEvent(QShowEvent* event)
 {
     if (event->spontaneous()) return;
 
-    DataTimeout->setValue(SvrOpt[0]);
-    ConnectInterval->setValue(SvrOpt[1]);
-    AvePeriodRate->setValue(SvrOpt[2]);
-    SvrBuffSize->setValue(SvrOpt[3]);
-    SvrCycle->setValue(SvrOpt[4]);
-    RelayMsg->setCurrentIndex(RelayBack);
-    ProgBarR->setValue(ProgBarRange);
-    NmeaCycle->setValue(SvrOpt[5]);
-    FileSwapMarginE->setValue(FileSwapMargin);
-    if (norm(AntPos, 3) > 0.0) {
+    DataTimeout->setText(QString::number(SvrOpt[0]));
+    ConnectInterval->setText(QString::number(SvrOpt[1]));
+    AvePeriodRate->setText(QString::number(SvrOpt[2]));
+    SvrBuffSize->setText(QString::number(SvrOpt[3]));
+    SvrCycle->setText(QString::number(SvrOpt[4]));
+    NmeaCycle->setText(QString::number(SvrOpt[5]));
+    FileSwapMarginE->setText(QString::number(FileSwapMargin));
+	if (norm(AntPos,3)>0.0) {
         double pos[3];
 
-        ecef2pos(AntPos, pos);
-        AntPos1->setValue(pos[0] * R2D);
-        AntPos2->setValue(pos[1] * R2D);
-        AntPos3->setValue(pos[2]);
-    } else {
-        AntPos1->setValue(0);
-        AntPos2->setValue(0);
-        AntPos3->setValue(0);
+        ecef2pos(AntPos,pos);
+        AntPos1->setText(QString::number(pos[0]*R2D,'f',8));
+        AntPos2->setText(QString::number(pos[1]*R2D,'f',8));
+        AntPos3->setText(QString::number(pos[2],'f',3));
+	}
+	else {
+        AntPos1->setText("0.00000000");
+        AntPos2->setText("0.00000000");
+        AntPos3->setText("0.000");
 	}
     TraceLevelS->setCurrentIndex(TraceLevel);
     NmeaReqT->setChecked(NmeaReq);
     LocalDir->setText(LocalDirectory);
     ProxyAddr->setText(ProxyAddress);
-    StationId->setValue(StaId);
+    StationId->setText(QString::number(StaId));
     StaInfoSel->setChecked(StaSel);
     AntInfo->setText(AntType);
     RcvInfo->setText(RcvType);
-    AntOff1->setValue(AntOff[0]);
-    AntOff2->setValue(AntOff[1]);
-    AntOff3->setValue(AntOff[2]);
-    SrcTblFileF->setText(SrcTblFile);
-    LogFileF->setText(LogFile);
-
+    AntOff1->setText(QString::number(AntOff[0],'f',4));
+    AntOff2->setText(QString::number(AntOff[1],'f',4));
+    AntOff3->setText(QString::number(AntOff[2],'f',4));
+	
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
 void SvrOptDialog::BtnOkClick()
 {
 	double pos[3];
-
-    SvrOpt[0] = DataTimeout->value();
-    SvrOpt[1] = ConnectInterval->value();
-    SvrOpt[2] = AvePeriodRate->value();
-    SvrOpt[3] = SvrBuffSize->value();
-    SvrOpt[4] = SvrCycle->value();
-    SvrOpt[5] = NmeaCycle->value();
-    FileSwapMargin = FileSwapMarginE->value();
-    RelayBack = RelayMsg->currentIndex();
-    ProgBarRange = ProgBarR->value();
-    pos[0] = AntPos1->value() * D2R;
-    pos[1] = AntPos2->value() * D2R;
-    pos[2] = AntPos3->value();
-
-    if (norm(pos, 3) > 0.0)
-        pos2ecef(pos, AntPos);
-    else
-        for (int i = 0; i < 3; i++) AntPos[i] = 0.0;
-
-    TraceLevel = TraceLevelS->currentIndex();
-    NmeaReq = NmeaReqT->isChecked();
-    LocalDirectory = LocalDir->text();
-    ProxyAddress = ProxyAddr->text();
-    StaId = StationId->value();
-    StaSel = StaInfoSel->isChecked();
-    AntType = AntInfo->text();
-    RcvType = RcvInfo->text();
-    AntOff[0] = AntOff1->value();
-    AntOff[1] = AntOff2->value();
-    AntOff[2] = AntOff3->value();
+    SvrOpt[0]=DataTimeout->text().toInt();
+    SvrOpt[1]=ConnectInterval->text().toInt();
+    SvrOpt[2]=AvePeriodRate->text().toInt();
+    SvrOpt[3]=SvrBuffSize->text().toInt();
+    SvrOpt[4]=SvrCycle->text().toInt();
+    SvrOpt[5]=NmeaCycle->text().toInt();
+    FileSwapMargin=FileSwapMarginE->text().toInt();
+    pos[0]=AntPos1->text().toDouble()*D2R;
+    pos[1]=AntPos2->text().toDouble()*D2R;
+    pos[2]=AntPos3->text().toDouble();
+	if (norm(pos,3)>0.0) {
+		pos2ecef(pos,AntPos);
+	}
+	else {
+		for (int i=0;i<3;i++) AntPos[i]=0.0;
+	}
+    TraceLevel=TraceLevelS->currentIndex();
+    NmeaReq=NmeaReqT->isChecked();
+    LocalDirectory=LocalDir->text();
+    ProxyAddress=ProxyAddr->text();
+    StaId=StationId->text().toInt();
+    StaSel=StaInfoSel->isChecked();
+    AntType=AntInfo->text();
+    RcvType=RcvInfo->text();
+    AntOff[0]=AntOff1->text().toDouble();
+    AntOff[1]=AntOff2->text().toDouble();
+    AntOff[2]=AntOff3->text().toDouble();
 
     accept();
 }
 //---------------------------------------------------------------------------
 void SvrOptDialog::BtnPosClick()
 {
-    RefDialog *refDialog = new RefDialog(this);
+    RefDialog *refDialog=new RefDialog(this);
 
-    refDialog->RovPos[0] = AntPos1->value();
-    refDialog->RovPos[1] = AntPos2->value();
-    refDialog->RovPos[2] = AntPos3->value();
+    refDialog->RovPos[0]=AntPos1->text().toDouble();
+    refDialog->RovPos[1]=AntPos2->text().toDouble();
+    refDialog->RovPos[2]=AntPos3->text().toDouble();
     refDialog->BtnLoad->setEnabled(true);
-    refDialog->StaPosFile = StaPosFile;
+    refDialog->StaPosFile=StaPosFile;
 
     refDialog->exec();
 
-    if (refDialog->result() != QDialog::Accepted) return;
+    if (refDialog->result()!=QDialog::Accepted) return;
 
-    AntPos1->setValue(refDialog->Pos[0]);
-    AntPos2->setValue(refDialog->Pos[1]);
-    AntPos3->setValue(refDialog->Pos[2]);
-    StaPosFile = refDialog->StaPosFile;
-    SrcTblFile=SrcTblFileF->text();
-    LogFile=LogFileF->text();
+    AntPos1->setText(QString::number(refDialog->Pos[0],'f',8));
+    AntPos2->setText(QString::number(refDialog->Pos[1],'f',8));
+    AntPos3->setText(QString::number(refDialog->Pos[2],'f',3));
+    StaPosFile=refDialog->StaPosFile;
 
     delete refDialog;
 }
 //---------------------------------------------------------------------------
 void SvrOptDialog::BtnLocalDirClick()
 {
-    QString dir = LocalDir->text();
-
-    dir = QFileDialog::getExistingDirectory(this, tr("Local Directory"), dir);
+    QString dir=LocalDir->text();
+    dir=QFileDialog::getExistingDirectory(this,tr("Local Directory"),dir);
     LocalDir->setText(dir);
 }
 //---------------------------------------------------------------------------
@@ -148,10 +154,10 @@
 {
     NmeaCycle->setEnabled(NmeaReqT->isChecked());
     StationId->setEnabled(StaInfoSel->isChecked());
-    AntPos1->setEnabled(StaInfoSel->isChecked() || NmeaReqT->isChecked());
-    AntPos2->setEnabled(StaInfoSel->isChecked() || NmeaReqT->isChecked());
-    AntPos3->setEnabled(StaInfoSel->isChecked() || NmeaReqT->isChecked());
-    BtnPos->setEnabled(StaInfoSel->isChecked() || NmeaReqT->isChecked());
+    AntPos1->setEnabled(StaInfoSel->isChecked()||NmeaReqT->isChecked());
+    AntPos2->setEnabled(StaInfoSel->isChecked()||NmeaReqT->isChecked());
+    AntPos3->setEnabled(StaInfoSel->isChecked()||NmeaReqT->isChecked());
+    BtnPos ->setEnabled(StaInfoSel->isChecked()||NmeaReqT->isChecked());
     AntOff1->setEnabled(StaInfoSel->isChecked());
     AntOff2->setEnabled(StaInfoSel->isChecked());
     AntOff3->setEnabled(StaInfoSel->isChecked());
@@ -169,13 +175,3 @@
 	UpdateEnable();
 }
 //---------------------------------------------------------------------------
-void SvrOptDialog::BtnSrcTblFileClick()
-{
-    SrcTblFileF->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("NTRIP Source Table File"),QString(),tr("All (*.*)"))));
-}
-//---------------------------------------------------------------------------
-void SvrOptDialog::BtnLogFileClick()
-{
-    LogFileF->setText(QDir::toNativeSeparators(QFileDialog::getOpenFileName(this,tr("Log File"),QString(),tr("All (*.*)"))));
-}
-//---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/svroptdlg.h RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/svroptdlg.h
--- RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/svroptdlg.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/svroptdlg.h	2019-08-19 02:04:50.000000000 +0300
@@ -10,29 +10,21 @@
 class SvrOptDialog : public QDialog, public Ui::SvrOptDialog
 {
     Q_OBJECT
-
 public slots:
     void BtnOkClick();
     void BtnPosClick();
     void NmeaReqTClick();
     void BtnLocalDirClick();
     void StaInfoSelClick();
-    void BtnSrcTblFileClick();
-    void BtnLogFileClick();
-
 protected:
     void showEvent(QShowEvent*);
-
 private:
     void UpdateEnable(void);
-
 public:
-    QString StaPosFile, ExeDirectory, LocalDirectory, ProxyAddress;
-    QString AntType, RcvType, SrcTblFile, LogFile;
-    int SvrOpt[6], TraceLevel, NmeaReq, FileSwapMargin, StaId, StaSel, RelayBack;
-    int ProgBarRange;
-    double AntPos[3], AntOff[3];
-
+    QString StaPosFile,ExeDirectory,LocalDirectory,ProxyAddress;
+    QString AntType,RcvType;
+	int SvrOpt[6],TraceLevel,NmeaReq,FileSwapMargin,StaId,StaSel;
+	double AntPos[3],AntOff[3];
     explicit SvrOptDialog(QWidget *parent);
 };
 //---------------------------------------------------------------------------
diff -uNdr RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/svroptdlg.ui RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/svroptdlg.ui
--- RTKLIB-rtklib_2.4.3_orig/app/strsvr_qt/svroptdlg.ui	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/app/strsvr_qt/svroptdlg.ui	2019-08-19 02:04:50.000000000 +0300
@@ -7,7 +7,7 @@
     <x>0</x>
     <y>0</y>
     <width>636</width>
-    <height>494</height>
+    <height>324</height>
    </rect>
   </property>
   <property name="windowTitle">
@@ -29,24 +29,24 @@
    <property name="bottomMargin">
     <number>0</number>
    </property>
-   <item row="12" column="2">
-    <widget class="QDoubleSpinBox" name="AntOff1">
-     <property name="suffix">
-      <string> m</string>
-     </property>
-     <property name="decimals">
-      <number>4</number>
+   <property name="spacing">
+    <number>0</number>
+   </property>
+   <item row="0" column="0">
+    <widget class="QLabel" name="Label1">
+     <property name="enabled">
+      <bool>true</bool>
      </property>
-     <property name="minimum">
-      <double>-1000.000000000000000</double>
+     <property name="toolTip">
+      <string/>
      </property>
-     <property name="maximum">
-      <double>10000.000000000000000</double>
+     <property name="text">
+      <string>Buffer Size (bytes)</string>
      </property>
     </widget>
    </item>
-   <item row="4" column="3" colspan="3">
-    <widget class="QLabel" name="Label7">
+   <item row="0" column="2">
+    <widget class="QLineEdit" name="SvrBuffSize">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -54,65 +54,25 @@
       <string/>
      </property>
      <property name="text">
-      <string>Output Log Level</string>
+      <string>16384</string>
      </property>
     </widget>
    </item>
-   <item row="20" column="7">
-    <widget class="QPushButton" name="BtnLocalDir">
+   <item row="0" column="3" colspan="3">
+    <widget class="QLabel" name="Label6">
      <property name="enabled">
       <bool>true</bool>
      </property>
-     <property name="palette">
-      <palette>
-       <active>
-        <colorrole role="WindowText">
-         <brush brushstyle="SolidPattern">
-          <color alpha="255">
-           <red>0</red>
-           <green>0</green>
-           <blue>0</blue>
-          </color>
-         </brush>
-        </colorrole>
-       </active>
-       <inactive>
-        <colorrole role="WindowText">
-         <brush brushstyle="SolidPattern">
-          <color alpha="255">
-           <red>0</red>
-           <green>0</green>
-           <blue>0</blue>
-          </color>
-         </brush>
-        </colorrole>
-       </inactive>
-       <disabled>
-        <colorrole role="WindowText">
-         <brush brushstyle="SolidPattern">
-          <color alpha="255">
-           <red>0</red>
-           <green>0</green>
-           <blue>0</blue>
-          </color>
-         </brush>
-        </colorrole>
-       </disabled>
-      </palette>
-     </property>
      <property name="toolTip">
       <string/>
      </property>
      <property name="text">
-      <string>...</string>
-     </property>
-     <property name="flat">
-      <bool>false</bool>
+      <string>Period of Rate (ms)</string>
      </property>
     </widget>
    </item>
-   <item row="13" column="0">
-    <widget class="QLabel" name="Label12">
+   <item row="0" column="6" colspan="2">
+    <widget class="QLineEdit" name="AvePeriodRate">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -120,12 +80,12 @@
       <string/>
      </property>
      <property name="text">
-      <string>Antenna Info</string>
+      <string>1000</string>
      </property>
     </widget>
    </item>
-   <item row="14" column="0">
-    <widget class="QLabel" name="Label13">
+   <item row="1" column="0">
+    <widget class="QLabel" name="Label2">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -133,39 +93,38 @@
       <string/>
      </property>
      <property name="text">
-      <string>Receiver Info</string>
+      <string>Server Cycle  (ms)</string>
      </property>
     </widget>
    </item>
-   <item row="17" column="0">
-    <widget class="QLabel" name="label_2">
-     <property name="text">
-      <string>Log File</string>
+   <item row="1" column="2">
+    <widget class="QLineEdit" name="SvrCycle">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
      </property>
-    </widget>
-   </item>
-   <item row="18" column="2" colspan="5">
-    <widget class="QLineEdit" name="SrcTblFileF"/>
-   </item>
-   <item row="18" column="7">
-    <widget class="QPushButton" name="BtnSrcTblFile">
      <property name="text">
-      <string>...</string>
+      <string>100</string>
      </property>
     </widget>
    </item>
-   <item row="17" column="2" colspan="5">
-    <widget class="QLineEdit" name="LogFileF"/>
-   </item>
-   <item row="17" column="7">
-    <widget class="QPushButton" name="BtnLogFile">
+   <item row="1" column="3" colspan="3">
+    <widget class="QLabel" name="Label9">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
      <property name="text">
-      <string>...</string>
+      <string>File Swap Margin (s)</string>
      </property>
     </widget>
    </item>
-   <item row="2" column="3" colspan="3">
-    <widget class="QLabel" name="Label9">
+   <item row="1" column="6" colspan="2">
+    <widget class="QLineEdit" name="FileSwapMarginE">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -173,12 +132,12 @@
       <string/>
      </property>
      <property name="text">
-      <string>File Swap Margin</string>
+      <string>30</string>
      </property>
     </widget>
    </item>
-   <item row="21" column="0">
-    <widget class="QLabel" name="Label10">
+   <item row="2" column="0" colspan="2">
+    <widget class="QLabel" name="Label3">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -186,12 +145,12 @@
       <string/>
      </property>
      <property name="text">
-      <string>HTTP/NTRIP Proxy</string>
+      <string>Inactive Timeout (ms)</string>
      </property>
     </widget>
    </item>
-   <item row="2" column="0">
-    <widget class="QLabel" name="Label2">
+   <item row="2" column="2">
+    <widget class="QLineEdit" name="DataTimeout">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -199,25 +158,31 @@
       <string/>
      </property>
      <property name="text">
-      <string>Server Cycle </string>
+      <string>10000</string>
      </property>
     </widget>
    </item>
-   <item row="0" column="2">
-    <widget class="QSpinBox" name="SvrBuffSize">
-     <property name="suffix">
-      <string> bytes</string>
+   <item row="2" column="3" colspan="3">
+    <widget class="QLabel" name="Label7">
+     <property name="enabled">
+      <bool>true</bool>
      </property>
-     <property name="maximum">
-      <number>1000000</number>
+     <property name="toolTip">
+      <string/>
      </property>
-     <property name="value">
-      <number>16384</number>
+     <property name="text">
+      <string>Output Debug Trace</string>
      </property>
     </widget>
    </item>
-   <item row="15" column="2" colspan="5">
-    <widget class="QComboBox" name="RelayMsg">
+   <item row="2" column="6" colspan="2">
+    <widget class="QComboBox" name="TraceLevelS">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
      <item>
       <property name="text">
        <string>None</string>
@@ -225,68 +190,98 @@
      </item>
      <item>
       <property name="text">
-       <string>(1) -&gt; (0)</string>
+       <string>Level 1</string>
       </property>
      </item>
      <item>
       <property name="text">
-       <string>(2) -&gt; (0)</string>
+       <string>Level 2</string>
       </property>
      </item>
      <item>
       <property name="text">
-       <string>(3) -&gt; (0)</string>
+       <string>Level 3</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>Level 4</string>
+      </property>
+     </item>
+     <item>
+      <property name="text">
+       <string>Level 5</string>
       </property>
      </item>
     </widget>
    </item>
-   <item row="11" column="2">
-    <widget class="QDoubleSpinBox" name="AntPos1">
-     <property name="suffix">
-      <string>°</string>
+   <item row="3" column="0" colspan="2">
+    <widget class="QLabel" name="Label5">
+     <property name="enabled">
+      <bool>true</bool>
      </property>
-     <property name="decimals">
-      <number>8</number>
+     <property name="toolTip">
+      <string/>
      </property>
-     <property name="minimum">
-      <double>-90.000000000000000</double>
+     <property name="text">
+      <string>Reconnect Interval  (ms)</string>
      </property>
-     <property name="maximum">
-      <double>90.000000000000000</double>
+    </widget>
+   </item>
+   <item row="3" column="2">
+    <widget class="QLineEdit" name="ConnectInterval">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>2000</string>
      </property>
     </widget>
    </item>
-   <item row="4" column="2">
-    <widget class="QSpinBox" name="DataTimeout">
-     <property name="suffix">
-      <string> ms</string>
+   <item row="3" column="3" colspan="3">
+    <widget class="QCheckBox" name="NmeaReqT">
+     <property name="toolTip">
+      <string/>
      </property>
-     <property name="maximum">
-      <number>1000000</number>
+     <property name="text">
+      <string>NMEA Cycle (ms)</string>
      </property>
-     <property name="value">
-      <number>10000</number>
+     <property name="checked">
+      <bool>false</bool>
      </property>
     </widget>
    </item>
-   <item row="12" column="5" colspan="2">
-    <widget class="QDoubleSpinBox" name="AntOff3">
-     <property name="suffix">
-      <string> m</string>
+   <item row="3" column="6" colspan="2">
+    <widget class="QLineEdit" name="NmeaCycle">
+     <property name="enabled">
+      <bool>true</bool>
      </property>
-     <property name="decimals">
-      <number>4</number>
+     <property name="toolTip">
+      <string/>
      </property>
-     <property name="minimum">
-      <double>-1000.000000000000000</double>
+     <property name="text">
+      <string>0</string>
      </property>
-     <property name="maximum">
-      <double>1000.000000000000000</double>
+    </widget>
+   </item>
+   <item row="4" column="0">
+    <widget class="QCheckBox" name="StaInfoSel">
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>Station ID</string>
+     </property>
+     <property name="checked">
+      <bool>false</bool>
      </property>
     </widget>
    </item>
-   <item row="20" column="2" colspan="5">
-    <widget class="QLineEdit" name="LocalDir">
+   <item row="4" column="2">
+    <widget class="QLineEdit" name="StationId">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -294,67 +289,63 @@
       <string/>
      </property>
      <property name="text">
+      <string>1234</string>
+     </property>
+    </widget>
+   </item>
+   <item row="5" column="0">
+    <widget class="QLabel" name="Label8">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
       <string/>
      </property>
+     <property name="text">
+      <string>Lat/Lon/Height</string>
+     </property>
     </widget>
    </item>
-   <item row="4" column="6" colspan="2">
-    <widget class="QComboBox" name="TraceLevelS">
+   <item row="5" column="1" colspan="2">
+    <widget class="QLineEdit" name="AntPos1">
      <property name="enabled">
       <bool>true</bool>
      </property>
      <property name="toolTip">
       <string/>
      </property>
-     <item>
-      <property name="text">
-       <string>None</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>Level 1</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>Level 2</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>Level 3</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>Level 4</string>
-      </property>
-     </item>
-     <item>
-      <property name="text">
-       <string>Level 5</string>
-      </property>
-     </item>
+     <property name="text">
+      <string>000.000000000</string>
+     </property>
     </widget>
    </item>
-   <item row="11" column="5" colspan="2">
-    <widget class="QDoubleSpinBox" name="AntPos3">
-     <property name="suffix">
-      <string> m</string>
+   <item row="5" column="3" colspan="2">
+    <widget class="QLineEdit" name="AntPos2">
+     <property name="enabled">
+      <bool>true</bool>
      </property>
-     <property name="decimals">
-      <number>3</number>
+     <property name="toolTip">
+      <string/>
      </property>
-     <property name="minimum">
-      <double>-1000.000000000000000</double>
+     <property name="text">
+      <string>000.000000000</string>
      </property>
-     <property name="maximum">
-      <double>10000.000000000000000</double>
+    </widget>
+   </item>
+   <item row="5" column="5" colspan="2">
+    <widget class="QLineEdit" name="AntPos3">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
+     <property name="toolTip">
+      <string/>
+     </property>
+     <property name="text">
+      <string>0000.000</string>
      </property>
     </widget>
    </item>
-   <item row="11" column="7">
+   <item row="5" column="7">
     <widget class="QPushButton" name="BtnPos">
      <property name="enabled">
       <bool>true</bool>
@@ -407,8 +398,8 @@
      </property>
     </widget>
    </item>
-   <item row="11" column="0">
-    <widget class="QLabel" name="Label8">
+   <item row="6" column="0">
+    <widget class="QLabel" name="Label11">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -416,41 +407,25 @@
       <string/>
      </property>
      <property name="text">
-      <string>Lat/Lon/Height</string>
+      <string>Offset E/N/U (m)</string>
      </property>
     </widget>
    </item>
-   <item row="6" column="3" colspan="3">
-    <widget class="QCheckBox" name="NmeaReqT">
+   <item row="6" column="1" colspan="2">
+    <widget class="QLineEdit" name="AntOff1">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
      <property name="toolTip">
       <string/>
      </property>
      <property name="text">
-      <string>NMEA Cycle</string>
-     </property>
-     <property name="checked">
-      <bool>false</bool>
-     </property>
-    </widget>
-   </item>
-   <item row="11" column="3" colspan="2">
-    <widget class="QDoubleSpinBox" name="AntPos2">
-     <property name="suffix">
-      <string>°</string>
-     </property>
-     <property name="decimals">
-      <number>8</number>
-     </property>
-     <property name="minimum">
-      <double>-180.000000000000000</double>
-     </property>
-     <property name="maximum">
-      <double>180.000000000000000</double>
+      <string>0.000</string>
      </property>
     </widget>
    </item>
-   <item row="20" column="0">
-    <widget class="QLabel" name="Label4">
+   <item row="6" column="3" colspan="2">
+    <widget class="QLineEdit" name="AntOff2">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -458,25 +433,25 @@
       <string/>
      </property>
      <property name="text">
-      <string>FTP/HTTP Local Dir</string>
+      <string>0.000</string>
      </property>
     </widget>
    </item>
-   <item row="9" column="0">
-    <widget class="QCheckBox" name="StaInfoSel">
+   <item row="6" column="5" colspan="3">
+    <widget class="QLineEdit" name="AntOff3">
+     <property name="enabled">
+      <bool>true</bool>
+     </property>
      <property name="toolTip">
       <string/>
      </property>
      <property name="text">
-      <string>Station ID</string>
-     </property>
-     <property name="checked">
-      <bool>false</bool>
+      <string>0.000</string>
      </property>
     </widget>
    </item>
-   <item row="0" column="3" colspan="3">
-    <widget class="QLabel" name="Label6">
+   <item row="7" column="0">
+    <widget class="QLabel" name="Label12">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -484,12 +459,12 @@
       <string/>
      </property>
      <property name="text">
-      <string>Period of Rate</string>
+      <string>Antenna Info</string>
      </property>
     </widget>
    </item>
-   <item row="22" column="6">
-    <widget class="QPushButton" name="BtnOk">
+   <item row="7" column="1" colspan="7">
+    <widget class="QLineEdit" name="AntInfo">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -497,22 +472,12 @@
       <string/>
      </property>
      <property name="text">
-      <string>&amp;OK</string>
-     </property>
-     <property name="flat">
-      <bool>false</bool>
-     </property>
-    </widget>
-   </item>
-   <item row="15" column="0">
-    <widget class="QLabel" name="label_3">
-     <property name="text">
-      <string>Relay Messages</string>
+      <string>AntInfo</string>
      </property>
     </widget>
    </item>
-   <item row="14" column="2" colspan="6">
-    <widget class="QLineEdit" name="RcvInfo">
+   <item row="8" column="0">
+    <widget class="QLabel" name="Label13">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -520,12 +485,12 @@
       <string/>
      </property>
      <property name="text">
-      <string>ReceiverInfo</string>
+      <string>Receiver Info</string>
      </property>
     </widget>
    </item>
-   <item row="12" column="0">
-    <widget class="QLabel" name="Label11">
+   <item row="8" column="1" colspan="7">
+    <widget class="QLineEdit" name="RcvInfo">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -533,22 +498,12 @@
       <string/>
      </property>
      <property name="text">
-      <string>Offset E/N/U</string>
-     </property>
-    </widget>
-   </item>
-   <item row="9" column="2">
-    <widget class="QSpinBox" name="StationId">
-     <property name="maximum">
-      <number>100000</number>
-     </property>
-     <property name="value">
-      <number>1234</number>
+      <string>Edit1</string>
      </property>
     </widget>
    </item>
-   <item row="22" column="7">
-    <widget class="QPushButton" name="BtnCancel">
+   <item row="9" column="0">
+    <widget class="QLabel" name="Label4">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -556,84 +511,78 @@
       <string/>
      </property>
      <property name="text">
-      <string>&amp;Cancel</string>
-     </property>
-     <property name="flat">
-      <bool>false</bool>
-     </property>
-    </widget>
-   </item>
-   <item row="2" column="2">
-    <widget class="QSpinBox" name="SvrCycle">
-     <property name="suffix">
-      <string> ms</string>
-     </property>
-     <property name="maximum">
-      <number>10000</number>
-     </property>
-     <property name="value">
-      <number>100</number>
+      <string>FTP/HTTP Local Dir</string>
      </property>
     </widget>
    </item>
-   <item row="6" column="6" colspan="2">
-    <widget class="QSpinBox" name="NmeaCycle">
-     <property name="suffix">
-      <string> ms</string>
+   <item row="9" column="1" colspan="6">
+    <widget class="QLineEdit" name="LocalDir">
+     <property name="enabled">
+      <bool>true</bool>
      </property>
-     <property name="maximum">
-      <number>100000</number>
+     <property name="toolTip">
+      <string/>
      </property>
-    </widget>
-   </item>
-   <item row="18" column="0">
-    <widget class="QLabel" name="label">
      <property name="text">
-      <string>NTRIP Source Table</string>
-     </property>
-    </widget>
-   </item>
-   <item row="2" column="6" colspan="2">
-    <widget class="QSpinBox" name="FileSwapMarginE">
-     <property name="suffix">
-      <string> s</string>
-     </property>
-     <property name="minimum">
-      <number>0</number>
-     </property>
-     <property name="value">
-      <number>30</number>
-     </property>
-    </widget>
-   </item>
-   <item row="6" column="2">
-    <widget class="QSpinBox" name="ConnectInterval">
-     <property name="suffix">
-      <string> ms</string>
-     </property>
-     <property name="maximum">
-      <number>100000</number>
-     </property>
-     <property name="value">
-      <number>2000</number>
+      <string/>
      </property>
     </widget>
    </item>
-   <item row="0" column="0">
-    <widget class="QLabel" name="Label1">
+   <item row="9" column="7">
+    <widget class="QPushButton" name="BtnLocalDir">
      <property name="enabled">
       <bool>true</bool>
      </property>
+     <property name="palette">
+      <palette>
+       <active>
+        <colorrole role="WindowText">
+         <brush brushstyle="SolidPattern">
+          <color alpha="255">
+           <red>0</red>
+           <green>0</green>
+           <blue>0</blue>
+          </color>
+         </brush>
+        </colorrole>
+       </active>
+       <inactive>
+        <colorrole role="WindowText">
+         <brush brushstyle="SolidPattern">
+          <color alpha="255">
+           <red>0</red>
+           <green>0</green>
+           <blue>0</blue>
+          </color>
+         </brush>
+        </colorrole>
+       </inactive>
+       <disabled>
+        <colorrole role="WindowText">
+         <brush brushstyle="SolidPattern">
+          <color alpha="255">
+           <red>0</red>
+           <green>0</green>
+           <blue>0</blue>
+          </color>
+         </brush>
+        </colorrole>
+       </disabled>
+      </palette>
+     </property>
      <property name="toolTip">
       <string/>
      </property>
      <property name="text">
-      <string>Buffer Size</string>
+      <string>...</string>
+     </property>
+     <property name="flat">
+      <bool>false</bool>
      </property>
     </widget>
    </item>
-   <item row="6" column="0">
-    <widget class="QLabel" name="Label5">
+   <item row="10" column="0">
+    <widget class="QLabel" name="Label10">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -641,11 +590,11 @@
       <string/>
      </property>
      <property name="text">
-      <string>Reconnect Interval</string>
+      <string>HTTP/NTRIP Proxy</string>
      </property>
     </widget>
    </item>
-   <item row="21" column="2" colspan="6">
+   <item row="10" column="1" colspan="7">
     <widget class="QLineEdit" name="ProxyAddr">
      <property name="enabled">
       <bool>true</bool>
@@ -658,21 +607,8 @@
      </property>
     </widget>
    </item>
-   <item row="0" column="6" colspan="2">
-    <widget class="QSpinBox" name="AvePeriodRate">
-     <property name="suffix">
-      <string> ms</string>
-     </property>
-     <property name="maximum">
-      <number>1000000</number>
-     </property>
-     <property name="value">
-      <number>1000</number>
-     </property>
-    </widget>
-   </item>
-   <item row="13" column="2" colspan="6">
-    <widget class="QLineEdit" name="AntInfo">
+   <item row="11" column="2" colspan="2">
+    <widget class="QPushButton" name="BtnOk">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -680,28 +616,15 @@
       <string/>
      </property>
      <property name="text">
-      <string>AntInfo</string>
-     </property>
-    </widget>
-   </item>
-   <item row="12" column="3" colspan="2">
-    <widget class="QDoubleSpinBox" name="AntOff2">
-     <property name="suffix">
-      <string> m</string>
-     </property>
-     <property name="decimals">
-      <number>4</number>
-     </property>
-     <property name="minimum">
-      <double>-1000.000000000000000</double>
+      <string>&amp;OK</string>
      </property>
-     <property name="maximum">
-      <double>1000.000000000000000</double>
+     <property name="flat">
+      <bool>false</bool>
      </property>
     </widget>
    </item>
-   <item row="4" column="0">
-    <widget class="QLabel" name="Label3">
+   <item row="11" column="4" colspan="4">
+    <widget class="QPushButton" name="BtnCancel">
      <property name="enabled">
       <bool>true</bool>
      </property>
@@ -709,65 +632,15 @@
       <string/>
      </property>
      <property name="text">
-      <string>Inactive Timeout</string>
-     </property>
-    </widget>
-   </item>
-   <item row="16" column="0">
-    <widget class="QLabel" name="label_4">
-     <property name="text">
-      <string>Progress Bar Range</string>
-     </property>
-    </widget>
-   </item>
-   <item row="16" column="2" colspan="5">
-    <widget class="QSpinBox" name="ProgBarR">
-     <property name="suffix">
-      <string> kb</string>
-     </property>
-     <property name="maximum">
-      <number>100000</number>
+      <string>&amp;Cancel</string>
      </property>
-     <property name="value">
-      <number>2000</number>
+     <property name="flat">
+      <bool>false</bool>
      </property>
     </widget>
    </item>
   </layout>
  </widget>
- <tabstops>
-  <tabstop>BtnOk</tabstop>
-  <tabstop>BtnCancel</tabstop>
-  <tabstop>SvrBuffSize</tabstop>
-  <tabstop>AvePeriodRate</tabstop>
-  <tabstop>SvrCycle</tabstop>
-  <tabstop>FileSwapMarginE</tabstop>
-  <tabstop>DataTimeout</tabstop>
-  <tabstop>TraceLevelS</tabstop>
-  <tabstop>ConnectInterval</tabstop>
-  <tabstop>NmeaReqT</tabstop>
-  <tabstop>NmeaCycle</tabstop>
-  <tabstop>StaInfoSel</tabstop>
-  <tabstop>StationId</tabstop>
-  <tabstop>AntPos1</tabstop>
-  <tabstop>AntPos2</tabstop>
-  <tabstop>AntPos3</tabstop>
-  <tabstop>BtnPos</tabstop>
-  <tabstop>AntOff1</tabstop>
-  <tabstop>AntOff2</tabstop>
-  <tabstop>AntOff3</tabstop>
-  <tabstop>AntInfo</tabstop>
-  <tabstop>RcvInfo</tabstop>
-  <tabstop>RelayMsg</tabstop>
-  <tabstop>ProgBarR</tabstop>
-  <tabstop>LogFileF</tabstop>
-  <tabstop>BtnLogFile</tabstop>
-  <tabstop>SrcTblFileF</tabstop>
-  <tabstop>BtnSrcTblFile</tabstop>
-  <tabstop>LocalDir</tabstop>
-  <tabstop>BtnLocalDir</tabstop>
-  <tabstop>ProxyAddr</tabstop>
- </tabstops>
  <resources/>
  <connections/>
 </ui>
diff -uNdr RTKLIB-rtklib_2.4.3_orig/bin/.gitignore RTKLIB-rtklib_2.4.3_new/bin/.gitignore
--- RTKLIB-rtklib_2.4.3_orig/bin/.gitignore	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/bin/.gitignore	1970-01-01 03:00:00.000000000 +0300
@@ -1,3 +0,0 @@
-*.trace
-gmon*
-.listing
\ В конце файла нет новой строки
diff -uNdr RTKLIB-rtklib_2.4.3_orig/data/URL_LIST.txt RTKLIB-rtklib_2.4.3_new/data/URL_LIST.txt
--- RTKLIB-rtklib_2.4.3_orig/data/URL_LIST.txt	2020-07-01 19:52:10.489803691 +0300
+++ RTKLIB-rtklib_2.4.3_new/data/URL_LIST.txt	2019-08-19 02:04:50.000000000 +0300
@@ -115,7 +115,7 @@
 
 #! DATA (CDDIS)
 IGS_OBS        ftp://cddis.gsfc.nasa.gov/gps/data/daily/%Y/%n/%yd/%s%n0.%yd.Z   c:\GNSS_DATA\data\%Y\%n
-IGS_NAV        ftp://cddis.gsfc.nasa.gov/gps/data/daily/%Y/%n/%yn/brdc%n0.%yn.Z /home/vascom/rtk/data/%Y/%n
+IGS_NAV        ftp://cddis.gsfc.nasa.gov/gps/data/daily/%Y/%n/%yn/brdc%n0.%yn.Z c:\GNSS_DATA\data\%Y\%n
 IGS_NAV_GLO    ftp://cddis.gsfc.nasa.gov/gps/data/daily/%Y/%n/%yg/brdc%n0.%yg.Z c:\GNSS_DATA\data\%Y\%n
 IGS_NAV_S      ftp://cddis.gsfc.nasa.gov/gps/data/daily/%Y/%n/%yn/%s%n0.%yn.Z   c:\GNSS_DATA\data\%Y\%n
 IGS_NAV_S_GLO  ftp://cddis.gsfc.nasa.gov/gps/data/daily/%Y/%n/%yg/%s%n0.%yg.Z   c:\GNSS_DATA\data\%Y\%n
diff -uNdr RTKLIB-rtklib_2.4.3_orig/.gitignore RTKLIB-rtklib_2.4.3_new/.gitignore
--- RTKLIB-rtklib_2.4.3_orig/.gitignore	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/.gitignore	2019-08-19 02:04:50.000000000 +0300
@@ -6,5 +6,3 @@
 Release_Build
 Debug_Build
 __history
-Makefile
-*.pro.user
diff -uNdr RTKLIB-rtklib_2.4.3_orig/lib/.gitignore RTKLIB-rtklib_2.4.3_new/lib/.gitignore
--- RTKLIB-rtklib_2.4.3_orig/lib/.gitignore	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/lib/.gitignore	1970-01-01 03:00:00.000000000 +0300
@@ -1,5 +0,0 @@
-*.so
-*.so.*
-Makefile*
-*.a
-object_script*
\ В конце файла нет новой строки
diff -uNdr RTKLIB-rtklib_2.4.3_orig/lib/iers/.gitignore RTKLIB-rtklib_2.4.3_new/lib/iers/.gitignore
--- RTKLIB-rtklib_2.4.3_orig/lib/iers/.gitignore	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/lib/iers/.gitignore	1970-01-01 03:00:00.000000000 +0300
@@ -1,3 +0,0 @@
-*.a
-*.so
-*.so.*
diff -uNdr RTKLIB-rtklib_2.4.3_orig/lib/iers/iers.pro RTKLIB-rtklib_2.4.3_new/lib/iers/iers.pro
--- RTKLIB-rtklib_2.4.3_orig/lib/iers/iers.pro	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/lib/iers/iers.pro	1970-01-01 03:00:00.000000000 +0300
@@ -1,51 +0,0 @@
-#-------------------------------------------------
-#
-# Project created by QtCreator 2016-02-09T08:58:44
-#
-#-------------------------------------------------
-
-QT       -= core gui
-
-TARGET = iers
-TEMPLATE = lib
-
-include(../../RTKLib.pri)
-
-FORTRAN_FLAGS += -O3 -ffixed-line-length-132
-
-CONFIG += staticlib
-
-gfortran.commands = gfortran $${FORTRAN_FLAGS} ${QMAKE_FILE_NAME} -c -o ${QMAKE_FILE_OUT}
-gfortran.input = FORTRAN_SOURCE
-gfortran.output = /${QMAKE_FILE_BASE}.o
-gfortran.CONFIG = target_predeps
-
-# the only change required I guess
-gfortran.variable_out = FORTRAN_OBJ
-
-QMAKE_EXTRA_COMPILERS += gfortran 
-
-archive.commands = ar -qsc ${QMAKE_FILE_OUT} $${FORTRAN_OBJ}
-archive.input = FORTRAN_OBJ
-# I suggest to use $$OUT_PWD here
-archive.output = libiers.a
-archive.CONFIG = combine target_predeps
-QMAKE_EXTRA_COMPILERS += archive
-
-SOURCES += src/cal2jd.f\
-	   src/dat.f \
-	   src/dehanttideinel.f \
-	   src/gmf.f \
-	   src/gpt.f \
-	   src/norm8.f \ 
-	   src/sprod.f \
-	   src/st1idiu.f \
-           src/st1isem.f \
-	   src/st1l1.f \
-	   src/step2diu.f \
-	   src/step2lon.f \
-	   src/vmf1.f \
-	   src/vmf1_ht.f \
-	   src/zero_vec8.f
-
-DESTDIR = ..
\ В конце файла нет новой строки
diff -uNdr RTKLIB-rtklib_2.4.3_orig/lib/lib.pro RTKLIB-rtklib_2.4.3_new/lib/lib.pro
--- RTKLIB-rtklib_2.4.3_orig/lib/lib.pro	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/lib/lib.pro	1970-01-01 03:00:00.000000000 +0300
@@ -1,3 +0,0 @@
-TEMPLATE = subdirs
-
-SUBDIRS= iers 
diff -uNdr RTKLIB-rtklib_2.4.3_orig/RTKLib.pri RTKLIB-rtklib_2.4.3_new/RTKLib.pri
--- RTKLIB-rtklib_2.4.3_orig/RTKLib.pri	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/RTKLib.pri	2019-08-19 02:04:50.000000000 +0300
@@ -1,5 +1,6 @@
-DEFINES += _RTLDLL NO_STRICT TRACE ENAGLO ENAQZS ENAGAL ENACMP ENAIRN NFREQ=3 NEXOBS=3 EXTLEX SVR_REUSEADDR #IERS_MODEL
+
+DEFINES += _RTLDLL NO_STRICT TRACE ENAGLO ENAQZS ENAGAL ENACMP ENAIRN NFREQ=3 NEXOBS=3 EXTLEX
 
 win32{
-  DEFINES += WIN32
+DEFINES += WIN32
 }
diff -uNdr RTKLIB-rtklib_2.4.3_orig/RTKLib.pro RTKLIB-rtklib_2.4.3_new/RTKLib.pro
--- RTKLIB-rtklib_2.4.3_orig/RTKLib.pro	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/RTKLib.pro	2019-08-19 02:04:50.000000000 +0300
@@ -2,10 +2,3 @@
 
 SUBDIRS= src \
 	 app
-
-app.depends = src
-
-IERS_MODEL {
-    SUBDIRS += lib
-    app.depend = lib
-}
diff -uNdr RTKLIB-rtklib_2.4.3_orig/src/.gitignore RTKLIB-rtklib_2.4.3_new/src/.gitignore
--- RTKLIB-rtklib_2.4.3_orig/src/.gitignore	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/src/.gitignore	1970-01-01 03:00:00.000000000 +0300
@@ -1,3 +0,0 @@
-libRTKLib.a
-Makefile*
-object_script*
\ В конце файла нет новой строки
diff -uNdr RTKLIB-rtklib_2.4.3_orig/src/rcv/septentrio.c RTKLIB-rtklib_2.4.3_new/src/rcv/septentrio.c
--- RTKLIB-rtklib_2.4.3_orig/src/rcv/septentrio.c	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/src/rcv/septentrio.c	2019-08-19 02:04:50.000000000 +0300
@@ -45,7 +45,7 @@
 extern const sbsigpband_t igpband1[][8]; /* SBAS IGP band 0-8 */
 extern const sbsigpband_t igpband2[][5]; /* SBAS IGP band 9-10 */
 
-static uint16_t locktime[255][32];
+static unsigned char locktime[255][32];
 
 /* SBF definitions Version 2.9.1 */
 #define SBF_SYNC1   0x24        /* SBF message header sync field 1 (correspond to $) */
@@ -127,9 +127,9 @@
 #define ID_BBSMPS         4040  /* SBF message id: series of successive Rx baseband samples */
 
 /* function prototypes -------------------------------------------------------*/
-static uint8_t getSignalCode(int signType);
+static int getSignalCode(int signType);
 static double getSigFreq(int _signType, int freqNo);
-static int16_t getFreqNo(int signType);
+static int getFreqNo(int signType);
 
 /* get fields (little-endian) ------------------------------------------------*/
 #define U1(p) (*((unsigned char *)(p)))
@@ -142,7 +142,7 @@
 static short          I2(unsigned char *p) {short          i; memcpy(&i,p,2); return i;}
 
 /* checksum lookup table -----------------------------------------------------*/
-static const unsigned short CRC_16CCIT_LookUp[256] = {
+static const unsigned int CRC_16CCIT_LookUp[256] = {
   0x0000, 0x1021, 0x2042, 0x3063, 0x4084, 0x50a5, 0x60c6, 0x70e7,
   0x8108, 0x9129, 0xa14a, 0xb16b, 0xc18c, 0xd1ad, 0xe1ce, 0xf1ef,
   0x1231, 0x0210, 0x3273, 0x2252, 0x52b5, 0x4294, 0x72f7, 0x62d6,
@@ -229,14 +229,12 @@
     gtime_t time;
     double tow,psr, adr, dopplerType1;
     double SNR_DBHZ, SNR2_DBHZ, freqType1, freqType2, alpha;
-    int16_t i,ii,j,n=0,nsat, h;
-    uint16_t week, prn;
+    int16_t i,ii,j,prn,sat,n=0,nsat,week, code, h;
     uint8_t *p=(raw->buff)+8;                   /* jump to TOW location */
-    uint8_t SB1length,SB2length;
-    int sat, sys;
-    uint8_t signType1, signType2, satID;
-    uint32_t codeLSB, SB2Num;
-    uint8_t codeMSB, CommonFlags, code;
+    int SB1length,SB2length;
+    uint8_t signType1, signType2;
+    uint32_t codeLSB, SB2Num, sys;
+    uint8_t codeMSB, CommonFlags;
     int pri;
 
     /* signals for type2 sub-block */
@@ -274,10 +272,6 @@
 
     if ((CommonFlags & 0x80)==0x80) return 0;         /* data is ccrambled and not valid */
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF Range Measurements for Satellites: ");
-    }
-
     /* set the pointer from TOW to the beginning of type1 sub-block */
     p = p + 12;
 
@@ -290,10 +284,6 @@
         codeMSB = (U1(p+3) & 0x0f);               /* code phase MSB. bit[0-3] */
         codeLSB = U4(p+4);                        /* code phase LSB           */
 
-        if (raw->outtype) {
-            sprintf(raw->msgtype + strlen(raw->msgtype),"%d, ", prn);
-        }
-
         /* code pseudorange in m */
         psr = (codeMSB*4294967296.0+codeLSB)*0.001;
 
@@ -368,15 +358,15 @@
             sat = 0;}
 
         /* store satellite number */
-        satID = satno(sys, sat);
-        if (satID == 0)
+        sat = satno(sys, sat);
+        if (sat == 0)
         {
             p = p + SB1length; /* skip data */
             p = p + SB2length*SB2Num;
             continue;
-        }
+        };
 
-        raw->obs.data[n].sat=satID;
+        raw->obs.data[n].sat=sat;
 
         /* start new observation period */
         if (fabs(timediff(raw->obs.data[0].time,raw->time))>1E-9) {
@@ -416,13 +406,13 @@
             raw->obs.data[n].code[h] = code;
 
             /* lock to signal indication */
-            if ((ObsInfo&0x4)==0x4) raw->obs.data[n].LLI[h]|=LLI_HALFC; /* half-cycle ambiguity */
+            if ((ObsInfo&0x4)==0x4) raw->obs.data[n].LLI[h]|=0x2; /* half-cycle ambiguity */
             if (LockTime!=65535){
                 LockTime = LockTime>254?254:LockTime; /* limit locktime to sizeof(unsigned char) */
-                if (locktime[sat][signType1]>LockTime) raw->obs.data[n].LLI[h]|=LLI_SLIP;
+                if (locktime[sat][signType1]>LockTime) raw->obs.data[n].LLI[h]|=0x1;
                 raw->lockt[sat][h]       = (unsigned char)LockTime;
                 locktime[sat][signType1] = LockTime;
-            }
+            };
         }
 
         /* decode all Type2 sub-blocks (if there is any) */
@@ -498,12 +488,12 @@
                 raw->obs.data[n].code[h] = getSignalCode(signType2);
 
                 /* lock to signal indication */
-                if ((ObsInfo2&0x4)==0x4) raw->obs.data[n].LLI[h]|=LLI_HALFC; /* half-cycle ambiguity */
+                if ((ObsInfo2&0x4)==0x4) raw->obs.data[n].LLI[h]|=0x2; /* half-cycle ambiguity */
                 if (LockTime2!=255) {
-                    if (locktime[sat][signType2]>LockTime2) raw->obs.data[n].LLI[h]|=LLI_SLIP;
+                    if (locktime[sat][signType2]>LockTime2) raw->obs.data[n].LLI[h]|=0x1;
                     raw->lockt[sat][h]       = (unsigned char)LockTime2;
                     locktime[sat][signType2] = (unsigned char)LockTime2;
-                }
+                };
             }
 
             /* get to the beginning of next Type 2 block */
@@ -546,11 +536,15 @@
     case 11:                                                       /* GLOL2CA */
         return FREQ2_GLO+(freqNo*7./16.)*1e6;
     case 12:                                                       /* GLOL3X  */
-        return FREQ3_GLO;
+        return 1.202025*1e9;
     case 15:                                                       /* IRNSSL5  */
         return FREQ5;
+    case 16:                                                       /* GALL1A  */
+        return FREQ1;
     case 17:                                                       /* GALL1BC */
         return FREQ1;
+    case 18:                                                       /* GALE6A  */
+        return FREQ6;
     case 19:                                                       /* GALE6BC */
         return FREQ6;
     case 20:                                                       /* GALE5a  */
@@ -575,9 +569,24 @@
     return FREQ1;
 }
 
+#if 0 /* UNUSED */
+
+/* adjust weekly rollover of gps time ----------------------------------------*/
+static gtime_t adjweek(gtime_t time, double tow)
+{
+    double tow_p;
+    int week;
+    tow_p=time2gpst(time,&week);
+    if      (tow<tow_p-302400.0) tow+=604800.0;
+    else if (tow>tow_p+302400.0) tow-=604800.0;
+    return gpst2time(week,tow);
+}
+
+#endif /* UNUSED */
+
 /* return the Septentrio signal type -----------------------------------------*/
-static uint8_t getSignalCode(int signType){
-    uint8_t _code;
+static int getSignalCode(int signType){
+    int _code=-1;
 
     switch (signType)
     {
@@ -620,9 +629,15 @@
     case 15:                                                       /* IRNSSL5  */
         _code=CODE_L5A;
         break;
+    case 16:                                                       /* GALE1A  */
+        _code=CODE_L1A;
+        break;
     case 17:                                                       /* GALE1BC */
         _code=CODE_L1C;
         break;
+    case 18:                                                       /* GALE6A  */
+        _code=CODE_L6A;
+        break;
     case 19:                                                       /* GALE6BC */
         _code=CODE_L6C;
         break;
@@ -660,8 +675,8 @@
     return _code;
 }
 /* return the signal type -----------------------------------------*/
-static int16_t getFreqNo(int signType){
-    int16_t _freq;
+static int getFreqNo(int signType){
+    int _freq;
 
     switch (signType)
     {
@@ -669,13 +684,13 @@
         _freq=0;
         break;
     case 1:                                                        /* GPSL1PY */
-        _freq=NEXOBS<1?-1:NFREQ;
+        _freq=0;
         break;
     case 2:                                                        /* GPSL2PY */
         _freq=1;
         break;
     case 3:                                                        /* GPSL2C  */
-        _freq=NEXOBS<2?-1:NFREQ+1;
+        _freq=1;
         break;
     case 4:                                                        /* GPSL5   */
         _freq=2;
@@ -690,13 +705,13 @@
         _freq=0;
         break;
     case 9:                                                        /* GLOL1P  */
-        _freq=NEXOBS<1?-1:NFREQ;
+        _freq=0;
         break;
     case 10:                                                       /* GLOL2P  */
         _freq=1;
         break;
     case 11:                                                       /* GLOL2CA */
-        _freq=NEXOBS<2?-1:NFREQ+1;
+        _freq=2;
         break;
     case 12:                                                       /* GLOL3 */
         _freq=3;
@@ -815,10 +830,6 @@
     eph.toc=gpst2time(eph.week,toc);
     eph.ttr=raw->time;
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF GPS Decoded Navigation Data (PRN=%d, IODE=%d, IODC=%d, TOES=%6.0f )", prn, eph.iode, eph.iodc, eph.toes);
-    }
-
     if (!strstr(raw->opt,"-EPHALL")) {
         if ((eph.iode==raw->nav.eph[sat-1].iode) &&
             (eph.iodc==raw->nav.eph[sat-1].iodc)) return 0;
@@ -858,7 +869,7 @@
 
     tow        = U4(puiTmp +  2);
     eph.week   = U2(puiTmp +  6); /* GAL week number */
-    eph.code   = U1(puiTmp +  9); /* 2:INAV,16:FNAV */
+    eph.code   = U1(puiTmp +  9)==2?0:1; /* 0:INAV,1:FNAV */
     eph.A      = pow(R8(puiTmp +  10), 2);
     eph.M0     = R8(puiTmp +  18) * PI;
     eph.e      = R8(puiTmp +  26);
@@ -881,9 +892,9 @@
     eph.f0     = R8(puiTmp + 110);
     week_oe    = U2(puiTmp + 118); /* WNt_oc */
     week_oc    = U2(puiTmp + 120);
-    eph.iode   = U2(puiTmp + 122);
-    eph.iodc   = 0;
-    if (eph.code==2) /* INAV */
+    eph.iode   =
+    eph.iodc   = U2(puiTmp + 122);
+    if (eph.code==0) /* INAV */
     {
         eph.sva    = U1(puiTmp + 128);
         eph.svh    = (U2(puiTmp + 124)& 0x00ff)^0x0011;
@@ -902,10 +913,6 @@
     eph.toc=gpst2time(week_oc,toc);
     eph.ttr=gpst2time(eph.week,tow/1000);
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF Galileo Decoded Navigation Data (PRN=%d, IODE=%d, IODC=%d, TOES=%6.0f )", prn, eph.iode, eph.iodc, eph.toes);
-    }
-
     if (!strstr(raw->opt,"-EPHALL")) {
         if (eph.iode==raw->nav.eph[sat-1].iode) return 0;
     }
@@ -965,10 +972,6 @@
     eph.iode   = U2(puiTmp +  80);
     eph.sva    = U2(puiTmp +  88);
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF GLONASS Decoded Navigation Data (PRN=%d, Frequency Number=%d IODE=%d, AGE=%d )", prn, eph.frq, eph.iode, eph.age);
-    }
-
     if (!strstr(raw->opt,"-EPHALL")) {
         if (eph.iode==raw->nav.geph[prn-1].iode) return 0;
     }
@@ -1027,10 +1030,6 @@
     /* debug */
     trace(2,"sat=%2d, week=%d, tow=%f\n",sat,week,U4(puiTmp +  2)/1000);
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF SBAS Decoded Navigation Data (PRN=%d, TOW=%d, SVA=%d )", prn, tow, eph.sva);
-    }
-
     if (!strstr(raw->opt,"-EPHALL")) {
         if (fabs(timediff(eph.t0,raw->nav.seph[prn-120].t0))<1.0&&
             eph.sva==raw->nav.seph[prn-120].sva)
@@ -1107,10 +1106,6 @@
     eph.toc=bdt2time(eph.week,toc);
     eph.ttr=raw->time;
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF Compass Decoded Navigation Data (PRN=%d, IODE=%d, IODC=%d, TOES=%6.0f )", prn, eph.iode, eph.iodc, eph.toes);
-    }
-
     if (!strstr(raw->opt,"-EPHALL")) {
         if (eph.iode==raw->nav.eph[sat-1].iode) return 0;
     }
@@ -1184,10 +1179,6 @@
     eph.toc=gpst2time(eph.week,toc);
     eph.ttr=raw->time;
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF QZSS Decoded Navigation Data (PRN=%d, IODE=%d, IODC=%d, TOES=%6.0f )", prn, eph.iode, eph.iodc, eph.toes);
-    }
-
     if (!strstr(raw->opt,"-EPHALL")) {
         if (eph.iode==raw->nav.eph[sat-1].iode) return 0;
     }
@@ -1230,13 +1221,6 @@
     sat=satno(sys,prn);
     if (sat == 0) return -1;
 
-    if (raw->outtype) {
-        if (sys==SYS_GPS)
-            sprintf(raw->msgtype,"SBF GPS Raw Navigation Data (PRN=%d)", prn);
-        if (sys==SYS_QZS)
-            sprintf(raw->msgtype,"SBF QZSS Raw Navigation Data (PRN=%d)", prn);
-    }
-
     /* clean up subframe from Septentrio. This is a little bit of work because
      * Septentrio Rx add some parity bits to this message.
      * We have to throw away the reserved bits as well as the parity bits.
@@ -1325,10 +1309,6 @@
     /* get GPS satellite number */
     prn=U1(p+8);
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF SBAS Raw Navigation Data (PRN=%d)", prn);
-    }
-
     /* copy data */
     for (i=0;i<8;i++)
     {
@@ -1378,10 +1358,6 @@
         return -1;
     }
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF Galileo INAV Raw Data (PRN=%d)", prn);
-    }
-
     /* copy data */
     for (i=0;i<8;i++)
     {
@@ -1470,6 +1446,15 @@
         return -1;
     }
 
+    r=p+14;
+    k=0;
+    for (j=0;j<3;j++) {
+        uint32_t d = U4(r+j*4);
+        buff[k++]=(d>>24)&0xff;
+        buff[k++]=(d>>16)&0xff;
+        buff[k++]=(d>> 8)&0xff;
+        buff[k++]=(d>> 0)&0xff;
+    }
     /* get Glonass satellite number */
     prn=U1(p+8)-37;
     if (prn == 0) return -1;
@@ -1478,25 +1463,11 @@
     sat=satno(SYS_GLO,prn);
     if (sat == 0) return -1;
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF Galileo CNAV Raw Data (PRN=%d)", prn);
-    }
-
     if (raw->len<32) {
         trace(2,"SBF decode_gpsrawcanav block length error: len=%d\n",raw->len);
         return -1;
     }
 
-    r=p+14;
-    k=0;
-    for (j=0;j<3;j++) {
-        uint32_t d = U4(r+j*4);
-        buff[k++]=(d>>24)&0xff;
-        buff[k++]=(d>>16)&0xff;
-        buff[k++]=(d>> 8)&0xff;
-        buff[k++]=(d>> 0)&0xff;
-    }
-
     /* test hamming of glonass string */
     if (!test_glostr(buff)) {
         trace(2,"septentrio glo string hamming error: sat=%2d\n",sat);
@@ -1523,7 +1494,7 @@
 
     raw->nav.geph[prn-1]=geph;
     raw->ephsat=sat;
-    raw->nav.glo_fcn[prn-1] = geph.frq + 8; /* save frequency number */
+    raw->nav.glo_fcn[prn-1] = geph.frq + 8; /* savbe frequency number */
 
     return 2;
 }
@@ -1546,17 +1517,12 @@
     if (raw->len<60) {
         trace(2,"SBF decode_cmprawinav length error: sat=%d len=%d\n",sat,raw->len);
         return -1;
-    }    
+    }
 
     if (U1(p+9)!=1) /* CRC test failed */
     {
         return -1;
     }
-
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF Galileo Compass Raw Navigation Data (PRN=%d)", prn);
-    }
-
     for (i=0;i<10;i++) words[i]=U4(p+12+i*4)&0x3FFFFFFF; /* 30 bits */
 
     satsys(sat,&prn);
@@ -1622,10 +1588,6 @@
     raw->nav.utc_glo[2] = R4(p + 28);                                 /*  B2 */
     raw->nav.utc_glo[3] = R4(p + 12);                                 /*  tau_GPS */
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF GLONASS UTC Offsets");
-    }
-
     return 9;
 }
 /* decode SBF gpsion --------------------------------------------------------*/
@@ -1649,10 +1611,6 @@
     raw->nav.ion_gps[6] = R4(p + 32);
     raw->nav.ion_gps[7] = R4(p + 36);
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF GPS Ionospheric Data");
-    }
-
     return 9;
 }
 /* decode SBF galion --------------------------------------------------------*/
@@ -1672,10 +1630,6 @@
     raw->nav.ion_gal[2] = R4(p + 18);
     raw->nav.ion_gal[3] = 0;
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF Galileon Ionospheric Data");
-    }
-
     return 9;
 }
 
@@ -1704,11 +1658,6 @@
             in fact if I take U1(p+24) I do not seem to ge the correct W in
             the header of RINEX nav file, line DELTA-UTC: A0,A1,T,W
     */
-
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF GPS UTC Offsets");
-    }
-
     return 9;
 }
 /* decode SBF gpsalm --------------------------------------------------------*/
@@ -1745,10 +1694,6 @@
 
     raw->nav.alm[alm.sat-1]=alm;
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF GPS Almanach (PRN=%d)", U1(p + 6));
-    }
-
     return 9;
 }
 /* decode SBF galutc --------------------------------------------------------*/
@@ -1775,11 +1720,6 @@
             in fact if I take U1(p+24) I do not seem to ge the correct W in
             the header of RINEX nav file, line DELTA-UTC: A0,A1,T,W
     */
-
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF Galileo UTC Offsets");
-    }
-
     return 9;
 }
 /* decode SBF galalm --------------------------------------------------------*/
@@ -1796,7 +1736,7 @@
         return -1;
     }
 
-    alm.sat =   satno(SYS_GAL,U1(p + 49) - 70);
+    alm.sat =   satno(SYS_GAL,U1(p + 49)-70);
     alm.e     = R4(p + 8);
     alm.toas  = U4(p + 12);
     alm.i0    = R4(p + 16) + 0.3;
@@ -1815,10 +1755,6 @@
     if (alm.sat == 0) return -1;
     raw->nav.alm[alm.sat-1]=alm;
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF Galileon Almanach (PRN=%d)", U1(p + 49) - 70);
-    }
-
     return 9;
 }
 
@@ -1852,10 +1788,6 @@
     sat=satno(SYS_SBS,prn);
     if (sat == 0) return -1;
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF SBAS Ionosphere Fast Correction from PRN=%d", prn);
-    }
-
     tow=U4(p+2)/1000;
     week=U2(p+6);
     week=adjgpsweek(week);
@@ -1914,10 +1846,6 @@
 
     raw->nav.sbssat.nsat=U1(p+10);
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF SBAS PRN Mask from PRN=%d", prn);
-    }
-
     for (n=0;n<raw->nav.sbssat.nsat&&n<MAXSAT;n++) {
        i=U1(p+11+n);
        if      (i<= 37) sat=satno(SYS_GPS,i);    /*   0- 37: gps */
@@ -1957,10 +1885,6 @@
     if (prn < 120) return -1;
     if (prn > 139) return -1;
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF SABS Integrity Data from PRN=%d", prn);
-    }
-
     for (i=0;i<4;i++) {
         iodf[i]=U1(p+10+i);
     }
@@ -1993,10 +1917,6 @@
     if (prn < 120) return -1;
     if (prn > 139) return -1;
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF SBAS Fast Correction Degradation Factor from PRN=%d", prn);
-    }
-
     if (raw->nav.sbssat.iodp!=U1(p+9)) return 0;
 
     raw->nav.sbssat.tlat=U1(p+10);
@@ -2029,10 +1949,6 @@
     if (prn < 120) return -1;
     if (prn > 139) return -1;
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype,"SBF SBAS Ionospheric Delay Correction from PRN=%d", prn);
-    }
-
     band=U1(p+9);
 
     if (band>MAXBAND||raw->nav.sbsion[band].iodi!=U1(p+10)) return 0;
@@ -2088,10 +2004,6 @@
     if (prn < 120) return -1;
     if (prn > 139) return -1;
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype, "SBF SBAS Ionospheric Grid Points from PRN=%d", prn);
-    }
-
     band=U1(p+10);
 
     if      (band<= 8) {b=igpband1[band  ]; m=8;}
@@ -2138,10 +2050,6 @@
     if (prn < 120) return -1;
     if (prn > 139) return -1;
 
-    if (raw->outtype) {
-        sprintf(raw->msgtype, "SBF SBAS Long Term Corrections from PRN=%d", prn);
-    }
-
     tow=U4(p+2)/1000;
     week=U2(p+6);
     week=adjgpsweek(week);
@@ -2204,18 +2112,12 @@
         return -1;
     }
 
+    if (raw->outtype) {
+        sprintf(raw->msgtype,"SBF 0x%04X (%4d):",type, raw->len);
+    }
+
     switch (type) {
         case ID_MEASEPOCH:      return decode_measepoch(raw);
-        case ID_MEASEPOCHEXTRA:
-            if (raw->outtype) {
-                sprintf(raw->msgtype, "SBF Measurement Data Extra");
-            }
-            return 0;
-        case ID_MEASEPOCH_END:
-            if (raw->outtype) {
-                sprintf(raw->msgtype, "SBF Measurement Epoch End");
-            }
-            return 0;
 
         case ID_GPSNAV:         return decode_gpsnav(raw);
         case ID_GPSION:         return decode_gpsion(raw);
@@ -2257,7 +2159,7 @@
 #endif
 #endif
 
-#if 0 /* not yet supported by RTKLIB */
+#if 0 /* UNUSED */
         case ID_GEOMT00:        return decode_sbsfast(raw);
         case ID_GEOPRNMASK:     return decode_sbsprnmask(raw);
         case ID_GEOFASTCORR:    return decode_sbsfast(raw);
@@ -2277,11 +2179,6 @@
         case ID_COMMENT:        return decode_comment(raw);
 #endif /* UNUSED */
         default:
-#if 0 /* debug output */
-            if (raw->outtype) {
-                sprintf(raw->msgtype,"SBF 0x%04X (%4d):",type, raw->len);
-            }
-#endif
             trace(3,"decode_sbf: unused frame type=%04x len=%d\n",type,raw->len);
         /* there are many more SBF blocks to be extracted */
     }
diff -uNdr RTKLIB-rtklib_2.4.3_orig/src/rtkcmn.c RTKLIB-rtklib_2.4.3_new/src/rtkcmn.c
--- RTKLIB-rtklib_2.4.3_orig/src/rtkcmn.c	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/src/rtkcmn.c	2019-08-19 02:04:50.000000000 +0300
@@ -3887,7 +3887,7 @@
 }
 /* dummy application functions for shared library ----------------------------*/
 #ifdef WIN_DLL
-extern int showmsg(const char *format,...) {return 0;}
+extern int showmsg(char *format,...) {return 0;}
 extern void settspan(gtime_t ts, gtime_t te) {}
 extern void settime(gtime_t time) {}
 #endif
diff -uNdr RTKLIB-rtklib_2.4.3_orig/src/rtklib.h RTKLIB-rtklib_2.4.3_new/src/rtklib.h
--- RTKLIB-rtklib_2.4.3_orig/src/rtklib.h	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/src/rtklib.h	2019-08-19 02:04:50.000000000 +0300
@@ -1904,7 +1904,7 @@
                       const double *azel, double *delay, double *var);
 
 /* application defined functions ---------------------------------------------*/
-extern int showmsg(const char *format,...);
+extern int showmsg(char *format,...);
 extern void settspan(gtime_t ts, gtime_t te);
 extern void settime(gtime_t time);
 
diff -uNdr RTKLIB-rtklib_2.4.3_orig/src/rtksvr.c RTKLIB-rtklib_2.4.3_new/src/rtksvr.c
--- RTKLIB-rtklib_2.4.3_orig/src/rtksvr.c	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/src/rtksvr.c	2019-08-19 02:04:50.000000000 +0300
@@ -542,7 +542,7 @@
     unsigned char *p,*q;
     char msg[128];
     int i,j,n,fobs[3]={0},cycle,cputime;
-
+    
     tracet(3,"rtksvrthread:\n");
     
     svr->state=1; obs.data=data;
diff -uNdr RTKLIB-rtklib_2.4.3_orig/src/src.pro RTKLIB-rtklib_2.4.3_new/src/src.pro
--- RTKLIB-rtklib_2.4.3_orig/src/src.pro	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/src/src.pro	2019-08-19 02:04:50.000000000 +0300
@@ -8,23 +8,12 @@
 
 TARGET = RTKLib
 TEMPLATE = lib
-
-DEFINES -= UNICODE TRACE
+CONFIG += staticlib
 
 include(../RTKLib.pri)
 
-*g++* {
-    QMAKE_CFLAGS += -Wall -ansi -pedantic -Wno-unused-but-set-variable -g
-}
-
-win* {
-    CONFIG += staticlib
-}
-*msvc* {
-    QMAKE_CFLAGS += -D_CRT_SECURE_NO_WARNINGS
-}
-
-DESTDIR = ../lib
+QMAKE_CFLAGS += -Wall -ansi -pedantic -Wno-unused-but-set-variable  -DTRACE -g
+DEFINES -= UNICODE
 
 SOURCES += rtkcmn.c \
     convkml.c \
@@ -71,8 +60,7 @@
     rcv/skytraq.c \
     rcv/ss2.c \
     rcv/ublox.c \
-    rcv/cmr.c \
-    rcv/tersus.c
+    rcv/cmr.c
 
 HEADERS += rtklib.h
 
diff -uNdr RTKLIB-rtklib_2.4.3_orig/src/streamsvr.c RTKLIB-rtklib_2.4.3_new/src/streamsvr.c
--- RTKLIB-rtklib_2.4.3_orig/src/streamsvr.c	2020-04-18 07:36:20.000000000 +0300
+++ RTKLIB-rtklib_2.4.3_new/src/streamsvr.c	2019-08-19 02:04:50.000000000 +0300
@@ -597,7 +597,6 @@
     char file1[MAXSTRPATH],file2[MAXSTRPATH],*p;
     
     tracet(3,"strsvrstart:\n");
-    trace(2,"strsvrstart: cmds_periodic=%s\n",cmds_periodic[0]);
     
     if (svr->state) return 0;
     
